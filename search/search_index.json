{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\u200b\\-]"},"docs":[{"location":"","text":"Welcome \u00b6 \u672c\u7ad9\u4f7f\u7528MkDocs\u642d\u5efa,\u4f7f\u7528 Material theme For full documentation visit mkdocs.org . \u7f51\u7ad9\u5185\u5bb9 \u00b6 \u8bb0\u5f55\u65e5\u5e38\u6298\u817e\u7684\u4e1c\u897f \u5b58\u653e\u4e00\u4e9b\u6587\u4ef6\u3001\u56fe\u7247 \u8f6c\u8f7d\u4e00\u4e9b\u7cbe\u5f69\u7684\u6587\u7ae0\uff08\u58f0\u660e\u6587\u7ae0\u51fa\u5904 ... \u9644\u5f55 \u00b6 \u5f15\u8a00 \u5728\u65e0\u7eb8\u5316\u4fe1\u606f\u5904\u7406\u7684\u6d41\u7a0b\u4e2d\uff0c\u4fe1\u606f\u8f93\u5165\u3001\u4fe1\u606f\u6574\u7406\u9636\u6bb5\u7684\u5de5\u5177\u9009\u62e9\u5df2\u7ecf\u5f88\u591a\u4e86\uff0c\u96e8\u540e\u6625\u7b0b\u822c\u4e0d\u65ad\u6d6e\u73b0\u7684\u7b14\u8bb0\u5de5\u5177\u8ba9\u4eba\u773c\u82b1\u7f2d\u4e71\u3002\u4f46\u5230\u4e86\u4fe1\u606f\u8f93\u51fa\u548c\u5c55\u793a\u7684\u73af\u8282\u2014\u2014\u4f8b\u5982\u53d1\u8868\u81ea\u5df1\u7684\u8bfb\u4e66\u5fc3\u5f97\u3001\u601d\u8003\u6216\u662f\u5b66\u4e60\u7b14\u8bb0\uff0c\u6216\u662f\u4e3a\u81ea\u5df1\u7684\u8f6f\u4ef6\u9879\u76ee\u64b0\u5199\u6587\u6863\u2014\u2014\u73b0\u6709\u89e3\u51b3\u65b9\u6848\u5219\u603b\u6709\u660e\u663e\u7684\u9057\u61be\u4e4b\u5904\u3002 \u4e00\u65b9\u9762\uff0c\u5982\u679c\u9009\u62e9\u8bed\u96c0\u3001Notion \u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u4e91\u7aef\u6587\u6863\u5e73\u53f0\u6765\u5b58\u653e\uff0c\u5b9a\u5236\u7a7a\u95f4\u5c31\u5f88\u6709\u9650\uff0c\u4e14\u6570\u636e\u59cb\u7ec8\u662f\u5bc4\u4eba\u7bf1\u4e0b\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u9009\u62e9 WordPress \u8fd9\u7c7b CMS \u6216\u8fd1\u5e74\u6d41\u884c\u7684 Jekyll\u3001Hugo \u6216\u662f Hexo \u7b49\u300c\u9759\u6001\u7f51\u7ad9\u751f\u6210\u5668\u300d\uff0c\u968f\u4e4b\u800c\u6765\u7684\u6280\u672f\u95e8\u69db\u548c\u590d\u6742\u64cd\u4f5c\u53c8\u5bb9\u6613\u6253\u6d88\u4eba\u7684\u521b\u4f5c\u548c\u5206\u4eab\u70ed\u60c5\u3002 \u4ee5\u6211\u4e2a\u4eba\u4e3a\u4f8b\uff0c\u6211\u60f3\u901a\u8fc7\u642d\u5efa\u7b80\u5355\u7684\u9759\u6001\u7f51\u7ad9\u6765\u5f88\u597d\u5730\u5c55\u793a\u6211\u5728\u5b66\u4e60\u7f16\u7a0b\u8fc7\u7a0b\u4e2d\u7684\u6240\u4f5c\u7684\u7b14\u8bb0\u3001\u5bf9\u95ee\u9898\u7684\u770b\u6cd5\u7b49\uff0c\u5c06\u5b83\u4eec\u4f5c\u4e3a\u4e00\u4e2a Cookbook \u6216\u7cfb\u7edf\u5316\u7684\u53c2\u8003\u6587\u6863\u6765\u4f7f\u7528\uff0c\u540c\u65f6\u4e5f\u517c\u5177\u7f8e\u89c2\u548c\u53ef\u8bfb\u6027\u3002\u5bf9\u6b64\uff0c\u4e0a\u8ff0\u4e3b\u6d41\u6846\u67b6\u90fd\u6709\u4e9b\u300c\u6740\u9e21\u7528\u725b\u5200\u300d\u7684\u611f\u89c9\uff0c\u90a3\u4e48\uff0c\u6709\u6ca1\u6709\u66f4\u597d\u7684\u65b9\u5f0f\u5462\uff1f \u6211\u9047\u89c1\u7684\u7b54\u6848\u662f MkDocs\u3002 \u6587\u7ae0\u6765\u6e90 \uff1ahttps://sspai.com/prime/story/mkdocs-primer","title":"\u9996\u9875"},{"location":"#welcome","text":"\u672c\u7ad9\u4f7f\u7528MkDocs\u642d\u5efa,\u4f7f\u7528 Material theme For full documentation visit mkdocs.org .","title":"Welcome"},{"location":"#_1","text":"\u8bb0\u5f55\u65e5\u5e38\u6298\u817e\u7684\u4e1c\u897f \u5b58\u653e\u4e00\u4e9b\u6587\u4ef6\u3001\u56fe\u7247 \u8f6c\u8f7d\u4e00\u4e9b\u7cbe\u5f69\u7684\u6587\u7ae0\uff08\u58f0\u660e\u6587\u7ae0\u51fa\u5904 ...","title":"\u7f51\u7ad9\u5185\u5bb9"},{"location":"#_2","text":"\u5f15\u8a00 \u5728\u65e0\u7eb8\u5316\u4fe1\u606f\u5904\u7406\u7684\u6d41\u7a0b\u4e2d\uff0c\u4fe1\u606f\u8f93\u5165\u3001\u4fe1\u606f\u6574\u7406\u9636\u6bb5\u7684\u5de5\u5177\u9009\u62e9\u5df2\u7ecf\u5f88\u591a\u4e86\uff0c\u96e8\u540e\u6625\u7b0b\u822c\u4e0d\u65ad\u6d6e\u73b0\u7684\u7b14\u8bb0\u5de5\u5177\u8ba9\u4eba\u773c\u82b1\u7f2d\u4e71\u3002\u4f46\u5230\u4e86\u4fe1\u606f\u8f93\u51fa\u548c\u5c55\u793a\u7684\u73af\u8282\u2014\u2014\u4f8b\u5982\u53d1\u8868\u81ea\u5df1\u7684\u8bfb\u4e66\u5fc3\u5f97\u3001\u601d\u8003\u6216\u662f\u5b66\u4e60\u7b14\u8bb0\uff0c\u6216\u662f\u4e3a\u81ea\u5df1\u7684\u8f6f\u4ef6\u9879\u76ee\u64b0\u5199\u6587\u6863\u2014\u2014\u73b0\u6709\u89e3\u51b3\u65b9\u6848\u5219\u603b\u6709\u660e\u663e\u7684\u9057\u61be\u4e4b\u5904\u3002 \u4e00\u65b9\u9762\uff0c\u5982\u679c\u9009\u62e9\u8bed\u96c0\u3001Notion \u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u4e91\u7aef\u6587\u6863\u5e73\u53f0\u6765\u5b58\u653e\uff0c\u5b9a\u5236\u7a7a\u95f4\u5c31\u5f88\u6709\u9650\uff0c\u4e14\u6570\u636e\u59cb\u7ec8\u662f\u5bc4\u4eba\u7bf1\u4e0b\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u9009\u62e9 WordPress \u8fd9\u7c7b CMS \u6216\u8fd1\u5e74\u6d41\u884c\u7684 Jekyll\u3001Hugo \u6216\u662f Hexo \u7b49\u300c\u9759\u6001\u7f51\u7ad9\u751f\u6210\u5668\u300d\uff0c\u968f\u4e4b\u800c\u6765\u7684\u6280\u672f\u95e8\u69db\u548c\u590d\u6742\u64cd\u4f5c\u53c8\u5bb9\u6613\u6253\u6d88\u4eba\u7684\u521b\u4f5c\u548c\u5206\u4eab\u70ed\u60c5\u3002 \u4ee5\u6211\u4e2a\u4eba\u4e3a\u4f8b\uff0c\u6211\u60f3\u901a\u8fc7\u642d\u5efa\u7b80\u5355\u7684\u9759\u6001\u7f51\u7ad9\u6765\u5f88\u597d\u5730\u5c55\u793a\u6211\u5728\u5b66\u4e60\u7f16\u7a0b\u8fc7\u7a0b\u4e2d\u7684\u6240\u4f5c\u7684\u7b14\u8bb0\u3001\u5bf9\u95ee\u9898\u7684\u770b\u6cd5\u7b49\uff0c\u5c06\u5b83\u4eec\u4f5c\u4e3a\u4e00\u4e2a Cookbook \u6216\u7cfb\u7edf\u5316\u7684\u53c2\u8003\u6587\u6863\u6765\u4f7f\u7528\uff0c\u540c\u65f6\u4e5f\u517c\u5177\u7f8e\u89c2\u548c\u53ef\u8bfb\u6027\u3002\u5bf9\u6b64\uff0c\u4e0a\u8ff0\u4e3b\u6d41\u6846\u67b6\u90fd\u6709\u4e9b\u300c\u6740\u9e21\u7528\u725b\u5200\u300d\u7684\u611f\u89c9\uff0c\u90a3\u4e48\uff0c\u6709\u6ca1\u6709\u66f4\u597d\u7684\u65b9\u5f0f\u5462\uff1f \u6211\u9047\u89c1\u7684\u7b54\u6848\u662f MkDocs\u3002 \u6587\u7ae0\u6765\u6e90 \uff1ahttps://sspai.com/prime/story/mkdocs-primer","title":"\u9644\u5f55"},{"location":"about/","text":"This is balabala... \u00b6 >>> import this; The Zen of Python, by Tim Peters Beautiful is better than ugly. Explicit is better than implicit. Simple is better than complex. Complex is better than complicated. Flat is better than nested. Sparse is better than dense. Readability counts. Special cases aren't special enough to break the rules. Although practicality beats purity. Errors should never pass silently. Unless explicitly silenced. In the face of ambiguity, refuse the temptation to guess. There should be one-- and preferably only one --obvious way to do it. Although that way may not be obvious at first unless you're Dutch. Now is better than never. Although never is often better than *right* now. If the implementation is hard to explain, it's a bad idea. If the implementation is easy to explain, it may be a good idea. Namespaces are one honking great idea -- let's do more of those! \u4f18\u7f8e\u4f18\u4e8e\u4e11\u964b\uff0c \u660e\u4e86\u4f18\u4e8e\u9690\u6666\uff1b \u7b80\u5355\u4f18\u4e8e\u590d\u6742\uff0c \u590d\u6742\u4f18\u4e8e\u7e41\u6742\uff0c \u6241\u5e73\u4f18\u4e8e\u5d4c\u5957\uff0c \u7a00\u758f\u4f18\u4e8e\u7a20\u5bc6\uff0c \u53ef\u8bfb\u6027\u5f88\u91cd\u8981\uff01 \u7279\u4f8b\u4ea6\u4e0d\u53ef\u8fdd\u80cc\u539f\u5219\uff0c \u5373\u4f7f\u5b9e\u7528\u6bd4\u7eaf\u7cb9\u66f4\u4f18\u3002 \u9519\u8bef\u7edd\u4e0d\u80fd\u6084\u6084\u5ffd\u7565\uff0c \u9664\u975e\u5b83\u660e\u786e\u9700\u8981\u5982\u6b64\u3002 \u9762\u5bf9\u4e0d\u786e\u5b9a\u6027\uff0c \u62d2\u7edd\u5984\u52a0\u731c\u6d4b\u3002 \u4efb\u4f55\u95ee\u9898\u5e94\u6709\u4e00\u79cd\uff0c \u4e14\u6700\u597d\u53ea\u6709\u4e00\u79cd\uff0c \u663e\u800c\u6613\u89c1\u7684\u89e3\u51b3\u65b9\u6cd5\u3002 \u5c3d\u7ba1\u8fd9\u65b9\u6cd5\u4e00\u5f00\u59cb\u5e76\u975e\u5982\u6b64\u76f4\u89c2\uff0c \u9664\u975e\u4f60\u662f\u8377\u5170\u4eba\u3002 \u505a\u4f18\u4e8e\u4e0d\u505a\uff0c \u7136\u800c\u4e0d\u5047\u601d\u7d22\u8fd8\u4e0d\u5982\u4e0d\u505a\u3002 \u5f88\u96be\u89e3\u91ca\u7684\uff0c\u5fc5\u7136\u662f\u574f\u65b9\u6cd5\u3002 \u5f88\u597d\u89e3\u91ca\u7684\uff0c\u53ef\u80fd\u662f\u597d\u65b9\u6cd5\u3002 \u547d\u540d\u7a7a\u95f4\u662f\u4e2a\u7edd\u5999\u7684\u4e3b\u610f\uff0c \u6211\u4eec\u5e94\u597d\u597d\u5229\u7528\u5b83\u3002","title":"\u5173\u4e8eTa"},{"location":"about/#this-is-balabala","text":">>> import this; The Zen of Python, by Tim Peters Beautiful is better than ugly. Explicit is better than implicit. Simple is better than complex. Complex is better than complicated. Flat is better than nested. Sparse is better than dense. Readability counts. Special cases aren't special enough to break the rules. Although practicality beats purity. Errors should never pass silently. Unless explicitly silenced. In the face of ambiguity, refuse the temptation to guess. There should be one-- and preferably only one --obvious way to do it. Although that way may not be obvious at first unless you're Dutch. Now is better than never. Although never is often better than *right* now. If the implementation is hard to explain, it's a bad idea. If the implementation is easy to explain, it may be a good idea. Namespaces are one honking great idea -- let's do more of those! \u4f18\u7f8e\u4f18\u4e8e\u4e11\u964b\uff0c \u660e\u4e86\u4f18\u4e8e\u9690\u6666\uff1b \u7b80\u5355\u4f18\u4e8e\u590d\u6742\uff0c \u590d\u6742\u4f18\u4e8e\u7e41\u6742\uff0c \u6241\u5e73\u4f18\u4e8e\u5d4c\u5957\uff0c \u7a00\u758f\u4f18\u4e8e\u7a20\u5bc6\uff0c \u53ef\u8bfb\u6027\u5f88\u91cd\u8981\uff01 \u7279\u4f8b\u4ea6\u4e0d\u53ef\u8fdd\u80cc\u539f\u5219\uff0c \u5373\u4f7f\u5b9e\u7528\u6bd4\u7eaf\u7cb9\u66f4\u4f18\u3002 \u9519\u8bef\u7edd\u4e0d\u80fd\u6084\u6084\u5ffd\u7565\uff0c \u9664\u975e\u5b83\u660e\u786e\u9700\u8981\u5982\u6b64\u3002 \u9762\u5bf9\u4e0d\u786e\u5b9a\u6027\uff0c \u62d2\u7edd\u5984\u52a0\u731c\u6d4b\u3002 \u4efb\u4f55\u95ee\u9898\u5e94\u6709\u4e00\u79cd\uff0c \u4e14\u6700\u597d\u53ea\u6709\u4e00\u79cd\uff0c \u663e\u800c\u6613\u89c1\u7684\u89e3\u51b3\u65b9\u6cd5\u3002 \u5c3d\u7ba1\u8fd9\u65b9\u6cd5\u4e00\u5f00\u59cb\u5e76\u975e\u5982\u6b64\u76f4\u89c2\uff0c \u9664\u975e\u4f60\u662f\u8377\u5170\u4eba\u3002 \u505a\u4f18\u4e8e\u4e0d\u505a\uff0c \u7136\u800c\u4e0d\u5047\u601d\u7d22\u8fd8\u4e0d\u5982\u4e0d\u505a\u3002 \u5f88\u96be\u89e3\u91ca\u7684\uff0c\u5fc5\u7136\u662f\u574f\u65b9\u6cd5\u3002 \u5f88\u597d\u89e3\u91ca\u7684\uff0c\u53ef\u80fd\u662f\u597d\u65b9\u6cd5\u3002 \u547d\u540d\u7a7a\u95f4\u662f\u4e2a\u7edd\u5999\u7684\u4e3b\u610f\uff0c \u6211\u4eec\u5e94\u597d\u597d\u5229\u7528\u5b83\u3002","title":"This is balabala..."},{"location":"log/","text":"\u6298\u817elog \u00b6 \u597d\u8bb0\u6027\u4e0d\u5982\u70c2\u7b14\u5934 docker\u65b9\u5f0f\u642d\u5efanginx \u00b6 curl -fsSL https://get.docker.com | sh or wget -qO- get.docker.com | bash \u5c06\u9879\u76ee\u90e8\u7f72\u4e0a\u7ebf\u540c\u6b65github gitpages \u00b6 \u81ea\u52a8\u90e8\u7f72\u5230github gitpages\u9879\u76ee {github\u7528\u6237\u540d}.github.io/{\u9879\u76ee\u540d} mkdocs gh-deploy \u81ea\u52a8\u90e8\u7f72\u5230github gitpages\u4e2a\u4eba\u9875\u9762 {github\u7528\u6237\u540d}.github.io mkdocs gh-deploy --config-file ../{\u6587\u4ef6\u5939}/mkdocs.yml --remote-branch main .gitignore \u6587\u4ef6 \u00b6 git \u4e0a\u4f20\u662f\u5ffd\u7565\u4e0d\u60f3\u4e0a\u4f20\u7684\u6587\u4ef6 python title = '.gitignore\u653e\u5230git\u9879\u76ee\u6839\u76ee\u5f55' /benchmarks/ /spell/ /.vault.vim /.local.vimrc /.stignore /.stfolder /.stversions .vim .DS_Store site Info \u672c\u6587\u603b\u9605\u8bfb\u91cf \u6b21 \u672c\u7ad9\u8bbf\u5ba2\u6570 \u4eba\u6b21","title":"\u6298\u817elog"},{"location":"log/#log","text":"\u597d\u8bb0\u6027\u4e0d\u5982\u70c2\u7b14\u5934","title":"\u6298\u817elog"},{"location":"log/#dockernginx","text":"curl -fsSL https://get.docker.com | sh or wget -qO- get.docker.com | bash","title":"docker\u65b9\u5f0f\u642d\u5efanginx"},{"location":"log/#github-gitpages","text":"\u81ea\u52a8\u90e8\u7f72\u5230github gitpages\u9879\u76ee {github\u7528\u6237\u540d}.github.io/{\u9879\u76ee\u540d} mkdocs gh-deploy \u81ea\u52a8\u90e8\u7f72\u5230github gitpages\u4e2a\u4eba\u9875\u9762 {github\u7528\u6237\u540d}.github.io mkdocs gh-deploy --config-file ../{\u6587\u4ef6\u5939}/mkdocs.yml --remote-branch main","title":"\u5c06\u9879\u76ee\u90e8\u7f72\u4e0a\u7ebf\u540c\u6b65github gitpages"},{"location":"log/#gitignore","text":"git \u4e0a\u4f20\u662f\u5ffd\u7565\u4e0d\u60f3\u4e0a\u4f20\u7684\u6587\u4ef6 python title = '.gitignore\u653e\u5230git\u9879\u76ee\u6839\u76ee\u5f55' /benchmarks/ /spell/ /.vault.vim /.local.vimrc /.stignore /.stfolder /.stversions .vim .DS_Store site Info \u672c\u6587\u603b\u9605\u8bfb\u91cf \u6b21 \u672c\u7ad9\u8bbf\u5ba2\u6570 \u4eba\u6b21","title":".gitignore \u6587\u4ef6"},{"location":"project/","text":"\u9879\u76ee\u7ba1\u7406 \u00b6 \u5982\u4f55\u7ed9\u8f6f\u4ef6\u5f00\u53d1\u9879\u76ee\u4f30\u4ef7\uff1f \u6807\u7b7e\uff1a \u8f6f\u4ef6\u5f00\u53d1 \u9879\u76ee \u4f30\u4ef7 | \u53d1\u8868\u65f6\u95f4\uff1a2015-10-14 17:43 | \u4f5c\u8005\uff1a \u51fa\u5904\uff1ahttp://news.cnblogs.com/ \u201c\u5144\u5f1f\uff0c\u4f60\u770b\u505a\u8fd9\u6837\u4e00\u4e2a\u8f6f\u4ef6\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d \u8fd9\u4f30\u8ba1\u662f\u6240\u6709\u8f6f\u4ef6\u4ece\u4e1a\u4eba\u5458\u88ab\u95ee\u7684\u6700\u591a\u4e5f\u662f\u6700\u65e0\u5948\u7684\u4e00\u4e2a\u95ee\u9898\u3002\u8fd9\u4e2a\u95ee\u9898\u7b49\u540c\u4e8e\uff0c\u201c\u4f60\u770b\u88c5\u4fee\u4e00\u4e2a 100 \u5e73\u7c73\u7684\u623f\u5b50\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\u3002\u8f6f\u4ef6\u5f00\u53d1\u4f60\u4e0d\u61c2\uff0c\u88c5\u4fee\u4f60\u603b\u61c2\u5427\uff0c100 \u5e73\u7c73\u7684\u623f\u5b50\u88c5\u4fee\u4ece 10 \u4e07\u5230 100 \u4e07\u5747\u6709\u53ef\u80fd\uff0c\u53d6\u51b3\u4e8e\u4f60\u627e\u4ec0\u4e48\u7ea7\u522b\u7684\u8bbe\u8ba1\u516c\u53f8\uff0c\u4e70\u4ec0\u4e48\u6837\u7684\u6750\u6599\uff0c\u8bf7\u4ec0\u4e48\u6837\u7684\u65bd\u5de5\u961f\u2026\u2026\u6240\u4ee5\uff0c\u6211\u771f\u7684\u6ca1\u6709\u529e\u6cd5\u56de\u7b54\u4f60\u201c\u505a\u8fd9\u6837\u4e00\u4e2a\u8f6f\u4ef6\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\u7684\u95ee\u9898\u3002 \u56fe\u7247 \u8bc4\u4f30\u4e00\u4e2a\u8f6f\u4ef6\u5f00\u53d1\u7684\u8d39\u7528\uff0c\u4f60\u9996\u5148\u9700\u8981\u7406\u6e05\u695a\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5\u3002 \u62db\u8058\u4e00\u4e2a\u5f00\u53d1\u8005\u7684\u6210\u672c \u00b6 \u5982\u4eca\uff082015 \u5e74\uff09 IT \u884c\u4e1a\u84ec\u52c3\u53d1\u5c55\uff0c\u5bf9\u8f6f\u4ef6\u5f00\u53d1\u5de5\u7a0b\u5e08\u7684\u9700\u6c42\u5f88\u5927\uff0c\u5bfc\u81f4\u5de5\u7a0b\u5e08\u7684\u5de5\u8d44\u4e00\u8def\u6c34\u6da8\u8239\u9ad8\uff0c\u4ee5\u4e00\u7ebf\u57ce\u5e02\u4e3a\u4f8b\uff0c\u4e00\u4e2a\u80fd\u5b9e\u9645\u5e72\u6d3b\u7684\u5e94\u5c4a\u5f00\u53d1\u8005\u7684\u6708\u85aa\u5728 10000 \u5143\u5de6\u53f3\uff0c3 \u5e74\u4ee5\u4e0a\u5de5\u4f5c\u7ecf\u9a8c\u7684\u57fa\u672c\u80fd\u8fbe\u5230 20000 \u5143\u3002\u6211\u4eec\u59d1\u4e14\u628a\u4e09\u5e74\u5de5\u4f5c\u7ecf\u9a8c\u5b9a\u4e49\u4e3a\u9760\u8c31\u7684\u5f00\u53d1\u8005\uff0c\u518d\u52a0\u4e0a\u5176\u4ed6\u798f\u5229\u548c\u7ba1\u7406\u6210\u672c\uff0c\u4e00\u4e2a\u9760\u8c31\u5168\u804c\u5f00\u53d1\u8005\u7684\u6210\u672c\u5728 30000 \u5143\u5de6\u53f3\u3002\u8fd9\u8fd8\u6ca1\u6709\u7b97\u4e0a\u4f60\u62db\u8058\u7684\u6210\u672c\uff0c\u60f3\u60f3\u662f\u4e0d\u662f\u5f88\u8089\u75bc\uff1f\u6ca1\u529e\u6cd5\uff0c\u884c\u60c5\u5c31\u662f\u8fd9\u6837\uff0c\u5c31\u8ddf\u8fd9\u623f\u4ef7\u4e00\u6837\u3002 \u5916\u5305\u9879\u76ee\u8d39\u7528\u7684\u8ba1\u7b97\u65b9\u5f0f \u00b6 \u5916\u5305\u5206\u4e3a\u4e24\u79cd\uff0c\u4eba\u529b\u5916\u5305\u548c\u9879\u76ee\u5916\u5305\u3002\u4eba\u529b\u5916\u5305\u662f\u6307\u5916\u5305\u516c\u53f8\u6d3e\u4e00\u4e2a\u4eba\u53bb\u4f60\u516c\u53f8\u5de5\u4f5c\uff0c\u4f60\u6309\u5929\u652f\u4ed8\u8fd9\u4e2a\u4eba\u7684\u8d39\u7528\u7ed9\u5916\u5305\u516c\u53f8\u3002\u76ee\u524d\u8fd9\u79cd\u5916\u6d3e\u7684\u57fa\u672c\u8981\u4ef7\u662f 1000 \u5143\u6bcf\u5929\uff0c\u597d\u4e00\u70b9\u7684\u4eba\u5458\u5728 2000 \u5143\u4ee5\u4e0a\u3002\u9879\u76ee\u5916\u5305\u662f\u6307\u505a\u5b8c\u4e00\u4e2a\u9879\u76ee\u591a\u5c11\u94b1\uff0c\u4e0d\u7ba1\u5916\u5305\u516c\u53f8\u6295\u5165\u591a\u5c11\u4eba\u3002\u6709\u70b9\u7c7b\u4f3c\u4e8e\u88c5\u4fee\u961f\u7684\u70b9\u5de5\u548c\u5305\u5de5\u3002\u9879\u76ee\u5916\u5305\u7684\u4ef7\u683c\u867d\u7136\u662f\u6253\u5305\u4ef7\uff0c\u4f46\u4e5f\u662f\u901a\u8fc7\u4f30\u7b97\u5de5\u65f6\u7b97\u51fa\u6765\u7684\u3002\u4f8b\u5982\u4e00\u4e2a\u9879\u76ee\u9884\u8ba1\u9700\u8981\u4e24\u4e2a\u4eba\u5f00\u53d1 20 \u5929\uff0c\u90a3\u5c31\u662f 40 \u4eba\u5929\u7684\u5de5\u4f5c\u91cf\uff0c\u6309\u7167 1500 \u5143/\u4eba\u5929\u7b97\uff08\u8fd9\u5df2\u7ecf\u662f\u826f\u5fc3\u4ef7\u4e86\uff09\uff0c\u8fd9\u4e2a\u9879\u76ee\u5c31\u662f 60000 \u5143\u3002 \u770b\u5230\u8fd9\u91cc\u4f60\u4e00\u5b9a\u4f1a\u89c9\u5f97\uff0c\u5916\u5305\u597d\u8d35\uff0c\u600e\u4e48\u6bd4\u62db\u4e00\u4e2a\u4eba\u7684\u6210\u672c\u8d35\u90a3\u4e48\u591a\uff01\u541b\u4e0d\u89c1\uff0c\u7528\u4eba\u9664\u4e86\u786c\u6027\u6210\u672c\u8fd8\u6709\u5f88\u591a\u8f6f\u6027\u6210\u672c\u7684\u3002\u4f8b\u5982\u62db\u8058\u7684\u65f6\u95f4\u6210\u672c\uff0c\u62db\u6765\u4e0d\u5408\u9002\u5f00\u4eba\u7684\u6210\u672c\u3002\u800c\u901a\u8fc7\u5916\u5305\uff0c\u4f60\u53ef\u4ee5\u505a\u5230\u53ec\u4e4b\u5373\u6765\uff0c\u6325\u4e4b\u5373\u53bb\uff0c\u8fd9\u4e9b\u8f6f\u6027\u6210\u672c\u90fd\u662f\u5916\u5305\u516c\u53f8\u627f\u62c5\u4e86\uff0c\u4f60\u8981\u7b97\u5355\u4ef7\uff0c\u81ea\u7136\u4f1a\u8d35\u4e00\u4e9b\u3002 \u597d\u4e86\uff0c\u4e0b\u9762\u6211\u4eec\u56de\u5230\u6b63\u9898\uff0c\u201c\u5f00\u53d1\u8fd9\u6837\u4e00\u4e2a\u8f6f\u4ef6\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\u3002\u8fd9\u91cc\u7684\u6838\u5fc3\u95ee\u9898\u662f\u5982\u4f55\u5b9a\u4e49\u201c\u8fd9\u6837\u201d\u3002\u4f60\u9700\u8981\u51c6\u786e\u7684\u4f30\u4ef7\uff0c\u90a3\u5c31\u9700\u8981\u628a\u9700\u6c42\u5b9a\u4e49\u6e05\u695a\uff0c\u5426\u5219\u4f30\u4ef7\u5c31\u662f\u800d\u6d41\u6c13\uff0c\u6700\u540e\u4e00\u5b9a\u5bfc\u81f4\u7ea0\u7eb7\u3002\u9700\u6c42\u5b9a\u4e49\u5305\u542b\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a \u8bbe\u8ba1\u8981\u6c42 \u00b6 \u4e00\u4e2a\u597d\u7684\u8bbe\u8ba1\u662f\u5f88\u8d35\u7684\uff0c\u56e0\u4e3a\u6d89\u53ca\u5230\u521b\u610f\uff0c\u800c\u4e14\u4e0d\u597d\u8bc4\u4f30\uff0c\u89c1\u4ec1\u89c1\u667a\u3002\u5c31\u8ddf\u4f60\u8bf7\u5927\u5e08\u753b\u4e00\u5e45\u753b\uff0c\u8fd8\u662f\u8bf7\u666e\u901a\u753b\u5e08\u753b\u4e00\u5e45\u753b\u4e00\u6837\uff0c\u770b\u4f60\u60f3\u8981\u4ec0\u4e48\u4e86\u3002\u5728\u6211\u770b\u6765\uff0c\u7edd\u5927\u90e8\u5206\u8f6f\u4ef6\u9879\u76ee\u8bbe\u8ba1\u4e2d\u89c4\u4e2d\u77e9\u5c31\u597d\u4e86\uff0c\u8bf7\u4e00\u4e2a\u6709\u7ecf\u9a8c\u7684\u8bbe\u8ba1\u5e08\uff0c\u6309\u7167\u6700\u65b0\u6d41\u884c\u7684\u8bbe\u8ba1\u98ce\u683c\u8bbe\u8ba1\u4e00\u5957 UI \u90fd\u4e0d\u4f1a\u5dee\u5230\u54ea\u91cc\u53bb\u3002\u800c\u4e14\u4ef7\u683c\u90fd\u6bd4\u8f83\u4fbf\u5b9c\u7684\uff0c\u4e00\u4e2a APP \u7684 UI \u8bbe\u8ba1\uff0c\u4e00\u822c\u5728 10000 - 20000 \u4e4b\u95f4\uff0c\u5e94\u8be5\u80fd\u6709\u4e0d\u9519\u7684\u6548\u679c\u3002\u5f53\u7136\uff0c\u4f60\u5bf9\u8bbe\u8ba1\u6ca1\u6709\u8981\u6c42\u7684\u8bdd\uff0c\u4f60\u627e\u4e00\u4e2a\u5e94\u5c4a\u751f\u505a\u4e00\u5957 UI\uff0c\u51e0\u5343\u5757\u5c31\u641e\u5b9a\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u592a\u4e11\u7684\u3002 \u529f\u80fd\u8981\u6c42 \u00b6 \u6211\u4e0d\u6b62\u4e00\u6b21\u88ab\u95ee\u5230\uff0c\u201c\u6211\u60f3\u505a\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5fae\u4fe1\u7684 APP\u2026\u2026\u201d\uff0c\u7136\u540e\u6211\u5c31\u5475\u5475\u4e86\u3002\u5176\u5b9e\u4f60\u4e0d\u662f\u771f\u7684\u60f3\u505a\u4e00\u4e2a\u5fae\u4fe1\uff0c\u6211\u76f8\u4fe1\u4f60\u60f3\u8981\u7684\u53ea\u662f\u5fae\u4fe1\u7684\u90e8\u5206\u529f\u80fd\uff0c\u4f8b\u5982\u804a\u5929\u90e8\u5206\u3002\u6240\u4ee5\u4f60\u5e94\u8be5\u66f4\u52a0\u51c6\u786e\u7684\u63cf\u8ff0\u4f60\u5bf9\u529f\u80fd\u7684\u8981\u6c42\uff0c\u4f8b\u5982\uff1a\u7c7b\u4f3c\u4e8e\u5fae\u4fe1\u7684\u804a\u5929\u529f\u80fd\uff0c\u53ef\u4ee5\u53d1\u6587\u5b57\uff0c\u56fe\u7247\uff0c\u8bed\u97f3\u8fd8\u6709\u89c6\u9891\uff0c\u53ef\u4ee5\u591a\u4eba\u62c9\u7fa4\u5bf9\u8bdd\u3002\u6709\u65b0\u6d88\u606f\u4f1a\u5f39\u51fa\u901a\u77e5\uff0c\u804a\u5929\u8bb0\u5f55\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u2026\u2026\u3002\u5728\u8fd9\u4e00\u70b9\u4e0a\u4e0d\u80fd\u61d2\uff0c\u4f60\u9700\u8981\u5f3a\u8feb\u81ea\u5df1\u53bb\u63cf\u8ff0\u8fd9\u4e9b\u529f\u80fd\uff0c\u4f60\u4e0d\u8981\u4ee5\u4e3a\u4f60\u81ea\u5df1\u4e0d\u61c2\u5c31\u4e0d\u53bb\u4ed4\u7ec6\u601d\u8003\uff0c\u5176\u5b9e\u4f60\u53ef\u4ee5\u7684\u3002\u6709\u4e9b\u529f\u80fd\u770b\u8d77\u6765\u5dee\u4e0d\u591a\uff0c\u5176\u5b9e\u6709\u5f88\u5927\u7684\u533a\u522b\uff0c\u6bd4\u5982\u804a\u5929\u662f\u5426\u9700\u8981\u652f\u6301\u8868\u60c5\uff0c\u8868\u60c5\u662f\u5426\u652f\u6301\u52a8\u753b\u8fd9\u4e9b\u5176\u5b9e\u5de5\u4f5c\u91cf\u90fd\u662f\u5f88\u4e0d\u4e00\u6837\u7684\u3002 \u6027\u80fd\u8981\u6c42 \u00b6 \u6027\u80fd\u95ee\u9898\u5176\u5b9e\u4e0d\u662f\u7279\u522b\u9700\u8981\u5173\u6ce8\uff0c\u56e0\u4e3a\u5728\u76ee\u524d\u7684\u6280\u672f\u53d1\u5c55\u6c34\u5e73\u4e0a\uff0c\u6027\u80fd\u90fd\u4e0d\u4f1a\u6709\u592a\u5927\u7684\u95ee\u9898\uff0c\u7279\u522b\u662f\u5728\u9879\u76ee\u521d\u671f\uff0c\u4f46\u4e5f\u8fd8\u662f\u8981\u8bf4\u4e00\u8bf4\u3002\u540c\u6837\u7684\u529f\u80fd\uff0c\u4f46\u662f\u6027\u80fd\u8981\u6c42\u4e0d\u4e00\u6837\uff0c\u5de5\u4f5c\u91cf\u662f\u5b8c\u5168\u4e0d\u4e00\u6837\u7684\u3002\u8fd8\u62ff\u804a\u5929\u6765\u4e3e\u4f8b\u5b50\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\uff0c\u4f46\u662f\u4f60\u8bf4\u8981\u50cf\u5fae\u4fe1\u4e00\u6837\u652f\u6301\u51e0\u4ebf\u7528\u6237\u540c\u65f6\u804a\u5929\uff0c\u90a3\u5c31\u662f\u4e24\u7801\u4e8b\u4e86\u3002\u540c\u6837\u662f\u4e2a\u8f66\uff0cQQ \u548c\u5954\u9a70\u8fd8\u662f\u5f88\u4e0d\u4e00\u6837\u7684\u3002 \u5728\u660e\u786e\u4e86\u4ee5\u4e0a\u4fe1\u606f\u4ee5\u540e\uff0c\u4f60\u627e\u4e00\u4e2a\u6709\u7ecf\u9a8c\u7684\u5f00\u53d1\u8005\u6216\u8005\u9879\u76ee\u7ecf\u7406\u5c31\u80fd\u7ed9\u4f60\u4e00\u4e2a\u660e\u786e\u7684\u4f30\u4ef7\u4e86\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u8f6f\u4ef6\u5f00\u53d1\u662f\u4e00\u4ef6\u975e\u5e38\u4e0d\u6807\u51c6\u7684\u4e8b\u60c5\uff0c\u8ddf\u88c5\u4fee\u5f88\u50cf\uff0c\u8981\u7559\u6709\u4f59\u5730\uff0c\u4f60\u628a\u8d39\u7528\u5361\u7684\u592a\u6b7b\uff0c\u6700\u540e\u522b\u4eba\u53ea\u80fd\u5077\u5de5\u51cf\u6599\u4e86\u3002 \u5f53\u7136\u8fd8\u6709\u4e00\u79cd\u4f30\u4ef7\u65b9\u5f0f\uff0c\u4f60\u5148\u786e\u5b9a\u9884\u7b97\uff0c\u7136\u540e\u518d\u6765\u5b9a\u7ec6\u8282\u529f\u80fd\u3002\u4f8b\u5982\u4f60\u6253\u7b97\u82b1 50000 \u6765\u505a\u4e00\u4e2a APP\uff0c\u5177\u6709\u7c7b\u4f3c\u5fae\u4fe1\u7684\u804a\u5929\u529f\u80fd\uff0c\u8fd8\u6709\u76f8\u4e92\u5173\u6ce8\u6652\u7167\u7247\u529f\u80fd\u3002\u4f60\u628a\u8be6\u7ec6\u7684\u529f\u80fd\u9700\u6c42\u7ed9\u5230\u5f00\u53d1\u8005\u6216\u8005\u9879\u76ee\u7ecf\u7406\uff0c\u4ed6\u4f1a\u53bb\u5224\u65ad\u4f60\u7684\u9884\u7b97\u80fd\u5426\u5b9e\u73b0\u4f60\u7684\u8981\u6c42\uff0c\u5982\u679c\u4e0d\u80fd\u7684\u8bdd\uff0c\u4f60\u4eec\u518d\u5546\u91cf\u54ea\u4e9b\u529f\u80fd\u53ef\u4ee5\u5148\u4e0d\u505a\uff0c\u4f8b\u5982\u804a\u5929\u53d1\u8868\u60c5\u529f\u80fd\u4e0d\u662f\u5f88\u91cd\u8981\u5c31\u5148\u4e0d\u505a\u4e86\uff0c\u53ef\u4ee5\u8282\u7ea6\u4e00\u4e9b\u6210\u672c\u3002 \u65e0\u8bba\u4f55\u79cd\u65b9\u5f0f\uff0c\u90fd\u9700\u8981\u4f60\u660e\u786e\u9700\u6c42\uff0c\u660e\u786e\u9700\u6c42\uff0c\u660e\u786e\u9700\u6c42\uff01\u91cd\u8981\u7684\u4e8b\u60c5\u8bf4\u4e09\u904d\u3002\u6240\u4ee5\u4f60\u627e\u522b\u4eba\u62a5\u4ef7\u7684\u65f6\u5019\uff0c\u5343\u4e07\u4e0d\u8981\u53ea\u6254\u8fc7\u53bb\u201c\u5f00\u53d1\u4e00\u4e2a\u7c7b\u4f3c\u4e8e xxxx \u8fd9\u6837\u7684 APP \u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\uff0c\u4f60\u4e0d\u4f1a\u5f97\u5230\u4f60\u60f3\u8981\u7684\u7b54\u6848\u7684\uff0c\u56de\u7b54\u8fd9\u6837\u7684\u95ee\u9898\u662f\u4e0d\u8d1f\u8d23\u4efb\u7684\u3002\u4e0d\u8fc7\uff0c\u8fd9\u5012\u4e0d\u5931\u4e3a\u4e00\u79cd\u8fc7\u6ee4\u670d\u52a1\u65b9\u7684\u4e00\u79cd\u65b9\u6cd5\uff1a\uff09 \uff08\u5b8c\uff09 *\u6ce8\uff1a\u6240\u6709\u914d\u56fe\u6765\u6e90\u4e8e\u4e92\u8054\u7f51 \u4f5c\u8005\uff1a\u5f20\u6d77\u9f99\uff0cCoding.net CEO\uff0c\u6280\u672f\u521b\u4e1a\u8005\u3002CMU \u8ba1\u7b97\u673a\u7855\u58eb\uff0c\u539f Oracle \u9ad8\u7ea7\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u30022010 \u5e74\u56de\u56fd\u521b\u4e1a\uff0c\u66fe\u8054\u5408\u521b\u529e\u5f00\u6e90\u4e2d\u56fd\u793e\u533a\uff0c2014 \u5e74\u521b\u529e Coding.net\u3002 Coding.net \u662f\u56fd\u5185\u6700\u5927\u7684\u4e00\u7ad9\u5f0f\u4e91\u7aef\u5f00\u53d1\u5e73\u53f0\u63d0\u4f9b\u5305\u62ec\u4ee3\u7801\u6258\u7ba1\uff0c\u9879\u76ee\u7ba1\u7406\uff0c\u4ea7\u54c1\u6f14\u793a\uff0cWebIDE \u7b49\u5de5\u5177\uff0c\u5e2e\u52a9\u8f6f\u4ef6\u5f00\u53d1\u8005\u63d0\u9ad8\u751f\u4ea7\u6548\u7387\uff0c\u5e76\u5b9e\u73b0 \u201cCoding anytime anywhere\u201d \u7684\u613f\u666f\u3002Coding \u76ee\u524d\u5df2\u7ecf\u79ef\u7d2f\u4e86 15 \u4e07\u5f00\u53d1\u8005\uff0c20 \u4e07\u9879\u76ee\uff0c\u5e76\u4e14\u83b7\u5f97\u4e86 IDG \u548c\u5149\u901f\u7684\u4e24\u8f6e\u6295\u8d44\u5171\u8ba1 1200 \u4e07\u7f8e\u5143\u30022015 \u5e74 8 \u6708\uff0cCoding \u63a8\u51fa\u7801\u5e02\u5e73\u53f0\uff08mart.coding.net\uff09\uff0c\u65e8\u5728\u901a\u8fc7\u4e91\u7aef\u4f17\u5305\u7684\u65b9\u5f0f\u63d0\u9ad8\u8f6f\u4ef6\u4ea4\u4ed8\u7684\u6548\u7387\uff0c\u5e2e\u52a9\u8f6f\u4ef6\u5f00\u53d1\u884c\u4e1a\u5b9e\u73b0\u9ad8\u6548\u7684\u8d44\u6e90\u5339\u914d\u3002\u3011","title":"\u9879\u76ee\u7ba1\u7406"},{"location":"project/#_1","text":"\u5982\u4f55\u7ed9\u8f6f\u4ef6\u5f00\u53d1\u9879\u76ee\u4f30\u4ef7\uff1f \u6807\u7b7e\uff1a \u8f6f\u4ef6\u5f00\u53d1 \u9879\u76ee \u4f30\u4ef7 | \u53d1\u8868\u65f6\u95f4\uff1a2015-10-14 17:43 | \u4f5c\u8005\uff1a \u51fa\u5904\uff1ahttp://news.cnblogs.com/ \u201c\u5144\u5f1f\uff0c\u4f60\u770b\u505a\u8fd9\u6837\u4e00\u4e2a\u8f6f\u4ef6\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d \u8fd9\u4f30\u8ba1\u662f\u6240\u6709\u8f6f\u4ef6\u4ece\u4e1a\u4eba\u5458\u88ab\u95ee\u7684\u6700\u591a\u4e5f\u662f\u6700\u65e0\u5948\u7684\u4e00\u4e2a\u95ee\u9898\u3002\u8fd9\u4e2a\u95ee\u9898\u7b49\u540c\u4e8e\uff0c\u201c\u4f60\u770b\u88c5\u4fee\u4e00\u4e2a 100 \u5e73\u7c73\u7684\u623f\u5b50\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\u3002\u8f6f\u4ef6\u5f00\u53d1\u4f60\u4e0d\u61c2\uff0c\u88c5\u4fee\u4f60\u603b\u61c2\u5427\uff0c100 \u5e73\u7c73\u7684\u623f\u5b50\u88c5\u4fee\u4ece 10 \u4e07\u5230 100 \u4e07\u5747\u6709\u53ef\u80fd\uff0c\u53d6\u51b3\u4e8e\u4f60\u627e\u4ec0\u4e48\u7ea7\u522b\u7684\u8bbe\u8ba1\u516c\u53f8\uff0c\u4e70\u4ec0\u4e48\u6837\u7684\u6750\u6599\uff0c\u8bf7\u4ec0\u4e48\u6837\u7684\u65bd\u5de5\u961f\u2026\u2026\u6240\u4ee5\uff0c\u6211\u771f\u7684\u6ca1\u6709\u529e\u6cd5\u56de\u7b54\u4f60\u201c\u505a\u8fd9\u6837\u4e00\u4e2a\u8f6f\u4ef6\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\u7684\u95ee\u9898\u3002 \u56fe\u7247 \u8bc4\u4f30\u4e00\u4e2a\u8f6f\u4ef6\u5f00\u53d1\u7684\u8d39\u7528\uff0c\u4f60\u9996\u5148\u9700\u8981\u7406\u6e05\u695a\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5\u3002","title":"\u9879\u76ee\u7ba1\u7406"},{"location":"project/#_2","text":"\u5982\u4eca\uff082015 \u5e74\uff09 IT \u884c\u4e1a\u84ec\u52c3\u53d1\u5c55\uff0c\u5bf9\u8f6f\u4ef6\u5f00\u53d1\u5de5\u7a0b\u5e08\u7684\u9700\u6c42\u5f88\u5927\uff0c\u5bfc\u81f4\u5de5\u7a0b\u5e08\u7684\u5de5\u8d44\u4e00\u8def\u6c34\u6da8\u8239\u9ad8\uff0c\u4ee5\u4e00\u7ebf\u57ce\u5e02\u4e3a\u4f8b\uff0c\u4e00\u4e2a\u80fd\u5b9e\u9645\u5e72\u6d3b\u7684\u5e94\u5c4a\u5f00\u53d1\u8005\u7684\u6708\u85aa\u5728 10000 \u5143\u5de6\u53f3\uff0c3 \u5e74\u4ee5\u4e0a\u5de5\u4f5c\u7ecf\u9a8c\u7684\u57fa\u672c\u80fd\u8fbe\u5230 20000 \u5143\u3002\u6211\u4eec\u59d1\u4e14\u628a\u4e09\u5e74\u5de5\u4f5c\u7ecf\u9a8c\u5b9a\u4e49\u4e3a\u9760\u8c31\u7684\u5f00\u53d1\u8005\uff0c\u518d\u52a0\u4e0a\u5176\u4ed6\u798f\u5229\u548c\u7ba1\u7406\u6210\u672c\uff0c\u4e00\u4e2a\u9760\u8c31\u5168\u804c\u5f00\u53d1\u8005\u7684\u6210\u672c\u5728 30000 \u5143\u5de6\u53f3\u3002\u8fd9\u8fd8\u6ca1\u6709\u7b97\u4e0a\u4f60\u62db\u8058\u7684\u6210\u672c\uff0c\u60f3\u60f3\u662f\u4e0d\u662f\u5f88\u8089\u75bc\uff1f\u6ca1\u529e\u6cd5\uff0c\u884c\u60c5\u5c31\u662f\u8fd9\u6837\uff0c\u5c31\u8ddf\u8fd9\u623f\u4ef7\u4e00\u6837\u3002","title":"\u62db\u8058\u4e00\u4e2a\u5f00\u53d1\u8005\u7684\u6210\u672c"},{"location":"project/#_3","text":"\u5916\u5305\u5206\u4e3a\u4e24\u79cd\uff0c\u4eba\u529b\u5916\u5305\u548c\u9879\u76ee\u5916\u5305\u3002\u4eba\u529b\u5916\u5305\u662f\u6307\u5916\u5305\u516c\u53f8\u6d3e\u4e00\u4e2a\u4eba\u53bb\u4f60\u516c\u53f8\u5de5\u4f5c\uff0c\u4f60\u6309\u5929\u652f\u4ed8\u8fd9\u4e2a\u4eba\u7684\u8d39\u7528\u7ed9\u5916\u5305\u516c\u53f8\u3002\u76ee\u524d\u8fd9\u79cd\u5916\u6d3e\u7684\u57fa\u672c\u8981\u4ef7\u662f 1000 \u5143\u6bcf\u5929\uff0c\u597d\u4e00\u70b9\u7684\u4eba\u5458\u5728 2000 \u5143\u4ee5\u4e0a\u3002\u9879\u76ee\u5916\u5305\u662f\u6307\u505a\u5b8c\u4e00\u4e2a\u9879\u76ee\u591a\u5c11\u94b1\uff0c\u4e0d\u7ba1\u5916\u5305\u516c\u53f8\u6295\u5165\u591a\u5c11\u4eba\u3002\u6709\u70b9\u7c7b\u4f3c\u4e8e\u88c5\u4fee\u961f\u7684\u70b9\u5de5\u548c\u5305\u5de5\u3002\u9879\u76ee\u5916\u5305\u7684\u4ef7\u683c\u867d\u7136\u662f\u6253\u5305\u4ef7\uff0c\u4f46\u4e5f\u662f\u901a\u8fc7\u4f30\u7b97\u5de5\u65f6\u7b97\u51fa\u6765\u7684\u3002\u4f8b\u5982\u4e00\u4e2a\u9879\u76ee\u9884\u8ba1\u9700\u8981\u4e24\u4e2a\u4eba\u5f00\u53d1 20 \u5929\uff0c\u90a3\u5c31\u662f 40 \u4eba\u5929\u7684\u5de5\u4f5c\u91cf\uff0c\u6309\u7167 1500 \u5143/\u4eba\u5929\u7b97\uff08\u8fd9\u5df2\u7ecf\u662f\u826f\u5fc3\u4ef7\u4e86\uff09\uff0c\u8fd9\u4e2a\u9879\u76ee\u5c31\u662f 60000 \u5143\u3002 \u770b\u5230\u8fd9\u91cc\u4f60\u4e00\u5b9a\u4f1a\u89c9\u5f97\uff0c\u5916\u5305\u597d\u8d35\uff0c\u600e\u4e48\u6bd4\u62db\u4e00\u4e2a\u4eba\u7684\u6210\u672c\u8d35\u90a3\u4e48\u591a\uff01\u541b\u4e0d\u89c1\uff0c\u7528\u4eba\u9664\u4e86\u786c\u6027\u6210\u672c\u8fd8\u6709\u5f88\u591a\u8f6f\u6027\u6210\u672c\u7684\u3002\u4f8b\u5982\u62db\u8058\u7684\u65f6\u95f4\u6210\u672c\uff0c\u62db\u6765\u4e0d\u5408\u9002\u5f00\u4eba\u7684\u6210\u672c\u3002\u800c\u901a\u8fc7\u5916\u5305\uff0c\u4f60\u53ef\u4ee5\u505a\u5230\u53ec\u4e4b\u5373\u6765\uff0c\u6325\u4e4b\u5373\u53bb\uff0c\u8fd9\u4e9b\u8f6f\u6027\u6210\u672c\u90fd\u662f\u5916\u5305\u516c\u53f8\u627f\u62c5\u4e86\uff0c\u4f60\u8981\u7b97\u5355\u4ef7\uff0c\u81ea\u7136\u4f1a\u8d35\u4e00\u4e9b\u3002 \u597d\u4e86\uff0c\u4e0b\u9762\u6211\u4eec\u56de\u5230\u6b63\u9898\uff0c\u201c\u5f00\u53d1\u8fd9\u6837\u4e00\u4e2a\u8f6f\u4ef6\u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\u3002\u8fd9\u91cc\u7684\u6838\u5fc3\u95ee\u9898\u662f\u5982\u4f55\u5b9a\u4e49\u201c\u8fd9\u6837\u201d\u3002\u4f60\u9700\u8981\u51c6\u786e\u7684\u4f30\u4ef7\uff0c\u90a3\u5c31\u9700\u8981\u628a\u9700\u6c42\u5b9a\u4e49\u6e05\u695a\uff0c\u5426\u5219\u4f30\u4ef7\u5c31\u662f\u800d\u6d41\u6c13\uff0c\u6700\u540e\u4e00\u5b9a\u5bfc\u81f4\u7ea0\u7eb7\u3002\u9700\u6c42\u5b9a\u4e49\u5305\u542b\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a","title":"\u5916\u5305\u9879\u76ee\u8d39\u7528\u7684\u8ba1\u7b97\u65b9\u5f0f"},{"location":"project/#_4","text":"\u4e00\u4e2a\u597d\u7684\u8bbe\u8ba1\u662f\u5f88\u8d35\u7684\uff0c\u56e0\u4e3a\u6d89\u53ca\u5230\u521b\u610f\uff0c\u800c\u4e14\u4e0d\u597d\u8bc4\u4f30\uff0c\u89c1\u4ec1\u89c1\u667a\u3002\u5c31\u8ddf\u4f60\u8bf7\u5927\u5e08\u753b\u4e00\u5e45\u753b\uff0c\u8fd8\u662f\u8bf7\u666e\u901a\u753b\u5e08\u753b\u4e00\u5e45\u753b\u4e00\u6837\uff0c\u770b\u4f60\u60f3\u8981\u4ec0\u4e48\u4e86\u3002\u5728\u6211\u770b\u6765\uff0c\u7edd\u5927\u90e8\u5206\u8f6f\u4ef6\u9879\u76ee\u8bbe\u8ba1\u4e2d\u89c4\u4e2d\u77e9\u5c31\u597d\u4e86\uff0c\u8bf7\u4e00\u4e2a\u6709\u7ecf\u9a8c\u7684\u8bbe\u8ba1\u5e08\uff0c\u6309\u7167\u6700\u65b0\u6d41\u884c\u7684\u8bbe\u8ba1\u98ce\u683c\u8bbe\u8ba1\u4e00\u5957 UI \u90fd\u4e0d\u4f1a\u5dee\u5230\u54ea\u91cc\u53bb\u3002\u800c\u4e14\u4ef7\u683c\u90fd\u6bd4\u8f83\u4fbf\u5b9c\u7684\uff0c\u4e00\u4e2a APP \u7684 UI \u8bbe\u8ba1\uff0c\u4e00\u822c\u5728 10000 - 20000 \u4e4b\u95f4\uff0c\u5e94\u8be5\u80fd\u6709\u4e0d\u9519\u7684\u6548\u679c\u3002\u5f53\u7136\uff0c\u4f60\u5bf9\u8bbe\u8ba1\u6ca1\u6709\u8981\u6c42\u7684\u8bdd\uff0c\u4f60\u627e\u4e00\u4e2a\u5e94\u5c4a\u751f\u505a\u4e00\u5957 UI\uff0c\u51e0\u5343\u5757\u5c31\u641e\u5b9a\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u592a\u4e11\u7684\u3002","title":"\u8bbe\u8ba1\u8981\u6c42"},{"location":"project/#_5","text":"\u6211\u4e0d\u6b62\u4e00\u6b21\u88ab\u95ee\u5230\uff0c\u201c\u6211\u60f3\u505a\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5fae\u4fe1\u7684 APP\u2026\u2026\u201d\uff0c\u7136\u540e\u6211\u5c31\u5475\u5475\u4e86\u3002\u5176\u5b9e\u4f60\u4e0d\u662f\u771f\u7684\u60f3\u505a\u4e00\u4e2a\u5fae\u4fe1\uff0c\u6211\u76f8\u4fe1\u4f60\u60f3\u8981\u7684\u53ea\u662f\u5fae\u4fe1\u7684\u90e8\u5206\u529f\u80fd\uff0c\u4f8b\u5982\u804a\u5929\u90e8\u5206\u3002\u6240\u4ee5\u4f60\u5e94\u8be5\u66f4\u52a0\u51c6\u786e\u7684\u63cf\u8ff0\u4f60\u5bf9\u529f\u80fd\u7684\u8981\u6c42\uff0c\u4f8b\u5982\uff1a\u7c7b\u4f3c\u4e8e\u5fae\u4fe1\u7684\u804a\u5929\u529f\u80fd\uff0c\u53ef\u4ee5\u53d1\u6587\u5b57\uff0c\u56fe\u7247\uff0c\u8bed\u97f3\u8fd8\u6709\u89c6\u9891\uff0c\u53ef\u4ee5\u591a\u4eba\u62c9\u7fa4\u5bf9\u8bdd\u3002\u6709\u65b0\u6d88\u606f\u4f1a\u5f39\u51fa\u901a\u77e5\uff0c\u804a\u5929\u8bb0\u5f55\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u2026\u2026\u3002\u5728\u8fd9\u4e00\u70b9\u4e0a\u4e0d\u80fd\u61d2\uff0c\u4f60\u9700\u8981\u5f3a\u8feb\u81ea\u5df1\u53bb\u63cf\u8ff0\u8fd9\u4e9b\u529f\u80fd\uff0c\u4f60\u4e0d\u8981\u4ee5\u4e3a\u4f60\u81ea\u5df1\u4e0d\u61c2\u5c31\u4e0d\u53bb\u4ed4\u7ec6\u601d\u8003\uff0c\u5176\u5b9e\u4f60\u53ef\u4ee5\u7684\u3002\u6709\u4e9b\u529f\u80fd\u770b\u8d77\u6765\u5dee\u4e0d\u591a\uff0c\u5176\u5b9e\u6709\u5f88\u5927\u7684\u533a\u522b\uff0c\u6bd4\u5982\u804a\u5929\u662f\u5426\u9700\u8981\u652f\u6301\u8868\u60c5\uff0c\u8868\u60c5\u662f\u5426\u652f\u6301\u52a8\u753b\u8fd9\u4e9b\u5176\u5b9e\u5de5\u4f5c\u91cf\u90fd\u662f\u5f88\u4e0d\u4e00\u6837\u7684\u3002","title":"\u529f\u80fd\u8981\u6c42"},{"location":"project/#_6","text":"\u6027\u80fd\u95ee\u9898\u5176\u5b9e\u4e0d\u662f\u7279\u522b\u9700\u8981\u5173\u6ce8\uff0c\u56e0\u4e3a\u5728\u76ee\u524d\u7684\u6280\u672f\u53d1\u5c55\u6c34\u5e73\u4e0a\uff0c\u6027\u80fd\u90fd\u4e0d\u4f1a\u6709\u592a\u5927\u7684\u95ee\u9898\uff0c\u7279\u522b\u662f\u5728\u9879\u76ee\u521d\u671f\uff0c\u4f46\u4e5f\u8fd8\u662f\u8981\u8bf4\u4e00\u8bf4\u3002\u540c\u6837\u7684\u529f\u80fd\uff0c\u4f46\u662f\u6027\u80fd\u8981\u6c42\u4e0d\u4e00\u6837\uff0c\u5de5\u4f5c\u91cf\u662f\u5b8c\u5168\u4e0d\u4e00\u6837\u7684\u3002\u8fd8\u62ff\u804a\u5929\u6765\u4e3e\u4f8b\u5b50\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\uff0c\u4f46\u662f\u4f60\u8bf4\u8981\u50cf\u5fae\u4fe1\u4e00\u6837\u652f\u6301\u51e0\u4ebf\u7528\u6237\u540c\u65f6\u804a\u5929\uff0c\u90a3\u5c31\u662f\u4e24\u7801\u4e8b\u4e86\u3002\u540c\u6837\u662f\u4e2a\u8f66\uff0cQQ \u548c\u5954\u9a70\u8fd8\u662f\u5f88\u4e0d\u4e00\u6837\u7684\u3002 \u5728\u660e\u786e\u4e86\u4ee5\u4e0a\u4fe1\u606f\u4ee5\u540e\uff0c\u4f60\u627e\u4e00\u4e2a\u6709\u7ecf\u9a8c\u7684\u5f00\u53d1\u8005\u6216\u8005\u9879\u76ee\u7ecf\u7406\u5c31\u80fd\u7ed9\u4f60\u4e00\u4e2a\u660e\u786e\u7684\u4f30\u4ef7\u4e86\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u8f6f\u4ef6\u5f00\u53d1\u662f\u4e00\u4ef6\u975e\u5e38\u4e0d\u6807\u51c6\u7684\u4e8b\u60c5\uff0c\u8ddf\u88c5\u4fee\u5f88\u50cf\uff0c\u8981\u7559\u6709\u4f59\u5730\uff0c\u4f60\u628a\u8d39\u7528\u5361\u7684\u592a\u6b7b\uff0c\u6700\u540e\u522b\u4eba\u53ea\u80fd\u5077\u5de5\u51cf\u6599\u4e86\u3002 \u5f53\u7136\u8fd8\u6709\u4e00\u79cd\u4f30\u4ef7\u65b9\u5f0f\uff0c\u4f60\u5148\u786e\u5b9a\u9884\u7b97\uff0c\u7136\u540e\u518d\u6765\u5b9a\u7ec6\u8282\u529f\u80fd\u3002\u4f8b\u5982\u4f60\u6253\u7b97\u82b1 50000 \u6765\u505a\u4e00\u4e2a APP\uff0c\u5177\u6709\u7c7b\u4f3c\u5fae\u4fe1\u7684\u804a\u5929\u529f\u80fd\uff0c\u8fd8\u6709\u76f8\u4e92\u5173\u6ce8\u6652\u7167\u7247\u529f\u80fd\u3002\u4f60\u628a\u8be6\u7ec6\u7684\u529f\u80fd\u9700\u6c42\u7ed9\u5230\u5f00\u53d1\u8005\u6216\u8005\u9879\u76ee\u7ecf\u7406\uff0c\u4ed6\u4f1a\u53bb\u5224\u65ad\u4f60\u7684\u9884\u7b97\u80fd\u5426\u5b9e\u73b0\u4f60\u7684\u8981\u6c42\uff0c\u5982\u679c\u4e0d\u80fd\u7684\u8bdd\uff0c\u4f60\u4eec\u518d\u5546\u91cf\u54ea\u4e9b\u529f\u80fd\u53ef\u4ee5\u5148\u4e0d\u505a\uff0c\u4f8b\u5982\u804a\u5929\u53d1\u8868\u60c5\u529f\u80fd\u4e0d\u662f\u5f88\u91cd\u8981\u5c31\u5148\u4e0d\u505a\u4e86\uff0c\u53ef\u4ee5\u8282\u7ea6\u4e00\u4e9b\u6210\u672c\u3002 \u65e0\u8bba\u4f55\u79cd\u65b9\u5f0f\uff0c\u90fd\u9700\u8981\u4f60\u660e\u786e\u9700\u6c42\uff0c\u660e\u786e\u9700\u6c42\uff0c\u660e\u786e\u9700\u6c42\uff01\u91cd\u8981\u7684\u4e8b\u60c5\u8bf4\u4e09\u904d\u3002\u6240\u4ee5\u4f60\u627e\u522b\u4eba\u62a5\u4ef7\u7684\u65f6\u5019\uff0c\u5343\u4e07\u4e0d\u8981\u53ea\u6254\u8fc7\u53bb\u201c\u5f00\u53d1\u4e00\u4e2a\u7c7b\u4f3c\u4e8e xxxx \u8fd9\u6837\u7684 APP \u9700\u8981\u591a\u5c11\u94b1\uff1f\u201d\uff0c\u4f60\u4e0d\u4f1a\u5f97\u5230\u4f60\u60f3\u8981\u7684\u7b54\u6848\u7684\uff0c\u56de\u7b54\u8fd9\u6837\u7684\u95ee\u9898\u662f\u4e0d\u8d1f\u8d23\u4efb\u7684\u3002\u4e0d\u8fc7\uff0c\u8fd9\u5012\u4e0d\u5931\u4e3a\u4e00\u79cd\u8fc7\u6ee4\u670d\u52a1\u65b9\u7684\u4e00\u79cd\u65b9\u6cd5\uff1a\uff09 \uff08\u5b8c\uff09 *\u6ce8\uff1a\u6240\u6709\u914d\u56fe\u6765\u6e90\u4e8e\u4e92\u8054\u7f51 \u4f5c\u8005\uff1a\u5f20\u6d77\u9f99\uff0cCoding.net CEO\uff0c\u6280\u672f\u521b\u4e1a\u8005\u3002CMU \u8ba1\u7b97\u673a\u7855\u58eb\uff0c\u539f Oracle \u9ad8\u7ea7\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u30022010 \u5e74\u56de\u56fd\u521b\u4e1a\uff0c\u66fe\u8054\u5408\u521b\u529e\u5f00\u6e90\u4e2d\u56fd\u793e\u533a\uff0c2014 \u5e74\u521b\u529e Coding.net\u3002 Coding.net \u662f\u56fd\u5185\u6700\u5927\u7684\u4e00\u7ad9\u5f0f\u4e91\u7aef\u5f00\u53d1\u5e73\u53f0\u63d0\u4f9b\u5305\u62ec\u4ee3\u7801\u6258\u7ba1\uff0c\u9879\u76ee\u7ba1\u7406\uff0c\u4ea7\u54c1\u6f14\u793a\uff0cWebIDE \u7b49\u5de5\u5177\uff0c\u5e2e\u52a9\u8f6f\u4ef6\u5f00\u53d1\u8005\u63d0\u9ad8\u751f\u4ea7\u6548\u7387\uff0c\u5e76\u5b9e\u73b0 \u201cCoding anytime anywhere\u201d \u7684\u613f\u666f\u3002Coding \u76ee\u524d\u5df2\u7ecf\u79ef\u7d2f\u4e86 15 \u4e07\u5f00\u53d1\u8005\uff0c20 \u4e07\u9879\u76ee\uff0c\u5e76\u4e14\u83b7\u5f97\u4e86 IDG \u548c\u5149\u901f\u7684\u4e24\u8f6e\u6295\u8d44\u5171\u8ba1 1200 \u4e07\u7f8e\u5143\u30022015 \u5e74 8 \u6708\uff0cCoding \u63a8\u51fa\u7801\u5e02\u5e73\u53f0\uff08mart.coding.net\uff09\uff0c\u65e8\u5728\u901a\u8fc7\u4e91\u7aef\u4f17\u5305\u7684\u65b9\u5f0f\u63d0\u9ad8\u8f6f\u4ef6\u4ea4\u4ed8\u7684\u6548\u7387\uff0c\u5e2e\u52a9\u8f6f\u4ef6\u5f00\u53d1\u884c\u4e1a\u5b9e\u73b0\u9ad8\u6548\u7684\u8d44\u6e90\u5339\u914d\u3002\u3011","title":"\u6027\u80fd\u8981\u6c42"},{"location":"mysql/","text":"\u56fe\u89e3MySQL\u4ecb\u7ecd \u00b6 \u300a\u56fe\u89e3MySQL\u300b\u76ee\u524d\u8fd8\u5728\u8fde\u8f7d\u66f4\u65b0\u4e2d\uff0c\u5927\u5bb6\u4e0d\u8981\u50ac\u5566:joy: \uff0c\u66f4\u65b0\u5b8c\u4f1a\u7b2c\u4e00\u65f6\u95f4\u6574\u7406 PDF \u7684\u3002 \u76ee\u524d\u5df2\u7ecf\u66f4\u65b0\u597d\u7684\u6587\u7ae0\uff1a \u57fa\u7840\u7bc7 :point_down: \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f \u7d22\u5f15\u7bc7 :point_down: \u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898 \u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811 \u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f \u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f MySQL \u4f7f\u7528 like \u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f \u4e8b\u52a1\u7bc7 :point_down: \u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f \u9501\u7bc7 :point_down: MySQL \u6709\u54ea\u4e9b\u9501\uff1f MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868? MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f \u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f \u65e5\u5fd7\u7bc7 :point_down: undo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f \u5185\u5b58\u7bc7 :point_down: \u63ed\u5f00 Buffer_Pool \u7684\u9762\u7eb1 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"mysql\u6559\u7a0b"},{"location":"mysql/#mysql","text":"\u300a\u56fe\u89e3MySQL\u300b\u76ee\u524d\u8fd8\u5728\u8fde\u8f7d\u66f4\u65b0\u4e2d\uff0c\u5927\u5bb6\u4e0d\u8981\u50ac\u5566:joy: \uff0c\u66f4\u65b0\u5b8c\u4f1a\u7b2c\u4e00\u65f6\u95f4\u6574\u7406 PDF \u7684\u3002 \u76ee\u524d\u5df2\u7ecf\u66f4\u65b0\u597d\u7684\u6587\u7ae0\uff1a \u57fa\u7840\u7bc7 :point_down: \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f \u7d22\u5f15\u7bc7 :point_down: \u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898 \u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811 \u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f \u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f MySQL \u4f7f\u7528 like \u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f \u4e8b\u52a1\u7bc7 :point_down: \u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f \u9501\u7bc7 :point_down: MySQL \u6709\u54ea\u4e9b\u9501\uff1f MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868? MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f \u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f \u65e5\u5fd7\u7bc7 :point_down: undo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f \u5185\u5b58\u7bc7 :point_down: \u63ed\u5f00 Buffer_Pool \u7684\u9762\u7eb1 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u56fe\u89e3MySQL\u4ecb\u7ecd"},{"location":"mysql/base/how_select/","text":"\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5b66\u4e60 SQL \u7684\u65f6\u5019\uff0c\u5927\u5bb6\u80af\u5b9a\u7b2c\u4e00\u4e2a\u5148\u5b66\u5230\u7684\u5c31\u662f select \u67e5\u8be2\u8bed\u53e5\u4e86\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u53e5\u67e5\u8be2\u8bed\u53e5\uff1a // \u5728 product \u8868\u4e2d\uff0c\u67e5\u8be2 id = 1 \u7684\u8bb0\u5f55 select * from product where id = 1 ; \u4f46\u662f\u6709\u6ca1\u6709\u60f3\u8fc7\uff0c MySQL \u6267\u884c\u4e00\u6761 select \u67e5\u8be2\u8bed\u53e5\uff0c\u5728 MySQL \u4e2d\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u597d\u7684\u4e86\u89e3 MySQL \u5185\u90e8\u7684\u67b6\u6784\uff0c\u6240\u4ee5\u8fd9\u6b21\u5c0f\u6797\u5c31\u5e26\u5927\u5bb6\u62c6\u89e3\u4e00\u4e0b MySQL \u5185\u90e8\u7684\u7ed3\u6784\uff0c\u770b\u770b\u5185\u90e8\u91cc\u7684\u6bcf\u4e00\u4e2a\u201c\u96f6\u4ef6\u201d\u5177\u4f53\u662f\u8d1f\u8d23\u505a\u4ec0\u4e48\u7684\u3002 MySQL \u6267\u884c\u6d41\u7a0b\u662f\u600e\u6837\u7684\uff1f \u00b6 \u5148\u6765\u4e00\u4e2a\u4e0a\u5e1d\u89c6\u89d2\u56fe\uff0c\u4e0b\u9762\u5c31\u662f MySQL \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6d41\u7a0b\uff0c\u4e5f\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230 MySQL \u5185\u90e8\u67b6\u6784\u91cc\u7684\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u3002 \u53ef\u4ee5\u770b\u5230\uff0c MySQL \u7684\u67b6\u6784\u5171\u5206\u4e3a\u4e24\u5c42\uff1a Server \u5c42\u548c\u5b58\u50a8\u5f15\u64ce\u5c42 \uff0c Server \u5c42\u8d1f\u8d23\u5efa\u7acb\u8fde\u63a5\u3001\u5206\u6790\u548c\u6267\u884c SQL \u3002MySQL \u5927\u591a\u6570\u7684\u6838\u5fc3\u529f\u80fd\u6a21\u5757\u90fd\u5728\u8fd9\u5b9e\u73b0\uff0c\u4e3b\u8981\u5305\u62ec\u8fde\u63a5\u5668\uff0c\u67e5\u8be2\u7f13\u5b58\u3001\u89e3\u6790\u5668\u3001\u9884\u5904\u7406\u5668\u3001\u4f18\u5316\u5668\u3001\u6267\u884c\u5668\u7b49\u3002\u53e6\u5916\uff0c\u6240\u6709\u7684\u5185\u7f6e\u51fd\u6570\uff08\u5982\u65e5\u671f\u3001\u65f6\u95f4\u3001\u6570\u5b66\u548c\u52a0\u5bc6\u51fd\u6570\u7b49\uff09\u548c\u6240\u6709\u8de8\u5b58\u50a8\u5f15\u64ce\u7684\u529f\u80fd\uff08\u5982\u5b58\u50a8\u8fc7\u7a0b\u3001\u89e6\u53d1\u5668\u3001\u89c6\u56fe\u7b49\u3002\uff09\u90fd\u5728 Server \u5c42\u5b9e\u73b0\u3002 \u5b58\u50a8\u5f15\u64ce\u5c42\u8d1f\u8d23\u6570\u636e\u7684\u5b58\u50a8\u548c\u63d0\u53d6 \u3002\u652f\u6301 InnoDB\u3001MyISAM\u3001Memory \u7b49\u591a\u4e2a\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u5171\u7528\u4e00\u4e2a Server \u5c42\u3002\u73b0\u5728\u6700\u5e38\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u662f InnoDB\uff0c\u4ece MySQL 5.5 \u7248\u672c\u5f00\u59cb\uff0c InnoDB \u6210\u4e3a\u4e86 MySQL \u7684\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\u3002\u6211\u4eec\u5e38\u8bf4\u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u5c31\u662f\u7531\u5b58\u50a8\u5f15\u64ce\u5c42\u5b9e\u73b0\u7684\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u4e5f\u4e0d\u76f8\u540c\uff0c\u6bd4\u5982 InnoDB \u652f\u6301\u7d22\u5f15\u7c7b\u578b\u662f B+\u6811 \uff0c\u4e14\u662f\u9ed8\u8ba4\u4f7f\u7528\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u6570\u636e\u8868\u4e2d\u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+ \u6811\u7d22\u5f15\u3002 \u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5bf9 Server \u5c42\u548c\u5b58\u50a8\u5f15\u64ce\u5c42\u6709\u4e86\u4e00\u4e2a\u7b80\u5355\u8ba4\u8bc6\uff0c\u63a5\u4e0b\u6765\uff0c\u5c31\u8be6\u7ec6\u8bf4\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u4f9d\u6b21\u770b\u770b\u6bcf\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u7684\u4f5c\u7528\u3002 \u7b2c\u4e00\u6b65\uff1a\u8fde\u63a5\u5668 \u00b6 \u5982\u679c\u4f60\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u91cc\u8981\u4f7f\u7528 MySQL\uff0c\u90a3\u4f60\u7b2c\u4e00\u6b65\u80af\u5b9a\u662f\u8981\u5148\u8fde\u63a5 MySQL \u670d\u52a1\uff0c\u7136\u540e\u624d\u80fd\u6267\u884c SQL \u8bed\u53e5\uff0c\u666e\u904d\u6211\u4eec\u90fd\u662f\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\u8fdb\u884c\u8fde\u63a5\uff1a # -h \u6307\u5b9a MySQL \u670d\u52a1\u5f97 IP \u5730\u5740\uff0c\u5982\u679c\u662f\u8fde\u63a5\u672c\u5730\u7684 MySQL\u670d\u52a1\uff0c\u53ef\u4ee5\u4e0d\u7528\u8fd9\u4e2a\u53c2\u6570\uff1b # -u \u6307\u5b9a\u7528\u6237\u540d\uff0c\u7ba1\u7406\u5458\u89d2\u8272\u540d\u4e3a root\uff1b # -p \u6307\u5b9a\u5bc6\u7801\uff0c\u5982\u679c\u547d\u4ee4\u884c\u4e2d\u4e0d\u586b\u5199\u5bc6\u7801\uff08\u4e3a\u4e86\u5bc6\u7801\u5b89\u5168\uff0c\u5efa\u8bae\u4e0d\u8981\u5728\u547d\u4ee4\u884c\u5199\u5bc6\u7801\uff09\uff0c\u5c31\u9700\u8981\u5728\u4ea4\u4e92\u5bf9\u8bdd\u91cc\u9762\u8f93\u5165\u5bc6\u7801 mysql -h $ip -u $user -p \u8fde\u63a5\u7684\u8fc7\u7a0b\u9700\u8981\u5148\u7ecf\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\uff0c\u56e0\u4e3a MySQL \u662f\u57fa\u4e8e TCP \u534f\u8bae\u8fdb\u884c\u4f20\u8f93\u7684\uff0c\u5982\u679c MySQL \u670d\u52a1\u5e76\u6ca1\u6709\u542f\u52a8\uff0c\u5219\u4f1a\u6536\u5230\u5982\u4e0b\u7684\u62a5\u9519\uff1a \u5982\u679c MySQL \u670d\u52a1\u6b63\u5e38\u8fd0\u884c\uff0c\u5b8c\u6210 TCP \u8fde\u63a5\u7684\u5efa\u7acb\u540e\uff0c\u8fde\u63a5\u5668\u5c31\u8981\u5f00\u59cb\u9a8c\u8bc1\u4f60\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u5bf9\uff0c\u5c31\u6536\u5230\u4e00\u4e2a\"Access denied for user\"\u7684\u9519\u8bef\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7ed3\u675f\u6267\u884c\u3002 \u5982\u679c\u7528\u6237\u5bc6\u7801\u90fd\u6ca1\u6709\u95ee\u9898\uff0c\u8fde\u63a5\u5668\u5c31\u4f1a\u83b7\u53d6\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u7136\u540e\u4fdd\u5b58\u8d77\u6765\uff0c\u540e\u7eed\u8be5\u7528\u6237\u5728\u6b64\u8fde\u63a5\u91cc\u7684\u4efb\u4f55\u64cd\u4f5c\uff0c\u90fd\u4f1a\u57fa\u4e8e\u8fde\u63a5\u5f00\u59cb\u65f6\u8bfb\u5230\u7684\u6743\u9650\u8fdb\u884c\u6743\u9650\u903b\u8f91\u7684\u5224\u65ad\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u4e00\u4e2a\u7528\u6237\u5df2\u7ecf\u5efa\u7acb\u4e86\u8fde\u63a5\uff0c\u5373\u4f7f\u7ba1\u7406\u5458\u4e2d\u9014\u4fee\u6539\u4e86\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5df2\u7ecf\u5b58\u5728\u8fde\u63a5\u7684\u6743\u9650\u3002\u4fee\u6539\u5b8c\u6210\u540e\uff0c\u53ea\u6709\u518d\u65b0\u5efa\u7684\u8fde\u63a5\u624d\u4f1a\u4f7f\u7528\u65b0\u7684\u6743\u9650\u8bbe\u7f6e\u3002 \u5982\u4f55\u67e5\u770b MySQL \u670d\u52a1\u88ab\u591a\u5c11\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e86\uff1f \u5982\u679c\u4f60\u60f3\u77e5\u9053\u5f53\u524d MySQL \u670d\u52a1\u88ab\u591a\u5c11\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e86\uff0c\u4f60\u53ef\u4ee5\u6267\u884c show processlist \u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u3002 \u6bd4\u5982\u4e0a\u56fe\u7684\u663e\u793a\u7ed3\u679c\uff0c\u5171\u6709\u4e24\u4e2a\u7528\u6237\u540d\u4e3a root \u7684\u7528\u6237\u8fde\u63a5\u4e86 MySQL \u670d\u52a1\uff0c\u5176\u4e2d id \u4e3a 6 \u7684\u7528\u6237\u7684 Command \u5217\u7684\u72b6\u6001\u4e3a Sleep \uff0c\u8fd9\u610f\u5473\u7740\u8be5\u7528\u6237\u8fde\u63a5\u5b8c MySQL \u670d\u52a1\u5c31\u6ca1\u6709\u518d\u6267\u884c\u8fc7\u4efb\u4f55\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u662f\u4e00\u4e2a\u7a7a\u95f2\u7684\u8fde\u63a5\uff0c\u5e76\u4e14\u7a7a\u95f2\u7684\u65f6\u957f\u662f 736 \u79d2\uff08 Time \u5217\uff09\u3002 \u7a7a\u95f2\u8fde\u63a5\u4f1a\u4e00\u76f4\u5360\u7528\u7740\u5417\uff1f \u5f53\u7136\u4e0d\u662f\u4e86\uff0cMySQL \u5b9a\u4e49\u4e86\u7a7a\u95f2\u8fde\u63a5\u7684\u6700\u5927\u7a7a\u95f2\u65f6\u957f\uff0c\u7531 wait_timeout \u53c2\u6570\u63a7\u5236\u7684\uff0c\u9ed8\u8ba4\u503c\u662f 8 \u5c0f\u65f6\uff0828880\u79d2\uff09\uff0c\u5982\u679c\u7a7a\u95f2\u8fde\u63a5\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u65f6\u95f4\uff0c\u8fde\u63a5\u5668\u5c31\u4f1a\u81ea\u52a8\u5c06\u5b83\u65ad\u5f00\u3002 mysql > show variables like 'wait_timeout' ; + ---------------+-------+ | Variable_name | Value | + ---------------+-------+ | wait_timeout | 28800 | + ---------------+-------+ 1 row in set ( 0 . 00 sec ) \u5f53\u7136\uff0c\u6211\u4eec\u81ea\u5df1\u4e5f\u53ef\u4ee5\u624b\u52a8\u65ad\u5f00\u7a7a\u95f2\u7684\u8fde\u63a5\uff0c\u4f7f\u7528\u7684\u662f kill connection + id \u7684\u547d\u4ee4\u3002 mysql > kill connection + 6 ; Query OK , 0 rows affected ( 0 . 00 sec ) \u4e00\u4e2a\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u7684\u8fde\u63a5\u88ab\u670d\u52a1\u7aef\u4e3b\u52a8\u65ad\u5f00\u540e\uff0c\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u77e5\u9053\uff0c\u7b49\u5230\u5ba2\u6237\u7aef\u5728\u53d1\u8d77\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u6536\u5230\u8fd9\u6837\u7684\u62a5\u9519\u201cERROR 2013 (HY000): Lost connection to MySQL server during query\u201d\u3002 MySQL \u7684\u8fde\u63a5\u6570\u6709\u9650\u5236\u5417\uff1f MySQL \u670d\u52a1\u652f\u6301\u7684\u6700\u5927\u8fde\u63a5\u6570\u7531 max_connections \u53c2\u6570\u63a7\u5236\uff0c\u6bd4\u5982\u6211\u7684 MySQL \u670d\u52a1\u9ed8\u8ba4\u662f 151 \u4e2a,\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u7cfb\u7edf\u5c31\u4f1a\u62d2\u7edd\u63a5\u4e0b\u6765\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u5e76\u62a5\u9519\u63d0\u793a\u201cToo many connections\u201d\u3002 mysql > show variables like 'max_connections' ; + -----------------+-------+ | Variable_name | Value | + -----------------+-------+ | max_connections | 151 | + -----------------+-------+ 1 row in set ( 0 . 00 sec ) MySQL \u7684\u8fde\u63a5\u4e5f\u8ddf HTTP \u4e00\u6837\uff0c\u6709\u77ed\u8fde\u63a5\u548c\u957f\u8fde\u63a5\u7684\u6982\u5ff5\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5982\u4e0b\uff1a // \u77ed\u8fde\u63a5 \u8fde\u63a5 mysql \u670d\u52a1 \uff08 TCP \u4e09\u6b21\u63e1\u624b \uff09 \u6267\u884csql \u65ad\u5f00 mysql \u670d\u52a1 \uff08 TCP \u56db\u6b21\u6325\u624b \uff09 // \u957f\u8fde\u63a5 \u8fde\u63a5 mysql \u670d\u52a1 \uff08 TCP \u4e09\u6b21\u63e1\u624b \uff09 \u6267\u884csql \u6267\u884csql \u6267\u884csql .... \u65ad\u5f00 mysql \u670d\u52a1 \uff08 TCP \u56db\u6b21\u6325\u624b \uff09 \u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u957f\u8fde\u63a5\u7684\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u51cf\u5c11\u5efa\u7acb\u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u4e00\u822c\u662f\u63a8\u8350\u4f7f\u7528\u957f\u8fde\u63a5\u3002 \u4f46\u662f\uff0c\u4f7f\u7528\u957f\u8fde\u63a5\u540e\u53ef\u80fd\u4f1a\u5360\u7528\u5185\u5b58\u589e\u591a\uff0c\u56e0\u4e3a MySQL \u5728\u6267\u884c\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4e34\u65f6\u4f7f\u7528\u5185\u5b58\u7ba1\u7406\u8fde\u63a5\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u8fde\u63a5\u5bf9\u8c61\u8d44\u6e90\u53ea\u6709\u5728\u8fde\u63a5\u65ad\u5f00\u65f6\u624d\u4f1a\u91ca\u653e\u3002\u5982\u679c\u957f\u8fde\u63a5\u7d2f\u8ba1\u5f88\u591a\uff0c\u5c06\u5bfc\u81f4 MySQL \u670d\u52a1\u5360\u7528\u5185\u5b58\u592a\u5927\uff0c\u6709\u53ef\u80fd\u4f1a\u88ab\u7cfb\u7edf\u5f3a\u5236\u6740\u6389\uff0c\u8fd9\u6837\u4f1a\u53d1\u751f MySQL \u670d\u52a1\u5f02\u5e38\u91cd\u542f\u7684\u73b0\u8c61\u3002 \u600e\u4e48\u89e3\u51b3\u957f\u8fde\u63a5\u5360\u7528\u5185\u5b58\u7684\u95ee\u9898\uff1f \u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u5f0f\u3002 \u7b2c\u4e00\u79cd\uff0c \u5b9a\u671f\u65ad\u5f00\u957f\u8fde\u63a5 \u3002\u65e2\u7136\u65ad\u5f00\u8fde\u63a5\u540e\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\u5360\u7528\u7684\u5185\u5b58\u8d44\u6e90\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5b9a\u671f\u65ad\u5f00\u957f\u8fde\u63a5\u3002 \u7b2c\u4e8c\u79cd\uff0c \u5ba2\u6237\u7aef\u4e3b\u52a8\u91cd\u7f6e\u8fde\u63a5 \u3002MySQL 5.7 \u7248\u672c\u5b9e\u73b0\u4e86 mysql_reset_connection() \u51fd\u6570\u7684\u63a5\u53e3\uff0c\u6ce8\u610f\u8fd9\u662f\u63a5\u53e3\u51fd\u6570\u4e0d\u662f\u547d\u4ee4\uff0c\u90a3\u4e48\u5f53\u5ba2\u6237\u7aef\u6267\u884c\u4e86\u4e00\u4e2a\u5f88\u5927\u7684\u64cd\u4f5c\u540e\uff0c\u5728\u4ee3\u7801\u91cc\u8c03\u7528 mysql_reset_connection \u51fd\u6570\u6765\u91cd\u7f6e\u8fde\u63a5\uff0c\u8fbe\u5230\u91ca\u653e\u5185\u5b58\u7684\u6548\u679c\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u9700\u8981\u91cd\u8fde\u548c\u91cd\u65b0\u505a\u6743\u9650\u9a8c\u8bc1\uff0c\u4f46\u662f\u4f1a\u5c06\u8fde\u63a5\u6062\u590d\u5230\u521a\u521a\u521b\u5efa\u5b8c\u65f6\u7684\u72b6\u6001\u3002 \u81f3\u6b64\uff0c\u8fde\u63a5\u5668\u7684\u5de5\u4f5c\u505a\u5b8c\u4e86\uff0c\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff1a \u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c TCP \u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\uff1b \u6821\u9a8c\u5ba2\u6237\u7aef\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u5bf9\uff0c\u5219\u4f1a\u62a5\u9519\uff1b \u5982\u679c\u7528\u6237\u540d\u548c\u5bc6\u7801\u90fd\u5bf9\u4e86\uff0c\u4f1a\u8bfb\u53d6\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u7136\u540e\u540e\u9762\u7684\u6743\u9650\u903b\u8f91\u5224\u65ad\u90fd\u57fa\u4e8e\u6b64\u65f6\u8bfb\u53d6\u5230\u7684\u6743\u9650\uff1b \u7b2c\u4e8c\u6b65\uff1a\u67e5\u8be2\u7f13\u5b58 \u00b6 \u8fde\u63a5\u5668\u5f97\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u5411 MySQL \u670d\u52a1\u53d1\u9001 SQL \u8bed\u53e5\u4e86\uff0cMySQL \u670d\u52a1\u6536\u5230 SQL \u8bed\u53e5\u540e\uff0c\u5c31\u4f1a\u89e3\u6790\u51fa SQL \u8bed\u53e5\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bb5\uff0c\u770b\u770b\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u8bed\u53e5\u3002 \u5982\u679c SQL \u662f\u67e5\u8be2\u8bed\u53e5\uff08select \u8bed\u53e5\uff09\uff0cMySQL \u5c31\u4f1a\u5148\u53bb\u67e5\u8be2\u7f13\u5b58\uff08 Query Cache \uff09\u91cc\u67e5\u627e\u7f13\u5b58\u6570\u636e\uff0c\u770b\u770b\u4e4b\u524d\u6709\u6ca1\u6709\u6267\u884c\u8fc7\u8fd9\u4e00\u6761\u547d\u4ee4\uff0c\u8fd9\u4e2a\u67e5\u8be2\u7f13\u5b58\u662f\u4ee5 key-value \u5f62\u5f0f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0ckey \u4e3a SQL \u67e5\u8be2\u8bed\u53e5\uff0cvalue \u4e3a SQL \u8bed\u53e5\u67e5\u8be2\u7684\u7ed3\u679c\u3002 \u5982\u679c\u67e5\u8be2\u7684\u8bed\u53e5\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\uff0c\u90a3\u4e48\u5c31\u4f1a\u76f4\u63a5\u8fd4\u56de value \u7ed9\u5ba2\u6237\u7aef\u3002\u5982\u679c\u67e5\u8be2\u7684\u8bed\u53e5\u6ca1\u6709\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\u4e2d\uff0c\u90a3\u4e48\u5c31\u8981\u5f80\u4e0b\u7ee7\u7eed\u6267\u884c\uff0c\u7b49\u6267\u884c\u5b8c\u540e\uff0c\u67e5\u8be2\u7684\u7ed3\u679c\u5c31\u4f1a\u88ab\u5b58\u5165\u67e5\u8be2\u7f13\u5b58\u4e2d\u3002 \u8fd9\u4e48\u770b\uff0c\u67e5\u8be2\u7f13\u5b58\u8fd8\u633a\u6709\u7528\uff0c\u4f46\u662f\u5176\u5b9e**\u67e5\u8be2\u7f13\u5b58\u633a\u9e21\u808b**\u7684\u3002 \u5bf9\u4e8e\u66f4\u65b0\u6bd4\u8f83\u9891\u7e41\u7684\u8868\uff0c\u67e5\u8be2\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u5f88\u4f4e\u7684\uff0c\u56e0\u4e3a\u53ea\u8981\u4e00\u4e2a\u8868\u6709\u66f4\u65b0\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8868\u7684\u67e5\u8be2\u7f13\u5b58\u5c31\u4f1a\u88ab\u6e05\u7a7a\u3002\u5982\u679c\u521a\u7f13\u5b58\u4e86\u4e00\u4e2a\u67e5\u8be2\u7ed3\u679c\u5f88\u5927\u7684\u6570\u636e\uff0c\u8fd8\u6ca1\u88ab\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u521a\u597d\u8fd9\u4e2a\u8868\u6709\u66f4\u65b0\u64cd\u4f5c\uff0c\u67e5\u8be2\u7f13\u51b2\u5c31\u88ab\u6e05\u7a7a\u4e86\uff0c\u76f8\u5f53\u4e8e\u7f13\u5b58\u4e86\u4e2a\u5bc2\u5bde\u3002 \u6240\u4ee5\uff0cMySQL 8.0 \u7248\u672c\u76f4\u63a5\u5c06\u67e5\u8be2\u7f13\u5b58\u5220\u6389\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4 MySQL 8.0 \u5f00\u59cb\uff0c\u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u4e0d\u4f1a\u518d\u8d70\u5230\u67e5\u8be2\u7f13\u5b58\u8fd9\u4e2a\u9636\u6bb5\u4e86\u3002 \u5bf9\u4e8e MySQL 8.0 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u5982\u679c\u60f3\u5173\u95ed\u67e5\u8be2\u7f13\u5b58\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u53c2\u6570 query_cache_type \u8bbe\u7f6e\u6210 DEMAND\u3002 ::: tip \u8fd9\u91cc\u8bf4\u7684\u67e5\u8be2\u7f13\u5b58\u662f server \u5c42\u7684\uff0c\u4e5f\u5c31\u662f MySQL 8.0 \u7248\u672c\u79fb\u9664\u7684\u662f server \u5c42\u7684\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u4e0d\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\u7684 buffer pool\u3002 :::: \u7b2c\u4e09\u6b65\uff1a\u89e3\u6790 SQL \u00b6 \u5728\u6b63\u5f0f\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u4e4b\u524d\uff0c MySQL \u4f1a\u5148\u5bf9 SQL \u8bed\u53e5\u505a\u89e3\u6790\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u4ea4\u7531\u300c\u89e3\u6790\u5668\u300d\u6765\u5b8c\u6210\u3002 \u89e3\u6790\u5668 \u00b6 \u89e3\u6790\u5668\u4f1a\u505a\u5982\u4e0b\u4e24\u4ef6\u4e8b\u60c5\u3002 \u7b2c\u4e00\u4ef6\u4e8b\u60c5\uff0c \u8bcd\u6cd5\u5206\u6790 \u3002MySQL \u4f1a\u6839\u636e\u4f60\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u8bc6\u522b\u51fa\u5173\u952e\u5b57\u51fa\u6765\uff0c\u6784\u5efa\u51fa SQL \u8bed\u6cd5\u6811\uff0c\u8fd9\u6837\u65b9\u4fbf\u540e\u9762\u6a21\u5757\u83b7\u53d6 SQL \u7c7b\u578b\u3001\u8868\u540d\u3001\u5b57\u6bb5\u540d\u3001 where \u6761\u4ef6\u7b49\u7b49\u3002 \u7b2c\u4e8c\u4ef6\u4e8b\u60c5\uff0c \u8bed\u6cd5\u5206\u6790 \u3002\u6839\u636e\u8bcd\u6cd5\u5206\u6790\u7684\u7ed3\u679c\uff0c\u8bed\u6cd5\u89e3\u6790\u5668\u4f1a\u6839\u636e\u8bed\u6cd5\u89c4\u5219\uff0c\u5224\u65ad\u4f60\u8f93\u5165\u7684\u8fd9\u4e2a SQL \u8bed\u53e5\u662f\u5426\u6ee1\u8db3 MySQL \u8bed\u6cd5\u3002 \u5982\u679c\u6211\u4eec\u8f93\u5165\u7684 SQL \u8bed\u53e5\u8bed\u6cd5\u4e0d\u5bf9\uff0c\u5c31\u4f1a\u5728\u89e3\u6790\u5668\u8fd9\u4e2a\u9636\u6bb5\u62a5\u9519\u3002\u6bd4\u5982\uff0c\u6211\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u628a from \u5199\u6210\u4e86 form\uff0c\u8fd9\u65f6 MySQL \u89e3\u6790\u5668\u5c31\u4f1a\u7ed9\u62a5\u9519\u3002 \u4f46\u662f\u6ce8\u610f\uff0c\u8868\u4e0d\u5b58\u5728\u6216\u8005\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u5e76\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\uff0c\u300aMySQL 45 \u8bb2\u300b\u8bf4\u662f\u5728\u89e3\u6790\u5668\u505a\u7684\uff0c\u4f46\u662f\u7ecf\u8fc7\u6211\u548c\u670b\u53cb\u770b MySQL \u6e90\u7801\uff085.7\u548c8.0\uff09\u5f97\u51fa\u7ed3\u8bba\u662f\u89e3\u6790\u5668\u53ea\u8d1f\u8d23\u6784\u5efa\u8bed\u6cd5\u6811\u548c\u68c0\u67e5\u8bed\u6cd5\uff0c\u4f46\u662f\u4e0d\u4f1a\u53bb\u67e5\u8868\u6216\u8005\u5b57\u6bb5\u5b58\u4e0d\u5b58\u5728\u3002 \u90a3\u5230\u5e95\u8c01\u6765\u505a\u68c0\u6d4b\u8868\u548c\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\u5462\uff1f\u522b\u6025\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4e86\u3002 \u7b2c\u56db\u6b65\uff1a\u6267\u884c SQL \u00b6 \u7ecf\u8fc7\u89e3\u6790\u5668\u540e\uff0c\u63a5\u7740\u5c31\u8981\u8fdb\u5165\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6d41\u7a0b\u4e86\uff0c\u6bcf\u6761 SELECT \u67e5\u8be2\u8bed\u53e5\u6d41\u7a0b\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a\u4e0b\u9762\u8fd9\u4e09\u4e2a\u9636\u6bb5\uff1a prepare \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u9884\u5904\u7406\u9636\u6bb5\uff1b optimize \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u4f18\u5316\u9636\u6bb5\uff1b execute \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u6267\u884c\u9636\u6bb5\uff1b \u9884\u5904\u7406\u5668 \u00b6 \u6211\u4eec\u5148\u6765\u8bf4\u8bf4\u9884\u5904\u7406\u9636\u6bb5\u505a\u4e86\u4ec0\u4e48\u4e8b\u60c5\u3002 \u68c0\u67e5 SQL \u67e5\u8be2\u8bed\u53e5\u4e2d\u7684\u8868\u6216\u8005\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b \u5c06 select * \u4e2d\u7684 * \u7b26\u53f7\uff0c\u6269\u5c55\u4e3a\u8868\u4e0a\u7684\u6240\u6709\u5217\uff1b \u6211\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0ctest \u8fd9\u5f20\u8868\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u8fd9\u65f6 MySQL \u5c31\u4f1a\u5728\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u7684 prepare \u9636\u6bb5\u4e2d\u62a5\u9519\u3002 mysql > select * from test ; ERROR 1146 ( 42 S02 ): Table 'mysql.test' doesn ' t exist \u8fd9\u91cc\u8d34\u4e2a MySQL 8.0 \u6e90\u7801\u6765\u8bc1\u660e\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5224\u65ad\uff0c\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\uff0c\u800c\u662f\u5728 prepare \u9636\u6bb5\u3002\uff08 PS\uff1a\u4e0b\u56fe\u662f\u516c\u4f17\u53f7\u300c\u4e00\u6811\u4e00\u6eaa\u300d\u8001\u54e5\u5e2e\u6211\u5206\u6790\u7684\uff0c\u8fd9\u4f4d\u8001\u54e5\u4e13\u95e8\u5199 MySQL \u6e90\u7801\u6587\u7ae0\uff0c\u611f\u5174\u8da3\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u5fae\u4fe1\u641c\u7d22\u5173\u6ce8 \uff09 \u4e0a\u9762\u7684\u4e2d\u95f4\u90e8\u5206\u662f MySQL \u62a5\u9519\u8868\u4e0d\u5b58\u5728\u65f6\u7684\u51fd\u6570\u8c03\u7528\u6808\uff0c\u53ef\u4ee5\u770b\u5230\u8868\u4e0d\u5b58\u5728\u7684\u9519\u8bef\u662f\u5728get_table_share() \u51fd\u6570\u91cc\u62a5\u9519\u7684\uff0c\u800c\u8fd9\u4e2a\u51fd\u6570\u662f\u5728 prepare \u9636\u6bb5\u8c03\u7528\u7684\u3002 \u4e0d\u8fc7\uff0c\u5bf9\u4e8e MySQL 5.7 \u5224\u65ad\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\uff0c\u662f\u5728\u8bcd\u6cd5\u5206\u6790&\u8bed\u6cd5\u5206\u6790\u4e4b\u540e\uff0cprepare \u9636\u6bb5\u4e4b\u524d\u505a\u7684\u3002\u7ed3\u8bba\u90fd\u4e00\u6837\uff0c\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\u3002\u4ee3\u7801\u6211\u5c31\u4e0d\u653e\u4e86\uff0c\u6b63\u56e0\u4e3a MySQL 5.7 \u4ee3\u7801\u7ed3\u6784\u4e0d\u597d\uff0c\u6240\u4ee5 MySQL 8.0 \u4ee3\u7801\u7ed3\u6784\u53d8\u5316\u5f88\u5927\uff0c\u540e\u6765\u5224\u65ad\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\u5c31\u88ab\u653e\u5165\u5230 prepare \u9636\u6bb5\u505a\u4e86\u3002 \u4f18\u5316\u5668 \u00b6 \u7ecf\u8fc7\u9884\u5904\u7406\u9636\u6bb5\u540e\uff0c\u8fd8\u9700\u8981\u4e3a SQL \u67e5\u8be2\u8bed\u53e5\u5148\u5236\u5b9a\u4e00\u4e2a\u6267\u884c\u8ba1\u5212\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u4ea4\u7531\u300c\u4f18\u5316\u5668\u300d\u6765\u5b8c\u6210\u7684\u3002 \u4f18\u5316\u5668\u4e3b\u8981\u8d1f\u8d23\u5c06 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u65b9\u6848\u786e\u5b9a\u4e0b\u6765 \uff0c\u6bd4\u5982\u5728\u8868\u91cc\u9762\u6709\u591a\u4e2a\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4f18\u5316\u5668\u4f1a\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c\u6765\u51b3\u5b9a\u9009\u62e9\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u672c\u6b21\u7684\u67e5\u8be2\u8bed\u53e5\uff08select * from product where id = 1\uff09\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u9009\u62e9\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u3002 \u8981\u60f3\u77e5\u9053\u4f18\u5316\u5668\u9009\u62e9\u4e86\u54ea\u4e2a\u7d22\u5f15\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u67e5\u8be2\u8bed\u53e5\u6700\u524d\u9762\u52a0\u4e2a explain \u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u4f1a\u8f93\u51fa\u8fd9\u6761 SQL \u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\uff0c\u7136\u540e\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key \u5c31\u8868\u793a\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86\u54ea\u4e2a\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0b\u56fe\u7684 key \u4e3a PRIMARY \u5c31\u662f\u4f7f\u7528\u4e86\u4e3b\u952e\u7d22\u5f15\u3002 \u5982\u679c\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u91cc\u7684 key \u4e3a null \u8bf4\u660e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u90a3\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff08type = ALL\uff09\uff0c\u8fd9\u79cd\u67e5\u8be2\u626b\u63cf\u7684\u65b9\u5f0f\u662f\u6548\u7387\u6700\u4f4e\u6863\u6b21\u7684\uff0c\u5982\u4e0b\u56fe\uff1a \u8fd9\u5f20 product \u8868\u53ea\u6709\u4e00\u4e2a\u7d22\u5f15\u5c31\u662f\u4e3b\u952e\uff0c\u73b0\u5728\u6211\u5728\u8868\u4e2d\u5c06 name \u8bbe\u7f6e\u4e3a\u666e\u901a\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u3002 \u8fd9\u65f6 product \u8868\u5c31\u6709\u4e3b\u952e\u7d22\u5f15\uff08id\uff09\u548c\u666e\u901a\u7d22\u5f15\uff08name\uff09\u3002\u5047\u8bbe\u6267\u884c\u4e86\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a select id from product where id > 1 and name like 'i%' ; \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u7ed3\u679c\u65e2\u53ef\u4ee5\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u666e\u901a\u7d22\u5f15\uff0c\u4f46\u662f\u6267\u884c\u7684\u6548\u7387\u4f1a\u4e0d\u540c\u3002\u8fd9\u65f6\uff0c\u5c31\u9700\u8981\u4f18\u5316\u5668\u6765\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u4e86\u3002 \u5f88\u663e\u7136\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u662f**\u8986\u76d6\u7d22\u5f15**\uff0c\u76f4\u63a5\u5728\u4e8c\u7ea7\u7d22\u5f15\u5c31\u80fd\u67e5\u627e\u5230\u7ed3\u679c\uff08\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6570\u636e\u5b58\u50a8\u7684\u662f\u4e3b\u952e\u503c\uff09\uff0c\u5c31\u6ca1\u5fc5\u8981\u5728\u4e3b\u952e\u7d22\u5f15\u67e5\u627e\u4e86\uff0c\u56e0\u4e3a\u67e5\u8be2\u4e3b\u952e\u7d22\u5f15\u7684 B+ \u6811\u7684\u6210\u672c\u4f1a\u6bd4\u67e5\u8be2\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u7684\u6210\u672c\u5927\uff0c\u4f18\u5316\u5668\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c\u4f1a\u9009\u62e9\u67e5\u8be2\u4ee3\u4ef7\u5c0f\u7684\u666e\u901a\u7d22\u5f15\u3002 \u5728\u4e0b\u56fe\u4e2d\u6267\u884c\u8ba1\u5212\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86\u666e\u901a\u7d22\u5f15\uff08name\uff09\uff0cExta \u4e3a Using index\uff0c\u8fd9\u5c31\u662f\u8868\u660e\u4f7f\u7528\u4e86\u8986\u76d6\u7d22\u5f15\u4f18\u5316\u3002 \u6267\u884c\u5668 \u00b6 \u7ecf\u5386\u5b8c\u4f18\u5316\u5668\u540e\uff0c\u5c31\u786e\u5b9a\u4e86\u6267\u884c\u65b9\u6848\uff0c\u63a5\u4e0b\u6765 MySQL \u5c31\u771f\u6b63\u5f00\u59cb\u6267\u884c\u8bed\u53e5\u4e86\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u662f\u7531\u300c\u6267\u884c\u5668\u300d\u5b8c\u6210\u7684\u3002\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u5668\u5c31\u4f1a\u548c\u5b58\u50a8\u5f15\u64ce\u4ea4\u4e92\u4e86\uff0c\u4ea4\u4e92\u662f\u4ee5\u8bb0\u5f55\u4e3a\u5355\u4f4d\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u7528\u4e09\u79cd\u65b9\u5f0f\u6267\u884c\u8fc7\u7a0b\uff0c\u8ddf\u5927\u5bb6\u8bf4\u4e00\u4e0b\u6267\u884c\u5668\u548c\u5b58\u50a8\u5f15\u64ce\u7684\u4ea4\u4e92\u8fc7\u7a0b\uff08PS \uff1a\u4e3a\u4e86\u5199\u597d\u8fd9\u4e00\u90e8\u5206\uff0c\u7279\u5730\u53bb\u770b MySQL \u6e90\u7801\uff0c\u4e5f\u662f\u7b2c\u4e00\u6b21\u770b\u54c8\u54c8\uff09\u3002 \u4e3b\u952e\u7d22\u5f15\u67e5\u8be2 \u5168\u8868\u626b\u63cf \u7d22\u5f15\u4e0b\u63a8 \u4e3b\u952e\u7d22\u5f15\u67e5\u8be2 \u00b6 \u4ee5\u672c\u6587\u5f00\u5934\u67e5\u8be2\u8bed\u53e5\u4e3a\u4f8b\uff0c\u770b\u770b\u6267\u884c\u5668\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002 select * from product where id = 1 ; \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u6761\u4ef6\u7528\u5230\u4e86\u4e3b\u952e\u7d22\u5f15\uff0c\u800c\u4e14\u662f\u7b49\u503c\u67e5\u8be2\uff0c\u540c\u65f6\u4e3b\u952e id \u662f\u552f\u4e00\uff0c\u4e0d\u4f1a\u6709 id \u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4f18\u5316\u5668\u51b3\u5b9a\u9009\u7528\u8bbf\u95ee\u7c7b\u578b\u4e3a const \u8fdb\u884c\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a \u6267\u884c\u5668\u7b2c\u4e00\u6b21\u67e5\u8be2\uff0c\u4f1a\u8c03\u7528 read_first_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a const\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a InnoDB \u5f15\u64ce\u7d22\u5f15\u67e5\u8be2\u7684\u63a5\u53e3\uff0c\u628a\u6761\u4ef6 id = 1 \u4ea4\u7ed9\u5b58\u50a8\u5f15\u64ce\uff0c \u8ba9\u5b58\u50a8\u5f15\u64ce\u5b9a\u4f4d\u7b26\u5408\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55 \u3002 \u5b58\u50a8\u5f15\u64ce\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u7684 B+ \u6811\u7ed3\u6784\u5b9a\u4f4d\u5230 id = 1\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8bb0\u5f55\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u5c31\u4f1a\u5411\u6267\u884c\u5668\u4e0a\u62a5\u8bb0\u5f55\u627e\u4e0d\u5230\u7684\u9519\u8bef\uff0c\u7136\u540e\u67e5\u8be2\u7ed3\u675f\u3002\u5982\u679c\u8bb0\u5f55\u662f\u5b58\u5728\u7684\uff0c\u5c31\u4f1a\u5c06\u8bb0\u5f55\u8fd4\u56de\u7ed9\u6267\u884c\u5668\uff1b \u6267\u884c\u5668\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u5230\u8bb0\u5f55\u540e\uff0c\u63a5\u7740\u5224\u65ad\u8bb0\u5f55\u662f\u5426\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\uff0c\u5982\u679c\u7b26\u5408\u5219\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u4e0d\u7b26\u5408\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\u3002 \u6267\u884c\u5668\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a while \u5faa\u73af\uff0c\u6240\u4ee5\u8fd8\u4f1a\u518d\u67e5\u4e00\u6b21\uff0c\u4f46\u662f\u8fd9\u6b21\u56e0\u4e3a\u4e0d\u662f\u7b2c\u4e00\u6b21\u67e5\u8be2\u4e86\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528 read_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a const\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a\u4e00\u4e2a\u6c38\u8fdc\u8fd4\u56de - 1 \u7684\u51fd\u6570\uff0c\u6240\u4ee5\u5f53\u8c03\u7528\u8be5\u51fd\u6570\u7684\u65f6\u5019\uff0c\u6267\u884c\u5668\u5c31\u9000\u51fa\u5faa\u73af\uff0c\u4e5f\u5c31\u662f\u7ed3\u675f\u67e5\u8be2\u4e86\u3002 \u81f3\u6b64\uff0c\u8fd9\u4e2a\u8bed\u53e5\u5c31\u6267\u884c\u5b8c\u6210\u4e86\u3002 \u5168\u8868\u626b\u63cf \u00b6 \u4e3e\u4e2a\u5168\u8868\u626b\u63cf\u7684\u4f8b\u5b50\uff1a select * from product where name = 'iphone'; \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\uff0c\u6240\u4ee5\u4f18\u5316\u5668\u51b3\u5b9a\u9009\u7528\u8bbf\u95ee\u7c7b\u578b\u4e3a ALL \u8fdb\u884c\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\uff0c\u90a3\u4e48\u8fd9\u65f6\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a \u6267\u884c\u5668\u7b2c\u4e00\u6b21\u67e5\u8be2\uff0c\u4f1a\u8c03\u7528 read_first_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a all\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a InnoDB \u5f15\u64ce\u5168\u626b\u63cf\u7684\u63a5\u53e3\uff0c \u8ba9\u5b58\u50a8\u5f15\u64ce\u8bfb\u53d6\u8868\u4e2d\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55 \uff1b \u6267\u884c\u5668\u4f1a\u5224\u65ad\u8bfb\u5230\u7684\u8fd9\u6761\u8bb0\u5f55\u7684 name \u662f\u4e0d\u662f iphone\uff0c\u5982\u679c\u4e0d\u662f\u5219\u8df3\u8fc7\uff1b\u5982\u679c\u662f\u5219\u5c06\u8bb0\u5f55\u53d1\u7ed9\u5ba2\u6237\u7684\uff08\u662f\u7684\u6ca1\u9519\uff0cServer \u5c42\u6bcf\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u5230\u4e00\u6761\u8bb0\u5f55\u5c31\u4f1a\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e4b\u6240\u4ee5\u5ba2\u6237\u7aef\u663e\u793a\u7684\u65f6\u5019\u662f\u76f4\u63a5\u663e\u793a\u6240\u6709\u8bb0\u5f55\u7684\uff0c\u662f\u56e0\u4e3a\u5ba2\u6237\u7aef\u662f\u7b49\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u663e\u793a\u51fa\u6240\u6709\u7684\u8bb0\u5f55\uff09\u3002 \u6267\u884c\u5668\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a while \u5faa\u73af\uff0c\u6240\u4ee5\u8fd8\u4f1a\u518d\u67e5\u4e00\u6b21\uff0c\u4f1a\u8c03\u7528 read_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a all\uff0cread_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u8fd8\u662f InnoDB \u5f15\u64ce\u5168\u626b\u63cf\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u63a5\u7740\u5411\u5b58\u50a8\u5f15\u64ce\u5c42\u8981\u6c42\u7ee7\u7eed\u8bfb\u521a\u624d\u90a3\u6761\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u5b58\u50a8\u5f15\u64ce\u628a\u4e0b\u4e00\u6761\u8bb0\u5f55\u53d6\u51fa\u540e\u5c31\u5c06\u5176\u8fd4\u56de\u7ed9\u6267\u884c\u5668\uff08Server\u5c42\uff09\uff0c\u6267\u884c\u5668\u7ee7\u7eed\u5224\u65ad\u6761\u4ef6\uff0c\u4e0d\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u5373\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff0c\u5426\u5219\u53d1\u9001\u5230\u5ba2\u6237\u7aef\uff1b \u4e00\u76f4\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\uff0c\u7136\u540e\u5411\u6267\u884c\u5668\uff08Server\u5c42\uff09 \u8fd4\u56de\u4e86\u8bfb\u53d6\u5b8c\u6bd5\u7684\u4fe1\u606f\uff1b \u6267\u884c\u5668\u6536\u5230\u5b58\u50a8\u5f15\u64ce\u62a5\u544a\u7684\u67e5\u8be2\u5b8c\u6bd5\u7684\u4fe1\u606f\uff0c\u9000\u51fa\u5faa\u73af\uff0c\u505c\u6b62\u67e5\u8be2\u3002 \u81f3\u6b64\uff0c\u8fd9\u4e2a\u8bed\u53e5\u5c31\u6267\u884c\u5b8c\u6210\u4e86\u3002 \u7d22\u5f15\u4e0b\u63a8 \u00b6 \u5728\u8fd9\u90e8\u5206\u975e\u5e38\u9002\u5408\u8bb2\u7d22\u5f15\u4e0b\u63a8\uff08MySQL 5.6 \u63a8\u51fa\u7684\u67e5\u8be2\u4f18\u5316\u7b56\u7565\uff09\uff0c\u8fd9\u6837\u5927\u5bb6\u80fd\u6e05\u695a\u7684\u77e5\u9053\uff0c\u300c\u4e0b\u63a8\u300d\u8fd9\u4e2a\u52a8\u4f5c\uff0c\u4e0b\u63a8\u5230\u4e86\u54ea\u91cc\u3002 \u7d22\u5f15\u4e0b\u63a8\u80fd\u591f\u51cf\u5c11**\u4e8c\u7ea7\u7d22\u5f15**\u5728\u67e5\u8be2\u65f6\u7684\u56de\u8868\u64cd\u4f5c\uff0c\u63d0\u9ad8\u67e5\u8be2\u7684\u6548\u7387\uff0c\u56e0\u4e3a\u5b83\u5c06 Server \u5c42\u90e8\u5206\u8d1f\u8d23\u7684\u4e8b\u60c5\uff0c\u4ea4\u7ed9\u5b58\u50a8\u5f15\u64ce\u5c42\u53bb\u5904\u7406\u4e86\u3002 \u4e3e\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff0c\u8fd9\u91cc\u4e00\u5f20\u7528\u6237\u8868\u5982\u4e0b\uff0c\u6211\u5bf9 age \u548c reward \u5b57\u6bb5\u5efa\u7acb\u4e86\u8054\u5408\u7d22\u5f15\uff08age\uff0creward\uff09\uff1a \u73b0\u5728\u6709\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a select * from t_user where age > 20 and reward = 100000 ; \u8054\u5408\u7d22\u5f15\u5f53\u9047\u5230\u8303\u56f4\u67e5\u8be2 (>\u3001<) \u5c31\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u4e5f\u5c31\u662f age \u5b57\u6bb5\u80fd\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f reward \u5b57\u6bb5\u5219\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15 \u3002\u5177\u4f53\u539f\u56e0\u8fd9\u91cc\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a \u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898 \u90a3\u4e48\uff0c\u4e0d\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\uff08MySQL 5.6 \u4e4b\u524d\u7684\u7248\u672c\uff09\u65f6\uff0c\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a Server \u5c42\u9996\u5148\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\u5b9a\u4f4d\u5230\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5b9a\u4f4d\u5230 age > 20 \u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1b \u5b58\u50a8\u5f15\u64ce\u6839\u636e\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5feb\u901f\u5b9a\u4f4d\u5230\u8fd9\u6761\u8bb0\u5f55\u540e\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e**\u8fdb\u884c\u56de\u8868\u64cd\u4f5c**\uff0c\u5c06\u5b8c\u6574\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\uff1b Server \u5c42\u5728\u5224\u65ad\u8be5\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000\uff0c\u5982\u679c\u6210\u7acb\u5219\u5c06\u5176\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff1b\u5426\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff1b \u63a5\u7740\uff0c\u7ee7\u7eed\u5411\u5b58\u50a8\u5f15\u64ce\u7d22\u8981\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u5b58\u50a8\u5f15\u64ce\u5728\u4e8c\u7ea7\u7d22\u5f15\u5b9a\u4f4d\u5230\u8bb0\u5f55\u540e\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e\u56de\u8868\u64cd\u4f5c\uff0c\u5c06\u5b8c\u6574\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\uff1b \u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u6ca1\u6709\u7d22\u5f15\u4e0b\u63a8\u7684\u65f6\u5019\uff0c\u6bcf\u67e5\u8be2\u5230\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u90fd\u8981\u8fdb\u884c\u56de\u8868\u64cd\u4f5c\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server\uff0c\u63a5\u7740 Server \u518d\u5224\u65ad\u8be5\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000\u3002 \u800c\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\u540e\uff0c\u5224\u65ad\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000 \u7684\u5de5\u4f5c\u4ea4\u7ed9\u4e86\u5b58\u50a8\u5f15\u64ce\u5c42\uff0c\u8fc7\u7a0b\u5982\u4e0b \uff1a Server \u5c42\u9996\u5148\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\u5b9a\u4f4d\u5230\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5b9a\u4f4d\u5230 age > 20 \u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1b \u5b58\u50a8\u5f15\u64ce\u5b9a\u4f4d\u5230\u4e8c\u7ea7\u7d22\u5f15\u540e\uff0c \u5148\u4e0d\u6267\u884c\u56de\u8868**\u64cd\u4f5c\uff0c\u800c\u662f\u5148\u5224\u65ad\u4e00\u4e0b\u8be5\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5217\uff08reward\u5217\uff09\u7684\u6761\u4ef6\uff08reward \u662f\u5426\u7b49\u4e8e 100000\uff09\u662f\u5426\u6210\u7acb\u3002\u5982\u679c**\u6761\u4ef6\u4e0d\u6210\u7acb \uff0c\u5219\u76f4\u63a5**\u8df3\u8fc7\u8be5\u4e8c\u7ea7\u7d22\u5f15**\u3002\u5982\u679c**\u6210\u7acb**\uff0c\u5219**\u6267\u884c\u56de\u8868**\u64cd\u4f5c\uff0c\u5c06\u5b8c\u6210\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\u3002 Server \u5c42\u5728\u5224\u65ad\u5176\u4ed6\u7684\u67e5\u8be2\u6761\u4ef6\uff08\u672c\u6b21\u67e5\u8be2\u6ca1\u6709\u5176\u4ed6\u6761\u4ef6\uff09\u662f\u5426\u6210\u7acb\uff0c\u5982\u679c\u6210\u7acb\u5219\u5c06\u5176\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff1b\u5426\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff0c\u7136\u540e\u5411\u5b58\u50a8\u5f15\u64ce\u7d22\u8981\u4e0b\u4e00\u6761\u8bb0\u5f55\u3002 \u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u540e\uff0c\u867d\u7136 reward \u5217\u65e0\u6cd5\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u56e0\u4e3a\u5b83\u5305\u542b\u5728\u8054\u5408\u7d22\u5f15\uff08age\uff0creward\uff09\u91cc\uff0c\u6240\u4ee5\u76f4\u63a5\u5728\u5b58\u50a8\u5f15\u64ce\u8fc7\u6ee4\u51fa\u6ee1\u8db3 reward = 100000 \u7684\u8bb0\u5f55\u540e\uff0c\u624d\u53bb\u6267\u884c\u56de\u8868\u64cd\u4f5c\u83b7\u53d6\u6574\u4e2a\u8bb0\u5f55\u3002\u76f8\u6bd4\u4e8e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\uff0c\u8282\u7701\u4e86\u5f88\u591a\u56de\u8868\u64cd\u4f5c\u3002 \u5f53\u4f60\u53d1\u73b0\u6267\u884c\u8ba1\u5212\u91cc\u7684 Extr \u90e8\u5206\u663e\u793a\u4e86 \u201cUsing index condition\u201d\uff0c\u8bf4\u660e\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u3002 \u603b\u7ed3 \u00b6 \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \u8fde\u63a5\u5668\uff1a\u5efa\u7acb\u8fde\u63a5\uff0c\u7ba1\u7406\u8fde\u63a5\u3001\u6821\u9a8c\u7528\u6237\u8eab\u4efd\uff1b \u67e5\u8be2\u7f13\u5b58\uff1a\u67e5\u8be2\u8bed\u53e5\u5982\u679c\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5426\u5219\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\u3002MySQL 8.0 \u5df2\u5220\u9664\u8be5\u6a21\u5757\uff1b \u89e3\u6790 SQL\uff0c\u901a\u8fc7\u89e3\u6790\u5668\u5bf9 SQL \u67e5\u8be2\u8bed\u53e5\u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\uff0c\u7136\u540e\u6784\u5efa\u8bed\u6cd5\u6811\uff0c\u65b9\u4fbf\u540e\u7eed\u6a21\u5757\u8bfb\u53d6\u8868\u540d\u3001\u5b57\u6bb5\u3001\u8bed\u53e5\u7c7b\u578b\uff1b \u6267\u884c SQL\uff1a\u6267\u884c SQL \u5171\u6709\u4e09\u4e2a\u9636\u6bb5\uff1a \u9884\u5904\u7406\u9636\u6bb5\uff1a\u68c0\u67e5\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b\u5c06 select * \u4e2d\u7684 * \u7b26\u53f7\u6269\u5c55\u4e3a\u8868\u4e0a\u7684\u6240\u6709\u5217\u3002 \u4f18\u5316\u9636\u6bb5\uff1a\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c \u9009\u62e9\u67e5\u8be2\u6210\u672c\u6700\u5c0f\u7684\u6267\u884c\u8ba1\u5212\uff1b \u6267\u884c\u9636\u6bb5\uff1a\u6839\u636e\u6267\u884c\u8ba1\u5212\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u53d6\u8bb0\u5f55\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff1b \u600e\u4e48\u6837\uff1f\u73b0\u5728\u518d\u770b\u8fd9\u5f20\u56fe\uff0c\u662f\u4e0d\u662f\u5f88\u6e05\u6670\u4e86\u3002 \u5b8c\uff01 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL 45 \u8bb2\u300b \u300aMySQL\u662f\u600e\u6837\u8fd0\u884c\u7684\uff1a\u4ece\u6839\u513f\u4e0a\u7406\u89e3MySQL\u300b https://gohalo.me/post/mysql-executor.html http://www.iskm.org/mysql56/sql__executor_8cc_source.html https://tangocc.github.io/2018/10/11/mysql-sourcecode/ \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f"},{"location":"mysql/base/how_select/#select","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5b66\u4e60 SQL \u7684\u65f6\u5019\uff0c\u5927\u5bb6\u80af\u5b9a\u7b2c\u4e00\u4e2a\u5148\u5b66\u5230\u7684\u5c31\u662f select \u67e5\u8be2\u8bed\u53e5\u4e86\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u53e5\u67e5\u8be2\u8bed\u53e5\uff1a // \u5728 product \u8868\u4e2d\uff0c\u67e5\u8be2 id = 1 \u7684\u8bb0\u5f55 select * from product where id = 1 ; \u4f46\u662f\u6709\u6ca1\u6709\u60f3\u8fc7\uff0c MySQL \u6267\u884c\u4e00\u6761 select \u67e5\u8be2\u8bed\u53e5\uff0c\u5728 MySQL \u4e2d\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u597d\u7684\u4e86\u89e3 MySQL \u5185\u90e8\u7684\u67b6\u6784\uff0c\u6240\u4ee5\u8fd9\u6b21\u5c0f\u6797\u5c31\u5e26\u5927\u5bb6\u62c6\u89e3\u4e00\u4e0b MySQL \u5185\u90e8\u7684\u7ed3\u6784\uff0c\u770b\u770b\u5185\u90e8\u91cc\u7684\u6bcf\u4e00\u4e2a\u201c\u96f6\u4ef6\u201d\u5177\u4f53\u662f\u8d1f\u8d23\u505a\u4ec0\u4e48\u7684\u3002","title":"\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f"},{"location":"mysql/base/how_select/#mysql","text":"\u5148\u6765\u4e00\u4e2a\u4e0a\u5e1d\u89c6\u89d2\u56fe\uff0c\u4e0b\u9762\u5c31\u662f MySQL \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6d41\u7a0b\uff0c\u4e5f\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230 MySQL \u5185\u90e8\u67b6\u6784\u91cc\u7684\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u3002 \u53ef\u4ee5\u770b\u5230\uff0c MySQL \u7684\u67b6\u6784\u5171\u5206\u4e3a\u4e24\u5c42\uff1a Server \u5c42\u548c\u5b58\u50a8\u5f15\u64ce\u5c42 \uff0c Server \u5c42\u8d1f\u8d23\u5efa\u7acb\u8fde\u63a5\u3001\u5206\u6790\u548c\u6267\u884c SQL \u3002MySQL \u5927\u591a\u6570\u7684\u6838\u5fc3\u529f\u80fd\u6a21\u5757\u90fd\u5728\u8fd9\u5b9e\u73b0\uff0c\u4e3b\u8981\u5305\u62ec\u8fde\u63a5\u5668\uff0c\u67e5\u8be2\u7f13\u5b58\u3001\u89e3\u6790\u5668\u3001\u9884\u5904\u7406\u5668\u3001\u4f18\u5316\u5668\u3001\u6267\u884c\u5668\u7b49\u3002\u53e6\u5916\uff0c\u6240\u6709\u7684\u5185\u7f6e\u51fd\u6570\uff08\u5982\u65e5\u671f\u3001\u65f6\u95f4\u3001\u6570\u5b66\u548c\u52a0\u5bc6\u51fd\u6570\u7b49\uff09\u548c\u6240\u6709\u8de8\u5b58\u50a8\u5f15\u64ce\u7684\u529f\u80fd\uff08\u5982\u5b58\u50a8\u8fc7\u7a0b\u3001\u89e6\u53d1\u5668\u3001\u89c6\u56fe\u7b49\u3002\uff09\u90fd\u5728 Server \u5c42\u5b9e\u73b0\u3002 \u5b58\u50a8\u5f15\u64ce\u5c42\u8d1f\u8d23\u6570\u636e\u7684\u5b58\u50a8\u548c\u63d0\u53d6 \u3002\u652f\u6301 InnoDB\u3001MyISAM\u3001Memory \u7b49\u591a\u4e2a\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u5171\u7528\u4e00\u4e2a Server \u5c42\u3002\u73b0\u5728\u6700\u5e38\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u662f InnoDB\uff0c\u4ece MySQL 5.5 \u7248\u672c\u5f00\u59cb\uff0c InnoDB \u6210\u4e3a\u4e86 MySQL \u7684\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\u3002\u6211\u4eec\u5e38\u8bf4\u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u5c31\u662f\u7531\u5b58\u50a8\u5f15\u64ce\u5c42\u5b9e\u73b0\u7684\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u4e5f\u4e0d\u76f8\u540c\uff0c\u6bd4\u5982 InnoDB \u652f\u6301\u7d22\u5f15\u7c7b\u578b\u662f B+\u6811 \uff0c\u4e14\u662f\u9ed8\u8ba4\u4f7f\u7528\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u6570\u636e\u8868\u4e2d\u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+ \u6811\u7d22\u5f15\u3002 \u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5bf9 Server \u5c42\u548c\u5b58\u50a8\u5f15\u64ce\u5c42\u6709\u4e86\u4e00\u4e2a\u7b80\u5355\u8ba4\u8bc6\uff0c\u63a5\u4e0b\u6765\uff0c\u5c31\u8be6\u7ec6\u8bf4\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u4f9d\u6b21\u770b\u770b\u6bcf\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u7684\u4f5c\u7528\u3002","title":"MySQL \u6267\u884c\u6d41\u7a0b\u662f\u600e\u6837\u7684\uff1f"},{"location":"mysql/base/how_select/#_1","text":"\u5982\u679c\u4f60\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u91cc\u8981\u4f7f\u7528 MySQL\uff0c\u90a3\u4f60\u7b2c\u4e00\u6b65\u80af\u5b9a\u662f\u8981\u5148\u8fde\u63a5 MySQL \u670d\u52a1\uff0c\u7136\u540e\u624d\u80fd\u6267\u884c SQL \u8bed\u53e5\uff0c\u666e\u904d\u6211\u4eec\u90fd\u662f\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\u8fdb\u884c\u8fde\u63a5\uff1a # -h \u6307\u5b9a MySQL \u670d\u52a1\u5f97 IP \u5730\u5740\uff0c\u5982\u679c\u662f\u8fde\u63a5\u672c\u5730\u7684 MySQL\u670d\u52a1\uff0c\u53ef\u4ee5\u4e0d\u7528\u8fd9\u4e2a\u53c2\u6570\uff1b # -u \u6307\u5b9a\u7528\u6237\u540d\uff0c\u7ba1\u7406\u5458\u89d2\u8272\u540d\u4e3a root\uff1b # -p \u6307\u5b9a\u5bc6\u7801\uff0c\u5982\u679c\u547d\u4ee4\u884c\u4e2d\u4e0d\u586b\u5199\u5bc6\u7801\uff08\u4e3a\u4e86\u5bc6\u7801\u5b89\u5168\uff0c\u5efa\u8bae\u4e0d\u8981\u5728\u547d\u4ee4\u884c\u5199\u5bc6\u7801\uff09\uff0c\u5c31\u9700\u8981\u5728\u4ea4\u4e92\u5bf9\u8bdd\u91cc\u9762\u8f93\u5165\u5bc6\u7801 mysql -h $ip -u $user -p \u8fde\u63a5\u7684\u8fc7\u7a0b\u9700\u8981\u5148\u7ecf\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\uff0c\u56e0\u4e3a MySQL \u662f\u57fa\u4e8e TCP \u534f\u8bae\u8fdb\u884c\u4f20\u8f93\u7684\uff0c\u5982\u679c MySQL \u670d\u52a1\u5e76\u6ca1\u6709\u542f\u52a8\uff0c\u5219\u4f1a\u6536\u5230\u5982\u4e0b\u7684\u62a5\u9519\uff1a \u5982\u679c MySQL \u670d\u52a1\u6b63\u5e38\u8fd0\u884c\uff0c\u5b8c\u6210 TCP \u8fde\u63a5\u7684\u5efa\u7acb\u540e\uff0c\u8fde\u63a5\u5668\u5c31\u8981\u5f00\u59cb\u9a8c\u8bc1\u4f60\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u5bf9\uff0c\u5c31\u6536\u5230\u4e00\u4e2a\"Access denied for user\"\u7684\u9519\u8bef\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7ed3\u675f\u6267\u884c\u3002 \u5982\u679c\u7528\u6237\u5bc6\u7801\u90fd\u6ca1\u6709\u95ee\u9898\uff0c\u8fde\u63a5\u5668\u5c31\u4f1a\u83b7\u53d6\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u7136\u540e\u4fdd\u5b58\u8d77\u6765\uff0c\u540e\u7eed\u8be5\u7528\u6237\u5728\u6b64\u8fde\u63a5\u91cc\u7684\u4efb\u4f55\u64cd\u4f5c\uff0c\u90fd\u4f1a\u57fa\u4e8e\u8fde\u63a5\u5f00\u59cb\u65f6\u8bfb\u5230\u7684\u6743\u9650\u8fdb\u884c\u6743\u9650\u903b\u8f91\u7684\u5224\u65ad\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u4e00\u4e2a\u7528\u6237\u5df2\u7ecf\u5efa\u7acb\u4e86\u8fde\u63a5\uff0c\u5373\u4f7f\u7ba1\u7406\u5458\u4e2d\u9014\u4fee\u6539\u4e86\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5df2\u7ecf\u5b58\u5728\u8fde\u63a5\u7684\u6743\u9650\u3002\u4fee\u6539\u5b8c\u6210\u540e\uff0c\u53ea\u6709\u518d\u65b0\u5efa\u7684\u8fde\u63a5\u624d\u4f1a\u4f7f\u7528\u65b0\u7684\u6743\u9650\u8bbe\u7f6e\u3002 \u5982\u4f55\u67e5\u770b MySQL \u670d\u52a1\u88ab\u591a\u5c11\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e86\uff1f \u5982\u679c\u4f60\u60f3\u77e5\u9053\u5f53\u524d MySQL \u670d\u52a1\u88ab\u591a\u5c11\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e86\uff0c\u4f60\u53ef\u4ee5\u6267\u884c show processlist \u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u3002 \u6bd4\u5982\u4e0a\u56fe\u7684\u663e\u793a\u7ed3\u679c\uff0c\u5171\u6709\u4e24\u4e2a\u7528\u6237\u540d\u4e3a root \u7684\u7528\u6237\u8fde\u63a5\u4e86 MySQL \u670d\u52a1\uff0c\u5176\u4e2d id \u4e3a 6 \u7684\u7528\u6237\u7684 Command \u5217\u7684\u72b6\u6001\u4e3a Sleep \uff0c\u8fd9\u610f\u5473\u7740\u8be5\u7528\u6237\u8fde\u63a5\u5b8c MySQL \u670d\u52a1\u5c31\u6ca1\u6709\u518d\u6267\u884c\u8fc7\u4efb\u4f55\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u662f\u4e00\u4e2a\u7a7a\u95f2\u7684\u8fde\u63a5\uff0c\u5e76\u4e14\u7a7a\u95f2\u7684\u65f6\u957f\u662f 736 \u79d2\uff08 Time \u5217\uff09\u3002 \u7a7a\u95f2\u8fde\u63a5\u4f1a\u4e00\u76f4\u5360\u7528\u7740\u5417\uff1f \u5f53\u7136\u4e0d\u662f\u4e86\uff0cMySQL \u5b9a\u4e49\u4e86\u7a7a\u95f2\u8fde\u63a5\u7684\u6700\u5927\u7a7a\u95f2\u65f6\u957f\uff0c\u7531 wait_timeout \u53c2\u6570\u63a7\u5236\u7684\uff0c\u9ed8\u8ba4\u503c\u662f 8 \u5c0f\u65f6\uff0828880\u79d2\uff09\uff0c\u5982\u679c\u7a7a\u95f2\u8fde\u63a5\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u65f6\u95f4\uff0c\u8fde\u63a5\u5668\u5c31\u4f1a\u81ea\u52a8\u5c06\u5b83\u65ad\u5f00\u3002 mysql > show variables like 'wait_timeout' ; + ---------------+-------+ | Variable_name | Value | + ---------------+-------+ | wait_timeout | 28800 | + ---------------+-------+ 1 row in set ( 0 . 00 sec ) \u5f53\u7136\uff0c\u6211\u4eec\u81ea\u5df1\u4e5f\u53ef\u4ee5\u624b\u52a8\u65ad\u5f00\u7a7a\u95f2\u7684\u8fde\u63a5\uff0c\u4f7f\u7528\u7684\u662f kill connection + id \u7684\u547d\u4ee4\u3002 mysql > kill connection + 6 ; Query OK , 0 rows affected ( 0 . 00 sec ) \u4e00\u4e2a\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u7684\u8fde\u63a5\u88ab\u670d\u52a1\u7aef\u4e3b\u52a8\u65ad\u5f00\u540e\uff0c\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u77e5\u9053\uff0c\u7b49\u5230\u5ba2\u6237\u7aef\u5728\u53d1\u8d77\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u6536\u5230\u8fd9\u6837\u7684\u62a5\u9519\u201cERROR 2013 (HY000): Lost connection to MySQL server during query\u201d\u3002 MySQL \u7684\u8fde\u63a5\u6570\u6709\u9650\u5236\u5417\uff1f MySQL \u670d\u52a1\u652f\u6301\u7684\u6700\u5927\u8fde\u63a5\u6570\u7531 max_connections \u53c2\u6570\u63a7\u5236\uff0c\u6bd4\u5982\u6211\u7684 MySQL \u670d\u52a1\u9ed8\u8ba4\u662f 151 \u4e2a,\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u7cfb\u7edf\u5c31\u4f1a\u62d2\u7edd\u63a5\u4e0b\u6765\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u5e76\u62a5\u9519\u63d0\u793a\u201cToo many connections\u201d\u3002 mysql > show variables like 'max_connections' ; + -----------------+-------+ | Variable_name | Value | + -----------------+-------+ | max_connections | 151 | + -----------------+-------+ 1 row in set ( 0 . 00 sec ) MySQL \u7684\u8fde\u63a5\u4e5f\u8ddf HTTP \u4e00\u6837\uff0c\u6709\u77ed\u8fde\u63a5\u548c\u957f\u8fde\u63a5\u7684\u6982\u5ff5\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5982\u4e0b\uff1a // \u77ed\u8fde\u63a5 \u8fde\u63a5 mysql \u670d\u52a1 \uff08 TCP \u4e09\u6b21\u63e1\u624b \uff09 \u6267\u884csql \u65ad\u5f00 mysql \u670d\u52a1 \uff08 TCP \u56db\u6b21\u6325\u624b \uff09 // \u957f\u8fde\u63a5 \u8fde\u63a5 mysql \u670d\u52a1 \uff08 TCP \u4e09\u6b21\u63e1\u624b \uff09 \u6267\u884csql \u6267\u884csql \u6267\u884csql .... \u65ad\u5f00 mysql \u670d\u52a1 \uff08 TCP \u56db\u6b21\u6325\u624b \uff09 \u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u957f\u8fde\u63a5\u7684\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u51cf\u5c11\u5efa\u7acb\u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u4e00\u822c\u662f\u63a8\u8350\u4f7f\u7528\u957f\u8fde\u63a5\u3002 \u4f46\u662f\uff0c\u4f7f\u7528\u957f\u8fde\u63a5\u540e\u53ef\u80fd\u4f1a\u5360\u7528\u5185\u5b58\u589e\u591a\uff0c\u56e0\u4e3a MySQL \u5728\u6267\u884c\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4e34\u65f6\u4f7f\u7528\u5185\u5b58\u7ba1\u7406\u8fde\u63a5\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u8fde\u63a5\u5bf9\u8c61\u8d44\u6e90\u53ea\u6709\u5728\u8fde\u63a5\u65ad\u5f00\u65f6\u624d\u4f1a\u91ca\u653e\u3002\u5982\u679c\u957f\u8fde\u63a5\u7d2f\u8ba1\u5f88\u591a\uff0c\u5c06\u5bfc\u81f4 MySQL \u670d\u52a1\u5360\u7528\u5185\u5b58\u592a\u5927\uff0c\u6709\u53ef\u80fd\u4f1a\u88ab\u7cfb\u7edf\u5f3a\u5236\u6740\u6389\uff0c\u8fd9\u6837\u4f1a\u53d1\u751f MySQL \u670d\u52a1\u5f02\u5e38\u91cd\u542f\u7684\u73b0\u8c61\u3002 \u600e\u4e48\u89e3\u51b3\u957f\u8fde\u63a5\u5360\u7528\u5185\u5b58\u7684\u95ee\u9898\uff1f \u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u5f0f\u3002 \u7b2c\u4e00\u79cd\uff0c \u5b9a\u671f\u65ad\u5f00\u957f\u8fde\u63a5 \u3002\u65e2\u7136\u65ad\u5f00\u8fde\u63a5\u540e\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\u5360\u7528\u7684\u5185\u5b58\u8d44\u6e90\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5b9a\u671f\u65ad\u5f00\u957f\u8fde\u63a5\u3002 \u7b2c\u4e8c\u79cd\uff0c \u5ba2\u6237\u7aef\u4e3b\u52a8\u91cd\u7f6e\u8fde\u63a5 \u3002MySQL 5.7 \u7248\u672c\u5b9e\u73b0\u4e86 mysql_reset_connection() \u51fd\u6570\u7684\u63a5\u53e3\uff0c\u6ce8\u610f\u8fd9\u662f\u63a5\u53e3\u51fd\u6570\u4e0d\u662f\u547d\u4ee4\uff0c\u90a3\u4e48\u5f53\u5ba2\u6237\u7aef\u6267\u884c\u4e86\u4e00\u4e2a\u5f88\u5927\u7684\u64cd\u4f5c\u540e\uff0c\u5728\u4ee3\u7801\u91cc\u8c03\u7528 mysql_reset_connection \u51fd\u6570\u6765\u91cd\u7f6e\u8fde\u63a5\uff0c\u8fbe\u5230\u91ca\u653e\u5185\u5b58\u7684\u6548\u679c\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u9700\u8981\u91cd\u8fde\u548c\u91cd\u65b0\u505a\u6743\u9650\u9a8c\u8bc1\uff0c\u4f46\u662f\u4f1a\u5c06\u8fde\u63a5\u6062\u590d\u5230\u521a\u521a\u521b\u5efa\u5b8c\u65f6\u7684\u72b6\u6001\u3002 \u81f3\u6b64\uff0c\u8fde\u63a5\u5668\u7684\u5de5\u4f5c\u505a\u5b8c\u4e86\uff0c\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff1a \u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c TCP \u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\uff1b \u6821\u9a8c\u5ba2\u6237\u7aef\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u5bf9\uff0c\u5219\u4f1a\u62a5\u9519\uff1b \u5982\u679c\u7528\u6237\u540d\u548c\u5bc6\u7801\u90fd\u5bf9\u4e86\uff0c\u4f1a\u8bfb\u53d6\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u7136\u540e\u540e\u9762\u7684\u6743\u9650\u903b\u8f91\u5224\u65ad\u90fd\u57fa\u4e8e\u6b64\u65f6\u8bfb\u53d6\u5230\u7684\u6743\u9650\uff1b","title":"\u7b2c\u4e00\u6b65\uff1a\u8fde\u63a5\u5668"},{"location":"mysql/base/how_select/#_2","text":"\u8fde\u63a5\u5668\u5f97\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u5411 MySQL \u670d\u52a1\u53d1\u9001 SQL \u8bed\u53e5\u4e86\uff0cMySQL \u670d\u52a1\u6536\u5230 SQL \u8bed\u53e5\u540e\uff0c\u5c31\u4f1a\u89e3\u6790\u51fa SQL \u8bed\u53e5\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bb5\uff0c\u770b\u770b\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u8bed\u53e5\u3002 \u5982\u679c SQL \u662f\u67e5\u8be2\u8bed\u53e5\uff08select \u8bed\u53e5\uff09\uff0cMySQL \u5c31\u4f1a\u5148\u53bb\u67e5\u8be2\u7f13\u5b58\uff08 Query Cache \uff09\u91cc\u67e5\u627e\u7f13\u5b58\u6570\u636e\uff0c\u770b\u770b\u4e4b\u524d\u6709\u6ca1\u6709\u6267\u884c\u8fc7\u8fd9\u4e00\u6761\u547d\u4ee4\uff0c\u8fd9\u4e2a\u67e5\u8be2\u7f13\u5b58\u662f\u4ee5 key-value \u5f62\u5f0f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0ckey \u4e3a SQL \u67e5\u8be2\u8bed\u53e5\uff0cvalue \u4e3a SQL \u8bed\u53e5\u67e5\u8be2\u7684\u7ed3\u679c\u3002 \u5982\u679c\u67e5\u8be2\u7684\u8bed\u53e5\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\uff0c\u90a3\u4e48\u5c31\u4f1a\u76f4\u63a5\u8fd4\u56de value \u7ed9\u5ba2\u6237\u7aef\u3002\u5982\u679c\u67e5\u8be2\u7684\u8bed\u53e5\u6ca1\u6709\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\u4e2d\uff0c\u90a3\u4e48\u5c31\u8981\u5f80\u4e0b\u7ee7\u7eed\u6267\u884c\uff0c\u7b49\u6267\u884c\u5b8c\u540e\uff0c\u67e5\u8be2\u7684\u7ed3\u679c\u5c31\u4f1a\u88ab\u5b58\u5165\u67e5\u8be2\u7f13\u5b58\u4e2d\u3002 \u8fd9\u4e48\u770b\uff0c\u67e5\u8be2\u7f13\u5b58\u8fd8\u633a\u6709\u7528\uff0c\u4f46\u662f\u5176\u5b9e**\u67e5\u8be2\u7f13\u5b58\u633a\u9e21\u808b**\u7684\u3002 \u5bf9\u4e8e\u66f4\u65b0\u6bd4\u8f83\u9891\u7e41\u7684\u8868\uff0c\u67e5\u8be2\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u5f88\u4f4e\u7684\uff0c\u56e0\u4e3a\u53ea\u8981\u4e00\u4e2a\u8868\u6709\u66f4\u65b0\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8868\u7684\u67e5\u8be2\u7f13\u5b58\u5c31\u4f1a\u88ab\u6e05\u7a7a\u3002\u5982\u679c\u521a\u7f13\u5b58\u4e86\u4e00\u4e2a\u67e5\u8be2\u7ed3\u679c\u5f88\u5927\u7684\u6570\u636e\uff0c\u8fd8\u6ca1\u88ab\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u521a\u597d\u8fd9\u4e2a\u8868\u6709\u66f4\u65b0\u64cd\u4f5c\uff0c\u67e5\u8be2\u7f13\u51b2\u5c31\u88ab\u6e05\u7a7a\u4e86\uff0c\u76f8\u5f53\u4e8e\u7f13\u5b58\u4e86\u4e2a\u5bc2\u5bde\u3002 \u6240\u4ee5\uff0cMySQL 8.0 \u7248\u672c\u76f4\u63a5\u5c06\u67e5\u8be2\u7f13\u5b58\u5220\u6389\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4 MySQL 8.0 \u5f00\u59cb\uff0c\u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u4e0d\u4f1a\u518d\u8d70\u5230\u67e5\u8be2\u7f13\u5b58\u8fd9\u4e2a\u9636\u6bb5\u4e86\u3002 \u5bf9\u4e8e MySQL 8.0 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u5982\u679c\u60f3\u5173\u95ed\u67e5\u8be2\u7f13\u5b58\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u53c2\u6570 query_cache_type \u8bbe\u7f6e\u6210 DEMAND\u3002 ::: tip \u8fd9\u91cc\u8bf4\u7684\u67e5\u8be2\u7f13\u5b58\u662f server \u5c42\u7684\uff0c\u4e5f\u5c31\u662f MySQL 8.0 \u7248\u672c\u79fb\u9664\u7684\u662f server \u5c42\u7684\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u4e0d\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\u7684 buffer pool\u3002 ::::","title":"\u7b2c\u4e8c\u6b65\uff1a\u67e5\u8be2\u7f13\u5b58"},{"location":"mysql/base/how_select/#sql","text":"\u5728\u6b63\u5f0f\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u4e4b\u524d\uff0c MySQL \u4f1a\u5148\u5bf9 SQL \u8bed\u53e5\u505a\u89e3\u6790\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u4ea4\u7531\u300c\u89e3\u6790\u5668\u300d\u6765\u5b8c\u6210\u3002","title":"\u7b2c\u4e09\u6b65\uff1a\u89e3\u6790 SQL"},{"location":"mysql/base/how_select/#_3","text":"\u89e3\u6790\u5668\u4f1a\u505a\u5982\u4e0b\u4e24\u4ef6\u4e8b\u60c5\u3002 \u7b2c\u4e00\u4ef6\u4e8b\u60c5\uff0c \u8bcd\u6cd5\u5206\u6790 \u3002MySQL \u4f1a\u6839\u636e\u4f60\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u8bc6\u522b\u51fa\u5173\u952e\u5b57\u51fa\u6765\uff0c\u6784\u5efa\u51fa SQL \u8bed\u6cd5\u6811\uff0c\u8fd9\u6837\u65b9\u4fbf\u540e\u9762\u6a21\u5757\u83b7\u53d6 SQL \u7c7b\u578b\u3001\u8868\u540d\u3001\u5b57\u6bb5\u540d\u3001 where \u6761\u4ef6\u7b49\u7b49\u3002 \u7b2c\u4e8c\u4ef6\u4e8b\u60c5\uff0c \u8bed\u6cd5\u5206\u6790 \u3002\u6839\u636e\u8bcd\u6cd5\u5206\u6790\u7684\u7ed3\u679c\uff0c\u8bed\u6cd5\u89e3\u6790\u5668\u4f1a\u6839\u636e\u8bed\u6cd5\u89c4\u5219\uff0c\u5224\u65ad\u4f60\u8f93\u5165\u7684\u8fd9\u4e2a SQL \u8bed\u53e5\u662f\u5426\u6ee1\u8db3 MySQL \u8bed\u6cd5\u3002 \u5982\u679c\u6211\u4eec\u8f93\u5165\u7684 SQL \u8bed\u53e5\u8bed\u6cd5\u4e0d\u5bf9\uff0c\u5c31\u4f1a\u5728\u89e3\u6790\u5668\u8fd9\u4e2a\u9636\u6bb5\u62a5\u9519\u3002\u6bd4\u5982\uff0c\u6211\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u628a from \u5199\u6210\u4e86 form\uff0c\u8fd9\u65f6 MySQL \u89e3\u6790\u5668\u5c31\u4f1a\u7ed9\u62a5\u9519\u3002 \u4f46\u662f\u6ce8\u610f\uff0c\u8868\u4e0d\u5b58\u5728\u6216\u8005\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u5e76\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\uff0c\u300aMySQL 45 \u8bb2\u300b\u8bf4\u662f\u5728\u89e3\u6790\u5668\u505a\u7684\uff0c\u4f46\u662f\u7ecf\u8fc7\u6211\u548c\u670b\u53cb\u770b MySQL \u6e90\u7801\uff085.7\u548c8.0\uff09\u5f97\u51fa\u7ed3\u8bba\u662f\u89e3\u6790\u5668\u53ea\u8d1f\u8d23\u6784\u5efa\u8bed\u6cd5\u6811\u548c\u68c0\u67e5\u8bed\u6cd5\uff0c\u4f46\u662f\u4e0d\u4f1a\u53bb\u67e5\u8868\u6216\u8005\u5b57\u6bb5\u5b58\u4e0d\u5b58\u5728\u3002 \u90a3\u5230\u5e95\u8c01\u6765\u505a\u68c0\u6d4b\u8868\u548c\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\u5462\uff1f\u522b\u6025\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4e86\u3002","title":"\u89e3\u6790\u5668"},{"location":"mysql/base/how_select/#sql_1","text":"\u7ecf\u8fc7\u89e3\u6790\u5668\u540e\uff0c\u63a5\u7740\u5c31\u8981\u8fdb\u5165\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6d41\u7a0b\u4e86\uff0c\u6bcf\u6761 SELECT \u67e5\u8be2\u8bed\u53e5\u6d41\u7a0b\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a\u4e0b\u9762\u8fd9\u4e09\u4e2a\u9636\u6bb5\uff1a prepare \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u9884\u5904\u7406\u9636\u6bb5\uff1b optimize \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u4f18\u5316\u9636\u6bb5\uff1b execute \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u6267\u884c\u9636\u6bb5\uff1b","title":"\u7b2c\u56db\u6b65\uff1a\u6267\u884c SQL"},{"location":"mysql/base/how_select/#_4","text":"\u6211\u4eec\u5148\u6765\u8bf4\u8bf4\u9884\u5904\u7406\u9636\u6bb5\u505a\u4e86\u4ec0\u4e48\u4e8b\u60c5\u3002 \u68c0\u67e5 SQL \u67e5\u8be2\u8bed\u53e5\u4e2d\u7684\u8868\u6216\u8005\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b \u5c06 select * \u4e2d\u7684 * \u7b26\u53f7\uff0c\u6269\u5c55\u4e3a\u8868\u4e0a\u7684\u6240\u6709\u5217\uff1b \u6211\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0ctest \u8fd9\u5f20\u8868\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u8fd9\u65f6 MySQL \u5c31\u4f1a\u5728\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u7684 prepare \u9636\u6bb5\u4e2d\u62a5\u9519\u3002 mysql > select * from test ; ERROR 1146 ( 42 S02 ): Table 'mysql.test' doesn ' t exist \u8fd9\u91cc\u8d34\u4e2a MySQL 8.0 \u6e90\u7801\u6765\u8bc1\u660e\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5224\u65ad\uff0c\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\uff0c\u800c\u662f\u5728 prepare \u9636\u6bb5\u3002\uff08 PS\uff1a\u4e0b\u56fe\u662f\u516c\u4f17\u53f7\u300c\u4e00\u6811\u4e00\u6eaa\u300d\u8001\u54e5\u5e2e\u6211\u5206\u6790\u7684\uff0c\u8fd9\u4f4d\u8001\u54e5\u4e13\u95e8\u5199 MySQL \u6e90\u7801\u6587\u7ae0\uff0c\u611f\u5174\u8da3\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u5fae\u4fe1\u641c\u7d22\u5173\u6ce8 \uff09 \u4e0a\u9762\u7684\u4e2d\u95f4\u90e8\u5206\u662f MySQL \u62a5\u9519\u8868\u4e0d\u5b58\u5728\u65f6\u7684\u51fd\u6570\u8c03\u7528\u6808\uff0c\u53ef\u4ee5\u770b\u5230\u8868\u4e0d\u5b58\u5728\u7684\u9519\u8bef\u662f\u5728get_table_share() \u51fd\u6570\u91cc\u62a5\u9519\u7684\uff0c\u800c\u8fd9\u4e2a\u51fd\u6570\u662f\u5728 prepare \u9636\u6bb5\u8c03\u7528\u7684\u3002 \u4e0d\u8fc7\uff0c\u5bf9\u4e8e MySQL 5.7 \u5224\u65ad\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\uff0c\u662f\u5728\u8bcd\u6cd5\u5206\u6790&\u8bed\u6cd5\u5206\u6790\u4e4b\u540e\uff0cprepare \u9636\u6bb5\u4e4b\u524d\u505a\u7684\u3002\u7ed3\u8bba\u90fd\u4e00\u6837\uff0c\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\u3002\u4ee3\u7801\u6211\u5c31\u4e0d\u653e\u4e86\uff0c\u6b63\u56e0\u4e3a MySQL 5.7 \u4ee3\u7801\u7ed3\u6784\u4e0d\u597d\uff0c\u6240\u4ee5 MySQL 8.0 \u4ee3\u7801\u7ed3\u6784\u53d8\u5316\u5f88\u5927\uff0c\u540e\u6765\u5224\u65ad\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\u5c31\u88ab\u653e\u5165\u5230 prepare \u9636\u6bb5\u505a\u4e86\u3002","title":"\u9884\u5904\u7406\u5668"},{"location":"mysql/base/how_select/#_5","text":"\u7ecf\u8fc7\u9884\u5904\u7406\u9636\u6bb5\u540e\uff0c\u8fd8\u9700\u8981\u4e3a SQL \u67e5\u8be2\u8bed\u53e5\u5148\u5236\u5b9a\u4e00\u4e2a\u6267\u884c\u8ba1\u5212\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u4ea4\u7531\u300c\u4f18\u5316\u5668\u300d\u6765\u5b8c\u6210\u7684\u3002 \u4f18\u5316\u5668\u4e3b\u8981\u8d1f\u8d23\u5c06 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u65b9\u6848\u786e\u5b9a\u4e0b\u6765 \uff0c\u6bd4\u5982\u5728\u8868\u91cc\u9762\u6709\u591a\u4e2a\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4f18\u5316\u5668\u4f1a\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c\u6765\u51b3\u5b9a\u9009\u62e9\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u672c\u6b21\u7684\u67e5\u8be2\u8bed\u53e5\uff08select * from product where id = 1\uff09\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u9009\u62e9\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u3002 \u8981\u60f3\u77e5\u9053\u4f18\u5316\u5668\u9009\u62e9\u4e86\u54ea\u4e2a\u7d22\u5f15\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u67e5\u8be2\u8bed\u53e5\u6700\u524d\u9762\u52a0\u4e2a explain \u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u4f1a\u8f93\u51fa\u8fd9\u6761 SQL \u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\uff0c\u7136\u540e\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key \u5c31\u8868\u793a\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86\u54ea\u4e2a\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0b\u56fe\u7684 key \u4e3a PRIMARY \u5c31\u662f\u4f7f\u7528\u4e86\u4e3b\u952e\u7d22\u5f15\u3002 \u5982\u679c\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u91cc\u7684 key \u4e3a null \u8bf4\u660e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u90a3\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff08type = ALL\uff09\uff0c\u8fd9\u79cd\u67e5\u8be2\u626b\u63cf\u7684\u65b9\u5f0f\u662f\u6548\u7387\u6700\u4f4e\u6863\u6b21\u7684\uff0c\u5982\u4e0b\u56fe\uff1a \u8fd9\u5f20 product \u8868\u53ea\u6709\u4e00\u4e2a\u7d22\u5f15\u5c31\u662f\u4e3b\u952e\uff0c\u73b0\u5728\u6211\u5728\u8868\u4e2d\u5c06 name \u8bbe\u7f6e\u4e3a\u666e\u901a\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u3002 \u8fd9\u65f6 product \u8868\u5c31\u6709\u4e3b\u952e\u7d22\u5f15\uff08id\uff09\u548c\u666e\u901a\u7d22\u5f15\uff08name\uff09\u3002\u5047\u8bbe\u6267\u884c\u4e86\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a select id from product where id > 1 and name like 'i%' ; \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u7ed3\u679c\u65e2\u53ef\u4ee5\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u666e\u901a\u7d22\u5f15\uff0c\u4f46\u662f\u6267\u884c\u7684\u6548\u7387\u4f1a\u4e0d\u540c\u3002\u8fd9\u65f6\uff0c\u5c31\u9700\u8981\u4f18\u5316\u5668\u6765\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u4e86\u3002 \u5f88\u663e\u7136\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u662f**\u8986\u76d6\u7d22\u5f15**\uff0c\u76f4\u63a5\u5728\u4e8c\u7ea7\u7d22\u5f15\u5c31\u80fd\u67e5\u627e\u5230\u7ed3\u679c\uff08\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6570\u636e\u5b58\u50a8\u7684\u662f\u4e3b\u952e\u503c\uff09\uff0c\u5c31\u6ca1\u5fc5\u8981\u5728\u4e3b\u952e\u7d22\u5f15\u67e5\u627e\u4e86\uff0c\u56e0\u4e3a\u67e5\u8be2\u4e3b\u952e\u7d22\u5f15\u7684 B+ \u6811\u7684\u6210\u672c\u4f1a\u6bd4\u67e5\u8be2\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u7684\u6210\u672c\u5927\uff0c\u4f18\u5316\u5668\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c\u4f1a\u9009\u62e9\u67e5\u8be2\u4ee3\u4ef7\u5c0f\u7684\u666e\u901a\u7d22\u5f15\u3002 \u5728\u4e0b\u56fe\u4e2d\u6267\u884c\u8ba1\u5212\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86\u666e\u901a\u7d22\u5f15\uff08name\uff09\uff0cExta \u4e3a Using index\uff0c\u8fd9\u5c31\u662f\u8868\u660e\u4f7f\u7528\u4e86\u8986\u76d6\u7d22\u5f15\u4f18\u5316\u3002","title":"\u4f18\u5316\u5668"},{"location":"mysql/base/how_select/#_6","text":"\u7ecf\u5386\u5b8c\u4f18\u5316\u5668\u540e\uff0c\u5c31\u786e\u5b9a\u4e86\u6267\u884c\u65b9\u6848\uff0c\u63a5\u4e0b\u6765 MySQL \u5c31\u771f\u6b63\u5f00\u59cb\u6267\u884c\u8bed\u53e5\u4e86\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u662f\u7531\u300c\u6267\u884c\u5668\u300d\u5b8c\u6210\u7684\u3002\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u5668\u5c31\u4f1a\u548c\u5b58\u50a8\u5f15\u64ce\u4ea4\u4e92\u4e86\uff0c\u4ea4\u4e92\u662f\u4ee5\u8bb0\u5f55\u4e3a\u5355\u4f4d\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u7528\u4e09\u79cd\u65b9\u5f0f\u6267\u884c\u8fc7\u7a0b\uff0c\u8ddf\u5927\u5bb6\u8bf4\u4e00\u4e0b\u6267\u884c\u5668\u548c\u5b58\u50a8\u5f15\u64ce\u7684\u4ea4\u4e92\u8fc7\u7a0b\uff08PS \uff1a\u4e3a\u4e86\u5199\u597d\u8fd9\u4e00\u90e8\u5206\uff0c\u7279\u5730\u53bb\u770b MySQL \u6e90\u7801\uff0c\u4e5f\u662f\u7b2c\u4e00\u6b21\u770b\u54c8\u54c8\uff09\u3002 \u4e3b\u952e\u7d22\u5f15\u67e5\u8be2 \u5168\u8868\u626b\u63cf \u7d22\u5f15\u4e0b\u63a8","title":"\u6267\u884c\u5668"},{"location":"mysql/base/how_select/#_7","text":"\u4ee5\u672c\u6587\u5f00\u5934\u67e5\u8be2\u8bed\u53e5\u4e3a\u4f8b\uff0c\u770b\u770b\u6267\u884c\u5668\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002 select * from product where id = 1 ; \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u6761\u4ef6\u7528\u5230\u4e86\u4e3b\u952e\u7d22\u5f15\uff0c\u800c\u4e14\u662f\u7b49\u503c\u67e5\u8be2\uff0c\u540c\u65f6\u4e3b\u952e id \u662f\u552f\u4e00\uff0c\u4e0d\u4f1a\u6709 id \u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4f18\u5316\u5668\u51b3\u5b9a\u9009\u7528\u8bbf\u95ee\u7c7b\u578b\u4e3a const \u8fdb\u884c\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a \u6267\u884c\u5668\u7b2c\u4e00\u6b21\u67e5\u8be2\uff0c\u4f1a\u8c03\u7528 read_first_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a const\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a InnoDB \u5f15\u64ce\u7d22\u5f15\u67e5\u8be2\u7684\u63a5\u53e3\uff0c\u628a\u6761\u4ef6 id = 1 \u4ea4\u7ed9\u5b58\u50a8\u5f15\u64ce\uff0c \u8ba9\u5b58\u50a8\u5f15\u64ce\u5b9a\u4f4d\u7b26\u5408\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55 \u3002 \u5b58\u50a8\u5f15\u64ce\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u7684 B+ \u6811\u7ed3\u6784\u5b9a\u4f4d\u5230 id = 1\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8bb0\u5f55\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u5c31\u4f1a\u5411\u6267\u884c\u5668\u4e0a\u62a5\u8bb0\u5f55\u627e\u4e0d\u5230\u7684\u9519\u8bef\uff0c\u7136\u540e\u67e5\u8be2\u7ed3\u675f\u3002\u5982\u679c\u8bb0\u5f55\u662f\u5b58\u5728\u7684\uff0c\u5c31\u4f1a\u5c06\u8bb0\u5f55\u8fd4\u56de\u7ed9\u6267\u884c\u5668\uff1b \u6267\u884c\u5668\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u5230\u8bb0\u5f55\u540e\uff0c\u63a5\u7740\u5224\u65ad\u8bb0\u5f55\u662f\u5426\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\uff0c\u5982\u679c\u7b26\u5408\u5219\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u4e0d\u7b26\u5408\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\u3002 \u6267\u884c\u5668\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a while \u5faa\u73af\uff0c\u6240\u4ee5\u8fd8\u4f1a\u518d\u67e5\u4e00\u6b21\uff0c\u4f46\u662f\u8fd9\u6b21\u56e0\u4e3a\u4e0d\u662f\u7b2c\u4e00\u6b21\u67e5\u8be2\u4e86\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528 read_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a const\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a\u4e00\u4e2a\u6c38\u8fdc\u8fd4\u56de - 1 \u7684\u51fd\u6570\uff0c\u6240\u4ee5\u5f53\u8c03\u7528\u8be5\u51fd\u6570\u7684\u65f6\u5019\uff0c\u6267\u884c\u5668\u5c31\u9000\u51fa\u5faa\u73af\uff0c\u4e5f\u5c31\u662f\u7ed3\u675f\u67e5\u8be2\u4e86\u3002 \u81f3\u6b64\uff0c\u8fd9\u4e2a\u8bed\u53e5\u5c31\u6267\u884c\u5b8c\u6210\u4e86\u3002","title":"\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2"},{"location":"mysql/base/how_select/#_8","text":"\u4e3e\u4e2a\u5168\u8868\u626b\u63cf\u7684\u4f8b\u5b50\uff1a select * from product where name = 'iphone'; \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\uff0c\u6240\u4ee5\u4f18\u5316\u5668\u51b3\u5b9a\u9009\u7528\u8bbf\u95ee\u7c7b\u578b\u4e3a ALL \u8fdb\u884c\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\uff0c\u90a3\u4e48\u8fd9\u65f6\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a \u6267\u884c\u5668\u7b2c\u4e00\u6b21\u67e5\u8be2\uff0c\u4f1a\u8c03\u7528 read_first_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a all\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a InnoDB \u5f15\u64ce\u5168\u626b\u63cf\u7684\u63a5\u53e3\uff0c \u8ba9\u5b58\u50a8\u5f15\u64ce\u8bfb\u53d6\u8868\u4e2d\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55 \uff1b \u6267\u884c\u5668\u4f1a\u5224\u65ad\u8bfb\u5230\u7684\u8fd9\u6761\u8bb0\u5f55\u7684 name \u662f\u4e0d\u662f iphone\uff0c\u5982\u679c\u4e0d\u662f\u5219\u8df3\u8fc7\uff1b\u5982\u679c\u662f\u5219\u5c06\u8bb0\u5f55\u53d1\u7ed9\u5ba2\u6237\u7684\uff08\u662f\u7684\u6ca1\u9519\uff0cServer \u5c42\u6bcf\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u5230\u4e00\u6761\u8bb0\u5f55\u5c31\u4f1a\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e4b\u6240\u4ee5\u5ba2\u6237\u7aef\u663e\u793a\u7684\u65f6\u5019\u662f\u76f4\u63a5\u663e\u793a\u6240\u6709\u8bb0\u5f55\u7684\uff0c\u662f\u56e0\u4e3a\u5ba2\u6237\u7aef\u662f\u7b49\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u663e\u793a\u51fa\u6240\u6709\u7684\u8bb0\u5f55\uff09\u3002 \u6267\u884c\u5668\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a while \u5faa\u73af\uff0c\u6240\u4ee5\u8fd8\u4f1a\u518d\u67e5\u4e00\u6b21\uff0c\u4f1a\u8c03\u7528 read_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a all\uff0cread_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u8fd8\u662f InnoDB \u5f15\u64ce\u5168\u626b\u63cf\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u63a5\u7740\u5411\u5b58\u50a8\u5f15\u64ce\u5c42\u8981\u6c42\u7ee7\u7eed\u8bfb\u521a\u624d\u90a3\u6761\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u5b58\u50a8\u5f15\u64ce\u628a\u4e0b\u4e00\u6761\u8bb0\u5f55\u53d6\u51fa\u540e\u5c31\u5c06\u5176\u8fd4\u56de\u7ed9\u6267\u884c\u5668\uff08Server\u5c42\uff09\uff0c\u6267\u884c\u5668\u7ee7\u7eed\u5224\u65ad\u6761\u4ef6\uff0c\u4e0d\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u5373\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff0c\u5426\u5219\u53d1\u9001\u5230\u5ba2\u6237\u7aef\uff1b \u4e00\u76f4\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\uff0c\u7136\u540e\u5411\u6267\u884c\u5668\uff08Server\u5c42\uff09 \u8fd4\u56de\u4e86\u8bfb\u53d6\u5b8c\u6bd5\u7684\u4fe1\u606f\uff1b \u6267\u884c\u5668\u6536\u5230\u5b58\u50a8\u5f15\u64ce\u62a5\u544a\u7684\u67e5\u8be2\u5b8c\u6bd5\u7684\u4fe1\u606f\uff0c\u9000\u51fa\u5faa\u73af\uff0c\u505c\u6b62\u67e5\u8be2\u3002 \u81f3\u6b64\uff0c\u8fd9\u4e2a\u8bed\u53e5\u5c31\u6267\u884c\u5b8c\u6210\u4e86\u3002","title":"\u5168\u8868\u626b\u63cf"},{"location":"mysql/base/how_select/#_9","text":"\u5728\u8fd9\u90e8\u5206\u975e\u5e38\u9002\u5408\u8bb2\u7d22\u5f15\u4e0b\u63a8\uff08MySQL 5.6 \u63a8\u51fa\u7684\u67e5\u8be2\u4f18\u5316\u7b56\u7565\uff09\uff0c\u8fd9\u6837\u5927\u5bb6\u80fd\u6e05\u695a\u7684\u77e5\u9053\uff0c\u300c\u4e0b\u63a8\u300d\u8fd9\u4e2a\u52a8\u4f5c\uff0c\u4e0b\u63a8\u5230\u4e86\u54ea\u91cc\u3002 \u7d22\u5f15\u4e0b\u63a8\u80fd\u591f\u51cf\u5c11**\u4e8c\u7ea7\u7d22\u5f15**\u5728\u67e5\u8be2\u65f6\u7684\u56de\u8868\u64cd\u4f5c\uff0c\u63d0\u9ad8\u67e5\u8be2\u7684\u6548\u7387\uff0c\u56e0\u4e3a\u5b83\u5c06 Server \u5c42\u90e8\u5206\u8d1f\u8d23\u7684\u4e8b\u60c5\uff0c\u4ea4\u7ed9\u5b58\u50a8\u5f15\u64ce\u5c42\u53bb\u5904\u7406\u4e86\u3002 \u4e3e\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff0c\u8fd9\u91cc\u4e00\u5f20\u7528\u6237\u8868\u5982\u4e0b\uff0c\u6211\u5bf9 age \u548c reward \u5b57\u6bb5\u5efa\u7acb\u4e86\u8054\u5408\u7d22\u5f15\uff08age\uff0creward\uff09\uff1a \u73b0\u5728\u6709\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a select * from t_user where age > 20 and reward = 100000 ; \u8054\u5408\u7d22\u5f15\u5f53\u9047\u5230\u8303\u56f4\u67e5\u8be2 (>\u3001<) \u5c31\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u4e5f\u5c31\u662f age \u5b57\u6bb5\u80fd\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f reward \u5b57\u6bb5\u5219\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15 \u3002\u5177\u4f53\u539f\u56e0\u8fd9\u91cc\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a \u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898 \u90a3\u4e48\uff0c\u4e0d\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\uff08MySQL 5.6 \u4e4b\u524d\u7684\u7248\u672c\uff09\u65f6\uff0c\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a Server \u5c42\u9996\u5148\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\u5b9a\u4f4d\u5230\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5b9a\u4f4d\u5230 age > 20 \u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1b \u5b58\u50a8\u5f15\u64ce\u6839\u636e\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5feb\u901f\u5b9a\u4f4d\u5230\u8fd9\u6761\u8bb0\u5f55\u540e\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e**\u8fdb\u884c\u56de\u8868\u64cd\u4f5c**\uff0c\u5c06\u5b8c\u6574\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\uff1b Server \u5c42\u5728\u5224\u65ad\u8be5\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000\uff0c\u5982\u679c\u6210\u7acb\u5219\u5c06\u5176\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff1b\u5426\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff1b \u63a5\u7740\uff0c\u7ee7\u7eed\u5411\u5b58\u50a8\u5f15\u64ce\u7d22\u8981\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u5b58\u50a8\u5f15\u64ce\u5728\u4e8c\u7ea7\u7d22\u5f15\u5b9a\u4f4d\u5230\u8bb0\u5f55\u540e\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e\u56de\u8868\u64cd\u4f5c\uff0c\u5c06\u5b8c\u6574\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\uff1b \u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u6ca1\u6709\u7d22\u5f15\u4e0b\u63a8\u7684\u65f6\u5019\uff0c\u6bcf\u67e5\u8be2\u5230\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u90fd\u8981\u8fdb\u884c\u56de\u8868\u64cd\u4f5c\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server\uff0c\u63a5\u7740 Server \u518d\u5224\u65ad\u8be5\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000\u3002 \u800c\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\u540e\uff0c\u5224\u65ad\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000 \u7684\u5de5\u4f5c\u4ea4\u7ed9\u4e86\u5b58\u50a8\u5f15\u64ce\u5c42\uff0c\u8fc7\u7a0b\u5982\u4e0b \uff1a Server \u5c42\u9996\u5148\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\u5b9a\u4f4d\u5230\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5b9a\u4f4d\u5230 age > 20 \u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1b \u5b58\u50a8\u5f15\u64ce\u5b9a\u4f4d\u5230\u4e8c\u7ea7\u7d22\u5f15\u540e\uff0c \u5148\u4e0d\u6267\u884c\u56de\u8868**\u64cd\u4f5c\uff0c\u800c\u662f\u5148\u5224\u65ad\u4e00\u4e0b\u8be5\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5217\uff08reward\u5217\uff09\u7684\u6761\u4ef6\uff08reward \u662f\u5426\u7b49\u4e8e 100000\uff09\u662f\u5426\u6210\u7acb\u3002\u5982\u679c**\u6761\u4ef6\u4e0d\u6210\u7acb \uff0c\u5219\u76f4\u63a5**\u8df3\u8fc7\u8be5\u4e8c\u7ea7\u7d22\u5f15**\u3002\u5982\u679c**\u6210\u7acb**\uff0c\u5219**\u6267\u884c\u56de\u8868**\u64cd\u4f5c\uff0c\u5c06\u5b8c\u6210\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\u3002 Server \u5c42\u5728\u5224\u65ad\u5176\u4ed6\u7684\u67e5\u8be2\u6761\u4ef6\uff08\u672c\u6b21\u67e5\u8be2\u6ca1\u6709\u5176\u4ed6\u6761\u4ef6\uff09\u662f\u5426\u6210\u7acb\uff0c\u5982\u679c\u6210\u7acb\u5219\u5c06\u5176\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff1b\u5426\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff0c\u7136\u540e\u5411\u5b58\u50a8\u5f15\u64ce\u7d22\u8981\u4e0b\u4e00\u6761\u8bb0\u5f55\u3002 \u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u540e\uff0c\u867d\u7136 reward \u5217\u65e0\u6cd5\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u56e0\u4e3a\u5b83\u5305\u542b\u5728\u8054\u5408\u7d22\u5f15\uff08age\uff0creward\uff09\u91cc\uff0c\u6240\u4ee5\u76f4\u63a5\u5728\u5b58\u50a8\u5f15\u64ce\u8fc7\u6ee4\u51fa\u6ee1\u8db3 reward = 100000 \u7684\u8bb0\u5f55\u540e\uff0c\u624d\u53bb\u6267\u884c\u56de\u8868\u64cd\u4f5c\u83b7\u53d6\u6574\u4e2a\u8bb0\u5f55\u3002\u76f8\u6bd4\u4e8e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\uff0c\u8282\u7701\u4e86\u5f88\u591a\u56de\u8868\u64cd\u4f5c\u3002 \u5f53\u4f60\u53d1\u73b0\u6267\u884c\u8ba1\u5212\u91cc\u7684 Extr \u90e8\u5206\u663e\u793a\u4e86 \u201cUsing index condition\u201d\uff0c\u8bf4\u660e\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u3002","title":"\u7d22\u5f15\u4e0b\u63a8"},{"location":"mysql/base/how_select/#_10","text":"\u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \u8fde\u63a5\u5668\uff1a\u5efa\u7acb\u8fde\u63a5\uff0c\u7ba1\u7406\u8fde\u63a5\u3001\u6821\u9a8c\u7528\u6237\u8eab\u4efd\uff1b \u67e5\u8be2\u7f13\u5b58\uff1a\u67e5\u8be2\u8bed\u53e5\u5982\u679c\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5426\u5219\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\u3002MySQL 8.0 \u5df2\u5220\u9664\u8be5\u6a21\u5757\uff1b \u89e3\u6790 SQL\uff0c\u901a\u8fc7\u89e3\u6790\u5668\u5bf9 SQL \u67e5\u8be2\u8bed\u53e5\u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\uff0c\u7136\u540e\u6784\u5efa\u8bed\u6cd5\u6811\uff0c\u65b9\u4fbf\u540e\u7eed\u6a21\u5757\u8bfb\u53d6\u8868\u540d\u3001\u5b57\u6bb5\u3001\u8bed\u53e5\u7c7b\u578b\uff1b \u6267\u884c SQL\uff1a\u6267\u884c SQL \u5171\u6709\u4e09\u4e2a\u9636\u6bb5\uff1a \u9884\u5904\u7406\u9636\u6bb5\uff1a\u68c0\u67e5\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b\u5c06 select * \u4e2d\u7684 * \u7b26\u53f7\u6269\u5c55\u4e3a\u8868\u4e0a\u7684\u6240\u6709\u5217\u3002 \u4f18\u5316\u9636\u6bb5\uff1a\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c \u9009\u62e9\u67e5\u8be2\u6210\u672c\u6700\u5c0f\u7684\u6267\u884c\u8ba1\u5212\uff1b \u6267\u884c\u9636\u6bb5\uff1a\u6839\u636e\u6267\u884c\u8ba1\u5212\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u53d6\u8bb0\u5f55\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff1b \u600e\u4e48\u6837\uff1f\u73b0\u5728\u518d\u770b\u8fd9\u5f20\u56fe\uff0c\u662f\u4e0d\u662f\u5f88\u6e05\u6670\u4e86\u3002 \u5b8c\uff01 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL 45 \u8bb2\u300b \u300aMySQL\u662f\u600e\u6837\u8fd0\u884c\u7684\uff1a\u4ece\u6839\u513f\u4e0a\u7406\u89e3MySQL\u300b https://gohalo.me/post/mysql-executor.html http://www.iskm.org/mysql56/sql__executor_8cc_source.html https://tangocc.github.io/2018/10/11/mysql-sourcecode/ \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/base/row_format/","text":"MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4e4b\u524d\u6709\u4f4d\u8bfb\u8005\u5728\u9762\u5b57\u8282\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a \u5982\u679c\u4f60\u77e5\u9053 MySQL \u4e00\u884c\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u90a3\u4e48\u8fd9\u4e2a\u95ee\u9898\u5bf9\u4f60\u6ca1\u4ec0\u4e48\u96be\u5ea6\u3002 \u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4e5f\u6ca1\u5173\u7cfb\uff0c\u8fd9\u6b21\u6211\u8ddf\u5927\u5bb6\u804a\u804a MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f \u77e5\u9053\u4e86\u8fd9\u4e2a\u4e4b\u540e\uff0c\u9664\u4e86\u80fd\u5e94\u89e3\u9501\u524d\u9762\u8fd9\u9053\u9762\u8bd5\u9898\uff0c\u4f60\u8fd8\u4f1a\u89e3\u9501\u8fd9\u4e9b\u9762\u8bd5\u9898\uff1a MySQL \u7684 NULL \u503c\u4f1a\u5360\u7528\u7a7a\u95f4\u5417\uff1f MySQL \u600e\u4e48\u77e5\u9053 varchar(n) \u5b9e\u9645\u5360\u7528\u6570\u636e\u7684\u5927\u5c0f\uff1f varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f \u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f \u8fd9\u4e9b\u95ee\u9898\u770b\u4f3c\u6beb\u4e0d\u76f8\u5e72\uff0c\u5176\u5b9e\u90fd\u662f\u5728\u56f4\u7ed5\u300c MySQL \u4e00\u884c\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\u300d\u8fd9\u4e00\u4e2a\u77e5\u8bc6\u70b9\uff0c\u6240\u4ee5\u653b\u7834\u4e86\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u540e\uff0c\u8fd9\u4e9b\u95ee\u9898\u5c31\u5f15\u5203\u800c\u89e3\u4e86\u3002 \u597d\u4e86\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u53d1\u8f66\uff01 MySQL \u7684\u6570\u636e\u5b58\u653e\u5728\u54ea\u4e2a\u6587\u4ef6\uff1f \u00b6 \u5927\u5bb6\u90fd\u77e5\u9053 MySQL \u7684\u6570\u636e\u90fd\u662f\u4fdd\u5b58\u5728\u78c1\u76d8\u7684\uff0c\u90a3\u5177\u4f53\u662f\u4fdd\u5b58\u5728\u54ea\u4e2a\u6587\u4ef6\u5462\uff1f MySQL \u5b58\u50a8\u7684\u884c\u4e3a\u662f\u7531\u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\uff0cMySQL \u652f\u6301\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u4fdd\u5b58\u7684\u6587\u4ef6\u81ea\u7136\u4e5f\u4e0d\u540c\u3002 InnoDB \u662f\u6211\u4eec\u5e38\u7528\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u4e5f\u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u3002\u6240\u4ee5\uff0c\u672c\u6587\u4e3b\u8981\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u5c55\u5f00\u8ba8\u8bba\u3002 \u5148\u6765\u770b\u770b MySQL \u6570\u636e\u5e93\u7684\u6587\u4ef6\u5b58\u653e\u5728\u54ea\u4e2a\u76ee\u5f55\uff1f mysql > SHOW VARIABLES LIKE 'datadir' ; + ---------------+-----------------+ | Variable_name | Value | + ---------------+-----------------+ | datadir | / var / lib / mysql / | + ---------------+-----------------+ 1 row in set ( 0 . 00 sec ) \u6211\u4eec\u6bcf\u521b\u5efa\u4e00\u4e2a database\uff08\u6570\u636e\u5e93\uff09 \u90fd\u4f1a\u5728 /var/lib/mysql/ \u76ee\u5f55\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u4ee5 database \u4e3a\u540d\u7684\u76ee\u5f55\uff0c\u7136\u540e\u4fdd\u5b58\u8868\u7ed3\u6784\u548c\u8868\u6570\u636e\u7684\u6587\u4ef6\u90fd\u4f1a\u5b58\u653e\u5728\u8fd9\u4e2a\u76ee\u5f55\u91cc\u3002 \u6bd4\u5982\uff0c\u6211\u8fd9\u91cc\u6709\u4e00\u4e2a\u540d\u4e3a my_test \u7684 database\uff0c\u8be5 database \u91cc\u6709\u4e00\u5f20\u540d\u4e3a t_order \u6570\u636e\u5e93\u8868\u3002 \u7136\u540e\uff0c\u6211\u4eec\u8fdb\u5165 /var/lib/mysql/my_test \u76ee\u5f55\uff0c\u770b\u770b\u91cc\u9762\u6709\u4ec0\u4e48\u6587\u4ef6\uff1f [ root@xiaolin ~ ] #ls /var/lib/mysql/my_test db.opt t_order.frm t_order.ibd \u53ef\u4ee5\u770b\u5230\uff0c\u5171\u6709\u4e09\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e09\u4e2a\u6587\u4ef6\u5206\u522b\u4ee3\u8868\u7740\uff1a db.opt\uff0c\u7528\u6765\u5b58\u50a8\u5f53\u524d\u6570\u636e\u5e93\u7684\u9ed8\u8ba4\u5b57\u7b26\u96c6\u548c\u5b57\u7b26\u6821\u9a8c\u89c4\u5219\u3002 t_order.frm \uff0ct_order \u7684**\u8868\u7ed3\u6784**\u4f1a\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u3002\u5728 MySQL \u4e2d\u5efa\u7acb\u4e00\u5f20\u8868\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a.frm \u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u662f\u7528\u6765\u4fdd\u5b58\u6bcf\u4e2a\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\u7684\uff0c\u4e3b\u8981\u5305\u542b\u8868\u7ed3\u6784\u5b9a\u4e49\u3002 t_order.ibd\uff0ct_order \u7684**\u8868\u6570\u636e**\u4f1a\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u3002\u8868\u6570\u636e\u65e2\u53ef\u4ee5\u5b58\u5728\u5171\u4eab\u8868\u7a7a\u95f4\u6587\u4ef6\uff08\u6587\u4ef6\u540d\uff1aibdata1\uff09\u91cc\uff0c\u4e5f\u53ef\u4ee5\u5b58\u653e\u5728\u72ec\u5360\u8868\u7a7a\u95f4\u6587\u4ef6\uff08\u6587\u4ef6\u540d\uff1a\u8868\u540d\u5b57.ibd\uff09\u3002\u8fd9\u4e2a\u884c\u4e3a\u662f\u7531\u53c2\u6570 innodb_file_per_table \u63a7\u5236\u7684\uff0c\u82e5\u8bbe\u7f6e\u4e86\u53c2\u6570 innodb_file_per_table \u4e3a 1\uff0c\u5219\u4f1a\u5c06\u5b58\u50a8\u7684\u6570\u636e\u3001\u7d22\u5f15\u7b49\u4fe1\u606f\u5355\u72ec\u5b58\u50a8\u5728\u4e00\u4e2a\u72ec\u5360\u8868\u7a7a\u95f4\uff0c\u4ece MySQL 5.6.6 \u7248\u672c\u5f00\u59cb\uff0c\u5b83\u7684\u9ed8\u8ba4\u503c\u5c31\u662f 1 \u4e86\uff0c\u56e0\u6b64\u4ece\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\uff0c MySQL \u4e2d\u6bcf\u4e00\u5f20\u8868\u7684\u6570\u636e\u90fd\u5b58\u653e\u5728\u4e00\u4e2a\u72ec\u7acb\u7684 .idb \u6587\u4ef6\u3002 \u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u5f20\u6570\u636e\u5e93\u8868\u7684\u6570\u636e\u662f\u4fdd\u5b58\u5728\u300c \u8868\u540d\u5b57.idb \u300d\u7684\u6587\u4ef6\u91cc\u7684\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e5f\u79f0\u4e3a\u72ec\u5360\u8868\u7a7a\u95f4\u6587\u4ef6\u3002 \u8868\u7a7a\u95f4\u6587\u4ef6\u7684\u7ed3\u6784\u662f\u600e\u4e48\u6837\u7684\uff1f \u00b6 \u8868\u7a7a\u95f4\u7531\u6bb5\uff08segment\uff09\u3001\u533a\uff08extent\uff09\u3001\u9875\uff08page\uff09\u3001\u884c\uff08row\uff09\u7ec4\u6210 \uff0cInnoDB\u5b58\u50a8\u5f15\u64ce\u7684\u903b\u8f91\u5b58\u50a8\u7ed3\u6784\u5927\u81f4\u5982\u4e0b\u56fe\uff1a \u4e0b\u9762\u6211\u4eec\u4ece\u4e0b\u5f80\u4e0a\u4e00\u4e2a\u4e2a\u770b\u770b\u3002 1\u3001\u884c\uff08row\uff09 \u00b6 \u6570\u636e\u5e93\u8868\u4e2d\u7684\u8bb0\u5f55\u90fd\u662f\u6309\u884c\uff08row\uff09\u8fdb\u884c\u5b58\u653e\u7684\uff0c\u6bcf\u884c\u8bb0\u5f55\u6839\u636e\u4e0d\u540c\u7684\u884c\u683c\u5f0f\uff0c\u6709\u4e0d\u540c\u7684\u5b58\u50a8\u7ed3\u6784\u3002 \u540e\u9762\u6211\u4eec\u8be6\u7ec6\u4ecb\u7ecd InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u884c\u683c\u5f0f\uff0c\u4e5f\u662f\u672c\u6587\u91cd\u70b9\u4ecb\u7ecd\u7684\u5185\u5bb9\u3002 2\u3001\u9875\uff08page\uff09 \u00b6 \u8bb0\u5f55\u662f\u6309\u7167\u884c\u6765\u5b58\u50a8\u7684\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7684\u8bfb\u53d6\u5e76\u4e0d\u4ee5\u300c\u884c\u300d\u4e3a\u5355\u4f4d\uff0c\u5426\u5219\u4e00\u6b21\u8bfb\u53d6\uff08\u4e5f\u5c31\u662f\u4e00\u6b21 I/O \u64cd\u4f5c\uff09\u53ea\u80fd\u5904\u7406\u4e00\u884c\u6570\u636e\uff0c\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\u3002 \u56e0\u6b64\uff0c InnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u9700\u8981\u8bfb\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u5c06\u8fd9\u4e2a\u884c\u8bb0\u5f55\u4ece\u78c1\u76d8\u8bfb\u51fa\u6765\uff0c\u800c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\uff0c\u5c06\u5176\u6574\u4f53\u8bfb\u5165\u5185\u5b58\u3002 \u9ed8\u8ba4\u6bcf\u4e2a\u9875\u7684\u5927\u5c0f\u4e3a 16KB \uff0c\u4e5f\u5c31\u662f\u6700\u591a\u80fd\u4fdd\u8bc1 16KB \u7684\u8fde\u7eed\u5b58\u50a8\u7a7a\u95f4\u3002 \u9875\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\u78c1\u76d8\u7ba1\u7406\u7684\u6700\u5c0f\u5355\u5143\uff0c\u610f\u5473\u7740\u6570\u636e\u5e93\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u4ee5 16KB \u4e3a\u5355\u4f4d\u7684\uff0c\u4e00\u6b21\u6700\u5c11\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6 16K \u7684\u5185\u5bb9\u5230\u5185\u5b58\u4e2d\uff0c\u4e00\u6b21\u6700\u5c11\u628a\u5185\u5b58\u4e2d\u7684 16K \u5185\u5bb9\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002 \u9875\u7684\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u5e38\u89c1\u7684\u6709\u6570\u636e\u9875\u3001undo \u65e5\u5fd7\u9875\u3001\u6ea2\u51fa\u9875\u7b49\u7b49\u3002\u6570\u636e\u8868\u4e2d\u7684\u884c\u8bb0\u5f55\u662f\u7528\u300c\u6570\u636e\u9875\u300d\u6765\u7ba1\u7406\u7684\uff0c\u6570\u636e\u9875\u7684\u7ed3\u6784\u8fd9\u91cc\u6211\u5c31\u4e0d\u8bb2\u7ec6\u8bf4\u4e86\uff0c\u4e4b\u524d\u6587\u7ae0\u6709\u8bf4\u8fc7\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u53bb\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a \u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811 \u603b\u4e4b\u77e5\u9053\u8868\u4e2d\u7684\u8bb0\u5f55\u5b58\u50a8\u5728\u300c\u6570\u636e\u9875\u300d\u91cc\u9762\u5c31\u884c\u3002 3\u3001\u533a\uff08extent\uff09 \u00b6 \u6211\u4eec\u77e5\u9053 InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u7528 B+ \u6811\u6765\u7ec4\u7ec7\u6570\u636e\u7684\u3002 B+ \u6811\u4e2d\u6bcf\u4e00\u5c42\u90fd\u662f\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u8fde\u63a5\u8d77\u6765\u7684\uff0c\u5982\u679c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\u6765\u5206\u914d\u5b58\u50a8\u7a7a\u95f4\uff0c\u90a3\u4e48\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u4e24\u4e2a\u9875\u4e4b\u95f4\u7684\u7269\u7406\u4f4d\u7f6e\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u53ef\u80fd\u79bb\u5f97\u975e\u5e38\u8fdc\uff0c\u90a3\u4e48\u78c1\u76d8\u67e5\u8be2\u65f6\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u968f\u673aI/O\uff0c\u968f\u673a I/O \u662f\u975e\u5e38\u6162\u7684\u3002 \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u8ba9\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u9875\u7684\u7269\u7406\u4f4d\u7f6e\u4e5f\u76f8\u90bb\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528\u987a\u5e8f I/O \u4e86\uff0c\u90a3\u4e48\u5728\u8303\u56f4\u67e5\u8be2\uff08\u626b\u63cf\u53f6\u5b50\u8282\u70b9\uff09\u7684\u65f6\u5019\u6027\u80fd\u5c31\u4f1a\u5f88\u9ad8\u3002 \u90a3\u5177\u4f53\u600e\u4e48\u89e3\u51b3\u5462\uff1f \u5728\u8868\u4e2d\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\uff0c\u4e3a\u67d0\u4e2a\u7d22\u5f15\u5206\u914d\u7a7a\u95f4\u7684\u65f6\u5019\u5c31\u4e0d\u518d\u6309\u7167\u9875\u4e3a\u5355\u4f4d\u5206\u914d\u4e86\uff0c\u800c\u662f\u6309\u7167\u533a\uff08extent\uff09\u4e3a\u5355\u4f4d\u5206\u914d\u3002\u6bcf\u4e2a\u533a\u7684\u5927\u5c0f\u4e3a 1MB\uff0c\u5bf9\u4e8e 16KB \u7684\u9875\u6765\u8bf4\uff0c\u8fde\u7eed\u7684 64 \u4e2a\u9875\u4f1a\u88ab\u5212\u4e3a\u4e00\u4e2a\u533a\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u9875\u7684\u7269\u7406\u4f4d\u7f6e\u4e5f\u76f8\u90bb\uff0c\u5c31\u80fd\u4f7f\u7528\u987a\u5e8f I/O \u4e86 \u3002 4\u3001\u6bb5\uff08segment\uff09 \u00b6 \u8868\u7a7a\u95f4\u662f\u7531\u5404\u4e2a\u6bb5\uff08segment\uff09\u7ec4\u6210\u7684\uff0c\u6bb5\u662f\u7531\u591a\u4e2a\u533a\uff08extent\uff09\u7ec4\u6210\u7684\u3002\u6bb5\u4e00\u822c\u5206\u4e3a\u6570\u636e\u6bb5\u3001\u7d22\u5f15\u6bb5\u548c\u56de\u6eda\u6bb5\u7b49\u3002 \u7d22\u5f15\u6bb5\uff1a\u5b58\u653e B + \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u7684\u533a\u7684\u96c6\u5408\uff1b \u6570\u636e\u6bb5\uff1a\u5b58\u653e B + \u6811\u7684\u53f6\u5b50\u8282\u70b9\u7684\u533a\u7684\u96c6\u5408\uff1b \u56de\u6eda\u6bb5\uff1a\u5b58\u653e\u7684\u662f\u56de\u6eda\u6570\u636e\u7684\u533a\u7684\u96c6\u5408\uff0c\u4e4b\u524d\u8bb2 \u4e8b\u52a1\u9694\u79bb \u7684\u65f6\u5019\u5c31\u4ecb\u7ecd\u5230\u4e86 MVCC \u5229\u7528\u4e86\u56de\u6eda\u6bb5\u5b9e\u73b0\u4e86\u591a\u7248\u672c\u67e5\u8be2\u6570\u636e\u3002 \u597d\u4e86\uff0c\u7ec8\u4e8e\u8bf4\u5b8c\u8868\u7a7a\u95f4\u7684\u7ed3\u6784\u4e86\u3002\u63a5\u4e0b\u6765\uff0c\u5c31\u5177\u4f53\u8bb2\u4e00\u4e0b InnoDB \u7684\u884c\u683c\u5f0f\u4e86\u3002 \u4e4b\u6240\u4ee5\u8981\u7ed5\u4e00\u5927\u5708\u624d\u8bb2\u884c\u8bb0\u5f55\u7684\u683c\u5f0f\uff0c\u4e3b\u8981\u662f\u60f3\u8ba9\u5927\u5bb6\u77e5\u9053\u884c\u8bb0\u5f55\u662f\u5b58\u50a8\u5728\u54ea\u4e2a\u6587\u4ef6\uff0c\u4ee5\u53ca\u884c\u8bb0\u5f55\u5728\u8fd9\u4e2a\u8868\u7a7a\u95f4\u6587\u4ef6\u4e2d\u7684\u54ea\u4e2a\u533a\u57df\uff0c\u6709\u4e00\u4e2a\u4ece\u4e0a\u5f80\u4e0b\u5207\u5165\u7684\u89c6\u89d2\uff0c\u8fd9\u6837\u7406\u89e3\u8d77\u6765\u4e0d\u4f1a\u89c9\u5f97\u5f88\u62bd\u8c61\u3002 InnoDB \u884c\u683c\u5f0f\u6709\u54ea\u4e9b\uff1f \u00b6 \u884c\u683c\u5f0f\uff08row_format\uff09\uff0c\u5c31\u662f\u4e00\u6761\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\u3002 InnoDB \u63d0\u4f9b\u4e86 4 \u79cd\u884c\u683c\u5f0f\uff0c\u5206\u522b\u662f Redundant\u3001Compact\u3001Dynamic\u548c Compressed \u884c\u683c\u5f0f\u3002 Redundant \u662f\u5f88\u53e4\u8001\u7684\u884c\u683c\u5f0f\u4e86\uff0c MySQL 5.0 \u7248\u672c\u4e4b\u524d\u7528\u7684\u884c\u683c\u5f0f\uff0c\u73b0\u5728\u57fa\u672c\u6ca1\u4eba\u7528\u4e86\u3002 \u7531\u4e8e Redundant \u4e0d\u662f\u4e00\u79cd\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u6240\u4ee5 MySQL 5.0 \u4e4b\u540e\u5f15\u5165\u4e86 Compact \u884c\u8bb0\u5f55\u5b58\u50a8\u65b9\u5f0f\uff0cCompact \u662f\u4e00\u79cd\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u8bbe\u8ba1\u7684\u521d\u8877\u5c31\u662f\u4e3a\u4e86\u8ba9\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u884c\u8bb0\u5f55\uff0c\u4ece MySQL 5.1 \u7248\u672c\u4e4b\u540e\uff0c\u884c\u683c\u5f0f\u9ed8\u8ba4\u8bbe\u7f6e\u6210 Compact\u3002 Dynamic \u548c Compressed \u4e24\u4e2a\u90fd\u662f\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u5b83\u4eec\u7684\u884c\u683c\u5f0f\u90fd\u548c Compact \u5dee\u4e0d\u591a\uff0c\u56e0\u4e3a\u90fd\u662f\u57fa\u4e8e Compact \u6539\u8fdb\u4e00\u70b9\u4e1c\u897f\u3002\u4ece MySQL5.7 \u7248\u672c\u4e4b\u540e\uff0c\u9ed8\u8ba4\u4f7f\u7528 Dynamic \u884c\u683c\u5f0f\u3002 Redundant \u884c\u683c\u5f0f\u6211\u8fd9\u91cc\u5c31\u4e0d\u8bb2\u4e86\uff0c\u56e0\u4e3a\u73b0\u5728\u57fa\u672c\u6ca1\u4eba\u7528\u4e86\uff0c\u8fd9\u6b21\u91cd\u70b9\u4ecb\u7ecd Compact \u884c\u683c\u5f0f\uff0c\u56e0\u4e3a Dynamic \u548c Compressed \u8fd9\u4e24\u4e2a\u884c\u683c\u5f0f\u8ddf Compact \u975e\u5e38\u50cf\u3002 \u6240\u4ee5\uff0c\u5f04\u61c2\u4e86 Compact \u884c\u683c\u5f0f\uff0c\u4e4b\u540e\u4f60\u4eec\u5728\u53bb\u4e86\u89e3\u5176\u4ed6\u884c\u683c\u5f0f\uff0c\u5f88\u5feb\u4e5f\u80fd\u770b\u61c2\u3002 COMPACT \u884c\u683c\u5f0f\u957f\u4ec0\u4e48\u6837\uff1f \u00b6 \u5148\u8ddf Compact \u884c\u683c\u5f0f\u6df7\u4e2a\u8138\u719f\uff0c\u5b83\u957f\u8fd9\u6837\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u6761\u5b8c\u6574\u7684\u8bb0\u5f55\u5206\u4e3a\u300c\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u300d\u548c\u300c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u300d\u4e24\u4e2a\u90e8\u5206\u3002 \u63a5\u4e0b\u91cc\uff0c\u5206\u522b\u8be6\u7ec6\u8bf4\u4e0b\u3002 \u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f \u00b6 \u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u5305\u542b 3 \u4e2a\u90e8\u5206\uff1a\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u3001NULL \u503c\u5217\u8868\u3001\u8bb0\u5f55\u5934\u4fe1\u606f\u3002 1. \u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868 \u00b6 varchar(n) \u548c char(n) \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u975e\u5e38\u6e05\u695a\uff0cchar \u662f\u5b9a\u957f\u7684\uff0cvarchar \u662f\u53d8\u957f\u7684\uff0c\u53d8\u957f\u5b57\u6bb5\u5b9e\u9645\u5b58\u50a8\u7684\u6570\u636e\u7684\u957f\u5ea6\uff08\u5927\u5c0f\uff09\u4e0d\u56fa\u5b9a\u7684\u3002 \u6240\u4ee5\uff0c\u5728\u5b58\u50a8\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e5f\u8981\u628a\u6570\u636e\u5360\u7528\u7684\u5927\u5c0f\u5b58\u8d77\u6765\uff0c\u5b58\u5230\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u9762\uff0c\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u624d\u80fd\u6839\u636e\u8fd9\u4e2a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u53bb\u8bfb\u53d6\u5bf9\u5e94\u957f\u5ea6\u7684\u6570\u636e\u3002\u5176\u4ed6 TEXT\u3001BLOB \u7b49\u53d8\u957f\u5b57\u6bb5\u4e5f\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684\u3002 \u4e3a\u4e86\u5c55\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u5177\u4f53\u662f\u600e\u4e48\u4fdd\u5b58\u300c\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\uff0c\u6211\u4eec\u5148\u521b\u5efa\u8fd9\u6837\u4e00\u5f20\u8868\uff0c\u5b57\u7b26\u96c6\u662f ascii\uff08\u6240\u4ee5\u6bcf\u4e00\u4e2a\u5b57\u7b26\u5360\u7528\u7684 1 \u5b57\u8282\uff09\uff0c\u884c\u683c\u5f0f\u662f Compact\uff0ct_user \u8868\u4e2d name \u548c phone \u5b57\u6bb5\u90fd\u662f\u53d8\u957f\u5b57\u6bb5\uff1a CREATE TABLE ` t_user ` ( ` id ` int ( 11 ) NOT NULL , ` name ` VARCHAR ( 20 ) DEFAULT NULL , ` phone ` VARCHAR ( 20 ) DEFAULT NULL , ` age ` int ( 11 ) DEFAULT NULL , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARACTER SET = ascii ROW_FORMAT = COMPACT ; \u73b0\u5728 t_user \u8868\u91cc\u6709\u8fd9\u4e09\u6761\u8bb0\u5f55\uff1a \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b\u770b\u770b\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684\u884c\u683c\u5f0f\u4e2d\u7684 \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u662f\u600e\u6837\u5b58\u50a8\u7684\u3002 \u5148\u6765\u770b\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1a name \u5217\u7684\u503c\u4e3a a\uff0c\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u662f 1 \u5b57\u8282\uff0c\u5341\u516d\u8fdb\u5236 0x01\uff1b phone \u5217\u7684\u503c\u4e3a 123\uff0c\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u662f 3 \u5b57\u8282\uff0c\u5341\u516d\u8fdb\u5236 0x03\uff1b age \u5217\u548c id \u5217\u4e0d\u662f\u53d8\u957f\u5b57\u6bb5\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u7528\u7ba1\u3002 \u8fd9\u4e9b\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u4f1a\u6309\u7167\u5217\u7684\u987a\u5e8f**\u9006\u5e8f\u5b58\u653e**\uff08\u7b49\u4e0b\u4f1a\u8bf4\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\uff09\uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u7684\u5185\u5bb9\u662f\u300c 03 01\u300d\uff0c\u800c\u4e0d\u662f \u300c01 03\u300d\u3002 \u540c\u6837\u7684\u9053\u7406\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u51fa**\u7b2c\u4e8c\u6761\u8bb0\u5f55**\u7684\u884c\u683c\u5f0f\u4e2d\uff0c\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u7684\u5185\u5bb9\u662f\u300c 04 02\u300d\uff0c\u5982\u4e0b\u56fe\uff1a \u7b2c\u4e09\u6761\u8bb0\u5f55**\u4e2d phone \u5217\u7684\u503c\u662f NULL\uff0c**NULL \u662f\u4e0d\u4f1a\u5b58\u653e\u5728\u884c\u683c\u5f0f\u4e2d\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\u91cc\u7684 \uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u4e0d\u9700\u8981\u4fdd\u5b58\u503c\u4e3a NULL \u7684\u53d8\u957f\u5b57\u6bb5\u7684\u957f\u5ea6\u3002 \u4e3a\u4ec0\u4e48\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u7684\u4fe1\u606f\u8981\u6309\u7167\u9006\u5e8f\u5b58\u653e\uff1f \u8fd9\u4e2a\u8bbe\u8ba1\u662f\u6709\u60f3\u6cd5\u7684\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u4e2d\u6307\u5411\u4e0b\u4e00\u4e2a\u8bb0\u5f55\u7684\u6307\u9488\uff0c\u6307\u5411\u7684\u662f\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u548c\u300c\u771f\u5b9e\u6570\u636e\u300d\u4e4b\u95f4\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u5411\u5de6\u8bfb\u5c31\u662f\u8bb0\u5f55\u5934\u4fe1\u606f\uff0c\u5411\u53f3\u8bfb\u5c31\u662f\u771f\u5b9e\u6570\u636e\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002 \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u4e2d\u7684\u4fe1\u606f\u4e4b\u6240\u4ee5\u8981\u9006\u5e8f\u5b58\u653e\uff0c\u662f\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5**\u4f7f\u5f97\u4f4d\u7f6e\u9760\u524d\u7684\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u548c\u6570\u636e\u5bf9\u5e94\u7684\u5b57\u6bb5\u957f\u5ea6\u4fe1\u606f\u53ef\u4ee5\u540c\u65f6\u5728\u4e00\u4e2a CPU Cache Line \u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63d0\u9ad8 CPU Cache \u7684\u547d\u4e2d\u7387**\u3002 \u540c\u6837\u7684\u9053\u7406\uff0c NULL \u503c\u5217\u8868\u7684\u4fe1\u606f\u4e5f\u9700\u8981\u9006\u5e8f\u5b58\u653e\u3002 \u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4ec0\u4e48\u662f CPU Cache\uff0c\u53ef\u4ee5\u770b \u8fd9\u7bc7\u6587\u7ae0 \uff0c\u8fd9\u5c5e\u4e8e\u8ba1\u7b97\u673a\u7ec4\u6210\u7684\u77e5\u8bc6\u3002 \u6bcf\u4e2a\u6570\u636e\u5e93\u8868\u7684\u884c\u683c\u5f0f\u90fd\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u300d\u5417\uff1f \u5176\u5b9e\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u4e0d\u662f\u5fc5\u987b\u7684\u3002 \u5f53\u6570\u636e\u8868\u6ca1\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u5168\u90e8\u90fd\u662f int \u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u8fd9\u65f6\u5019\u8868\u91cc\u7684\u884c\u683c\u5f0f\u5c31\u4e0d\u4f1a\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u4e86 \uff0c\u56e0\u4e3a\u6ca1\u5fc5\u8981\uff0c\u4e0d\u5982\u53bb\u6389\u4ee5\u8282\u7701\u7a7a\u95f4\u3002 \u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u53ea\u51fa\u73b0\u5728\u6570\u636e\u8868\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u65f6\u5019\u3002 2. NULL \u503c\u5217\u8868 \u00b6 \u8868\u4e2d\u7684\u67d0\u4e9b\u5217\u53ef\u80fd\u4f1a\u5b58\u50a8 NULL \u503c\uff0c\u5982\u679c\u628a\u8fd9\u4e9b NULL \u503c\u90fd\u653e\u5230\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u4e2d\u4f1a\u6bd4\u8f83\u6d6a\u8d39\u7a7a\u95f4\uff0c\u6240\u4ee5 Compact \u884c\u683c\u5f0f\u628a\u8fd9\u4e9b\u503c\u4e3a NULL \u7684\u5217\u5b58\u50a8\u5230 NULL\u503c\u5217\u8868\u4e2d\u3002 \u5982\u679c\u5b58\u5728\u5141\u8bb8 NULL \u503c\u7684\u5217\uff0c\u5219\u6bcf\u4e2a\u5217\u5bf9\u5e94\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4f4d\uff08bit\uff09\uff0c\u4e8c\u8fdb\u5236\u4f4d\u6309\u7167\u5217\u7684\u987a\u5e8f\u9006\u5e8f\u6392\u5217\u3002 \u4e8c\u8fdb\u5236\u4f4d\u7684\u503c\u4e3a 1 \u65f6\uff0c\u4ee3\u8868\u8be5\u5217\u7684\u503c\u4e3aNULL\u3002 \u4e8c\u8fdb\u5236\u4f4d\u7684\u503c\u4e3a 0 \u65f6\uff0c\u4ee3\u8868\u8be5\u5217\u7684\u503c\u4e0d\u4e3aNULL\u3002 \u53e6\u5916\uff0cNULL \u503c\u5217\u8868\u5fc5\u987b\u7528\u6574\u6570\u4e2a\u5b57\u8282\u7684\u4f4d\u8868\u793a\uff081\u5b57\u82828\u4f4d\uff09\uff0c\u5982\u679c\u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u4f4d\u4e2a\u6570\u4e0d\u8db3\u6574\u6570\u4e2a\u5b57\u8282\uff0c\u5219\u5728\u5b57\u8282\u7684\u9ad8\u4f4d\u8865 0 \u3002 \u8fd8\u662f\u4ee5 t_user \u8868\u7684\u8fd9\u4e09\u6761\u8bb0\u5f55\u4f5c\u4e3a\u4f8b\u5b50\uff1a \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b\u770b\u770b\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684\u884c\u683c\u5f0f\u4e2d\u7684 NULL \u503c\u5217\u8868\u662f\u600e\u6837\u5b58\u50a8\u7684\u3002 \u5148\u6765\u770b**\u7b2c\u4e00\u6761\u8bb0\u5f55**\uff0c\u7b2c\u4e00\u6761\u8bb0\u5f55\u6240\u6709\u5217\u90fd\u6709\u503c\uff0c\u4e0d\u5b58\u5728 NULL \u503c\uff0c\u6240\u4ee5\u7528\u4e8c\u8fdb\u5236\u6765\u8868\u793a\u662f\u9171\u7d2b\u7684\uff1a \u4f46\u662f InnoDB \u662f\u7528\u6574\u6570\u5b57\u8282\u7684\u4e8c\u8fdb\u5236\u4f4d\u6765\u8868\u793a NULL \u503c\u5217\u8868\u7684\uff0c\u73b0\u5728\u4e0d\u8db3 8 \u4f4d\uff0c\u6240\u4ee5\u8981\u5728\u9ad8\u4f4d\u8865 0\uff0c\u6700\u7ec8\u7528\u4e8c\u8fdb\u5236\u6765\u8868\u793a\u662f\u9171\u7d2b\u7684\uff1a \u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e00\u6761\u6570\u636e\uff0cNULL \u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x00\u3002 \u63a5\u4e0b\u6765\u770b**\u7b2c\u4e8c\u6761\u8bb0\u5f55**\uff0c\u7b2c\u4e8c\u6761\u8bb0\u5f55 age \u5217\u662f NULL \u503c\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e8c\u6761\u6570\u636e\uff0cNULL\u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x04\u3002 \u6700\u540e**\u7b2c\u4e09\u6761\u8bb0\u5f55**\uff0c\u7b2c\u4e09\u6761\u8bb0\u5f55 phone \u5217 \u548c age \u5217\u662f NULL \u503c\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e09\u6761\u6570\u636e\uff0cNULL \u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x06\u3002 \u6211\u4eec\u628a\u4e09\u6761\u8bb0\u5f55\u7684 NULL \u503c\u5217\u8868\u90fd\u586b\u5145\u5b8c\u6bd5\u540e\uff0c\u5b83\u4eec\u7684\u884c\u683c\u5f0f\u662f\u8fd9\u6837\u7684\uff1a \u6bcf\u4e2a\u6570\u636e\u5e93\u8868\u7684\u884c\u683c\u5f0f\u90fd\u6709\u300cNULL \u503c\u5217\u8868\u300d\u5417\uff1f NULL \u503c\u5217\u8868\u4e5f\u4e0d\u662f\u5fc5\u987b\u7684\u3002 \u5f53\u6570\u636e\u8868\u7684\u5b57\u6bb5\u90fd\u5b9a\u4e49\u6210 NOT NULL \u7684\u65f6\u5019\uff0c\u8fd9\u65f6\u5019\u8868\u91cc\u7684\u884c\u683c\u5f0f\u5c31\u4e0d\u4f1a\u6709 NULL \u503c\u5217\u8868\u4e86 \u3002 \u6240\u4ee5\u5728\u8bbe\u8ba1\u6570\u636e\u5e93\u8868\u7684\u65f6\u5019\uff0c\u901a\u5e38\u90fd\u662f\u5efa\u8bae\u5c06\u5b57\u6bb5\u8bbe\u7f6e\u4e3a NOT NULL\uff0c\u8fd9\u6837\u53ef\u4ee5\u81f3\u5c11\u8282\u7701 1 \u5b57\u8282\u7684\u7a7a\u95f4\uff08NULL \u503c\u5217\u8868\u81f3\u5c11\u5360\u7528 1 \u5b57\u8282\u7a7a\u95f4\uff09\u3002 \u300cNULL \u503c\u5217\u8868\u300d\u662f\u56fa\u5b9a 1 \u5b57\u8282\u7a7a\u95f4\u5417\uff1f\u5982\u679c\u8fd9\u6837\u7684\u8bdd\uff0c\u4e00\u6761\u8bb0\u5f55\u6709 9 \u4e2a\u5b57\u6bb5\u503c\u90fd\u662f NULL\uff0c\u8fd9\u65f6\u5019\u600e\u4e48\u8868\u793a\uff1f \u300cNULL \u503c\u5217\u8868\u300d\u7684\u7a7a\u95f4\u4e0d\u662f\u56fa\u5b9a 1 \u5b57\u8282\u7684\u3002 \u5f53\u4e00\u6761\u8bb0\u5f55\u6709 9 \u4e2a\u5b57\u6bb5\u503c\u90fd\u662f NULL\uff0c\u90a3\u4e48\u5c31\u4f1a\u521b\u5efa 2 \u5b57\u8282\u7a7a\u95f4\u7684\u300cNULL \u503c\u5217\u8868\u300d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 3. \u8bb0\u5f55\u5934\u4fe1\u606f \u00b6 \u8bb0\u5f55\u5934\u4fe1\u606f\u4e2d\u5305\u542b\u7684\u5185\u5bb9\u5f88\u591a\uff0c\u6211\u5c31\u4e0d\u4e00\u4e00\u5217\u4e3e\u4e86\uff0c\u8fd9\u91cc\u8bf4\u51e0\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\uff1a delete_mask \uff1a\u6807\u8bc6\u6b64\u6761\u6570\u636e\u662f\u5426\u88ab\u5220\u9664\u3002\u4ece\u8fd9\u91cc\u53ef\u4ee5\u77e5\u9053\uff0c\u6211\u4eec\u6267\u884c detele \u5220\u9664\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u771f\u6b63\u7684\u5220\u9664\u8bb0\u5f55\uff0c\u53ea\u662f\u5c06\u8fd9\u4e2a\u8bb0\u5f55\u7684 delete_mask \u6807\u8bb0\u4e3a 1\u3002 next_record\uff1a\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u4f4d\u7f6e\u3002\u4ece\u8fd9\u91cc\u53ef\u4ee5\u77e5\u9053\uff0c\u8bb0\u5f55\u4e0e\u8bb0\u5f55\u4e4b\u95f4\u662f\u901a\u8fc7\u94fe\u8868\u7ec4\u7ec7\u7684\u3002\u5728\u524d\u9762\u6211\u4e5f\u63d0\u5230\u4e86\uff0c\u6307\u5411\u7684\u662f\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u548c\u300c\u771f\u5b9e\u6570\u636e\u300d\u4e4b\u95f4\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u5411\u5de6\u8bfb\u5c31\u662f\u8bb0\u5f55\u5934\u4fe1\u606f\uff0c\u5411\u53f3\u8bfb\u5c31\u662f\u771f\u5b9e\u6570\u636e\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002 record_type\uff1a\u8868\u793a\u5f53\u524d\u8bb0\u5f55\u7684\u7c7b\u578b\uff0c0\u8868\u793a\u666e\u901a\u8bb0\u5f55\uff0c1\u8868\u793aB+\u6811\u975e\u53f6\u5b50\u8282\u70b9\u8bb0\u5f55\uff0c2\u8868\u793a\u6700\u5c0f\u8bb0\u5f55\uff0c3\u8868\u793a\u6700\u5927\u8bb0\u5f55 \u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e \u00b6 \u8bb0\u5f55\u771f\u5b9e\u6570\u636e\u90e8\u5206\u9664\u4e86\u6211\u4eec\u5b9a\u4e49\u7684\u5b57\u6bb5\uff0c\u8fd8\u6709\u4e09\u4e2a\u9690\u85cf\u5b57\u6bb5\uff0c\u5206\u522b\u4e3a\uff1arow_id\u3001trx_id\u3001roll_pointer\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u8fd9\u4e09\u4e2a\u5b57\u6bb5\u662f\u4ec0\u4e48\u3002 row_id \u5982\u679c\u6211\u4eec\u5efa\u8868\u7684\u65f6\u5019\u6307\u5b9a\u4e86\u4e3b\u952e\u6216\u8005\u552f\u4e00\u7ea6\u675f\u5217\uff0c\u90a3\u4e48\u5c31\u6ca1\u6709 row_id \u9690\u85cf\u5b57\u6bb5\u4e86\u3002\u5982\u679c\u65e2\u6ca1\u6709\u6307\u5b9a\u4e3b\u952e\uff0c\u53c8\u6ca1\u6709\u552f\u4e00\u7ea6\u675f\uff0c\u90a3\u4e48 InnoDB \u5c31\u4f1a\u4e3a\u8bb0\u5f55\u6dfb\u52a0 row_id \u9690\u85cf\u5b57\u6bb5\u3002row_id\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 6 \u4e2a\u5b57\u8282\u3002 trx_id \u4e8b\u52a1id\uff0c\u8868\u793a\u8fd9\u4e2a\u6570\u636e\u662f\u7531\u54ea\u4e2a\u4e8b\u52a1\u751f\u6210\u7684\u3002 trx_id\u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 6 \u4e2a\u5b57\u8282\u3002 roll_pointer \u8fd9\u6761\u8bb0\u5f55\u4e0a\u4e00\u4e2a\u7248\u672c\u7684\u6307\u9488\u3002roll_pointer \u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 7 \u4e2a\u5b57\u8282\u3002 \u5982\u679c\u4f60\u719f\u6089 MVCC \u673a\u5236\uff0c\u4f60\u5e94\u8be5\u5c31\u6e05\u695a trx_id \u548c roll_pointer \u7684\u4f5c\u7528\u4e86\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u77e5\u9053 MVCC \u673a\u5236\uff0c\u53ef\u4ee5\u770b\u5b8c \u8fd9\u7bc7\u6587\u7ae0 \uff0c\u4e00\u5b9a\u8981\u638c\u63e1\uff0c\u9762\u8bd5\u4e5f\u5f88\u7ecf\u5e38\u95ee MVCC \u662f\u600e\u4e48\u5b9e\u73b0\u7684\u3002 varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f \u00b6 \u6211\u4eec\u8981\u6e05\u695a\u4e00\u70b9\uff0c MySQL \u89c4\u5b9a\u9664\u4e86 TEXT\u3001BLOBs \u8fd9\u79cd\u5927\u5bf9\u8c61\u7c7b\u578b\u4e4b\u5916\uff0c\u5176\u4ed6\u6240\u6709\u7684\u5217\uff08\u4e0d\u5305\u62ec\u9690\u85cf\u5217\u548c\u8bb0\u5f55\u5934\u4fe1\u606f\uff09\u5360\u7528\u7684\u5b57\u8282\u957f\u5ea6\u52a0\u8d77\u6765\u4e0d\u80fd\u8d85\u8fc7 65535 \u4e2a\u5b57\u8282 \u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u884c\u8bb0\u5f55\u9664\u4e86 TEXT\u3001BLOBs \u7c7b\u578b\u7684\u5217\uff0c\u9650\u5236\u6700\u5927\u4e3a 65535 \u5b57\u8282\uff0c\u6ce8\u610f\u662f\u4e00\u884c\u7684\u603b\u957f\u5ea6\uff0c\u4e0d\u662f\u4e00\u5217\u3002 \u77e5\u9053\u4e86\u8fd9\u4e2a\u524d\u63d0\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u8fd9\u4e2a\u95ee\u9898\uff1a\u300cvarchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f\u300d varchar(n) \u5b57\u6bb5\u7c7b\u578b\u7684 n \u4ee3\u8868\u7684\u662f\u6700\u591a\u5b58\u50a8\u7684\u5b57\u7b26\u6570\u91cf\uff0c\u5e76\u4e0d\u662f\u5b57\u8282\u5927\u5c0f\u54e6\u3002 \u8981\u7b97 varchar(n) \u6700\u5927\u80fd\u5141\u8bb8\u5b58\u50a8\u7684\u5b57\u8282\u6570\uff0c\u8fd8\u8981\u770b\u6570\u636e\u5e93\u8868\u7684\u5b57\u7b26\u96c6\uff0c\u56e0\u4e3a\u5b57\u7b26\u96c6\u4ee3\u8868\u7740\uff0c1\u4e2a\u5b57\u7b26\u8981\u5360\u7528\u591a\u5c11\u5b57\u8282\uff0c\u6bd4\u5982 ascii \u5b57\u7b26\u96c6\uff0c 1 \u4e2a\u5b57\u7b26\u5360\u7528 1 \u5b57\u8282\uff0c\u90a3\u4e48 varchar(100) \u610f\u5473\u7740\u6700\u5927\u80fd\u5141\u8bb8\u5b58\u50a8 100 \u5b57\u8282\u7684\u6570\u636e\u3002 \u5355\u5b57\u6bb5\u7684\u60c5\u51b5 \u00b6 \u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u4e00\u884c\u8bb0\u5f55\u6700\u5927\u53ea\u80fd\u5b58\u50a8 65535 \u5b57\u8282\u7684\u6570\u636e\u3002 \u90a3\u5047\u8bbe\u6570\u636e\u5e93\u8868\u53ea\u6709\u4e00\u4e2a varchar(n) \u7c7b\u578b\u7684\u5217\u4e14\u5b57\u7b26\u96c6\u662f ascii\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u662f 65535 \u5417\uff1f \u4e0d\u7740\u6025\u8bf4\u7ed3\u8bba\uff0c\u6211\u4eec\u5148\u6765\u505a\u4e2a\u5b9e\u9a8c\u9a8c\u8bc1\u4e00\u4e0b\u3002 \u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a varchar(65535) \u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u5b57\u7b26\u96c6\u4e3a ascii \u7684\u6570\u636e\u5e93\u8868\u3002 CREATE TABLE test ( ` name ` VARCHAR ( 65535 ) NULL ) ENGINE = InnoDB DEFAULT CHARACTER SET = ascii ROW_FORMAT = COMPACT ; \u770b\u80fd\u4e0d\u80fd\u6210\u529f\u521b\u5efa\u4e00\u5f20\u8868\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u5931\u8d25\u4e86\u3002 \u4ece\u62a5\u9519\u4fe1\u606f\u5c31\u53ef\u4ee5\u77e5\u9053**\u4e00\u884c\u6570\u636e\u7684\u6700\u5927\u5b57\u8282\u6570\u662f 65535\uff08\u4e0d\u5305\u542b TEXT\u3001BLOBs \u8fd9\u79cd\u5927\u5bf9\u8c61\u7c7b\u578b\uff09\uff0c\u5176\u4e2d\u5305\u542b\u4e86 storage overhead**\u3002 \u95ee\u9898\u6765\u4e86\uff0c\u8fd9\u4e2a storage overhead \u662f\u4ec0\u4e48\u5462\uff1f\u5176\u5b9e\u5c31\u662f\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4**\u4e00\u884c\u6570\u636e\u7684\u6700\u5927\u5b57\u8282\u6570 65535\uff0c\u5176\u5b9e\u662f\u5305\u542b\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684**\u3002\u6240\u4ee5\uff0c \u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb storage overhead \u5360\u7528\u7684\u5b57\u8282\u6570\u3002 \u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5b58\u50a8\u5b57\u6bb5\u7c7b\u578b\u4e3a varchar(n) \u7684\u6570\u636e\u65f6\uff0c\u5176\u5b9e\u5206\u6210\u4e86\u4e09\u4e2a\u90e8\u5206\u6765\u5b58\u50a8\uff1a \u771f\u5b9e\u6570\u636e \u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570 NULL \u6807\u8bc6\uff0c\u5982\u679c\u4e0d\u5141\u8bb8\u4e3aNULL\uff0c\u8fd9\u90e8\u5206\u4e0d\u9700\u8981 \u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u591a\u5c11\uff1f \u524d\u9762\u6211\u521b\u5efa\u8868\u7684\u65f6\u5019\uff0c\u5b57\u6bb5\u662f\u5141\u8bb8\u4e3a NULL \u7684\uff0c\u6240\u4ee5**\u4f1a\u7528 1 \u5b57\u8282\u6765\u8868\u793a\u300cNULL \u503c\u5217\u8868\u300d**\u3002 \u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u591a\u5c11\uff1f \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 = \u6240\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u5360\u7528\u7684\u5b57\u8282\u6570\u4e4b\u548c\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5148\u77e5\u9053\u6bcf\u4e2a\u53d8\u957f\u5b57\u6bb5\u7684\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u9700\u8981\u7528\u591a\u5c11\u5b57\u8282\u8868\u793a\uff1f\u5177\u4f53\u60c5\u51b5\u5206\u4e3a\uff1a \u6761\u4ef6\u4e00\uff1a\u5982\u679c\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u5c0f\u4e8e\u7b49\u4e8e 255 \u5b57\u8282\uff0c\u5c31\u4f1a\u7528 1 \u5b57\u8282\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\uff1b \u6761\u4ef6\u4e8c\uff1a\u5982\u679c\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u5927\u4e8e 255 \u5b57\u8282\uff0c\u5c31\u4f1a\u7528 2 \u5b57\u8282\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\uff1b \u6211\u4eec\u8fd9\u91cc\u5b57\u6bb5\u7c7b\u578b\u662f varchar(65535) \uff0c\u5b57\u7b26\u96c6\u662f ascii\uff0c\u6240\u4ee5\u4ee3\u8868\u7740\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u662f 65535\uff0c\u7b26\u5408\u6761\u4ef6\u4e8c\uff0c\u6240\u4ee5\u4f1a\u7528 2 \u5b57\u8282\u6765\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u3002 \u56e0\u4e3a\u6211\u4eec\u8fd9\u4e2a\u6848\u4f8b\u662f\u53ea\u6709 1 \u4e2a\u53d8\u957f\u5b57\u6bb5\uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d= 1 \u4e2a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u5360\u7528\u7684\u5b57\u8282\u6570\uff0c\u4e5f\u5c31\u662f 2 \u5b57\u8282 \u3002 \u56e0\u4e3a\u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684\u3002\u6240\u4ee5\uff0c \u5728\u6570\u636e\u5e93\u8868\u53ea\u6709\u4e00\u4e2a varchar(n) \u5b57\u6bb5\u4e14\u5b57\u7b26\u96c6\u662f ascii \u7684\u60c5\u51b5\u4e0b\uff0cvarchar(n) \u4e2d n \u6700\u5927\u503c = 65535 - 2 - 1 = 65532 \u3002 \u6211\u4eec\u5148\u6765\u6d4b\u8bd5\u770b\u770b varchar(65533) \u662f\u5426\u53ef\u884c\uff1f \u53ef\u4ee5\u770b\u5230\uff0c\u8fd8\u662f\u4e0d\u884c\uff0c\u63a5\u4e0b\u6765\u770b\u770b varchar(65532) \u662f\u5426\u53ef\u884c\uff1f \u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u6210\u529f\u4e86\u3002\u8bf4\u660e\u6211\u4eec\u7684\u63a8\u8bba\u662f\u6b63\u786e\u7684\uff0c\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684\u3002 \u5f53\u7136\uff0c\u6211\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u662f\u9488\u5bf9\u5b57\u7b26\u96c6\u4e3a ascii \u60c5\u51b5\uff0c\u5982\u679c\u91c7\u7528\u7684\u662f UTF-8\uff0cvarchar(n) \u6700\u591a\u80fd\u5b58\u50a8\u7684\u6570\u636e\u8ba1\u7b97\u65b9\u5f0f\u5c31\u4e0d\u4e00\u6837\u4e86\uff1a \u5728 UTF-8 \u5b57\u7b26\u96c6\u4e0b\uff0c\u4e00\u4e2a\u5b57\u7b26\u4e32\u6700\u591a\u9700\u8981\u4e09\u4e2a\u5b57\u8282\uff0cvarchar(n) \u7684 n \u6700\u5927\u53d6\u503c\u5c31\u662f 65532/3 = 21844\u3002 \u4e0a\u9762\u6240\u8bf4\u7684\u53ea\u662f\u9488\u5bf9\u4e8e\u4e00\u4e2a\u5b57\u6bb5\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002 \u591a\u5b57\u6bb5\u7684\u60c5\u51b5 \u00b6 \u5982\u679c\u6709\u591a\u4e2a\u5b57\u6bb5\u7684\u8bdd\uff0c\u8981\u4fdd\u8bc1\u6240\u6709\u5b57\u6bb5\u7684\u957f\u5ea6 + \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 + NULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 <= 65535 \u3002 \u8fd9\u91cc\u4e3e\u4e2a\u591a\u5b57\u6bb5\u7684\u60c5\u51b5\u7684\u4f8b\u5b50\uff08\u611f\u8c22@Emoji\u540c\u5b66\u63d0\u4f9b\u7684\u4f8b\u5b50\uff09 \u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f \u00b6 MySQL \u4e2d\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\u662f\u9875\uff0c\u4e00\u4e2a\u9875\u7684\u5927\u5c0f\u4e00\u822c\u662f 16KB \uff0c\u4e5f\u5c31\u662f 16384\u5b57\u8282 \uff0c\u800c\u4e00\u4e2a varchar(n) \u7c7b\u578b\u7684\u5217\u6700\u591a\u53ef\u4ee5\u5b58\u50a8 65532\u5b57\u8282 \uff0c\u4e00\u4e9b\u5927\u5bf9\u8c61\u5982 TEXT\u3001BLOB \u53ef\u80fd\u5b58\u50a8\u66f4\u591a\u7684\u6570\u636e\uff0c\u8fd9\u65f6\u4e00\u4e2a\u9875\u53ef\u80fd\u5c31\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a**\u53d1\u751f\u884c\u6ea2\u51fa\uff0c\u591a\u7684\u6570\u636e\u5c31\u4f1a\u5b58\u5230\u53e6\u5916\u7684\u300c\u6ea2\u51fa\u9875\u300d\u4e2d**\u3002 \u5982\u679c\u4e00\u4e2a\u6570\u636e\u9875\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u81ea\u52a8\u5c06\u6ea2\u51fa\u7684\u6570\u636e\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cInnoDB \u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728 \u300c\u6570\u636e\u9875\u300d\u4e2d\u3002\u4f46\u662f\u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u6ea2\u51fa\u7684\u6570\u636e\u4f1a\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002 \u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u53ea\u4f1a\u4fdd\u5b58\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u800c\u628a\u5269\u4f59\u7684\u6570\u636e\u653e\u5728\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\uff0c\u7136\u540e\u771f\u5b9e\u6570\u636e\u5904\u7528 20 \u5b57\u8282\u5b58\u50a8\u6307\u5411\u6ea2\u51fa\u9875\u7684\u5730\u5740\uff0c\u4ece\u800c\u53ef\u4ee5\u627e\u5230\u5269\u4f59\u6570\u636e\u6240\u5728\u7684\u9875\u3002\u5927\u81f4\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u4e0a\u9762\u8fd9\u4e2a\u662f Compact \u884c\u683c\u5f0f\u5728\u53d1\u751f\u884c\u6ea2\u51fa\u540e\u7684\u5904\u7406\u3002 Compressed \u548c Dynamic \u8fd9\u4e24\u4e2a\u884c\u683c\u5f0f\u548c Compact \u975e\u5e38\u7c7b\u4f3c\uff0c\u4e3b\u8981\u7684\u533a\u522b\u5728\u4e8e\u5904\u7406\u884c\u6ea2\u51fa\u6570\u636e\u65f6\u6709\u4e9b\u533a\u522b\u3002 \u8fd9\u4e24\u79cd\u683c\u5f0f\u91c7\u7528\u5b8c\u5168\u7684\u884c\u6ea2\u51fa\u65b9\u5f0f\uff0c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u4e0d\u4f1a\u5b58\u50a8\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u53ea\u5b58\u50a8 20 \u4e2a\u5b57\u8282\u7684\u6307\u9488\u6765\u6307\u5411\u6ea2\u51fa\u9875\u3002\u800c\u5b9e\u9645\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6ea2\u51fa\u9875\u4e2d\uff0c\u770b\u8d77\u6765\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a \u603b\u7ed3 \u00b6 MySQL \u7684 NULL \u503c\u662f\u600e\u4e48\u5b58\u653e\u7684\uff1f MySQL \u7684 Compact \u884c\u683c\u5f0f\u4e2d\u4f1a\u7528\u300cNULL\u503c\u5217\u8868\u300d\u6765\u6807\u8bb0\u503c\u4e3a NULL \u7684\u5217\uff0cNULL \u503c\u5e76\u4e0d\u4f1a\u5b58\u50a8\u5728\u884c\u683c\u5f0f\u4e2d\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\u3002 NULL\u503c\u5217\u8868\u4f1a\u5360\u7528 1 \u5b57\u8282\u7a7a\u95f4\uff0c\u5f53\u8868\u4e2d\u6240\u6709\u5b57\u6bb5\u90fd\u5b9a\u4e49\u6210 NOT NULL\uff0c\u884c\u683c\u5f0f\u4e2d\u5c31\u4e0d\u4f1a\u6709 NULL\u503c\u5217\u8868\uff0c\u8fd9\u6837\u53ef\u8282\u7701 1 \u5b57\u8282\u7684\u7a7a\u95f4\u3002 MySQL \u600e\u4e48\u77e5\u9053 varchar(n) \u5b9e\u9645\u5360\u7528\u6570\u636e\u7684\u5927\u5c0f\uff1f MySQL \u7684 Compact \u884c\u683c\u5f0f\u4e2d\u4f1a\u7528\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u5b58\u50a8\u53d8\u957f\u5b57\u6bb5\u5b9e\u9645\u5360\u7528\u7684\u6570\u636e\u5927\u5c0f\u3002 varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f \u4e00\u884c\u8bb0\u5f55\u6700\u5927\u80fd\u5b58\u50a8 65535 \u5b57\u8282\u7684\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u4e2a\u662f\u5305\u542b\u300c\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\u548c\u300cNULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\u3002\u6240\u4ee5\uff0c \u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb\u8fd9\u4e24\u4e2a\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u3002 \u5982\u679c\u4e00\u5f20\u8868\u53ea\u6709\u4e00\u4e2a varchar(n) \u5b57\u6bb5\uff0c\u4e14\u5141\u8bb8\u4e3a NULL\uff0c\u5b57\u7b26\u96c6\u4e3a ascii\u3002varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a 65532\u3002 \u8ba1\u7b97\u516c\u5f0f\uff1a65535 - \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 - NULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 = 65535 - 2 - 1 = 65532\u3002 \u5982\u679c\u6709\u591a\u4e2a\u5b57\u6bb5\u7684\u8bdd\uff0c\u8981\u4fdd\u8bc1\u6240\u6709\u5b57\u6bb5\u7684\u957f\u5ea6 + \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 + NULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 <= 65535\u3002 \u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f \u5982\u679c\u4e00\u4e2a\u6570\u636e\u9875\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u81ea\u52a8\u5c06\u6ea2\u51fa\u7684\u6570\u636e\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002 Compact \u884c\u683c\u5f0f\u9488\u5bf9\u884c\u6ea2\u51fa\u7684\u5904\u7406\u662f\u8fd9\u6837\u7684\uff1a\u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u53ea\u4f1a\u4fdd\u5b58\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u800c\u628a\u5269\u4f59\u7684\u6570\u636e\u653e\u5728\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\uff0c\u7136\u540e\u771f\u5b9e\u6570\u636e\u5904\u7528 20 \u5b57\u8282\u5b58\u50a8\u6307\u5411\u6ea2\u51fa\u9875\u7684\u5730\u5740\uff0c\u4ece\u800c\u53ef\u4ee5\u627e\u5230\u5269\u4f59\u6570\u636e\u6240\u5728\u7684\u9875\u3002 Compressed \u548c Dynamic \u8fd9\u4e24\u79cd\u683c\u5f0f\u91c7\u7528\u5b8c\u5168\u7684\u884c\u6ea2\u51fa\u65b9\u5f0f\uff0c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u4e0d\u4f1a\u5b58\u50a8\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u53ea\u5b58\u50a8 20 \u4e2a\u5b57\u8282\u7684\u6307\u9488\u6765\u6307\u5411\u6ea2\u51fa\u9875\u3002\u800c\u5b9e\u9645\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6ea2\u51fa\u9875\u4e2d\u3002 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\u300b \u300aMySQL\u6280\u672f\u5185\u5e55 InnoDB\u5b58\u50a8\u5f15\u64ce\u300b \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f"},{"location":"mysql/base/row_format/#mysql","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4e4b\u524d\u6709\u4f4d\u8bfb\u8005\u5728\u9762\u5b57\u8282\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a \u5982\u679c\u4f60\u77e5\u9053 MySQL \u4e00\u884c\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u90a3\u4e48\u8fd9\u4e2a\u95ee\u9898\u5bf9\u4f60\u6ca1\u4ec0\u4e48\u96be\u5ea6\u3002 \u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4e5f\u6ca1\u5173\u7cfb\uff0c\u8fd9\u6b21\u6211\u8ddf\u5927\u5bb6\u804a\u804a MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f \u77e5\u9053\u4e86\u8fd9\u4e2a\u4e4b\u540e\uff0c\u9664\u4e86\u80fd\u5e94\u89e3\u9501\u524d\u9762\u8fd9\u9053\u9762\u8bd5\u9898\uff0c\u4f60\u8fd8\u4f1a\u89e3\u9501\u8fd9\u4e9b\u9762\u8bd5\u9898\uff1a MySQL \u7684 NULL \u503c\u4f1a\u5360\u7528\u7a7a\u95f4\u5417\uff1f MySQL \u600e\u4e48\u77e5\u9053 varchar(n) \u5b9e\u9645\u5360\u7528\u6570\u636e\u7684\u5927\u5c0f\uff1f varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f \u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f \u8fd9\u4e9b\u95ee\u9898\u770b\u4f3c\u6beb\u4e0d\u76f8\u5e72\uff0c\u5176\u5b9e\u90fd\u662f\u5728\u56f4\u7ed5\u300c MySQL \u4e00\u884c\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\u300d\u8fd9\u4e00\u4e2a\u77e5\u8bc6\u70b9\uff0c\u6240\u4ee5\u653b\u7834\u4e86\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u540e\uff0c\u8fd9\u4e9b\u95ee\u9898\u5c31\u5f15\u5203\u800c\u89e3\u4e86\u3002 \u597d\u4e86\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u53d1\u8f66\uff01","title":"MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f"},{"location":"mysql/base/row_format/#mysql_1","text":"\u5927\u5bb6\u90fd\u77e5\u9053 MySQL \u7684\u6570\u636e\u90fd\u662f\u4fdd\u5b58\u5728\u78c1\u76d8\u7684\uff0c\u90a3\u5177\u4f53\u662f\u4fdd\u5b58\u5728\u54ea\u4e2a\u6587\u4ef6\u5462\uff1f MySQL \u5b58\u50a8\u7684\u884c\u4e3a\u662f\u7531\u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\uff0cMySQL \u652f\u6301\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u4fdd\u5b58\u7684\u6587\u4ef6\u81ea\u7136\u4e5f\u4e0d\u540c\u3002 InnoDB \u662f\u6211\u4eec\u5e38\u7528\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u4e5f\u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u3002\u6240\u4ee5\uff0c\u672c\u6587\u4e3b\u8981\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u5c55\u5f00\u8ba8\u8bba\u3002 \u5148\u6765\u770b\u770b MySQL \u6570\u636e\u5e93\u7684\u6587\u4ef6\u5b58\u653e\u5728\u54ea\u4e2a\u76ee\u5f55\uff1f mysql > SHOW VARIABLES LIKE 'datadir' ; + ---------------+-----------------+ | Variable_name | Value | + ---------------+-----------------+ | datadir | / var / lib / mysql / | + ---------------+-----------------+ 1 row in set ( 0 . 00 sec ) \u6211\u4eec\u6bcf\u521b\u5efa\u4e00\u4e2a database\uff08\u6570\u636e\u5e93\uff09 \u90fd\u4f1a\u5728 /var/lib/mysql/ \u76ee\u5f55\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u4ee5 database \u4e3a\u540d\u7684\u76ee\u5f55\uff0c\u7136\u540e\u4fdd\u5b58\u8868\u7ed3\u6784\u548c\u8868\u6570\u636e\u7684\u6587\u4ef6\u90fd\u4f1a\u5b58\u653e\u5728\u8fd9\u4e2a\u76ee\u5f55\u91cc\u3002 \u6bd4\u5982\uff0c\u6211\u8fd9\u91cc\u6709\u4e00\u4e2a\u540d\u4e3a my_test \u7684 database\uff0c\u8be5 database \u91cc\u6709\u4e00\u5f20\u540d\u4e3a t_order \u6570\u636e\u5e93\u8868\u3002 \u7136\u540e\uff0c\u6211\u4eec\u8fdb\u5165 /var/lib/mysql/my_test \u76ee\u5f55\uff0c\u770b\u770b\u91cc\u9762\u6709\u4ec0\u4e48\u6587\u4ef6\uff1f [ root@xiaolin ~ ] #ls /var/lib/mysql/my_test db.opt t_order.frm t_order.ibd \u53ef\u4ee5\u770b\u5230\uff0c\u5171\u6709\u4e09\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e09\u4e2a\u6587\u4ef6\u5206\u522b\u4ee3\u8868\u7740\uff1a db.opt\uff0c\u7528\u6765\u5b58\u50a8\u5f53\u524d\u6570\u636e\u5e93\u7684\u9ed8\u8ba4\u5b57\u7b26\u96c6\u548c\u5b57\u7b26\u6821\u9a8c\u89c4\u5219\u3002 t_order.frm \uff0ct_order \u7684**\u8868\u7ed3\u6784**\u4f1a\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u3002\u5728 MySQL \u4e2d\u5efa\u7acb\u4e00\u5f20\u8868\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a.frm \u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u662f\u7528\u6765\u4fdd\u5b58\u6bcf\u4e2a\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\u7684\uff0c\u4e3b\u8981\u5305\u542b\u8868\u7ed3\u6784\u5b9a\u4e49\u3002 t_order.ibd\uff0ct_order \u7684**\u8868\u6570\u636e**\u4f1a\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u3002\u8868\u6570\u636e\u65e2\u53ef\u4ee5\u5b58\u5728\u5171\u4eab\u8868\u7a7a\u95f4\u6587\u4ef6\uff08\u6587\u4ef6\u540d\uff1aibdata1\uff09\u91cc\uff0c\u4e5f\u53ef\u4ee5\u5b58\u653e\u5728\u72ec\u5360\u8868\u7a7a\u95f4\u6587\u4ef6\uff08\u6587\u4ef6\u540d\uff1a\u8868\u540d\u5b57.ibd\uff09\u3002\u8fd9\u4e2a\u884c\u4e3a\u662f\u7531\u53c2\u6570 innodb_file_per_table \u63a7\u5236\u7684\uff0c\u82e5\u8bbe\u7f6e\u4e86\u53c2\u6570 innodb_file_per_table \u4e3a 1\uff0c\u5219\u4f1a\u5c06\u5b58\u50a8\u7684\u6570\u636e\u3001\u7d22\u5f15\u7b49\u4fe1\u606f\u5355\u72ec\u5b58\u50a8\u5728\u4e00\u4e2a\u72ec\u5360\u8868\u7a7a\u95f4\uff0c\u4ece MySQL 5.6.6 \u7248\u672c\u5f00\u59cb\uff0c\u5b83\u7684\u9ed8\u8ba4\u503c\u5c31\u662f 1 \u4e86\uff0c\u56e0\u6b64\u4ece\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\uff0c MySQL \u4e2d\u6bcf\u4e00\u5f20\u8868\u7684\u6570\u636e\u90fd\u5b58\u653e\u5728\u4e00\u4e2a\u72ec\u7acb\u7684 .idb \u6587\u4ef6\u3002 \u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u5f20\u6570\u636e\u5e93\u8868\u7684\u6570\u636e\u662f\u4fdd\u5b58\u5728\u300c \u8868\u540d\u5b57.idb \u300d\u7684\u6587\u4ef6\u91cc\u7684\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e5f\u79f0\u4e3a\u72ec\u5360\u8868\u7a7a\u95f4\u6587\u4ef6\u3002","title":"MySQL \u7684\u6570\u636e\u5b58\u653e\u5728\u54ea\u4e2a\u6587\u4ef6\uff1f"},{"location":"mysql/base/row_format/#_1","text":"\u8868\u7a7a\u95f4\u7531\u6bb5\uff08segment\uff09\u3001\u533a\uff08extent\uff09\u3001\u9875\uff08page\uff09\u3001\u884c\uff08row\uff09\u7ec4\u6210 \uff0cInnoDB\u5b58\u50a8\u5f15\u64ce\u7684\u903b\u8f91\u5b58\u50a8\u7ed3\u6784\u5927\u81f4\u5982\u4e0b\u56fe\uff1a \u4e0b\u9762\u6211\u4eec\u4ece\u4e0b\u5f80\u4e0a\u4e00\u4e2a\u4e2a\u770b\u770b\u3002","title":"\u8868\u7a7a\u95f4\u6587\u4ef6\u7684\u7ed3\u6784\u662f\u600e\u4e48\u6837\u7684\uff1f"},{"location":"mysql/base/row_format/#1row","text":"\u6570\u636e\u5e93\u8868\u4e2d\u7684\u8bb0\u5f55\u90fd\u662f\u6309\u884c\uff08row\uff09\u8fdb\u884c\u5b58\u653e\u7684\uff0c\u6bcf\u884c\u8bb0\u5f55\u6839\u636e\u4e0d\u540c\u7684\u884c\u683c\u5f0f\uff0c\u6709\u4e0d\u540c\u7684\u5b58\u50a8\u7ed3\u6784\u3002 \u540e\u9762\u6211\u4eec\u8be6\u7ec6\u4ecb\u7ecd InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u884c\u683c\u5f0f\uff0c\u4e5f\u662f\u672c\u6587\u91cd\u70b9\u4ecb\u7ecd\u7684\u5185\u5bb9\u3002","title":"1\u3001\u884c\uff08row\uff09"},{"location":"mysql/base/row_format/#2page","text":"\u8bb0\u5f55\u662f\u6309\u7167\u884c\u6765\u5b58\u50a8\u7684\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7684\u8bfb\u53d6\u5e76\u4e0d\u4ee5\u300c\u884c\u300d\u4e3a\u5355\u4f4d\uff0c\u5426\u5219\u4e00\u6b21\u8bfb\u53d6\uff08\u4e5f\u5c31\u662f\u4e00\u6b21 I/O \u64cd\u4f5c\uff09\u53ea\u80fd\u5904\u7406\u4e00\u884c\u6570\u636e\uff0c\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\u3002 \u56e0\u6b64\uff0c InnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u9700\u8981\u8bfb\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u5c06\u8fd9\u4e2a\u884c\u8bb0\u5f55\u4ece\u78c1\u76d8\u8bfb\u51fa\u6765\uff0c\u800c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\uff0c\u5c06\u5176\u6574\u4f53\u8bfb\u5165\u5185\u5b58\u3002 \u9ed8\u8ba4\u6bcf\u4e2a\u9875\u7684\u5927\u5c0f\u4e3a 16KB \uff0c\u4e5f\u5c31\u662f\u6700\u591a\u80fd\u4fdd\u8bc1 16KB \u7684\u8fde\u7eed\u5b58\u50a8\u7a7a\u95f4\u3002 \u9875\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\u78c1\u76d8\u7ba1\u7406\u7684\u6700\u5c0f\u5355\u5143\uff0c\u610f\u5473\u7740\u6570\u636e\u5e93\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u4ee5 16KB \u4e3a\u5355\u4f4d\u7684\uff0c\u4e00\u6b21\u6700\u5c11\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6 16K \u7684\u5185\u5bb9\u5230\u5185\u5b58\u4e2d\uff0c\u4e00\u6b21\u6700\u5c11\u628a\u5185\u5b58\u4e2d\u7684 16K \u5185\u5bb9\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002 \u9875\u7684\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u5e38\u89c1\u7684\u6709\u6570\u636e\u9875\u3001undo \u65e5\u5fd7\u9875\u3001\u6ea2\u51fa\u9875\u7b49\u7b49\u3002\u6570\u636e\u8868\u4e2d\u7684\u884c\u8bb0\u5f55\u662f\u7528\u300c\u6570\u636e\u9875\u300d\u6765\u7ba1\u7406\u7684\uff0c\u6570\u636e\u9875\u7684\u7ed3\u6784\u8fd9\u91cc\u6211\u5c31\u4e0d\u8bb2\u7ec6\u8bf4\u4e86\uff0c\u4e4b\u524d\u6587\u7ae0\u6709\u8bf4\u8fc7\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u53bb\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a \u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811 \u603b\u4e4b\u77e5\u9053\u8868\u4e2d\u7684\u8bb0\u5f55\u5b58\u50a8\u5728\u300c\u6570\u636e\u9875\u300d\u91cc\u9762\u5c31\u884c\u3002","title":"2\u3001\u9875\uff08page\uff09"},{"location":"mysql/base/row_format/#3extent","text":"\u6211\u4eec\u77e5\u9053 InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u7528 B+ \u6811\u6765\u7ec4\u7ec7\u6570\u636e\u7684\u3002 B+ \u6811\u4e2d\u6bcf\u4e00\u5c42\u90fd\u662f\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u8fde\u63a5\u8d77\u6765\u7684\uff0c\u5982\u679c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\u6765\u5206\u914d\u5b58\u50a8\u7a7a\u95f4\uff0c\u90a3\u4e48\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u4e24\u4e2a\u9875\u4e4b\u95f4\u7684\u7269\u7406\u4f4d\u7f6e\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u53ef\u80fd\u79bb\u5f97\u975e\u5e38\u8fdc\uff0c\u90a3\u4e48\u78c1\u76d8\u67e5\u8be2\u65f6\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u968f\u673aI/O\uff0c\u968f\u673a I/O \u662f\u975e\u5e38\u6162\u7684\u3002 \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u8ba9\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u9875\u7684\u7269\u7406\u4f4d\u7f6e\u4e5f\u76f8\u90bb\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528\u987a\u5e8f I/O \u4e86\uff0c\u90a3\u4e48\u5728\u8303\u56f4\u67e5\u8be2\uff08\u626b\u63cf\u53f6\u5b50\u8282\u70b9\uff09\u7684\u65f6\u5019\u6027\u80fd\u5c31\u4f1a\u5f88\u9ad8\u3002 \u90a3\u5177\u4f53\u600e\u4e48\u89e3\u51b3\u5462\uff1f \u5728\u8868\u4e2d\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\uff0c\u4e3a\u67d0\u4e2a\u7d22\u5f15\u5206\u914d\u7a7a\u95f4\u7684\u65f6\u5019\u5c31\u4e0d\u518d\u6309\u7167\u9875\u4e3a\u5355\u4f4d\u5206\u914d\u4e86\uff0c\u800c\u662f\u6309\u7167\u533a\uff08extent\uff09\u4e3a\u5355\u4f4d\u5206\u914d\u3002\u6bcf\u4e2a\u533a\u7684\u5927\u5c0f\u4e3a 1MB\uff0c\u5bf9\u4e8e 16KB \u7684\u9875\u6765\u8bf4\uff0c\u8fde\u7eed\u7684 64 \u4e2a\u9875\u4f1a\u88ab\u5212\u4e3a\u4e00\u4e2a\u533a\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u9875\u7684\u7269\u7406\u4f4d\u7f6e\u4e5f\u76f8\u90bb\uff0c\u5c31\u80fd\u4f7f\u7528\u987a\u5e8f I/O \u4e86 \u3002","title":"3\u3001\u533a\uff08extent\uff09"},{"location":"mysql/base/row_format/#4segment","text":"\u8868\u7a7a\u95f4\u662f\u7531\u5404\u4e2a\u6bb5\uff08segment\uff09\u7ec4\u6210\u7684\uff0c\u6bb5\u662f\u7531\u591a\u4e2a\u533a\uff08extent\uff09\u7ec4\u6210\u7684\u3002\u6bb5\u4e00\u822c\u5206\u4e3a\u6570\u636e\u6bb5\u3001\u7d22\u5f15\u6bb5\u548c\u56de\u6eda\u6bb5\u7b49\u3002 \u7d22\u5f15\u6bb5\uff1a\u5b58\u653e B + \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u7684\u533a\u7684\u96c6\u5408\uff1b \u6570\u636e\u6bb5\uff1a\u5b58\u653e B + \u6811\u7684\u53f6\u5b50\u8282\u70b9\u7684\u533a\u7684\u96c6\u5408\uff1b \u56de\u6eda\u6bb5\uff1a\u5b58\u653e\u7684\u662f\u56de\u6eda\u6570\u636e\u7684\u533a\u7684\u96c6\u5408\uff0c\u4e4b\u524d\u8bb2 \u4e8b\u52a1\u9694\u79bb \u7684\u65f6\u5019\u5c31\u4ecb\u7ecd\u5230\u4e86 MVCC \u5229\u7528\u4e86\u56de\u6eda\u6bb5\u5b9e\u73b0\u4e86\u591a\u7248\u672c\u67e5\u8be2\u6570\u636e\u3002 \u597d\u4e86\uff0c\u7ec8\u4e8e\u8bf4\u5b8c\u8868\u7a7a\u95f4\u7684\u7ed3\u6784\u4e86\u3002\u63a5\u4e0b\u6765\uff0c\u5c31\u5177\u4f53\u8bb2\u4e00\u4e0b InnoDB \u7684\u884c\u683c\u5f0f\u4e86\u3002 \u4e4b\u6240\u4ee5\u8981\u7ed5\u4e00\u5927\u5708\u624d\u8bb2\u884c\u8bb0\u5f55\u7684\u683c\u5f0f\uff0c\u4e3b\u8981\u662f\u60f3\u8ba9\u5927\u5bb6\u77e5\u9053\u884c\u8bb0\u5f55\u662f\u5b58\u50a8\u5728\u54ea\u4e2a\u6587\u4ef6\uff0c\u4ee5\u53ca\u884c\u8bb0\u5f55\u5728\u8fd9\u4e2a\u8868\u7a7a\u95f4\u6587\u4ef6\u4e2d\u7684\u54ea\u4e2a\u533a\u57df\uff0c\u6709\u4e00\u4e2a\u4ece\u4e0a\u5f80\u4e0b\u5207\u5165\u7684\u89c6\u89d2\uff0c\u8fd9\u6837\u7406\u89e3\u8d77\u6765\u4e0d\u4f1a\u89c9\u5f97\u5f88\u62bd\u8c61\u3002","title":"4\u3001\u6bb5\uff08segment\uff09"},{"location":"mysql/base/row_format/#innodb","text":"\u884c\u683c\u5f0f\uff08row_format\uff09\uff0c\u5c31\u662f\u4e00\u6761\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\u3002 InnoDB \u63d0\u4f9b\u4e86 4 \u79cd\u884c\u683c\u5f0f\uff0c\u5206\u522b\u662f Redundant\u3001Compact\u3001Dynamic\u548c Compressed \u884c\u683c\u5f0f\u3002 Redundant \u662f\u5f88\u53e4\u8001\u7684\u884c\u683c\u5f0f\u4e86\uff0c MySQL 5.0 \u7248\u672c\u4e4b\u524d\u7528\u7684\u884c\u683c\u5f0f\uff0c\u73b0\u5728\u57fa\u672c\u6ca1\u4eba\u7528\u4e86\u3002 \u7531\u4e8e Redundant \u4e0d\u662f\u4e00\u79cd\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u6240\u4ee5 MySQL 5.0 \u4e4b\u540e\u5f15\u5165\u4e86 Compact \u884c\u8bb0\u5f55\u5b58\u50a8\u65b9\u5f0f\uff0cCompact \u662f\u4e00\u79cd\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u8bbe\u8ba1\u7684\u521d\u8877\u5c31\u662f\u4e3a\u4e86\u8ba9\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u884c\u8bb0\u5f55\uff0c\u4ece MySQL 5.1 \u7248\u672c\u4e4b\u540e\uff0c\u884c\u683c\u5f0f\u9ed8\u8ba4\u8bbe\u7f6e\u6210 Compact\u3002 Dynamic \u548c Compressed \u4e24\u4e2a\u90fd\u662f\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u5b83\u4eec\u7684\u884c\u683c\u5f0f\u90fd\u548c Compact \u5dee\u4e0d\u591a\uff0c\u56e0\u4e3a\u90fd\u662f\u57fa\u4e8e Compact \u6539\u8fdb\u4e00\u70b9\u4e1c\u897f\u3002\u4ece MySQL5.7 \u7248\u672c\u4e4b\u540e\uff0c\u9ed8\u8ba4\u4f7f\u7528 Dynamic \u884c\u683c\u5f0f\u3002 Redundant \u884c\u683c\u5f0f\u6211\u8fd9\u91cc\u5c31\u4e0d\u8bb2\u4e86\uff0c\u56e0\u4e3a\u73b0\u5728\u57fa\u672c\u6ca1\u4eba\u7528\u4e86\uff0c\u8fd9\u6b21\u91cd\u70b9\u4ecb\u7ecd Compact \u884c\u683c\u5f0f\uff0c\u56e0\u4e3a Dynamic \u548c Compressed \u8fd9\u4e24\u4e2a\u884c\u683c\u5f0f\u8ddf Compact \u975e\u5e38\u50cf\u3002 \u6240\u4ee5\uff0c\u5f04\u61c2\u4e86 Compact \u884c\u683c\u5f0f\uff0c\u4e4b\u540e\u4f60\u4eec\u5728\u53bb\u4e86\u89e3\u5176\u4ed6\u884c\u683c\u5f0f\uff0c\u5f88\u5feb\u4e5f\u80fd\u770b\u61c2\u3002","title":"InnoDB \u884c\u683c\u5f0f\u6709\u54ea\u4e9b\uff1f"},{"location":"mysql/base/row_format/#compact","text":"\u5148\u8ddf Compact \u884c\u683c\u5f0f\u6df7\u4e2a\u8138\u719f\uff0c\u5b83\u957f\u8fd9\u6837\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u6761\u5b8c\u6574\u7684\u8bb0\u5f55\u5206\u4e3a\u300c\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u300d\u548c\u300c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u300d\u4e24\u4e2a\u90e8\u5206\u3002 \u63a5\u4e0b\u91cc\uff0c\u5206\u522b\u8be6\u7ec6\u8bf4\u4e0b\u3002","title":"COMPACT \u884c\u683c\u5f0f\u957f\u4ec0\u4e48\u6837\uff1f"},{"location":"mysql/base/row_format/#_2","text":"\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u5305\u542b 3 \u4e2a\u90e8\u5206\uff1a\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u3001NULL \u503c\u5217\u8868\u3001\u8bb0\u5f55\u5934\u4fe1\u606f\u3002","title":"\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f"},{"location":"mysql/base/row_format/#1","text":"varchar(n) \u548c char(n) \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u975e\u5e38\u6e05\u695a\uff0cchar \u662f\u5b9a\u957f\u7684\uff0cvarchar \u662f\u53d8\u957f\u7684\uff0c\u53d8\u957f\u5b57\u6bb5\u5b9e\u9645\u5b58\u50a8\u7684\u6570\u636e\u7684\u957f\u5ea6\uff08\u5927\u5c0f\uff09\u4e0d\u56fa\u5b9a\u7684\u3002 \u6240\u4ee5\uff0c\u5728\u5b58\u50a8\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e5f\u8981\u628a\u6570\u636e\u5360\u7528\u7684\u5927\u5c0f\u5b58\u8d77\u6765\uff0c\u5b58\u5230\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u9762\uff0c\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u624d\u80fd\u6839\u636e\u8fd9\u4e2a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u53bb\u8bfb\u53d6\u5bf9\u5e94\u957f\u5ea6\u7684\u6570\u636e\u3002\u5176\u4ed6 TEXT\u3001BLOB \u7b49\u53d8\u957f\u5b57\u6bb5\u4e5f\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684\u3002 \u4e3a\u4e86\u5c55\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u5177\u4f53\u662f\u600e\u4e48\u4fdd\u5b58\u300c\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\uff0c\u6211\u4eec\u5148\u521b\u5efa\u8fd9\u6837\u4e00\u5f20\u8868\uff0c\u5b57\u7b26\u96c6\u662f ascii\uff08\u6240\u4ee5\u6bcf\u4e00\u4e2a\u5b57\u7b26\u5360\u7528\u7684 1 \u5b57\u8282\uff09\uff0c\u884c\u683c\u5f0f\u662f Compact\uff0ct_user \u8868\u4e2d name \u548c phone \u5b57\u6bb5\u90fd\u662f\u53d8\u957f\u5b57\u6bb5\uff1a CREATE TABLE ` t_user ` ( ` id ` int ( 11 ) NOT NULL , ` name ` VARCHAR ( 20 ) DEFAULT NULL , ` phone ` VARCHAR ( 20 ) DEFAULT NULL , ` age ` int ( 11 ) DEFAULT NULL , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARACTER SET = ascii ROW_FORMAT = COMPACT ; \u73b0\u5728 t_user \u8868\u91cc\u6709\u8fd9\u4e09\u6761\u8bb0\u5f55\uff1a \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b\u770b\u770b\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684\u884c\u683c\u5f0f\u4e2d\u7684 \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u662f\u600e\u6837\u5b58\u50a8\u7684\u3002 \u5148\u6765\u770b\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1a name \u5217\u7684\u503c\u4e3a a\uff0c\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u662f 1 \u5b57\u8282\uff0c\u5341\u516d\u8fdb\u5236 0x01\uff1b phone \u5217\u7684\u503c\u4e3a 123\uff0c\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u662f 3 \u5b57\u8282\uff0c\u5341\u516d\u8fdb\u5236 0x03\uff1b age \u5217\u548c id \u5217\u4e0d\u662f\u53d8\u957f\u5b57\u6bb5\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u7528\u7ba1\u3002 \u8fd9\u4e9b\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u4f1a\u6309\u7167\u5217\u7684\u987a\u5e8f**\u9006\u5e8f\u5b58\u653e**\uff08\u7b49\u4e0b\u4f1a\u8bf4\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\uff09\uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u7684\u5185\u5bb9\u662f\u300c 03 01\u300d\uff0c\u800c\u4e0d\u662f \u300c01 03\u300d\u3002 \u540c\u6837\u7684\u9053\u7406\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u51fa**\u7b2c\u4e8c\u6761\u8bb0\u5f55**\u7684\u884c\u683c\u5f0f\u4e2d\uff0c\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u7684\u5185\u5bb9\u662f\u300c 04 02\u300d\uff0c\u5982\u4e0b\u56fe\uff1a \u7b2c\u4e09\u6761\u8bb0\u5f55**\u4e2d phone \u5217\u7684\u503c\u662f NULL\uff0c**NULL \u662f\u4e0d\u4f1a\u5b58\u653e\u5728\u884c\u683c\u5f0f\u4e2d\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\u91cc\u7684 \uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u4e0d\u9700\u8981\u4fdd\u5b58\u503c\u4e3a NULL \u7684\u53d8\u957f\u5b57\u6bb5\u7684\u957f\u5ea6\u3002 \u4e3a\u4ec0\u4e48\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u7684\u4fe1\u606f\u8981\u6309\u7167\u9006\u5e8f\u5b58\u653e\uff1f \u8fd9\u4e2a\u8bbe\u8ba1\u662f\u6709\u60f3\u6cd5\u7684\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u4e2d\u6307\u5411\u4e0b\u4e00\u4e2a\u8bb0\u5f55\u7684\u6307\u9488\uff0c\u6307\u5411\u7684\u662f\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u548c\u300c\u771f\u5b9e\u6570\u636e\u300d\u4e4b\u95f4\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u5411\u5de6\u8bfb\u5c31\u662f\u8bb0\u5f55\u5934\u4fe1\u606f\uff0c\u5411\u53f3\u8bfb\u5c31\u662f\u771f\u5b9e\u6570\u636e\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002 \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u4e2d\u7684\u4fe1\u606f\u4e4b\u6240\u4ee5\u8981\u9006\u5e8f\u5b58\u653e\uff0c\u662f\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5**\u4f7f\u5f97\u4f4d\u7f6e\u9760\u524d\u7684\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u548c\u6570\u636e\u5bf9\u5e94\u7684\u5b57\u6bb5\u957f\u5ea6\u4fe1\u606f\u53ef\u4ee5\u540c\u65f6\u5728\u4e00\u4e2a CPU Cache Line \u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63d0\u9ad8 CPU Cache \u7684\u547d\u4e2d\u7387**\u3002 \u540c\u6837\u7684\u9053\u7406\uff0c NULL \u503c\u5217\u8868\u7684\u4fe1\u606f\u4e5f\u9700\u8981\u9006\u5e8f\u5b58\u653e\u3002 \u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4ec0\u4e48\u662f CPU Cache\uff0c\u53ef\u4ee5\u770b \u8fd9\u7bc7\u6587\u7ae0 \uff0c\u8fd9\u5c5e\u4e8e\u8ba1\u7b97\u673a\u7ec4\u6210\u7684\u77e5\u8bc6\u3002 \u6bcf\u4e2a\u6570\u636e\u5e93\u8868\u7684\u884c\u683c\u5f0f\u90fd\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u300d\u5417\uff1f \u5176\u5b9e\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u4e0d\u662f\u5fc5\u987b\u7684\u3002 \u5f53\u6570\u636e\u8868\u6ca1\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u5168\u90e8\u90fd\u662f int \u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u8fd9\u65f6\u5019\u8868\u91cc\u7684\u884c\u683c\u5f0f\u5c31\u4e0d\u4f1a\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u4e86 \uff0c\u56e0\u4e3a\u6ca1\u5fc5\u8981\uff0c\u4e0d\u5982\u53bb\u6389\u4ee5\u8282\u7701\u7a7a\u95f4\u3002 \u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u53ea\u51fa\u73b0\u5728\u6570\u636e\u8868\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u65f6\u5019\u3002","title":"1. \u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868"},{"location":"mysql/base/row_format/#2-null","text":"\u8868\u4e2d\u7684\u67d0\u4e9b\u5217\u53ef\u80fd\u4f1a\u5b58\u50a8 NULL \u503c\uff0c\u5982\u679c\u628a\u8fd9\u4e9b NULL \u503c\u90fd\u653e\u5230\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u4e2d\u4f1a\u6bd4\u8f83\u6d6a\u8d39\u7a7a\u95f4\uff0c\u6240\u4ee5 Compact \u884c\u683c\u5f0f\u628a\u8fd9\u4e9b\u503c\u4e3a NULL \u7684\u5217\u5b58\u50a8\u5230 NULL\u503c\u5217\u8868\u4e2d\u3002 \u5982\u679c\u5b58\u5728\u5141\u8bb8 NULL \u503c\u7684\u5217\uff0c\u5219\u6bcf\u4e2a\u5217\u5bf9\u5e94\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4f4d\uff08bit\uff09\uff0c\u4e8c\u8fdb\u5236\u4f4d\u6309\u7167\u5217\u7684\u987a\u5e8f\u9006\u5e8f\u6392\u5217\u3002 \u4e8c\u8fdb\u5236\u4f4d\u7684\u503c\u4e3a 1 \u65f6\uff0c\u4ee3\u8868\u8be5\u5217\u7684\u503c\u4e3aNULL\u3002 \u4e8c\u8fdb\u5236\u4f4d\u7684\u503c\u4e3a 0 \u65f6\uff0c\u4ee3\u8868\u8be5\u5217\u7684\u503c\u4e0d\u4e3aNULL\u3002 \u53e6\u5916\uff0cNULL \u503c\u5217\u8868\u5fc5\u987b\u7528\u6574\u6570\u4e2a\u5b57\u8282\u7684\u4f4d\u8868\u793a\uff081\u5b57\u82828\u4f4d\uff09\uff0c\u5982\u679c\u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u4f4d\u4e2a\u6570\u4e0d\u8db3\u6574\u6570\u4e2a\u5b57\u8282\uff0c\u5219\u5728\u5b57\u8282\u7684\u9ad8\u4f4d\u8865 0 \u3002 \u8fd8\u662f\u4ee5 t_user \u8868\u7684\u8fd9\u4e09\u6761\u8bb0\u5f55\u4f5c\u4e3a\u4f8b\u5b50\uff1a \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b\u770b\u770b\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684\u884c\u683c\u5f0f\u4e2d\u7684 NULL \u503c\u5217\u8868\u662f\u600e\u6837\u5b58\u50a8\u7684\u3002 \u5148\u6765\u770b**\u7b2c\u4e00\u6761\u8bb0\u5f55**\uff0c\u7b2c\u4e00\u6761\u8bb0\u5f55\u6240\u6709\u5217\u90fd\u6709\u503c\uff0c\u4e0d\u5b58\u5728 NULL \u503c\uff0c\u6240\u4ee5\u7528\u4e8c\u8fdb\u5236\u6765\u8868\u793a\u662f\u9171\u7d2b\u7684\uff1a \u4f46\u662f InnoDB \u662f\u7528\u6574\u6570\u5b57\u8282\u7684\u4e8c\u8fdb\u5236\u4f4d\u6765\u8868\u793a NULL \u503c\u5217\u8868\u7684\uff0c\u73b0\u5728\u4e0d\u8db3 8 \u4f4d\uff0c\u6240\u4ee5\u8981\u5728\u9ad8\u4f4d\u8865 0\uff0c\u6700\u7ec8\u7528\u4e8c\u8fdb\u5236\u6765\u8868\u793a\u662f\u9171\u7d2b\u7684\uff1a \u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e00\u6761\u6570\u636e\uff0cNULL \u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x00\u3002 \u63a5\u4e0b\u6765\u770b**\u7b2c\u4e8c\u6761\u8bb0\u5f55**\uff0c\u7b2c\u4e8c\u6761\u8bb0\u5f55 age \u5217\u662f NULL \u503c\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e8c\u6761\u6570\u636e\uff0cNULL\u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x04\u3002 \u6700\u540e**\u7b2c\u4e09\u6761\u8bb0\u5f55**\uff0c\u7b2c\u4e09\u6761\u8bb0\u5f55 phone \u5217 \u548c age \u5217\u662f NULL \u503c\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e09\u6761\u6570\u636e\uff0cNULL \u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x06\u3002 \u6211\u4eec\u628a\u4e09\u6761\u8bb0\u5f55\u7684 NULL \u503c\u5217\u8868\u90fd\u586b\u5145\u5b8c\u6bd5\u540e\uff0c\u5b83\u4eec\u7684\u884c\u683c\u5f0f\u662f\u8fd9\u6837\u7684\uff1a \u6bcf\u4e2a\u6570\u636e\u5e93\u8868\u7684\u884c\u683c\u5f0f\u90fd\u6709\u300cNULL \u503c\u5217\u8868\u300d\u5417\uff1f NULL \u503c\u5217\u8868\u4e5f\u4e0d\u662f\u5fc5\u987b\u7684\u3002 \u5f53\u6570\u636e\u8868\u7684\u5b57\u6bb5\u90fd\u5b9a\u4e49\u6210 NOT NULL \u7684\u65f6\u5019\uff0c\u8fd9\u65f6\u5019\u8868\u91cc\u7684\u884c\u683c\u5f0f\u5c31\u4e0d\u4f1a\u6709 NULL \u503c\u5217\u8868\u4e86 \u3002 \u6240\u4ee5\u5728\u8bbe\u8ba1\u6570\u636e\u5e93\u8868\u7684\u65f6\u5019\uff0c\u901a\u5e38\u90fd\u662f\u5efa\u8bae\u5c06\u5b57\u6bb5\u8bbe\u7f6e\u4e3a NOT NULL\uff0c\u8fd9\u6837\u53ef\u4ee5\u81f3\u5c11\u8282\u7701 1 \u5b57\u8282\u7684\u7a7a\u95f4\uff08NULL \u503c\u5217\u8868\u81f3\u5c11\u5360\u7528 1 \u5b57\u8282\u7a7a\u95f4\uff09\u3002 \u300cNULL \u503c\u5217\u8868\u300d\u662f\u56fa\u5b9a 1 \u5b57\u8282\u7a7a\u95f4\u5417\uff1f\u5982\u679c\u8fd9\u6837\u7684\u8bdd\uff0c\u4e00\u6761\u8bb0\u5f55\u6709 9 \u4e2a\u5b57\u6bb5\u503c\u90fd\u662f NULL\uff0c\u8fd9\u65f6\u5019\u600e\u4e48\u8868\u793a\uff1f \u300cNULL \u503c\u5217\u8868\u300d\u7684\u7a7a\u95f4\u4e0d\u662f\u56fa\u5b9a 1 \u5b57\u8282\u7684\u3002 \u5f53\u4e00\u6761\u8bb0\u5f55\u6709 9 \u4e2a\u5b57\u6bb5\u503c\u90fd\u662f NULL\uff0c\u90a3\u4e48\u5c31\u4f1a\u521b\u5efa 2 \u5b57\u8282\u7a7a\u95f4\u7684\u300cNULL \u503c\u5217\u8868\u300d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002","title":"2. NULL \u503c\u5217\u8868"},{"location":"mysql/base/row_format/#3","text":"\u8bb0\u5f55\u5934\u4fe1\u606f\u4e2d\u5305\u542b\u7684\u5185\u5bb9\u5f88\u591a\uff0c\u6211\u5c31\u4e0d\u4e00\u4e00\u5217\u4e3e\u4e86\uff0c\u8fd9\u91cc\u8bf4\u51e0\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\uff1a delete_mask \uff1a\u6807\u8bc6\u6b64\u6761\u6570\u636e\u662f\u5426\u88ab\u5220\u9664\u3002\u4ece\u8fd9\u91cc\u53ef\u4ee5\u77e5\u9053\uff0c\u6211\u4eec\u6267\u884c detele \u5220\u9664\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u771f\u6b63\u7684\u5220\u9664\u8bb0\u5f55\uff0c\u53ea\u662f\u5c06\u8fd9\u4e2a\u8bb0\u5f55\u7684 delete_mask \u6807\u8bb0\u4e3a 1\u3002 next_record\uff1a\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u4f4d\u7f6e\u3002\u4ece\u8fd9\u91cc\u53ef\u4ee5\u77e5\u9053\uff0c\u8bb0\u5f55\u4e0e\u8bb0\u5f55\u4e4b\u95f4\u662f\u901a\u8fc7\u94fe\u8868\u7ec4\u7ec7\u7684\u3002\u5728\u524d\u9762\u6211\u4e5f\u63d0\u5230\u4e86\uff0c\u6307\u5411\u7684\u662f\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u548c\u300c\u771f\u5b9e\u6570\u636e\u300d\u4e4b\u95f4\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u5411\u5de6\u8bfb\u5c31\u662f\u8bb0\u5f55\u5934\u4fe1\u606f\uff0c\u5411\u53f3\u8bfb\u5c31\u662f\u771f\u5b9e\u6570\u636e\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002 record_type\uff1a\u8868\u793a\u5f53\u524d\u8bb0\u5f55\u7684\u7c7b\u578b\uff0c0\u8868\u793a\u666e\u901a\u8bb0\u5f55\uff0c1\u8868\u793aB+\u6811\u975e\u53f6\u5b50\u8282\u70b9\u8bb0\u5f55\uff0c2\u8868\u793a\u6700\u5c0f\u8bb0\u5f55\uff0c3\u8868\u793a\u6700\u5927\u8bb0\u5f55","title":"3. \u8bb0\u5f55\u5934\u4fe1\u606f"},{"location":"mysql/base/row_format/#_3","text":"\u8bb0\u5f55\u771f\u5b9e\u6570\u636e\u90e8\u5206\u9664\u4e86\u6211\u4eec\u5b9a\u4e49\u7684\u5b57\u6bb5\uff0c\u8fd8\u6709\u4e09\u4e2a\u9690\u85cf\u5b57\u6bb5\uff0c\u5206\u522b\u4e3a\uff1arow_id\u3001trx_id\u3001roll_pointer\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u8fd9\u4e09\u4e2a\u5b57\u6bb5\u662f\u4ec0\u4e48\u3002 row_id \u5982\u679c\u6211\u4eec\u5efa\u8868\u7684\u65f6\u5019\u6307\u5b9a\u4e86\u4e3b\u952e\u6216\u8005\u552f\u4e00\u7ea6\u675f\u5217\uff0c\u90a3\u4e48\u5c31\u6ca1\u6709 row_id \u9690\u85cf\u5b57\u6bb5\u4e86\u3002\u5982\u679c\u65e2\u6ca1\u6709\u6307\u5b9a\u4e3b\u952e\uff0c\u53c8\u6ca1\u6709\u552f\u4e00\u7ea6\u675f\uff0c\u90a3\u4e48 InnoDB \u5c31\u4f1a\u4e3a\u8bb0\u5f55\u6dfb\u52a0 row_id \u9690\u85cf\u5b57\u6bb5\u3002row_id\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 6 \u4e2a\u5b57\u8282\u3002 trx_id \u4e8b\u52a1id\uff0c\u8868\u793a\u8fd9\u4e2a\u6570\u636e\u662f\u7531\u54ea\u4e2a\u4e8b\u52a1\u751f\u6210\u7684\u3002 trx_id\u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 6 \u4e2a\u5b57\u8282\u3002 roll_pointer \u8fd9\u6761\u8bb0\u5f55\u4e0a\u4e00\u4e2a\u7248\u672c\u7684\u6307\u9488\u3002roll_pointer \u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 7 \u4e2a\u5b57\u8282\u3002 \u5982\u679c\u4f60\u719f\u6089 MVCC \u673a\u5236\uff0c\u4f60\u5e94\u8be5\u5c31\u6e05\u695a trx_id \u548c roll_pointer \u7684\u4f5c\u7528\u4e86\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u77e5\u9053 MVCC \u673a\u5236\uff0c\u53ef\u4ee5\u770b\u5b8c \u8fd9\u7bc7\u6587\u7ae0 \uff0c\u4e00\u5b9a\u8981\u638c\u63e1\uff0c\u9762\u8bd5\u4e5f\u5f88\u7ecf\u5e38\u95ee MVCC \u662f\u600e\u4e48\u5b9e\u73b0\u7684\u3002","title":"\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e"},{"location":"mysql/base/row_format/#varcharn-n","text":"\u6211\u4eec\u8981\u6e05\u695a\u4e00\u70b9\uff0c MySQL \u89c4\u5b9a\u9664\u4e86 TEXT\u3001BLOBs \u8fd9\u79cd\u5927\u5bf9\u8c61\u7c7b\u578b\u4e4b\u5916\uff0c\u5176\u4ed6\u6240\u6709\u7684\u5217\uff08\u4e0d\u5305\u62ec\u9690\u85cf\u5217\u548c\u8bb0\u5f55\u5934\u4fe1\u606f\uff09\u5360\u7528\u7684\u5b57\u8282\u957f\u5ea6\u52a0\u8d77\u6765\u4e0d\u80fd\u8d85\u8fc7 65535 \u4e2a\u5b57\u8282 \u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u884c\u8bb0\u5f55\u9664\u4e86 TEXT\u3001BLOBs \u7c7b\u578b\u7684\u5217\uff0c\u9650\u5236\u6700\u5927\u4e3a 65535 \u5b57\u8282\uff0c\u6ce8\u610f\u662f\u4e00\u884c\u7684\u603b\u957f\u5ea6\uff0c\u4e0d\u662f\u4e00\u5217\u3002 \u77e5\u9053\u4e86\u8fd9\u4e2a\u524d\u63d0\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u8fd9\u4e2a\u95ee\u9898\uff1a\u300cvarchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f\u300d varchar(n) \u5b57\u6bb5\u7c7b\u578b\u7684 n \u4ee3\u8868\u7684\u662f\u6700\u591a\u5b58\u50a8\u7684\u5b57\u7b26\u6570\u91cf\uff0c\u5e76\u4e0d\u662f\u5b57\u8282\u5927\u5c0f\u54e6\u3002 \u8981\u7b97 varchar(n) \u6700\u5927\u80fd\u5141\u8bb8\u5b58\u50a8\u7684\u5b57\u8282\u6570\uff0c\u8fd8\u8981\u770b\u6570\u636e\u5e93\u8868\u7684\u5b57\u7b26\u96c6\uff0c\u56e0\u4e3a\u5b57\u7b26\u96c6\u4ee3\u8868\u7740\uff0c1\u4e2a\u5b57\u7b26\u8981\u5360\u7528\u591a\u5c11\u5b57\u8282\uff0c\u6bd4\u5982 ascii \u5b57\u7b26\u96c6\uff0c 1 \u4e2a\u5b57\u7b26\u5360\u7528 1 \u5b57\u8282\uff0c\u90a3\u4e48 varchar(100) \u610f\u5473\u7740\u6700\u5927\u80fd\u5141\u8bb8\u5b58\u50a8 100 \u5b57\u8282\u7684\u6570\u636e\u3002","title":"varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f"},{"location":"mysql/base/row_format/#_4","text":"\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u4e00\u884c\u8bb0\u5f55\u6700\u5927\u53ea\u80fd\u5b58\u50a8 65535 \u5b57\u8282\u7684\u6570\u636e\u3002 \u90a3\u5047\u8bbe\u6570\u636e\u5e93\u8868\u53ea\u6709\u4e00\u4e2a varchar(n) \u7c7b\u578b\u7684\u5217\u4e14\u5b57\u7b26\u96c6\u662f ascii\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u662f 65535 \u5417\uff1f \u4e0d\u7740\u6025\u8bf4\u7ed3\u8bba\uff0c\u6211\u4eec\u5148\u6765\u505a\u4e2a\u5b9e\u9a8c\u9a8c\u8bc1\u4e00\u4e0b\u3002 \u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a varchar(65535) \u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u5b57\u7b26\u96c6\u4e3a ascii \u7684\u6570\u636e\u5e93\u8868\u3002 CREATE TABLE test ( ` name ` VARCHAR ( 65535 ) NULL ) ENGINE = InnoDB DEFAULT CHARACTER SET = ascii ROW_FORMAT = COMPACT ; \u770b\u80fd\u4e0d\u80fd\u6210\u529f\u521b\u5efa\u4e00\u5f20\u8868\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u5931\u8d25\u4e86\u3002 \u4ece\u62a5\u9519\u4fe1\u606f\u5c31\u53ef\u4ee5\u77e5\u9053**\u4e00\u884c\u6570\u636e\u7684\u6700\u5927\u5b57\u8282\u6570\u662f 65535\uff08\u4e0d\u5305\u542b TEXT\u3001BLOBs \u8fd9\u79cd\u5927\u5bf9\u8c61\u7c7b\u578b\uff09\uff0c\u5176\u4e2d\u5305\u542b\u4e86 storage overhead**\u3002 \u95ee\u9898\u6765\u4e86\uff0c\u8fd9\u4e2a storage overhead \u662f\u4ec0\u4e48\u5462\uff1f\u5176\u5b9e\u5c31\u662f\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4**\u4e00\u884c\u6570\u636e\u7684\u6700\u5927\u5b57\u8282\u6570 65535\uff0c\u5176\u5b9e\u662f\u5305\u542b\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684**\u3002\u6240\u4ee5\uff0c \u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb storage overhead \u5360\u7528\u7684\u5b57\u8282\u6570\u3002 \u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5b58\u50a8\u5b57\u6bb5\u7c7b\u578b\u4e3a varchar(n) \u7684\u6570\u636e\u65f6\uff0c\u5176\u5b9e\u5206\u6210\u4e86\u4e09\u4e2a\u90e8\u5206\u6765\u5b58\u50a8\uff1a \u771f\u5b9e\u6570\u636e \u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570 NULL \u6807\u8bc6\uff0c\u5982\u679c\u4e0d\u5141\u8bb8\u4e3aNULL\uff0c\u8fd9\u90e8\u5206\u4e0d\u9700\u8981 \u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u591a\u5c11\uff1f \u524d\u9762\u6211\u521b\u5efa\u8868\u7684\u65f6\u5019\uff0c\u5b57\u6bb5\u662f\u5141\u8bb8\u4e3a NULL \u7684\uff0c\u6240\u4ee5**\u4f1a\u7528 1 \u5b57\u8282\u6765\u8868\u793a\u300cNULL \u503c\u5217\u8868\u300d**\u3002 \u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u591a\u5c11\uff1f \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 = \u6240\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u5360\u7528\u7684\u5b57\u8282\u6570\u4e4b\u548c\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5148\u77e5\u9053\u6bcf\u4e2a\u53d8\u957f\u5b57\u6bb5\u7684\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u9700\u8981\u7528\u591a\u5c11\u5b57\u8282\u8868\u793a\uff1f\u5177\u4f53\u60c5\u51b5\u5206\u4e3a\uff1a \u6761\u4ef6\u4e00\uff1a\u5982\u679c\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u5c0f\u4e8e\u7b49\u4e8e 255 \u5b57\u8282\uff0c\u5c31\u4f1a\u7528 1 \u5b57\u8282\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\uff1b \u6761\u4ef6\u4e8c\uff1a\u5982\u679c\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u5927\u4e8e 255 \u5b57\u8282\uff0c\u5c31\u4f1a\u7528 2 \u5b57\u8282\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\uff1b \u6211\u4eec\u8fd9\u91cc\u5b57\u6bb5\u7c7b\u578b\u662f varchar(65535) \uff0c\u5b57\u7b26\u96c6\u662f ascii\uff0c\u6240\u4ee5\u4ee3\u8868\u7740\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u662f 65535\uff0c\u7b26\u5408\u6761\u4ef6\u4e8c\uff0c\u6240\u4ee5\u4f1a\u7528 2 \u5b57\u8282\u6765\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u3002 \u56e0\u4e3a\u6211\u4eec\u8fd9\u4e2a\u6848\u4f8b\u662f\u53ea\u6709 1 \u4e2a\u53d8\u957f\u5b57\u6bb5\uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d= 1 \u4e2a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u5360\u7528\u7684\u5b57\u8282\u6570\uff0c\u4e5f\u5c31\u662f 2 \u5b57\u8282 \u3002 \u56e0\u4e3a\u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684\u3002\u6240\u4ee5\uff0c \u5728\u6570\u636e\u5e93\u8868\u53ea\u6709\u4e00\u4e2a varchar(n) \u5b57\u6bb5\u4e14\u5b57\u7b26\u96c6\u662f ascii \u7684\u60c5\u51b5\u4e0b\uff0cvarchar(n) \u4e2d n \u6700\u5927\u503c = 65535 - 2 - 1 = 65532 \u3002 \u6211\u4eec\u5148\u6765\u6d4b\u8bd5\u770b\u770b varchar(65533) \u662f\u5426\u53ef\u884c\uff1f \u53ef\u4ee5\u770b\u5230\uff0c\u8fd8\u662f\u4e0d\u884c\uff0c\u63a5\u4e0b\u6765\u770b\u770b varchar(65532) \u662f\u5426\u53ef\u884c\uff1f \u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u6210\u529f\u4e86\u3002\u8bf4\u660e\u6211\u4eec\u7684\u63a8\u8bba\u662f\u6b63\u786e\u7684\uff0c\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb \u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c \u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684\u3002 \u5f53\u7136\uff0c\u6211\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u662f\u9488\u5bf9\u5b57\u7b26\u96c6\u4e3a ascii \u60c5\u51b5\uff0c\u5982\u679c\u91c7\u7528\u7684\u662f UTF-8\uff0cvarchar(n) \u6700\u591a\u80fd\u5b58\u50a8\u7684\u6570\u636e\u8ba1\u7b97\u65b9\u5f0f\u5c31\u4e0d\u4e00\u6837\u4e86\uff1a \u5728 UTF-8 \u5b57\u7b26\u96c6\u4e0b\uff0c\u4e00\u4e2a\u5b57\u7b26\u4e32\u6700\u591a\u9700\u8981\u4e09\u4e2a\u5b57\u8282\uff0cvarchar(n) \u7684 n \u6700\u5927\u53d6\u503c\u5c31\u662f 65532/3 = 21844\u3002 \u4e0a\u9762\u6240\u8bf4\u7684\u53ea\u662f\u9488\u5bf9\u4e8e\u4e00\u4e2a\u5b57\u6bb5\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002","title":"\u5355\u5b57\u6bb5\u7684\u60c5\u51b5"},{"location":"mysql/base/row_format/#_5","text":"\u5982\u679c\u6709\u591a\u4e2a\u5b57\u6bb5\u7684\u8bdd\uff0c\u8981\u4fdd\u8bc1\u6240\u6709\u5b57\u6bb5\u7684\u957f\u5ea6 + \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 + NULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 <= 65535 \u3002 \u8fd9\u91cc\u4e3e\u4e2a\u591a\u5b57\u6bb5\u7684\u60c5\u51b5\u7684\u4f8b\u5b50\uff08\u611f\u8c22@Emoji\u540c\u5b66\u63d0\u4f9b\u7684\u4f8b\u5b50\uff09","title":"\u591a\u5b57\u6bb5\u7684\u60c5\u51b5"},{"location":"mysql/base/row_format/#mysql_2","text":"MySQL \u4e2d\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\u662f\u9875\uff0c\u4e00\u4e2a\u9875\u7684\u5927\u5c0f\u4e00\u822c\u662f 16KB \uff0c\u4e5f\u5c31\u662f 16384\u5b57\u8282 \uff0c\u800c\u4e00\u4e2a varchar(n) \u7c7b\u578b\u7684\u5217\u6700\u591a\u53ef\u4ee5\u5b58\u50a8 65532\u5b57\u8282 \uff0c\u4e00\u4e9b\u5927\u5bf9\u8c61\u5982 TEXT\u3001BLOB \u53ef\u80fd\u5b58\u50a8\u66f4\u591a\u7684\u6570\u636e\uff0c\u8fd9\u65f6\u4e00\u4e2a\u9875\u53ef\u80fd\u5c31\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a**\u53d1\u751f\u884c\u6ea2\u51fa\uff0c\u591a\u7684\u6570\u636e\u5c31\u4f1a\u5b58\u5230\u53e6\u5916\u7684\u300c\u6ea2\u51fa\u9875\u300d\u4e2d**\u3002 \u5982\u679c\u4e00\u4e2a\u6570\u636e\u9875\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u81ea\u52a8\u5c06\u6ea2\u51fa\u7684\u6570\u636e\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cInnoDB \u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728 \u300c\u6570\u636e\u9875\u300d\u4e2d\u3002\u4f46\u662f\u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u6ea2\u51fa\u7684\u6570\u636e\u4f1a\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002 \u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u53ea\u4f1a\u4fdd\u5b58\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u800c\u628a\u5269\u4f59\u7684\u6570\u636e\u653e\u5728\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\uff0c\u7136\u540e\u771f\u5b9e\u6570\u636e\u5904\u7528 20 \u5b57\u8282\u5b58\u50a8\u6307\u5411\u6ea2\u51fa\u9875\u7684\u5730\u5740\uff0c\u4ece\u800c\u53ef\u4ee5\u627e\u5230\u5269\u4f59\u6570\u636e\u6240\u5728\u7684\u9875\u3002\u5927\u81f4\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u4e0a\u9762\u8fd9\u4e2a\u662f Compact \u884c\u683c\u5f0f\u5728\u53d1\u751f\u884c\u6ea2\u51fa\u540e\u7684\u5904\u7406\u3002 Compressed \u548c Dynamic \u8fd9\u4e24\u4e2a\u884c\u683c\u5f0f\u548c Compact \u975e\u5e38\u7c7b\u4f3c\uff0c\u4e3b\u8981\u7684\u533a\u522b\u5728\u4e8e\u5904\u7406\u884c\u6ea2\u51fa\u6570\u636e\u65f6\u6709\u4e9b\u533a\u522b\u3002 \u8fd9\u4e24\u79cd\u683c\u5f0f\u91c7\u7528\u5b8c\u5168\u7684\u884c\u6ea2\u51fa\u65b9\u5f0f\uff0c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u4e0d\u4f1a\u5b58\u50a8\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u53ea\u5b58\u50a8 20 \u4e2a\u5b57\u8282\u7684\u6307\u9488\u6765\u6307\u5411\u6ea2\u51fa\u9875\u3002\u800c\u5b9e\u9645\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6ea2\u51fa\u9875\u4e2d\uff0c\u770b\u8d77\u6765\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a","title":"\u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f"},{"location":"mysql/base/row_format/#_6","text":"MySQL \u7684 NULL \u503c\u662f\u600e\u4e48\u5b58\u653e\u7684\uff1f MySQL \u7684 Compact \u884c\u683c\u5f0f\u4e2d\u4f1a\u7528\u300cNULL\u503c\u5217\u8868\u300d\u6765\u6807\u8bb0\u503c\u4e3a NULL \u7684\u5217\uff0cNULL \u503c\u5e76\u4e0d\u4f1a\u5b58\u50a8\u5728\u884c\u683c\u5f0f\u4e2d\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\u3002 NULL\u503c\u5217\u8868\u4f1a\u5360\u7528 1 \u5b57\u8282\u7a7a\u95f4\uff0c\u5f53\u8868\u4e2d\u6240\u6709\u5b57\u6bb5\u90fd\u5b9a\u4e49\u6210 NOT NULL\uff0c\u884c\u683c\u5f0f\u4e2d\u5c31\u4e0d\u4f1a\u6709 NULL\u503c\u5217\u8868\uff0c\u8fd9\u6837\u53ef\u8282\u7701 1 \u5b57\u8282\u7684\u7a7a\u95f4\u3002 MySQL \u600e\u4e48\u77e5\u9053 varchar(n) \u5b9e\u9645\u5360\u7528\u6570\u636e\u7684\u5927\u5c0f\uff1f MySQL \u7684 Compact \u884c\u683c\u5f0f\u4e2d\u4f1a\u7528\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u5b58\u50a8\u53d8\u957f\u5b57\u6bb5\u5b9e\u9645\u5360\u7528\u7684\u6570\u636e\u5927\u5c0f\u3002 varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f \u4e00\u884c\u8bb0\u5f55\u6700\u5927\u80fd\u5b58\u50a8 65535 \u5b57\u8282\u7684\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u4e2a\u662f\u5305\u542b\u300c\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\u548c\u300cNULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\u3002\u6240\u4ee5\uff0c \u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb\u8fd9\u4e24\u4e2a\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u3002 \u5982\u679c\u4e00\u5f20\u8868\u53ea\u6709\u4e00\u4e2a varchar(n) \u5b57\u6bb5\uff0c\u4e14\u5141\u8bb8\u4e3a NULL\uff0c\u5b57\u7b26\u96c6\u4e3a ascii\u3002varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a 65532\u3002 \u8ba1\u7b97\u516c\u5f0f\uff1a65535 - \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 - NULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 = 65535 - 2 - 1 = 65532\u3002 \u5982\u679c\u6709\u591a\u4e2a\u5b57\u6bb5\u7684\u8bdd\uff0c\u8981\u4fdd\u8bc1\u6240\u6709\u5b57\u6bb5\u7684\u957f\u5ea6 + \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 + NULL\u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 <= 65535\u3002 \u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f \u5982\u679c\u4e00\u4e2a\u6570\u636e\u9875\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u81ea\u52a8\u5c06\u6ea2\u51fa\u7684\u6570\u636e\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002 Compact \u884c\u683c\u5f0f\u9488\u5bf9\u884c\u6ea2\u51fa\u7684\u5904\u7406\u662f\u8fd9\u6837\u7684\uff1a\u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u53ea\u4f1a\u4fdd\u5b58\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u800c\u628a\u5269\u4f59\u7684\u6570\u636e\u653e\u5728\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\uff0c\u7136\u540e\u771f\u5b9e\u6570\u636e\u5904\u7528 20 \u5b57\u8282\u5b58\u50a8\u6307\u5411\u6ea2\u51fa\u9875\u7684\u5730\u5740\uff0c\u4ece\u800c\u53ef\u4ee5\u627e\u5230\u5269\u4f59\u6570\u636e\u6240\u5728\u7684\u9875\u3002 Compressed \u548c Dynamic \u8fd9\u4e24\u79cd\u683c\u5f0f\u91c7\u7528\u5b8c\u5168\u7684\u884c\u6ea2\u51fa\u65b9\u5f0f\uff0c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u4e0d\u4f1a\u5b58\u50a8\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u53ea\u5b58\u50a8 20 \u4e2a\u5b57\u8282\u7684\u6307\u9488\u6765\u6307\u5411\u6ea2\u51fa\u9875\u3002\u800c\u5b9e\u9645\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6ea2\u51fa\u9875\u4e2d\u3002 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\u300b \u300aMySQL\u6280\u672f\u5185\u5e55 InnoDB\u5b58\u50a8\u5f15\u64ce\u300b \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/buffer_pool/","text":"buffer poll\u3001Change Buffer\u3001Adaptive Hash Index\u3001Change Buffer\u3001Doublewrite Buffer \u6b63\u5728\u8d76\u7a3f\u7684\u8def\u4e0a\u3002\u3002\u3002\u3002\u3002","title":"Index"},{"location":"mysql/buffer_pool/buffer_pool/","text":"\u63ed\u5f00 Buffer Pool \u7684\u9762\u7eb1 \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4eca\u5929\u5c31\u804a MySQL \u7684 Buffer Pool\uff0c\u53d1\u8f66\uff01 \u4e3a\u4ec0\u4e48\u8981\u6709 Buffer Pool\uff1f \u00b6 \u867d\u7136\u8bf4 MySQL \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u91cc\u7684\uff0c\u4f46\u662f\u4e5f\u4e0d\u80fd\u6bcf\u6b21\u90fd\u4ece\u78c1\u76d8\u91cc\u9762\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u6837\u6027\u80fd\u662f\u6781\u5dee\u7684\u3002 \u8981\u60f3\u63d0\u5347\u67e5\u8be2\u6027\u80fd\uff0c\u52a0\u4e2a\u7f13\u5b58\u5c31\u884c\u4e86\u561b\u3002\u6240\u4ee5\uff0c\u5f53\u6570\u636e\u4ece\u78c1\u76d8\u4e2d\u53d6\u51fa\u540e\uff0c\u7f13\u5b58\u5185\u5b58\u4e2d\uff0c\u4e0b\u6b21\u67e5\u8be2\u540c\u6837\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u3002 \u4e3a\u6b64\uff0cInnodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a**\u7f13\u51b2\u6c60\uff08 Buffer Pool \uff09**\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002 \u6709\u4e86\u7f13\u51b2\u6c60\u540e\uff1a \u5f53\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u76f4\u63a5\u8bfb\u53d6 Buffer Pool \u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u518d\u53bb\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002 \u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u9996\u5148\u662f\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u6700\u540e\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002 Buffer Pool \u6709\u591a\u5927\uff1f \u00b6 Buffer Pool \u662f\u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0c\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4e0b Buffer Pool \u53ea\u6709 128MB \u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 innodb_buffer_pool_size \u53c2\u6570\u6765\u8bbe\u7f6e Buffer Pool \u7684\u5927\u5c0f\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u6210\u53ef\u7528\u7269\u7406\u5185\u5b58\u7684 60%~80%\u3002 Buffer Pool \u7f13\u5b58\u4ec0\u4e48\uff1f \u00b6 InnoDB \u4f1a\u628a\u5b58\u50a8\u7684\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u300c\u9875\u300d\uff0c\u4ee5\u9875\u4f5c\u4e3a\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e00\u4e2a\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16KB\u3002\u56e0\u6b64\uff0cBuffer Pool \u540c\u6837\u9700\u8981\u6309\u300c\u9875\u300d\u6765\u5212\u5206\u3002 \u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0c InnoDB \u4f1a\u4e3a Buffer Pool \u7533\u8bf7\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u6309\u7167\u9ed8\u8ba4\u7684 16KB \u7684\u5927\u5c0f\u5212\u5206\u51fa\u4e00\u4e2a\u4e2a\u7684\u9875\uff0c Buffer Pool \u4e2d\u7684\u9875\u5c31\u53eb\u505a\u7f13\u5b58\u9875 \u3002\u6b64\u65f6\u8fd9\u4e9b\u7f13\u5b58\u9875\u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u4e4b\u540e\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u624d\u4f1a\u6709\u78c1\u76d8\u4e0a\u7684\u9875\u88ab\u7f13\u5b58\u5230 Buffer Pool \u4e2d\u3002 \u6240\u4ee5\uff0cMySQL \u521a\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u89c2\u5bdf\u5230\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\uff0c\u800c\u4f7f\u7528\u5230\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u5374\u5f88\u5c0f\uff0c\u8fd9\u662f\u56e0\u4e3a\u53ea\u6709\u8fd9\u4e9b\u865a\u62df\u5185\u5b58\u88ab\u8bbf\u95ee\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u63a5\u7740\u5c06\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u3002 Buffer Pool \u9664\u4e86\u7f13\u5b58\u300c\u7d22\u5f15\u9875\u300d\u548c\u300c\u6570\u636e\u9875\u300d\uff0c\u8fd8\u5305\u62ec\u4e86 undo \u9875\uff0c\u63d2\u5165\u7f13\u5b58\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u3001\u9501\u4fe1\u606f\u7b49\u7b49\u3002 \u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406\u8fd9\u4e9b\u5728 Buffer Pool \u4e2d\u7684\u7f13\u5b58\u9875\uff0cInnoDB \u4e3a\u6bcf\u4e00\u4e2a\u7f13\u5b58\u9875\u90fd\u521b\u5efa\u4e86\u4e00\u4e2a**\u63a7\u5236\u5757**\uff0c\u63a7\u5236\u5757\u4fe1\u606f\u5305\u62ec\u300c\u7f13\u5b58\u9875\u7684\u8868\u7a7a\u95f4\u3001\u9875\u53f7\u3001\u7f13\u5b58\u9875\u5730\u5740\u3001\u94fe\u8868\u8282\u70b9\u300d\u7b49\u7b49\u3002 \u63a7\u5236\u5757\u4e5f\u662f\u5360\u6709\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u5b83\u662f\u653e\u5728 Buffer Pool \u7684\u6700\u524d\u9762\uff0c\u63a5\u7740\u624d\u662f\u7f13\u5b58\u9875\uff0c\u5982\u4e0b\u56fe\uff1a \u4e0a\u56fe\u4e2d\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u4e4b\u95f4\u7070\u8272\u90e8\u5206\u79f0\u4e3a\u788e\u7247\u7a7a\u95f4\u3002 \u4e3a\u4ec0\u4e48\u4f1a\u6709\u788e\u7247\u7a7a\u95f4\u5462\uff1f \u4f60\u60f3\u60f3\u554a\uff0c\u6bcf\u4e00\u4e2a\u63a7\u5236\u5757\u90fd\u5bf9\u5e94\u4e00\u4e2a\u7f13\u5b58\u9875\uff0c\u90a3\u5728\u5206\u914d\u8db3\u591f\u591a\u7684\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u540e\uff0c\u53ef\u80fd\u5269\u4f59\u7684\u90a3\u70b9\u513f\u7a7a\u95f4\u4e0d\u591f\u4e00\u5bf9\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u7684\u5927\u5c0f\uff0c\u81ea\u7136\u5c31\u7528\u4e0d\u5230\u55bd\uff0c\u8fd9\u4e2a\u7528\u4e0d\u5230\u7684\u90a3\u70b9\u513f\u5185\u5b58\u7a7a\u95f4\u5c31\u88ab\u79f0\u4e3a\u788e\u7247\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u4f60\u628a Buffer Pool \u7684\u5927\u5c0f\u8bbe\u7f6e\u7684\u521a\u521a\u597d\u7684\u8bdd\uff0c\u4e5f\u53ef\u80fd\u4e0d\u4f1a\u4ea7\u751f\u788e\u7247\u3002 \u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u53ea\u9700\u8981\u7f13\u51b2\u4e00\u6761\u8bb0\u5f55\u5417\uff1f \u4e0d\u662f\u7684\u3002 \u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\u65f6\uff0cInnoDB \u662f\u4f1a\u628a\u6574\u4e2a\u9875\u7684\u6570\u636e\u52a0\u8f7d\u5230 Buffer Pool \u4e2d\uff0c\u56e0\u4e3a\uff0c\u901a\u8fc7\u7d22\u5f15\u53ea\u80fd\u5b9a\u4f4d\u5230\u78c1\u76d8\u4e2d\u7684\u9875\uff0c\u800c\u4e0d\u80fd\u5b9a\u4f4d\u5230\u9875\u4e2d\u7684\u4e00\u6761\u8bb0\u5f55\u3002\u5c06\u9875\u52a0\u8f7d\u5230 Buffer Pool \u540e\uff0c\u518d\u901a\u8fc7\u9875\u91cc\u7684\u9875\u76ee\u5f55\u53bb\u5b9a\u4f4d\u5230\u67d0\u6761\u5177\u4f53\u7684\u8bb0\u5f55\u3002 \u5173\u4e8e\u9875\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\u548c\u7d22\u5f15\u600e\u4e48\u67e5\u8be2\u6570\u636e\u7684\u95ee\u9898\u53ef\u4ee5\u5728\u8fd9\u7bc7\u627e\u5230\u7b54\u6848\uff1a \u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811 \u5982\u4f55\u7ba1\u7406 Buffer Pool\uff1f \u00b6 \u5982\u4f55\u7ba1\u7406\u7a7a\u95f2\u9875\uff1f \u00b6 Buffer Pool \u662f\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5f53 MySQL \u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u8fd9\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u7684\u7f13\u5b58\u9875\u65e2\u6709\u7a7a\u95f2\u7684\uff0c\u4e5f\u6709\u88ab\u4f7f\u7528\u7684\u3002 \u90a3\u5f53\u6211\u4eec\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u603b\u4e0d\u80fd\u901a\u8fc7\u904d\u5386\u8fd9\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u6765\u627e\u5230\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u5427\uff0c\u8fd9\u6837\u6548\u7387\u592a\u4f4e\u4e86\u3002 \u6240\u4ee5\uff0c\u4e3a\u4e86\u80fd\u591f\u5feb\u901f\u627e\u5230\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u53ef\u4ee5\u4f7f\u7528\u94fe\u8868\u7ed3\u6784\uff0c\u5c06\u7a7a\u95f2\u7f13\u5b58\u9875\u7684\u300c\u63a7\u5236\u5757\u300d\u4f5c\u4e3a\u94fe\u8868\u7684\u8282\u70b9\uff0c\u8fd9\u4e2a\u94fe\u8868\u79f0\u4e3a Free \u94fe\u8868 \uff08\u7a7a\u95f2\u94fe\u8868\uff09\u3002 Free \u94fe\u8868\u4e0a\u9664\u4e86\u6709\u63a7\u5236\u5757\uff0c\u8fd8\u6709\u4e00\u4e2a\u5934\u8282\u70b9\uff0c\u8be5\u5934\u8282\u70b9\u5305\u542b\u94fe\u8868\u7684\u5934\u8282\u70b9\u5730\u5740\uff0c\u5c3e\u8282\u70b9\u5730\u5740\uff0c\u4ee5\u53ca\u5f53\u524d\u94fe\u8868\u4e2d\u8282\u70b9\u7684\u6570\u91cf\u7b49\u4fe1\u606f\u3002 Free \u94fe\u8868\u8282\u70b9\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u63a7\u5236\u5757\uff0c\u800c\u6bcf\u4e2a\u63a7\u5236\u5757\u5305\u542b\u7740\u5bf9\u5e94\u7f13\u5b58\u9875\u7684\u5730\u5740\uff0c\u6240\u4ee5\u76f8\u5f53\u4e8e Free \u94fe\u8868\u8282\u70b9\u90fd\u5bf9\u5e94\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u3002 \u6709\u4e86 Free \u94fe\u8868\u540e\uff0c\u6bcf\u5f53\u9700\u8981\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u4e00\u4e2a\u9875\u5230 Buffer Pool \u4e2d\u65f6\uff0c\u5c31\u4ece Free\u94fe\u8868\u4e2d\u53d6\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u5e76\u4e14\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u7684\u4fe1\u606f\u586b\u4e0a\uff0c\u7136\u540e\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4ece Free \u94fe\u8868\u4e2d\u79fb\u9664\u3002 \u5982\u4f55\u7ba1\u7406\u810f\u9875\uff1f \u00b6 \u8bbe\u8ba1 Buffer Pool \u9664\u4e86\u80fd\u63d0\u9ad8\u8bfb\u6027\u80fd\uff0c\u8fd8\u80fd\u63d0\u9ad8\u5199\u6027\u80fd\uff0c\u4e5f\u5c31\u662f\u66f4\u65b0\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u8981\u5199\u5165\u78c1\u76d8\uff0c\u800c\u662f\u5c06 Buffer Pool \u5bf9\u5e94\u7684\u7f13\u5b58\u9875\u6807\u8bb0\u4e3a**\u810f\u9875**\uff0c\u7136\u540e\u518d\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002 \u90a3\u4e3a\u4e86\u80fd\u5feb\u901f\u77e5\u9053\u54ea\u4e9b\u7f13\u5b58\u9875\u662f\u810f\u7684\uff0c\u4e8e\u662f\u5c31\u8bbe\u8ba1\u51fa Flush \u94fe\u8868 \uff0c\u5b83\u8ddf Free \u94fe\u8868\u7c7b\u4f3c\u7684\uff0c\u94fe\u8868\u7684\u8282\u70b9\u4e5f\u662f\u63a7\u5236\u5757\uff0c\u533a\u522b\u5728\u4e8e Flush \u94fe\u8868\u7684\u5143\u7d20\u90fd\u662f\u810f\u9875\u3002 \u6709\u4e86 Flush \u94fe\u8868\u540e\uff0c\u540e\u53f0\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u904d\u5386 Flush \u94fe\u8868\uff0c\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002 \u5982\u4f55\u63d0\u9ad8\u7f13\u5b58\u547d\u4e2d\u7387\uff1f \u00b6 Buffer Pool \u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u4e00\u76f4\u7559\u5728 Buffer Pool \u4e2d\uff0c\u800c\u4e00\u4e9b\u5f88\u5c11\u8bbf\u95ee\u7684\u6570\u636e\u5e0c\u671b\u53ef\u4ee5\u5728\u67d0\u4e9b\u65f6\u673a\u53ef\u4ee5\u6dd8\u6c70\u6389\uff0c\u4ece\u800c\u4fdd\u8bc1 Buffer Pool \u4e0d\u4f1a\u56e0\u4e3a\u6ee1\u4e86\u800c\u5bfc\u81f4\u65e0\u6cd5\u518d\u7f13\u5b58\u65b0\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u80fd\u4fdd\u8bc1\u5e38\u7528\u6570\u636e\u7559\u5728 Buffer Pool \u4e2d\u3002 \u8981\u5b9e\u73b0\u8fd9\u4e2a\uff0c\u6700\u5bb9\u6613\u60f3\u5230\u7684\u5c31\u662f LRU\uff08Least recently used\uff09\u7b97\u6cd5\u3002 \u8be5\u7b97\u6cd5\u7684\u601d\u8def\u662f\uff0c\u94fe\u8868\u5934\u90e8\u7684\u8282\u70b9\u662f\u6700\u8fd1\u4f7f\u7528\u7684\uff0c\u800c\u94fe\u8868\u672b\u5c3e\u7684\u8282\u70b9\u662f\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u3002\u90a3\u4e48\uff0c\u5f53\u7a7a\u95f4\u4e0d\u591f\u4e86\uff0c\u5c31\u6dd8\u6c70\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u8282\u70b9\uff0c\u4ece\u800c\u817e\u51fa\u7a7a\u95f4\u3002 \u7b80\u5355\u7684 LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\u601d\u8def\u662f\u8fd9\u6837\u7684\uff1a \u5f53\u8bbf\u95ee\u7684\u9875\u5728 Buffer Pool \u91cc\uff0c\u5c31\u76f4\u63a5\u628a\u8be5\u9875\u5bf9\u5e94\u7684 LRU \u94fe\u8868\u8282\u70b9\u79fb\u52a8\u5230\u94fe\u8868\u7684\u5934\u90e8\u3002 \u5f53\u8bbf\u95ee\u7684\u9875\u4e0d\u5728 Buffer Pool \u91cc\uff0c\u9664\u4e86\u8981\u628a\u9875\u653e\u5165\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u8fd8\u8981\u6dd8\u6c70 LRU \u94fe\u8868\u672b\u5c3e\u7684\u8282\u70b9\u3002 \u6bd4\u5982\u4e0b\u56fe\uff0c\u5047\u8bbe LRU \u94fe\u8868\u957f\u5ea6\u4e3a 5\uff0cLRU \u94fe\u8868\u4ece\u5de6\u5230\u53f3\u6709 1\uff0c2\uff0c3\uff0c4\uff0c5 \u7684\u9875\u3002 \u5982\u679c\u8bbf\u95ee\u4e86 3 \u53f7\u7684\u9875\uff0c\u56e0\u4e3a 3 \u53f7\u9875\u5728 Buffer Pool \u91cc\uff0c\u6240\u4ee5\u628a 3 \u53f7\u9875\u79fb\u52a8\u5230\u5934\u90e8\u5373\u53ef\u3002 \u800c\u5982\u679c\u63a5\u4e0b\u6765\uff0c\u8bbf\u95ee\u4e86 8 \u53f7\u9875\uff0c\u56e0\u4e3a 8 \u53f7\u9875\u4e0d\u5728 Buffer Pool \u91cc\uff0c\u6240\u4ee5\u9700\u8981\u5148\u6dd8\u6c70\u672b\u5c3e\u7684 5 \u53f7\u9875\uff0c\u7136\u540e\u518d\u5c06 8 \u53f7\u9875\u52a0\u5165\u5230\u5934\u90e8\u3002 \u5230\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0cBuffer Pool \u91cc\u6709\u4e09\u79cd\u9875\u548c\u94fe\u8868\u6765\u7ba1\u7406\u6570\u636e\u3002 \u56fe\u4e2d\uff1a Free Page\uff08\u7a7a\u95f2\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u672a\u88ab\u4f7f\u7528\uff0c\u4f4d\u4e8e Free \u94fe\u8868\uff1b Clean Page\uff08\u5e72\u51c0\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u5df2\u88ab\u4f7f\u7528\uff0c\u4f46\u662f\u9875\u9762\u672a\u53d1\u751f\u4fee\u6539\uff0c\u4f4d\u4e8eLRU \u94fe\u8868\u3002 Dirty Page\uff08\u810f\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u300c\u5df2\u88ab\u4f7f\u7528\u300d\u4e14\u300c\u5df2\u7ecf\u88ab\u4fee\u6539\u300d\uff0c\u5176\u6570\u636e\u548c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u4e00\u81f4\u3002\u5f53\u810f\u9875\u4e0a\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u540e\uff0c\u5185\u5b58\u6570\u636e\u548c\u78c1\u76d8\u6570\u636e\u4e00\u81f4\uff0c\u90a3\u4e48\u8be5\u9875\u5c31\u53d8\u6210\u4e86\u5e72\u51c0\u9875\u3002\u810f\u9875\u540c\u65f6\u5b58\u5728\u4e8e LRU \u94fe\u8868\u548c Flush \u94fe\u8868\u3002 \u7b80\u5355\u7684 LRU \u7b97\u6cd5\u5e76\u6ca1\u6709\u88ab MySQL \u4f7f\u7528\uff0c\u56e0\u4e3a\u7b80\u5355\u7684 LRU \u7b97\u6cd5\u65e0\u6cd5\u907f\u514d\u4e0b\u9762\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a \u9884\u8bfb\u5931\u6548\uff1b Buffer Pool \u6c61\u67d3\uff1b \u4ec0\u4e48\u662f\u9884\u8bfb\u5931\u6548\uff1f \u5148\u6765\u8bf4\u8bf4 MySQL \u7684\u9884\u8bfb\u673a\u5236\u3002\u7a0b\u5e8f\u662f\u6709\u7a7a\u95f4\u5c40\u90e8\u6027\u7684\uff0c\u9760\u8fd1\u5f53\u524d\u88ab\u8bbf\u95ee\u6570\u636e\u7684\u6570\u636e\uff0c\u5728\u672a\u6765\u5f88\u5927\u6982\u7387\u4f1a\u88ab\u8bbf\u95ee\u5230\u3002 \u6240\u4ee5\uff0cMySQL \u5728\u52a0\u8f7d\u6570\u636e\u9875\u65f6\uff0c\u4f1a\u63d0\u524d\u628a\u5b83\u76f8\u90bb\u7684\u6570\u636e\u9875\u4e00\u5e76\u52a0\u8f7d\u8fdb\u6765\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 IO\u3002 \u4f46\u662f\u53ef\u80fd\u8fd9\u4e9b**\u88ab\u63d0\u524d\u52a0\u8f7d\u8fdb\u6765\u7684\u6570\u636e\u9875\uff0c\u5e76\u6ca1\u6709\u88ab\u8bbf\u95ee**\uff0c\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u9884\u8bfb\u662f\u767d\u505a\u4e86\uff0c\u8fd9\u4e2a\u5c31\u662f**\u9884\u8bfb\u5931\u6548**\u3002 \u5982\u679c\u4f7f\u7528\u7b80\u5355\u7684 LRU \u7b97\u6cd5\uff0c\u5c31\u4f1a\u628a\u9884\u8bfb\u9875\u653e\u5230 LRU \u94fe\u8868\u5934\u90e8\uff0c\u800c\u5f53 Buffer Pool\u7a7a\u95f4\u4e0d\u591f\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u628a\u672b\u5c3e\u7684\u9875\u6dd8\u6c70\u6389\u3002 \u5982\u679c\u8fd9\u4e9b\u9884\u8bfb\u9875\u5982\u679c\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u5f88\u5947\u602a\u7684\u95ee\u9898\uff0c\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u7684\u9884\u8bfb\u9875\u5374\u5360\u7528\u4e86 LRU \u94fe\u8868\u524d\u6392\u7684\u4f4d\u7f6e\uff0c\u800c\u672b\u5c3e\u6dd8\u6c70\u7684\u9875\uff0c\u53ef\u80fd\u662f\u9891\u7e41\u8bbf\u95ee\u7684\u9875\uff0c\u8fd9\u6837\u5c31\u5927\u5927\u964d\u4f4e\u4e86\u7f13\u5b58\u547d\u4e2d\u7387\u3002 \u600e\u4e48\u89e3\u51b3\u9884\u8bfb\u5931\u6548\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u964d\u4f4e\u7684\u95ee\u9898\uff1f \u6211\u4eec\u4e0d\u80fd\u56e0\u4e3a\u5bb3\u6015\u9884\u8bfb\u5931\u6548\uff0c\u800c\u5c06\u9884\u8bfb\u673a\u5236\u53bb\u6389\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u5c40\u90e8\u6027\u539f\u7406\u8fd8\u662f\u6210\u7acb\u7684\u3002 \u8981\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u5f71\u54cd\uff0c\u6700\u597d\u5c31\u662f**\u8ba9\u9884\u8bfb\u7684\u9875\u505c\u7559\u5728 Buffer Pool \u91cc\u7684\u65f6\u95f4\u8981\u5c3d\u53ef\u80fd\u7684\u77ed\uff0c\u8ba9\u771f\u6b63\u88ab\u8bbf\u95ee\u7684\u9875\u624d\u79fb\u52a8\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u4ece\u800c\u4fdd\u8bc1\u771f\u6b63\u88ab\u8bfb\u53d6\u7684\u70ed\u6570\u636e\u7559\u5728 Buffer Pool \u91cc\u7684\u65f6\u95f4\u5c3d\u53ef\u80fd\u957f**\u3002 \u90a3\u5230\u5e95\u600e\u4e48\u624d\u80fd\u907f\u514d\u5462\uff1f MySQL \u662f\u8fd9\u6837\u505a\u7684\uff0c\u5b83\u6539\u8fdb\u4e86 LRU \u7b97\u6cd5\uff0c\u5c06 LRU \u5212\u5206\u4e86 2 \u4e2a\u533a\u57df\uff1a old \u533a\u57df \u548c young \u533a\u57df \u3002 young \u533a\u57df\u5728 LRU \u94fe\u8868\u7684\u524d\u534a\u90e8\u5206\uff0cold \u533a\u57df\u5219\u662f\u5728\u540e\u534a\u90e8\u5206\uff0c\u5982\u4e0b\u56fe\uff1a old \u533a\u57df\u5360\u6574\u4e2a LRU \u94fe\u8868\u957f\u5ea6\u7684\u6bd4\u4f8b\u53ef\u4ee5\u901a\u8fc7 innodb_old_blocks_pc \u53c2\u6570\u6765\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u662f 37\uff0c\u4ee3\u8868\u6574\u4e2a LRU \u94fe\u8868\u4e2d young \u533a\u57df\u4e0e old \u533a\u57df\u6bd4\u4f8b\u662f 63:37\u3002 \u5212\u5206\u8fd9\u4e24\u4e2a\u533a\u57df\u540e\uff0c\u9884\u8bfb\u7684\u9875\u5c31\u53ea\u9700\u8981\u52a0\u5165\u5230 old \u533a\u57df\u7684\u5934\u90e8\uff0c\u5f53\u9875\u88ab\u771f\u6b63\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u624d\u5c06\u9875\u63d2\u5165 young \u533a\u57df\u7684\u5934\u90e8 \u3002\u5982\u679c\u9884\u8bfb\u7684\u9875\u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u4ece old \u533a\u57df\u79fb\u9664\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u5f71\u54cd young \u533a\u57df\u4e2d\u7684\u70ed\u70b9\u6570\u636e\u3002 \u63a5\u4e0b\u6765\uff0c\u7ed9\u5927\u5bb6\u4e3e\u4e2a\u4f8b\u5b50\u3002 \u5047\u8bbe\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a 10 \u7684 LRU \u94fe\u8868\uff0c\u5176\u4e2d young \u533a\u57df\u5360\u6bd4 70 %\uff0cold \u533a\u57df\u5360\u6bd4 30 %\u3002 \u73b0\u5728\u6709\u4e2a\u7f16\u53f7\u4e3a 20 \u7684\u9875\u88ab\u9884\u8bfb\u4e86\uff0c\u8fd9\u4e2a\u9875\u53ea\u4f1a\u88ab\u63d2\u5165\u5230 old \u533a\u57df\u5934\u90e8\uff0c\u800c old \u533a\u57df\u672b\u5c3e\u7684\u9875\uff0810\u53f7\uff09\u4f1a\u88ab\u6dd8\u6c70\u6389\u3002 \u5982\u679c 20 \u53f7\u9875\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\uff0c\u5b83\u4e5f\u6ca1\u6709\u5360\u7528\u5230 young \u533a\u57df\u7684\u4f4d\u7f6e\uff0c\u800c\u4e14\u8fd8\u4f1a\u6bd4 young \u533a\u57df\u7684\u6570\u636e\u66f4\u65e9\u88ab\u6dd8\u6c70\u51fa\u53bb\u3002 \u5982\u679c 20 \u53f7\u9875\u88ab\u9884\u8bfb\u540e\uff0c\u7acb\u523b\u88ab\u8bbf\u95ee\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u5b83\u63d2\u5165\u5230 young \u533a\u57df\u7684\u5934\u90e8\uff0cyoung \u533a\u57df\u672b\u5c3e\u7684\u9875\uff087\u53f7\uff09\uff0c\u4f1a\u88ab\u6324\u5230 old \u533a\u57df\uff0c\u4f5c\u4e3a old \u533a\u57df\u7684\u5934\u90e8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u6709\u9875\u88ab\u6dd8\u6c70\u3002 \u867d\u7136\u901a\u8fc7\u5212\u5206 old \u533a\u57df \u548c young \u533a\u57df\u907f\u514d\u4e86\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u4f46\u662f\u8fd8\u6709\u4e2a\u95ee\u9898\u65e0\u6cd5\u89e3\u51b3\uff0c\u90a3\u5c31\u662f Buffer Pool \u6c61\u67d3\u7684\u95ee\u9898\u3002 \u4ec0\u4e48\u662f Buffer Pool \u6c61\u67d3\uff1f \u5f53\u67d0\u4e00\u4e2a SQL \u8bed\u53e5**\u626b\u63cf\u4e86\u5927\u91cf\u7684\u6570\u636e**\u65f6\uff0c\u5728 Buffer Pool \u7a7a\u95f4\u6bd4\u8f83\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u5c06 Buffer Pool \u91cc\u7684\u6240\u6709\u9875\u90fd\u66ff\u6362\u51fa\u53bb\uff0c\u5bfc\u81f4\u5927\u91cf\u70ed\u6570\u636e\u88ab\u6dd8\u6c70\u4e86 \uff0c\u7b49\u8fd9\u4e9b\u70ed\u6570\u636e\u53c8\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u78c1\u76d8 IO\uff0cMySQL \u6027\u80fd\u5c31\u4f1a\u6025\u5267\u4e0b\u964d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3a Buffer Pool \u6c61\u67d3 \u3002 \u6ce8\u610f\uff0c Buffer Pool \u6c61\u67d3\u5e76\u4e0d\u53ea\u662f\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u51fa\u4e86\u5927\u91cf\u7684\u6570\u636e\u624d\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u5373\u4f7f\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u96c6\u5f88\u5c0f\uff0c\u4e5f\u4f1a\u9020\u6210 Buffer Pool \u6c61\u67d3\u3002 \u6bd4\u5982\uff0c\u5728\u4e00\u4e2a\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u8868\uff0c\u6267\u884c\u4e86\u8fd9\u6761\u8bed\u53e5\uff1a select * from t_user where name like \"%xiaolin%\" ; \u53ef\u80fd\u8fd9\u4e2a\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u5c31\u51e0\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u6761\u8bed\u53e5\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\uff0c\u6240\u4ee5\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u662f\u5168\u8868\u626b\u63cf\u7684\uff0c\u63a5\u7740\u4f1a\u53d1\u751f\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a \u4ece\u78c1\u76d8\u8bfb\u5230\u7684\u9875\u52a0\u5165\u5230 LRU \u94fe\u8868\u7684 old \u533a\u57df\u5934\u90e8\uff1b \u5f53\u4ece\u9875\u91cc\u8bfb\u53d6\u884c\u8bb0\u5f55\u65f6\uff0c\u4e5f\u5c31\u662f\u9875\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5c31\u8981\u5c06\u8be5\u9875\u653e\u5230 young \u533a\u57df\u5934\u90e8\uff1b \u63a5\u4e0b\u6765\u62ff\u884c\u8bb0\u5f55\u7684 name \u5b57\u6bb5\u548c\u5b57\u7b26\u4e32 xiaolin \u8fdb\u884c\u6a21\u7cca\u5339\u914d\uff0c\u5982\u679c\u7b26\u5408\u6761\u4ef6\uff0c\u5c31\u52a0\u5165\u5230\u7ed3\u679c\u96c6\u91cc\uff1b \u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u626b\u63cf\u5b8c\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u3002 \u7ecf\u8fc7\u8fd9\u4e00\u756a\u6298\u817e\uff0c\u539f\u672c young \u533a\u57df\u7684\u70ed\u70b9\u6570\u636e\u90fd\u4f1a\u88ab\u66ff\u6362\u6389\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u9700\u8981\u6279\u91cf\u626b\u63cf\uff1a21\uff0c22\uff0c23\uff0c24\uff0c25 \u8fd9\u4e94\u4e2a\u9875\uff0c\u8fd9\u4e9b\u9875\u90fd\u4f1a\u88ab\u9010\u4e00\u8bbf\u95ee\uff08\u8bfb\u53d6\u9875\u91cc\u7684\u8bb0\u5f55\uff09\u3002 \u5728\u6279\u91cf\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u9010\u4e00\u63d2\u5165\u5230 young \u533a\u57df\u5934\u90e8\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u539f\u672c\u5728 young \u533a\u57df\u7684\u70ed\u70b9\u6570\u636e 6 \u548c 7 \u53f7\u9875\u90fd\u88ab\u6dd8\u6c70\u4e86\uff0c\u8fd9\u5c31\u662f Buffer Pool \u6c61\u67d3\u7684\u95ee\u9898\u3002 \u600e\u4e48\u89e3\u51b3\u51fa\u73b0 Buffer Pool \u6c61\u67d3\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u7684\u95ee\u9898\uff1f \u50cf\u524d\u9762\u8fd9\u79cd\u5168\u8868\u626b\u63cf\u7684\u67e5\u8be2\uff0c\u5f88\u591a\u7f13\u51b2\u9875\u5176\u5b9e\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u4f46\u662f\u5b83\u5374\u53ea\u56e0\u4e3a\u88ab\u8bbf\u95ee\u4e86\u4e00\u6b21\u800c\u8fdb\u5165\u5230 young \u533a\u57df\uff0c\u4ece\u800c\u5bfc\u81f4\u70ed\u70b9\u6570\u636e\u88ab\u66ff\u6362\u4e86\u3002 LRU \u94fe\u8868\u4e2d young \u533a\u57df\u5c31\u662f\u70ed\u70b9\u6570\u636e\uff0c\u53ea\u8981\u6211\u4eec\u63d0\u9ad8\u8fdb\u5165\u5230 young \u533a\u57df\u7684\u95e8\u69db\uff0c\u5c31\u80fd\u6709\u6548\u5730\u4fdd\u8bc1 young \u533a\u57df\u91cc\u7684\u70ed\u70b9\u6570\u636e\u4e0d\u4f1a\u88ab\u66ff\u6362\u6389\u3002 MySQL \u662f\u8fd9\u6837\u505a\u7684\uff0c\u8fdb\u5165\u5230 young \u533a\u57df\u6761\u4ef6\u589e\u52a0\u4e86\u4e00\u4e2a**\u505c\u7559\u5728 old \u533a\u57df\u7684\u65f6\u95f4\u5224\u65ad**\u3002 \u5177\u4f53\u662f\u8fd9\u6837\u505a\u7684\uff0c\u5728\u5bf9\u67d0\u4e2a\u5904\u5728 old \u533a\u57df\u7684\u7f13\u5b58\u9875\u8fdb\u884c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\uff0c\u5c31\u5728\u5b83\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4e2d\u8bb0\u5f55\u4e0b\u6765\u8fd9\u4e2a\u8bbf\u95ee\u65f6\u95f4\uff1a \u5982\u679c\u540e\u7eed\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4**\u5728\u67d0\u4e2a\u65f6\u95f4\u95f4\u9694\u5185**\uff0c\u90a3\u4e48**\u8be5\u7f13\u5b58\u9875\u5c31\u4e0d\u4f1a\u88ab\u4ece old \u533a\u57df\u79fb\u52a8\u5230 young \u533a\u57df\u7684\u5934\u90e8**\uff1b \u5982\u679c\u540e\u7eed\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4**\u4e0d\u5728\u67d0\u4e2a\u65f6\u95f4\u95f4\u9694\u5185**\uff0c\u90a3\u4e48**\u8be5\u7f13\u5b58\u9875\u79fb\u52a8\u5230 young \u533a\u57df\u7684\u5934\u90e8**\uff1b \u8fd9\u4e2a\u95f4\u9694\u65f6\u95f4\u662f\u7531 innodb_old_blocks_time \u63a7\u5236\u7684\uff0c\u9ed8\u8ba4\u662f 1000 ms\u3002 \u4e5f\u5c31\u8bf4\uff0c \u53ea\u6709\u540c\u65f6\u6ee1\u8db3\u300c\u88ab\u8bbf\u95ee\u300d\u4e0e\u300c\u5728 old \u533a\u57df\u505c\u7559\u65f6\u95f4\u8d85\u8fc7 1 \u79d2\u300d\u4e24\u4e2a\u6761\u4ef6\uff0c\u624d\u4f1a\u88ab\u63d2\u5165\u5230 young \u533a\u57df\u5934\u90e8 \uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86 Buffer Pool \u6c61\u67d3\u7684\u95ee\u9898 \u3002 \u53e6\u5916\uff0cMySQL \u9488\u5bf9 young \u533a\u57df\u5176\u5b9e\u505a\u4e86\u4e00\u4e2a\u4f18\u5316\uff0c\u4e3a\u4e86\u9632\u6b62 young \u533a\u57df\u8282\u70b9\u9891\u7e41\u79fb\u52a8\u5230\u5934\u90e8\u3002young \u533a\u57df\u524d\u9762 \u00bc \u88ab\u8bbf\u95ee\u4e0d\u4f1a\u79fb\u52a8\u5230\u94fe\u8868\u5934\u90e8\uff0c\u53ea\u6709\u540e\u9762\u7684 \u00be\u88ab\u8bbf\u95ee\u4e86\u624d\u4f1a\u3002 \u810f\u9875\u4ec0\u4e48\u65f6\u5019\u4f1a\u88ab\u5237\u5165\u78c1\u76d8\uff1f \u00b6 \u5f15\u5165\u4e86 Buffer Pool \u540e\uff0c\u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u9996\u5148\u662f\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u4f46\u662f\u78c1\u76d8\u4e2d\u8fd8\u662f\u539f\u6570\u636e\u3002 \u56e0\u6b64\uff0c\u810f\u9875\u9700\u8981\u88ab\u5237\u5165\u78c1\u76d8\uff0c\u4fdd\u8bc1\u7f13\u5b58\u548c\u78c1\u76d8\u6570\u636e\u4e00\u81f4\uff0c\u4f46\u662f\u82e5\u6bcf\u6b21\u4fee\u6539\u6570\u636e\u90fd\u5237\u5165\u78c1\u76d8\uff0c\u5219\u6027\u80fd\u4f1a\u5f88\u5dee\uff0c\u56e0\u6b64\u4e00\u822c\u90fd\u4f1a\u5728\u4e00\u5b9a\u65f6\u673a\u8fdb\u884c\u6279\u91cf\u5237\u76d8\u3002 \u53ef\u80fd\u5927\u5bb6\u62c5\u5fc3\uff0c\u5982\u679c\u5728\u810f\u9875\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5237\u5165\u5230\u78c1\u76d8\u65f6\uff0cMySQL \u5b95\u673a\u4e86\uff0c\u4e0d\u5c31\u4e22\u5931\u6570\u636e\u4e86\u5417\uff1f \u8fd9\u4e2a\u4e0d\u7528\u62c5\u5fc3\uff0cInnoDB \u7684\u66f4\u65b0\u64cd\u4f5c\u91c7\u7528\u7684\u662f Write Ahead Log \u7b56\u7565\uff0c\u5373\u5148\u5199\u65e5\u5fd7\uff0c\u518d\u5199\u5165\u78c1\u76d8\uff0c\u901a\u8fc7 redo log \u65e5\u5fd7\u8ba9 MySQL \u62e5\u6709\u4e86\u5d29\u6e83\u6062\u590d\u80fd\u529b\u3002 \u4e0b\u9762\u51e0\u79cd\u60c5\u51b5\u4f1a\u89e6\u53d1\u810f\u9875\u7684\u5237\u65b0\uff1a \u5f53 redo log \u65e5\u5fd7\u6ee1\u4e86\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4e3b\u52a8\u89e6\u53d1\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\uff1b Buffer Pool \u7a7a\u95f4\u4e0d\u8db3\u65f6\uff0c\u9700\u8981\u5c06\u4e00\u90e8\u5206\u6570\u636e\u9875\u6dd8\u6c70\u6389\uff0c\u5982\u679c\u6dd8\u6c70\u7684\u662f\u810f\u9875\uff0c\u9700\u8981\u5148\u5c06\u810f\u9875\u540c\u6b65\u5230\u78c1\u76d8\uff1b MySQL \u8ba4\u4e3a\u7a7a\u95f2\u65f6\uff0c\u540e\u53f0\u7ebf\u7a0b\u56de\u5b9a\u671f\u5c06\u9002\u91cf\u7684\u810f\u9875\u5237\u5165\u5230\u78c1\u76d8\uff1b MySQL \u6b63\u5e38\u5173\u95ed\u4e4b\u524d\uff0c\u4f1a\u628a\u6240\u6709\u7684\u810f\u9875\u5237\u5165\u5230\u78c1\u76d8\uff1b \u5728\u6211\u4eec\u5f00\u542f\u4e86\u6162 SQL \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f60\u53d1\u73b0**\u300c\u5076\u5c14\u300d\u4f1a\u51fa\u73b0\u4e00\u4e9b\u7528\u65f6\u7a0d\u957f\u7684 SQL**\uff0c\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u810f\u9875\u5728\u5237\u65b0\u5230\u78c1\u76d8\u65f6\u53ef\u80fd\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u6027\u80fd\u5f00\u9500\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u64cd\u4f5c\u6296\u52a8\u3002 \u5982\u679c\u95f4\u65ad\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\uff0c\u5c31\u9700\u8981\u8c03\u5927 Buffer Pool \u7a7a\u95f4\u6216 redo log \u65e5\u5fd7\u7684\u5927\u5c0f\u3002 \u603b\u7ed3 \u00b6 Innodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a**\u7f13\u51b2\u6c60\uff08 Buffer Pool \uff09**\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002 Buffer Pool \u4ee5\u9875\u4e3a\u5355\u4f4d\u7f13\u51b2\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7 innodb_buffer_pool_size \u53c2\u6570\u8c03\u6574\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u662f 128 M\u3002 Innodb \u901a\u8fc7\u4e09\u79cd\u94fe\u8868\u6765\u7ba1\u7406\u7f13\u9875\uff1a Free List \uff08\u7a7a\u95f2\u9875\u94fe\u8868\uff09\uff0c\u7ba1\u7406\u7a7a\u95f2\u9875\uff1b Flush List \uff08\u810f\u9875\u94fe\u8868\uff09\uff0c\u7ba1\u7406\u810f\u9875\uff1b LRU List\uff0c\u7ba1\u7406\u810f\u9875+\u5e72\u51c0\u9875\uff0c\u5c06\u6700\u8fd1\u4e14\u7ecf\u5e38\u67e5\u8be2\u7684\u6570\u636e\u7f13\u5b58\u5728\u5176\u4e2d\uff0c\u800c\u4e0d\u5e38\u67e5\u8be2\u7684\u6570\u636e\u5c31\u6dd8\u6c70\u51fa\u53bb\u3002\uff1b InnoDB \u5bf9 LRU \u505a\u4e86\u4e00\u4e9b\u4f18\u5316\uff0c\u6211\u4eec\u719f\u6089\u7684 LRU \u7b97\u6cd5\u901a\u5e38\u662f\u5c06\u6700\u8fd1\u67e5\u8be2\u7684\u6570\u636e\u653e\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u800c InnoDB \u505a 2 \u70b9\u4f18\u5316\uff1a \u5c06 LRU \u94fe\u8868 \u5206\u4e3a**young \u548c old \u4e24\u4e2a\u533a\u57df**\uff0c\u52a0\u5165\u7f13\u51b2\u6c60\u7684\u9875\uff0c\u4f18\u5148\u63d2\u5165 old \u533a\u57df\uff1b\u9875\u88ab\u8bbf\u95ee\u65f6\uff0c\u624d\u8fdb\u5165 young \u533a\u57df\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u9884\u8bfb\u5931\u6548\u7684\u95ee\u9898\u3002 \u5f53**\u300c\u9875\u88ab\u8bbf\u95ee\u300d\u4e14\u300c old \u533a\u57df\u505c\u7559\u65f6\u95f4\u8d85\u8fc7 innodb_old_blocks_time \u9608\u503c\uff08\u9ed8\u8ba4\u4e3a1\u79d2\uff09\u300d**\u65f6\uff0c\u624d\u4f1a\u5c06\u9875\u63d2\u5165\u5230 young \u533a\u57df\uff0c\u5426\u5219\u8fd8\u662f\u63d2\u5165\u5230 old \u533a\u57df\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u6279\u91cf\u6570\u636e\u8bbf\u95ee\uff0c\u5927\u91cf\u70ed\u6570\u636e\u6dd8\u6c70\u7684\u95ee\u9898\u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 innodb_old_blocks_pc \u53c2\u6570\uff0c\u8bbe\u7f6e young \u533a\u57df\u548c old \u533a\u57df\u6bd4\u4f8b\u3002 \u5728\u5f00\u542f\u4e86\u6162 SQL \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f60\u53d1\u73b0\u300c\u5076\u5c14\u300d\u4f1a\u51fa\u73b0\u4e00\u4e9b\u7528\u65f6\u7a0d\u957f\u7684 SQL\uff0c\u8fd9\u53ef\u56e0\u4e3a\u810f\u9875\u5728\u5237\u65b0\u5230\u78c1\u76d8\u65f6\u5bfc\u81f4\u6570\u636e\u5e93\u6027\u80fd\u6296\u52a8\u3002\u5982\u679c\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\uff0c\u5c31\u9700\u8981\u8c03\u5927 Buffer Pool \u7a7a\u95f4\u6216 redo log \u65e5\u5fd7\u7684\u5927\u5c0f\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u63ed\u5f00 Buffer Pool  \u7684\u9762\u7eb1"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4eca\u5929\u5c31\u804a MySQL \u7684 Buffer Pool\uff0c\u53d1\u8f66\uff01","title":"\u63ed\u5f00 Buffer Pool  \u7684\u9762\u7eb1"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_1","text":"\u867d\u7136\u8bf4 MySQL \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u91cc\u7684\uff0c\u4f46\u662f\u4e5f\u4e0d\u80fd\u6bcf\u6b21\u90fd\u4ece\u78c1\u76d8\u91cc\u9762\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u6837\u6027\u80fd\u662f\u6781\u5dee\u7684\u3002 \u8981\u60f3\u63d0\u5347\u67e5\u8be2\u6027\u80fd\uff0c\u52a0\u4e2a\u7f13\u5b58\u5c31\u884c\u4e86\u561b\u3002\u6240\u4ee5\uff0c\u5f53\u6570\u636e\u4ece\u78c1\u76d8\u4e2d\u53d6\u51fa\u540e\uff0c\u7f13\u5b58\u5185\u5b58\u4e2d\uff0c\u4e0b\u6b21\u67e5\u8be2\u540c\u6837\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u3002 \u4e3a\u6b64\uff0cInnodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a**\u7f13\u51b2\u6c60\uff08 Buffer Pool \uff09**\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002 \u6709\u4e86\u7f13\u51b2\u6c60\u540e\uff1a \u5f53\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u76f4\u63a5\u8bfb\u53d6 Buffer Pool \u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u518d\u53bb\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002 \u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u9996\u5148\u662f\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u6700\u540e\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002","title":"\u4e3a\u4ec0\u4e48\u8981\u6709 Buffer Pool\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_2","text":"Buffer Pool \u662f\u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0c\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4e0b Buffer Pool \u53ea\u6709 128MB \u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 innodb_buffer_pool_size \u53c2\u6570\u6765\u8bbe\u7f6e Buffer Pool \u7684\u5927\u5c0f\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u6210\u53ef\u7528\u7269\u7406\u5185\u5b58\u7684 60%~80%\u3002","title":"Buffer Pool \u6709\u591a\u5927\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_3","text":"InnoDB \u4f1a\u628a\u5b58\u50a8\u7684\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u300c\u9875\u300d\uff0c\u4ee5\u9875\u4f5c\u4e3a\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e00\u4e2a\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16KB\u3002\u56e0\u6b64\uff0cBuffer Pool \u540c\u6837\u9700\u8981\u6309\u300c\u9875\u300d\u6765\u5212\u5206\u3002 \u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0c InnoDB \u4f1a\u4e3a Buffer Pool \u7533\u8bf7\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u6309\u7167\u9ed8\u8ba4\u7684 16KB \u7684\u5927\u5c0f\u5212\u5206\u51fa\u4e00\u4e2a\u4e2a\u7684\u9875\uff0c Buffer Pool \u4e2d\u7684\u9875\u5c31\u53eb\u505a\u7f13\u5b58\u9875 \u3002\u6b64\u65f6\u8fd9\u4e9b\u7f13\u5b58\u9875\u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u4e4b\u540e\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u624d\u4f1a\u6709\u78c1\u76d8\u4e0a\u7684\u9875\u88ab\u7f13\u5b58\u5230 Buffer Pool \u4e2d\u3002 \u6240\u4ee5\uff0cMySQL \u521a\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u89c2\u5bdf\u5230\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\uff0c\u800c\u4f7f\u7528\u5230\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u5374\u5f88\u5c0f\uff0c\u8fd9\u662f\u56e0\u4e3a\u53ea\u6709\u8fd9\u4e9b\u865a\u62df\u5185\u5b58\u88ab\u8bbf\u95ee\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u63a5\u7740\u5c06\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u3002 Buffer Pool \u9664\u4e86\u7f13\u5b58\u300c\u7d22\u5f15\u9875\u300d\u548c\u300c\u6570\u636e\u9875\u300d\uff0c\u8fd8\u5305\u62ec\u4e86 undo \u9875\uff0c\u63d2\u5165\u7f13\u5b58\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u3001\u9501\u4fe1\u606f\u7b49\u7b49\u3002 \u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406\u8fd9\u4e9b\u5728 Buffer Pool \u4e2d\u7684\u7f13\u5b58\u9875\uff0cInnoDB \u4e3a\u6bcf\u4e00\u4e2a\u7f13\u5b58\u9875\u90fd\u521b\u5efa\u4e86\u4e00\u4e2a**\u63a7\u5236\u5757**\uff0c\u63a7\u5236\u5757\u4fe1\u606f\u5305\u62ec\u300c\u7f13\u5b58\u9875\u7684\u8868\u7a7a\u95f4\u3001\u9875\u53f7\u3001\u7f13\u5b58\u9875\u5730\u5740\u3001\u94fe\u8868\u8282\u70b9\u300d\u7b49\u7b49\u3002 \u63a7\u5236\u5757\u4e5f\u662f\u5360\u6709\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u5b83\u662f\u653e\u5728 Buffer Pool \u7684\u6700\u524d\u9762\uff0c\u63a5\u7740\u624d\u662f\u7f13\u5b58\u9875\uff0c\u5982\u4e0b\u56fe\uff1a \u4e0a\u56fe\u4e2d\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u4e4b\u95f4\u7070\u8272\u90e8\u5206\u79f0\u4e3a\u788e\u7247\u7a7a\u95f4\u3002 \u4e3a\u4ec0\u4e48\u4f1a\u6709\u788e\u7247\u7a7a\u95f4\u5462\uff1f \u4f60\u60f3\u60f3\u554a\uff0c\u6bcf\u4e00\u4e2a\u63a7\u5236\u5757\u90fd\u5bf9\u5e94\u4e00\u4e2a\u7f13\u5b58\u9875\uff0c\u90a3\u5728\u5206\u914d\u8db3\u591f\u591a\u7684\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u540e\uff0c\u53ef\u80fd\u5269\u4f59\u7684\u90a3\u70b9\u513f\u7a7a\u95f4\u4e0d\u591f\u4e00\u5bf9\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u7684\u5927\u5c0f\uff0c\u81ea\u7136\u5c31\u7528\u4e0d\u5230\u55bd\uff0c\u8fd9\u4e2a\u7528\u4e0d\u5230\u7684\u90a3\u70b9\u513f\u5185\u5b58\u7a7a\u95f4\u5c31\u88ab\u79f0\u4e3a\u788e\u7247\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u4f60\u628a Buffer Pool \u7684\u5927\u5c0f\u8bbe\u7f6e\u7684\u521a\u521a\u597d\u7684\u8bdd\uff0c\u4e5f\u53ef\u80fd\u4e0d\u4f1a\u4ea7\u751f\u788e\u7247\u3002 \u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u53ea\u9700\u8981\u7f13\u51b2\u4e00\u6761\u8bb0\u5f55\u5417\uff1f \u4e0d\u662f\u7684\u3002 \u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\u65f6\uff0cInnoDB \u662f\u4f1a\u628a\u6574\u4e2a\u9875\u7684\u6570\u636e\u52a0\u8f7d\u5230 Buffer Pool \u4e2d\uff0c\u56e0\u4e3a\uff0c\u901a\u8fc7\u7d22\u5f15\u53ea\u80fd\u5b9a\u4f4d\u5230\u78c1\u76d8\u4e2d\u7684\u9875\uff0c\u800c\u4e0d\u80fd\u5b9a\u4f4d\u5230\u9875\u4e2d\u7684\u4e00\u6761\u8bb0\u5f55\u3002\u5c06\u9875\u52a0\u8f7d\u5230 Buffer Pool \u540e\uff0c\u518d\u901a\u8fc7\u9875\u91cc\u7684\u9875\u76ee\u5f55\u53bb\u5b9a\u4f4d\u5230\u67d0\u6761\u5177\u4f53\u7684\u8bb0\u5f55\u3002 \u5173\u4e8e\u9875\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\u548c\u7d22\u5f15\u600e\u4e48\u67e5\u8be2\u6570\u636e\u7684\u95ee\u9898\u53ef\u4ee5\u5728\u8fd9\u7bc7\u627e\u5230\u7b54\u6848\uff1a \u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811","title":"Buffer Pool \u7f13\u5b58\u4ec0\u4e48\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_4","text":"","title":"\u5982\u4f55\u7ba1\u7406 Buffer Pool\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#_1","text":"Buffer Pool \u662f\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5f53 MySQL \u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u8fd9\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u7684\u7f13\u5b58\u9875\u65e2\u6709\u7a7a\u95f2\u7684\uff0c\u4e5f\u6709\u88ab\u4f7f\u7528\u7684\u3002 \u90a3\u5f53\u6211\u4eec\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u603b\u4e0d\u80fd\u901a\u8fc7\u904d\u5386\u8fd9\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u6765\u627e\u5230\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u5427\uff0c\u8fd9\u6837\u6548\u7387\u592a\u4f4e\u4e86\u3002 \u6240\u4ee5\uff0c\u4e3a\u4e86\u80fd\u591f\u5feb\u901f\u627e\u5230\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u53ef\u4ee5\u4f7f\u7528\u94fe\u8868\u7ed3\u6784\uff0c\u5c06\u7a7a\u95f2\u7f13\u5b58\u9875\u7684\u300c\u63a7\u5236\u5757\u300d\u4f5c\u4e3a\u94fe\u8868\u7684\u8282\u70b9\uff0c\u8fd9\u4e2a\u94fe\u8868\u79f0\u4e3a Free \u94fe\u8868 \uff08\u7a7a\u95f2\u94fe\u8868\uff09\u3002 Free \u94fe\u8868\u4e0a\u9664\u4e86\u6709\u63a7\u5236\u5757\uff0c\u8fd8\u6709\u4e00\u4e2a\u5934\u8282\u70b9\uff0c\u8be5\u5934\u8282\u70b9\u5305\u542b\u94fe\u8868\u7684\u5934\u8282\u70b9\u5730\u5740\uff0c\u5c3e\u8282\u70b9\u5730\u5740\uff0c\u4ee5\u53ca\u5f53\u524d\u94fe\u8868\u4e2d\u8282\u70b9\u7684\u6570\u91cf\u7b49\u4fe1\u606f\u3002 Free \u94fe\u8868\u8282\u70b9\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u63a7\u5236\u5757\uff0c\u800c\u6bcf\u4e2a\u63a7\u5236\u5757\u5305\u542b\u7740\u5bf9\u5e94\u7f13\u5b58\u9875\u7684\u5730\u5740\uff0c\u6240\u4ee5\u76f8\u5f53\u4e8e Free \u94fe\u8868\u8282\u70b9\u90fd\u5bf9\u5e94\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u3002 \u6709\u4e86 Free \u94fe\u8868\u540e\uff0c\u6bcf\u5f53\u9700\u8981\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u4e00\u4e2a\u9875\u5230 Buffer Pool \u4e2d\u65f6\uff0c\u5c31\u4ece Free\u94fe\u8868\u4e2d\u53d6\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u5e76\u4e14\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u7684\u4fe1\u606f\u586b\u4e0a\uff0c\u7136\u540e\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4ece Free \u94fe\u8868\u4e2d\u79fb\u9664\u3002","title":"\u5982\u4f55\u7ba1\u7406\u7a7a\u95f2\u9875\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#_2","text":"\u8bbe\u8ba1 Buffer Pool \u9664\u4e86\u80fd\u63d0\u9ad8\u8bfb\u6027\u80fd\uff0c\u8fd8\u80fd\u63d0\u9ad8\u5199\u6027\u80fd\uff0c\u4e5f\u5c31\u662f\u66f4\u65b0\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u8981\u5199\u5165\u78c1\u76d8\uff0c\u800c\u662f\u5c06 Buffer Pool \u5bf9\u5e94\u7684\u7f13\u5b58\u9875\u6807\u8bb0\u4e3a**\u810f\u9875**\uff0c\u7136\u540e\u518d\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002 \u90a3\u4e3a\u4e86\u80fd\u5feb\u901f\u77e5\u9053\u54ea\u4e9b\u7f13\u5b58\u9875\u662f\u810f\u7684\uff0c\u4e8e\u662f\u5c31\u8bbe\u8ba1\u51fa Flush \u94fe\u8868 \uff0c\u5b83\u8ddf Free \u94fe\u8868\u7c7b\u4f3c\u7684\uff0c\u94fe\u8868\u7684\u8282\u70b9\u4e5f\u662f\u63a7\u5236\u5757\uff0c\u533a\u522b\u5728\u4e8e Flush \u94fe\u8868\u7684\u5143\u7d20\u90fd\u662f\u810f\u9875\u3002 \u6709\u4e86 Flush \u94fe\u8868\u540e\uff0c\u540e\u53f0\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u904d\u5386 Flush \u94fe\u8868\uff0c\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002","title":"\u5982\u4f55\u7ba1\u7406\u810f\u9875\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#_3","text":"Buffer Pool \u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u4e00\u76f4\u7559\u5728 Buffer Pool \u4e2d\uff0c\u800c\u4e00\u4e9b\u5f88\u5c11\u8bbf\u95ee\u7684\u6570\u636e\u5e0c\u671b\u53ef\u4ee5\u5728\u67d0\u4e9b\u65f6\u673a\u53ef\u4ee5\u6dd8\u6c70\u6389\uff0c\u4ece\u800c\u4fdd\u8bc1 Buffer Pool \u4e0d\u4f1a\u56e0\u4e3a\u6ee1\u4e86\u800c\u5bfc\u81f4\u65e0\u6cd5\u518d\u7f13\u5b58\u65b0\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u80fd\u4fdd\u8bc1\u5e38\u7528\u6570\u636e\u7559\u5728 Buffer Pool \u4e2d\u3002 \u8981\u5b9e\u73b0\u8fd9\u4e2a\uff0c\u6700\u5bb9\u6613\u60f3\u5230\u7684\u5c31\u662f LRU\uff08Least recently used\uff09\u7b97\u6cd5\u3002 \u8be5\u7b97\u6cd5\u7684\u601d\u8def\u662f\uff0c\u94fe\u8868\u5934\u90e8\u7684\u8282\u70b9\u662f\u6700\u8fd1\u4f7f\u7528\u7684\uff0c\u800c\u94fe\u8868\u672b\u5c3e\u7684\u8282\u70b9\u662f\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u3002\u90a3\u4e48\uff0c\u5f53\u7a7a\u95f4\u4e0d\u591f\u4e86\uff0c\u5c31\u6dd8\u6c70\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u8282\u70b9\uff0c\u4ece\u800c\u817e\u51fa\u7a7a\u95f4\u3002 \u7b80\u5355\u7684 LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\u601d\u8def\u662f\u8fd9\u6837\u7684\uff1a \u5f53\u8bbf\u95ee\u7684\u9875\u5728 Buffer Pool \u91cc\uff0c\u5c31\u76f4\u63a5\u628a\u8be5\u9875\u5bf9\u5e94\u7684 LRU \u94fe\u8868\u8282\u70b9\u79fb\u52a8\u5230\u94fe\u8868\u7684\u5934\u90e8\u3002 \u5f53\u8bbf\u95ee\u7684\u9875\u4e0d\u5728 Buffer Pool \u91cc\uff0c\u9664\u4e86\u8981\u628a\u9875\u653e\u5165\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u8fd8\u8981\u6dd8\u6c70 LRU \u94fe\u8868\u672b\u5c3e\u7684\u8282\u70b9\u3002 \u6bd4\u5982\u4e0b\u56fe\uff0c\u5047\u8bbe LRU \u94fe\u8868\u957f\u5ea6\u4e3a 5\uff0cLRU \u94fe\u8868\u4ece\u5de6\u5230\u53f3\u6709 1\uff0c2\uff0c3\uff0c4\uff0c5 \u7684\u9875\u3002 \u5982\u679c\u8bbf\u95ee\u4e86 3 \u53f7\u7684\u9875\uff0c\u56e0\u4e3a 3 \u53f7\u9875\u5728 Buffer Pool \u91cc\uff0c\u6240\u4ee5\u628a 3 \u53f7\u9875\u79fb\u52a8\u5230\u5934\u90e8\u5373\u53ef\u3002 \u800c\u5982\u679c\u63a5\u4e0b\u6765\uff0c\u8bbf\u95ee\u4e86 8 \u53f7\u9875\uff0c\u56e0\u4e3a 8 \u53f7\u9875\u4e0d\u5728 Buffer Pool \u91cc\uff0c\u6240\u4ee5\u9700\u8981\u5148\u6dd8\u6c70\u672b\u5c3e\u7684 5 \u53f7\u9875\uff0c\u7136\u540e\u518d\u5c06 8 \u53f7\u9875\u52a0\u5165\u5230\u5934\u90e8\u3002 \u5230\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0cBuffer Pool \u91cc\u6709\u4e09\u79cd\u9875\u548c\u94fe\u8868\u6765\u7ba1\u7406\u6570\u636e\u3002 \u56fe\u4e2d\uff1a Free Page\uff08\u7a7a\u95f2\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u672a\u88ab\u4f7f\u7528\uff0c\u4f4d\u4e8e Free \u94fe\u8868\uff1b Clean Page\uff08\u5e72\u51c0\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u5df2\u88ab\u4f7f\u7528\uff0c\u4f46\u662f\u9875\u9762\u672a\u53d1\u751f\u4fee\u6539\uff0c\u4f4d\u4e8eLRU \u94fe\u8868\u3002 Dirty Page\uff08\u810f\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u300c\u5df2\u88ab\u4f7f\u7528\u300d\u4e14\u300c\u5df2\u7ecf\u88ab\u4fee\u6539\u300d\uff0c\u5176\u6570\u636e\u548c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u4e00\u81f4\u3002\u5f53\u810f\u9875\u4e0a\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u540e\uff0c\u5185\u5b58\u6570\u636e\u548c\u78c1\u76d8\u6570\u636e\u4e00\u81f4\uff0c\u90a3\u4e48\u8be5\u9875\u5c31\u53d8\u6210\u4e86\u5e72\u51c0\u9875\u3002\u810f\u9875\u540c\u65f6\u5b58\u5728\u4e8e LRU \u94fe\u8868\u548c Flush \u94fe\u8868\u3002 \u7b80\u5355\u7684 LRU \u7b97\u6cd5\u5e76\u6ca1\u6709\u88ab MySQL \u4f7f\u7528\uff0c\u56e0\u4e3a\u7b80\u5355\u7684 LRU \u7b97\u6cd5\u65e0\u6cd5\u907f\u514d\u4e0b\u9762\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a \u9884\u8bfb\u5931\u6548\uff1b Buffer Pool \u6c61\u67d3\uff1b \u4ec0\u4e48\u662f\u9884\u8bfb\u5931\u6548\uff1f \u5148\u6765\u8bf4\u8bf4 MySQL \u7684\u9884\u8bfb\u673a\u5236\u3002\u7a0b\u5e8f\u662f\u6709\u7a7a\u95f4\u5c40\u90e8\u6027\u7684\uff0c\u9760\u8fd1\u5f53\u524d\u88ab\u8bbf\u95ee\u6570\u636e\u7684\u6570\u636e\uff0c\u5728\u672a\u6765\u5f88\u5927\u6982\u7387\u4f1a\u88ab\u8bbf\u95ee\u5230\u3002 \u6240\u4ee5\uff0cMySQL \u5728\u52a0\u8f7d\u6570\u636e\u9875\u65f6\uff0c\u4f1a\u63d0\u524d\u628a\u5b83\u76f8\u90bb\u7684\u6570\u636e\u9875\u4e00\u5e76\u52a0\u8f7d\u8fdb\u6765\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 IO\u3002 \u4f46\u662f\u53ef\u80fd\u8fd9\u4e9b**\u88ab\u63d0\u524d\u52a0\u8f7d\u8fdb\u6765\u7684\u6570\u636e\u9875\uff0c\u5e76\u6ca1\u6709\u88ab\u8bbf\u95ee**\uff0c\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u9884\u8bfb\u662f\u767d\u505a\u4e86\uff0c\u8fd9\u4e2a\u5c31\u662f**\u9884\u8bfb\u5931\u6548**\u3002 \u5982\u679c\u4f7f\u7528\u7b80\u5355\u7684 LRU \u7b97\u6cd5\uff0c\u5c31\u4f1a\u628a\u9884\u8bfb\u9875\u653e\u5230 LRU \u94fe\u8868\u5934\u90e8\uff0c\u800c\u5f53 Buffer Pool\u7a7a\u95f4\u4e0d\u591f\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u628a\u672b\u5c3e\u7684\u9875\u6dd8\u6c70\u6389\u3002 \u5982\u679c\u8fd9\u4e9b\u9884\u8bfb\u9875\u5982\u679c\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u5f88\u5947\u602a\u7684\u95ee\u9898\uff0c\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u7684\u9884\u8bfb\u9875\u5374\u5360\u7528\u4e86 LRU \u94fe\u8868\u524d\u6392\u7684\u4f4d\u7f6e\uff0c\u800c\u672b\u5c3e\u6dd8\u6c70\u7684\u9875\uff0c\u53ef\u80fd\u662f\u9891\u7e41\u8bbf\u95ee\u7684\u9875\uff0c\u8fd9\u6837\u5c31\u5927\u5927\u964d\u4f4e\u4e86\u7f13\u5b58\u547d\u4e2d\u7387\u3002 \u600e\u4e48\u89e3\u51b3\u9884\u8bfb\u5931\u6548\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u964d\u4f4e\u7684\u95ee\u9898\uff1f \u6211\u4eec\u4e0d\u80fd\u56e0\u4e3a\u5bb3\u6015\u9884\u8bfb\u5931\u6548\uff0c\u800c\u5c06\u9884\u8bfb\u673a\u5236\u53bb\u6389\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u5c40\u90e8\u6027\u539f\u7406\u8fd8\u662f\u6210\u7acb\u7684\u3002 \u8981\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u5f71\u54cd\uff0c\u6700\u597d\u5c31\u662f**\u8ba9\u9884\u8bfb\u7684\u9875\u505c\u7559\u5728 Buffer Pool \u91cc\u7684\u65f6\u95f4\u8981\u5c3d\u53ef\u80fd\u7684\u77ed\uff0c\u8ba9\u771f\u6b63\u88ab\u8bbf\u95ee\u7684\u9875\u624d\u79fb\u52a8\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u4ece\u800c\u4fdd\u8bc1\u771f\u6b63\u88ab\u8bfb\u53d6\u7684\u70ed\u6570\u636e\u7559\u5728 Buffer Pool \u91cc\u7684\u65f6\u95f4\u5c3d\u53ef\u80fd\u957f**\u3002 \u90a3\u5230\u5e95\u600e\u4e48\u624d\u80fd\u907f\u514d\u5462\uff1f MySQL \u662f\u8fd9\u6837\u505a\u7684\uff0c\u5b83\u6539\u8fdb\u4e86 LRU \u7b97\u6cd5\uff0c\u5c06 LRU \u5212\u5206\u4e86 2 \u4e2a\u533a\u57df\uff1a old \u533a\u57df \u548c young \u533a\u57df \u3002 young \u533a\u57df\u5728 LRU \u94fe\u8868\u7684\u524d\u534a\u90e8\u5206\uff0cold \u533a\u57df\u5219\u662f\u5728\u540e\u534a\u90e8\u5206\uff0c\u5982\u4e0b\u56fe\uff1a old \u533a\u57df\u5360\u6574\u4e2a LRU \u94fe\u8868\u957f\u5ea6\u7684\u6bd4\u4f8b\u53ef\u4ee5\u901a\u8fc7 innodb_old_blocks_pc \u53c2\u6570\u6765\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u662f 37\uff0c\u4ee3\u8868\u6574\u4e2a LRU \u94fe\u8868\u4e2d young \u533a\u57df\u4e0e old \u533a\u57df\u6bd4\u4f8b\u662f 63:37\u3002 \u5212\u5206\u8fd9\u4e24\u4e2a\u533a\u57df\u540e\uff0c\u9884\u8bfb\u7684\u9875\u5c31\u53ea\u9700\u8981\u52a0\u5165\u5230 old \u533a\u57df\u7684\u5934\u90e8\uff0c\u5f53\u9875\u88ab\u771f\u6b63\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u624d\u5c06\u9875\u63d2\u5165 young \u533a\u57df\u7684\u5934\u90e8 \u3002\u5982\u679c\u9884\u8bfb\u7684\u9875\u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u4ece old \u533a\u57df\u79fb\u9664\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u5f71\u54cd young \u533a\u57df\u4e2d\u7684\u70ed\u70b9\u6570\u636e\u3002 \u63a5\u4e0b\u6765\uff0c\u7ed9\u5927\u5bb6\u4e3e\u4e2a\u4f8b\u5b50\u3002 \u5047\u8bbe\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a 10 \u7684 LRU \u94fe\u8868\uff0c\u5176\u4e2d young \u533a\u57df\u5360\u6bd4 70 %\uff0cold \u533a\u57df\u5360\u6bd4 30 %\u3002 \u73b0\u5728\u6709\u4e2a\u7f16\u53f7\u4e3a 20 \u7684\u9875\u88ab\u9884\u8bfb\u4e86\uff0c\u8fd9\u4e2a\u9875\u53ea\u4f1a\u88ab\u63d2\u5165\u5230 old \u533a\u57df\u5934\u90e8\uff0c\u800c old \u533a\u57df\u672b\u5c3e\u7684\u9875\uff0810\u53f7\uff09\u4f1a\u88ab\u6dd8\u6c70\u6389\u3002 \u5982\u679c 20 \u53f7\u9875\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\uff0c\u5b83\u4e5f\u6ca1\u6709\u5360\u7528\u5230 young \u533a\u57df\u7684\u4f4d\u7f6e\uff0c\u800c\u4e14\u8fd8\u4f1a\u6bd4 young \u533a\u57df\u7684\u6570\u636e\u66f4\u65e9\u88ab\u6dd8\u6c70\u51fa\u53bb\u3002 \u5982\u679c 20 \u53f7\u9875\u88ab\u9884\u8bfb\u540e\uff0c\u7acb\u523b\u88ab\u8bbf\u95ee\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u5b83\u63d2\u5165\u5230 young \u533a\u57df\u7684\u5934\u90e8\uff0cyoung \u533a\u57df\u672b\u5c3e\u7684\u9875\uff087\u53f7\uff09\uff0c\u4f1a\u88ab\u6324\u5230 old \u533a\u57df\uff0c\u4f5c\u4e3a old \u533a\u57df\u7684\u5934\u90e8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u6709\u9875\u88ab\u6dd8\u6c70\u3002 \u867d\u7136\u901a\u8fc7\u5212\u5206 old \u533a\u57df \u548c young \u533a\u57df\u907f\u514d\u4e86\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u4f46\u662f\u8fd8\u6709\u4e2a\u95ee\u9898\u65e0\u6cd5\u89e3\u51b3\uff0c\u90a3\u5c31\u662f Buffer Pool \u6c61\u67d3\u7684\u95ee\u9898\u3002 \u4ec0\u4e48\u662f Buffer Pool \u6c61\u67d3\uff1f \u5f53\u67d0\u4e00\u4e2a SQL \u8bed\u53e5**\u626b\u63cf\u4e86\u5927\u91cf\u7684\u6570\u636e**\u65f6\uff0c\u5728 Buffer Pool \u7a7a\u95f4\u6bd4\u8f83\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u5c06 Buffer Pool \u91cc\u7684\u6240\u6709\u9875\u90fd\u66ff\u6362\u51fa\u53bb\uff0c\u5bfc\u81f4\u5927\u91cf\u70ed\u6570\u636e\u88ab\u6dd8\u6c70\u4e86 \uff0c\u7b49\u8fd9\u4e9b\u70ed\u6570\u636e\u53c8\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u78c1\u76d8 IO\uff0cMySQL \u6027\u80fd\u5c31\u4f1a\u6025\u5267\u4e0b\u964d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3a Buffer Pool \u6c61\u67d3 \u3002 \u6ce8\u610f\uff0c Buffer Pool \u6c61\u67d3\u5e76\u4e0d\u53ea\u662f\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u51fa\u4e86\u5927\u91cf\u7684\u6570\u636e\u624d\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u5373\u4f7f\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u96c6\u5f88\u5c0f\uff0c\u4e5f\u4f1a\u9020\u6210 Buffer Pool \u6c61\u67d3\u3002 \u6bd4\u5982\uff0c\u5728\u4e00\u4e2a\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u8868\uff0c\u6267\u884c\u4e86\u8fd9\u6761\u8bed\u53e5\uff1a select * from t_user where name like \"%xiaolin%\" ; \u53ef\u80fd\u8fd9\u4e2a\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u5c31\u51e0\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u6761\u8bed\u53e5\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\uff0c\u6240\u4ee5\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u662f\u5168\u8868\u626b\u63cf\u7684\uff0c\u63a5\u7740\u4f1a\u53d1\u751f\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a \u4ece\u78c1\u76d8\u8bfb\u5230\u7684\u9875\u52a0\u5165\u5230 LRU \u94fe\u8868\u7684 old \u533a\u57df\u5934\u90e8\uff1b \u5f53\u4ece\u9875\u91cc\u8bfb\u53d6\u884c\u8bb0\u5f55\u65f6\uff0c\u4e5f\u5c31\u662f\u9875\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5c31\u8981\u5c06\u8be5\u9875\u653e\u5230 young \u533a\u57df\u5934\u90e8\uff1b \u63a5\u4e0b\u6765\u62ff\u884c\u8bb0\u5f55\u7684 name \u5b57\u6bb5\u548c\u5b57\u7b26\u4e32 xiaolin \u8fdb\u884c\u6a21\u7cca\u5339\u914d\uff0c\u5982\u679c\u7b26\u5408\u6761\u4ef6\uff0c\u5c31\u52a0\u5165\u5230\u7ed3\u679c\u96c6\u91cc\uff1b \u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u626b\u63cf\u5b8c\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u3002 \u7ecf\u8fc7\u8fd9\u4e00\u756a\u6298\u817e\uff0c\u539f\u672c young \u533a\u57df\u7684\u70ed\u70b9\u6570\u636e\u90fd\u4f1a\u88ab\u66ff\u6362\u6389\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u9700\u8981\u6279\u91cf\u626b\u63cf\uff1a21\uff0c22\uff0c23\uff0c24\uff0c25 \u8fd9\u4e94\u4e2a\u9875\uff0c\u8fd9\u4e9b\u9875\u90fd\u4f1a\u88ab\u9010\u4e00\u8bbf\u95ee\uff08\u8bfb\u53d6\u9875\u91cc\u7684\u8bb0\u5f55\uff09\u3002 \u5728\u6279\u91cf\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u9010\u4e00\u63d2\u5165\u5230 young \u533a\u57df\u5934\u90e8\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u539f\u672c\u5728 young \u533a\u57df\u7684\u70ed\u70b9\u6570\u636e 6 \u548c 7 \u53f7\u9875\u90fd\u88ab\u6dd8\u6c70\u4e86\uff0c\u8fd9\u5c31\u662f Buffer Pool \u6c61\u67d3\u7684\u95ee\u9898\u3002 \u600e\u4e48\u89e3\u51b3\u51fa\u73b0 Buffer Pool \u6c61\u67d3\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u7684\u95ee\u9898\uff1f \u50cf\u524d\u9762\u8fd9\u79cd\u5168\u8868\u626b\u63cf\u7684\u67e5\u8be2\uff0c\u5f88\u591a\u7f13\u51b2\u9875\u5176\u5b9e\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u4f46\u662f\u5b83\u5374\u53ea\u56e0\u4e3a\u88ab\u8bbf\u95ee\u4e86\u4e00\u6b21\u800c\u8fdb\u5165\u5230 young \u533a\u57df\uff0c\u4ece\u800c\u5bfc\u81f4\u70ed\u70b9\u6570\u636e\u88ab\u66ff\u6362\u4e86\u3002 LRU \u94fe\u8868\u4e2d young \u533a\u57df\u5c31\u662f\u70ed\u70b9\u6570\u636e\uff0c\u53ea\u8981\u6211\u4eec\u63d0\u9ad8\u8fdb\u5165\u5230 young \u533a\u57df\u7684\u95e8\u69db\uff0c\u5c31\u80fd\u6709\u6548\u5730\u4fdd\u8bc1 young \u533a\u57df\u91cc\u7684\u70ed\u70b9\u6570\u636e\u4e0d\u4f1a\u88ab\u66ff\u6362\u6389\u3002 MySQL \u662f\u8fd9\u6837\u505a\u7684\uff0c\u8fdb\u5165\u5230 young \u533a\u57df\u6761\u4ef6\u589e\u52a0\u4e86\u4e00\u4e2a**\u505c\u7559\u5728 old \u533a\u57df\u7684\u65f6\u95f4\u5224\u65ad**\u3002 \u5177\u4f53\u662f\u8fd9\u6837\u505a\u7684\uff0c\u5728\u5bf9\u67d0\u4e2a\u5904\u5728 old \u533a\u57df\u7684\u7f13\u5b58\u9875\u8fdb\u884c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\uff0c\u5c31\u5728\u5b83\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4e2d\u8bb0\u5f55\u4e0b\u6765\u8fd9\u4e2a\u8bbf\u95ee\u65f6\u95f4\uff1a \u5982\u679c\u540e\u7eed\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4**\u5728\u67d0\u4e2a\u65f6\u95f4\u95f4\u9694\u5185**\uff0c\u90a3\u4e48**\u8be5\u7f13\u5b58\u9875\u5c31\u4e0d\u4f1a\u88ab\u4ece old \u533a\u57df\u79fb\u52a8\u5230 young \u533a\u57df\u7684\u5934\u90e8**\uff1b \u5982\u679c\u540e\u7eed\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4**\u4e0d\u5728\u67d0\u4e2a\u65f6\u95f4\u95f4\u9694\u5185**\uff0c\u90a3\u4e48**\u8be5\u7f13\u5b58\u9875\u79fb\u52a8\u5230 young \u533a\u57df\u7684\u5934\u90e8**\uff1b \u8fd9\u4e2a\u95f4\u9694\u65f6\u95f4\u662f\u7531 innodb_old_blocks_time \u63a7\u5236\u7684\uff0c\u9ed8\u8ba4\u662f 1000 ms\u3002 \u4e5f\u5c31\u8bf4\uff0c \u53ea\u6709\u540c\u65f6\u6ee1\u8db3\u300c\u88ab\u8bbf\u95ee\u300d\u4e0e\u300c\u5728 old \u533a\u57df\u505c\u7559\u65f6\u95f4\u8d85\u8fc7 1 \u79d2\u300d\u4e24\u4e2a\u6761\u4ef6\uff0c\u624d\u4f1a\u88ab\u63d2\u5165\u5230 young \u533a\u57df\u5934\u90e8 \uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86 Buffer Pool \u6c61\u67d3\u7684\u95ee\u9898 \u3002 \u53e6\u5916\uff0cMySQL \u9488\u5bf9 young \u533a\u57df\u5176\u5b9e\u505a\u4e86\u4e00\u4e2a\u4f18\u5316\uff0c\u4e3a\u4e86\u9632\u6b62 young \u533a\u57df\u8282\u70b9\u9891\u7e41\u79fb\u52a8\u5230\u5934\u90e8\u3002young \u533a\u57df\u524d\u9762 \u00bc \u88ab\u8bbf\u95ee\u4e0d\u4f1a\u79fb\u52a8\u5230\u94fe\u8868\u5934\u90e8\uff0c\u53ea\u6709\u540e\u9762\u7684 \u00be\u88ab\u8bbf\u95ee\u4e86\u624d\u4f1a\u3002","title":"\u5982\u4f55\u63d0\u9ad8\u7f13\u5b58\u547d\u4e2d\u7387\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#_4","text":"\u5f15\u5165\u4e86 Buffer Pool \u540e\uff0c\u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u9996\u5148\u662f\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u4f46\u662f\u78c1\u76d8\u4e2d\u8fd8\u662f\u539f\u6570\u636e\u3002 \u56e0\u6b64\uff0c\u810f\u9875\u9700\u8981\u88ab\u5237\u5165\u78c1\u76d8\uff0c\u4fdd\u8bc1\u7f13\u5b58\u548c\u78c1\u76d8\u6570\u636e\u4e00\u81f4\uff0c\u4f46\u662f\u82e5\u6bcf\u6b21\u4fee\u6539\u6570\u636e\u90fd\u5237\u5165\u78c1\u76d8\uff0c\u5219\u6027\u80fd\u4f1a\u5f88\u5dee\uff0c\u56e0\u6b64\u4e00\u822c\u90fd\u4f1a\u5728\u4e00\u5b9a\u65f6\u673a\u8fdb\u884c\u6279\u91cf\u5237\u76d8\u3002 \u53ef\u80fd\u5927\u5bb6\u62c5\u5fc3\uff0c\u5982\u679c\u5728\u810f\u9875\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5237\u5165\u5230\u78c1\u76d8\u65f6\uff0cMySQL \u5b95\u673a\u4e86\uff0c\u4e0d\u5c31\u4e22\u5931\u6570\u636e\u4e86\u5417\uff1f \u8fd9\u4e2a\u4e0d\u7528\u62c5\u5fc3\uff0cInnoDB \u7684\u66f4\u65b0\u64cd\u4f5c\u91c7\u7528\u7684\u662f Write Ahead Log \u7b56\u7565\uff0c\u5373\u5148\u5199\u65e5\u5fd7\uff0c\u518d\u5199\u5165\u78c1\u76d8\uff0c\u901a\u8fc7 redo log \u65e5\u5fd7\u8ba9 MySQL \u62e5\u6709\u4e86\u5d29\u6e83\u6062\u590d\u80fd\u529b\u3002 \u4e0b\u9762\u51e0\u79cd\u60c5\u51b5\u4f1a\u89e6\u53d1\u810f\u9875\u7684\u5237\u65b0\uff1a \u5f53 redo log \u65e5\u5fd7\u6ee1\u4e86\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4e3b\u52a8\u89e6\u53d1\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\uff1b Buffer Pool \u7a7a\u95f4\u4e0d\u8db3\u65f6\uff0c\u9700\u8981\u5c06\u4e00\u90e8\u5206\u6570\u636e\u9875\u6dd8\u6c70\u6389\uff0c\u5982\u679c\u6dd8\u6c70\u7684\u662f\u810f\u9875\uff0c\u9700\u8981\u5148\u5c06\u810f\u9875\u540c\u6b65\u5230\u78c1\u76d8\uff1b MySQL \u8ba4\u4e3a\u7a7a\u95f2\u65f6\uff0c\u540e\u53f0\u7ebf\u7a0b\u56de\u5b9a\u671f\u5c06\u9002\u91cf\u7684\u810f\u9875\u5237\u5165\u5230\u78c1\u76d8\uff1b MySQL \u6b63\u5e38\u5173\u95ed\u4e4b\u524d\uff0c\u4f1a\u628a\u6240\u6709\u7684\u810f\u9875\u5237\u5165\u5230\u78c1\u76d8\uff1b \u5728\u6211\u4eec\u5f00\u542f\u4e86\u6162 SQL \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f60\u53d1\u73b0**\u300c\u5076\u5c14\u300d\u4f1a\u51fa\u73b0\u4e00\u4e9b\u7528\u65f6\u7a0d\u957f\u7684 SQL**\uff0c\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u810f\u9875\u5728\u5237\u65b0\u5230\u78c1\u76d8\u65f6\u53ef\u80fd\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u6027\u80fd\u5f00\u9500\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u64cd\u4f5c\u6296\u52a8\u3002 \u5982\u679c\u95f4\u65ad\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\uff0c\u5c31\u9700\u8981\u8c03\u5927 Buffer Pool \u7a7a\u95f4\u6216 redo log \u65e5\u5fd7\u7684\u5927\u5c0f\u3002","title":"\u810f\u9875\u4ec0\u4e48\u65f6\u5019\u4f1a\u88ab\u5237\u5165\u78c1\u76d8\uff1f"},{"location":"mysql/buffer_pool/buffer_pool/#_5","text":"Innodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a**\u7f13\u51b2\u6c60\uff08 Buffer Pool \uff09**\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002 Buffer Pool \u4ee5\u9875\u4e3a\u5355\u4f4d\u7f13\u51b2\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7 innodb_buffer_pool_size \u53c2\u6570\u8c03\u6574\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u662f 128 M\u3002 Innodb \u901a\u8fc7\u4e09\u79cd\u94fe\u8868\u6765\u7ba1\u7406\u7f13\u9875\uff1a Free List \uff08\u7a7a\u95f2\u9875\u94fe\u8868\uff09\uff0c\u7ba1\u7406\u7a7a\u95f2\u9875\uff1b Flush List \uff08\u810f\u9875\u94fe\u8868\uff09\uff0c\u7ba1\u7406\u810f\u9875\uff1b LRU List\uff0c\u7ba1\u7406\u810f\u9875+\u5e72\u51c0\u9875\uff0c\u5c06\u6700\u8fd1\u4e14\u7ecf\u5e38\u67e5\u8be2\u7684\u6570\u636e\u7f13\u5b58\u5728\u5176\u4e2d\uff0c\u800c\u4e0d\u5e38\u67e5\u8be2\u7684\u6570\u636e\u5c31\u6dd8\u6c70\u51fa\u53bb\u3002\uff1b InnoDB \u5bf9 LRU \u505a\u4e86\u4e00\u4e9b\u4f18\u5316\uff0c\u6211\u4eec\u719f\u6089\u7684 LRU \u7b97\u6cd5\u901a\u5e38\u662f\u5c06\u6700\u8fd1\u67e5\u8be2\u7684\u6570\u636e\u653e\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u800c InnoDB \u505a 2 \u70b9\u4f18\u5316\uff1a \u5c06 LRU \u94fe\u8868 \u5206\u4e3a**young \u548c old \u4e24\u4e2a\u533a\u57df**\uff0c\u52a0\u5165\u7f13\u51b2\u6c60\u7684\u9875\uff0c\u4f18\u5148\u63d2\u5165 old \u533a\u57df\uff1b\u9875\u88ab\u8bbf\u95ee\u65f6\uff0c\u624d\u8fdb\u5165 young \u533a\u57df\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u9884\u8bfb\u5931\u6548\u7684\u95ee\u9898\u3002 \u5f53**\u300c\u9875\u88ab\u8bbf\u95ee\u300d\u4e14\u300c old \u533a\u57df\u505c\u7559\u65f6\u95f4\u8d85\u8fc7 innodb_old_blocks_time \u9608\u503c\uff08\u9ed8\u8ba4\u4e3a1\u79d2\uff09\u300d**\u65f6\uff0c\u624d\u4f1a\u5c06\u9875\u63d2\u5165\u5230 young \u533a\u57df\uff0c\u5426\u5219\u8fd8\u662f\u63d2\u5165\u5230 old \u533a\u57df\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u6279\u91cf\u6570\u636e\u8bbf\u95ee\uff0c\u5927\u91cf\u70ed\u6570\u636e\u6dd8\u6c70\u7684\u95ee\u9898\u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 innodb_old_blocks_pc \u53c2\u6570\uff0c\u8bbe\u7f6e young \u533a\u57df\u548c old \u533a\u57df\u6bd4\u4f8b\u3002 \u5728\u5f00\u542f\u4e86\u6162 SQL \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f60\u53d1\u73b0\u300c\u5076\u5c14\u300d\u4f1a\u51fa\u73b0\u4e00\u4e9b\u7528\u65f6\u7a0d\u957f\u7684 SQL\uff0c\u8fd9\u53ef\u56e0\u4e3a\u810f\u9875\u5728\u5237\u65b0\u5230\u78c1\u76d8\u65f6\u5bfc\u81f4\u6570\u636e\u5e93\u6027\u80fd\u6296\u52a8\u3002\u5982\u679c\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\uff0c\u5c31\u9700\u8981\u8c03\u5927 Buffer Pool \u7a7a\u95f4\u6216 redo log \u65e5\u5fd7\u7684\u5927\u5c0f\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/index/2000w/","text":"MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f \u00b6 \u4f5c\u4e3a\u5728\u540e\u7aef\u5708\u5f00\u8f66\u7684\u591a\u5e74\u8001\u53f8\u673a\uff0c\u662f\u4e0d\u662f\u7ecf\u5e38\u542c\u5230\u8fc7\uff1a \u201cMySQL \u5355\u8868\u6700\u597d\u4e0d\u8981\u8d85\u8fc7 2000W\u201d \u201c\u5355\u8868\u8d85\u8fc7 2000W \u5c31\u8981\u8003\u8651\u6570\u636e\u8fc1\u79fb\u4e86\u201d \u201c\u4f60\u8fd9\u4e2a\u8868\u6570\u636e\u90fd\u9a6c\u4e0a\u8981\u5230 2000W \u4e86\uff0c\u96be\u602a\u67e5\u8be2\u901f\u5ea6\u6162\u201d \u8fd9\u4e9b\u540d\u8a00\u6c11\u8bed\u5c31\u548c \u201c\u7fa4\u91cc\u53ea\u8ba8\u8bba\u6280\u672f\uff0c\u4e0d\u5f00\u8f66\uff0c\u5f00\u8f66\u901f\u5ea6\u4e0d\u8981\u8d85\u8fc7 120 \u7801\uff0c\u5426\u5219\u81ea\u52a8\u8e22\u7fa4\u201d\uff0c\u53ea\u542c\u8fc7\uff0c\u6ca1\u8bd5\u8fc7\uff0c\u54c8\u54c8\u3002 \u4e0b\u9762\u6211\u4eec\u5c31\u628a\u8f66\u901f\u8e29\u5230\u5e95\uff0c\u5e72\u5230 180 \u7801\u8bd5\u8bd5\u2026\u2026. \u539f\u6587\u94fe\u63a5\uff1ahttps://my.oschina.net/u/4090830/blog/5559454 \u5b9e\u9a8c \u00b6 \u5b9e\u9a8c\u4e00\u628a\u770b\u770b\u2026 \u5efa\u4e00\u5f20\u8868 CREATE TABLE person ( id int NOT NULL AUTO_INCREMENT PRIMARY KEY comment '\u4e3b\u952e' , person_id tinyint not null comment '\u7528\u6237id' , person_name VARCHAR ( 200 ) comment '\u7528\u6237\u540d\u79f0' , gmt_create datetime comment '\u521b\u5efa\u65f6\u95f4' , gmt_modified datetime comment '\u4fee\u6539\u65f6\u95f4' ) comment '\u4eba\u5458\u4fe1\u606f\u8868' ; \u63d2\u5165\u4e00\u6761\u6570\u636e insert into person values ( 1 , 1 , 'user_1' , NOW (), now ()); \u5229\u7528 MySQL \u4f2a\u5217 rownum \u8bbe\u7f6e\u4f2a\u5217\u8d77\u59cb\u70b9\u4e3a 1 select ( @ i : =@ i + 1 ) as rownum , person_name from person , ( select @ i : = 100 ) as init ; set @ i = 1 ; \u8fd0\u884c\u4e0b\u9762\u7684 sql\uff0c\u8fde\u7eed\u6267\u884c 20 \u6b21\uff0c\u5c31\u662f 2 \u7684 20 \u6b21\u65b9\u7ea6\u7b49\u4e8e 100w \u7684\u6570\u636e\uff1b\u6267\u884c 23 \u6b21\u5c31\u662f 2 \u7684 23 \u6b21\u65b9\u7ea6\u7b49\u4e8e 800w , \u5982\u6b64\u4e0b\u53bb\u5373\u53ef\u5b9e\u73b0\u5343\u4e07\u6d4b\u8bd5\u6570\u636e\u7684\u63d2\u5165\u3002 \u5982\u679c\u4e0d\u60f3\u7ffb\u500d\u7ffb\u500d\u7684\u589e\u52a0\u6570\u636e\uff0c\u800c\u662f\u60f3\u5c11\u91cf\uff0c\u5c11\u91cf\u7684\u589e\u52a0\uff0c\u6709\u4e2a\u6280\u5de7\uff0c\u5c31\u662f\u5728 SQL \u7684\u540e\u9762\u589e\u52a0 where \u6761\u4ef6\uff0c\u5982 id > \u67d0\u4e00\u4e2a\u503c\u53bb\u63a7\u5236\u589e\u52a0\u7684\u6570\u636e\u91cf\u5373\u53ef\u3002 insert into person ( id , person_id , person_name , gmt_create , gmt_modified ) select @ i : =@ i + 1 , left ( rand () * 10 , 10 ) as person_id , concat ( 'user_' , @ i % 2048 ), date_add ( gmt_create , interval + @ i * cast ( rand () * 100 as signed ) SECOND ), date_add ( date_add ( gmt_modified , interval +@ i * cast ( rand () * 100 as signed ) SECOND ), interval + cast ( rand () * 1000000 as signed ) SECOND ) from person ; \u6b64\u5904\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e5f\u8bb8\u4f60\u5728\u6267\u884c\u5230\u8fd1 800w \u6216\u8005 1000w \u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u62a5\u9519\uff1aThe total number of locks exceeds the lock table size\u3002 \u8fd9\u662f\u7531\u4e8e\u4f60\u7684\u4e34\u65f6\u8868\u5185\u5b58\u8bbe\u7f6e\u7684\u4e0d\u591f\u5927\uff0c\u53ea\u9700\u8981\u6269\u5927\u4e00\u4e0b\u8bbe\u7f6e\u53c2\u6570\u5373\u53ef\u3002 SET GLOBAL tmp_table_size = 512 * 1024 * 1024 ; \uff08 512 M \uff09 SET global innodb_buffer_pool_size = 1 * 1024 * 1024 * 1024 ( 1 G ); \u5148\u6765\u770b\u4e00\u7ec4\u6d4b\u8bd5\u6570\u636e\uff0c\u8fd9\u7ec4\u6570\u636e\u662f\u5728 MySQL 8.0 \u7684\u7248\u672c\uff0c\u5e76\u4e14\u662f\u5728\u6211\u672c\u673a\u4e0a\uff0c\u7531\u4e8e\u672c\u673a\u8fd8\u8dd1\u7740 idea , \u6d4f\u89c8\u5668\u7b49\u5404\u79cd\u5de5\u5177\uff0c\u6240\u4ee5\u5e76\u4e0d\u662f\u673a\u5668\u914d\u7f6e\u5c31\u662f\u7528\u4e8e\u6570\u636e\u5e93\u914d\u7f6e\uff0c\u6240\u4ee5\u6d4b\u8bd5\u6570\u636e\u53ea\u9650\u4e8e\u53c2\u8003\u3002 \u770b\u5230\u8fd9\u7ec4\u6570\u636e\u4f3c\u4e4e\u597d\u50cf\u771f\u7684\u548c\u6807\u9898\u5bf9\u5e94\uff0c\u5f53\u6570\u636e\u8fbe\u5230 2000W \u4ee5\u540e\uff0c\u67e5\u8be2\u65f6\u957f\u6025\u5267\u4e0a\u5347\uff0c\u96be\u9053\u8fd9\u5c31\u662f\u94c1\u5f8b\u5417\uff1f \u90a3\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u770b\u8fd9\u4e2a\u5efa\u8bae\u503c 2000W \u662f\u600e\u4e48\u6765\u7684\uff1f \u5355\u8868\u6570\u91cf\u9650\u5236 \u00b6 \u9996\u5148\u6211\u4eec\u5148\u60f3\u60f3\u6570\u636e\u5e93\u5355\u8868\u884c\u6570\u6700\u5927\u591a\u5927\uff1f CREATE TABLE person ( id int ( 10 ) NOT NULL AUTO_INCREMENT PRIMARY KEY comment '\u4e3b\u952e' , person_id tinyint not null comment '\u7528\u6237id' , person_name VARCHAR ( 200 ) comment '\u7528\u6237\u540d\u79f0' , gmt_create datetime comment '\u521b\u5efa\u65f6\u95f4' , gmt_modified datetime comment '\u4fee\u6539\u65f6\u95f4' ) comment '\u4eba\u5458\u4fe1\u606f\u8868' ; \u770b\u770b\u4e0a\u9762\u7684\u5efa\u8868 sql\u3002id \u662f\u4e3b\u952e\uff0c\u672c\u8eab\u5c31\u662f\u552f\u4e00\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e3b\u952e\u7684\u5927\u5c0f\u53ef\u4ee5\u9650\u5236\u8868\u7684\u4e0a\u9650\uff1a \u5982\u679c\u4e3b\u952e\u58f0\u660e int \u7c7b\u578b\uff0c\u4e5f\u5c31\u662f 32 \u4f4d\uff0c\u90a3\u4e48\u652f\u6301 2^32-1 ~~21 \u4ebf\uff1b \u5982\u679c\u4e3b\u952e\u58f0\u660e bigint \u7c7b\u578b\uff0c\u90a3\u5c31\u662f 2^62-1 \uff0836893488147419103232\uff09\uff0c\u96be\u4ee5\u60f3\u8c61\u8fd9\u4e2a\u7684\u591a\u5927\u4e86\uff0c\u4e00\u822c\u8fd8\u6ca1\u6709\u5230\u8fd9\u4e2a\u9650\u5236\u4e4b\u524d\uff0c\u53ef\u80fd\u6570\u636e\u5e93\u5df2\u7ecf\u7206\u6ee1\u4e86\uff01\uff01 \u6709\u4eba\u7edf\u8ba1\u8fc7\uff0c\u5982\u679c\u5efa\u8868\u7684\u65f6\u5019\uff0c\u81ea\u589e\u5b57\u6bb5\u9009\u62e9\u65e0\u7b26\u53f7\u7684 bigint , \u90a3\u4e48\u81ea\u589e\u957f\u6700\u5927\u503c\u662f 18446744073709551615\uff0c\u6309\u7167\u4e00\u79d2\u65b0\u589e\u4e00\u6761\u8bb0\u5f55\u7684\u901f\u5ea6\uff0c\u5927\u7ea6\u4ec0\u4e48\u65f6\u5019\u80fd\u7528\u5b8c\uff1f \u8868\u7a7a\u95f4 \u00b6 \u4e0b\u9762\u6211\u4eec\u518d\u6765\u770b\u770b\u7d22\u5f15\u7684\u7ed3\u6784\uff0c\u6211\u4eec\u4e0b\u9762\u8bb2\u5185\u5bb9\u90fd\u662f\u57fa\u4e8e Innodb \u5f15\u64ce\u7684\uff0c\u5927\u5bb6\u90fd\u77e5\u9053 Innodb \u7684\u7d22\u5f15\u5185\u90e8\u7528\u7684\u662f B+ \u6811\u3002 \u8fd9\u5f20\u8868\u6570\u636e\uff0c\u5728\u786c\u76d8\u4e0a\u5b58\u50a8\u4e5f\u662f\u7c7b\u4f3c\u5982\u6b64\u7684\uff0c\u5b83\u5b9e\u9645\u662f\u653e\u5728\u4e00\u4e2a\u53eb person.ibd \uff08innodb data\uff09\u7684\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53eb\u505a\u8868\u7a7a\u95f4\uff1b\u867d\u7136\u6570\u636e\u8868\u4e2d\uff0c\u4ed6\u4eec\u770b\u8d77\u6765\u662f\u4e00\u6761\u8fde\u7740\u4e00\u6761\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5728\u6587\u4ef6\u4e2d\u5b83\u88ab\u5206\u6210\u5f88\u591a\u5c0f\u4efd\u7684\u6570\u636e\u9875\uff0c\u800c\u4e14\u6bcf\u4e00\u4efd\u90fd\u662f 16K\u3002 \u5927\u6982\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\uff0c\u5f53\u7136\u8fd9\u53ea\u662f\u6211\u4eec\u62bd\u8c61\u51fa\u6765\u7684\uff0c\u5728\u8868\u7a7a\u95f4\u4e2d\u8fd8\u6709\u6bb5\u3001\u533a\u3001\u7ec4\u7b49\u5f88\u591a\u6982\u5ff5\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u8df3\u51fa\u6765\u770b\u3002 \u9875\u7684\u6570\u636e\u7ed3\u6784 \u00b6 \u5b9e\u9645\u9875\u7684\u5185\u90e8\u7ed3\u6784\u50cf\u662f\u4e0b\u9762\u8fd9\u6837\u7684\uff1a \u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u4e00\u4e2a InnoDB \u6570\u636e\u9875\u7684\u5b58\u50a8\u7a7a\u95f4\u5927\u81f4\u88ab\u5212\u5206\u6210\u4e86 7 \u4e2a\u90e8\u5206\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u786e\u5b9a\u7684\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u4e0d\u786e\u5b9a\u7684\u3002 \u5728\u9875\u7684 7 \u4e2a\u7ec4\u6210\u90e8\u5206\u4e2d\uff0c\u6211\u4eec\u81ea\u5df1\u5b58\u50a8\u7684\u8bb0\u5f55\u4f1a\u6309\u7167\u6211\u4eec\u6307\u5b9a\u7684\u884c\u683c\u5f0f\u5b58\u50a8\u5230 User Records \u90e8\u5206\u3002 \u4f46\u662f\u5728\u4e00\u5f00\u59cb\u751f\u6210\u9875\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u5e76\u6ca1\u6709 User Records \u8fd9\u4e2a\u90e8\u5206\uff0c\u6bcf\u5f53\u6211\u4eec\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u90fd\u4f1a\u4ece Free Space \u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u5c1a\u672a\u4f7f\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u4e2d\u7533\u8bf7\u4e00\u4e2a\u8bb0\u5f55\u5927\u5c0f\u7684\u7a7a\u95f4\u5212\u5206\u5230 User Records \u90e8\u5206\u3002 \u5f53 Free Space \u90e8\u5206\u7684\u7a7a\u95f4\u5168\u90e8\u88ab User Records \u90e8\u5206\u66ff\u4ee3\u6389\u4e4b\u540e\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u8fd9\u4e2a\u9875\u4f7f\u7528\u5b8c\u4e86\uff0c\u5982\u679c\u8fd8\u6709\u65b0\u7684\u8bb0\u5f55\u63d2\u5165\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u53bb\u7533\u8bf7\u65b0\u7684\u9875\u4e86\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u7684\u56fe\u793a\u5982\u4e0b\uff1a \u521a\u521a\u4e0a\u9762\u8bf4\u5230\u4e86\u6570\u636e\u7684\u65b0\u589e\u7684\u8fc7\u7a0b\u3002 \u90a3\u4e0b\u9762\u5c31\u6765\u8bf4\u8bf4\uff0c\u6570\u636e\u7684\u67e5\u627e\u8fc7\u7a0b\uff0c\u5047\u5982\u6211\u4eec\u9700\u8981\u67e5\u627e\u4e00\u6761\u8bb0\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8868\u7a7a\u95f4\u4e2d\u7684\u6bcf\u4e00\u9875\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u5bf9\u8bb0\u5f55\u6328\u4e2a\u5224\u65ad\u662f\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002 \u5728\u6570\u636e\u91cf\u5c0f\u7684\u65f6\u5019\uff0c\u6ca1\u5565\u95ee\u9898\uff0c\u5185\u5b58\u4e5f\u53ef\u4ee5\u6491\u3002\u4f46\u662f\u73b0\u5b9e\u5c31\u662f\u8fd9\u4e48\u6b8b\u9177\uff0c\u4e0d\u4f1a\u7ed9\u4f60\u8fd9\u4e2a\u5c40\u9762\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u95ee\u9898\uff0cMySQL \u4e2d\u5c31\u6709\u4e86\u7d22\u5f15\u7684\u6982\u5ff5\uff0c\u5927\u5bb6\u90fd\u77e5\u9053\u7d22\u5f15\u80fd\u591f\u52a0\u5feb\u6570\u636e\u7684\u67e5\u8be2\uff0c\u90a3\u5230\u5e95\u662f\u600e\u4e48\u4e2a\u56de\u4e8b\u5462\uff1f\u4e0b\u9762\u6211\u5c31\u6765\u770b\u770b\u3002 \u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784 \u00b6 \u5728 MySQL \u4e2d\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u548c\u521a\u521a\u63cf\u8ff0\u7684\u9875\u51e0\u4e4e\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff0c\u800c\u4e14\u5927\u5c0f\u4e5f\u662f 16K,\u3002 \u4f46\u662f\u5728\u7d22\u5f15\u9875\u4e2d\u8bb0\u5f55\u7684\u662f\u9875 (\u6570\u636e\u9875\uff0c\u7d22\u5f15\u9875) \u7684\u6700\u5c0f\u4e3b\u952e id \u548c\u9875\u53f7\uff0c\u4ee5\u53ca\u5728\u7d22\u5f15\u9875\u4e2d\u589e\u52a0\u4e86\u5c42\u7ea7\u7684\u4fe1\u606f\uff0c\u4ece 0 \u5f00\u59cb\u5f80\u4e0a\u7b97\uff0c\u6240\u4ee5\u9875\u4e0e\u9875\u4e4b\u95f4\u5c31\u6709\u4e86\u4e0a\u4e0b\u5c42\u7ea7\u7684\u6982\u5ff5\u3002 \u770b\u5230\u8fd9\u4e2a\u56fe\u4e4b\u540e\uff0c\u662f\u4e0d\u662f\u6709\u70b9\u4f3c\u66fe\u76f8\u4f3c\u7684\u611f\u89c9\uff0c\u662f\u4e0d\u662f\u50cf\u4e00\u68f5\u4e8c\u53c9\u6811\u554a\uff0c\u5bf9\uff0c\u6ca1\u9519\uff01\u5b83\u5c31\u662f\u4e00\u68f5\u6811\u3002 \u53ea\u4e0d\u8fc7\u6211\u4eec\u5728\u8fd9\u91cc\u53ea\u662f\u7b80\u5355\u753b\u4e86\u4e09\u4e2a\u8282\u70b9\uff0c2 \u5c42\u7ed3\u6784\u7684\u800c\u5df2\uff0c\u5982\u679c\u6570\u636e\u591a\u4e86\uff0c\u53ef\u80fd\u5c31\u4f1a\u6269\u5c55\u5230 3 \u5c42\u7684\u6811\uff0c\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 B+ \u6811\uff0c\u6700\u4e0b\u9762\u90a3\u4e00\u5c42\u7684 page level =0, \u4e5f\u5c31\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u5176\u4f59\u90fd\u662f\u975e\u53f6\u5b50\u8282\u70b9\u3002 \u770b\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u662f\u5355\u62ff\u4e00\u4e2a\u8282\u70b9\u6765\u770b\uff0c\u9996\u5148\u5b83\u662f\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\uff08\u7d22\u5f15\u9875\uff09\uff0c\u5728\u5b83\u7684\u5185\u5bb9\u533a\u4e2d\u6709 id \u548c \u9875\u53f7\u5730\u5740\u4e24\u90e8\u5206\uff1a id \uff1a\u5bf9\u5e94\u9875\u4e2d\u8bb0\u5f55\u7684\u6700\u5c0f\u8bb0\u5f55 id \u503c\uff1b \u9875\u53f7\uff1a\u5730\u5740\u662f\u6307\u5411\u5bf9\u5e94\u9875\u7684\u6307\u9488\uff1b \u800c\u6570\u636e\u9875\u4e0e\u6b64\u51e0\u4e4e\u5927\u540c\u5c0f\u5f02\uff0c\u533a\u522b\u5728\u4e8e\u6570\u636e\u9875\u8bb0\u5f55\u7684\u662f\u771f\u5b9e\u7684\u884c\u6570\u636e\u800c\u4e0d\u662f\u9875\u5730\u5740\uff0c\u800c\u4e14 id \u7684\u4e5f\u662f\u987a\u5e8f\u7684\u3002 \u5355\u8868\u5efa\u8bae\u503c \u00b6 \u4e0b\u9762\u6211\u4eec\u5c31\u4ee5 3 \u5c42\uff0c2 \u5206\u53c9\uff08\u5b9e\u9645\u4e2d\u662f M \u5206\u53c9\uff09\u7684\u56fe\u4f8b\u6765\u8bf4\u660e\u4e00\u4e0b\u67e5\u627e\u4e00\u4e2a\u884c\u6570\u636e\u7684\u8fc7\u7a0b\u3002 \u6bd4\u5982\u8bf4\u6211\u4eec\u9700\u8981\u67e5\u627e\u4e00\u4e2a id=6 \u7684\u884c\u6570\u636e\uff1a \u56e0\u4e3a\u5728\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u5b58\u653e\u7684\u662f\u9875\u53f7\u548c\u8be5\u9875\u6700\u5c0f\u7684 id\uff0c\u6240\u4ee5\u6211\u4eec\u4ece\u9876\u5c42\u5f00\u59cb\u5bf9\u6bd4\uff0c\u9996\u5148\u770b\u9875\u53f7 10 \u4e2d\u7684\u76ee\u5f55\uff0c\u6709 [id=1, \u9875\u53f7 = 20],[id=5, \u9875\u53f7 = 30], \u8bf4\u660e\u5de6\u4fa7\u8282\u70b9\u6700\u5c0f id \u4e3a 1\uff0c\u53f3\u4fa7\u8282\u70b9\u6700\u5c0f id \u662f 5\u30026>5, \u90a3\u6309\u7167\u4e8c\u5206\u6cd5\u67e5\u627e\u7684\u89c4\u5219\uff0c\u80af\u5b9a\u5c31\u5f80\u53f3\u4fa7\u8282\u70b9\u7ee7\u7eed\u67e5\u627e\uff1b \u627e\u5230\u9875\u53f7 30 \u7684\u8282\u70b9\u540e\uff0c\u53d1\u73b0\u8fd9\u4e2a\u8282\u70b9\u8fd8\u6709\u5b50\u8282\u70b9\uff08\u975e\u53f6\u5b50\u8282\u70b9\uff09\uff0c\u90a3\u5c31\u7ee7\u7eed\u6bd4\u5bf9\uff0c\u540c\u7406\uff0c6>5 && 6<7, \u6240\u4ee5\u627e\u5230\u4e86\u9875\u53f7 60\uff1b \u627e\u5230\u9875\u53f7 60 \u4e4b\u540e\uff0c\u53d1\u73b0\u6b64\u8282\u70b9\u4e3a\u53f6\u5b50\u8282\u70b9\uff08\u6570\u636e\u8282\u70b9\uff09\uff0c\u4e8e\u662f\u5c06\u6b64\u9875\u6570\u636e\u52a0\u8f7d\u81f3\u5185\u5b58\u8fdb\u884c\u4e00\u4e00\u5bf9\u6bd4\uff0c\u7ed3\u679c\u627e\u5230\u4e86 id=6 \u7684\u6570\u636e\u884c\u3002 \u4ece\u4e0a\u8ff0\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\uff0c\u6211\u4eec\u4e3a\u4e86\u67e5\u627e id=6 \u7684\u6570\u636e\uff0c\u603b\u5171\u67e5\u8be2\u4e86\u4e09\u4e2a\u9875\uff0c\u5982\u679c\u4e09\u4e2a\u9875\u90fd\u5728\u78c1\u76d8\u4e2d\uff08\u672a\u63d0\u524d\u52a0\u8f7d\u81f3\u5185\u5b58\uff09\uff0c\u90a3\u4e48\u6700\u591a\u9700\u8981\u7ecf\u5386\u4e09\u6b21\u7684\u78c1\u76d8 IO\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56fe\u4e2d\u7684\u9875\u53f7\u53ea\u662f\u4e2a\u793a\u4f8b\uff0c\u5b9e\u9645\u60c5\u51b5\u4e0b\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u5728\u78c1\u76d8\u4e2d\u5b58\u50a8\u4e5f\u4e0d\u4e00\u5b9a\u662f\u987a\u5e8f\u7684\u3002 \u81f3\u6b64\uff0c\u6211\u4eec\u5927\u6982\u5df2\u7ecf\u4e86\u89e3\u4e86\u8868\u7684\u6570\u636e\u662f\u600e\u4e48\u4e2a\u7ed3\u6784\u4e86\uff0c\u4e5f\u5927\u6982\u77e5\u9053\u67e5\u8be2\u6570\u636e\u662f\u4e2a\u600e\u4e48\u7684\u8fc7\u7a0b\u4e86\uff0c\u8fd9\u6837\u6211\u4eec\u4e5f\u5c31\u80fd\u5927\u6982\u4f30\u7b97\u8fd9\u6837\u7684\u7ed3\u6784\u80fd\u5b58\u653e\u591a\u5c11\u6570\u636e\u4e86\u3002 \u4ece\u4e0a\u9762\u7684\u56fe\u89e3\u6211\u4eec\u77e5\u9053 B+ \u6570\u7684\u53f6\u5b50\u8282\u70b9\u624d\u662f\u5b58\u5728\u6570\u636e\u7684\uff0c\u800c\u975e\u53f6\u5b50\u8282\u70b9\u662f\u7528\u6765\u5b58\u653e\u7d22\u5f15\u6570\u636e\u7684\u3002 \u6240\u4ee5\uff0c\u540c\u6837\u4e00\u4e2a 16K \u7684\u9875\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u91cc\u7684\u6bcf\u6761\u6570\u636e\u90fd\u6307\u5411\u65b0\u7684\u9875\uff0c\u800c\u65b0\u7684\u9875\u6709\u4e24\u79cd\u53ef\u80fd \u5982\u679c\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u91cc\u9762\u5c31\u662f\u4e00\u884c\u884c\u7684\u6570\u636e \u5982\u679c\u662f\u975e\u53f6\u5b50\u8282\u70b9\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f1a\u7ee7\u7eed\u6307\u5411\u65b0\u7684\u9875 \u5047\u8bbe \u975e\u53f6\u5b50\u8282\u70b9\u5185\u6307\u5411\u5176\u4ed6\u9875\u7684\u6570\u91cf\u4e3a x \u53f6\u5b50\u8282\u70b9\u5185\u80fd\u5bb9\u7eb3\u7684\u6570\u636e\u884c\u6570\u4e3a y B+ \u6570\u7684\u5c42\u6570\u4e3a z \u5982\u4e0b\u56fe\u4e2d\u6240\u793a\uff0c Total =x^(z-1) *y \u4e5f\u5c31\u662f\u8bf4\u603b\u6570\u4f1a\u7b49\u4e8e x \u7684 z-1 \u6b21\u65b9 \u4e0e Y \u7684\u4e58\u79ef \u3002 X =\uff1f \u5728\u6587\u7ae0\u7684\u5f00\u5934\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u9875\u7684\u7ed3\u6784\uff0c\u7d22\u5f15\u4e5f\u4e5f\u4e0d\u4f8b\u5916\uff0c\u90fd\u4f1a\u6709 File Header (38 byte)\u3001Page Header (56 Byte)\u3001Infimum + Supermum\uff0826 byte\uff09\u3001File Trailer\uff088byte\uff09, \u518d\u52a0\u4e0a\u9875\u76ee\u5f55\uff0c\u5927\u6982 1k \u5de6\u53f3\u3002 \u6211\u4eec\u5c31\u5f53\u505a\u5b83\u5c31\u662f 1K, \u90a3\u6574\u4e2a\u9875\u7684\u5927\u5c0f\u662f 16K, \u5269\u4e0b 15k \u7528\u4e8e\u5b58\u6570\u636e\uff0c\u5728\u7d22\u5f15\u9875\u4e2d\u4e3b\u8981\u8bb0\u5f55\u7684\u662f\u4e3b\u952e\u4e0e\u9875\u53f7\uff0c\u4e3b\u952e\u6211\u4eec\u5047\u8bbe\u662f Bigint (8 byte), \u800c\u9875\u53f7\u4e5f\u662f\u56fa\u5b9a\u7684\uff084Byte\uff09, \u90a3\u4e48\u7d22\u5f15\u9875\u4e2d\u7684\u4e00\u6761\u6570\u636e\u4e5f\u5c31\u662f 12byte\u3002 \u6240\u4ee5 x=15*1024/12\u22481280 \u884c\u3002 Y=\uff1f \u53f6\u5b50\u8282\u70b9\u548c\u975e\u53f6\u5b50\u8282\u70b9\u7684\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u540c\u7406\uff0c\u80fd\u653e\u6570\u636e\u7684\u7a7a\u95f4\u4e5f\u662f 15k\u3002 \u4f46\u662f\u53f6\u5b50\u8282\u70b9\u4e2d\u5b58\u653e\u7684\u662f\u771f\u6b63\u7684\u884c\u6570\u636e\uff0c\u8fd9\u4e2a\u5f71\u54cd\u7684\u56e0\u7d20\u5c31\u4f1a\u591a\u5f88\u591a\uff0c\u6bd4\u5982\uff0c\u5b57\u6bb5\u7684\u7c7b\u578b\uff0c\u5b57\u6bb5\u7684\u6570\u91cf\u3002\u6bcf\u884c\u6570\u636e\u5360\u7528\u7a7a\u95f4\u8d8a\u5927\uff0c\u9875\u4e2d\u6240\u653e\u7684\u884c\u6570\u91cf\u5c31\u4f1a\u8d8a\u5c11\u3002 \u8fd9\u8fb9\u6211\u4eec\u6682\u65f6\u6309\u4e00\u6761\u884c\u6570\u636e 1k \u6765\u7b97\uff0c\u90a3\u4e00\u9875\u5c31\u80fd\u5b58\u4e0b 15 \u6761\uff0cY = 15*1024/1000 \u224815\u3002 \u7b97\u5230\u8fd9\u8fb9\u4e86\uff0c\u662f\u4e0d\u662f\u5fc3\u91cc\u5df2\u7ecf\u6709\u8c31\u4e86\u554a\u3002 \u6839\u636e\u4e0a\u8ff0\u7684\u516c\u5f0f\uff0cTotal =x^(z-1) *y\uff0c\u5df2\u77e5 x=1280\uff0cy=15\uff1a \u5047\u8bbe B+ \u6811\u662f\u4e24\u5c42\uff0c\u90a3\u5c31\u662f z = 2\uff0c Total = \uff081280 ^1 \uff09*15 = 19200 \u5047\u8bbe B+ \u6811\u662f\u4e09\u5c42\uff0c\u90a3\u5c31\u662f z = 3\uff0c Total = \uff081280 ^2\uff09 *15 = 24576000 \uff08\u7ea6 2.45kw\uff09 \u54ce\u5440\uff0c\u5988\u5440\uff01\u8fd9\u4e0d\u662f\u6b63\u597d\u5c31\u662f\u6587\u7ae0\u5f00\u5934\u8bf4\u7684\u6700\u5927\u884c\u6570\u5efa\u8bae\u503c 2000W \u561b\uff01\u5bf9\u7684\uff0c\u4e00\u822c B+ \u6570\u7684\u5c42\u7ea7\u6700\u591a\u4e5f\u5c31\u662f 3 \u5c42\u3002 \u4f60\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u662f 4 \u5c42\uff0c\u9664\u4e86\u67e5\u8be2\u7684\u65f6\u5019\u78c1\u76d8 IO \u6b21\u6570\u4f1a\u589e\u52a0\uff0c\u800c\u4e14\u8fd9\u4e2a Total \u503c\u4f1a\u662f\u591a\u5c11\uff0c\u5927\u6982\u5e94\u8be5\u662f 3 \u767e\u591a\u4ebf\u5427\uff0c\u4e5f\u4e0d\u592a\u5408\u7406\uff0c\u6240\u4ee5\uff0c3 \u5c42\u5e94\u8be5\u662f\u6bd4\u8f83\u5408\u7406\u7684\u4e00\u4e2a\u503c\u3002 \u5230\u8fd9\u91cc\u96be\u9053\u5c31\u5b8c\u4e86\uff1f \u4e0d\u3002 \u6211\u4eec\u521a\u521a\u5728\u8bf4 Y \u7684\u503c\u65f6\u5019\u5047\u8bbe\u7684\u662f 1K \uff0c\u90a3\u6bd4\u5982\u6211\u5b9e\u9645\u5f53\u884c\u7684\u6570\u636e\u5360\u7528\u7a7a\u95f4\u4e0d\u662f 1K , \u800c\u662f 5K, \u90a3\u4e48\u5355\u4e2a\u6570\u636e\u9875\u6700\u591a\u53ea\u80fd\u653e\u4e0b 3 \u6761\u6570\u636e\u3002 \u540c\u6837\uff0c\u8fd8\u662f\u6309\u7167 z = 3 \u7684\u503c\u6765\u8ba1\u7b97\uff0c\u90a3 Total = \uff081280 ^2\uff09 *3 = 4915200 \uff08\u8fd1 500w\uff09 \u6240\u4ee5\uff0c\u5728\u4fdd\u6301\u76f8\u540c\u7684\u5c42\u7ea7\uff08\u76f8\u4f3c\u67e5\u8be2\u6027\u80fd\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u884c\u6570\u636e\u5927\u5c0f\u4e0d\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u5b9e\u8fd9\u4e2a\u6700\u5927\u5efa\u8bae\u503c\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u800c\u4e14\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u7684\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u56e0\u7d20\uff0c\u6bd4\u5982\uff0c\u6570\u636e\u5e93\u7248\u672c\uff0c\u670d\u52a1\u5668\u914d\u7f6e\uff0csql \u7684\u7f16\u5199\u7b49\u7b49\u3002 MySQL \u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u4f1a\u5c06\u8868\u7684\u7d22\u5f15\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5728 InnoDB buffer size \u8db3\u591f\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u80fd\u5b8c\u6210\u5168\u52a0\u8f7d\u8fdb\u5185\u5b58\uff0c\u67e5\u8be2\u4e0d\u4f1a\u6709\u95ee\u9898\u3002 \u4f46\u662f\uff0c\u5f53\u5355\u8868\u6570\u636e\u5e93\u5230\u8fbe\u67d0\u4e2a\u91cf\u7ea7\u7684\u4e0a\u9650\u65f6\uff0c\u5bfc\u81f4\u5185\u5b58\u65e0\u6cd5\u5b58\u50a8\u5176\u7d22\u5f15\uff0c\u4f7f\u5f97\u4e4b\u540e\u7684 SQL \u67e5\u8be2\u4f1a\u4ea7\u751f\u78c1\u76d8 IO\uff0c\u4ece\u800c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff0c\u6240\u4ee5\u589e\u52a0\u786c\u4ef6\u914d\u7f6e\uff08\u6bd4\u5982\u628a\u5185\u5b58\u5f53\u78c1\u76d8\u4f7f\uff09\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u7acb\u7aff\u89c1\u5f71\u7684\u6027\u80fd\u63d0\u5347\u54c8\u3002 \u603b\u7ed3 \u00b6 MySQL \u7684\u8868\u6570\u636e\u662f\u4ee5\u9875\u7684\u5f62\u5f0f\u5b58\u653e\u7684\uff0c\u9875\u5728\u78c1\u76d8\u4e2d\u4e0d\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\u3002 \u9875\u7684\u7a7a\u95f4\u662f 16K, \u5e76\u4e0d\u662f\u6240\u6709\u7684\u7a7a\u95f4\u90fd\u662f\u7528\u6765\u5b58\u653e\u6570\u636e\u7684\uff0c\u4f1a\u6709\u4e00\u4e9b\u56fa\u5b9a\u7684\u4fe1\u606f\uff0c\u5982\uff0c\u9875\u5934\uff0c\u9875\u5c3e\uff0c\u9875\u7801\uff0c\u6821\u9a8c\u7801\u7b49\u7b49\u3002 \u5728 B+ \u6811\u4e2d\uff0c\u53f6\u5b50\u8282\u70b9\u548c\u975e\u53f6\u5b50\u8282\u70b9\u7684\u6570\u636e\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u5728\u4e8e\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u7684\u884c\u6570\u636e\uff0c\u800c\u975e\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u548c\u9875\u53f7\u3002 \u7d22\u5f15\u7ed3\u6784\u4e0d\u4f1a\u5f71\u54cd\u5355\u8868\u6700\u5927\u884c\u6570\uff0c2000W \u4e5f\u53ea\u662f\u63a8\u8350\u503c\uff0c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u503c\u53ef\u80fd\u4f1a\u5bfc\u81f4 B + \u6811\u5c42\u7ea7\u66f4\u9ad8\uff0c\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f"},{"location":"mysql/index/2000w/#mysql-2000w","text":"\u4f5c\u4e3a\u5728\u540e\u7aef\u5708\u5f00\u8f66\u7684\u591a\u5e74\u8001\u53f8\u673a\uff0c\u662f\u4e0d\u662f\u7ecf\u5e38\u542c\u5230\u8fc7\uff1a \u201cMySQL \u5355\u8868\u6700\u597d\u4e0d\u8981\u8d85\u8fc7 2000W\u201d \u201c\u5355\u8868\u8d85\u8fc7 2000W \u5c31\u8981\u8003\u8651\u6570\u636e\u8fc1\u79fb\u4e86\u201d \u201c\u4f60\u8fd9\u4e2a\u8868\u6570\u636e\u90fd\u9a6c\u4e0a\u8981\u5230 2000W \u4e86\uff0c\u96be\u602a\u67e5\u8be2\u901f\u5ea6\u6162\u201d \u8fd9\u4e9b\u540d\u8a00\u6c11\u8bed\u5c31\u548c \u201c\u7fa4\u91cc\u53ea\u8ba8\u8bba\u6280\u672f\uff0c\u4e0d\u5f00\u8f66\uff0c\u5f00\u8f66\u901f\u5ea6\u4e0d\u8981\u8d85\u8fc7 120 \u7801\uff0c\u5426\u5219\u81ea\u52a8\u8e22\u7fa4\u201d\uff0c\u53ea\u542c\u8fc7\uff0c\u6ca1\u8bd5\u8fc7\uff0c\u54c8\u54c8\u3002 \u4e0b\u9762\u6211\u4eec\u5c31\u628a\u8f66\u901f\u8e29\u5230\u5e95\uff0c\u5e72\u5230 180 \u7801\u8bd5\u8bd5\u2026\u2026. \u539f\u6587\u94fe\u63a5\uff1ahttps://my.oschina.net/u/4090830/blog/5559454","title":"MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f"},{"location":"mysql/index/2000w/#_1","text":"\u5b9e\u9a8c\u4e00\u628a\u770b\u770b\u2026 \u5efa\u4e00\u5f20\u8868 CREATE TABLE person ( id int NOT NULL AUTO_INCREMENT PRIMARY KEY comment '\u4e3b\u952e' , person_id tinyint not null comment '\u7528\u6237id' , person_name VARCHAR ( 200 ) comment '\u7528\u6237\u540d\u79f0' , gmt_create datetime comment '\u521b\u5efa\u65f6\u95f4' , gmt_modified datetime comment '\u4fee\u6539\u65f6\u95f4' ) comment '\u4eba\u5458\u4fe1\u606f\u8868' ; \u63d2\u5165\u4e00\u6761\u6570\u636e insert into person values ( 1 , 1 , 'user_1' , NOW (), now ()); \u5229\u7528 MySQL \u4f2a\u5217 rownum \u8bbe\u7f6e\u4f2a\u5217\u8d77\u59cb\u70b9\u4e3a 1 select ( @ i : =@ i + 1 ) as rownum , person_name from person , ( select @ i : = 100 ) as init ; set @ i = 1 ; \u8fd0\u884c\u4e0b\u9762\u7684 sql\uff0c\u8fde\u7eed\u6267\u884c 20 \u6b21\uff0c\u5c31\u662f 2 \u7684 20 \u6b21\u65b9\u7ea6\u7b49\u4e8e 100w \u7684\u6570\u636e\uff1b\u6267\u884c 23 \u6b21\u5c31\u662f 2 \u7684 23 \u6b21\u65b9\u7ea6\u7b49\u4e8e 800w , \u5982\u6b64\u4e0b\u53bb\u5373\u53ef\u5b9e\u73b0\u5343\u4e07\u6d4b\u8bd5\u6570\u636e\u7684\u63d2\u5165\u3002 \u5982\u679c\u4e0d\u60f3\u7ffb\u500d\u7ffb\u500d\u7684\u589e\u52a0\u6570\u636e\uff0c\u800c\u662f\u60f3\u5c11\u91cf\uff0c\u5c11\u91cf\u7684\u589e\u52a0\uff0c\u6709\u4e2a\u6280\u5de7\uff0c\u5c31\u662f\u5728 SQL \u7684\u540e\u9762\u589e\u52a0 where \u6761\u4ef6\uff0c\u5982 id > \u67d0\u4e00\u4e2a\u503c\u53bb\u63a7\u5236\u589e\u52a0\u7684\u6570\u636e\u91cf\u5373\u53ef\u3002 insert into person ( id , person_id , person_name , gmt_create , gmt_modified ) select @ i : =@ i + 1 , left ( rand () * 10 , 10 ) as person_id , concat ( 'user_' , @ i % 2048 ), date_add ( gmt_create , interval + @ i * cast ( rand () * 100 as signed ) SECOND ), date_add ( date_add ( gmt_modified , interval +@ i * cast ( rand () * 100 as signed ) SECOND ), interval + cast ( rand () * 1000000 as signed ) SECOND ) from person ; \u6b64\u5904\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e5f\u8bb8\u4f60\u5728\u6267\u884c\u5230\u8fd1 800w \u6216\u8005 1000w \u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u62a5\u9519\uff1aThe total number of locks exceeds the lock table size\u3002 \u8fd9\u662f\u7531\u4e8e\u4f60\u7684\u4e34\u65f6\u8868\u5185\u5b58\u8bbe\u7f6e\u7684\u4e0d\u591f\u5927\uff0c\u53ea\u9700\u8981\u6269\u5927\u4e00\u4e0b\u8bbe\u7f6e\u53c2\u6570\u5373\u53ef\u3002 SET GLOBAL tmp_table_size = 512 * 1024 * 1024 ; \uff08 512 M \uff09 SET global innodb_buffer_pool_size = 1 * 1024 * 1024 * 1024 ( 1 G ); \u5148\u6765\u770b\u4e00\u7ec4\u6d4b\u8bd5\u6570\u636e\uff0c\u8fd9\u7ec4\u6570\u636e\u662f\u5728 MySQL 8.0 \u7684\u7248\u672c\uff0c\u5e76\u4e14\u662f\u5728\u6211\u672c\u673a\u4e0a\uff0c\u7531\u4e8e\u672c\u673a\u8fd8\u8dd1\u7740 idea , \u6d4f\u89c8\u5668\u7b49\u5404\u79cd\u5de5\u5177\uff0c\u6240\u4ee5\u5e76\u4e0d\u662f\u673a\u5668\u914d\u7f6e\u5c31\u662f\u7528\u4e8e\u6570\u636e\u5e93\u914d\u7f6e\uff0c\u6240\u4ee5\u6d4b\u8bd5\u6570\u636e\u53ea\u9650\u4e8e\u53c2\u8003\u3002 \u770b\u5230\u8fd9\u7ec4\u6570\u636e\u4f3c\u4e4e\u597d\u50cf\u771f\u7684\u548c\u6807\u9898\u5bf9\u5e94\uff0c\u5f53\u6570\u636e\u8fbe\u5230 2000W \u4ee5\u540e\uff0c\u67e5\u8be2\u65f6\u957f\u6025\u5267\u4e0a\u5347\uff0c\u96be\u9053\u8fd9\u5c31\u662f\u94c1\u5f8b\u5417\uff1f \u90a3\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u770b\u8fd9\u4e2a\u5efa\u8bae\u503c 2000W \u662f\u600e\u4e48\u6765\u7684\uff1f","title":"\u5b9e\u9a8c"},{"location":"mysql/index/2000w/#_2","text":"\u9996\u5148\u6211\u4eec\u5148\u60f3\u60f3\u6570\u636e\u5e93\u5355\u8868\u884c\u6570\u6700\u5927\u591a\u5927\uff1f CREATE TABLE person ( id int ( 10 ) NOT NULL AUTO_INCREMENT PRIMARY KEY comment '\u4e3b\u952e' , person_id tinyint not null comment '\u7528\u6237id' , person_name VARCHAR ( 200 ) comment '\u7528\u6237\u540d\u79f0' , gmt_create datetime comment '\u521b\u5efa\u65f6\u95f4' , gmt_modified datetime comment '\u4fee\u6539\u65f6\u95f4' ) comment '\u4eba\u5458\u4fe1\u606f\u8868' ; \u770b\u770b\u4e0a\u9762\u7684\u5efa\u8868 sql\u3002id \u662f\u4e3b\u952e\uff0c\u672c\u8eab\u5c31\u662f\u552f\u4e00\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e3b\u952e\u7684\u5927\u5c0f\u53ef\u4ee5\u9650\u5236\u8868\u7684\u4e0a\u9650\uff1a \u5982\u679c\u4e3b\u952e\u58f0\u660e int \u7c7b\u578b\uff0c\u4e5f\u5c31\u662f 32 \u4f4d\uff0c\u90a3\u4e48\u652f\u6301 2^32-1 ~~21 \u4ebf\uff1b \u5982\u679c\u4e3b\u952e\u58f0\u660e bigint \u7c7b\u578b\uff0c\u90a3\u5c31\u662f 2^62-1 \uff0836893488147419103232\uff09\uff0c\u96be\u4ee5\u60f3\u8c61\u8fd9\u4e2a\u7684\u591a\u5927\u4e86\uff0c\u4e00\u822c\u8fd8\u6ca1\u6709\u5230\u8fd9\u4e2a\u9650\u5236\u4e4b\u524d\uff0c\u53ef\u80fd\u6570\u636e\u5e93\u5df2\u7ecf\u7206\u6ee1\u4e86\uff01\uff01 \u6709\u4eba\u7edf\u8ba1\u8fc7\uff0c\u5982\u679c\u5efa\u8868\u7684\u65f6\u5019\uff0c\u81ea\u589e\u5b57\u6bb5\u9009\u62e9\u65e0\u7b26\u53f7\u7684 bigint , \u90a3\u4e48\u81ea\u589e\u957f\u6700\u5927\u503c\u662f 18446744073709551615\uff0c\u6309\u7167\u4e00\u79d2\u65b0\u589e\u4e00\u6761\u8bb0\u5f55\u7684\u901f\u5ea6\uff0c\u5927\u7ea6\u4ec0\u4e48\u65f6\u5019\u80fd\u7528\u5b8c\uff1f","title":"\u5355\u8868\u6570\u91cf\u9650\u5236"},{"location":"mysql/index/2000w/#_3","text":"\u4e0b\u9762\u6211\u4eec\u518d\u6765\u770b\u770b\u7d22\u5f15\u7684\u7ed3\u6784\uff0c\u6211\u4eec\u4e0b\u9762\u8bb2\u5185\u5bb9\u90fd\u662f\u57fa\u4e8e Innodb \u5f15\u64ce\u7684\uff0c\u5927\u5bb6\u90fd\u77e5\u9053 Innodb \u7684\u7d22\u5f15\u5185\u90e8\u7528\u7684\u662f B+ \u6811\u3002 \u8fd9\u5f20\u8868\u6570\u636e\uff0c\u5728\u786c\u76d8\u4e0a\u5b58\u50a8\u4e5f\u662f\u7c7b\u4f3c\u5982\u6b64\u7684\uff0c\u5b83\u5b9e\u9645\u662f\u653e\u5728\u4e00\u4e2a\u53eb person.ibd \uff08innodb data\uff09\u7684\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53eb\u505a\u8868\u7a7a\u95f4\uff1b\u867d\u7136\u6570\u636e\u8868\u4e2d\uff0c\u4ed6\u4eec\u770b\u8d77\u6765\u662f\u4e00\u6761\u8fde\u7740\u4e00\u6761\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5728\u6587\u4ef6\u4e2d\u5b83\u88ab\u5206\u6210\u5f88\u591a\u5c0f\u4efd\u7684\u6570\u636e\u9875\uff0c\u800c\u4e14\u6bcf\u4e00\u4efd\u90fd\u662f 16K\u3002 \u5927\u6982\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\uff0c\u5f53\u7136\u8fd9\u53ea\u662f\u6211\u4eec\u62bd\u8c61\u51fa\u6765\u7684\uff0c\u5728\u8868\u7a7a\u95f4\u4e2d\u8fd8\u6709\u6bb5\u3001\u533a\u3001\u7ec4\u7b49\u5f88\u591a\u6982\u5ff5\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u8df3\u51fa\u6765\u770b\u3002","title":"\u8868\u7a7a\u95f4"},{"location":"mysql/index/2000w/#_4","text":"\u5b9e\u9645\u9875\u7684\u5185\u90e8\u7ed3\u6784\u50cf\u662f\u4e0b\u9762\u8fd9\u6837\u7684\uff1a \u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u4e00\u4e2a InnoDB \u6570\u636e\u9875\u7684\u5b58\u50a8\u7a7a\u95f4\u5927\u81f4\u88ab\u5212\u5206\u6210\u4e86 7 \u4e2a\u90e8\u5206\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u786e\u5b9a\u7684\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u4e0d\u786e\u5b9a\u7684\u3002 \u5728\u9875\u7684 7 \u4e2a\u7ec4\u6210\u90e8\u5206\u4e2d\uff0c\u6211\u4eec\u81ea\u5df1\u5b58\u50a8\u7684\u8bb0\u5f55\u4f1a\u6309\u7167\u6211\u4eec\u6307\u5b9a\u7684\u884c\u683c\u5f0f\u5b58\u50a8\u5230 User Records \u90e8\u5206\u3002 \u4f46\u662f\u5728\u4e00\u5f00\u59cb\u751f\u6210\u9875\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u5e76\u6ca1\u6709 User Records \u8fd9\u4e2a\u90e8\u5206\uff0c\u6bcf\u5f53\u6211\u4eec\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u90fd\u4f1a\u4ece Free Space \u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u5c1a\u672a\u4f7f\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u4e2d\u7533\u8bf7\u4e00\u4e2a\u8bb0\u5f55\u5927\u5c0f\u7684\u7a7a\u95f4\u5212\u5206\u5230 User Records \u90e8\u5206\u3002 \u5f53 Free Space \u90e8\u5206\u7684\u7a7a\u95f4\u5168\u90e8\u88ab User Records \u90e8\u5206\u66ff\u4ee3\u6389\u4e4b\u540e\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u8fd9\u4e2a\u9875\u4f7f\u7528\u5b8c\u4e86\uff0c\u5982\u679c\u8fd8\u6709\u65b0\u7684\u8bb0\u5f55\u63d2\u5165\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u53bb\u7533\u8bf7\u65b0\u7684\u9875\u4e86\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u7684\u56fe\u793a\u5982\u4e0b\uff1a \u521a\u521a\u4e0a\u9762\u8bf4\u5230\u4e86\u6570\u636e\u7684\u65b0\u589e\u7684\u8fc7\u7a0b\u3002 \u90a3\u4e0b\u9762\u5c31\u6765\u8bf4\u8bf4\uff0c\u6570\u636e\u7684\u67e5\u627e\u8fc7\u7a0b\uff0c\u5047\u5982\u6211\u4eec\u9700\u8981\u67e5\u627e\u4e00\u6761\u8bb0\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8868\u7a7a\u95f4\u4e2d\u7684\u6bcf\u4e00\u9875\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u5bf9\u8bb0\u5f55\u6328\u4e2a\u5224\u65ad\u662f\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002 \u5728\u6570\u636e\u91cf\u5c0f\u7684\u65f6\u5019\uff0c\u6ca1\u5565\u95ee\u9898\uff0c\u5185\u5b58\u4e5f\u53ef\u4ee5\u6491\u3002\u4f46\u662f\u73b0\u5b9e\u5c31\u662f\u8fd9\u4e48\u6b8b\u9177\uff0c\u4e0d\u4f1a\u7ed9\u4f60\u8fd9\u4e2a\u5c40\u9762\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u95ee\u9898\uff0cMySQL \u4e2d\u5c31\u6709\u4e86\u7d22\u5f15\u7684\u6982\u5ff5\uff0c\u5927\u5bb6\u90fd\u77e5\u9053\u7d22\u5f15\u80fd\u591f\u52a0\u5feb\u6570\u636e\u7684\u67e5\u8be2\uff0c\u90a3\u5230\u5e95\u662f\u600e\u4e48\u4e2a\u56de\u4e8b\u5462\uff1f\u4e0b\u9762\u6211\u5c31\u6765\u770b\u770b\u3002","title":"\u9875\u7684\u6570\u636e\u7ed3\u6784"},{"location":"mysql/index/2000w/#_5","text":"\u5728 MySQL \u4e2d\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u548c\u521a\u521a\u63cf\u8ff0\u7684\u9875\u51e0\u4e4e\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff0c\u800c\u4e14\u5927\u5c0f\u4e5f\u662f 16K,\u3002 \u4f46\u662f\u5728\u7d22\u5f15\u9875\u4e2d\u8bb0\u5f55\u7684\u662f\u9875 (\u6570\u636e\u9875\uff0c\u7d22\u5f15\u9875) \u7684\u6700\u5c0f\u4e3b\u952e id \u548c\u9875\u53f7\uff0c\u4ee5\u53ca\u5728\u7d22\u5f15\u9875\u4e2d\u589e\u52a0\u4e86\u5c42\u7ea7\u7684\u4fe1\u606f\uff0c\u4ece 0 \u5f00\u59cb\u5f80\u4e0a\u7b97\uff0c\u6240\u4ee5\u9875\u4e0e\u9875\u4e4b\u95f4\u5c31\u6709\u4e86\u4e0a\u4e0b\u5c42\u7ea7\u7684\u6982\u5ff5\u3002 \u770b\u5230\u8fd9\u4e2a\u56fe\u4e4b\u540e\uff0c\u662f\u4e0d\u662f\u6709\u70b9\u4f3c\u66fe\u76f8\u4f3c\u7684\u611f\u89c9\uff0c\u662f\u4e0d\u662f\u50cf\u4e00\u68f5\u4e8c\u53c9\u6811\u554a\uff0c\u5bf9\uff0c\u6ca1\u9519\uff01\u5b83\u5c31\u662f\u4e00\u68f5\u6811\u3002 \u53ea\u4e0d\u8fc7\u6211\u4eec\u5728\u8fd9\u91cc\u53ea\u662f\u7b80\u5355\u753b\u4e86\u4e09\u4e2a\u8282\u70b9\uff0c2 \u5c42\u7ed3\u6784\u7684\u800c\u5df2\uff0c\u5982\u679c\u6570\u636e\u591a\u4e86\uff0c\u53ef\u80fd\u5c31\u4f1a\u6269\u5c55\u5230 3 \u5c42\u7684\u6811\uff0c\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 B+ \u6811\uff0c\u6700\u4e0b\u9762\u90a3\u4e00\u5c42\u7684 page level =0, \u4e5f\u5c31\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u5176\u4f59\u90fd\u662f\u975e\u53f6\u5b50\u8282\u70b9\u3002 \u770b\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u662f\u5355\u62ff\u4e00\u4e2a\u8282\u70b9\u6765\u770b\uff0c\u9996\u5148\u5b83\u662f\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\uff08\u7d22\u5f15\u9875\uff09\uff0c\u5728\u5b83\u7684\u5185\u5bb9\u533a\u4e2d\u6709 id \u548c \u9875\u53f7\u5730\u5740\u4e24\u90e8\u5206\uff1a id \uff1a\u5bf9\u5e94\u9875\u4e2d\u8bb0\u5f55\u7684\u6700\u5c0f\u8bb0\u5f55 id \u503c\uff1b \u9875\u53f7\uff1a\u5730\u5740\u662f\u6307\u5411\u5bf9\u5e94\u9875\u7684\u6307\u9488\uff1b \u800c\u6570\u636e\u9875\u4e0e\u6b64\u51e0\u4e4e\u5927\u540c\u5c0f\u5f02\uff0c\u533a\u522b\u5728\u4e8e\u6570\u636e\u9875\u8bb0\u5f55\u7684\u662f\u771f\u5b9e\u7684\u884c\u6570\u636e\u800c\u4e0d\u662f\u9875\u5730\u5740\uff0c\u800c\u4e14 id \u7684\u4e5f\u662f\u987a\u5e8f\u7684\u3002","title":"\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784"},{"location":"mysql/index/2000w/#_6","text":"\u4e0b\u9762\u6211\u4eec\u5c31\u4ee5 3 \u5c42\uff0c2 \u5206\u53c9\uff08\u5b9e\u9645\u4e2d\u662f M \u5206\u53c9\uff09\u7684\u56fe\u4f8b\u6765\u8bf4\u660e\u4e00\u4e0b\u67e5\u627e\u4e00\u4e2a\u884c\u6570\u636e\u7684\u8fc7\u7a0b\u3002 \u6bd4\u5982\u8bf4\u6211\u4eec\u9700\u8981\u67e5\u627e\u4e00\u4e2a id=6 \u7684\u884c\u6570\u636e\uff1a \u56e0\u4e3a\u5728\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u5b58\u653e\u7684\u662f\u9875\u53f7\u548c\u8be5\u9875\u6700\u5c0f\u7684 id\uff0c\u6240\u4ee5\u6211\u4eec\u4ece\u9876\u5c42\u5f00\u59cb\u5bf9\u6bd4\uff0c\u9996\u5148\u770b\u9875\u53f7 10 \u4e2d\u7684\u76ee\u5f55\uff0c\u6709 [id=1, \u9875\u53f7 = 20],[id=5, \u9875\u53f7 = 30], \u8bf4\u660e\u5de6\u4fa7\u8282\u70b9\u6700\u5c0f id \u4e3a 1\uff0c\u53f3\u4fa7\u8282\u70b9\u6700\u5c0f id \u662f 5\u30026>5, \u90a3\u6309\u7167\u4e8c\u5206\u6cd5\u67e5\u627e\u7684\u89c4\u5219\uff0c\u80af\u5b9a\u5c31\u5f80\u53f3\u4fa7\u8282\u70b9\u7ee7\u7eed\u67e5\u627e\uff1b \u627e\u5230\u9875\u53f7 30 \u7684\u8282\u70b9\u540e\uff0c\u53d1\u73b0\u8fd9\u4e2a\u8282\u70b9\u8fd8\u6709\u5b50\u8282\u70b9\uff08\u975e\u53f6\u5b50\u8282\u70b9\uff09\uff0c\u90a3\u5c31\u7ee7\u7eed\u6bd4\u5bf9\uff0c\u540c\u7406\uff0c6>5 && 6<7, \u6240\u4ee5\u627e\u5230\u4e86\u9875\u53f7 60\uff1b \u627e\u5230\u9875\u53f7 60 \u4e4b\u540e\uff0c\u53d1\u73b0\u6b64\u8282\u70b9\u4e3a\u53f6\u5b50\u8282\u70b9\uff08\u6570\u636e\u8282\u70b9\uff09\uff0c\u4e8e\u662f\u5c06\u6b64\u9875\u6570\u636e\u52a0\u8f7d\u81f3\u5185\u5b58\u8fdb\u884c\u4e00\u4e00\u5bf9\u6bd4\uff0c\u7ed3\u679c\u627e\u5230\u4e86 id=6 \u7684\u6570\u636e\u884c\u3002 \u4ece\u4e0a\u8ff0\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\uff0c\u6211\u4eec\u4e3a\u4e86\u67e5\u627e id=6 \u7684\u6570\u636e\uff0c\u603b\u5171\u67e5\u8be2\u4e86\u4e09\u4e2a\u9875\uff0c\u5982\u679c\u4e09\u4e2a\u9875\u90fd\u5728\u78c1\u76d8\u4e2d\uff08\u672a\u63d0\u524d\u52a0\u8f7d\u81f3\u5185\u5b58\uff09\uff0c\u90a3\u4e48\u6700\u591a\u9700\u8981\u7ecf\u5386\u4e09\u6b21\u7684\u78c1\u76d8 IO\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56fe\u4e2d\u7684\u9875\u53f7\u53ea\u662f\u4e2a\u793a\u4f8b\uff0c\u5b9e\u9645\u60c5\u51b5\u4e0b\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u5728\u78c1\u76d8\u4e2d\u5b58\u50a8\u4e5f\u4e0d\u4e00\u5b9a\u662f\u987a\u5e8f\u7684\u3002 \u81f3\u6b64\uff0c\u6211\u4eec\u5927\u6982\u5df2\u7ecf\u4e86\u89e3\u4e86\u8868\u7684\u6570\u636e\u662f\u600e\u4e48\u4e2a\u7ed3\u6784\u4e86\uff0c\u4e5f\u5927\u6982\u77e5\u9053\u67e5\u8be2\u6570\u636e\u662f\u4e2a\u600e\u4e48\u7684\u8fc7\u7a0b\u4e86\uff0c\u8fd9\u6837\u6211\u4eec\u4e5f\u5c31\u80fd\u5927\u6982\u4f30\u7b97\u8fd9\u6837\u7684\u7ed3\u6784\u80fd\u5b58\u653e\u591a\u5c11\u6570\u636e\u4e86\u3002 \u4ece\u4e0a\u9762\u7684\u56fe\u89e3\u6211\u4eec\u77e5\u9053 B+ \u6570\u7684\u53f6\u5b50\u8282\u70b9\u624d\u662f\u5b58\u5728\u6570\u636e\u7684\uff0c\u800c\u975e\u53f6\u5b50\u8282\u70b9\u662f\u7528\u6765\u5b58\u653e\u7d22\u5f15\u6570\u636e\u7684\u3002 \u6240\u4ee5\uff0c\u540c\u6837\u4e00\u4e2a 16K \u7684\u9875\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u91cc\u7684\u6bcf\u6761\u6570\u636e\u90fd\u6307\u5411\u65b0\u7684\u9875\uff0c\u800c\u65b0\u7684\u9875\u6709\u4e24\u79cd\u53ef\u80fd \u5982\u679c\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u91cc\u9762\u5c31\u662f\u4e00\u884c\u884c\u7684\u6570\u636e \u5982\u679c\u662f\u975e\u53f6\u5b50\u8282\u70b9\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f1a\u7ee7\u7eed\u6307\u5411\u65b0\u7684\u9875 \u5047\u8bbe \u975e\u53f6\u5b50\u8282\u70b9\u5185\u6307\u5411\u5176\u4ed6\u9875\u7684\u6570\u91cf\u4e3a x \u53f6\u5b50\u8282\u70b9\u5185\u80fd\u5bb9\u7eb3\u7684\u6570\u636e\u884c\u6570\u4e3a y B+ \u6570\u7684\u5c42\u6570\u4e3a z \u5982\u4e0b\u56fe\u4e2d\u6240\u793a\uff0c Total =x^(z-1) *y \u4e5f\u5c31\u662f\u8bf4\u603b\u6570\u4f1a\u7b49\u4e8e x \u7684 z-1 \u6b21\u65b9 \u4e0e Y \u7684\u4e58\u79ef \u3002 X =\uff1f \u5728\u6587\u7ae0\u7684\u5f00\u5934\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u9875\u7684\u7ed3\u6784\uff0c\u7d22\u5f15\u4e5f\u4e5f\u4e0d\u4f8b\u5916\uff0c\u90fd\u4f1a\u6709 File Header (38 byte)\u3001Page Header (56 Byte)\u3001Infimum + Supermum\uff0826 byte\uff09\u3001File Trailer\uff088byte\uff09, \u518d\u52a0\u4e0a\u9875\u76ee\u5f55\uff0c\u5927\u6982 1k \u5de6\u53f3\u3002 \u6211\u4eec\u5c31\u5f53\u505a\u5b83\u5c31\u662f 1K, \u90a3\u6574\u4e2a\u9875\u7684\u5927\u5c0f\u662f 16K, \u5269\u4e0b 15k \u7528\u4e8e\u5b58\u6570\u636e\uff0c\u5728\u7d22\u5f15\u9875\u4e2d\u4e3b\u8981\u8bb0\u5f55\u7684\u662f\u4e3b\u952e\u4e0e\u9875\u53f7\uff0c\u4e3b\u952e\u6211\u4eec\u5047\u8bbe\u662f Bigint (8 byte), \u800c\u9875\u53f7\u4e5f\u662f\u56fa\u5b9a\u7684\uff084Byte\uff09, \u90a3\u4e48\u7d22\u5f15\u9875\u4e2d\u7684\u4e00\u6761\u6570\u636e\u4e5f\u5c31\u662f 12byte\u3002 \u6240\u4ee5 x=15*1024/12\u22481280 \u884c\u3002 Y=\uff1f \u53f6\u5b50\u8282\u70b9\u548c\u975e\u53f6\u5b50\u8282\u70b9\u7684\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u540c\u7406\uff0c\u80fd\u653e\u6570\u636e\u7684\u7a7a\u95f4\u4e5f\u662f 15k\u3002 \u4f46\u662f\u53f6\u5b50\u8282\u70b9\u4e2d\u5b58\u653e\u7684\u662f\u771f\u6b63\u7684\u884c\u6570\u636e\uff0c\u8fd9\u4e2a\u5f71\u54cd\u7684\u56e0\u7d20\u5c31\u4f1a\u591a\u5f88\u591a\uff0c\u6bd4\u5982\uff0c\u5b57\u6bb5\u7684\u7c7b\u578b\uff0c\u5b57\u6bb5\u7684\u6570\u91cf\u3002\u6bcf\u884c\u6570\u636e\u5360\u7528\u7a7a\u95f4\u8d8a\u5927\uff0c\u9875\u4e2d\u6240\u653e\u7684\u884c\u6570\u91cf\u5c31\u4f1a\u8d8a\u5c11\u3002 \u8fd9\u8fb9\u6211\u4eec\u6682\u65f6\u6309\u4e00\u6761\u884c\u6570\u636e 1k \u6765\u7b97\uff0c\u90a3\u4e00\u9875\u5c31\u80fd\u5b58\u4e0b 15 \u6761\uff0cY = 15*1024/1000 \u224815\u3002 \u7b97\u5230\u8fd9\u8fb9\u4e86\uff0c\u662f\u4e0d\u662f\u5fc3\u91cc\u5df2\u7ecf\u6709\u8c31\u4e86\u554a\u3002 \u6839\u636e\u4e0a\u8ff0\u7684\u516c\u5f0f\uff0cTotal =x^(z-1) *y\uff0c\u5df2\u77e5 x=1280\uff0cy=15\uff1a \u5047\u8bbe B+ \u6811\u662f\u4e24\u5c42\uff0c\u90a3\u5c31\u662f z = 2\uff0c Total = \uff081280 ^1 \uff09*15 = 19200 \u5047\u8bbe B+ \u6811\u662f\u4e09\u5c42\uff0c\u90a3\u5c31\u662f z = 3\uff0c Total = \uff081280 ^2\uff09 *15 = 24576000 \uff08\u7ea6 2.45kw\uff09 \u54ce\u5440\uff0c\u5988\u5440\uff01\u8fd9\u4e0d\u662f\u6b63\u597d\u5c31\u662f\u6587\u7ae0\u5f00\u5934\u8bf4\u7684\u6700\u5927\u884c\u6570\u5efa\u8bae\u503c 2000W \u561b\uff01\u5bf9\u7684\uff0c\u4e00\u822c B+ \u6570\u7684\u5c42\u7ea7\u6700\u591a\u4e5f\u5c31\u662f 3 \u5c42\u3002 \u4f60\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u662f 4 \u5c42\uff0c\u9664\u4e86\u67e5\u8be2\u7684\u65f6\u5019\u78c1\u76d8 IO \u6b21\u6570\u4f1a\u589e\u52a0\uff0c\u800c\u4e14\u8fd9\u4e2a Total \u503c\u4f1a\u662f\u591a\u5c11\uff0c\u5927\u6982\u5e94\u8be5\u662f 3 \u767e\u591a\u4ebf\u5427\uff0c\u4e5f\u4e0d\u592a\u5408\u7406\uff0c\u6240\u4ee5\uff0c3 \u5c42\u5e94\u8be5\u662f\u6bd4\u8f83\u5408\u7406\u7684\u4e00\u4e2a\u503c\u3002 \u5230\u8fd9\u91cc\u96be\u9053\u5c31\u5b8c\u4e86\uff1f \u4e0d\u3002 \u6211\u4eec\u521a\u521a\u5728\u8bf4 Y \u7684\u503c\u65f6\u5019\u5047\u8bbe\u7684\u662f 1K \uff0c\u90a3\u6bd4\u5982\u6211\u5b9e\u9645\u5f53\u884c\u7684\u6570\u636e\u5360\u7528\u7a7a\u95f4\u4e0d\u662f 1K , \u800c\u662f 5K, \u90a3\u4e48\u5355\u4e2a\u6570\u636e\u9875\u6700\u591a\u53ea\u80fd\u653e\u4e0b 3 \u6761\u6570\u636e\u3002 \u540c\u6837\uff0c\u8fd8\u662f\u6309\u7167 z = 3 \u7684\u503c\u6765\u8ba1\u7b97\uff0c\u90a3 Total = \uff081280 ^2\uff09 *3 = 4915200 \uff08\u8fd1 500w\uff09 \u6240\u4ee5\uff0c\u5728\u4fdd\u6301\u76f8\u540c\u7684\u5c42\u7ea7\uff08\u76f8\u4f3c\u67e5\u8be2\u6027\u80fd\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u884c\u6570\u636e\u5927\u5c0f\u4e0d\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u5b9e\u8fd9\u4e2a\u6700\u5927\u5efa\u8bae\u503c\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u800c\u4e14\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u7684\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u56e0\u7d20\uff0c\u6bd4\u5982\uff0c\u6570\u636e\u5e93\u7248\u672c\uff0c\u670d\u52a1\u5668\u914d\u7f6e\uff0csql \u7684\u7f16\u5199\u7b49\u7b49\u3002 MySQL \u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u4f1a\u5c06\u8868\u7684\u7d22\u5f15\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5728 InnoDB buffer size \u8db3\u591f\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u80fd\u5b8c\u6210\u5168\u52a0\u8f7d\u8fdb\u5185\u5b58\uff0c\u67e5\u8be2\u4e0d\u4f1a\u6709\u95ee\u9898\u3002 \u4f46\u662f\uff0c\u5f53\u5355\u8868\u6570\u636e\u5e93\u5230\u8fbe\u67d0\u4e2a\u91cf\u7ea7\u7684\u4e0a\u9650\u65f6\uff0c\u5bfc\u81f4\u5185\u5b58\u65e0\u6cd5\u5b58\u50a8\u5176\u7d22\u5f15\uff0c\u4f7f\u5f97\u4e4b\u540e\u7684 SQL \u67e5\u8be2\u4f1a\u4ea7\u751f\u78c1\u76d8 IO\uff0c\u4ece\u800c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff0c\u6240\u4ee5\u589e\u52a0\u786c\u4ef6\u914d\u7f6e\uff08\u6bd4\u5982\u628a\u5185\u5b58\u5f53\u78c1\u76d8\u4f7f\uff09\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u7acb\u7aff\u89c1\u5f71\u7684\u6027\u80fd\u63d0\u5347\u54c8\u3002","title":"\u5355\u8868\u5efa\u8bae\u503c"},{"location":"mysql/index/2000w/#_7","text":"MySQL \u7684\u8868\u6570\u636e\u662f\u4ee5\u9875\u7684\u5f62\u5f0f\u5b58\u653e\u7684\uff0c\u9875\u5728\u78c1\u76d8\u4e2d\u4e0d\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\u3002 \u9875\u7684\u7a7a\u95f4\u662f 16K, \u5e76\u4e0d\u662f\u6240\u6709\u7684\u7a7a\u95f4\u90fd\u662f\u7528\u6765\u5b58\u653e\u6570\u636e\u7684\uff0c\u4f1a\u6709\u4e00\u4e9b\u56fa\u5b9a\u7684\u4fe1\u606f\uff0c\u5982\uff0c\u9875\u5934\uff0c\u9875\u5c3e\uff0c\u9875\u7801\uff0c\u6821\u9a8c\u7801\u7b49\u7b49\u3002 \u5728 B+ \u6811\u4e2d\uff0c\u53f6\u5b50\u8282\u70b9\u548c\u975e\u53f6\u5b50\u8282\u70b9\u7684\u6570\u636e\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u5728\u4e8e\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u7684\u884c\u6570\u636e\uff0c\u800c\u975e\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u548c\u9875\u53f7\u3002 \u7d22\u5f15\u7ed3\u6784\u4e0d\u4f1a\u5f71\u54cd\u5355\u8868\u6700\u5927\u884c\u6570\uff0c2000W \u4e5f\u53ea\u662f\u63a8\u8350\u503c\uff0c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u503c\u53ef\u80fd\u4f1a\u5bfc\u81f4 B + \u6811\u5c42\u7ea7\u66f4\u9ad8\uff0c\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/index/count/","text":"count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5f53\u6211\u4eec\u5bf9\u4e00\u5f20\u6570\u636e\u8868\u4e2d\u7684\u8bb0\u5f55\u8fdb\u884c\u7edf\u8ba1\u7684\u65f6\u5019\uff0c\u4e60\u60ef\u90fd\u4f1a\u4f7f\u7528 count \u51fd\u6570\u6765\u7edf\u8ba1\uff0c\u4f46\u662f count \u51fd\u6570\u4f20\u5165\u7684\u53c2\u6570\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u5982 count(1)\u3001count( * )\u3001count(\u5b57\u6bb5) \u7b49\u3002 \u5230\u5e95\u54ea\u79cd\u6548\u7387\u662f\u6700\u597d\u7684\u5462\uff1f\u662f\u4e0d\u662f count( * ) \u6548\u7387\u6700\u5dee\uff1f \u6211\u66fe\u7ecf\u4ee5\u4e3a count( * ) \u662f\u6548\u7387\u6700\u5dee\u7684\uff0c\u56e0\u4e3a\u8ba4\u77e5\u4e0a selete * from t \u4f1a\u8bfb\u53d6\u6240\u6709\u8868\u4e2d\u7684\u5b57\u6bb5\uff0c\u6240\u4ee5\u51e1\u4e8b\u5e26\u6709 * \u5b57\u7b26\u7684\u5c31\u89c9\u5f97\u4f1a\u8bfb\u53d6\u8868\u4e2d\u6240\u6709\u7684\u5b57\u6bb5\uff0c\u5f53\u65f6\u7f51\u4e0a\u6709\u5f88\u591a\u535a\u5ba2\u4e5f\u8fd9\u4e48\u8bf4\u3002 \u4f46\u662f\uff0c\u5f53\u6211\u6df1\u5165 count \u51fd\u6570\u7684\u539f\u7406\u540e\uff0c\u88ab\u556a\u556a\u556a\u7684\u6253\u8138\u4e86\uff01 \u4e0d\u591a\u8bf4\uff0c \u53d1\u8f66\uff01 \u54ea\u79cd count \u6027\u80fd\u6700\u597d\uff1f \u00b6 \u6211\u5148\u76f4\u63a5\u8bf4\u7ed3\u8bba\uff1a \u8981\u5f04\u660e\u767d\u8fd9\u4e2a\uff0c\u6211\u4eec\u5f97\u8981\u6df1\u5165 count \u7684\u539f\u7406\uff0c\u4ee5\u4e0b\u5185\u5bb9\u57fa\u4e8e\u5e38\u7528\u7684 innodb \u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\u660e\u3002 count() \u662f\u4ec0\u4e48\uff1f \u00b6 count() \u662f\u4e00\u4e2a\u805a\u5408\u51fd\u6570\uff0c\u51fd\u6570\u7684\u53c2\u6570\u4e0d\u4ec5\u53ef\u4ee5\u662f\u5b57\u6bb5\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u4efb\u610f\u8868\u8fbe\u5f0f\uff0c\u8be5\u51fd\u6570\u4f5c\u7528\u662f**\u7edf\u8ba1\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u4e2d\uff0c\u51fd\u6570\u6307\u5b9a\u7684\u53c2\u6570\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u6709\u591a\u5c11\u4e2a**\u3002 \u5047\u8bbe count() \u51fd\u6570\u7684\u53c2\u6570\u662f\u5b57\u6bb5\u540d\uff0c\u5982\u4e0b\uff1a select count ( name ) from t_order ; \u8fd9\u6761\u8bed\u53e5\u662f\u7edf\u8ba1\u300c t_order \u8868\u4e2d\uff0cname \u5b57\u6bb5\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u300d\u6709\u591a\u5c11\u4e2a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u67d0\u4e00\u6761\u8bb0\u5f55\u4e2d\u7684 name \u5b57\u6bb5\u7684\u503c\u4e3a NULL\uff0c\u5219\u5c31\u4e0d\u4f1a\u88ab\u7edf\u8ba1\u8fdb\u53bb\u3002 \u518d\u6765\u5047\u8bbe count() \u51fd\u6570\u7684\u53c2\u6570\u662f\u6570\u5b57 1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\uff0c\u5982\u4e0b\uff1a select count ( 1 ) from t_order ; \u8fd9\u6761\u8bed\u53e5\u662f\u7edf\u8ba1\u300c t_order \u8868\u4e2d\uff0c1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u300d\u6709\u591a\u5c11\u4e2a\u3002 1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u5c31\u662f\u5355\u7eaf\u6570\u5b57\uff0c\u5b83\u6c38\u8fdc\u90fd\u4e0d\u662f NULL\uff0c\u6240\u4ee5\u4e0a\u9762\u8fd9\u6761\u8bed\u53e5\uff0c\u5176\u5b9e\u662f\u5728\u7edf\u8ba1 t_order \u8868\u4e2d\u6709\u591a\u5c11\u4e2a\u8bb0\u5f55\u3002 count(\u4e3b\u952e\u5b57\u6bb5) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f \u00b6 \u5728\u901a\u8fc7 count \u51fd\u6570\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a\u8bb0\u5f55\u65f6\uff0cMySQL \u7684 server \u5c42\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u540d\u53eb count \u7684\u53d8\u91cf\u3002 server \u5c42\u4f1a\u5faa\u73af\u5411 InnoDB \u8bfb\u53d6\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c count \u51fd\u6570\u6307\u5b9a\u7684\u53c2\u6570\u4e0d\u4e3a NULL\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u53d8\u91cf count \u52a0 1\uff0c\u76f4\u5230\u7b26\u5408\u67e5\u8be2\u7684\u5168\u90e8\u8bb0\u5f55\u88ab\u8bfb\u5b8c\uff0c\u5c31\u9000\u51fa\u5faa\u73af\u3002\u6700\u540e\u5c06 count \u53d8\u91cf\u7684\u503c\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002 InnoDB \u662f\u901a\u8fc7 B+ \u6811\u6765\u4fdd\u5b58\u8bb0\u5f55\u7684\uff0c\u6839\u636e\u7d22\u5f15\u7684\u7c7b\u578b\u53c8\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5b83\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a // id \u4e3a\u4e3b\u952e\u503c select count ( id ) from t_order ; \u5982\u679c\u8868\u91cc\u53ea\u6709\u4e3b\u952e\u7d22\u5f15\uff0c\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0c\u90a3\u4e48\uff0cInnoDB \u5faa\u73af\u904d\u5386\u805a\u7c07\u7d22\u5f15\uff0c\u5c06\u8bfb\u53d6\u5230\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 server \u5c42\uff0c\u7136\u540e\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684 id \u503c\uff0c\u5c31\u4f1a id \u503c\u5224\u65ad\u662f\u5426\u4e3a NULL\uff0c\u5982\u679c\u4e0d\u4e3a NULL\uff0c\u5c31\u5c06 count \u53d8\u91cf\u52a0 1\u3002 \u4f46\u662f\uff0c\u5982\u679c\u8868\u91cc\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0cInnoDB \u5faa\u73af\u904d\u5386\u7684\u5bf9\u8c61\u5c31\u4e0d\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u800c\u662f\u4e8c\u7ea7\u7d22\u5f15\u3002 \u8fd9\u662f\u56e0\u4e3a\u76f8\u540c\u6570\u91cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u53ef\u4ee5\u6bd4\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u5360\u7528\u66f4\u5c11\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u4e8c\u7ea7\u7d22\u5f15\u6811\u6bd4\u805a\u7c07\u7d22\u5f15\u6811\u5c0f\uff0c\u8fd9\u6837\u904d\u5386\u4e8c\u7ea7\u7d22\u5f15\u7684 I/O \u6210\u672c\u6bd4\u904d\u5386\u805a\u7c07\u7d22\u5f15\u7684 I/O \u6210\u672c\u5c0f\uff0c\u56e0\u6b64\u300c\u4f18\u5316\u5668\u300d\u4f18\u5148\u9009\u62e9\u7684\u662f\u4e8c\u7ea7\u7d22\u5f15\u3002 count(1) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f \u00b6 \u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a select count(1) from t_order; \u5982\u679c\u8868\u91cc\u53ea\u6709\u4e3b\u952e\u7d22\u5f15\uff0c\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\u3002 \u90a3\u4e48\uff0cInnoDB \u5faa\u73af\u904d\u5386\u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\uff0c\u5c06\u8bfb\u53d6\u5230\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 server \u5c42\uff0c \u4f46\u662f\u4e0d\u4f1a\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u4efb\u4f55\u5b57\u6bb5\u7684\u503c \uff0c\u56e0\u4e3a count \u51fd\u6570\u7684\u53c2\u6570\u662f 1\uff0c\u4e0d\u662f\u5b57\u6bb5\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u5b57\u6bb5\u503c\u3002\u53c2\u6570 1 \u5f88\u660e\u663e\u5e76\u4e0d\u662f NULL\uff0c\u56e0\u6b64 server \u5c42\u6bcf\u4ece InnoDB \u8bfb\u53d6\u5230\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u5c06 count \u53d8\u91cf\u52a0 1\u3002 \u53ef\u4ee5\u770b\u5230\uff0ccount(1) \u76f8\u6bd4 count(\u4e3b\u952e\u5b57\u6bb5) \u5c11\u4e00\u4e2a\u6b65\u9aa4\uff0c\u5c31\u662f\u4e0d\u9700\u8981\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u5b57\u6bb5\u503c\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u8bf4 count(1) \u6267\u884c\u6548\u7387\u4f1a\u6bd4 count(\u4e3b\u952e\u5b57\u6bb5) \u9ad8\u4e00\u70b9\u3002 \u4f46\u662f\uff0c\u5982\u679c\u8868\u91cc\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0cInnoDB \u5faa\u73af\u904d\u5386\u7684\u5bf9\u8c61\u5c31\u4e8c\u7ea7\u7d22\u5f15\u4e86\u3002 count(*) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f \u00b6 \u770b\u5230 * \u8fd9\u4e2a\u5b57\u7b26\u7684\u65f6\u5019\uff0c\u662f\u4e0d\u662f\u5927\u5bb6\u89c9\u5f97\u662f\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u503c\uff1f \u5bf9\u4e8e selete * \u8fd9\u6761\u8bed\u53e5\u6765\u8bf4\u662f\u8fd9\u4e2a\u610f\u601d\uff0c\u4f46\u662f\u5728 count(*) \u4e2d\u5e76\u4e0d\u662f\u8fd9\u4e2a\u610f\u601d\u3002 count( \\* ) \u5176\u5b9e\u7b49\u4e8e count( 0 ) \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u4f60\u4f7f\u7528 count( * ) \u65f6\uff0cMySQL \u4f1a\u5c06 * \u53c2\u6570\u8f6c\u5316\u4e3a\u53c2\u6570 0 \u6765\u5904\u7406\u3002 \u6240\u4ee5\uff0c count(*) \u6267\u884c\u8fc7\u7a0b\u8ddf count(1) \u6267\u884c\u8fc7\u7a0b\u57fa\u672c\u4e00\u6837\u7684 \uff0c\u6027\u80fd\u6ca1\u6709\u4ec0\u4e48\u5dee\u5f02\u3002 \u5728 MySQL 5.7 \u7684\u5b98\u65b9\u624b\u518c\u4e2d\u6709\u8fd9\u4e48\u4e00\u53e5\u8bdd\uff1a InnoDB handles SELECT COUNT( \\* ) and SELECT COUNT( 1 ) operations in the same way. There is no performance difference. \u7ffb\u8bd1\uff1aInnoDB\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406SELECT COUNT\uff08 \\* \uff09\u548cSELECT COUNT\uff08 1 \uff09\u64cd\u4f5c\uff0c\u6ca1\u6709\u6027\u80fd\u5dee\u5f02\u3002 \u800c\u4e14 MySQL \u4f1a\u5bf9 count(*) \u548c count(1) \u6709\u4e2a\u4f18\u5316\uff0c\u5982\u679c\u6709\u591a\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4f18\u5316\u5668\u4f1a\u4f7f\u7528key_len \u6700\u5c0f\u7684\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\u3002 \u53ea\u6709\u5f53\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u91c7\u7528\u4e3b\u952e\u7d22\u5f15\u6765\u8fdb\u884c\u7edf\u8ba1\u3002 count(\u5b57\u6bb5) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f \u00b6 count(\u5b57\u6bb5) \u7684\u6267\u884c\u6548\u7387\u76f8\u6bd4\u524d\u9762\u7684 count(1)\u3001 count(*)\u3001 count(\u4e3b\u952e\u5b57\u6bb5) \u6267\u884c\u6548\u7387\u662f\u6700\u5dee\u7684\u3002 \u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a // name\u4e0d\u662f\u7d22\u5f15 \uff0c\u666e\u901a\u5b57\u6bb5 select count ( name ) from t_order ; \u5bf9\u4e8e\u8fd9\u4e2a\u67e5\u8be2\u6765\u8bf4\uff0c\u4f1a\u91c7\u7528\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u8ba1\u6570\uff0c\u6240\u4ee5\u5b83\u7684\u6267\u884c\u6548\u7387\u662f\u6bd4\u8f83\u5dee\u7684\u3002 \u5c0f\u7ed3 \u00b6 count(1)\u3001 count(*)\u3001 count(\u4e3b\u952e\u5b57\u6bb5)\u5728\u6267\u884c\u7684\u65f6\u5019\uff0c\u5982\u679c\u8868\u91cc\u5b58\u5728\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f18\u5316\u5668\u5c31\u4f1a\u9009\u62e9\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u8981\u6267\u884c count(1)\u3001 count(*)\u3001 count(\u4e3b\u952e\u5b57\u6bb5) \u65f6\uff0c\u5c3d\u91cf\u5728\u6570\u636e\u8868\u4e0a\u5efa\u7acb\u4e8c\u7ea7\u7d22\u5f15\uff0c\u8fd9\u6837\u4f18\u5316\u5668\u4f1a\u81ea\u52a8\u91c7\u7528 key_len \u6700\u5c0f\u7684\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\uff0c\u76f8\u6bd4\u4e8e\u626b\u63cf\u4e3b\u952e\u7d22\u5f15\u6548\u7387\u4f1a\u9ad8\u4e00\u4e9b\u3002 \u518d\u6765\uff0c\u5c31\u662f\u4e0d\u8981\u4f7f\u7528 count(\u5b57\u6bb5) \u6765\u7edf\u8ba1\u8bb0\u5f55\u4e2a\u6570\uff0c\u56e0\u4e3a\u5b83\u7684\u6548\u7387\u662f\u6700\u5dee\u7684\uff0c\u4f1a\u91c7\u7528\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u3002\u5982\u679c\u4f60\u975e\u8981\u7edf\u8ba1\u8868\u4e2d\u8be5\u5b57\u6bb5\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u4e2a\u6570\uff0c\u5efa\u8bae\u7ed9\u8fd9\u4e2a\u5b57\u6bb5\u5efa\u7acb\u4e00\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u3002 \u4e3a\u4ec0\u4e48\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u6765\u8ba1\u6570\uff1f \u00b6 \u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u4e3a\u4ec0\u4e48 count \u51fd\u6570\u9700\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u8bb0\u5f55\u4e2a\u6570\uff1f \u6211\u524d\u9762\u5c06\u7684\u6848\u4f8b\u90fd\u662f\u57fa\u4e8e Innodb \u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\u660e\u7684\uff0c\u4f46\u662f\u5728 MyISAM \u5b58\u50a8\u5f15\u64ce\u91cc\uff0c\u6267\u884c count \u51fd\u6570\u7684\u65b9\u5f0f\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u901a\u5e38\u5728\u6ca1\u6709\u4efb\u4f55\u67e5\u8be2\u6761\u4ef6\u4e0b\u7684 count(*)\uff0cMyISAM \u7684\u67e5\u8be2\u901f\u5ea6\u8981\u660e\u663e\u5feb\u4e8e InnoDB\u3002 \u4f7f\u7528 MyISAM \u5f15\u64ce\u65f6\uff0c\u6267\u884c count \u51fd\u6570\u53ea\u9700\u8981 O(1 )\u590d\u6742\u5ea6\uff0c\u8fd9\u662f\u56e0\u4e3a\u6bcf\u5f20 MyISAM \u7684\u6570\u636e\u8868\u90fd\u6709\u4e00\u4e2a meta \u4fe1\u606f\u6709\u5b58\u50a8\u4e86row_count\u503c\uff0c\u7531\u8868\u7ea7\u9501\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u6240\u4ee5\u76f4\u63a5\u8bfb\u53d6 row_count \u503c\u5c31\u662f count \u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u3002 \u800c InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u540c\u4e00\u4e2a\u65f6\u523b\u7684\u591a\u4e2a\u67e5\u8be2\uff0c\u7531\u4e8e\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff08MVCC\uff09\u7684\u539f\u56e0\uff0cInnoDB \u8868\u201c\u5e94\u8be5\u8fd4\u56de\u591a\u5c11\u884c\u201d\u4e5f\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\u65e0\u6cd5\u50cf MyISAM\u4e00\u6837\uff0c\u53ea\u7ef4\u62a4\u4e00\u4e2a row_count \u53d8\u91cf\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u8868 t_order \u6709 100 \u6761\u8bb0\u5f55\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u4f1a\u8bdd\u5e76\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a \u5728\u4f1a\u8bdd A \u548c\u4f1a\u8bdd B\u7684\u6700\u540e\u4e00\u4e2a\u65f6\u523b\uff0c\u540c\u65f6\u67e5\u8868 t_order \u7684\u8bb0\u5f55\u603b\u4e2a\u6570\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u663e\u793a\u7684\u7ed3\u679c\u662f\u4e0d\u4e00\u6837\u7684\u3002\u6240\u4ee5\uff0c\u5728\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u65f6\uff0c\u5c31\u9700\u8981\u626b\u63cf\u8868\u6765\u7edf\u8ba1\u5177\u4f53\u7684\u8bb0\u5f55\u3002 \u800c\u5f53\u5e26\u4e0a where \u6761\u4ef6\u8bed\u53e5\u4e4b\u540e\uff0cMyISAM \u8ddf InnoDB \u5c31\u6ca1\u6709\u533a\u522b\u4e86\uff0c\u5b83\u4eec\u90fd\u9700\u8981\u626b\u63cf\u8868\u6765\u8fdb\u884c\u8bb0\u5f55\u4e2a\u6570\u7684\u7edf\u8ba1\u3002 \u5982\u4f55\u4f18\u5316 count(*)\uff1f \u00b6 \u5982\u679c\u5bf9\u4e00\u5f20\u5927\u8868\u7ecf\u5e38\u7528 count(*) \u6765\u505a\u7edf\u8ba1\uff0c\u5176\u5b9e\u662f\u5f88\u4e0d\u597d\u7684\u3002 \u6bd4\u5982\u4e0b\u9762\u6211\u8fd9\u4e2a\u6848\u4f8b\uff0c\u8868 t_order \u5171\u6709 1200+ \u4e07\u6761\u8bb0\u5f55\uff0c\u6211\u4e5f\u521b\u5efa\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u6267\u884c\u4e00\u6b21 select count(*) from t_order \u8981\u82b1\u8d39\u5dee\u4e0d\u591a 5 \u79d2\uff01 \u9762\u5bf9\u5927\u8868\u7684\u8bb0\u5f55\u7edf\u8ba1\uff0c\u6211\u4eec\u6709\u6ca1\u6709\u4ec0\u4e48\u5176\u4ed6\u66f4\u597d\u7684\u529e\u6cd5\u5462\uff1f \u7b2c\u4e00\u79cd\uff0c\u8fd1\u4f3c\u503c \u00b6 \u5982\u679c\u4f60\u7684\u4e1a\u52a1\u5bf9\u4e8e\u7edf\u8ba1\u4e2a\u6570\u4e0d\u9700\u8981\u5f88\u7cbe\u786e\uff0c\u6bd4\u5982\u641c\u7d22\u5f15\u64ce\u5728\u641c\u7d22\u5173\u952e\u8bcd\u7684\u65f6\u5019\uff0c\u7ed9\u51fa\u7684\u641c\u7d22\u7ed3\u679c\u6761\u6570\u662f\u4e00\u4e2a\u5927\u6982\u503c\u3002 \u8fd9\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 show table status \u6216\u8005 explain \u547d\u4ee4\u6765\u8868\u8fdb\u884c\u4f30\u7b97\u3002 \u6267\u884c explain \u547d\u4ee4\u6548\u7387\u662f\u5f88\u9ad8\u7684\uff0c\u56e0\u4e3a\u5b83\u5e76\u4e0d\u4f1a\u771f\u6b63\u7684\u53bb\u67e5\u8be2\uff0c\u4e0b\u56fe\u4e2d\u7684 rows \u5b57\u6bb5\u503c\u5c31\u662f explain \u547d\u4ee4\u5bf9\u8868 t_order \u8bb0\u5f55\u7684\u4f30\u7b97\u503c\u3002 \u7b2c\u4e8c\u79cd\uff0c\u989d\u5916\u8868\u4fdd\u5b58\u8ba1\u6570\u503c \u00b6 \u5982\u679c\u662f\u60f3\u7cbe\u786e\u7684\u83b7\u53d6\u8868\u7684\u8bb0\u5f55\u603b\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u8ba1\u6570\u503c\u4fdd\u5b58\u5230\u5355\u72ec\u7684\u4e00\u5f20\u8ba1\u6570\u8868\u4e2d\u3002 \u5f53\u6211\u4eec\u5728\u6570\u636e\u8868\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u7684\u540c\u65f6\uff0c\u5c06\u8ba1\u6570\u8868\u4e2d\u7684\u8ba1\u6570\u5b57\u6bb5 + 1\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u65b0\u589e\u548c\u5220\u9664\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u989d\u5916\u7ef4\u62a4\u8fd9\u4e2a\u8ba1\u6570\u8868\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f"},{"location":"mysql/index/count/#count-count1","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5f53\u6211\u4eec\u5bf9\u4e00\u5f20\u6570\u636e\u8868\u4e2d\u7684\u8bb0\u5f55\u8fdb\u884c\u7edf\u8ba1\u7684\u65f6\u5019\uff0c\u4e60\u60ef\u90fd\u4f1a\u4f7f\u7528 count \u51fd\u6570\u6765\u7edf\u8ba1\uff0c\u4f46\u662f count \u51fd\u6570\u4f20\u5165\u7684\u53c2\u6570\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u5982 count(1)\u3001count( * )\u3001count(\u5b57\u6bb5) \u7b49\u3002 \u5230\u5e95\u54ea\u79cd\u6548\u7387\u662f\u6700\u597d\u7684\u5462\uff1f\u662f\u4e0d\u662f count( * ) \u6548\u7387\u6700\u5dee\uff1f \u6211\u66fe\u7ecf\u4ee5\u4e3a count( * ) \u662f\u6548\u7387\u6700\u5dee\u7684\uff0c\u56e0\u4e3a\u8ba4\u77e5\u4e0a selete * from t \u4f1a\u8bfb\u53d6\u6240\u6709\u8868\u4e2d\u7684\u5b57\u6bb5\uff0c\u6240\u4ee5\u51e1\u4e8b\u5e26\u6709 * \u5b57\u7b26\u7684\u5c31\u89c9\u5f97\u4f1a\u8bfb\u53d6\u8868\u4e2d\u6240\u6709\u7684\u5b57\u6bb5\uff0c\u5f53\u65f6\u7f51\u4e0a\u6709\u5f88\u591a\u535a\u5ba2\u4e5f\u8fd9\u4e48\u8bf4\u3002 \u4f46\u662f\uff0c\u5f53\u6211\u6df1\u5165 count \u51fd\u6570\u7684\u539f\u7406\u540e\uff0c\u88ab\u556a\u556a\u556a\u7684\u6253\u8138\u4e86\uff01 \u4e0d\u591a\u8bf4\uff0c \u53d1\u8f66\uff01","title":"count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f"},{"location":"mysql/index/count/#count","text":"\u6211\u5148\u76f4\u63a5\u8bf4\u7ed3\u8bba\uff1a \u8981\u5f04\u660e\u767d\u8fd9\u4e2a\uff0c\u6211\u4eec\u5f97\u8981\u6df1\u5165 count \u7684\u539f\u7406\uff0c\u4ee5\u4e0b\u5185\u5bb9\u57fa\u4e8e\u5e38\u7528\u7684 innodb \u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\u660e\u3002","title":"\u54ea\u79cd count \u6027\u80fd\u6700\u597d\uff1f"},{"location":"mysql/index/count/#count_1","text":"count() \u662f\u4e00\u4e2a\u805a\u5408\u51fd\u6570\uff0c\u51fd\u6570\u7684\u53c2\u6570\u4e0d\u4ec5\u53ef\u4ee5\u662f\u5b57\u6bb5\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u4efb\u610f\u8868\u8fbe\u5f0f\uff0c\u8be5\u51fd\u6570\u4f5c\u7528\u662f**\u7edf\u8ba1\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u4e2d\uff0c\u51fd\u6570\u6307\u5b9a\u7684\u53c2\u6570\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u6709\u591a\u5c11\u4e2a**\u3002 \u5047\u8bbe count() \u51fd\u6570\u7684\u53c2\u6570\u662f\u5b57\u6bb5\u540d\uff0c\u5982\u4e0b\uff1a select count ( name ) from t_order ; \u8fd9\u6761\u8bed\u53e5\u662f\u7edf\u8ba1\u300c t_order \u8868\u4e2d\uff0cname \u5b57\u6bb5\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u300d\u6709\u591a\u5c11\u4e2a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u67d0\u4e00\u6761\u8bb0\u5f55\u4e2d\u7684 name \u5b57\u6bb5\u7684\u503c\u4e3a NULL\uff0c\u5219\u5c31\u4e0d\u4f1a\u88ab\u7edf\u8ba1\u8fdb\u53bb\u3002 \u518d\u6765\u5047\u8bbe count() \u51fd\u6570\u7684\u53c2\u6570\u662f\u6570\u5b57 1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\uff0c\u5982\u4e0b\uff1a select count ( 1 ) from t_order ; \u8fd9\u6761\u8bed\u53e5\u662f\u7edf\u8ba1\u300c t_order \u8868\u4e2d\uff0c1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u300d\u6709\u591a\u5c11\u4e2a\u3002 1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u5c31\u662f\u5355\u7eaf\u6570\u5b57\uff0c\u5b83\u6c38\u8fdc\u90fd\u4e0d\u662f NULL\uff0c\u6240\u4ee5\u4e0a\u9762\u8fd9\u6761\u8bed\u53e5\uff0c\u5176\u5b9e\u662f\u5728\u7edf\u8ba1 t_order \u8868\u4e2d\u6709\u591a\u5c11\u4e2a\u8bb0\u5f55\u3002","title":"count() \u662f\u4ec0\u4e48\uff1f"},{"location":"mysql/index/count/#count_2","text":"\u5728\u901a\u8fc7 count \u51fd\u6570\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a\u8bb0\u5f55\u65f6\uff0cMySQL \u7684 server \u5c42\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u540d\u53eb count \u7684\u53d8\u91cf\u3002 server \u5c42\u4f1a\u5faa\u73af\u5411 InnoDB \u8bfb\u53d6\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c count \u51fd\u6570\u6307\u5b9a\u7684\u53c2\u6570\u4e0d\u4e3a NULL\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u53d8\u91cf count \u52a0 1\uff0c\u76f4\u5230\u7b26\u5408\u67e5\u8be2\u7684\u5168\u90e8\u8bb0\u5f55\u88ab\u8bfb\u5b8c\uff0c\u5c31\u9000\u51fa\u5faa\u73af\u3002\u6700\u540e\u5c06 count \u53d8\u91cf\u7684\u503c\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002 InnoDB \u662f\u901a\u8fc7 B+ \u6811\u6765\u4fdd\u5b58\u8bb0\u5f55\u7684\uff0c\u6839\u636e\u7d22\u5f15\u7684\u7c7b\u578b\u53c8\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5b83\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a // id \u4e3a\u4e3b\u952e\u503c select count ( id ) from t_order ; \u5982\u679c\u8868\u91cc\u53ea\u6709\u4e3b\u952e\u7d22\u5f15\uff0c\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0c\u90a3\u4e48\uff0cInnoDB \u5faa\u73af\u904d\u5386\u805a\u7c07\u7d22\u5f15\uff0c\u5c06\u8bfb\u53d6\u5230\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 server \u5c42\uff0c\u7136\u540e\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684 id \u503c\uff0c\u5c31\u4f1a id \u503c\u5224\u65ad\u662f\u5426\u4e3a NULL\uff0c\u5982\u679c\u4e0d\u4e3a NULL\uff0c\u5c31\u5c06 count \u53d8\u91cf\u52a0 1\u3002 \u4f46\u662f\uff0c\u5982\u679c\u8868\u91cc\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0cInnoDB \u5faa\u73af\u904d\u5386\u7684\u5bf9\u8c61\u5c31\u4e0d\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u800c\u662f\u4e8c\u7ea7\u7d22\u5f15\u3002 \u8fd9\u662f\u56e0\u4e3a\u76f8\u540c\u6570\u91cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u53ef\u4ee5\u6bd4\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u5360\u7528\u66f4\u5c11\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u4e8c\u7ea7\u7d22\u5f15\u6811\u6bd4\u805a\u7c07\u7d22\u5f15\u6811\u5c0f\uff0c\u8fd9\u6837\u904d\u5386\u4e8c\u7ea7\u7d22\u5f15\u7684 I/O \u6210\u672c\u6bd4\u904d\u5386\u805a\u7c07\u7d22\u5f15\u7684 I/O \u6210\u672c\u5c0f\uff0c\u56e0\u6b64\u300c\u4f18\u5316\u5668\u300d\u4f18\u5148\u9009\u62e9\u7684\u662f\u4e8c\u7ea7\u7d22\u5f15\u3002","title":"count(\u4e3b\u952e\u5b57\u6bb5) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f"},{"location":"mysql/index/count/#count1","text":"\u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a select count(1) from t_order; \u5982\u679c\u8868\u91cc\u53ea\u6709\u4e3b\u952e\u7d22\u5f15\uff0c\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\u3002 \u90a3\u4e48\uff0cInnoDB \u5faa\u73af\u904d\u5386\u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\uff0c\u5c06\u8bfb\u53d6\u5230\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 server \u5c42\uff0c \u4f46\u662f\u4e0d\u4f1a\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u4efb\u4f55\u5b57\u6bb5\u7684\u503c \uff0c\u56e0\u4e3a count \u51fd\u6570\u7684\u53c2\u6570\u662f 1\uff0c\u4e0d\u662f\u5b57\u6bb5\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u5b57\u6bb5\u503c\u3002\u53c2\u6570 1 \u5f88\u660e\u663e\u5e76\u4e0d\u662f NULL\uff0c\u56e0\u6b64 server \u5c42\u6bcf\u4ece InnoDB \u8bfb\u53d6\u5230\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u5c06 count \u53d8\u91cf\u52a0 1\u3002 \u53ef\u4ee5\u770b\u5230\uff0ccount(1) \u76f8\u6bd4 count(\u4e3b\u952e\u5b57\u6bb5) \u5c11\u4e00\u4e2a\u6b65\u9aa4\uff0c\u5c31\u662f\u4e0d\u9700\u8981\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u5b57\u6bb5\u503c\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u8bf4 count(1) \u6267\u884c\u6548\u7387\u4f1a\u6bd4 count(\u4e3b\u952e\u5b57\u6bb5) \u9ad8\u4e00\u70b9\u3002 \u4f46\u662f\uff0c\u5982\u679c\u8868\u91cc\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0cInnoDB \u5faa\u73af\u904d\u5386\u7684\u5bf9\u8c61\u5c31\u4e8c\u7ea7\u7d22\u5f15\u4e86\u3002","title":"count(1) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f"},{"location":"mysql/index/count/#count_3","text":"\u770b\u5230 * \u8fd9\u4e2a\u5b57\u7b26\u7684\u65f6\u5019\uff0c\u662f\u4e0d\u662f\u5927\u5bb6\u89c9\u5f97\u662f\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u503c\uff1f \u5bf9\u4e8e selete * \u8fd9\u6761\u8bed\u53e5\u6765\u8bf4\u662f\u8fd9\u4e2a\u610f\u601d\uff0c\u4f46\u662f\u5728 count(*) \u4e2d\u5e76\u4e0d\u662f\u8fd9\u4e2a\u610f\u601d\u3002 count( \\* ) \u5176\u5b9e\u7b49\u4e8e count( 0 ) \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u4f60\u4f7f\u7528 count( * ) \u65f6\uff0cMySQL \u4f1a\u5c06 * \u53c2\u6570\u8f6c\u5316\u4e3a\u53c2\u6570 0 \u6765\u5904\u7406\u3002 \u6240\u4ee5\uff0c count(*) \u6267\u884c\u8fc7\u7a0b\u8ddf count(1) \u6267\u884c\u8fc7\u7a0b\u57fa\u672c\u4e00\u6837\u7684 \uff0c\u6027\u80fd\u6ca1\u6709\u4ec0\u4e48\u5dee\u5f02\u3002 \u5728 MySQL 5.7 \u7684\u5b98\u65b9\u624b\u518c\u4e2d\u6709\u8fd9\u4e48\u4e00\u53e5\u8bdd\uff1a InnoDB handles SELECT COUNT( \\* ) and SELECT COUNT( 1 ) operations in the same way. There is no performance difference. \u7ffb\u8bd1\uff1aInnoDB\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406SELECT COUNT\uff08 \\* \uff09\u548cSELECT COUNT\uff08 1 \uff09\u64cd\u4f5c\uff0c\u6ca1\u6709\u6027\u80fd\u5dee\u5f02\u3002 \u800c\u4e14 MySQL \u4f1a\u5bf9 count(*) \u548c count(1) \u6709\u4e2a\u4f18\u5316\uff0c\u5982\u679c\u6709\u591a\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4f18\u5316\u5668\u4f1a\u4f7f\u7528key_len \u6700\u5c0f\u7684\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\u3002 \u53ea\u6709\u5f53\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u91c7\u7528\u4e3b\u952e\u7d22\u5f15\u6765\u8fdb\u884c\u7edf\u8ba1\u3002","title":"count(*) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f"},{"location":"mysql/index/count/#count_4","text":"count(\u5b57\u6bb5) \u7684\u6267\u884c\u6548\u7387\u76f8\u6bd4\u524d\u9762\u7684 count(1)\u3001 count(*)\u3001 count(\u4e3b\u952e\u5b57\u6bb5) \u6267\u884c\u6548\u7387\u662f\u6700\u5dee\u7684\u3002 \u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a // name\u4e0d\u662f\u7d22\u5f15 \uff0c\u666e\u901a\u5b57\u6bb5 select count ( name ) from t_order ; \u5bf9\u4e8e\u8fd9\u4e2a\u67e5\u8be2\u6765\u8bf4\uff0c\u4f1a\u91c7\u7528\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u8ba1\u6570\uff0c\u6240\u4ee5\u5b83\u7684\u6267\u884c\u6548\u7387\u662f\u6bd4\u8f83\u5dee\u7684\u3002","title":"count(\u5b57\u6bb5) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f"},{"location":"mysql/index/count/#_1","text":"count(1)\u3001 count(*)\u3001 count(\u4e3b\u952e\u5b57\u6bb5)\u5728\u6267\u884c\u7684\u65f6\u5019\uff0c\u5982\u679c\u8868\u91cc\u5b58\u5728\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f18\u5316\u5668\u5c31\u4f1a\u9009\u62e9\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u8981\u6267\u884c count(1)\u3001 count(*)\u3001 count(\u4e3b\u952e\u5b57\u6bb5) \u65f6\uff0c\u5c3d\u91cf\u5728\u6570\u636e\u8868\u4e0a\u5efa\u7acb\u4e8c\u7ea7\u7d22\u5f15\uff0c\u8fd9\u6837\u4f18\u5316\u5668\u4f1a\u81ea\u52a8\u91c7\u7528 key_len \u6700\u5c0f\u7684\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\uff0c\u76f8\u6bd4\u4e8e\u626b\u63cf\u4e3b\u952e\u7d22\u5f15\u6548\u7387\u4f1a\u9ad8\u4e00\u4e9b\u3002 \u518d\u6765\uff0c\u5c31\u662f\u4e0d\u8981\u4f7f\u7528 count(\u5b57\u6bb5) \u6765\u7edf\u8ba1\u8bb0\u5f55\u4e2a\u6570\uff0c\u56e0\u4e3a\u5b83\u7684\u6548\u7387\u662f\u6700\u5dee\u7684\uff0c\u4f1a\u91c7\u7528\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u3002\u5982\u679c\u4f60\u975e\u8981\u7edf\u8ba1\u8868\u4e2d\u8be5\u5b57\u6bb5\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u4e2a\u6570\uff0c\u5efa\u8bae\u7ed9\u8fd9\u4e2a\u5b57\u6bb5\u5efa\u7acb\u4e00\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u3002","title":"\u5c0f\u7ed3"},{"location":"mysql/index/count/#_2","text":"\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u4e3a\u4ec0\u4e48 count \u51fd\u6570\u9700\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u8bb0\u5f55\u4e2a\u6570\uff1f \u6211\u524d\u9762\u5c06\u7684\u6848\u4f8b\u90fd\u662f\u57fa\u4e8e Innodb \u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\u660e\u7684\uff0c\u4f46\u662f\u5728 MyISAM \u5b58\u50a8\u5f15\u64ce\u91cc\uff0c\u6267\u884c count \u51fd\u6570\u7684\u65b9\u5f0f\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u901a\u5e38\u5728\u6ca1\u6709\u4efb\u4f55\u67e5\u8be2\u6761\u4ef6\u4e0b\u7684 count(*)\uff0cMyISAM \u7684\u67e5\u8be2\u901f\u5ea6\u8981\u660e\u663e\u5feb\u4e8e InnoDB\u3002 \u4f7f\u7528 MyISAM \u5f15\u64ce\u65f6\uff0c\u6267\u884c count \u51fd\u6570\u53ea\u9700\u8981 O(1 )\u590d\u6742\u5ea6\uff0c\u8fd9\u662f\u56e0\u4e3a\u6bcf\u5f20 MyISAM \u7684\u6570\u636e\u8868\u90fd\u6709\u4e00\u4e2a meta \u4fe1\u606f\u6709\u5b58\u50a8\u4e86row_count\u503c\uff0c\u7531\u8868\u7ea7\u9501\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u6240\u4ee5\u76f4\u63a5\u8bfb\u53d6 row_count \u503c\u5c31\u662f count \u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u3002 \u800c InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u540c\u4e00\u4e2a\u65f6\u523b\u7684\u591a\u4e2a\u67e5\u8be2\uff0c\u7531\u4e8e\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff08MVCC\uff09\u7684\u539f\u56e0\uff0cInnoDB \u8868\u201c\u5e94\u8be5\u8fd4\u56de\u591a\u5c11\u884c\u201d\u4e5f\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\u65e0\u6cd5\u50cf MyISAM\u4e00\u6837\uff0c\u53ea\u7ef4\u62a4\u4e00\u4e2a row_count \u53d8\u91cf\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u8868 t_order \u6709 100 \u6761\u8bb0\u5f55\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u4f1a\u8bdd\u5e76\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a \u5728\u4f1a\u8bdd A \u548c\u4f1a\u8bdd B\u7684\u6700\u540e\u4e00\u4e2a\u65f6\u523b\uff0c\u540c\u65f6\u67e5\u8868 t_order \u7684\u8bb0\u5f55\u603b\u4e2a\u6570\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u663e\u793a\u7684\u7ed3\u679c\u662f\u4e0d\u4e00\u6837\u7684\u3002\u6240\u4ee5\uff0c\u5728\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u65f6\uff0c\u5c31\u9700\u8981\u626b\u63cf\u8868\u6765\u7edf\u8ba1\u5177\u4f53\u7684\u8bb0\u5f55\u3002 \u800c\u5f53\u5e26\u4e0a where \u6761\u4ef6\u8bed\u53e5\u4e4b\u540e\uff0cMyISAM \u8ddf InnoDB \u5c31\u6ca1\u6709\u533a\u522b\u4e86\uff0c\u5b83\u4eec\u90fd\u9700\u8981\u626b\u63cf\u8868\u6765\u8fdb\u884c\u8bb0\u5f55\u4e2a\u6570\u7684\u7edf\u8ba1\u3002","title":"\u4e3a\u4ec0\u4e48\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u6765\u8ba1\u6570\uff1f"},{"location":"mysql/index/count/#count_5","text":"\u5982\u679c\u5bf9\u4e00\u5f20\u5927\u8868\u7ecf\u5e38\u7528 count(*) \u6765\u505a\u7edf\u8ba1\uff0c\u5176\u5b9e\u662f\u5f88\u4e0d\u597d\u7684\u3002 \u6bd4\u5982\u4e0b\u9762\u6211\u8fd9\u4e2a\u6848\u4f8b\uff0c\u8868 t_order \u5171\u6709 1200+ \u4e07\u6761\u8bb0\u5f55\uff0c\u6211\u4e5f\u521b\u5efa\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u6267\u884c\u4e00\u6b21 select count(*) from t_order \u8981\u82b1\u8d39\u5dee\u4e0d\u591a 5 \u79d2\uff01 \u9762\u5bf9\u5927\u8868\u7684\u8bb0\u5f55\u7edf\u8ba1\uff0c\u6211\u4eec\u6709\u6ca1\u6709\u4ec0\u4e48\u5176\u4ed6\u66f4\u597d\u7684\u529e\u6cd5\u5462\uff1f","title":"\u5982\u4f55\u4f18\u5316  count(*)\uff1f"},{"location":"mysql/index/count/#_3","text":"\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u5bf9\u4e8e\u7edf\u8ba1\u4e2a\u6570\u4e0d\u9700\u8981\u5f88\u7cbe\u786e\uff0c\u6bd4\u5982\u641c\u7d22\u5f15\u64ce\u5728\u641c\u7d22\u5173\u952e\u8bcd\u7684\u65f6\u5019\uff0c\u7ed9\u51fa\u7684\u641c\u7d22\u7ed3\u679c\u6761\u6570\u662f\u4e00\u4e2a\u5927\u6982\u503c\u3002 \u8fd9\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 show table status \u6216\u8005 explain \u547d\u4ee4\u6765\u8868\u8fdb\u884c\u4f30\u7b97\u3002 \u6267\u884c explain \u547d\u4ee4\u6548\u7387\u662f\u5f88\u9ad8\u7684\uff0c\u56e0\u4e3a\u5b83\u5e76\u4e0d\u4f1a\u771f\u6b63\u7684\u53bb\u67e5\u8be2\uff0c\u4e0b\u56fe\u4e2d\u7684 rows \u5b57\u6bb5\u503c\u5c31\u662f explain \u547d\u4ee4\u5bf9\u8868 t_order \u8bb0\u5f55\u7684\u4f30\u7b97\u503c\u3002","title":"\u7b2c\u4e00\u79cd\uff0c\u8fd1\u4f3c\u503c"},{"location":"mysql/index/count/#_4","text":"\u5982\u679c\u662f\u60f3\u7cbe\u786e\u7684\u83b7\u53d6\u8868\u7684\u8bb0\u5f55\u603b\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u8ba1\u6570\u503c\u4fdd\u5b58\u5230\u5355\u72ec\u7684\u4e00\u5f20\u8ba1\u6570\u8868\u4e2d\u3002 \u5f53\u6211\u4eec\u5728\u6570\u636e\u8868\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u7684\u540c\u65f6\uff0c\u5c06\u8ba1\u6570\u8868\u4e2d\u7684\u8ba1\u6570\u5b57\u6bb5 + 1\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u65b0\u589e\u548c\u5220\u9664\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u989d\u5916\u7ef4\u62a4\u8fd9\u4e2a\u8ba1\u6570\u8868\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u7b2c\u4e8c\u79cd\uff0c\u989d\u5916\u8868\u4fdd\u5b58\u8ba1\u6570\u503c"},{"location":"mysql/index/index_interview/","text":"\u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898 \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u9762\u8bd5\u4e2d\uff0cMySQL \u7d22\u5f15\u76f8\u5173\u7684\u95ee\u9898\u57fa\u672c\u90fd\u662f\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u90fd\u662f\u5148\u4ece\u7d22\u5f15\u7684\u57fa\u672c\u539f\u7406\uff0c\u518d\u5230\u7d22\u5f15\u7684\u4f7f\u7528\u573a\u666f\uff0c\u6bd4\u5982\uff1a \u7d22\u5f15\u5e95\u5c42\u4f7f\u7528\u4e86\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\uff1f \u4e3a\u4ec0\u4e48 MySQL InnoDB \u9009\u62e9 B+tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff1f \u4ec0\u4e48\u65f6\u5019\u9002\u7528\u7d22\u5f15\uff1f \u4ec0\u4e48\u65f6\u5019\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f \u4ec0\u4e48\u60c5\u51b5\u4e0b\u7d22\u5f15\u4f1a\u5931\u6548\uff1f \u6709\u4ec0\u4e48\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1f ..... \u4eca\u5929\u5c31\u5e26\u5927\u5bb6\uff0c\u592f\u5b9e MySQL \u7d22\u5f15\u7684\u77e5\u8bc6\u70b9\u3002 \u4ec0\u4e48\u662f\u7d22\u5f15\uff1f \u00b6 \u5f53\u4f60\u60f3\u67e5\u9605\u4e66\u4e2d\u67d0\u4e2a\u77e5\u8bc6\u7684\u5185\u5bb9\uff0c\u4f60\u4f1a\u9009\u62e9\u4e00\u9875\u4e00\u9875\u7684\u627e\u5462\uff1f\u8fd8\u662f\u5728\u4e66\u7684\u76ee\u5f55\u53bb\u627e\u5462\uff1f \u50bb\u74dc\u90fd\u77e5\u9053\u65f6\u95f4\u662f\u5b9d\u8d35\u7684\uff0c\u5f53\u7136\u662f\u9009\u62e9\u5728\u4e66\u7684\u76ee\u5f55\u53bb\u627e\uff0c\u627e\u5230\u540e\u518d\u7ffb\u5230\u5bf9\u5e94\u7684\u9875\u3002\u4e66\u4e2d\u7684**\u76ee\u5f55**\uff0c\u5c31\u662f\u5145\u5f53**\u7d22\u5f15**\u7684\u89d2\u8272\uff0c\u65b9\u4fbf\u6211\u4eec\u5feb\u901f\u67e5\u627e\u4e66\u4e2d\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u7d22\u5f15\u662f\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u8bbe\u8ba1\u601d\u60f3\u3002 \u90a3\u6362\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u7d22\u5f15\u7684\u5b9a\u4e49\u5c31\u662f\u5e2e\u52a9\u5b58\u50a8\u5f15\u64ce\u5feb\u901f\u83b7\u53d6\u6570\u636e\u7684\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5f62\u8c61\u7684\u8bf4\u5c31\u662f**\u7d22\u5f15\u662f\u6570\u636e\u7684\u76ee\u5f55**\u3002 \u6240\u8c13\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u3001\u5982\u4f55\u4e3a\u5b58\u50a8\u7684\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u548c\u5982\u4f55\u66f4\u65b0\u3001\u67e5\u8be2\u6570\u636e\u7b49\u6280\u672f\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002MySQL \u5b58\u50a8\u5f15\u64ce\u6709 MyISAM \u3001InnoDB\u3001Memory\uff0c\u5176\u4e2d InnoDB \u662f\u5728 MySQL 5.5 \u4e4b\u540e\u6210\u4e3a\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u3002 \u4e0b\u56fe\u662f MySQL \u7684\u7ed3\u6784\u56fe\uff0c\u7d22\u5f15\u548c\u6570\u636e\u5c31\u662f\u4f4d\u4e8e\u5b58\u50a8\u5f15\u64ce\u4e2d\uff1a \u7d22\u5f15\u7684\u5206\u7c7b \u00b6 \u4f60\u77e5\u9053\u7d22\u5f15\u6709\u54ea\u4e9b\u5417\uff1f\u5927\u5bb6\u80af\u5b9a\u90fd\u80fd\u9739\u96f3\u556a\u5566\u5730\u8bf4\u51fa\u805a\u7c07\u7d22\u5f15\u3001\u4e3b\u952e\u7d22\u5f15\u3001\u4e8c\u7ea7\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001hash\u7d22\u5f15\u3001B+\u6811\u7d22\u5f15\u7b49\u7b49\u3002 \u7136\u540e\u518d\u95ee\u4f60\uff0c\u4f60\u80fd\u5c06\u8fd9\u4e9b\u7d22\u5f15\u5206\u4e00\u4e0b\u7c7b\u5417\uff1f\u53ef\u80fd\u5927\u5bb6\u5c31\u6709\u70b9\u6a21\u7cca\u4e86\u3002\u5176\u5b9e\uff0c\u8981\u5bf9\u8fd9\u4e9b\u7d22\u5f15\u8fdb\u884c\u5206\u7c7b\uff0c\u8981\u6e05\u695a\u8fd9\u4e9b\u7d22\u5f15\u7684\u4f7f\u7528\u548c\u5b9e\u73b0\u65b9\u5f0f\uff0c\u7136\u540e\u518d\u9488\u5bf9\u6709\u76f8\u540c\u7279\u70b9\u7684\u7d22\u5f15\u5f52\u4e3a\u4e00\u7c7b\u3002 \u6211\u4eec\u53ef\u4ee5\u6309\u7167\u56db\u4e2a\u89d2\u5ea6\u6765\u5206\u7c7b\u7d22\u5f15\u3002 \u6309\u300c\u6570\u636e\u7ed3\u6784\u300d\u5206\u7c7b\uff1a B+tree\u7d22\u5f15\u3001Hash\u7d22\u5f15\u3001Full-text\u7d22\u5f15 \u3002 \u6309\u300c\u7269\u7406\u5b58\u50a8\u300d\u5206\u7c7b\uff1a \u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u3001\u4e8c\u7ea7\u7d22\u5f15\uff08\u8f85\u52a9\u7d22\u5f15\uff09 \u3002 \u6309\u300c\u5b57\u6bb5\u7279\u6027\u300d\u5206\u7c7b\uff1a \u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u524d\u7f00\u7d22\u5f15 \u3002 \u6309\u300c\u5b57\u6bb5\u4e2a\u6570\u300d\u5206\u7c7b\uff1a \u5355\u5217\u7d22\u5f15\u3001\u8054\u5408\u7d22\u5f15 \u3002 \u63a5\u4e0b\u6765\uff0c\u6309\u7167\u8fd9\u4e9b\u89d2\u5ea6\u6765\u8bf4\u8bf4\u5404\u7c7b\u7d22\u5f15\u7684\u7279\u70b9\u3002 \u6309\u6570\u636e\u7ed3\u6784\u5206\u7c7b \u00b6 \u4ece\u6570\u636e\u7ed3\u6784\u7684\u89d2\u5ea6\u6765\u770b\uff0cMySQL \u5e38\u89c1\u7d22\u5f15\u6709 B+Tree \u7d22\u5f15\u3001HASH \u7d22\u5f15\u3001Full-Text \u7d22\u5f15\u3002 \u6bcf\u4e00\u79cd\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u4e0d\u4e00\u5b9a\u76f8\u540c\uff0c\u6211\u5728\u8868\u4e2d\u603b\u7ed3\u4e86 MySQL \u5e38\u89c1\u7684\u5b58\u50a8\u5f15\u64ce InnoDB\u3001MyISAM \u548c Memory \u5206\u522b\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u3002 InnoDB \u662f\u5728 MySQL 5.5 \u4e4b\u540e\u6210\u4e3a\u9ed8\u8ba4\u7684 MySQL \u5b58\u50a8\u5f15\u64ce\uff0cB+Tree \u7d22\u5f15\u7c7b\u578b\u4e5f\u662f MySQL \u5b58\u50a8\u5f15\u64ce\u91c7\u7528\u6700\u591a\u7684\u7d22\u5f15\u7c7b\u578b\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u9009\u62e9\u4e0d\u540c\u7684\u5217\u4f5c\u4e3a\u7d22\u5f15\uff1a \u5982\u679c\u6709\u4e3b\u952e\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e3b\u952e\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b \u5982\u679c\u6ca1\u6709\u4e3b\u952e\uff0c\u5c31\u9009\u62e9\u7b2c\u4e00\u4e2a\u4e0d\u5305\u542b NULL \u503c\u7684\u552f\u4e00\u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b \u5728\u4e0a\u9762\u4e24\u4e2a\u90fd\u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5c06\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9690\u5f0f\u81ea\u589e id \u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b \u5176\u5b83\u7d22\u5f15\u90fd\u5c5e\u4e8e\u8f85\u52a9\u7d22\u5f15\uff08Secondary Index\uff09\uff0c\u4e5f\u88ab\u79f0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u6216\u975e\u805a\u7c07\u7d22\u5f15\u3002 \u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+Tree \u7d22\u5f15 \u3002 \u4e3a\u4e86\u8ba9\u5927\u5bb6\u7406\u89e3 B+Tree \u7d22\u5f15\u7684\u5b58\u50a8\u548c\u67e5\u8be2\u7684\u8fc7\u7a0b\uff0c\u63a5\u4e0b\u6765\u6211\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u4f8b\u5b50\uff0c\u8bf4\u660e\u4e00\u4e0b B+Tree \u7d22\u5f15\u5728\u5b58\u50a8\u6570\u636e\u4e2d\u7684\u5177\u4f53\u5b9e\u73b0\u3002 \u5148\u521b\u5efa\u4e00\u5f20\u5546\u54c1\u8868\uff0cid \u4e3a\u4e3b\u952e\uff0c\u5982\u4e0b\uff1a CREATE TABLE ` product ` ( ` id ` int ( 11 ) NOT NULL , ` product_no ` varchar ( 20 ) DEFAULT NULL , ` name ` varchar ( 255 ) DEFAULT NULL , ` price ` decimal ( 10 , 2 ) DEFAULT NULL , PRIMARY KEY ( ` id ` ) USING BTREE ) CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic ; \u5546\u54c1\u8868\u91cc\uff0c\u6709\u8fd9\u4e9b\u884c\u6570\u636e\uff1a \u8fd9\u4e9b\u884c\u6570\u636e\uff0c\u5b58\u50a8\u5728 B+Tree \u7d22\u5f15\u65f6\u662f\u957f\u4ec0\u4e48\u6837\u5b50\u7684\uff1f B+Tree \u662f\u4e00\u79cd\u591a\u53c9\u6811\uff0c\u53f6\u5b50\u8282\u70b9\u624d\u5b58\u653e\u6570\u636e\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u5b58\u653e\u7d22\u5f15\uff0c\u800c\u4e14\u6bcf\u4e2a\u8282\u70b9\u91cc\u7684\u6570\u636e\u662f**\u6309\u4e3b\u952e\u987a\u5e8f\u5b58\u653e**\u7684\u3002\u6bcf\u4e00\u5c42\u7236\u8282\u70b9\u7684\u7d22\u5f15\u503c\u90fd\u4f1a\u51fa\u73b0\u5728\u4e0b\u5c42\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u503c\u4e2d\uff0c\u56e0\u6b64\u5728\u53f6\u5b50\u8282\u70b9\u4e2d\uff0c\u5305\u62ec\u4e86\u6240\u6709\u7684\u7d22\u5f15\u503c\u4fe1\u606f\uff0c\u5e76\u4e14\u6bcf\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u90fd\u6307\u5411\u4e0b\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\uff0c\u5f62\u6210\u4e00\u4e2a\u94fe\u8868\u3002 \u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u5982\u56fe\u6240\u793a\uff1a \u901a\u8fc7\u4e3b\u952e\u67e5\u8be2\u5546\u54c1\u6570\u636e\u7684\u8fc7\u7a0b \u00b6 \u6bd4\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd9\u6761\u8bed\u53e5\u4f7f\u7528\u4e86\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2 id \u53f7\u4e3a 5 \u7684\u5546\u54c1\u3002\u67e5\u8be2\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff0cB+Tree \u4f1a\u81ea\u9876\u5411\u4e0b\u9010\u5c42\u8fdb\u884c\u67e5\u627e\uff1a \u5c06 5 \u4e0e\u6839\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e (1\uff0c10\uff0c20) \u6bd4\u8f83\uff0c5 \u5728 1 \u548c 10 \u4e4b\u95f4\uff0c\u6240\u4ee5\u6839\u636e B+Tree\u7684\u641c\u7d22\u903b\u8f91\uff0c\u627e\u5230\u7b2c\u4e8c\u5c42\u7684\u7d22\u5f15\u6570\u636e (1\uff0c4\uff0c7)\uff1b \u5728\u7b2c\u4e8c\u5c42\u7684\u7d22\u5f15\u6570\u636e (1\uff0c4\uff0c7)\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u56e0\u4e3a 5 \u5728 4 \u548c 7 \u4e4b\u95f4\uff0c\u6240\u4ee5\u627e\u5230\u7b2c\u4e09\u5c42\u7684\u7d22\u5f15\u6570\u636e\uff084\uff0c5\uff0c6\uff09\uff1b \u5728\u53f6\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e\uff084\uff0c5\uff0c6\uff09\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u7136\u540e\u6211\u4eec\u627e\u5230\u4e86\u7d22\u5f15\u503c\u4e3a 5 \u7684\u884c\u6570\u636e\u3002 \u6570\u636e\u5e93\u7684\u7d22\u5f15\u548c\u6570\u636e\u90fd\u662f\u5b58\u50a8\u5728\u786c\u76d8\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8bfb\u53d6\u4e00\u4e2a\u8282\u70b9\u5f53\u4f5c\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u3002\u90a3\u4e48\u4e0a\u9762\u7684\u6574\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u4e00\u5171\u7ecf\u5386\u4e86 3 \u4e2a\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u8fdb\u884c\u4e86 3 \u6b21 I/O \u64cd\u4f5c\u3002 B+Tree \u5b58\u50a8\u5343\u4e07\u7ea7\u7684\u6570\u636e\u53ea\u9700\u8981 3-4 \u5c42\u9ad8\u5ea6\u5c31\u53ef\u4ee5\u6ee1\u8db3\uff0c\u8fd9\u610f\u5473\u7740\u4ece\u5343\u4e07\u7ea7\u7684\u8868\u67e5\u8be2\u76ee\u6807\u6570\u636e\u6700\u591a\u9700\u8981 3-4 \u6b21\u78c1\u76d8 I/O\uff0c\u6240\u4ee5**B+Tree \u76f8\u6bd4\u4e8e B \u6811\u548c\u4e8c\u53c9\u6811\u6765\u8bf4\uff0c\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\u67e5\u8be2\u6548\u7387\u5f88\u9ad8\uff0c\u56e0\u4e3a\u5373\u4f7f\u5728\u6570\u636e\u91cf\u5f88\u5927\u7684\u60c5\u51b5\uff0c\u67e5\u8be2\u4e00\u4e2a\u6570\u636e\u7684\u78c1\u76d8 I/O \u4f9d\u7136\u7ef4\u6301\u5728 3-4\u6b21\u3002** \u901a\u8fc7\u4e8c\u7ea7\u7d22\u5f15\u67e5\u8be2\u5546\u54c1\u6570\u636e\u7684\u8fc7\u7a0b \u00b6 \u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u548c\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u533a\u522b\u5982\u4e0b\uff1a \u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff1b \u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u6211\u8fd9\u91cc\u5c06\u524d\u9762\u7684\u5546\u54c1\u8868\u4e2d\u7684 product_no \uff08\u5546\u54c1\u7f16\u7801\uff09\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u5982\u4e0b\u56fe\uff0c\u5176\u4e2d\u975e\u53f6\u5b50\u7684 key \u503c\u662f product_no\uff08\u56fe\u4e2d\u6a59\u8272\u90e8\u5206\uff09\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\uff08\u56fe\u4e2d\u7eff\u8272\u90e8\u5206\uff09\u3002 \u5982\u679c\u6211\u7528 product_no \u4e8c\u7ea7\u7d22\u5f15\u67e5\u8be2\u5546\u54c1\uff0c\u5982\u4e0b\u67e5\u8be2\u8bed\u53e5\uff1a select * from product where product_no = '0002' ; \u4f1a\u5148\u68c0\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u7684 B+Tree \u7684\u7d22\u5f15\u503c\uff08\u5546\u54c1\u7f16\u7801\uff0cproduct_no\uff09\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e\u518d\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 B+Tree \u6811\u67e5\u8be2\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u6574\u884c\u6570\u636e\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u300c\u56de\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u67e5\u4e24\u4e2a B+Tree \u624d\u80fd\u67e5\u5230\u6570\u636e \u3002\u5982\u4e0b\u56fe\uff1a \u4e0d\u8fc7\uff0c\u5f53\u67e5\u8be2\u7684\u6570\u636e\u662f\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\u67e5\u8be2\u5230\uff0c\u8fd9\u65f6\u5c31\u4e0d\u7528\u518d\u67e5\u4e3b\u952e\u7d22\u5f15\u67e5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a select id from product where product_no = '0002' ; \u8fd9\u79cd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u5c31\u80fd\u67e5\u8be2\u5230\u7ed3\u679c\u7684\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u8986\u76d6\u7d22\u5f15\u300d\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u67e5\u4e00\u4e2a B+Tree \u5c31\u80fd\u627e\u5230\u6570\u636e \u3002 \u4e3a\u4ec0\u4e48 MySQL InnoDB \u9009\u62e9 B+tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff1f \u00b6 \u524d\u9762\u5df2\u7ecf\u8bb2\u4e86 B+Tree \u7684\u7d22\u5f15\u539f\u7406\uff0c\u73b0\u5728\u5c31\u6765\u56de\u7b54\u4e00\u4e0b B+Tree \u76f8\u6bd4\u4e8e B \u6811\u3001\u4e8c\u53c9\u6811\u6216 Hash \u7d22\u5f15\u7ed3\u6784\u7684\u4f18\u52bf\u5728\u54ea\u513f\uff1f \u4e4b\u524d\u6211\u4e5f\u4e13\u95e8\u5199\u8fc7\u4e00\u7bc7\u6587\u7ae0\uff0c\u60f3\u8be6\u7ec6\u4e86\u89e3\u7684\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u300c \u5973\u670b\u53cb\u95ee\u6211\uff1a\u4e3a\u4ec0\u4e48 MySQL \u559c\u6b22 B+ \u6811\uff1f\u6211\u7b11\u7740\u753b\u4e86 20 \u5f20\u56fe \u300d\uff0c\u8fd9\u91cc\u5c31\u7b80\u5355\u505a\u4e2a\u6bd4\u5bf9\u3002 1\u3001B+Tree vs B Tree B+Tree \u53ea\u5728\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u6570\u636e\uff0c\u800c B \u6811 \u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e5f\u8981\u5b58\u50a8\u6570\u636e\uff0c\u6240\u4ee5 B+Tree \u7684\u5355\u4e2a\u8282\u70b9\u7684\u6570\u636e\u91cf\u66f4\u5c0f\uff0c\u5728\u76f8\u540c\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4e0b\uff0c\u5c31\u80fd\u67e5\u8be2\u66f4\u591a\u7684\u8282\u70b9\u3002 \u53e6\u5916\uff0cB+Tree \u53f6\u5b50\u8282\u70b9\u91c7\u7528\u7684\u662f\u53cc\u94fe\u8868\u8fde\u63a5\uff0c\u9002\u5408 MySQL \u4e2d\u5e38\u89c1\u7684\u57fa\u4e8e\u8303\u56f4\u7684\u987a\u5e8f\u67e5\u627e\uff0c\u800c B \u6811\u65e0\u6cd5\u505a\u5230\u8fd9\u4e00\u70b9\u3002 2\u3001B+Tree vs \u4e8c\u53c9\u6811 \u5bf9\u4e8e\u6709 N \u4e2a\u53f6\u5b50\u8282\u70b9\u7684 B+Tree\uff0c\u5176\u641c\u7d22\u590d\u6742\u5ea6\u4e3a O(logdN) \uff0c\u5176\u4e2d d \u8868\u793a\u8282\u70b9\u5141\u8bb8\u7684\u6700\u5927\u5b50\u8282\u70b9\u4e2a\u6570\u4e3a d \u4e2a\u3002 \u5728\u5b9e\u9645\u7684\u5e94\u7528\u5f53\u4e2d\uff0c d \u503c\u662f\u5927\u4e8e100\u7684\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\uff0c\u5373\u4f7f\u6570\u636e\u8fbe\u5230\u5343\u4e07\u7ea7\u522b\u65f6\uff0cB+Tree \u7684\u9ad8\u5ea6\u4f9d\u7136\u7ef4\u6301\u5728 3~4 \u5c42\u5de6\u53f3\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u6b21\u6570\u636e\u67e5\u8be2\u64cd\u4f5c\u53ea\u9700\u8981\u505a 3~4 \u6b21\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\u5c31\u80fd\u67e5\u8be2\u5230\u76ee\u6807\u6570\u636e\u3002 \u800c\u4e8c\u53c9\u6811\u7684\u6bcf\u4e2a\u7236\u8282\u70b9\u7684\u513f\u5b50\u8282\u70b9\u4e2a\u6570\u53ea\u80fd\u662f 2 \u4e2a\uff0c\u610f\u5473\u7740\u5176\u641c\u7d22\u590d\u6742\u5ea6\u4e3a O(logN) \uff0c\u8fd9\u5df2\u7ecf\u6bd4 B+Tree \u9ad8\u51fa\u4e0d\u5c11\uff0c\u56e0\u6b64\u4e8c\u53c9\u6811\u68c0\u7d22\u5230\u76ee\u6807\u6570\u636e\u6240\u7ecf\u5386\u7684\u78c1\u76d8 I/O \u6b21\u6570\u8981\u66f4\u591a\u3002 3\u3001B+Tree vs Hash Hash \u5728\u505a\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\u6548\u7387\u8d3c\u5feb\uff0c\u641c\u7d22\u590d\u6742\u5ea6\u4e3a O(1)\u3002 \u4f46\u662f Hash \u8868\u4e0d\u9002\u5408\u505a\u8303\u56f4\u67e5\u8be2\uff0c\u5b83\u66f4\u9002\u5408\u505a\u7b49\u503c\u7684\u67e5\u8be2\uff0c\u8fd9\u4e5f\u662f B+Tree \u7d22\u5f15\u8981\u6bd4 Hash \u8868\u7d22\u5f15\u6709\u7740\u66f4\u5e7f\u6cdb\u7684\u9002\u7528\u573a\u666f\u7684\u539f\u56e0\u3002 \u6309\u7269\u7406\u5b58\u50a8\u5206\u7c7b \u00b6 \u4ece\u7269\u7406\u5b58\u50a8\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u3001\u4e8c\u7ea7\u7d22\u5f15\uff08\u8f85\u52a9\u7d22\u5f15\uff09\u3002 \u8fd9\u4e24\u4e2a\u533a\u522b\u5728\u524d\u9762\u4e5f\u63d0\u5230\u4e86\uff1a \u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff1b \u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u6240\u4ee5\uff0c\u5728\u67e5\u8be2\u65f6\u4f7f\u7528\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\u67e5\u8be2\u7684\u5230\uff0c\u90a3\u4e48\u5c31\u4e0d\u9700\u8981\u56de\u8868\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u8986\u76d6\u7d22\u5f15\u3002\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\uff0c\u5c31\u4f1a\u5148\u68c0\u7d22\u4e8c\u7ea7\u7d22\u5f15\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u83b7\u53d6\u5230\u4e3b\u952e\u503c\u540e\uff0c\u7136\u540e\u518d\u68c0\u7d22\u4e3b\u952e\u7d22\u5f15\uff0c\u5c31\u80fd\u67e5\u8be2\u5230\u6570\u636e\u4e86\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u56de\u8868\u3002 \u6309\u5b57\u6bb5\u7279\u6027\u5206\u7c7b \u00b6 \u4ece\u5b57\u6bb5\u7279\u6027\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u524d\u7f00\u7d22\u5f15\u3002 \u4e3b\u952e\u7d22\u5f15 \u00b6 \u4e3b\u952e\u7d22\u5f15\u5c31\u662f\u5efa\u7acb\u5728\u4e3b\u952e\u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u901a\u5e38\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u4e00\u8d77\u521b\u5efa\uff0c\u4e00\u5f20\u8868\u6700\u591a\u53ea\u6709\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u7684\u503c\u4e0d\u5141\u8bb8\u6709\u7a7a\u503c\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( .... PRIMARY KEY ( index_column_1 ) USING BTREE ); \u552f\u4e00\u7d22\u5f15 \u00b6 \u552f\u4e00\u7d22\u5f15\u5efa\u7acb\u5728 UNIQUE \u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u4e00\u5f20\u8868\u53ef\u4ee5\u6709\u591a\u4e2a\u552f\u4e00\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u7684\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u4f46\u662f\u5141\u8bb8\u6709\u7a7a\u503c\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u552f\u4e00\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( .... UNIQUE KEY ( index_column_1 , index_column_2 ,...) ); \u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u552f\u4e00\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a CREATE UNIQUE INDEX index_name ON table_name ( index_column_1 , index_column_2 ,...); \u666e\u901a\u7d22\u5f15 \u00b6 \u666e\u901a\u7d22\u5f15\u5c31\u662f\u5efa\u7acb\u5728\u666e\u901a\u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u65e2\u4e0d\u8981\u6c42\u5b57\u6bb5\u4e3a\u4e3b\u952e\uff0c\u4e5f\u4e0d\u8981\u6c42\u5b57\u6bb5\u4e3a UNIQUE\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u666e\u901a\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( .... INDEX ( index_column_1 , index_column_2 ,...) ); \u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u666e\u901a\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a CREATE INDEX index_name ON table_name ( index_column_1 , index_column_2 ,...); \u524d\u7f00\u7d22\u5f15 \u00b6 \u524d\u7f00\u7d22\u5f15\u662f\u6307\u5bf9\u5b57\u7b26\u7c7b\u578b\u5b57\u6bb5\u7684\u524d\u51e0\u4e2a\u5b57\u7b26\u5efa\u7acb\u7684\u7d22\u5f15\uff0c\u800c\u4e0d\u662f\u5728\u6574\u4e2a\u5b57\u6bb5\u4e0a\u5efa\u7acb\u7684\u7d22\u5f15\uff0c\u524d\u7f00\u7d22\u5f15\u53ef\u4ee5\u5efa\u7acb\u5728\u5b57\u6bb5\u7c7b\u578b\u4e3a char\u3001 varchar\u3001binary\u3001varbinary \u7684\u5217\u4e0a\u3002 \u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u7d22\u5f15\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u63d0\u5347\u67e5\u8be2\u6548\u7387\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u524d\u7f00\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( column_list , INDEX ( column_name ( length )) ); \u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u524d\u7f00\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a CREATE INDEX index_name ON table_name ( column_name ( length )); \u6309\u5b57\u6bb5\u4e2a\u6570\u5206\u7c7b \u00b6 \u4ece\u5b57\u6bb5\u4e2a\u6570\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u5355\u5217\u7d22\u5f15\u3001\u8054\u5408\u7d22\u5f15\uff08\u590d\u5408\u7d22\u5f15\uff09\u3002 \u5efa\u7acb\u5728\u5355\u5217\u4e0a\u7684\u7d22\u5f15\u79f0\u4e3a\u5355\u5217\u7d22\u5f15\uff0c\u6bd4\u5982\u4e3b\u952e\u7d22\u5f15\uff1b \u5efa\u7acb\u5728\u591a\u5217\u4e0a\u7684\u7d22\u5f15\u79f0\u4e3a\u8054\u5408\u7d22\u5f15\uff1b \u8054\u5408\u7d22\u5f15 \u00b6 \u901a\u8fc7\u5c06\u591a\u4e2a\u5b57\u6bb5\u7ec4\u5408\u6210\u4e00\u4e2a\u7d22\u5f15\uff0c\u8be5\u7d22\u5f15\u5c31\u88ab\u79f0\u4e3a\u8054\u5408\u7d22\u5f15\u3002 \u6bd4\u5982\uff0c\u5c06\u5546\u54c1\u8868\u4e2d\u7684 product_no \u548c name \u5b57\u6bb5\u7ec4\u5408\u6210\u8054\u5408\u7d22\u5f15 (product_no, name) \uff0c\u521b\u5efa\u8054\u5408\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE INDEX index_product_no_name ON product ( product_no , name ); \u8054\u5408\u7d22\u5f15 (product_no, name) \u7684 B+Tree \u793a\u610f\u56fe\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u8054\u5408\u7d22\u5f15\u7684\u975e\u53f6\u5b50\u8282\u70b9\u7528\u4e24\u4e2a\u5b57\u6bb5\u7684\u503c\u4f5c\u4e3a B+Tree \u7684 key \u503c\u3002\u5f53\u5728\u8054\u5408\u7d22\u5f15\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u5148\u6309 product_no \u5b57\u6bb5\u6bd4\u8f83\uff0c\u5728 product_no \u76f8\u540c\u7684\u60c5\u51b5\u4e0b\u518d\u6309 name \u5b57\u6bb5\u6bd4\u8f83\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u8054\u5408\u7d22\u5f15\u67e5\u8be2\u7684 B+Tree \u662f\u5148\u6309 product_no \u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u518d product_no \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 name \u5b57\u6bb5\u6392\u5e8f\u3002 \u56e0\u6b64\uff0c\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u5b58\u5728**\u6700\u5de6\u5339\u914d\u539f\u5219**\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\u3002\u5728\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u9075\u5faa\u300c\u6700\u5de6\u5339\u914d\u539f\u5219\u300d\uff0c\u8054\u5408\u7d22\u5f15\u4f1a\u5931\u6548\uff0c\u8fd9\u6837\u5c31\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15\u5feb\u901f\u67e5\u8be2\u7684\u7279\u6027\u4e86\u3002 \u6bd4\u5982\uff0c\u5982\u679c\u521b\u5efa\u4e86\u4e00\u4e2a (a, b, c) \u8054\u5408\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u5c31\u53ef\u4ee5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff1a where a=1\uff1b where a=1 and b=2 and c=3\uff1b where a=1 and b=2\uff1b \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u6709\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u6240\u4ee5 a \u5b57\u6bb5\u5728 where \u5b50\u53e5\u7684\u987a\u5e8f\u5e76\u4e0d\u91cd\u8981\u3002 \u4f46\u662f\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u56e0\u4e3a\u4e0d\u7b26\u5408\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff0c\u8054\u5408\u7d22\u5f15\u5c31\u4f1a\u5931\u6548: where b=2\uff1b where c=3\uff1b where b=2 and c=3\uff1b \u4e0a\u9762\u8fd9\u4e9b\u67e5\u8be2\u6761\u4ef6\u4e4b\u6240\u4ee5\u4f1a\u5931\u6548\uff0c\u662f\u56e0\u4e3a (a, b, c) \u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309 a \u6392\u5e8f\uff0c\u5728 a \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 b \u6392\u5e8f\uff0c\u5728 b \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 c \u6392\u5e8f\u3002\u6240\u4ee5\uff0c b \u548c c \u662f\u5168\u5c40\u65e0\u5e8f\uff0c\u5c40\u90e8\u76f8\u5bf9\u6709\u5e8f\u7684 \uff0c\u8fd9\u6837\u5728\u6ca1\u6709\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\u7684\u60c5\u51b5\u4e0b\uff0c\u662f\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15\u7684\u3002 \u6211\u8fd9\u91cc\u4e3e\u8054\u5408\u7d22\u5f15\uff08a\uff0cb\uff09\u7684\u4f8b\u5b50\uff0c\u8be5\u8054\u5408\u7d22\u5f15\u7684 B+ Tree \u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0ca \u662f\u5168\u5c40\u6709\u5e8f\u7684\uff081, 2, 2, 3, 4, 5, 6, 7 ,8\uff09\uff0c\u800c b \u662f\u5168\u5c40\u662f\u65e0\u5e8f\u7684\uff0812\uff0c7\uff0c8\uff0c2\uff0c3\uff0c8\uff0c10\uff0c5\uff0c2\uff09\u3002\u56e0\u6b64\uff0c\u76f4\u63a5\u6267\u884c where b = 2 \u8fd9\u79cd\u67e5\u8be2\u6761\u4ef6\u6ca1\u6709\u529e\u6cd5\u5229\u7528\u8054\u5408\u7d22\u5f15\u7684\uff0c \u5229\u7528\u7d22\u5f15\u7684\u524d\u63d0\u662f\u7d22\u5f15\u91cc\u7684 key \u662f\u6709\u5e8f\u7684 \u3002 \u53ea\u6709\u5728 a \u76f8\u540c\u7684\u60c5\u51b5\u624d\uff0cb \u624d\u662f\u6709\u5e8f\u7684\uff0c\u6bd4\u5982 a \u7b49\u4e8e 2 \u7684\u65f6\u5019\uff0cb \u7684\u503c\u4e3a\uff087\uff0c8\uff09\uff0c\u8fd9\u65f6\u5c31\u662f\u6709\u5e8f\u7684\uff0c\u8fd9\u4e2a\u6709\u5e8f\u72b6\u6001\u662f\u5c40\u90e8\u7684\uff0c\u56e0\u6b64\uff0c\u6267\u884c where a = 2 and b = 7 \u662f a \u548c b \u5b57\u6bb5\u80fd\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684\uff0c\u4e5f\u5c31\u662f\u8054\u5408\u7d22\u5f15\u751f\u6548\u4e86\u3002 \u8054\u5408\u7d22\u5f15\u8303\u56f4\u67e5\u8be2 \u00b6 \u8054\u5408\u7d22\u5f15\u6709\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\uff0c \u5e76\u4e0d\u662f\u67e5\u8be2\u8fc7\u7a0b\u4f7f\u7528\u4e86\u8054\u5408\u7d22\u5f15\u67e5\u8be2\uff0c\u5c31\u4ee3\u8868\u8054\u5408\u7d22\u5f15\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u5b58\u5728\u90e8\u5206\u5b57\u6bb5\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff0c\u90e8\u5206\u5b57\u6bb5\u6ca1\u6709\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u7684\u60c5\u51b5\u3002 \u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u5c31\u53d1\u751f\u5728\u8303\u56f4\u67e5\u8be2\u3002\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u4f1a\u4e00\u76f4\u5411\u53f3\u5339\u914d\u76f4\u5230\u9047\u5230\u300c\u8303\u56f4\u67e5\u8be2\u300d\u5c31\u4f1a\u505c\u6b62\u5339\u914d\u3002 \u4e5f\u5c31\u662f\u8303\u56f4\u67e5\u8be2\u7684\u5b57\u6bb5\u53ef\u4ee5\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u5728\u8303\u56f4\u67e5\u8be2\u5b57\u6bb5\u7684\u540e\u9762\u7684\u5b57\u6bb5\u65e0\u6cd5\u7528\u5230\u8054\u5408\u7d22\u5f15 \u3002 \u8303\u56f4\u67e5\u8be2\u6709\u5f88\u591a\u79cd\uff0c\u90a3\u5230\u5e95\u662f\u54ea\u4e9b\u8303\u56f4\u67e5\u8be2\u4f1a\u5bfc\u81f4\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u4f1a\u505c\u6b62\u5339\u914d\u5462\uff1f \u63a5\u4e0b\u6765\uff0c\u4e3e\u4f8b\u51e0\u4e2a\u8303\u56f4\u67e5\u4f8b\u5b50\u3002 Q1: select * from t_table where a > 1 and b = 2 \uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f \u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u7b26\u5408 a > 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u80af\u5b9a\u662f\u76f8\u90bb\uff0c\u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408 a > 1 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u4e0d\u7b26\u5408 a > 1 \u6761\u4ef6\u4f4d\u7f6e\u3002\u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u4f46\u662f\u5728\u7b26\u5408 a > 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u65e0\u5e8f\u7684 \u3002\u6bd4\u5982\u524d\u9762\u56fe\u7684\u8054\u5408\u7d22\u5f15\u7684 B+ Tree \u91cc\uff0c\u4e0b\u9762\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684 a \u5b57\u6bb5\u7684\u503c\u90fd\u7b26\u5408 a > 1 \u67e5\u8be2\u6761\u4ef6\uff0c\u800c b \u5b57\u6bb5\u7684\u503c\u662f\u65e0\u5e8f\u7684\uff1a a \u5b57\u6bb5\u503c\u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 8\uff1b a \u5b57\u6bb5\u503c\u4e3a 6 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 10\uff1b a \u5b57\u6bb5\u503c\u4e3a 7 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 5\uff1b \u56e0\u6b64\uff0c\u6211\u4eec\u4e0d\u80fd\u6839\u636e\u67e5\u8be2\u6761\u4ef6 b = 2 \u6765\u8fdb\u4e00\u6b65\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u8bb0\u5f55\u6570\u91cf\uff08b \u5b57\u6bb5\u65e0\u6cd5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002 \u6240\u4ee5\u5728\u6267\u884c Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u7684\u626b\u63cf\u533a\u95f4\u662f (2, + \u221e)\uff0c\u5f62\u6210\u8be5\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\u662f a > 1\uff0c\u4e0e b = 2 \u65e0\u5173\u3002 \u56e0\u6b64\uff0c Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u53ea\u6709 a \u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u800c b \u5b57\u6bb5\u5e76\u6ca1\u6709\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\uff0c\u5728\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u901a\u8fc7 key_len \u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4f18\u5316\u5668\u5177\u4f53\u4f7f\u7528\u4e86\u591a\u5c11\u4e2a\u5b57\u6bb5\u7684\u641c\u7d22\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\u3002 \u4e3e\u4f8b\u4e2a\u4f8b\u5b50 \uff0ca \u548c b \u90fd\u662f int \u7c7b\u578b\u4e14\u4e0d\u4e3a NULL \u7684\u5b57\u6bb5\uff0c\u90a3\u4e48 Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 4 \u5b57\u8282\uff08\u5982\u679c\u5b57\u6bb5\u5141\u8bb8\u4e3a NULL\uff0c\u5c31\u5728\u5b57\u6bb5\u7c7b\u578b\u5360\u7528\u7684\u5b57\u8282\u6570\u4e0a\u52a0 1\uff0c\u4e5f\u5c31\u662f 5 \u5b57\u8282\uff09\uff0c\u8bf4\u660e\u53ea\u6709 a \u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u800c\u4e14\u53ef\u4ee5\u770b\u5230\uff0c\u5373\u4f7f b \u5b57\u6bb5\u6ca1\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0ckey \u4e3a idx_a_b\uff0c\u8bf4\u660e Q1 \u67e5\u8be2\u8bed\u53e5\u4f7f\u7528\u4e86 idx_a_b \u8054\u5408\u7d22\u5f15\u3002 \u901a\u8fc7 Q1 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0ca \u5b57\u6bb5\u4f7f\u7528\u4e86 > \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 >\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0c\u56e0\u6b64 b \u5b57\u6bb5\u5e76\u6ca1\u6709\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002 Q2: select * from t_table where a >= 1 and b = 2 \uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f Q2 \u548c Q1 \u7684\u67e5\u8be2\u8bed\u53e5\u5f88\u50cf\uff0c\u552f\u4e00\u7684\u533a\u522b\u5c31\u662f a \u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u3002 \u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u7b26\u5408 >= 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u80af\u5b9a\u662f\u76f8\u90bb\uff0c\u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408 >= 1 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u4e0d\u7b26\u5408 a>= 1 \u6761\u4ef6\u4f4d\u7f6e\u3002\u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u867d\u7136\u5728\u7b26\u5408 a>= 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u300c\u65e0\u5e8f\u300d\u7684\uff0c \u4f46\u662f\u5bf9\u4e8e\u7b26\u5408 a = 1 \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u300c\u6709\u5e8f\u300d\u7684 \uff08\u56e0\u4e3a\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\uff0c\u7136\u540e\u5728 a \u5b57\u6bb5\u7684\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u518d\u6309\u7167 b \u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6392\u5e8f\uff09\u3002 \u4e8e\u662f\uff0c\u5728\u786e\u5b9a\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u7684\u8303\u56f4\u65f6\uff0c\u5f53\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684 a \u5b57\u6bb5\u503c\u4e3a 1 \u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 b = 2 \u6761\u4ef6\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u8303\u56f4\uff08b \u5b57\u6bb5\u53ef\u4ee5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u7b26\u5408 a = 1 and b = 2 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf\uff0c\u800c\u4e0d\u9700\u8981\u4ece\u7b2c\u4e00\u4e2a a \u5b57\u6bb5\u503c\u4e3a 1 \u7684\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf\u3002 \u6240\u4ee5\uff0c Q2 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 8 \u5b57\u8282\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u901a\u8fc7 Q2 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 a \u5b57\u6bb5\u4f7f\u7528\u4e86 >= \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 >=\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cb \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002 Q3: SELECT * FROM t_table WHERE a BETWEEN 2 AND 8 AND b = 2 \uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f Q3 \u67e5\u8be2\u6761\u4ef6\u4e2d a BETWEEN 2 AND 8 \u7684\u610f\u601d\u662f\u67e5\u8be2 a \u5b57\u6bb5\u7684\u503c\u5728 2 \u548c 8 \u4e4b\u95f4\u7684\u8bb0\u5f55\u3002\u4e0d\u540c\u7684\u6570\u636e\u5e93\u5bf9 BETWEEN ... AND \u5904\u7406\u65b9\u5f0f\u662f\u6709\u5dee\u5f02\u7684\u3002\u5728 MySQL \u4e2d\uff0cBETWEEN \u5305\u542b\u4e86 value1 \u548c value2 \u8fb9\u754c\u503c\uff0c\u7c7b\u4f3c\u4e8e >= and =<\u3002\u800c\u6709\u7684\u6570\u636e\u5e93\u5219\u4e0d\u5305\u542b value1 \u548c value2 \u8fb9\u754c\u503c\uff08\u7c7b\u4f3c\u4e8e > and <\uff09\u3002 \u8fd9\u91cc\u6211\u4eec\u53ea\u8ba8\u8bba MySQL\u3002\u7531\u4e8e MySQL \u7684 BETWEEN \u5305\u542b value1 \u548c value2 \u8fb9\u754c\u503c\uff0c\u6240\u4ee5\u7c7b\u4f3c\u4e8e Q2 \u67e5\u8be2\u8bed\u53e5\uff0c\u56e0\u6b64 Q3 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 8 \u5b57\u8282\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u901a\u8fc7 Q3 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 a \u5b57\u6bb5\u4f7f\u7528\u4e86 BETWEEN \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 BETWEEN\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cb \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002 Q4: SELECT * FROM t_user WHERE name like 'j%' and age = 22 \uff0c\u8054\u5408\u7d22\u5f15\uff08name, age\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f \u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 name \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u524d\u7f00\u4e3a \u2018j\u2019 \u7684 name \u5b57\u6bb5\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u90fd\u662f\u76f8\u90bb\u7684\uff0c \u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408\u524d\u7f00\u4e3a \u2018j\u2019 \u7684 name \u5b57\u6bb5\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u7684 name \u524d\u7f00\u4e0d\u4e3a \u2018j\u2019 \u4e3a\u6b62\u3002 \u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u5f62\u6210\u7684\u626b\u63cf\u533a\u95f4\u662f['j','k')\u3002\u6ce8\u610f\uff0c j \u662f\u95ed\u533a\u95f4\u3002\u5982\u4e0b\u56fe\uff1a \u867d\u7136\u5728\u7b26\u5408\u524d\u7f00\u4e3a \u2018j\u2019 \u7684 name \u5b57\u6bb5\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cage \u5b57\u6bb5\u7684\u503c\u662f\u300c\u65e0\u5e8f\u300d\u7684\uff0c \u4f46\u662f\u5bf9\u4e8e\u7b26\u5408 name = j \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cage\u5b57\u6bb5\u7684\u503c\u662f\u300c\u6709\u5e8f\u300d\u7684 \uff08\u56e0\u4e3a\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309\u7167 name \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\uff0c\u7136\u540e\u5728 name \u5b57\u6bb5\u7684\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u518d\u6309\u7167 age \u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6392\u5e8f\uff09\u3002 \u4e8e\u662f\uff0c\u5728\u786e\u5b9a\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u7684\u8303\u56f4\u65f6\uff0c\u5f53\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684 name \u5b57\u6bb5\u503c\u4e3a \u2018j\u2019 \u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 age = 22 \u6761\u4ef6\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u8303\u56f4\uff08age \u5b57\u6bb5\u53ef\u4ee5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u7b26\u5408 name = 'j' and age = 22 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u65f6\u5f00\u59cb\u626b\u63cf\uff0c\u800c\u4e0d\u9700\u8981\u4ece\u7b2c\u4e00\u4e2a name \u4e3a j \u7684\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf \u3002\u5982\u4e0b\u56fe\u7684\u53f3\u8fb9\uff1a \u6240\u4ee5\uff0c Q4 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u672c\u6b21\u4f8b\u5b50\u4e2d\uff1a name \u5b57\u6bb5\u7684\u7c7b\u578b\u662f varchar(30) \u4e14\u4e0d\u4e3a NULL\uff0c\u6570\u636e\u5e93\u8868\u4f7f\u7528\u4e86 utf8mb4 \u5b57\u7b26\u96c6\uff0c\u4e00\u4e2a\u5b57\u7b26\u96c6\u4e3a utf8mb4 \u7684\u5b57\u7b26\u662f 4 \u4e2a\u5b57\u8282\uff0c\u56e0\u6b64 name \u5b57\u6bb5\u7684\u5b9e\u9645\u6570\u636e\u6700\u591a\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u957f\u5ea6\u662f 120 \u5b57\u8282\uff0830 x 4\uff09\uff0c\u7136\u540e\u56e0\u4e3a name \u662f\u53d8\u957f\u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u9700\u8981\u518d\u52a0 2\uff0c\u4e5f\u5c31\u662f name \u7684 key_len \u4e3a 122\u3002 age \u5b57\u6bb5\u7684\u7c7b\u578b\u662f int \u4e14\u4e0d\u4e3a NULL\uff0ckey_len \u4e3a 4\u3002 Q4 \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 126 \u5b57\u8282\uff0cname \u7684 key_len \u4e3a 122\uff0cage \u7684 key_len \u4e3a 4\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f name \u548c age \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u901a\u8fc7 Q4 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 name \u5b57\u6bb5\u4f7f\u7528\u4e86 like \u524d\u7f00\u5339\u914d\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 name \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 like 'j%'\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cage \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002 \u7efc\u4e0a\u6240\u793a\uff0c \u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u5728\u9047\u5230\u8303\u56f4\u67e5\u8be2\uff08\u5982 >\u3001<\uff09\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u4e5f\u5c31\u662f\u8303\u56f4\u67e5\u8be2\u7684\u5b57\u6bb5\u53ef\u4ee5\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u5728\u8303\u56f4\u67e5\u8be2\u5b57\u6bb5\u7684\u540e\u9762\u7684\u5b57\u6bb5\u65e0\u6cd5\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002\u6ce8\u610f\uff0c\u5bf9\u4e8e >=\u3001<=\u3001BETWEEN\u3001like \u524d\u7f00\u5339\u914d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u5e76\u4e0d\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u524d\u9762\u6211\u4e5f\u7528\u4e86\u56db\u4e2a\u4f8b\u5b50\u8bf4\u660e\u4e86 \u3002 \u7d22\u5f15\u4e0b\u63a8 \u00b6 \u73b0\u5728\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\uff0c\u5728\u6267\u884c select * from table where a > 1 and b = 2 \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u53ea\u6709 a \u5b57\u6bb5\u80fd\u7528\u5230\u7d22\u5f15\uff0c\u90a3\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u627e\u5230\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u4e3b\u952e\u503c\uff08ID \u4e3a 2\uff09\u540e\uff0c\u8fd8\u9700\u8981\u5224\u65ad\u5176\u4ed6\u6761\u4ef6\u662f\u5426\u6ee1\u8db3\uff08\u770b b \u662f\u5426\u7b49\u4e8e 2\uff09\uff0c\u90a3\u662f\u5728\u8054\u5408\u7d22\u5f15\u91cc\u5224\u65ad\uff1f\u8fd8\u662f\u56de\u4e3b\u952e\u7d22\u5f15\u53bb\u5224\u65ad\u5462\uff1f \u5728 MySQL 5.6 \u4e4b\u524d\uff0c\u53ea\u80fd\u4ece ID2 \uff08\u4e3b\u952e\u503c\uff09\u5f00\u59cb\u4e00\u4e2a\u4e2a\u56de\u8868\uff0c\u5230\u300c\u4e3b\u952e\u7d22\u5f15\u300d\u4e0a\u627e\u51fa\u6570\u636e\u884c\uff0c\u518d\u5bf9\u6bd4 b \u5b57\u6bb5\u503c\u3002 \u800c MySQL 5.6 \u5f15\u5165\u7684**\u7d22\u5f15\u4e0b\u63a8\u4f18\u5316**\uff08index condition pushdown)\uff0c \u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u8054\u5408\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5b57\u6bb5\u5148\u505a\u5224\u65ad\uff0c\u76f4\u63a5\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570 \u3002 \u5f53\u4f60\u7684\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u91cc\uff0c\u51fa\u73b0\u4e86 Extra \u4e3a Using index condition \uff0c\u90a3\u4e48\u8bf4\u660e\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u7684\u4f18\u5316\u3002 \u7d22\u5f15\u533a\u5206\u5ea6 \u00b6 \u53e6\u5916\uff0c\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u65f6\u7684\u5b57\u6bb5\u987a\u5e8f\uff0c\u5bf9\u7d22\u5f15\u6548\u7387\u4e5f\u6709\u5f88\u5927\u5f71\u54cd\u3002\u8d8a\u9760\u524d\u7684\u5b57\u6bb5\u88ab\u7528\u4e8e\u7d22\u5f15\u8fc7\u6ee4\u7684\u6982\u7387\u8d8a\u9ad8\uff0c\u5b9e\u9645\u5f00\u53d1\u5de5\u4f5c\u4e2d**\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u8981\u628a\u533a\u5206\u5ea6\u5927\u7684\u5b57\u6bb5\u6392\u5728\u524d\u9762\uff0c\u8fd9\u6837\u533a\u5206\u5ea6\u5927\u7684\u5b57\u6bb5\u8d8a\u6709\u53ef\u80fd\u88ab\u66f4\u591a\u7684 SQL \u4f7f\u7528\u5230**\u3002 \u533a\u5206\u5ea6\u5c31\u662f\u67d0\u4e2a\u5b57\u6bb5 column \u4e0d\u540c\u503c\u7684\u4e2a\u6570\u300c\u9664\u4ee5\u300d\u8868\u7684\u603b\u884c\u6570\uff0c\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a \u6bd4\u5982\uff0c\u6027\u522b\u7684\u533a\u5206\u5ea6\u5c31\u5f88\u5c0f\uff0c\u4e0d\u9002\u5408\u5efa\u7acb\u7d22\u5f15\u6216\u4e0d\u9002\u5408\u6392\u5728\u8054\u5408\u7d22\u5f15\u5217\u7684\u9760\u524d\u7684\u4f4d\u7f6e\uff0c\u800c UUID \u8fd9\u7c7b\u5b57\u6bb5\u5c31\u6bd4\u8f83\u9002\u5408\u505a\u7d22\u5f15\u6216\u6392\u5728\u8054\u5408\u7d22\u5f15\u5217\u7684\u9760\u524d\u7684\u4f4d\u7f6e\u3002 \u56e0\u4e3a\u5982\u679c\u7d22\u5f15\u7684\u533a\u5206\u5ea6\u5f88\u5c0f\uff0c\u5047\u8bbe\u5b57\u6bb5\u7684\u503c\u5206\u5e03\u5747\u5300\uff0c\u90a3\u4e48\u65e0\u8bba\u641c\u7d22\u54ea\u4e2a\u503c\u90fd\u53ef\u80fd\u5f97\u5230\u4e00\u534a\u7684\u6570\u636e\u3002\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd8\u4e0d\u5982\u4e0d\u8981\u7d22\u5f15\uff0c\u56e0\u4e3a MySQL \u8fd8\u6709\u4e00\u4e2a\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u53d1\u73b0\u67d0\u4e2a\u503c\u51fa\u73b0\u5728\u8868\u7684\u6570\u636e\u884c\u4e2d\u7684\u767e\u5206\u6bd4\uff08\u60ef\u7528\u7684\u767e\u5206\u6bd4\u754c\u7ebf\u662f\"30%\"\uff09\u5f88\u9ad8\u7684\u65f6\u5019\uff0c\u5b83\u4e00\u822c\u4f1a\u5ffd\u7565\u7d22\u5f15\uff0c\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002 \u8054\u5408\u7d22\u5f15\u8fdb\u884c\u6392\u5e8f \u00b6 \u8fd9\u91cc\u51fa\u4e00\u4e2a\u9898\u76ee\uff0c\u9488\u5bf9\u9488\u5bf9\u4e0b\u9762\u8fd9\u6761 SQL\uff0c\u4f60\u600e\u4e48\u901a\u8fc7\u7d22\u5f15\u6765\u63d0\u9ad8\u67e5\u8be2\u6548\u7387\u5462\uff1f select * from order where status = 1 order by create_time asc \u6709\u7684\u540c\u5b66\u4f1a\u8ba4\u4e3a\uff0c\u5355\u72ec\u7ed9 status \u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\u5c31\u53ef\u4ee5\u4e86\u3002 \u4f46\u662f\u66f4\u597d\u7684\u65b9\u5f0f\u7ed9 status \u548c create_time \u5217\u5efa\u7acb\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\uff0c\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u907f\u514d MySQL \u6570\u636e\u5e93\u53d1\u751f\u6587\u4ef6\u6392\u5e8f\u3002 \u56e0\u4e3a\u5728\u67e5\u8be2\u65f6\uff0c\u5982\u679c\u53ea\u7528\u5230 status \u7684\u7d22\u5f15\uff0c\u4f46\u662f\u8fd9\u6761\u8bed\u53e5\u8fd8\u8981\u5bf9 create_time \u6392\u5e8f\uff0c\u8fd9\u65f6\u5c31\u8981\u7528\u6587\u4ef6\u6392\u5e8f filesort\uff0c\u4e5f\u5c31\u662f\u5728 SQL \u6267\u884c\u8ba1\u5212\u4e2d\uff0cExtra \u5217\u4f1a\u51fa\u73b0 Using filesort\u3002 \u6240\u4ee5\uff0c\u8981\u5229\u7528\u7d22\u5f15\u7684\u6709\u5e8f\u6027\uff0c\u5728 status \u548c create_time \u5217\u5efa\u7acb\u8054\u5408\u7d22\u5f15\uff0c\u8fd9\u6837\u6839\u636e status \u7b5b\u9009\u540e\u7684\u6570\u636e\u5c31\u662f\u6309\u7167 create_time \u6392\u597d\u5e8f\u7684\uff0c\u907f\u514d\u5728\u6587\u4ef6\u6392\u5e8f\uff0c\u63d0\u9ad8\u4e86\u67e5\u8be2\u6548\u7387\u3002 \u4ec0\u4e48\u65f6\u5019\u9700\u8981 / \u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f \u00b6 \u7d22\u5f15\u6700\u5927\u7684\u597d\u5904\u662f\u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\uff0c\u4f46\u662f\u7d22\u5f15\u4e5f\u662f\u6709\u7f3a\u70b9\u7684\uff0c\u6bd4\u5982\uff1a \u9700\u8981\u5360\u7528\u7269\u7406\u7a7a\u95f4\uff0c\u6570\u91cf\u8d8a\u5927\uff0c\u5360\u7528\u7a7a\u95f4\u8d8a\u5927\uff1b \u521b\u5efa\u7d22\u5f15\u548c\u7ef4\u62a4\u7d22\u5f15\u8981\u8017\u8d39\u65f6\u95f4\uff0c\u8fd9\u79cd\u65f6\u95f4\u968f\u7740\u6570\u636e\u91cf\u7684\u589e\u52a0\u800c\u589e\u5927\uff1b \u4f1a\u964d\u4f4e\u8868\u7684\u589e\u5220\u6539\u7684\u6548\u7387\uff0c\u56e0\u4e3a\u6bcf\u6b21\u589e\u5220\u6539\u7d22\u5f15\uff0cB+ \u6811\u4e3a\u4e86\u7ef4\u62a4\u7d22\u5f15\u6709\u5e8f\u6027\uff0c\u90fd\u9700\u8981\u8fdb\u884c\u52a8\u6001\u7ef4\u62a4\u3002 \u6240\u4ee5\uff0c\u7d22\u5f15\u4e0d\u662f\u4e07\u80fd\u94a5\u5319\uff0c\u5b83\u4e5f\u662f\u6839\u636e\u573a\u666f\u6765\u4f7f\u7528\u7684\u3002 \u4ec0\u4e48\u65f6\u5019\u9002\u7528\u7d22\u5f15\uff1f \u00b6 \u5b57\u6bb5\u6709\u552f\u4e00\u6027\u9650\u5236\u7684\uff0c\u6bd4\u5982\u5546\u54c1\u7f16\u7801\uff1b \u7ecf\u5e38\u7528\u4e8e WHERE \u67e5\u8be2\u6761\u4ef6\u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u80fd\u591f\u63d0\u9ad8\u6574\u4e2a\u8868\u7684\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e0d\u662f\u4e00\u4e2a\u5b57\u6bb5\uff0c\u53ef\u4ee5\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u3002 \u7ecf\u5e38\u7528\u4e8e GROUP BY \u548c ORDER BY \u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u5728\u67e5\u8be2\u7684\u65f6\u5019\u5c31\u4e0d\u9700\u8981\u518d\u53bb\u505a\u4e00\u6b21\u6392\u5e8f\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u90fd\u5df2\u7ecf\u77e5\u9053\u4e86\u5efa\u7acb\u7d22\u5f15\u4e4b\u540e\u5728 B+Tree \u4e2d\u7684\u8bb0\u5f55\u90fd\u662f\u6392\u5e8f\u597d\u7684\u3002 \u4ec0\u4e48\u65f6\u5019\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f \u00b6 WHERE \u6761\u4ef6\uff0c GROUP BY \uff0c ORDER BY \u91cc\u7528\u4e0d\u5230\u7684\u5b57\u6bb5\uff0c\u7d22\u5f15\u7684\u4ef7\u503c\u662f\u5feb\u901f\u5b9a\u4f4d\uff0c\u5982\u679c\u8d77\u4e0d\u5230\u5b9a\u4f4d\u7684\u5b57\u6bb5\u901a\u5e38\u662f\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\u7684\uff0c\u56e0\u4e3a\u7d22\u5f15\u662f\u4f1a\u5360\u7528\u7269\u7406\u7a7a\u95f4\u7684\u3002 \u5b57\u6bb5\u4e2d\u5b58\u5728\u5927\u91cf\u91cd\u590d\u6570\u636e\uff0c\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff0c\u6bd4\u5982\u6027\u522b\u5b57\u6bb5\uff0c\u53ea\u6709\u7537\u5973\uff0c\u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\uff0c\u7537\u5973\u7684\u8bb0\u5f55\u5206\u5e03\u5747\u5300\uff0c\u90a3\u4e48\u65e0\u8bba\u641c\u7d22\u54ea\u4e2a\u503c\u90fd\u53ef\u80fd\u5f97\u5230\u4e00\u534a\u7684\u6570\u636e\u3002\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd8\u4e0d\u5982\u4e0d\u8981\u7d22\u5f15\uff0c\u56e0\u4e3a MySQL \u8fd8\u6709\u4e00\u4e2a\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u53d1\u73b0\u67d0\u4e2a\u503c\u51fa\u73b0\u5728\u8868\u7684\u6570\u636e\u884c\u4e2d\u7684\u767e\u5206\u6bd4\u5f88\u9ad8\u7684\u65f6\u5019\uff0c\u5b83\u4e00\u822c\u4f1a\u5ffd\u7565\u7d22\u5f15\uff0c\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002 \u8868\u6570\u636e\u592a\u5c11\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1b \u7ecf\u5e38\u66f4\u65b0\u7684\u5b57\u6bb5\u4e0d\u7528\u521b\u5efa\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0d\u8981\u5bf9\u7535\u5546\u9879\u76ee\u7684\u7528\u6237\u4f59\u989d\u5efa\u7acb\u7d22\u5f15\uff0c\u56e0\u4e3a\u7d22\u5f15\u5b57\u6bb5\u9891\u7e41\u4fee\u6539\uff0c\u7531\u4e8e\u8981\u7ef4\u62a4 B+Tree\u7684\u6709\u5e8f\u6027\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u9891\u7e41\u7684\u91cd\u5efa\u7d22\u5f15\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u6027\u80fd\u7684\u3002 \u6709\u4ec0\u4e48\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1f \u00b6 \u8fd9\u91cc\u8bf4\u4e00\u4e0b\u51e0\u79cd\u5e38\u89c1\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1a \u524d\u7f00\u7d22\u5f15\u4f18\u5316\uff1b \u8986\u76d6\u7d22\u5f15\u4f18\u5316\uff1b \u4e3b\u952e\u7d22\u5f15\u6700\u597d\u662f\u81ea\u589e\u7684\uff1b \u9632\u6b62\u7d22\u5f15\u5931\u6548\uff1b \u524d\u7f00\u7d22\u5f15\u4f18\u5316 \u00b6 \u524d\u7f00\u7d22\u5f15\u987e\u540d\u601d\u4e49\u5c31\u662f\u4f7f\u7528\u67d0\u4e2a\u5b57\u6bb5\u4e2d\u5b57\u7b26\u4e32\u7684\u524d\u51e0\u4e2a\u5b57\u7b26\u5efa\u7acb\u7d22\u5f15\uff0c\u90a3\u6211\u4eec\u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528\u524d\u7f00\u6765\u5efa\u7acb\u7d22\u5f15\u5462\uff1f \u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u662f\u4e3a\u4e86\u51cf\u5c0f\u7d22\u5f15\u5b57\u6bb5\u5927\u5c0f\uff0c\u53ef\u4ee5\u589e\u52a0\u4e00\u4e2a\u7d22\u5f15\u9875\u4e2d\u5b58\u50a8\u7684\u7d22\u5f15\u503c\uff0c\u6709\u6548\u63d0\u9ad8\u7d22\u5f15\u7684\u67e5\u8be2\u901f\u5ea6\u3002\u5728\u4e00\u4e9b\u5927\u5b57\u7b26\u4e32\u7684\u5b57\u6bb5\u4f5c\u4e3a\u7d22\u5f15\u65f6\uff0c\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u51cf\u5c0f\u7d22\u5f15\u9879\u7684\u5927\u5c0f\u3002 \u4e0d\u8fc7\uff0c\u524d\u7f00\u7d22\u5f15\u6709\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u4f8b\u5982\uff1a order by \u5c31\u65e0\u6cd5\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\uff1b \u65e0\u6cd5\u628a\u524d\u7f00\u7d22\u5f15\u7528\u4f5c\u8986\u76d6\u7d22\u5f15\uff1b \u8986\u76d6\u7d22\u5f15\u4f18\u5316 \u00b6 \u8986\u76d6\u7d22\u5f15\u662f\u6307 SQL \u4e2d query \u7684\u6240\u6709\u5b57\u6bb5\uff0c\u5728\u7d22\u5f15 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u4e0a\u90fd\u80fd\u627e\u5f97\u5230\u7684\u90a3\u4e9b\u7d22\u5f15\uff0c\u4ece\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u67e5\u8be2\u5f97\u5230\u8bb0\u5f55\uff0c\u800c\u4e0d\u9700\u8981\u901a\u8fc7\u805a\u7c07\u7d22\u5f15\u67e5\u8be2\u83b7\u5f97\uff0c\u53ef\u4ee5\u907f\u514d\u56de\u8868\u7684\u64cd\u4f5c\u3002 \u5047\u8bbe\u6211\u4eec\u53ea\u9700\u8981\u67e5\u8be2\u5546\u54c1\u7684\u540d\u79f0\u3001\u4ef7\u683c\uff0c\u6709\u4ec0\u4e48\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\u56de\u8868\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\uff0c\u5373\u300c\u5546\u54c1ID\u3001\u540d\u79f0\u3001\u4ef7\u683c\u300d\u4f5c\u4e3a\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\u3002\u5982\u679c\u7d22\u5f15\u4e2d\u5b58\u5728\u8fd9\u4e9b\u6570\u636e\uff0c\u67e5\u8be2\u5c06\u4e0d\u4f1a\u518d\u6b21\u68c0\u7d22\u4e3b\u952e\u7d22\u5f15\uff0c\u4ece\u800c\u907f\u514d\u56de\u8868\u3002 \u6240\u4ee5\uff0c\u4f7f\u7528\u8986\u76d6\u7d22\u5f15\u7684\u597d\u5904\u5c31\u662f\uff0c\u4e0d\u9700\u8981\u67e5\u8be2\u51fa\u5305\u542b\u6574\u884c\u8bb0\u5f55\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4e5f\u5c31\u51cf\u5c11\u4e86\u5927\u91cf\u7684 I/O \u64cd\u4f5c\u3002 \u4e3b\u952e\u7d22\u5f15\u6700\u597d\u662f\u81ea\u589e\u7684 \u00b6 \u6211\u4eec\u5728\u5efa\u8868\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u9ed8\u8ba4\u5c06\u4e3b\u952e\u7d22\u5f15\u8bbe\u7f6e\u4e3a\u81ea\u589e\u7684\uff0c\u5177\u4f53\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u505a\u5462\uff1f\u53c8\u4ec0\u4e48\u597d\u5904\uff1f InnoDB \u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u9ed8\u8ba4\u4e3a\u805a\u7c07\u7d22\u5f15\uff0c\u6570\u636e\u88ab\u5b58\u653e\u5728\u4e86 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u4e0a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u540c\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u5185\u7684\u5404\u4e2a\u6570\u636e\u662f\u6309\u4e3b\u952e\u987a\u5e8f\u5b58\u653e\u7684\uff0c\u56e0\u6b64\uff0c\u6bcf\u5f53\u6709\u4e00\u6761\u65b0\u7684\u6570\u636e\u63d2\u5165\u65f6\uff0c\u6570\u636e\u5e93\u4f1a\u6839\u636e\u4e3b\u952e\u5c06\u5176\u63d2\u5165\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\u4e2d\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u81ea\u589e\u4e3b\u952e \uff0c\u90a3\u4e48\u6bcf\u6b21\u63d2\u5165\u7684\u65b0\u6570\u636e\u5c31\u4f1a\u6309\u987a\u5e8f\u6dfb\u52a0\u5230\u5f53\u524d\u7d22\u5f15\u8282\u70b9\u7684\u4f4d\u7f6e\uff0c\u4e0d\u9700\u8981\u79fb\u52a8\u5df2\u6709\u7684\u6570\u636e\uff0c\u5f53\u9875\u9762\u5199\u6ee1\uff0c\u5c31\u4f1a\u81ea\u52a8\u5f00\u8f9f\u4e00\u4e2a\u65b0\u9875\u9762\u3002\u56e0\u4e3a\u6bcf\u6b21**\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u662f\u8ffd\u52a0\u64cd\u4f5c\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u79fb\u52a8\u6570\u636e**\uff0c\u56e0\u6b64\u8fd9\u79cd\u63d2\u5165\u6570\u636e\u7684\u65b9\u6cd5\u6548\u7387\u975e\u5e38\u9ad8\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u975e\u81ea\u589e\u4e3b\u952e \uff0c\u7531\u4e8e\u6bcf\u6b21\u63d2\u5165\u4e3b\u952e\u7684\u7d22\u5f15\u503c\u90fd\u662f\u968f\u673a\u7684\uff0c\u56e0\u6b64\u6bcf\u6b21\u63d2\u5165\u65b0\u7684\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u63d2\u5165\u5230\u73b0\u6709\u6570\u636e\u9875\u4e2d\u95f4\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u8fd9\u5c06\u4e0d\u5f97\u4e0d\u79fb\u52a8\u5176\u5b83\u6570\u636e\u6765\u6ee1\u8db3\u65b0\u6570\u636e\u7684\u63d2\u5165\uff0c\u751a\u81f3\u9700\u8981\u4ece\u4e00\u4e2a\u9875\u9762\u590d\u5236\u6570\u636e\u5230\u53e6\u5916\u4e00\u4e2a\u9875\u9762\uff0c\u6211\u4eec\u901a\u5e38\u5c06\u8fd9\u79cd\u60c5\u51b5\u79f0\u4e3a**\u9875\u5206\u88c2**\u3002 \u9875\u5206\u88c2\u8fd8\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u5927\u91cf\u7684\u5185\u5b58\u788e\u7247\uff0c\u5bfc\u81f4\u7d22\u5f15\u7ed3\u6784\u4e0d\u7d27\u51d1\uff0c\u4ece\u800c\u5f71\u54cd\u67e5\u8be2\u6548\u7387 \u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u67d0\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u6570\u636e\u662f1\u30013\u30015\u30019\uff0c\u4e14\u6570\u636e\u9875\u6ee1\u4e86\uff0c\u73b0\u5728\u51c6\u5907\u63d2\u5165\u4e00\u4e2a\u6570\u636e7\uff0c\u5219\u9700\u8981\u628a\u6570\u636e\u9875\u5206\u5272\u4e3a\u4e24\u4e2a\u6570\u636e\u9875\uff1a \u51fa\u73b0\u9875\u5206\u88c2\u65f6\uff0c\u9700\u8981\u5c06\u4e00\u4e2a\u9875\u7684\u8bb0\u5f55\u79fb\u52a8\u5230\u53e6\u5916\u4e00\u4e2a\u9875\uff0c\u6027\u80fd\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u540c\u65f6\u9875\u7a7a\u95f4\u7684\u5229\u7528\u7387\u4e0b\u964d\uff0c\u9020\u6210\u5b58\u50a8\u7a7a\u95f4\u7684\u6d6a\u8d39\u3002 \u800c\u5982\u679c\u8bb0\u5f55\u662f\u987a\u5e8f\u63d2\u5165\u7684\uff0c\u4f8b\u5982\u63d2\u5165\u6570\u636e11\uff0c\u5219\u53ea\u9700\u5f00\u8f9f\u65b0\u7684\u6570\u636e\u9875\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u9875\u5206\u88c2\uff1a \u56e0\u6b64\uff0c\u5728\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u7279\u522b\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u5efa\u8bae\u4f7f\u7528\u81ea\u589e\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\u3002 \u53e6\u5916\uff0c\u4e3b\u952e\u5b57\u6bb5\u7684\u957f\u5ea6\u4e0d\u8981\u592a\u5927\uff0c\u56e0\u4e3a**\u4e3b\u952e\u5b57\u6bb5\u957f\u5ea6\u8d8a\u5c0f\uff0c\u610f\u5473\u7740\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u8d8a\u5c0f\uff08\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\uff09\uff0c\u8fd9\u6837\u4e8c\u7ea7\u7d22\u5f15\u5360\u7528\u7684\u7a7a\u95f4\u4e5f\u5c31\u8d8a\u5c0f**\u3002 \u7d22\u5f15\u6700\u597d\u8bbe\u7f6e\u4e3a NOT NULL \u00b6 \u4e3a\u4e86\u66f4\u597d\u7684\u5229\u7528\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u8981\u8bbe\u7f6e\u4e3a NOT NULL \u7ea6\u675f\u3002\u6709\u4e24\u4e2a\u539f\u56e0\uff1a \u7b2c\u4e00\u539f\u56e0\uff1a\u7d22\u5f15\u5217\u5b58\u5728 NULL \u5c31\u4f1a\u5bfc\u81f4\u4f18\u5316\u5668\u5728\u505a\u7d22\u5f15\u9009\u62e9\u7684\u65f6\u5019\u66f4\u52a0\u590d\u6742\uff0c\u66f4\u52a0\u96be\u4ee5\u4f18\u5316\uff0c\u56e0\u4e3a\u53ef\u4e3a NULL \u7684\u5217\u4f1a\u4f7f\u7d22\u5f15\u3001\u7d22\u5f15\u7edf\u8ba1\u548c\u503c\u6bd4\u8f83\u90fd\u66f4\u590d\u6742\uff0c\u6bd4\u5982\u8fdb\u884c\u7d22\u5f15\u7edf\u8ba1\u65f6\uff0ccount \u4f1a\u7701\u7565\u503c\u4e3aNULL \u7684\u884c\u3002 \u7b2c\u4e8c\u4e2a\u539f\u56e0\uff1aNULL \u503c\u662f\u4e00\u4e2a\u6ca1\u610f\u4e49\u7684\u503c\uff0c\u4f46\u662f\u5b83\u4f1a\u5360\u7528\u7269\u7406\u7a7a\u95f4\uff0c\u6240\u4ee5\u4f1a\u5e26\u6765\u7684\u5b58\u50a8\u7a7a\u95f4\u7684\u95ee\u9898\uff0c\u4f1a\u5bfc\u81f4\u66f4\u591a\u7684\u5b58\u50a8\u7a7a\u95f4\u5360\u7528\uff0c\u56e0\u4e3a InnoDB \u9ed8\u8ba4\u884c\u5b58\u50a8\u683c\u5f0f COMPACT \uff0c\u4f1a\u7528 1 \u5b57\u8282\u7a7a\u95f4\u5b58\u50a8 NULL \u503c\u5217\u8868\uff0c\u5982\u4e0b\u56fe\u7684\u9ec4\u8272\u90e8\u5206\uff1a \u9632\u6b62\u7d22\u5f15\u5931\u6548 \u00b6 \u7528\u4e0a\u4e86\u7d22\u5f15\u5e76\u4e0d\u610f\u5473\u7740\u67e5\u8be2\u7684\u65f6\u5019\u4f1a\u4f7f\u7528\u5230\u7d22\u5f15\uff0c\u6240\u4ee5\u6211\u4eec\u5fc3\u91cc\u8981\u6e05\u695a\u6709\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u4ece\u800c\u907f\u514d\u5199\u51fa\u7d22\u5f15\u5931\u6548\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u5426\u5219\u8fd9\u6837\u7684\u67e5\u8be2\u6548\u7387\u662f\u5f88\u4f4e\u7684\u3002 \u6211\u4e4b\u524d\u5199\u8fc7\u7d22\u5f15\u5931\u6548\u7684\u6587\u7ae0\uff0c\u60f3\u8be6\u7ec6\u4e86\u89e3\u7684\u53ef\u4ee5\u53bb\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a \u8c01\u8fd8\u6ca1\u78b0\u8fc7\u7d22\u5f15\u5931\u6548\u5462? \u8fd9\u91cc\u7b80\u5355\u8bf4\u4e00\u4e0b\uff0c\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1a \u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f like %xx \u6216\u8005 like %xx% \u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b \u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u505a\u4e86\u8ba1\u7b97\u3001\u51fd\u6570\u3001\u7c7b\u578b\u8f6c\u6362\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u60c5\u51b5\u4e0b\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b \u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002 \u6211\u4e0a\u9762\u8bf4\u7684\u662f\u5e38\u89c1\u7684\u7d22\u5f15\u5931\u6548\u573a\u666f\uff0c\u5b9e\u9645\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5176\u4ed6\u7684\u7d22\u5f15\u5931\u6548\u573a\u666f\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u67e5\u770b\u6267\u884c\u8ba1\u5212\uff0c\u901a\u8fc7\u6267\u884c\u8ba1\u5212\u663e\u793a\u7684\u6570\u636e\u5224\u65ad\u67e5\u8be2\u8bed\u53e5\u662f\u5426\u4f7f\u7528\u4e86\u7d22\u5f15\u3002 \u5982\u4e0b\u56fe\uff0c\u5c31\u662f\u4e00\u4e2a\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u5168\u8868\u626b\u63cf\u7684\u67e5\u8be2\u8bed\u53e5\u3002 \u5bf9\u4e8e\u6267\u884c\u8ba1\u5212\uff0c\u53c2\u6570\u6709\uff1a possible_keys \u5b57\u6bb5\u8868\u793a\u53ef\u80fd\u7528\u5230\u7684\u7d22\u5f15\uff1b key \u5b57\u6bb5\u8868\u793a\u5b9e\u9645\u7528\u7684\u7d22\u5f15\uff0c\u5982\u679c\u8fd9\u4e00\u9879\u4e3a NULL\uff0c\u8bf4\u660e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff1b key_len \u8868\u793a\u7d22\u5f15\u7684\u957f\u5ea6\uff1b rows \u8868\u793a\u626b\u63cf\u7684\u6570\u636e\u884c\u6570\u3002 type \u8868\u793a\u6570\u636e\u626b\u63cf\u7c7b\u578b\uff0c\u6211\u4eec\u9700\u8981\u91cd\u70b9\u770b\u8fd9\u4e2a\u3002 type \u5b57\u6bb5\u5c31\u662f\u63cf\u8ff0\u4e86\u627e\u5230\u6240\u9700\u6570\u636e\u65f6\u4f7f\u7528\u7684\u626b\u63cf\u65b9\u5f0f\u662f\u4ec0\u4e48\uff0c\u5e38\u89c1\u626b\u63cf\u7c7b\u578b\u7684**\u6267\u884c\u6548\u7387\u4ece\u4f4e\u5230\u9ad8\u7684\u987a\u5e8f\u4e3a**\uff1a All\uff08\u5168\u8868\u626b\u63cf\uff09\uff1b index\uff08\u5168\u7d22\u5f15\u626b\u63cf\uff09\uff1b range\uff08\u7d22\u5f15\u8303\u56f4\u626b\u63cf\uff09\uff1b ref\uff08\u975e\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\uff1b eq_ref\uff08\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\uff1b const\uff08\u7ed3\u679c\u53ea\u6709\u4e00\u6761\u7684\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\u3002 \u5728\u8fd9\u4e9b\u60c5\u51b5\u91cc\uff0call \u662f\u6700\u574f\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u91c7\u7528\u4e86\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u3002index \u548c all \u5dee\u4e0d\u591a\uff0c\u53ea\u4e0d\u8fc7 index \u5bf9\u7d22\u5f15\u8868\u8fdb\u884c\u5168\u626b\u63cf\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u4e0d\u518d\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u4f46\u662f\u5f00\u9500\u4f9d\u7136\u5f88\u5927\u3002\u6240\u4ee5\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u5168\u8868\u626b\u63cf\u548c\u5168\u7d22\u5f15\u626b\u63cf\u3002 range \u8868\u793a\u91c7\u7528\u4e86\u7d22\u5f15\u8303\u56f4\u626b\u63cf\uff0c\u4e00\u822c\u5728 where \u5b50\u53e5\u4e2d\u4f7f\u7528 < \u3001>\u3001in\u3001between \u7b49\u5173\u952e\u8bcd\uff0c\u53ea\u68c0\u7d22\u7ed9\u5b9a\u8303\u56f4\u7684\u884c\uff0c\u5c5e\u4e8e\u8303\u56f4\u67e5\u627e\u3002 \u4ece\u8fd9\u4e00\u7ea7\u522b\u5f00\u59cb\uff0c\u7d22\u5f15\u7684\u4f5c\u7528\u4f1a\u8d8a\u6765\u8d8a\u660e\u663e\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5c3d\u91cf\u8ba9 SQL \u67e5\u8be2\u53ef\u4ee5\u4f7f\u7528\u5230 range \u8fd9\u4e00\u7ea7\u522b\u53ca\u4ee5\u4e0a\u7684 type \u8bbf\u95ee\u65b9\u5f0f \u3002 ref \u7c7b\u578b\u8868\u793a\u91c7\u7528\u4e86\u975e\u552f\u4e00\u7d22\u5f15\uff0c\u6216\u8005\u662f\u552f\u4e00\u7d22\u5f15\u7684\u975e\u552f\u4e00\u6027\u524d\u7f00\uff0c\u8fd4\u56de\u6570\u636e\u8fd4\u56de\u53ef\u80fd\u662f\u591a\u6761\u3002\u56e0\u4e3a\u867d\u7136\u4f7f\u7528\u4e86\u7d22\u5f15\uff0c\u4f46\u8be5\u7d22\u5f15\u5217\u7684\u503c\u5e76\u4e0d\u552f\u4e00\uff0c\u6709\u91cd\u590d\u3002\u8fd9\u6837\u5373\u4f7f\u4f7f\u7528\u7d22\u5f15\u5feb\u901f\u67e5\u627e\u5230\u4e86\u7b2c\u4e00\u6761\u6570\u636e\uff0c\u4ecd\u7136\u4e0d\u80fd\u505c\u6b62\uff0c\u8981\u8fdb\u884c\u76ee\u6807\u503c\u9644\u8fd1\u7684\u5c0f\u8303\u56f4\u626b\u63cf\u3002\u4f46\u5b83\u7684\u597d\u5904\u662f\u5b83\u5e76\u4e0d\u9700\u8981\u626b\u5168\u8868\uff0c\u56e0\u4e3a\u7d22\u5f15\u662f\u6709\u5e8f\u7684\uff0c\u5373\u4fbf\u6709\u91cd\u590d\u503c\uff0c\u4e5f\u662f\u5728\u4e00\u4e2a\u975e\u5e38\u5c0f\u7684\u8303\u56f4\u5185\u626b\u63cf\u3002 eq_ref \u7c7b\u578b\u662f\u4f7f\u7528\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u65f6\u4ea7\u751f\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u901a\u5e38\u4f7f\u7528\u5728\u591a\u8868\u8054\u67e5\u4e2d\u3002\u6bd4\u5982\uff0c\u5bf9\u4e24\u5f20\u8868\u8fdb\u884c\u8054\u67e5\uff0c\u5173\u8054\u6761\u4ef6\u662f\u4e24\u5f20\u8868\u7684 user_id \u76f8\u7b49\uff0c\u4e14 user_id \u662f\u552f\u4e00\u7d22\u5f15\uff0c\u90a3\u4e48\u4f7f\u7528 EXPLAIN \u8fdb\u884c\u6267\u884c\u8ba1\u5212\u67e5\u770b\u7684\u65f6\u5019\uff0ctype \u5c31\u4f1a\u663e\u793a eq_ref\u3002 const \u7c7b\u578b\u8868\u793a\u4f7f\u7528\u4e86\u4e3b\u952e\u6216\u8005\u552f\u4e00\u7d22\u5f15\u4e0e\u5e38\u91cf\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u6bd4\u5982 select name from product where id=1\u3002 \u9700\u8981\u8bf4\u660e\u7684\u662f const \u7c7b\u578b\u548c eq_ref \u90fd\u4f7f\u7528\u4e86\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\uff0c\u4e0d\u8fc7\u8fd9\u4e24\u4e2a\u7c7b\u578b\u6709\u6240\u533a\u522b\uff0c const \u662f\u4e0e\u5e38\u91cf\u8fdb\u884c\u6bd4\u8f83\uff0c\u67e5\u8be2\u6548\u7387\u4f1a\u66f4\u5feb\uff0c\u800c eq_ref \u901a\u5e38\u7528\u4e8e\u591a\u8868\u8054\u67e5\u4e2d \u3002 \u9664\u4e86\u5173\u6ce8 type\uff0c\u6211\u4eec\u4e5f\u8981\u5173\u6ce8 extra \u663e\u793a\u7684\u7ed3\u679c\u3002 \u8fd9\u91cc\u8bf4\u51e0\u4e2a\u91cd\u8981\u7684\u53c2\u8003\u6307\u6807\uff1a Using filesort \uff1a\u5f53\u67e5\u8be2\u8bed\u53e5\u4e2d\u5305\u542b group by \u64cd\u4f5c\uff0c\u800c\u4e14\u65e0\u6cd5\u5229\u7528\u7d22\u5f15\u5b8c\u6210\u6392\u5e8f\u64cd\u4f5c\u7684\u65f6\u5019\uff0c \u8fd9\u65f6\u4e0d\u5f97\u4e0d\u9009\u62e9\u76f8\u5e94\u7684\u6392\u5e8f\u7b97\u6cd5\u8fdb\u884c\uff0c\u751a\u81f3\u53ef\u80fd\u4f1a\u901a\u8fc7\u6587\u4ef6\u6392\u5e8f\uff0c\u6548\u7387\u662f\u5f88\u4f4e\u7684\uff0c\u6240\u4ee5\u8981\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u7684\u51fa\u73b0\u3002 Using temporary\uff1a\u4f7f\u4e86\u7528\u4e34\u65f6\u8868\u4fdd\u5b58\u4e2d\u95f4\u7ed3\u679c\uff0cMySQL \u5728\u5bf9\u67e5\u8be2\u7ed3\u679c\u6392\u5e8f\u65f6\u4f7f\u7528\u4e34\u65f6\u8868\uff0c\u5e38\u89c1\u4e8e\u6392\u5e8f order by \u548c\u5206\u7ec4\u67e5\u8be2 group by\u3002\u6548\u7387\u4f4e\uff0c\u8981\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u7684\u51fa\u73b0\u3002 Using index\uff1a\u6240\u9700\u6570\u636e\u53ea\u9700\u5728\u7d22\u5f15\u5373\u53ef\u5168\u90e8\u83b7\u5f97\uff0c\u4e0d\u987b\u8981\u518d\u5230\u8868\u4e2d\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u4e86\u8986\u76d6\u7d22\u5f15\uff0c\u907f\u514d\u4e86\u56de\u8868\u64cd\u4f5c\uff0c\u6548\u7387\u4e0d\u9519\u3002 \u603b\u7ed3 \u00b6 \u8fd9\u6b21\u4e3b\u8981\u4ecb\u7ecd\u4e86\u7d22\u5f15\u7684\u539f\u7406\u3001\u5206\u7c7b\u548c\u4f7f\u7528\u3002\u6211\u628a\u91cd\u70b9\u603b\u7ed3\u5728\u4e86\u4e0b\u9762\u8fd9\u4e2a\u8868\u683c \u5b8c\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898"},{"location":"mysql/index/index_interview/#_1","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u9762\u8bd5\u4e2d\uff0cMySQL \u7d22\u5f15\u76f8\u5173\u7684\u95ee\u9898\u57fa\u672c\u90fd\u662f\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u90fd\u662f\u5148\u4ece\u7d22\u5f15\u7684\u57fa\u672c\u539f\u7406\uff0c\u518d\u5230\u7d22\u5f15\u7684\u4f7f\u7528\u573a\u666f\uff0c\u6bd4\u5982\uff1a \u7d22\u5f15\u5e95\u5c42\u4f7f\u7528\u4e86\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\uff1f \u4e3a\u4ec0\u4e48 MySQL InnoDB \u9009\u62e9 B+tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff1f \u4ec0\u4e48\u65f6\u5019\u9002\u7528\u7d22\u5f15\uff1f \u4ec0\u4e48\u65f6\u5019\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f \u4ec0\u4e48\u60c5\u51b5\u4e0b\u7d22\u5f15\u4f1a\u5931\u6548\uff1f \u6709\u4ec0\u4e48\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1f ..... \u4eca\u5929\u5c31\u5e26\u5927\u5bb6\uff0c\u592f\u5b9e MySQL \u7d22\u5f15\u7684\u77e5\u8bc6\u70b9\u3002","title":"\u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898"},{"location":"mysql/index/index_interview/#_2","text":"\u5f53\u4f60\u60f3\u67e5\u9605\u4e66\u4e2d\u67d0\u4e2a\u77e5\u8bc6\u7684\u5185\u5bb9\uff0c\u4f60\u4f1a\u9009\u62e9\u4e00\u9875\u4e00\u9875\u7684\u627e\u5462\uff1f\u8fd8\u662f\u5728\u4e66\u7684\u76ee\u5f55\u53bb\u627e\u5462\uff1f \u50bb\u74dc\u90fd\u77e5\u9053\u65f6\u95f4\u662f\u5b9d\u8d35\u7684\uff0c\u5f53\u7136\u662f\u9009\u62e9\u5728\u4e66\u7684\u76ee\u5f55\u53bb\u627e\uff0c\u627e\u5230\u540e\u518d\u7ffb\u5230\u5bf9\u5e94\u7684\u9875\u3002\u4e66\u4e2d\u7684**\u76ee\u5f55**\uff0c\u5c31\u662f\u5145\u5f53**\u7d22\u5f15**\u7684\u89d2\u8272\uff0c\u65b9\u4fbf\u6211\u4eec\u5feb\u901f\u67e5\u627e\u4e66\u4e2d\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u7d22\u5f15\u662f\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u8bbe\u8ba1\u601d\u60f3\u3002 \u90a3\u6362\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u7d22\u5f15\u7684\u5b9a\u4e49\u5c31\u662f\u5e2e\u52a9\u5b58\u50a8\u5f15\u64ce\u5feb\u901f\u83b7\u53d6\u6570\u636e\u7684\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5f62\u8c61\u7684\u8bf4\u5c31\u662f**\u7d22\u5f15\u662f\u6570\u636e\u7684\u76ee\u5f55**\u3002 \u6240\u8c13\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u3001\u5982\u4f55\u4e3a\u5b58\u50a8\u7684\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u548c\u5982\u4f55\u66f4\u65b0\u3001\u67e5\u8be2\u6570\u636e\u7b49\u6280\u672f\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002MySQL \u5b58\u50a8\u5f15\u64ce\u6709 MyISAM \u3001InnoDB\u3001Memory\uff0c\u5176\u4e2d InnoDB \u662f\u5728 MySQL 5.5 \u4e4b\u540e\u6210\u4e3a\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u3002 \u4e0b\u56fe\u662f MySQL \u7684\u7ed3\u6784\u56fe\uff0c\u7d22\u5f15\u548c\u6570\u636e\u5c31\u662f\u4f4d\u4e8e\u5b58\u50a8\u5f15\u64ce\u4e2d\uff1a","title":"\u4ec0\u4e48\u662f\u7d22\u5f15\uff1f"},{"location":"mysql/index/index_interview/#_3","text":"\u4f60\u77e5\u9053\u7d22\u5f15\u6709\u54ea\u4e9b\u5417\uff1f\u5927\u5bb6\u80af\u5b9a\u90fd\u80fd\u9739\u96f3\u556a\u5566\u5730\u8bf4\u51fa\u805a\u7c07\u7d22\u5f15\u3001\u4e3b\u952e\u7d22\u5f15\u3001\u4e8c\u7ea7\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001hash\u7d22\u5f15\u3001B+\u6811\u7d22\u5f15\u7b49\u7b49\u3002 \u7136\u540e\u518d\u95ee\u4f60\uff0c\u4f60\u80fd\u5c06\u8fd9\u4e9b\u7d22\u5f15\u5206\u4e00\u4e0b\u7c7b\u5417\uff1f\u53ef\u80fd\u5927\u5bb6\u5c31\u6709\u70b9\u6a21\u7cca\u4e86\u3002\u5176\u5b9e\uff0c\u8981\u5bf9\u8fd9\u4e9b\u7d22\u5f15\u8fdb\u884c\u5206\u7c7b\uff0c\u8981\u6e05\u695a\u8fd9\u4e9b\u7d22\u5f15\u7684\u4f7f\u7528\u548c\u5b9e\u73b0\u65b9\u5f0f\uff0c\u7136\u540e\u518d\u9488\u5bf9\u6709\u76f8\u540c\u7279\u70b9\u7684\u7d22\u5f15\u5f52\u4e3a\u4e00\u7c7b\u3002 \u6211\u4eec\u53ef\u4ee5\u6309\u7167\u56db\u4e2a\u89d2\u5ea6\u6765\u5206\u7c7b\u7d22\u5f15\u3002 \u6309\u300c\u6570\u636e\u7ed3\u6784\u300d\u5206\u7c7b\uff1a B+tree\u7d22\u5f15\u3001Hash\u7d22\u5f15\u3001Full-text\u7d22\u5f15 \u3002 \u6309\u300c\u7269\u7406\u5b58\u50a8\u300d\u5206\u7c7b\uff1a \u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u3001\u4e8c\u7ea7\u7d22\u5f15\uff08\u8f85\u52a9\u7d22\u5f15\uff09 \u3002 \u6309\u300c\u5b57\u6bb5\u7279\u6027\u300d\u5206\u7c7b\uff1a \u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u524d\u7f00\u7d22\u5f15 \u3002 \u6309\u300c\u5b57\u6bb5\u4e2a\u6570\u300d\u5206\u7c7b\uff1a \u5355\u5217\u7d22\u5f15\u3001\u8054\u5408\u7d22\u5f15 \u3002 \u63a5\u4e0b\u6765\uff0c\u6309\u7167\u8fd9\u4e9b\u89d2\u5ea6\u6765\u8bf4\u8bf4\u5404\u7c7b\u7d22\u5f15\u7684\u7279\u70b9\u3002","title":"\u7d22\u5f15\u7684\u5206\u7c7b"},{"location":"mysql/index/index_interview/#_4","text":"\u4ece\u6570\u636e\u7ed3\u6784\u7684\u89d2\u5ea6\u6765\u770b\uff0cMySQL \u5e38\u89c1\u7d22\u5f15\u6709 B+Tree \u7d22\u5f15\u3001HASH \u7d22\u5f15\u3001Full-Text \u7d22\u5f15\u3002 \u6bcf\u4e00\u79cd\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u4e0d\u4e00\u5b9a\u76f8\u540c\uff0c\u6211\u5728\u8868\u4e2d\u603b\u7ed3\u4e86 MySQL \u5e38\u89c1\u7684\u5b58\u50a8\u5f15\u64ce InnoDB\u3001MyISAM \u548c Memory \u5206\u522b\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u3002 InnoDB \u662f\u5728 MySQL 5.5 \u4e4b\u540e\u6210\u4e3a\u9ed8\u8ba4\u7684 MySQL \u5b58\u50a8\u5f15\u64ce\uff0cB+Tree \u7d22\u5f15\u7c7b\u578b\u4e5f\u662f MySQL \u5b58\u50a8\u5f15\u64ce\u91c7\u7528\u6700\u591a\u7684\u7d22\u5f15\u7c7b\u578b\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u9009\u62e9\u4e0d\u540c\u7684\u5217\u4f5c\u4e3a\u7d22\u5f15\uff1a \u5982\u679c\u6709\u4e3b\u952e\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e3b\u952e\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b \u5982\u679c\u6ca1\u6709\u4e3b\u952e\uff0c\u5c31\u9009\u62e9\u7b2c\u4e00\u4e2a\u4e0d\u5305\u542b NULL \u503c\u7684\u552f\u4e00\u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b \u5728\u4e0a\u9762\u4e24\u4e2a\u90fd\u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5c06\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9690\u5f0f\u81ea\u589e id \u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b \u5176\u5b83\u7d22\u5f15\u90fd\u5c5e\u4e8e\u8f85\u52a9\u7d22\u5f15\uff08Secondary Index\uff09\uff0c\u4e5f\u88ab\u79f0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u6216\u975e\u805a\u7c07\u7d22\u5f15\u3002 \u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+Tree \u7d22\u5f15 \u3002 \u4e3a\u4e86\u8ba9\u5927\u5bb6\u7406\u89e3 B+Tree \u7d22\u5f15\u7684\u5b58\u50a8\u548c\u67e5\u8be2\u7684\u8fc7\u7a0b\uff0c\u63a5\u4e0b\u6765\u6211\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u4f8b\u5b50\uff0c\u8bf4\u660e\u4e00\u4e0b B+Tree \u7d22\u5f15\u5728\u5b58\u50a8\u6570\u636e\u4e2d\u7684\u5177\u4f53\u5b9e\u73b0\u3002 \u5148\u521b\u5efa\u4e00\u5f20\u5546\u54c1\u8868\uff0cid \u4e3a\u4e3b\u952e\uff0c\u5982\u4e0b\uff1a CREATE TABLE ` product ` ( ` id ` int ( 11 ) NOT NULL , ` product_no ` varchar ( 20 ) DEFAULT NULL , ` name ` varchar ( 255 ) DEFAULT NULL , ` price ` decimal ( 10 , 2 ) DEFAULT NULL , PRIMARY KEY ( ` id ` ) USING BTREE ) CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic ; \u5546\u54c1\u8868\u91cc\uff0c\u6709\u8fd9\u4e9b\u884c\u6570\u636e\uff1a \u8fd9\u4e9b\u884c\u6570\u636e\uff0c\u5b58\u50a8\u5728 B+Tree \u7d22\u5f15\u65f6\u662f\u957f\u4ec0\u4e48\u6837\u5b50\u7684\uff1f B+Tree \u662f\u4e00\u79cd\u591a\u53c9\u6811\uff0c\u53f6\u5b50\u8282\u70b9\u624d\u5b58\u653e\u6570\u636e\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u5b58\u653e\u7d22\u5f15\uff0c\u800c\u4e14\u6bcf\u4e2a\u8282\u70b9\u91cc\u7684\u6570\u636e\u662f**\u6309\u4e3b\u952e\u987a\u5e8f\u5b58\u653e**\u7684\u3002\u6bcf\u4e00\u5c42\u7236\u8282\u70b9\u7684\u7d22\u5f15\u503c\u90fd\u4f1a\u51fa\u73b0\u5728\u4e0b\u5c42\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u503c\u4e2d\uff0c\u56e0\u6b64\u5728\u53f6\u5b50\u8282\u70b9\u4e2d\uff0c\u5305\u62ec\u4e86\u6240\u6709\u7684\u7d22\u5f15\u503c\u4fe1\u606f\uff0c\u5e76\u4e14\u6bcf\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u90fd\u6307\u5411\u4e0b\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\uff0c\u5f62\u6210\u4e00\u4e2a\u94fe\u8868\u3002 \u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u5982\u56fe\u6240\u793a\uff1a","title":"\u6309\u6570\u636e\u7ed3\u6784\u5206\u7c7b"},{"location":"mysql/index/index_interview/#_5","text":"\u6bd4\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd9\u6761\u8bed\u53e5\u4f7f\u7528\u4e86\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2 id \u53f7\u4e3a 5 \u7684\u5546\u54c1\u3002\u67e5\u8be2\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff0cB+Tree \u4f1a\u81ea\u9876\u5411\u4e0b\u9010\u5c42\u8fdb\u884c\u67e5\u627e\uff1a \u5c06 5 \u4e0e\u6839\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e (1\uff0c10\uff0c20) \u6bd4\u8f83\uff0c5 \u5728 1 \u548c 10 \u4e4b\u95f4\uff0c\u6240\u4ee5\u6839\u636e B+Tree\u7684\u641c\u7d22\u903b\u8f91\uff0c\u627e\u5230\u7b2c\u4e8c\u5c42\u7684\u7d22\u5f15\u6570\u636e (1\uff0c4\uff0c7)\uff1b \u5728\u7b2c\u4e8c\u5c42\u7684\u7d22\u5f15\u6570\u636e (1\uff0c4\uff0c7)\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u56e0\u4e3a 5 \u5728 4 \u548c 7 \u4e4b\u95f4\uff0c\u6240\u4ee5\u627e\u5230\u7b2c\u4e09\u5c42\u7684\u7d22\u5f15\u6570\u636e\uff084\uff0c5\uff0c6\uff09\uff1b \u5728\u53f6\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e\uff084\uff0c5\uff0c6\uff09\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u7136\u540e\u6211\u4eec\u627e\u5230\u4e86\u7d22\u5f15\u503c\u4e3a 5 \u7684\u884c\u6570\u636e\u3002 \u6570\u636e\u5e93\u7684\u7d22\u5f15\u548c\u6570\u636e\u90fd\u662f\u5b58\u50a8\u5728\u786c\u76d8\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8bfb\u53d6\u4e00\u4e2a\u8282\u70b9\u5f53\u4f5c\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u3002\u90a3\u4e48\u4e0a\u9762\u7684\u6574\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u4e00\u5171\u7ecf\u5386\u4e86 3 \u4e2a\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u8fdb\u884c\u4e86 3 \u6b21 I/O \u64cd\u4f5c\u3002 B+Tree \u5b58\u50a8\u5343\u4e07\u7ea7\u7684\u6570\u636e\u53ea\u9700\u8981 3-4 \u5c42\u9ad8\u5ea6\u5c31\u53ef\u4ee5\u6ee1\u8db3\uff0c\u8fd9\u610f\u5473\u7740\u4ece\u5343\u4e07\u7ea7\u7684\u8868\u67e5\u8be2\u76ee\u6807\u6570\u636e\u6700\u591a\u9700\u8981 3-4 \u6b21\u78c1\u76d8 I/O\uff0c\u6240\u4ee5**B+Tree \u76f8\u6bd4\u4e8e B \u6811\u548c\u4e8c\u53c9\u6811\u6765\u8bf4\uff0c\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\u67e5\u8be2\u6548\u7387\u5f88\u9ad8\uff0c\u56e0\u4e3a\u5373\u4f7f\u5728\u6570\u636e\u91cf\u5f88\u5927\u7684\u60c5\u51b5\uff0c\u67e5\u8be2\u4e00\u4e2a\u6570\u636e\u7684\u78c1\u76d8 I/O \u4f9d\u7136\u7ef4\u6301\u5728 3-4\u6b21\u3002**","title":"\u901a\u8fc7\u4e3b\u952e\u67e5\u8be2\u5546\u54c1\u6570\u636e\u7684\u8fc7\u7a0b"},{"location":"mysql/index/index_interview/#_6","text":"\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u548c\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u533a\u522b\u5982\u4e0b\uff1a \u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff1b \u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u6211\u8fd9\u91cc\u5c06\u524d\u9762\u7684\u5546\u54c1\u8868\u4e2d\u7684 product_no \uff08\u5546\u54c1\u7f16\u7801\uff09\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u5982\u4e0b\u56fe\uff0c\u5176\u4e2d\u975e\u53f6\u5b50\u7684 key \u503c\u662f product_no\uff08\u56fe\u4e2d\u6a59\u8272\u90e8\u5206\uff09\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\uff08\u56fe\u4e2d\u7eff\u8272\u90e8\u5206\uff09\u3002 \u5982\u679c\u6211\u7528 product_no \u4e8c\u7ea7\u7d22\u5f15\u67e5\u8be2\u5546\u54c1\uff0c\u5982\u4e0b\u67e5\u8be2\u8bed\u53e5\uff1a select * from product where product_no = '0002' ; \u4f1a\u5148\u68c0\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u7684 B+Tree \u7684\u7d22\u5f15\u503c\uff08\u5546\u54c1\u7f16\u7801\uff0cproduct_no\uff09\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e\u518d\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 B+Tree \u6811\u67e5\u8be2\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u6574\u884c\u6570\u636e\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u300c\u56de\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u67e5\u4e24\u4e2a B+Tree \u624d\u80fd\u67e5\u5230\u6570\u636e \u3002\u5982\u4e0b\u56fe\uff1a \u4e0d\u8fc7\uff0c\u5f53\u67e5\u8be2\u7684\u6570\u636e\u662f\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\u67e5\u8be2\u5230\uff0c\u8fd9\u65f6\u5c31\u4e0d\u7528\u518d\u67e5\u4e3b\u952e\u7d22\u5f15\u67e5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a select id from product where product_no = '0002' ; \u8fd9\u79cd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u5c31\u80fd\u67e5\u8be2\u5230\u7ed3\u679c\u7684\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u8986\u76d6\u7d22\u5f15\u300d\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u67e5\u4e00\u4e2a B+Tree \u5c31\u80fd\u627e\u5230\u6570\u636e \u3002","title":"\u901a\u8fc7\u4e8c\u7ea7\u7d22\u5f15\u67e5\u8be2\u5546\u54c1\u6570\u636e\u7684\u8fc7\u7a0b"},{"location":"mysql/index/index_interview/#mysql-innodb-btree","text":"\u524d\u9762\u5df2\u7ecf\u8bb2\u4e86 B+Tree \u7684\u7d22\u5f15\u539f\u7406\uff0c\u73b0\u5728\u5c31\u6765\u56de\u7b54\u4e00\u4e0b B+Tree \u76f8\u6bd4\u4e8e B \u6811\u3001\u4e8c\u53c9\u6811\u6216 Hash \u7d22\u5f15\u7ed3\u6784\u7684\u4f18\u52bf\u5728\u54ea\u513f\uff1f \u4e4b\u524d\u6211\u4e5f\u4e13\u95e8\u5199\u8fc7\u4e00\u7bc7\u6587\u7ae0\uff0c\u60f3\u8be6\u7ec6\u4e86\u89e3\u7684\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u300c \u5973\u670b\u53cb\u95ee\u6211\uff1a\u4e3a\u4ec0\u4e48 MySQL \u559c\u6b22 B+ \u6811\uff1f\u6211\u7b11\u7740\u753b\u4e86 20 \u5f20\u56fe \u300d\uff0c\u8fd9\u91cc\u5c31\u7b80\u5355\u505a\u4e2a\u6bd4\u5bf9\u3002 1\u3001B+Tree vs B Tree B+Tree \u53ea\u5728\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u6570\u636e\uff0c\u800c B \u6811 \u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e5f\u8981\u5b58\u50a8\u6570\u636e\uff0c\u6240\u4ee5 B+Tree \u7684\u5355\u4e2a\u8282\u70b9\u7684\u6570\u636e\u91cf\u66f4\u5c0f\uff0c\u5728\u76f8\u540c\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4e0b\uff0c\u5c31\u80fd\u67e5\u8be2\u66f4\u591a\u7684\u8282\u70b9\u3002 \u53e6\u5916\uff0cB+Tree \u53f6\u5b50\u8282\u70b9\u91c7\u7528\u7684\u662f\u53cc\u94fe\u8868\u8fde\u63a5\uff0c\u9002\u5408 MySQL \u4e2d\u5e38\u89c1\u7684\u57fa\u4e8e\u8303\u56f4\u7684\u987a\u5e8f\u67e5\u627e\uff0c\u800c B \u6811\u65e0\u6cd5\u505a\u5230\u8fd9\u4e00\u70b9\u3002 2\u3001B+Tree vs \u4e8c\u53c9\u6811 \u5bf9\u4e8e\u6709 N \u4e2a\u53f6\u5b50\u8282\u70b9\u7684 B+Tree\uff0c\u5176\u641c\u7d22\u590d\u6742\u5ea6\u4e3a O(logdN) \uff0c\u5176\u4e2d d \u8868\u793a\u8282\u70b9\u5141\u8bb8\u7684\u6700\u5927\u5b50\u8282\u70b9\u4e2a\u6570\u4e3a d \u4e2a\u3002 \u5728\u5b9e\u9645\u7684\u5e94\u7528\u5f53\u4e2d\uff0c d \u503c\u662f\u5927\u4e8e100\u7684\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\uff0c\u5373\u4f7f\u6570\u636e\u8fbe\u5230\u5343\u4e07\u7ea7\u522b\u65f6\uff0cB+Tree \u7684\u9ad8\u5ea6\u4f9d\u7136\u7ef4\u6301\u5728 3~4 \u5c42\u5de6\u53f3\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u6b21\u6570\u636e\u67e5\u8be2\u64cd\u4f5c\u53ea\u9700\u8981\u505a 3~4 \u6b21\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\u5c31\u80fd\u67e5\u8be2\u5230\u76ee\u6807\u6570\u636e\u3002 \u800c\u4e8c\u53c9\u6811\u7684\u6bcf\u4e2a\u7236\u8282\u70b9\u7684\u513f\u5b50\u8282\u70b9\u4e2a\u6570\u53ea\u80fd\u662f 2 \u4e2a\uff0c\u610f\u5473\u7740\u5176\u641c\u7d22\u590d\u6742\u5ea6\u4e3a O(logN) \uff0c\u8fd9\u5df2\u7ecf\u6bd4 B+Tree \u9ad8\u51fa\u4e0d\u5c11\uff0c\u56e0\u6b64\u4e8c\u53c9\u6811\u68c0\u7d22\u5230\u76ee\u6807\u6570\u636e\u6240\u7ecf\u5386\u7684\u78c1\u76d8 I/O \u6b21\u6570\u8981\u66f4\u591a\u3002 3\u3001B+Tree vs Hash Hash \u5728\u505a\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\u6548\u7387\u8d3c\u5feb\uff0c\u641c\u7d22\u590d\u6742\u5ea6\u4e3a O(1)\u3002 \u4f46\u662f Hash \u8868\u4e0d\u9002\u5408\u505a\u8303\u56f4\u67e5\u8be2\uff0c\u5b83\u66f4\u9002\u5408\u505a\u7b49\u503c\u7684\u67e5\u8be2\uff0c\u8fd9\u4e5f\u662f B+Tree \u7d22\u5f15\u8981\u6bd4 Hash \u8868\u7d22\u5f15\u6709\u7740\u66f4\u5e7f\u6cdb\u7684\u9002\u7528\u573a\u666f\u7684\u539f\u56e0\u3002","title":"\u4e3a\u4ec0\u4e48 MySQL InnoDB  \u9009\u62e9 B+tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff1f"},{"location":"mysql/index/index_interview/#_7","text":"\u4ece\u7269\u7406\u5b58\u50a8\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u3001\u4e8c\u7ea7\u7d22\u5f15\uff08\u8f85\u52a9\u7d22\u5f15\uff09\u3002 \u8fd9\u4e24\u4e2a\u533a\u522b\u5728\u524d\u9762\u4e5f\u63d0\u5230\u4e86\uff1a \u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff1b \u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u6240\u4ee5\uff0c\u5728\u67e5\u8be2\u65f6\u4f7f\u7528\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\u67e5\u8be2\u7684\u5230\uff0c\u90a3\u4e48\u5c31\u4e0d\u9700\u8981\u56de\u8868\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u8986\u76d6\u7d22\u5f15\u3002\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\uff0c\u5c31\u4f1a\u5148\u68c0\u7d22\u4e8c\u7ea7\u7d22\u5f15\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u83b7\u53d6\u5230\u4e3b\u952e\u503c\u540e\uff0c\u7136\u540e\u518d\u68c0\u7d22\u4e3b\u952e\u7d22\u5f15\uff0c\u5c31\u80fd\u67e5\u8be2\u5230\u6570\u636e\u4e86\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u56de\u8868\u3002","title":"\u6309\u7269\u7406\u5b58\u50a8\u5206\u7c7b"},{"location":"mysql/index/index_interview/#_8","text":"\u4ece\u5b57\u6bb5\u7279\u6027\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u524d\u7f00\u7d22\u5f15\u3002","title":"\u6309\u5b57\u6bb5\u7279\u6027\u5206\u7c7b"},{"location":"mysql/index/index_interview/#_9","text":"\u4e3b\u952e\u7d22\u5f15\u5c31\u662f\u5efa\u7acb\u5728\u4e3b\u952e\u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u901a\u5e38\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u4e00\u8d77\u521b\u5efa\uff0c\u4e00\u5f20\u8868\u6700\u591a\u53ea\u6709\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u7684\u503c\u4e0d\u5141\u8bb8\u6709\u7a7a\u503c\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( .... PRIMARY KEY ( index_column_1 ) USING BTREE );","title":"\u4e3b\u952e\u7d22\u5f15"},{"location":"mysql/index/index_interview/#_10","text":"\u552f\u4e00\u7d22\u5f15\u5efa\u7acb\u5728 UNIQUE \u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u4e00\u5f20\u8868\u53ef\u4ee5\u6709\u591a\u4e2a\u552f\u4e00\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u7684\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u4f46\u662f\u5141\u8bb8\u6709\u7a7a\u503c\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u552f\u4e00\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( .... UNIQUE KEY ( index_column_1 , index_column_2 ,...) ); \u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u552f\u4e00\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a CREATE UNIQUE INDEX index_name ON table_name ( index_column_1 , index_column_2 ,...);","title":"\u552f\u4e00\u7d22\u5f15"},{"location":"mysql/index/index_interview/#_11","text":"\u666e\u901a\u7d22\u5f15\u5c31\u662f\u5efa\u7acb\u5728\u666e\u901a\u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u65e2\u4e0d\u8981\u6c42\u5b57\u6bb5\u4e3a\u4e3b\u952e\uff0c\u4e5f\u4e0d\u8981\u6c42\u5b57\u6bb5\u4e3a UNIQUE\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u666e\u901a\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( .... INDEX ( index_column_1 , index_column_2 ,...) ); \u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u666e\u901a\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a CREATE INDEX index_name ON table_name ( index_column_1 , index_column_2 ,...);","title":"\u666e\u901a\u7d22\u5f15"},{"location":"mysql/index/index_interview/#_12","text":"\u524d\u7f00\u7d22\u5f15\u662f\u6307\u5bf9\u5b57\u7b26\u7c7b\u578b\u5b57\u6bb5\u7684\u524d\u51e0\u4e2a\u5b57\u7b26\u5efa\u7acb\u7684\u7d22\u5f15\uff0c\u800c\u4e0d\u662f\u5728\u6574\u4e2a\u5b57\u6bb5\u4e0a\u5efa\u7acb\u7684\u7d22\u5f15\uff0c\u524d\u7f00\u7d22\u5f15\u53ef\u4ee5\u5efa\u7acb\u5728\u5b57\u6bb5\u7c7b\u578b\u4e3a char\u3001 varchar\u3001binary\u3001varbinary \u7684\u5217\u4e0a\u3002 \u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u7d22\u5f15\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u63d0\u5347\u67e5\u8be2\u6548\u7387\u3002 \u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u524d\u7f00\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE TABLE table_name ( column_list , INDEX ( column_name ( length )) ); \u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u524d\u7f00\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a CREATE INDEX index_name ON table_name ( column_name ( length ));","title":"\u524d\u7f00\u7d22\u5f15"},{"location":"mysql/index/index_interview/#_13","text":"\u4ece\u5b57\u6bb5\u4e2a\u6570\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u5355\u5217\u7d22\u5f15\u3001\u8054\u5408\u7d22\u5f15\uff08\u590d\u5408\u7d22\u5f15\uff09\u3002 \u5efa\u7acb\u5728\u5355\u5217\u4e0a\u7684\u7d22\u5f15\u79f0\u4e3a\u5355\u5217\u7d22\u5f15\uff0c\u6bd4\u5982\u4e3b\u952e\u7d22\u5f15\uff1b \u5efa\u7acb\u5728\u591a\u5217\u4e0a\u7684\u7d22\u5f15\u79f0\u4e3a\u8054\u5408\u7d22\u5f15\uff1b","title":"\u6309\u5b57\u6bb5\u4e2a\u6570\u5206\u7c7b"},{"location":"mysql/index/index_interview/#_14","text":"\u901a\u8fc7\u5c06\u591a\u4e2a\u5b57\u6bb5\u7ec4\u5408\u6210\u4e00\u4e2a\u7d22\u5f15\uff0c\u8be5\u7d22\u5f15\u5c31\u88ab\u79f0\u4e3a\u8054\u5408\u7d22\u5f15\u3002 \u6bd4\u5982\uff0c\u5c06\u5546\u54c1\u8868\u4e2d\u7684 product_no \u548c name \u5b57\u6bb5\u7ec4\u5408\u6210\u8054\u5408\u7d22\u5f15 (product_no, name) \uff0c\u521b\u5efa\u8054\u5408\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a CREATE INDEX index_product_no_name ON product ( product_no , name ); \u8054\u5408\u7d22\u5f15 (product_no, name) \u7684 B+Tree \u793a\u610f\u56fe\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u8054\u5408\u7d22\u5f15\u7684\u975e\u53f6\u5b50\u8282\u70b9\u7528\u4e24\u4e2a\u5b57\u6bb5\u7684\u503c\u4f5c\u4e3a B+Tree \u7684 key \u503c\u3002\u5f53\u5728\u8054\u5408\u7d22\u5f15\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u5148\u6309 product_no \u5b57\u6bb5\u6bd4\u8f83\uff0c\u5728 product_no \u76f8\u540c\u7684\u60c5\u51b5\u4e0b\u518d\u6309 name \u5b57\u6bb5\u6bd4\u8f83\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u8054\u5408\u7d22\u5f15\u67e5\u8be2\u7684 B+Tree \u662f\u5148\u6309 product_no \u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u518d product_no \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 name \u5b57\u6bb5\u6392\u5e8f\u3002 \u56e0\u6b64\uff0c\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u5b58\u5728**\u6700\u5de6\u5339\u914d\u539f\u5219**\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\u3002\u5728\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u9075\u5faa\u300c\u6700\u5de6\u5339\u914d\u539f\u5219\u300d\uff0c\u8054\u5408\u7d22\u5f15\u4f1a\u5931\u6548\uff0c\u8fd9\u6837\u5c31\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15\u5feb\u901f\u67e5\u8be2\u7684\u7279\u6027\u4e86\u3002 \u6bd4\u5982\uff0c\u5982\u679c\u521b\u5efa\u4e86\u4e00\u4e2a (a, b, c) \u8054\u5408\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u5c31\u53ef\u4ee5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff1a where a=1\uff1b where a=1 and b=2 and c=3\uff1b where a=1 and b=2\uff1b \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u6709\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u6240\u4ee5 a \u5b57\u6bb5\u5728 where \u5b50\u53e5\u7684\u987a\u5e8f\u5e76\u4e0d\u91cd\u8981\u3002 \u4f46\u662f\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u56e0\u4e3a\u4e0d\u7b26\u5408\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff0c\u8054\u5408\u7d22\u5f15\u5c31\u4f1a\u5931\u6548: where b=2\uff1b where c=3\uff1b where b=2 and c=3\uff1b \u4e0a\u9762\u8fd9\u4e9b\u67e5\u8be2\u6761\u4ef6\u4e4b\u6240\u4ee5\u4f1a\u5931\u6548\uff0c\u662f\u56e0\u4e3a (a, b, c) \u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309 a \u6392\u5e8f\uff0c\u5728 a \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 b \u6392\u5e8f\uff0c\u5728 b \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 c \u6392\u5e8f\u3002\u6240\u4ee5\uff0c b \u548c c \u662f\u5168\u5c40\u65e0\u5e8f\uff0c\u5c40\u90e8\u76f8\u5bf9\u6709\u5e8f\u7684 \uff0c\u8fd9\u6837\u5728\u6ca1\u6709\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\u7684\u60c5\u51b5\u4e0b\uff0c\u662f\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15\u7684\u3002 \u6211\u8fd9\u91cc\u4e3e\u8054\u5408\u7d22\u5f15\uff08a\uff0cb\uff09\u7684\u4f8b\u5b50\uff0c\u8be5\u8054\u5408\u7d22\u5f15\u7684 B+ Tree \u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0ca \u662f\u5168\u5c40\u6709\u5e8f\u7684\uff081, 2, 2, 3, 4, 5, 6, 7 ,8\uff09\uff0c\u800c b \u662f\u5168\u5c40\u662f\u65e0\u5e8f\u7684\uff0812\uff0c7\uff0c8\uff0c2\uff0c3\uff0c8\uff0c10\uff0c5\uff0c2\uff09\u3002\u56e0\u6b64\uff0c\u76f4\u63a5\u6267\u884c where b = 2 \u8fd9\u79cd\u67e5\u8be2\u6761\u4ef6\u6ca1\u6709\u529e\u6cd5\u5229\u7528\u8054\u5408\u7d22\u5f15\u7684\uff0c \u5229\u7528\u7d22\u5f15\u7684\u524d\u63d0\u662f\u7d22\u5f15\u91cc\u7684 key \u662f\u6709\u5e8f\u7684 \u3002 \u53ea\u6709\u5728 a \u76f8\u540c\u7684\u60c5\u51b5\u624d\uff0cb \u624d\u662f\u6709\u5e8f\u7684\uff0c\u6bd4\u5982 a \u7b49\u4e8e 2 \u7684\u65f6\u5019\uff0cb \u7684\u503c\u4e3a\uff087\uff0c8\uff09\uff0c\u8fd9\u65f6\u5c31\u662f\u6709\u5e8f\u7684\uff0c\u8fd9\u4e2a\u6709\u5e8f\u72b6\u6001\u662f\u5c40\u90e8\u7684\uff0c\u56e0\u6b64\uff0c\u6267\u884c where a = 2 and b = 7 \u662f a \u548c b \u5b57\u6bb5\u80fd\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684\uff0c\u4e5f\u5c31\u662f\u8054\u5408\u7d22\u5f15\u751f\u6548\u4e86\u3002","title":"\u8054\u5408\u7d22\u5f15"},{"location":"mysql/index/index_interview/#_15","text":"\u8054\u5408\u7d22\u5f15\u6709\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\uff0c \u5e76\u4e0d\u662f\u67e5\u8be2\u8fc7\u7a0b\u4f7f\u7528\u4e86\u8054\u5408\u7d22\u5f15\u67e5\u8be2\uff0c\u5c31\u4ee3\u8868\u8054\u5408\u7d22\u5f15\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u5b58\u5728\u90e8\u5206\u5b57\u6bb5\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff0c\u90e8\u5206\u5b57\u6bb5\u6ca1\u6709\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u7684\u60c5\u51b5\u3002 \u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u5c31\u53d1\u751f\u5728\u8303\u56f4\u67e5\u8be2\u3002\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u4f1a\u4e00\u76f4\u5411\u53f3\u5339\u914d\u76f4\u5230\u9047\u5230\u300c\u8303\u56f4\u67e5\u8be2\u300d\u5c31\u4f1a\u505c\u6b62\u5339\u914d\u3002 \u4e5f\u5c31\u662f\u8303\u56f4\u67e5\u8be2\u7684\u5b57\u6bb5\u53ef\u4ee5\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u5728\u8303\u56f4\u67e5\u8be2\u5b57\u6bb5\u7684\u540e\u9762\u7684\u5b57\u6bb5\u65e0\u6cd5\u7528\u5230\u8054\u5408\u7d22\u5f15 \u3002 \u8303\u56f4\u67e5\u8be2\u6709\u5f88\u591a\u79cd\uff0c\u90a3\u5230\u5e95\u662f\u54ea\u4e9b\u8303\u56f4\u67e5\u8be2\u4f1a\u5bfc\u81f4\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u4f1a\u505c\u6b62\u5339\u914d\u5462\uff1f \u63a5\u4e0b\u6765\uff0c\u4e3e\u4f8b\u51e0\u4e2a\u8303\u56f4\u67e5\u4f8b\u5b50\u3002 Q1: select * from t_table where a > 1 and b = 2 \uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f \u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u7b26\u5408 a > 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u80af\u5b9a\u662f\u76f8\u90bb\uff0c\u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408 a > 1 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u4e0d\u7b26\u5408 a > 1 \u6761\u4ef6\u4f4d\u7f6e\u3002\u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u4f46\u662f\u5728\u7b26\u5408 a > 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u65e0\u5e8f\u7684 \u3002\u6bd4\u5982\u524d\u9762\u56fe\u7684\u8054\u5408\u7d22\u5f15\u7684 B+ Tree \u91cc\uff0c\u4e0b\u9762\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684 a \u5b57\u6bb5\u7684\u503c\u90fd\u7b26\u5408 a > 1 \u67e5\u8be2\u6761\u4ef6\uff0c\u800c b \u5b57\u6bb5\u7684\u503c\u662f\u65e0\u5e8f\u7684\uff1a a \u5b57\u6bb5\u503c\u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 8\uff1b a \u5b57\u6bb5\u503c\u4e3a 6 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 10\uff1b a \u5b57\u6bb5\u503c\u4e3a 7 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 5\uff1b \u56e0\u6b64\uff0c\u6211\u4eec\u4e0d\u80fd\u6839\u636e\u67e5\u8be2\u6761\u4ef6 b = 2 \u6765\u8fdb\u4e00\u6b65\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u8bb0\u5f55\u6570\u91cf\uff08b \u5b57\u6bb5\u65e0\u6cd5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002 \u6240\u4ee5\u5728\u6267\u884c Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u7684\u626b\u63cf\u533a\u95f4\u662f (2, + \u221e)\uff0c\u5f62\u6210\u8be5\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\u662f a > 1\uff0c\u4e0e b = 2 \u65e0\u5173\u3002 \u56e0\u6b64\uff0c Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u53ea\u6709 a \u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u800c b \u5b57\u6bb5\u5e76\u6ca1\u6709\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\uff0c\u5728\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u901a\u8fc7 key_len \u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4f18\u5316\u5668\u5177\u4f53\u4f7f\u7528\u4e86\u591a\u5c11\u4e2a\u5b57\u6bb5\u7684\u641c\u7d22\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\u3002 \u4e3e\u4f8b\u4e2a\u4f8b\u5b50 \uff0ca \u548c b \u90fd\u662f int \u7c7b\u578b\u4e14\u4e0d\u4e3a NULL \u7684\u5b57\u6bb5\uff0c\u90a3\u4e48 Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 4 \u5b57\u8282\uff08\u5982\u679c\u5b57\u6bb5\u5141\u8bb8\u4e3a NULL\uff0c\u5c31\u5728\u5b57\u6bb5\u7c7b\u578b\u5360\u7528\u7684\u5b57\u8282\u6570\u4e0a\u52a0 1\uff0c\u4e5f\u5c31\u662f 5 \u5b57\u8282\uff09\uff0c\u8bf4\u660e\u53ea\u6709 a \u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u800c\u4e14\u53ef\u4ee5\u770b\u5230\uff0c\u5373\u4f7f b \u5b57\u6bb5\u6ca1\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0ckey \u4e3a idx_a_b\uff0c\u8bf4\u660e Q1 \u67e5\u8be2\u8bed\u53e5\u4f7f\u7528\u4e86 idx_a_b \u8054\u5408\u7d22\u5f15\u3002 \u901a\u8fc7 Q1 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0ca \u5b57\u6bb5\u4f7f\u7528\u4e86 > \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 >\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0c\u56e0\u6b64 b \u5b57\u6bb5\u5e76\u6ca1\u6709\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002 Q2: select * from t_table where a >= 1 and b = 2 \uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f Q2 \u548c Q1 \u7684\u67e5\u8be2\u8bed\u53e5\u5f88\u50cf\uff0c\u552f\u4e00\u7684\u533a\u522b\u5c31\u662f a \u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u3002 \u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u7b26\u5408 >= 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u80af\u5b9a\u662f\u76f8\u90bb\uff0c\u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408 >= 1 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u4e0d\u7b26\u5408 a>= 1 \u6761\u4ef6\u4f4d\u7f6e\u3002\u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u867d\u7136\u5728\u7b26\u5408 a>= 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u300c\u65e0\u5e8f\u300d\u7684\uff0c \u4f46\u662f\u5bf9\u4e8e\u7b26\u5408 a = 1 \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u300c\u6709\u5e8f\u300d\u7684 \uff08\u56e0\u4e3a\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\uff0c\u7136\u540e\u5728 a \u5b57\u6bb5\u7684\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u518d\u6309\u7167 b \u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6392\u5e8f\uff09\u3002 \u4e8e\u662f\uff0c\u5728\u786e\u5b9a\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u7684\u8303\u56f4\u65f6\uff0c\u5f53\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684 a \u5b57\u6bb5\u503c\u4e3a 1 \u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 b = 2 \u6761\u4ef6\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u8303\u56f4\uff08b \u5b57\u6bb5\u53ef\u4ee5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u7b26\u5408 a = 1 and b = 2 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf\uff0c\u800c\u4e0d\u9700\u8981\u4ece\u7b2c\u4e00\u4e2a a \u5b57\u6bb5\u503c\u4e3a 1 \u7684\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf\u3002 \u6240\u4ee5\uff0c Q2 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 8 \u5b57\u8282\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u901a\u8fc7 Q2 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 a \u5b57\u6bb5\u4f7f\u7528\u4e86 >= \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 >=\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cb \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002 Q3: SELECT * FROM t_table WHERE a BETWEEN 2 AND 8 AND b = 2 \uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f Q3 \u67e5\u8be2\u6761\u4ef6\u4e2d a BETWEEN 2 AND 8 \u7684\u610f\u601d\u662f\u67e5\u8be2 a \u5b57\u6bb5\u7684\u503c\u5728 2 \u548c 8 \u4e4b\u95f4\u7684\u8bb0\u5f55\u3002\u4e0d\u540c\u7684\u6570\u636e\u5e93\u5bf9 BETWEEN ... AND \u5904\u7406\u65b9\u5f0f\u662f\u6709\u5dee\u5f02\u7684\u3002\u5728 MySQL \u4e2d\uff0cBETWEEN \u5305\u542b\u4e86 value1 \u548c value2 \u8fb9\u754c\u503c\uff0c\u7c7b\u4f3c\u4e8e >= and =<\u3002\u800c\u6709\u7684\u6570\u636e\u5e93\u5219\u4e0d\u5305\u542b value1 \u548c value2 \u8fb9\u754c\u503c\uff08\u7c7b\u4f3c\u4e8e > and <\uff09\u3002 \u8fd9\u91cc\u6211\u4eec\u53ea\u8ba8\u8bba MySQL\u3002\u7531\u4e8e MySQL \u7684 BETWEEN \u5305\u542b value1 \u548c value2 \u8fb9\u754c\u503c\uff0c\u6240\u4ee5\u7c7b\u4f3c\u4e8e Q2 \u67e5\u8be2\u8bed\u53e5\uff0c\u56e0\u6b64 Q3 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 8 \u5b57\u8282\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u901a\u8fc7 Q3 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 a \u5b57\u6bb5\u4f7f\u7528\u4e86 BETWEEN \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 BETWEEN\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cb \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002 Q4: SELECT * FROM t_user WHERE name like 'j%' and age = 22 \uff0c\u8054\u5408\u7d22\u5f15\uff08name, age\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f \u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 name \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u524d\u7f00\u4e3a \u2018j\u2019 \u7684 name \u5b57\u6bb5\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u90fd\u662f\u76f8\u90bb\u7684\uff0c \u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408\u524d\u7f00\u4e3a \u2018j\u2019 \u7684 name \u5b57\u6bb5\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u7684 name \u524d\u7f00\u4e0d\u4e3a \u2018j\u2019 \u4e3a\u6b62\u3002 \u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u5f62\u6210\u7684\u626b\u63cf\u533a\u95f4\u662f['j','k')\u3002\u6ce8\u610f\uff0c j \u662f\u95ed\u533a\u95f4\u3002\u5982\u4e0b\u56fe\uff1a \u867d\u7136\u5728\u7b26\u5408\u524d\u7f00\u4e3a \u2018j\u2019 \u7684 name \u5b57\u6bb5\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cage \u5b57\u6bb5\u7684\u503c\u662f\u300c\u65e0\u5e8f\u300d\u7684\uff0c \u4f46\u662f\u5bf9\u4e8e\u7b26\u5408 name = j \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cage\u5b57\u6bb5\u7684\u503c\u662f\u300c\u6709\u5e8f\u300d\u7684 \uff08\u56e0\u4e3a\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309\u7167 name \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\uff0c\u7136\u540e\u5728 name \u5b57\u6bb5\u7684\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u518d\u6309\u7167 age \u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6392\u5e8f\uff09\u3002 \u4e8e\u662f\uff0c\u5728\u786e\u5b9a\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u7684\u8303\u56f4\u65f6\uff0c\u5f53\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684 name \u5b57\u6bb5\u503c\u4e3a \u2018j\u2019 \u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 age = 22 \u6761\u4ef6\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u8303\u56f4\uff08age \u5b57\u6bb5\u53ef\u4ee5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u7b26\u5408 name = 'j' and age = 22 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u65f6\u5f00\u59cb\u626b\u63cf\uff0c\u800c\u4e0d\u9700\u8981\u4ece\u7b2c\u4e00\u4e2a name \u4e3a j \u7684\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf \u3002\u5982\u4e0b\u56fe\u7684\u53f3\u8fb9\uff1a \u6240\u4ee5\uff0c Q4 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2 \u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u672c\u6b21\u4f8b\u5b50\u4e2d\uff1a name \u5b57\u6bb5\u7684\u7c7b\u578b\u662f varchar(30) \u4e14\u4e0d\u4e3a NULL\uff0c\u6570\u636e\u5e93\u8868\u4f7f\u7528\u4e86 utf8mb4 \u5b57\u7b26\u96c6\uff0c\u4e00\u4e2a\u5b57\u7b26\u96c6\u4e3a utf8mb4 \u7684\u5b57\u7b26\u662f 4 \u4e2a\u5b57\u8282\uff0c\u56e0\u6b64 name \u5b57\u6bb5\u7684\u5b9e\u9645\u6570\u636e\u6700\u591a\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u957f\u5ea6\u662f 120 \u5b57\u8282\uff0830 x 4\uff09\uff0c\u7136\u540e\u56e0\u4e3a name \u662f\u53d8\u957f\u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u9700\u8981\u518d\u52a0 2\uff0c\u4e5f\u5c31\u662f name \u7684 key_len \u4e3a 122\u3002 age \u5b57\u6bb5\u7684\u7c7b\u578b\u662f int \u4e14\u4e0d\u4e3a NULL\uff0ckey_len \u4e3a 4\u3002 Q4 \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 126 \u5b57\u8282\uff0cname \u7684 key_len \u4e3a 122\uff0cage \u7684 key_len \u4e3a 4\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f name \u548c age \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002 \u901a\u8fc7 Q4 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 name \u5b57\u6bb5\u4f7f\u7528\u4e86 like \u524d\u7f00\u5339\u914d\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 name \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 like 'j%'\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cage \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002 \u7efc\u4e0a\u6240\u793a\uff0c \u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u5728\u9047\u5230\u8303\u56f4\u67e5\u8be2\uff08\u5982 >\u3001<\uff09\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u4e5f\u5c31\u662f\u8303\u56f4\u67e5\u8be2\u7684\u5b57\u6bb5\u53ef\u4ee5\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u5728\u8303\u56f4\u67e5\u8be2\u5b57\u6bb5\u7684\u540e\u9762\u7684\u5b57\u6bb5\u65e0\u6cd5\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002\u6ce8\u610f\uff0c\u5bf9\u4e8e >=\u3001<=\u3001BETWEEN\u3001like \u524d\u7f00\u5339\u914d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u5e76\u4e0d\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u524d\u9762\u6211\u4e5f\u7528\u4e86\u56db\u4e2a\u4f8b\u5b50\u8bf4\u660e\u4e86 \u3002","title":"\u8054\u5408\u7d22\u5f15\u8303\u56f4\u67e5\u8be2"},{"location":"mysql/index/index_interview/#_16","text":"\u73b0\u5728\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\uff0c\u5728\u6267\u884c select * from table where a > 1 and b = 2 \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u53ea\u6709 a \u5b57\u6bb5\u80fd\u7528\u5230\u7d22\u5f15\uff0c\u90a3\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u627e\u5230\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u4e3b\u952e\u503c\uff08ID \u4e3a 2\uff09\u540e\uff0c\u8fd8\u9700\u8981\u5224\u65ad\u5176\u4ed6\u6761\u4ef6\u662f\u5426\u6ee1\u8db3\uff08\u770b b \u662f\u5426\u7b49\u4e8e 2\uff09\uff0c\u90a3\u662f\u5728\u8054\u5408\u7d22\u5f15\u91cc\u5224\u65ad\uff1f\u8fd8\u662f\u56de\u4e3b\u952e\u7d22\u5f15\u53bb\u5224\u65ad\u5462\uff1f \u5728 MySQL 5.6 \u4e4b\u524d\uff0c\u53ea\u80fd\u4ece ID2 \uff08\u4e3b\u952e\u503c\uff09\u5f00\u59cb\u4e00\u4e2a\u4e2a\u56de\u8868\uff0c\u5230\u300c\u4e3b\u952e\u7d22\u5f15\u300d\u4e0a\u627e\u51fa\u6570\u636e\u884c\uff0c\u518d\u5bf9\u6bd4 b \u5b57\u6bb5\u503c\u3002 \u800c MySQL 5.6 \u5f15\u5165\u7684**\u7d22\u5f15\u4e0b\u63a8\u4f18\u5316**\uff08index condition pushdown)\uff0c \u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u8054\u5408\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5b57\u6bb5\u5148\u505a\u5224\u65ad\uff0c\u76f4\u63a5\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570 \u3002 \u5f53\u4f60\u7684\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u91cc\uff0c\u51fa\u73b0\u4e86 Extra \u4e3a Using index condition \uff0c\u90a3\u4e48\u8bf4\u660e\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u7684\u4f18\u5316\u3002","title":"\u7d22\u5f15\u4e0b\u63a8"},{"location":"mysql/index/index_interview/#_17","text":"\u53e6\u5916\uff0c\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u65f6\u7684\u5b57\u6bb5\u987a\u5e8f\uff0c\u5bf9\u7d22\u5f15\u6548\u7387\u4e5f\u6709\u5f88\u5927\u5f71\u54cd\u3002\u8d8a\u9760\u524d\u7684\u5b57\u6bb5\u88ab\u7528\u4e8e\u7d22\u5f15\u8fc7\u6ee4\u7684\u6982\u7387\u8d8a\u9ad8\uff0c\u5b9e\u9645\u5f00\u53d1\u5de5\u4f5c\u4e2d**\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u8981\u628a\u533a\u5206\u5ea6\u5927\u7684\u5b57\u6bb5\u6392\u5728\u524d\u9762\uff0c\u8fd9\u6837\u533a\u5206\u5ea6\u5927\u7684\u5b57\u6bb5\u8d8a\u6709\u53ef\u80fd\u88ab\u66f4\u591a\u7684 SQL \u4f7f\u7528\u5230**\u3002 \u533a\u5206\u5ea6\u5c31\u662f\u67d0\u4e2a\u5b57\u6bb5 column \u4e0d\u540c\u503c\u7684\u4e2a\u6570\u300c\u9664\u4ee5\u300d\u8868\u7684\u603b\u884c\u6570\uff0c\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a \u6bd4\u5982\uff0c\u6027\u522b\u7684\u533a\u5206\u5ea6\u5c31\u5f88\u5c0f\uff0c\u4e0d\u9002\u5408\u5efa\u7acb\u7d22\u5f15\u6216\u4e0d\u9002\u5408\u6392\u5728\u8054\u5408\u7d22\u5f15\u5217\u7684\u9760\u524d\u7684\u4f4d\u7f6e\uff0c\u800c UUID \u8fd9\u7c7b\u5b57\u6bb5\u5c31\u6bd4\u8f83\u9002\u5408\u505a\u7d22\u5f15\u6216\u6392\u5728\u8054\u5408\u7d22\u5f15\u5217\u7684\u9760\u524d\u7684\u4f4d\u7f6e\u3002 \u56e0\u4e3a\u5982\u679c\u7d22\u5f15\u7684\u533a\u5206\u5ea6\u5f88\u5c0f\uff0c\u5047\u8bbe\u5b57\u6bb5\u7684\u503c\u5206\u5e03\u5747\u5300\uff0c\u90a3\u4e48\u65e0\u8bba\u641c\u7d22\u54ea\u4e2a\u503c\u90fd\u53ef\u80fd\u5f97\u5230\u4e00\u534a\u7684\u6570\u636e\u3002\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd8\u4e0d\u5982\u4e0d\u8981\u7d22\u5f15\uff0c\u56e0\u4e3a MySQL \u8fd8\u6709\u4e00\u4e2a\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u53d1\u73b0\u67d0\u4e2a\u503c\u51fa\u73b0\u5728\u8868\u7684\u6570\u636e\u884c\u4e2d\u7684\u767e\u5206\u6bd4\uff08\u60ef\u7528\u7684\u767e\u5206\u6bd4\u754c\u7ebf\u662f\"30%\"\uff09\u5f88\u9ad8\u7684\u65f6\u5019\uff0c\u5b83\u4e00\u822c\u4f1a\u5ffd\u7565\u7d22\u5f15\uff0c\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002","title":"\u7d22\u5f15\u533a\u5206\u5ea6"},{"location":"mysql/index/index_interview/#_18","text":"\u8fd9\u91cc\u51fa\u4e00\u4e2a\u9898\u76ee\uff0c\u9488\u5bf9\u9488\u5bf9\u4e0b\u9762\u8fd9\u6761 SQL\uff0c\u4f60\u600e\u4e48\u901a\u8fc7\u7d22\u5f15\u6765\u63d0\u9ad8\u67e5\u8be2\u6548\u7387\u5462\uff1f select * from order where status = 1 order by create_time asc \u6709\u7684\u540c\u5b66\u4f1a\u8ba4\u4e3a\uff0c\u5355\u72ec\u7ed9 status \u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\u5c31\u53ef\u4ee5\u4e86\u3002 \u4f46\u662f\u66f4\u597d\u7684\u65b9\u5f0f\u7ed9 status \u548c create_time \u5217\u5efa\u7acb\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\uff0c\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u907f\u514d MySQL \u6570\u636e\u5e93\u53d1\u751f\u6587\u4ef6\u6392\u5e8f\u3002 \u56e0\u4e3a\u5728\u67e5\u8be2\u65f6\uff0c\u5982\u679c\u53ea\u7528\u5230 status \u7684\u7d22\u5f15\uff0c\u4f46\u662f\u8fd9\u6761\u8bed\u53e5\u8fd8\u8981\u5bf9 create_time \u6392\u5e8f\uff0c\u8fd9\u65f6\u5c31\u8981\u7528\u6587\u4ef6\u6392\u5e8f filesort\uff0c\u4e5f\u5c31\u662f\u5728 SQL \u6267\u884c\u8ba1\u5212\u4e2d\uff0cExtra \u5217\u4f1a\u51fa\u73b0 Using filesort\u3002 \u6240\u4ee5\uff0c\u8981\u5229\u7528\u7d22\u5f15\u7684\u6709\u5e8f\u6027\uff0c\u5728 status \u548c create_time \u5217\u5efa\u7acb\u8054\u5408\u7d22\u5f15\uff0c\u8fd9\u6837\u6839\u636e status \u7b5b\u9009\u540e\u7684\u6570\u636e\u5c31\u662f\u6309\u7167 create_time \u6392\u597d\u5e8f\u7684\uff0c\u907f\u514d\u5728\u6587\u4ef6\u6392\u5e8f\uff0c\u63d0\u9ad8\u4e86\u67e5\u8be2\u6548\u7387\u3002","title":"\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u6392\u5e8f"},{"location":"mysql/index/index_interview/#_19","text":"\u7d22\u5f15\u6700\u5927\u7684\u597d\u5904\u662f\u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\uff0c\u4f46\u662f\u7d22\u5f15\u4e5f\u662f\u6709\u7f3a\u70b9\u7684\uff0c\u6bd4\u5982\uff1a \u9700\u8981\u5360\u7528\u7269\u7406\u7a7a\u95f4\uff0c\u6570\u91cf\u8d8a\u5927\uff0c\u5360\u7528\u7a7a\u95f4\u8d8a\u5927\uff1b \u521b\u5efa\u7d22\u5f15\u548c\u7ef4\u62a4\u7d22\u5f15\u8981\u8017\u8d39\u65f6\u95f4\uff0c\u8fd9\u79cd\u65f6\u95f4\u968f\u7740\u6570\u636e\u91cf\u7684\u589e\u52a0\u800c\u589e\u5927\uff1b \u4f1a\u964d\u4f4e\u8868\u7684\u589e\u5220\u6539\u7684\u6548\u7387\uff0c\u56e0\u4e3a\u6bcf\u6b21\u589e\u5220\u6539\u7d22\u5f15\uff0cB+ \u6811\u4e3a\u4e86\u7ef4\u62a4\u7d22\u5f15\u6709\u5e8f\u6027\uff0c\u90fd\u9700\u8981\u8fdb\u884c\u52a8\u6001\u7ef4\u62a4\u3002 \u6240\u4ee5\uff0c\u7d22\u5f15\u4e0d\u662f\u4e07\u80fd\u94a5\u5319\uff0c\u5b83\u4e5f\u662f\u6839\u636e\u573a\u666f\u6765\u4f7f\u7528\u7684\u3002","title":"\u4ec0\u4e48\u65f6\u5019\u9700\u8981 / \u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f"},{"location":"mysql/index/index_interview/#_20","text":"\u5b57\u6bb5\u6709\u552f\u4e00\u6027\u9650\u5236\u7684\uff0c\u6bd4\u5982\u5546\u54c1\u7f16\u7801\uff1b \u7ecf\u5e38\u7528\u4e8e WHERE \u67e5\u8be2\u6761\u4ef6\u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u80fd\u591f\u63d0\u9ad8\u6574\u4e2a\u8868\u7684\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e0d\u662f\u4e00\u4e2a\u5b57\u6bb5\uff0c\u53ef\u4ee5\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u3002 \u7ecf\u5e38\u7528\u4e8e GROUP BY \u548c ORDER BY \u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u5728\u67e5\u8be2\u7684\u65f6\u5019\u5c31\u4e0d\u9700\u8981\u518d\u53bb\u505a\u4e00\u6b21\u6392\u5e8f\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u90fd\u5df2\u7ecf\u77e5\u9053\u4e86\u5efa\u7acb\u7d22\u5f15\u4e4b\u540e\u5728 B+Tree \u4e2d\u7684\u8bb0\u5f55\u90fd\u662f\u6392\u5e8f\u597d\u7684\u3002","title":"\u4ec0\u4e48\u65f6\u5019\u9002\u7528\u7d22\u5f15\uff1f"},{"location":"mysql/index/index_interview/#_21","text":"WHERE \u6761\u4ef6\uff0c GROUP BY \uff0c ORDER BY \u91cc\u7528\u4e0d\u5230\u7684\u5b57\u6bb5\uff0c\u7d22\u5f15\u7684\u4ef7\u503c\u662f\u5feb\u901f\u5b9a\u4f4d\uff0c\u5982\u679c\u8d77\u4e0d\u5230\u5b9a\u4f4d\u7684\u5b57\u6bb5\u901a\u5e38\u662f\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\u7684\uff0c\u56e0\u4e3a\u7d22\u5f15\u662f\u4f1a\u5360\u7528\u7269\u7406\u7a7a\u95f4\u7684\u3002 \u5b57\u6bb5\u4e2d\u5b58\u5728\u5927\u91cf\u91cd\u590d\u6570\u636e\uff0c\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff0c\u6bd4\u5982\u6027\u522b\u5b57\u6bb5\uff0c\u53ea\u6709\u7537\u5973\uff0c\u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\uff0c\u7537\u5973\u7684\u8bb0\u5f55\u5206\u5e03\u5747\u5300\uff0c\u90a3\u4e48\u65e0\u8bba\u641c\u7d22\u54ea\u4e2a\u503c\u90fd\u53ef\u80fd\u5f97\u5230\u4e00\u534a\u7684\u6570\u636e\u3002\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd8\u4e0d\u5982\u4e0d\u8981\u7d22\u5f15\uff0c\u56e0\u4e3a MySQL \u8fd8\u6709\u4e00\u4e2a\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u53d1\u73b0\u67d0\u4e2a\u503c\u51fa\u73b0\u5728\u8868\u7684\u6570\u636e\u884c\u4e2d\u7684\u767e\u5206\u6bd4\u5f88\u9ad8\u7684\u65f6\u5019\uff0c\u5b83\u4e00\u822c\u4f1a\u5ffd\u7565\u7d22\u5f15\uff0c\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002 \u8868\u6570\u636e\u592a\u5c11\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1b \u7ecf\u5e38\u66f4\u65b0\u7684\u5b57\u6bb5\u4e0d\u7528\u521b\u5efa\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0d\u8981\u5bf9\u7535\u5546\u9879\u76ee\u7684\u7528\u6237\u4f59\u989d\u5efa\u7acb\u7d22\u5f15\uff0c\u56e0\u4e3a\u7d22\u5f15\u5b57\u6bb5\u9891\u7e41\u4fee\u6539\uff0c\u7531\u4e8e\u8981\u7ef4\u62a4 B+Tree\u7684\u6709\u5e8f\u6027\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u9891\u7e41\u7684\u91cd\u5efa\u7d22\u5f15\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u6027\u80fd\u7684\u3002","title":"\u4ec0\u4e48\u65f6\u5019\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f"},{"location":"mysql/index/index_interview/#_22","text":"\u8fd9\u91cc\u8bf4\u4e00\u4e0b\u51e0\u79cd\u5e38\u89c1\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1a \u524d\u7f00\u7d22\u5f15\u4f18\u5316\uff1b \u8986\u76d6\u7d22\u5f15\u4f18\u5316\uff1b \u4e3b\u952e\u7d22\u5f15\u6700\u597d\u662f\u81ea\u589e\u7684\uff1b \u9632\u6b62\u7d22\u5f15\u5931\u6548\uff1b","title":"\u6709\u4ec0\u4e48\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1f"},{"location":"mysql/index/index_interview/#_23","text":"\u524d\u7f00\u7d22\u5f15\u987e\u540d\u601d\u4e49\u5c31\u662f\u4f7f\u7528\u67d0\u4e2a\u5b57\u6bb5\u4e2d\u5b57\u7b26\u4e32\u7684\u524d\u51e0\u4e2a\u5b57\u7b26\u5efa\u7acb\u7d22\u5f15\uff0c\u90a3\u6211\u4eec\u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528\u524d\u7f00\u6765\u5efa\u7acb\u7d22\u5f15\u5462\uff1f \u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u662f\u4e3a\u4e86\u51cf\u5c0f\u7d22\u5f15\u5b57\u6bb5\u5927\u5c0f\uff0c\u53ef\u4ee5\u589e\u52a0\u4e00\u4e2a\u7d22\u5f15\u9875\u4e2d\u5b58\u50a8\u7684\u7d22\u5f15\u503c\uff0c\u6709\u6548\u63d0\u9ad8\u7d22\u5f15\u7684\u67e5\u8be2\u901f\u5ea6\u3002\u5728\u4e00\u4e9b\u5927\u5b57\u7b26\u4e32\u7684\u5b57\u6bb5\u4f5c\u4e3a\u7d22\u5f15\u65f6\uff0c\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u51cf\u5c0f\u7d22\u5f15\u9879\u7684\u5927\u5c0f\u3002 \u4e0d\u8fc7\uff0c\u524d\u7f00\u7d22\u5f15\u6709\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u4f8b\u5982\uff1a order by \u5c31\u65e0\u6cd5\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\uff1b \u65e0\u6cd5\u628a\u524d\u7f00\u7d22\u5f15\u7528\u4f5c\u8986\u76d6\u7d22\u5f15\uff1b","title":"\u524d\u7f00\u7d22\u5f15\u4f18\u5316"},{"location":"mysql/index/index_interview/#_24","text":"\u8986\u76d6\u7d22\u5f15\u662f\u6307 SQL \u4e2d query \u7684\u6240\u6709\u5b57\u6bb5\uff0c\u5728\u7d22\u5f15 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u4e0a\u90fd\u80fd\u627e\u5f97\u5230\u7684\u90a3\u4e9b\u7d22\u5f15\uff0c\u4ece\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u67e5\u8be2\u5f97\u5230\u8bb0\u5f55\uff0c\u800c\u4e0d\u9700\u8981\u901a\u8fc7\u805a\u7c07\u7d22\u5f15\u67e5\u8be2\u83b7\u5f97\uff0c\u53ef\u4ee5\u907f\u514d\u56de\u8868\u7684\u64cd\u4f5c\u3002 \u5047\u8bbe\u6211\u4eec\u53ea\u9700\u8981\u67e5\u8be2\u5546\u54c1\u7684\u540d\u79f0\u3001\u4ef7\u683c\uff0c\u6709\u4ec0\u4e48\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\u56de\u8868\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\uff0c\u5373\u300c\u5546\u54c1ID\u3001\u540d\u79f0\u3001\u4ef7\u683c\u300d\u4f5c\u4e3a\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\u3002\u5982\u679c\u7d22\u5f15\u4e2d\u5b58\u5728\u8fd9\u4e9b\u6570\u636e\uff0c\u67e5\u8be2\u5c06\u4e0d\u4f1a\u518d\u6b21\u68c0\u7d22\u4e3b\u952e\u7d22\u5f15\uff0c\u4ece\u800c\u907f\u514d\u56de\u8868\u3002 \u6240\u4ee5\uff0c\u4f7f\u7528\u8986\u76d6\u7d22\u5f15\u7684\u597d\u5904\u5c31\u662f\uff0c\u4e0d\u9700\u8981\u67e5\u8be2\u51fa\u5305\u542b\u6574\u884c\u8bb0\u5f55\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4e5f\u5c31\u51cf\u5c11\u4e86\u5927\u91cf\u7684 I/O \u64cd\u4f5c\u3002","title":"\u8986\u76d6\u7d22\u5f15\u4f18\u5316"},{"location":"mysql/index/index_interview/#_25","text":"\u6211\u4eec\u5728\u5efa\u8868\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u9ed8\u8ba4\u5c06\u4e3b\u952e\u7d22\u5f15\u8bbe\u7f6e\u4e3a\u81ea\u589e\u7684\uff0c\u5177\u4f53\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u505a\u5462\uff1f\u53c8\u4ec0\u4e48\u597d\u5904\uff1f InnoDB \u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u9ed8\u8ba4\u4e3a\u805a\u7c07\u7d22\u5f15\uff0c\u6570\u636e\u88ab\u5b58\u653e\u5728\u4e86 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u4e0a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u540c\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u5185\u7684\u5404\u4e2a\u6570\u636e\u662f\u6309\u4e3b\u952e\u987a\u5e8f\u5b58\u653e\u7684\uff0c\u56e0\u6b64\uff0c\u6bcf\u5f53\u6709\u4e00\u6761\u65b0\u7684\u6570\u636e\u63d2\u5165\u65f6\uff0c\u6570\u636e\u5e93\u4f1a\u6839\u636e\u4e3b\u952e\u5c06\u5176\u63d2\u5165\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\u4e2d\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u81ea\u589e\u4e3b\u952e \uff0c\u90a3\u4e48\u6bcf\u6b21\u63d2\u5165\u7684\u65b0\u6570\u636e\u5c31\u4f1a\u6309\u987a\u5e8f\u6dfb\u52a0\u5230\u5f53\u524d\u7d22\u5f15\u8282\u70b9\u7684\u4f4d\u7f6e\uff0c\u4e0d\u9700\u8981\u79fb\u52a8\u5df2\u6709\u7684\u6570\u636e\uff0c\u5f53\u9875\u9762\u5199\u6ee1\uff0c\u5c31\u4f1a\u81ea\u52a8\u5f00\u8f9f\u4e00\u4e2a\u65b0\u9875\u9762\u3002\u56e0\u4e3a\u6bcf\u6b21**\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u662f\u8ffd\u52a0\u64cd\u4f5c\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u79fb\u52a8\u6570\u636e**\uff0c\u56e0\u6b64\u8fd9\u79cd\u63d2\u5165\u6570\u636e\u7684\u65b9\u6cd5\u6548\u7387\u975e\u5e38\u9ad8\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u975e\u81ea\u589e\u4e3b\u952e \uff0c\u7531\u4e8e\u6bcf\u6b21\u63d2\u5165\u4e3b\u952e\u7684\u7d22\u5f15\u503c\u90fd\u662f\u968f\u673a\u7684\uff0c\u56e0\u6b64\u6bcf\u6b21\u63d2\u5165\u65b0\u7684\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u63d2\u5165\u5230\u73b0\u6709\u6570\u636e\u9875\u4e2d\u95f4\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u8fd9\u5c06\u4e0d\u5f97\u4e0d\u79fb\u52a8\u5176\u5b83\u6570\u636e\u6765\u6ee1\u8db3\u65b0\u6570\u636e\u7684\u63d2\u5165\uff0c\u751a\u81f3\u9700\u8981\u4ece\u4e00\u4e2a\u9875\u9762\u590d\u5236\u6570\u636e\u5230\u53e6\u5916\u4e00\u4e2a\u9875\u9762\uff0c\u6211\u4eec\u901a\u5e38\u5c06\u8fd9\u79cd\u60c5\u51b5\u79f0\u4e3a**\u9875\u5206\u88c2**\u3002 \u9875\u5206\u88c2\u8fd8\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u5927\u91cf\u7684\u5185\u5b58\u788e\u7247\uff0c\u5bfc\u81f4\u7d22\u5f15\u7ed3\u6784\u4e0d\u7d27\u51d1\uff0c\u4ece\u800c\u5f71\u54cd\u67e5\u8be2\u6548\u7387 \u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u67d0\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u6570\u636e\u662f1\u30013\u30015\u30019\uff0c\u4e14\u6570\u636e\u9875\u6ee1\u4e86\uff0c\u73b0\u5728\u51c6\u5907\u63d2\u5165\u4e00\u4e2a\u6570\u636e7\uff0c\u5219\u9700\u8981\u628a\u6570\u636e\u9875\u5206\u5272\u4e3a\u4e24\u4e2a\u6570\u636e\u9875\uff1a \u51fa\u73b0\u9875\u5206\u88c2\u65f6\uff0c\u9700\u8981\u5c06\u4e00\u4e2a\u9875\u7684\u8bb0\u5f55\u79fb\u52a8\u5230\u53e6\u5916\u4e00\u4e2a\u9875\uff0c\u6027\u80fd\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u540c\u65f6\u9875\u7a7a\u95f4\u7684\u5229\u7528\u7387\u4e0b\u964d\uff0c\u9020\u6210\u5b58\u50a8\u7a7a\u95f4\u7684\u6d6a\u8d39\u3002 \u800c\u5982\u679c\u8bb0\u5f55\u662f\u987a\u5e8f\u63d2\u5165\u7684\uff0c\u4f8b\u5982\u63d2\u5165\u6570\u636e11\uff0c\u5219\u53ea\u9700\u5f00\u8f9f\u65b0\u7684\u6570\u636e\u9875\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u9875\u5206\u88c2\uff1a \u56e0\u6b64\uff0c\u5728\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u7279\u522b\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u5efa\u8bae\u4f7f\u7528\u81ea\u589e\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\u3002 \u53e6\u5916\uff0c\u4e3b\u952e\u5b57\u6bb5\u7684\u957f\u5ea6\u4e0d\u8981\u592a\u5927\uff0c\u56e0\u4e3a**\u4e3b\u952e\u5b57\u6bb5\u957f\u5ea6\u8d8a\u5c0f\uff0c\u610f\u5473\u7740\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u8d8a\u5c0f\uff08\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\uff09\uff0c\u8fd9\u6837\u4e8c\u7ea7\u7d22\u5f15\u5360\u7528\u7684\u7a7a\u95f4\u4e5f\u5c31\u8d8a\u5c0f**\u3002","title":"\u4e3b\u952e\u7d22\u5f15\u6700\u597d\u662f\u81ea\u589e\u7684"},{"location":"mysql/index/index_interview/#not-null","text":"\u4e3a\u4e86\u66f4\u597d\u7684\u5229\u7528\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u8981\u8bbe\u7f6e\u4e3a NOT NULL \u7ea6\u675f\u3002\u6709\u4e24\u4e2a\u539f\u56e0\uff1a \u7b2c\u4e00\u539f\u56e0\uff1a\u7d22\u5f15\u5217\u5b58\u5728 NULL \u5c31\u4f1a\u5bfc\u81f4\u4f18\u5316\u5668\u5728\u505a\u7d22\u5f15\u9009\u62e9\u7684\u65f6\u5019\u66f4\u52a0\u590d\u6742\uff0c\u66f4\u52a0\u96be\u4ee5\u4f18\u5316\uff0c\u56e0\u4e3a\u53ef\u4e3a NULL \u7684\u5217\u4f1a\u4f7f\u7d22\u5f15\u3001\u7d22\u5f15\u7edf\u8ba1\u548c\u503c\u6bd4\u8f83\u90fd\u66f4\u590d\u6742\uff0c\u6bd4\u5982\u8fdb\u884c\u7d22\u5f15\u7edf\u8ba1\u65f6\uff0ccount \u4f1a\u7701\u7565\u503c\u4e3aNULL \u7684\u884c\u3002 \u7b2c\u4e8c\u4e2a\u539f\u56e0\uff1aNULL \u503c\u662f\u4e00\u4e2a\u6ca1\u610f\u4e49\u7684\u503c\uff0c\u4f46\u662f\u5b83\u4f1a\u5360\u7528\u7269\u7406\u7a7a\u95f4\uff0c\u6240\u4ee5\u4f1a\u5e26\u6765\u7684\u5b58\u50a8\u7a7a\u95f4\u7684\u95ee\u9898\uff0c\u4f1a\u5bfc\u81f4\u66f4\u591a\u7684\u5b58\u50a8\u7a7a\u95f4\u5360\u7528\uff0c\u56e0\u4e3a InnoDB \u9ed8\u8ba4\u884c\u5b58\u50a8\u683c\u5f0f COMPACT \uff0c\u4f1a\u7528 1 \u5b57\u8282\u7a7a\u95f4\u5b58\u50a8 NULL \u503c\u5217\u8868\uff0c\u5982\u4e0b\u56fe\u7684\u9ec4\u8272\u90e8\u5206\uff1a","title":"\u7d22\u5f15\u6700\u597d\u8bbe\u7f6e\u4e3a NOT NULL"},{"location":"mysql/index/index_interview/#_26","text":"\u7528\u4e0a\u4e86\u7d22\u5f15\u5e76\u4e0d\u610f\u5473\u7740\u67e5\u8be2\u7684\u65f6\u5019\u4f1a\u4f7f\u7528\u5230\u7d22\u5f15\uff0c\u6240\u4ee5\u6211\u4eec\u5fc3\u91cc\u8981\u6e05\u695a\u6709\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u4ece\u800c\u907f\u514d\u5199\u51fa\u7d22\u5f15\u5931\u6548\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u5426\u5219\u8fd9\u6837\u7684\u67e5\u8be2\u6548\u7387\u662f\u5f88\u4f4e\u7684\u3002 \u6211\u4e4b\u524d\u5199\u8fc7\u7d22\u5f15\u5931\u6548\u7684\u6587\u7ae0\uff0c\u60f3\u8be6\u7ec6\u4e86\u89e3\u7684\u53ef\u4ee5\u53bb\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a \u8c01\u8fd8\u6ca1\u78b0\u8fc7\u7d22\u5f15\u5931\u6548\u5462? \u8fd9\u91cc\u7b80\u5355\u8bf4\u4e00\u4e0b\uff0c\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1a \u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f like %xx \u6216\u8005 like %xx% \u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b \u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u505a\u4e86\u8ba1\u7b97\u3001\u51fd\u6570\u3001\u7c7b\u578b\u8f6c\u6362\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u60c5\u51b5\u4e0b\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b \u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002 \u6211\u4e0a\u9762\u8bf4\u7684\u662f\u5e38\u89c1\u7684\u7d22\u5f15\u5931\u6548\u573a\u666f\uff0c\u5b9e\u9645\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5176\u4ed6\u7684\u7d22\u5f15\u5931\u6548\u573a\u666f\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u67e5\u770b\u6267\u884c\u8ba1\u5212\uff0c\u901a\u8fc7\u6267\u884c\u8ba1\u5212\u663e\u793a\u7684\u6570\u636e\u5224\u65ad\u67e5\u8be2\u8bed\u53e5\u662f\u5426\u4f7f\u7528\u4e86\u7d22\u5f15\u3002 \u5982\u4e0b\u56fe\uff0c\u5c31\u662f\u4e00\u4e2a\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u5168\u8868\u626b\u63cf\u7684\u67e5\u8be2\u8bed\u53e5\u3002 \u5bf9\u4e8e\u6267\u884c\u8ba1\u5212\uff0c\u53c2\u6570\u6709\uff1a possible_keys \u5b57\u6bb5\u8868\u793a\u53ef\u80fd\u7528\u5230\u7684\u7d22\u5f15\uff1b key \u5b57\u6bb5\u8868\u793a\u5b9e\u9645\u7528\u7684\u7d22\u5f15\uff0c\u5982\u679c\u8fd9\u4e00\u9879\u4e3a NULL\uff0c\u8bf4\u660e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff1b key_len \u8868\u793a\u7d22\u5f15\u7684\u957f\u5ea6\uff1b rows \u8868\u793a\u626b\u63cf\u7684\u6570\u636e\u884c\u6570\u3002 type \u8868\u793a\u6570\u636e\u626b\u63cf\u7c7b\u578b\uff0c\u6211\u4eec\u9700\u8981\u91cd\u70b9\u770b\u8fd9\u4e2a\u3002 type \u5b57\u6bb5\u5c31\u662f\u63cf\u8ff0\u4e86\u627e\u5230\u6240\u9700\u6570\u636e\u65f6\u4f7f\u7528\u7684\u626b\u63cf\u65b9\u5f0f\u662f\u4ec0\u4e48\uff0c\u5e38\u89c1\u626b\u63cf\u7c7b\u578b\u7684**\u6267\u884c\u6548\u7387\u4ece\u4f4e\u5230\u9ad8\u7684\u987a\u5e8f\u4e3a**\uff1a All\uff08\u5168\u8868\u626b\u63cf\uff09\uff1b index\uff08\u5168\u7d22\u5f15\u626b\u63cf\uff09\uff1b range\uff08\u7d22\u5f15\u8303\u56f4\u626b\u63cf\uff09\uff1b ref\uff08\u975e\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\uff1b eq_ref\uff08\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\uff1b const\uff08\u7ed3\u679c\u53ea\u6709\u4e00\u6761\u7684\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\u3002 \u5728\u8fd9\u4e9b\u60c5\u51b5\u91cc\uff0call \u662f\u6700\u574f\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u91c7\u7528\u4e86\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u3002index \u548c all \u5dee\u4e0d\u591a\uff0c\u53ea\u4e0d\u8fc7 index \u5bf9\u7d22\u5f15\u8868\u8fdb\u884c\u5168\u626b\u63cf\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u4e0d\u518d\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u4f46\u662f\u5f00\u9500\u4f9d\u7136\u5f88\u5927\u3002\u6240\u4ee5\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u5168\u8868\u626b\u63cf\u548c\u5168\u7d22\u5f15\u626b\u63cf\u3002 range \u8868\u793a\u91c7\u7528\u4e86\u7d22\u5f15\u8303\u56f4\u626b\u63cf\uff0c\u4e00\u822c\u5728 where \u5b50\u53e5\u4e2d\u4f7f\u7528 < \u3001>\u3001in\u3001between \u7b49\u5173\u952e\u8bcd\uff0c\u53ea\u68c0\u7d22\u7ed9\u5b9a\u8303\u56f4\u7684\u884c\uff0c\u5c5e\u4e8e\u8303\u56f4\u67e5\u627e\u3002 \u4ece\u8fd9\u4e00\u7ea7\u522b\u5f00\u59cb\uff0c\u7d22\u5f15\u7684\u4f5c\u7528\u4f1a\u8d8a\u6765\u8d8a\u660e\u663e\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5c3d\u91cf\u8ba9 SQL \u67e5\u8be2\u53ef\u4ee5\u4f7f\u7528\u5230 range \u8fd9\u4e00\u7ea7\u522b\u53ca\u4ee5\u4e0a\u7684 type \u8bbf\u95ee\u65b9\u5f0f \u3002 ref \u7c7b\u578b\u8868\u793a\u91c7\u7528\u4e86\u975e\u552f\u4e00\u7d22\u5f15\uff0c\u6216\u8005\u662f\u552f\u4e00\u7d22\u5f15\u7684\u975e\u552f\u4e00\u6027\u524d\u7f00\uff0c\u8fd4\u56de\u6570\u636e\u8fd4\u56de\u53ef\u80fd\u662f\u591a\u6761\u3002\u56e0\u4e3a\u867d\u7136\u4f7f\u7528\u4e86\u7d22\u5f15\uff0c\u4f46\u8be5\u7d22\u5f15\u5217\u7684\u503c\u5e76\u4e0d\u552f\u4e00\uff0c\u6709\u91cd\u590d\u3002\u8fd9\u6837\u5373\u4f7f\u4f7f\u7528\u7d22\u5f15\u5feb\u901f\u67e5\u627e\u5230\u4e86\u7b2c\u4e00\u6761\u6570\u636e\uff0c\u4ecd\u7136\u4e0d\u80fd\u505c\u6b62\uff0c\u8981\u8fdb\u884c\u76ee\u6807\u503c\u9644\u8fd1\u7684\u5c0f\u8303\u56f4\u626b\u63cf\u3002\u4f46\u5b83\u7684\u597d\u5904\u662f\u5b83\u5e76\u4e0d\u9700\u8981\u626b\u5168\u8868\uff0c\u56e0\u4e3a\u7d22\u5f15\u662f\u6709\u5e8f\u7684\uff0c\u5373\u4fbf\u6709\u91cd\u590d\u503c\uff0c\u4e5f\u662f\u5728\u4e00\u4e2a\u975e\u5e38\u5c0f\u7684\u8303\u56f4\u5185\u626b\u63cf\u3002 eq_ref \u7c7b\u578b\u662f\u4f7f\u7528\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u65f6\u4ea7\u751f\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u901a\u5e38\u4f7f\u7528\u5728\u591a\u8868\u8054\u67e5\u4e2d\u3002\u6bd4\u5982\uff0c\u5bf9\u4e24\u5f20\u8868\u8fdb\u884c\u8054\u67e5\uff0c\u5173\u8054\u6761\u4ef6\u662f\u4e24\u5f20\u8868\u7684 user_id \u76f8\u7b49\uff0c\u4e14 user_id \u662f\u552f\u4e00\u7d22\u5f15\uff0c\u90a3\u4e48\u4f7f\u7528 EXPLAIN \u8fdb\u884c\u6267\u884c\u8ba1\u5212\u67e5\u770b\u7684\u65f6\u5019\uff0ctype \u5c31\u4f1a\u663e\u793a eq_ref\u3002 const \u7c7b\u578b\u8868\u793a\u4f7f\u7528\u4e86\u4e3b\u952e\u6216\u8005\u552f\u4e00\u7d22\u5f15\u4e0e\u5e38\u91cf\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u6bd4\u5982 select name from product where id=1\u3002 \u9700\u8981\u8bf4\u660e\u7684\u662f const \u7c7b\u578b\u548c eq_ref \u90fd\u4f7f\u7528\u4e86\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\uff0c\u4e0d\u8fc7\u8fd9\u4e24\u4e2a\u7c7b\u578b\u6709\u6240\u533a\u522b\uff0c const \u662f\u4e0e\u5e38\u91cf\u8fdb\u884c\u6bd4\u8f83\uff0c\u67e5\u8be2\u6548\u7387\u4f1a\u66f4\u5feb\uff0c\u800c eq_ref \u901a\u5e38\u7528\u4e8e\u591a\u8868\u8054\u67e5\u4e2d \u3002 \u9664\u4e86\u5173\u6ce8 type\uff0c\u6211\u4eec\u4e5f\u8981\u5173\u6ce8 extra \u663e\u793a\u7684\u7ed3\u679c\u3002 \u8fd9\u91cc\u8bf4\u51e0\u4e2a\u91cd\u8981\u7684\u53c2\u8003\u6307\u6807\uff1a Using filesort \uff1a\u5f53\u67e5\u8be2\u8bed\u53e5\u4e2d\u5305\u542b group by \u64cd\u4f5c\uff0c\u800c\u4e14\u65e0\u6cd5\u5229\u7528\u7d22\u5f15\u5b8c\u6210\u6392\u5e8f\u64cd\u4f5c\u7684\u65f6\u5019\uff0c \u8fd9\u65f6\u4e0d\u5f97\u4e0d\u9009\u62e9\u76f8\u5e94\u7684\u6392\u5e8f\u7b97\u6cd5\u8fdb\u884c\uff0c\u751a\u81f3\u53ef\u80fd\u4f1a\u901a\u8fc7\u6587\u4ef6\u6392\u5e8f\uff0c\u6548\u7387\u662f\u5f88\u4f4e\u7684\uff0c\u6240\u4ee5\u8981\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u7684\u51fa\u73b0\u3002 Using temporary\uff1a\u4f7f\u4e86\u7528\u4e34\u65f6\u8868\u4fdd\u5b58\u4e2d\u95f4\u7ed3\u679c\uff0cMySQL \u5728\u5bf9\u67e5\u8be2\u7ed3\u679c\u6392\u5e8f\u65f6\u4f7f\u7528\u4e34\u65f6\u8868\uff0c\u5e38\u89c1\u4e8e\u6392\u5e8f order by \u548c\u5206\u7ec4\u67e5\u8be2 group by\u3002\u6548\u7387\u4f4e\uff0c\u8981\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u7684\u51fa\u73b0\u3002 Using index\uff1a\u6240\u9700\u6570\u636e\u53ea\u9700\u5728\u7d22\u5f15\u5373\u53ef\u5168\u90e8\u83b7\u5f97\uff0c\u4e0d\u987b\u8981\u518d\u5230\u8868\u4e2d\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u4e86\u8986\u76d6\u7d22\u5f15\uff0c\u907f\u514d\u4e86\u56de\u8868\u64cd\u4f5c\uff0c\u6548\u7387\u4e0d\u9519\u3002","title":"\u9632\u6b62\u7d22\u5f15\u5931\u6548"},{"location":"mysql/index/index_interview/#_27","text":"\u8fd9\u6b21\u4e3b\u8981\u4ecb\u7ecd\u4e86\u7d22\u5f15\u7684\u539f\u7406\u3001\u5206\u7c7b\u548c\u4f7f\u7528\u3002\u6211\u628a\u91cd\u70b9\u603b\u7ed3\u5728\u4e86\u4e0b\u9762\u8fd9\u4e2a\u8868\u683c \u5b8c\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/index/index_issue/","text":"MySQL \u4f7f\u7528 like \u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6628\u5929\u53d1\u4e86\u4e00\u7bc7\u5173\u4e8e\u7d22\u5f15\u5931\u6548\u7684\u6587\u7ae0\uff1a \u8c01\u8fd8\u6ca1\u78b0\u8fc7\u7d22\u5f15\u5931\u6548\u5462 \u6211\u5728\u6587\u672b\u7559\u4e86\u4e00\u4e2a\u6709\u70b9\u610f\u601d\u7684\u601d\u8003\u9898\uff1a \u8fd9\u4e2a\u601d\u8003\u9898\u5176\u5b9e\u662f\u51fa\u81ea\u4e8e\uff0c\u6211\u4e4b\u524d\u8fd9\u7bc7\u6587\u7ae0\u300c \u4e00\u6761 SQL \u8bed\u53e5\u5f15\u53d1\u7684\u601d\u8003 \u300d\u4e2d\u7559\u8a00\u533a\u4e00\u4f4d\u8bfb\u8005\u670b\u53cb\u51fa\u7684\u95ee\u9898\u3002 \u5f88\u591a\u8bfb\u8005\u90fd\u5728\u7559\u8a00\u533a\u8bf4\u4e86\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u4e5f\u6709\u4e0d\u5c11\u8bfb\u8005\u79c1\u804a\u6211\u7b54\u6848\u5230\u5e95\u662f\u4ec0\u4e48\uff1f \u6240\u4ee5\uff0c\u6211\u4eca\u665a\u5c31\u8ddf\u5927\u5bb6\u804a\u804a\u8fd9\u4e2a\u601d\u8003\u9898\u3002 \u9898\u76ee\u4e00 \u00b6 \u9898\u76ee\u4e00\u5f88\u7b80\u5355\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u80fd\u5206\u6790\u51fa\u7b54\u6848\uff0c\u6211\u6628\u5929\u5206\u4eab\u7684\u7d22\u5f15\u5931\u6548\u6587\u7ae0\u91cc\u4e5f\u63d0\u53ca\u8fc7\u3002 **\u300c\u9898\u76ee 1 \u300d**\u7684\u6570\u636e\u5e93\u8868\u5982\u4e0b\uff0cid \u662f\u4e3b\u952e\u7d22\u5f15\uff0cname \u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5176\u4ed6\u5b57\u6bb5\u90fd\u662f\u975e\u7d22\u5f15\u5b57\u6bb5\u3002 \u8fd9\u56db\u6761\u6a21\u7cca\u5339\u914d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u7b2c\u4e00\u6761\u548c\u7b2c\u4e8c\u6761\u90fd\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u800c\u4e14\u90fd\u662f\u9009\u62e9\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\uff08index_name\uff09\uff0c\u6211\u8d34\u4e2a\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u7ed3\u679c\u56fe\uff1a \u800c\u7b2c\u4e09\u548c\u7b2c\u56db\u6761\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\uff0c\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c type= ALL\uff0c\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\u3002 \u9898\u76ee\u4e8c \u00b6 \u9898\u76ee 2 \u7684\u6570\u636e\u5e93\u8868\u7279\u522b\u4e4b\u5904\u5728\u4e8e\uff0c\u53ea\u6709\u4e24\u4e2a\u5b57\u6bb5\uff0c\u4e00\u4e2a\u662f\u4e3b\u952e\u7d22\u5f15 id\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u4e8c\u7ea7\u7d22\u5f15 name\u3002 \u9488\u5bf9\u9898\u76ee 2 \u7684\u6570\u636e\u8868\uff0c\u7b2c\u4e00\u6761\u548c\u7b2c\u4e8c\u6761\u6a21\u7cca\u67e5\u8be2\u8bed\u53e5\u4e5f\u662f\u4e00\u6837\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0cExtra \u91cc\u7684 Using index \u8bf4\u660e\u7528\u4e0a\u4e86\u8986\u76d6\u7d22\u5f15\uff1a \u6211\u4eec\u6765\u770b\u4e00\u4e0b\u7b2c\u4e09\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\uff08\u7b2c\u56db\u6761\u4e5f\u662f\u4e00\u6837\u7684\u7ed3\u679c\uff09\uff1a \u4ece\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230 key=index_name\uff0c\u4e5f\u5c31\u662f\u8bf4\u7528\u4e0a\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u800c\u4e14\u4ece Extra \u91cc\u7684 Using index \u8bf4\u660e\u7528\u4e0a\u4e86\u8986\u76d6\u7d22\u5f15\u3002 \u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f \u9996\u5148\uff0c\u8fd9\u5f20\u8868\u7684\u5b57\u6bb5\u6ca1\u6709\u300c\u975e\u7d22\u5f15\u300d\u5b57\u6bb5\uff0c\u6240\u4ee5 select * \u76f8\u5f53\u4e8e select id,name \uff0c\u7136\u540e**\u8fd9\u4e2a\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\uff0c\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u5305\u542b\u300c\u7d22\u5f15\u503c+\u4e3b\u952e\u503c\u300d\uff0c\u6240\u4ee5\u67e5\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5c31\u80fd\u67e5\u5230\u5168\u90e8\u7ed3\u679c\u4e86\uff0c\u8fd9\u4e2a\u5c31\u662f\u8986\u76d6\u7d22\u5f15\u3002** \u4f46\u662f\u6267\u884c\u8ba1\u5212\u91cc\u7684 type \u662f index \uff0c\u8fd9\u4ee3\u8868\u7740\u662f\u901a\u8fc7\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u65b9\u5f0f\u67e5\u8be2\u5230\u6570\u636e\u7684\uff0c\u4e5f\u5c31\u662f\u904d\u5386\u4e86\u6574\u9897\u7d22\u5f15\u6811\u3002 \u800c\u7b2c\u4e00\u548c\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u4e2d type \u662f range \uff0c\u8868\u793a\u5bf9\u7d22\u5f15\u5217\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u5229\u7528\u4e86\u7d22\u5f15\u6811\u7684\u6709\u5e8f\u6027\u7684\u7279\u70b9\uff0c\u901a\u8fc7\u67e5\u8be2\u6bd4\u8f83\u7684\u65b9\u5f0f\uff0c\u5feb\u901f\u5b9a\u4f4d\u5230\u4e86\u6570\u636e\u884c\u3002 \u6240\u4ee5\uff0ctype=range \u7684\u67e5\u8be2\u6548\u7387\u4f1a\u6bd4 type=index \u7684\u9ad8\u4e00\u4e9b\u3002 \u4e3a\u4ec0\u4e48\u9009\u62e9\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811\uff0c\u800c\u4e0d\u626b\u63cf\u805a\u7c07\u7d22\u5f15\u6811\u5462\uff1f \u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u6811\u7684\u8bb0\u5f55\u4e1c\u897f\u5f88\u5c11\uff0c\u5c31\u53ea\u6709\u300c\u7d22\u5f15\u5217+\u4e3b\u952e\u503c\u300d\uff0c\u800c\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u7684\u4e1c\u897f\u4f1a\u66f4\u591a\uff0c\u6bd4\u5982\u805a\u7c07\u7d22\u5f15\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u5219\u8bb0\u5f55\u4e86\u4e3b\u952e\u503c\u3001\u4e8b\u52a1 id\u3001\u7528\u4e8e\u4e8b\u52a1\u548c MVCC \u7684\u56de\u6eda\u6307\u9488\u4ee5\u53ca\u6240\u6709\u7684\u5269\u4f59\u5217\u3002 \u518d\u52a0\u4e0a\uff0c\u8fd9\u4e2a select * \u4e0d\u7528\u6267\u884c\u56de\u8868\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c MySQL \u4f18\u5316\u5668\u8ba4\u4e3a\u76f4\u63a5\u904d\u5386\u4e8c\u7ea7\u7d22\u5f15\u6811\u8981\u6bd4\u904d\u5386\u805a\u7c07\u7d22\u5f15\u6811\u7684\u6210\u672c\u8981\u5c0f\u7684\u591a\uff0c\u56e0\u6b64 MySQL \u9009\u62e9\u4e86\u300c\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811\u300d\u7684\u65b9\u5f0f\u67e5\u8be2\u6570\u636e\u3002 \u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u6570\u636e\u8868\u52a0\u4e86\u975e\u7d22\u5f15\u5b57\u6bb5\uff0c\u6267\u884c\u540c\u6837\u7684\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u600e\u4e48\u53d8\u6210\u8d70\u7684\u662f\u5168\u8868\u626b\u63cf\u5462\uff1f \u52a0\u4e86\u5176\u4ed6\u5b57\u6bb5\u540e\uff0c select * from t_user where name like \"%xx\"; \u8981\u67e5\u8be2\u7684\u6570\u636e\u5c31\u4e0d\u80fd\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u91cc\u627e\u4e86\uff0c\u5f97\u9700\u8981\u56de\u8868\u64cd\u4f5c\u624d\u80fd\u5b8c\u6210\u67e5\u8be2\u7684\u5de5\u4f5c\uff0c\u518d\u52a0\u4e0a\u662f\u5de6\u6a21\u7cca\u5339\u914d\uff0c\u65e0\u6cd5\u5229\u7528\u7d22\u5f15\u6811\u7684\u6709\u5e8f\u6027\u6765\u5feb\u901f\u5b9a\u4f4d\u6570\u636e\uff0c\u6240\u4ee5\u5f97\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u9010\u4e00\u904d\u5386\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\u540e\uff0c\u518d\u5230\u805a\u7c07\u7d22\u5f15\u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u6570\u636e\u884c\uff0c\u8fd9\u6837\u5b9e\u5728\u592a\u7d2f\u4e86\u3002 \u6240\u4ee5\uff0c\u4f18\u5316\u5668\u8ba4\u4e3a\u4e0a\u9762\u8fd9\u6837\u7684\u67e5\u8be2\u8fc7\u7a0b\u7684\u6210\u672c\u5b9e\u5728\u592a\u9ad8\u4e86\uff0c\u6240\u4ee5\u76f4\u63a5\u9009\u62e9\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u67e5\u8be2\u6570\u636e\u3002 \u4ece\u8fd9\u4e2a\u601d\u8003\u9898\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u4f7f\u7528\u5de6\u6a21\u7cca\u5339\u914d\uff08like \"%xx\"\uff09\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff0c\u5173\u952e\u8fd8\u662f\u770b\u6570\u636e\u8868\u4e2d\u7684\u5b57\u6bb5\u3002 \u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\u7684\u5b57\u6bb5\u53ea\u6709\u4e3b\u952e+\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u5373\u4f7f\u4f7f\u7528\u4e86\u5de6\u6a21\u7cca\u5339\u914d\uff0c\u4e5f\u4e0d\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff08type=all\uff09\uff0c\u800c\u662f\u8d70\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811(type=index)\u3002 \u518d\u8bf4\u4e00\u4e2a\u76f8\u4f3c\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u8054\u5408\u7d22\u5f15\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u624d\u80fd\u8d70\u7d22\u5f15\uff0c\u4f46\u662f\u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\u7684\u5b57\u6bb5\u90fd\u662f\u7d22\u5f15\u7684\u8bdd\uff0c\u5373\u4f7f\u67e5\u8be2\u8fc7\u7a0b\u4e2d\uff0c\u6ca1\u6709\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u662f\u8d70\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811(type=index)\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a \u5c31\u8bf4\u5230\u8fd9\u4e86\uff0c\u4e0b\u6b21\u89c1\u5566 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u4f7f\u7528 like \u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f"},{"location":"mysql/index/index_issue/#mysql-like-x","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6628\u5929\u53d1\u4e86\u4e00\u7bc7\u5173\u4e8e\u7d22\u5f15\u5931\u6548\u7684\u6587\u7ae0\uff1a \u8c01\u8fd8\u6ca1\u78b0\u8fc7\u7d22\u5f15\u5931\u6548\u5462 \u6211\u5728\u6587\u672b\u7559\u4e86\u4e00\u4e2a\u6709\u70b9\u610f\u601d\u7684\u601d\u8003\u9898\uff1a \u8fd9\u4e2a\u601d\u8003\u9898\u5176\u5b9e\u662f\u51fa\u81ea\u4e8e\uff0c\u6211\u4e4b\u524d\u8fd9\u7bc7\u6587\u7ae0\u300c \u4e00\u6761 SQL \u8bed\u53e5\u5f15\u53d1\u7684\u601d\u8003 \u300d\u4e2d\u7559\u8a00\u533a\u4e00\u4f4d\u8bfb\u8005\u670b\u53cb\u51fa\u7684\u95ee\u9898\u3002 \u5f88\u591a\u8bfb\u8005\u90fd\u5728\u7559\u8a00\u533a\u8bf4\u4e86\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u4e5f\u6709\u4e0d\u5c11\u8bfb\u8005\u79c1\u804a\u6211\u7b54\u6848\u5230\u5e95\u662f\u4ec0\u4e48\uff1f \u6240\u4ee5\uff0c\u6211\u4eca\u665a\u5c31\u8ddf\u5927\u5bb6\u804a\u804a\u8fd9\u4e2a\u601d\u8003\u9898\u3002","title":"MySQL \u4f7f\u7528 like \u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f"},{"location":"mysql/index/index_issue/#_1","text":"\u9898\u76ee\u4e00\u5f88\u7b80\u5355\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u80fd\u5206\u6790\u51fa\u7b54\u6848\uff0c\u6211\u6628\u5929\u5206\u4eab\u7684\u7d22\u5f15\u5931\u6548\u6587\u7ae0\u91cc\u4e5f\u63d0\u53ca\u8fc7\u3002 **\u300c\u9898\u76ee 1 \u300d**\u7684\u6570\u636e\u5e93\u8868\u5982\u4e0b\uff0cid \u662f\u4e3b\u952e\u7d22\u5f15\uff0cname \u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5176\u4ed6\u5b57\u6bb5\u90fd\u662f\u975e\u7d22\u5f15\u5b57\u6bb5\u3002 \u8fd9\u56db\u6761\u6a21\u7cca\u5339\u914d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u7b2c\u4e00\u6761\u548c\u7b2c\u4e8c\u6761\u90fd\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u800c\u4e14\u90fd\u662f\u9009\u62e9\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\uff08index_name\uff09\uff0c\u6211\u8d34\u4e2a\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u7ed3\u679c\u56fe\uff1a \u800c\u7b2c\u4e09\u548c\u7b2c\u56db\u6761\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\uff0c\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c type= ALL\uff0c\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\u3002","title":"\u9898\u76ee\u4e00"},{"location":"mysql/index/index_issue/#_2","text":"\u9898\u76ee 2 \u7684\u6570\u636e\u5e93\u8868\u7279\u522b\u4e4b\u5904\u5728\u4e8e\uff0c\u53ea\u6709\u4e24\u4e2a\u5b57\u6bb5\uff0c\u4e00\u4e2a\u662f\u4e3b\u952e\u7d22\u5f15 id\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u4e8c\u7ea7\u7d22\u5f15 name\u3002 \u9488\u5bf9\u9898\u76ee 2 \u7684\u6570\u636e\u8868\uff0c\u7b2c\u4e00\u6761\u548c\u7b2c\u4e8c\u6761\u6a21\u7cca\u67e5\u8be2\u8bed\u53e5\u4e5f\u662f\u4e00\u6837\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0cExtra \u91cc\u7684 Using index \u8bf4\u660e\u7528\u4e0a\u4e86\u8986\u76d6\u7d22\u5f15\uff1a \u6211\u4eec\u6765\u770b\u4e00\u4e0b\u7b2c\u4e09\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\uff08\u7b2c\u56db\u6761\u4e5f\u662f\u4e00\u6837\u7684\u7ed3\u679c\uff09\uff1a \u4ece\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230 key=index_name\uff0c\u4e5f\u5c31\u662f\u8bf4\u7528\u4e0a\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u800c\u4e14\u4ece Extra \u91cc\u7684 Using index \u8bf4\u660e\u7528\u4e0a\u4e86\u8986\u76d6\u7d22\u5f15\u3002 \u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f \u9996\u5148\uff0c\u8fd9\u5f20\u8868\u7684\u5b57\u6bb5\u6ca1\u6709\u300c\u975e\u7d22\u5f15\u300d\u5b57\u6bb5\uff0c\u6240\u4ee5 select * \u76f8\u5f53\u4e8e select id,name \uff0c\u7136\u540e**\u8fd9\u4e2a\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\uff0c\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u5305\u542b\u300c\u7d22\u5f15\u503c+\u4e3b\u952e\u503c\u300d\uff0c\u6240\u4ee5\u67e5\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5c31\u80fd\u67e5\u5230\u5168\u90e8\u7ed3\u679c\u4e86\uff0c\u8fd9\u4e2a\u5c31\u662f\u8986\u76d6\u7d22\u5f15\u3002** \u4f46\u662f\u6267\u884c\u8ba1\u5212\u91cc\u7684 type \u662f index \uff0c\u8fd9\u4ee3\u8868\u7740\u662f\u901a\u8fc7\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u65b9\u5f0f\u67e5\u8be2\u5230\u6570\u636e\u7684\uff0c\u4e5f\u5c31\u662f\u904d\u5386\u4e86\u6574\u9897\u7d22\u5f15\u6811\u3002 \u800c\u7b2c\u4e00\u548c\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u4e2d type \u662f range \uff0c\u8868\u793a\u5bf9\u7d22\u5f15\u5217\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u5229\u7528\u4e86\u7d22\u5f15\u6811\u7684\u6709\u5e8f\u6027\u7684\u7279\u70b9\uff0c\u901a\u8fc7\u67e5\u8be2\u6bd4\u8f83\u7684\u65b9\u5f0f\uff0c\u5feb\u901f\u5b9a\u4f4d\u5230\u4e86\u6570\u636e\u884c\u3002 \u6240\u4ee5\uff0ctype=range \u7684\u67e5\u8be2\u6548\u7387\u4f1a\u6bd4 type=index \u7684\u9ad8\u4e00\u4e9b\u3002 \u4e3a\u4ec0\u4e48\u9009\u62e9\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811\uff0c\u800c\u4e0d\u626b\u63cf\u805a\u7c07\u7d22\u5f15\u6811\u5462\uff1f \u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u6811\u7684\u8bb0\u5f55\u4e1c\u897f\u5f88\u5c11\uff0c\u5c31\u53ea\u6709\u300c\u7d22\u5f15\u5217+\u4e3b\u952e\u503c\u300d\uff0c\u800c\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u7684\u4e1c\u897f\u4f1a\u66f4\u591a\uff0c\u6bd4\u5982\u805a\u7c07\u7d22\u5f15\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u5219\u8bb0\u5f55\u4e86\u4e3b\u952e\u503c\u3001\u4e8b\u52a1 id\u3001\u7528\u4e8e\u4e8b\u52a1\u548c MVCC \u7684\u56de\u6eda\u6307\u9488\u4ee5\u53ca\u6240\u6709\u7684\u5269\u4f59\u5217\u3002 \u518d\u52a0\u4e0a\uff0c\u8fd9\u4e2a select * \u4e0d\u7528\u6267\u884c\u56de\u8868\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c MySQL \u4f18\u5316\u5668\u8ba4\u4e3a\u76f4\u63a5\u904d\u5386\u4e8c\u7ea7\u7d22\u5f15\u6811\u8981\u6bd4\u904d\u5386\u805a\u7c07\u7d22\u5f15\u6811\u7684\u6210\u672c\u8981\u5c0f\u7684\u591a\uff0c\u56e0\u6b64 MySQL \u9009\u62e9\u4e86\u300c\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811\u300d\u7684\u65b9\u5f0f\u67e5\u8be2\u6570\u636e\u3002 \u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u6570\u636e\u8868\u52a0\u4e86\u975e\u7d22\u5f15\u5b57\u6bb5\uff0c\u6267\u884c\u540c\u6837\u7684\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u600e\u4e48\u53d8\u6210\u8d70\u7684\u662f\u5168\u8868\u626b\u63cf\u5462\uff1f \u52a0\u4e86\u5176\u4ed6\u5b57\u6bb5\u540e\uff0c select * from t_user where name like \"%xx\"; \u8981\u67e5\u8be2\u7684\u6570\u636e\u5c31\u4e0d\u80fd\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u91cc\u627e\u4e86\uff0c\u5f97\u9700\u8981\u56de\u8868\u64cd\u4f5c\u624d\u80fd\u5b8c\u6210\u67e5\u8be2\u7684\u5de5\u4f5c\uff0c\u518d\u52a0\u4e0a\u662f\u5de6\u6a21\u7cca\u5339\u914d\uff0c\u65e0\u6cd5\u5229\u7528\u7d22\u5f15\u6811\u7684\u6709\u5e8f\u6027\u6765\u5feb\u901f\u5b9a\u4f4d\u6570\u636e\uff0c\u6240\u4ee5\u5f97\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u9010\u4e00\u904d\u5386\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\u540e\uff0c\u518d\u5230\u805a\u7c07\u7d22\u5f15\u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u6570\u636e\u884c\uff0c\u8fd9\u6837\u5b9e\u5728\u592a\u7d2f\u4e86\u3002 \u6240\u4ee5\uff0c\u4f18\u5316\u5668\u8ba4\u4e3a\u4e0a\u9762\u8fd9\u6837\u7684\u67e5\u8be2\u8fc7\u7a0b\u7684\u6210\u672c\u5b9e\u5728\u592a\u9ad8\u4e86\uff0c\u6240\u4ee5\u76f4\u63a5\u9009\u62e9\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u67e5\u8be2\u6570\u636e\u3002 \u4ece\u8fd9\u4e2a\u601d\u8003\u9898\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u4f7f\u7528\u5de6\u6a21\u7cca\u5339\u914d\uff08like \"%xx\"\uff09\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff0c\u5173\u952e\u8fd8\u662f\u770b\u6570\u636e\u8868\u4e2d\u7684\u5b57\u6bb5\u3002 \u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\u7684\u5b57\u6bb5\u53ea\u6709\u4e3b\u952e+\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u5373\u4f7f\u4f7f\u7528\u4e86\u5de6\u6a21\u7cca\u5339\u914d\uff0c\u4e5f\u4e0d\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff08type=all\uff09\uff0c\u800c\u662f\u8d70\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811(type=index)\u3002 \u518d\u8bf4\u4e00\u4e2a\u76f8\u4f3c\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u8054\u5408\u7d22\u5f15\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u624d\u80fd\u8d70\u7d22\u5f15\uff0c\u4f46\u662f\u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\u7684\u5b57\u6bb5\u90fd\u662f\u7d22\u5f15\u7684\u8bdd\uff0c\u5373\u4f7f\u67e5\u8be2\u8fc7\u7a0b\u4e2d\uff0c\u6ca1\u6709\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u662f\u8d70\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811(type=index)\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a \u5c31\u8bf4\u5230\u8fd9\u4e86\uff0c\u4e0b\u6b21\u89c1\u5566 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u9898\u76ee\u4e8c"},{"location":"mysql/index/index_lose/","text":"\u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5728\u5de5\u4f5c\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u60f3\u63d0\u9ad8\u4e00\u6761\u8bed\u53e5\u67e5\u8be2\u901f\u5ea6\uff0c\u901a\u5e38\u90fd\u4f1a\u60f3\u5bf9\u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\u3002 \u4f46\u662f\u7d22\u5f15\u5e76\u4e0d\u662f\u4e07\u80fd\u7684\u3002\u5efa\u7acb\u4e86\u7d22\u5f15\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u4efb\u4f55\u67e5\u8be2\u8bed\u53e5\u90fd\u80fd\u8d70\u7d22\u5f15\u626b\u63cf\u3002 \u7a0d\u4e0d\u6ce8\u610f\uff0c\u53ef\u80fd\u4f60\u5199\u7684\u67e5\u8be2\u8bed\u53e5\u662f\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u4ece\u800c\u8d70\u4e86\u5168\u8868\u626b\u63cf\uff0c\u867d\u7136\u67e5\u8be2\u7684\u7ed3\u679c\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u67e5\u8be2\u7684\u6027\u80fd\u5927\u5927\u964d\u4f4e\u3002 \u4eca\u5929\u5c31\u6765\u8ddf\u5927\u5bb6\u76d8\u4e00\u76d8\uff0c\u5e38\u89c1\u7684 6 \u79cd\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\u3002 \u4e0d\u4ec5\u4f1a\u7528\u5b9e\u9a8c\u6848\u4f8b\u7ed9\u5927\u5bb6\u8bf4\u660e\uff0c\u4e5f\u4f1a\u6e05\u695a\u6bcf\u4e2a\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0 \u3002 \u53d1\u8f66\uff01 \u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\uff1f \u00b6 \u6211\u4eec\u5148\u6765\u770b\u770b\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\uff1f\u56e0\u4e3a\u53ea\u6709\u77e5\u9053\u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u624d\u80fd\u66f4\u597d\u7684\u7406\u89e3\u7d22\u5f15\u5931\u6548\u7684\u95ee\u9898\u3002 \u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\u8ddf MySQL \u4f7f\u7528\u54ea\u79cd\u5b58\u50a8\u5f15\u64ce\u6709\u5173\uff0c\u56e0\u4e3a\u5b58\u50a8\u5f15\u64ce\u5c31\u662f\u8d1f\u8d23\u5c06\u6570\u636e\u6301\u4e45\u5316\u5728\u78c1\u76d8\u4e2d\uff0c\u800c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u91c7\u7528\u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\u4e5f\u4f1a\u4e0d\u76f8\u540c\u3002 MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u662f InnoDB\uff0c\u5b83\u91c7\u7528 B+Tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u9009\u62e9 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784 \uff0c\u8be6\u7ec6\u7684\u5206\u6790\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a \u4e3a\u4ec0\u4e48 MySQL \u559c\u6b22 B+ \u6811\uff1f \u5728\u521b\u5efa\u8868\u65f6\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u5176\u5b83\u7d22\u5f15\u90fd\u5c5e\u4e8e\u4e8c\u7ea7\u7d22\u5f15\u3002 MySQL \u7684 MyISAM \u5b58\u50a8\u5f15\u64ce\u652f\u6301\u591a\u79cd\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u6bd4\u5982 B+ \u6811\u7d22\u5f15\u3001R \u6811\u7d22\u5f15\u3001Full-Text \u7d22\u5f15\u3002MyISAM \u5b58\u50a8\u5f15\u64ce\u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+ \u6811\u7d22\u5f15\u3002 \u867d\u7136\uff0cInnoDB \u548c MyISAM \u90fd\u652f\u6301 B+ \u6811\u7d22\u5f15\uff0c\u4f46\u662f\u5b83\u4eec\u6570\u636e\u7684\u5b58\u50a8\u7ed3\u6784\u5b9e\u73b0\u65b9\u5f0f\u4e0d\u540c\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a InnoDB \u5b58\u50a8\u5f15\u64ce\uff1aB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u672c\u8eab\uff1b MyISAM \u5b58\u50a8\u5f15\u64ce\uff1aB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u7684\u7269\u7406\u5730\u5740\uff1b \u63a5\u4e0b\u6765\uff0c\u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u7ed9\u5927\u5bb6\u5c55\u793a\u4e0b\u8fd9\u4e24\u79cd\u5b58\u50a8\u5f15\u64ce\u7684\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u7684\u533a\u522b\u3002 \u8fd9\u91cc\u6709\u4e00\u5f20 t_user \u8868\uff0c\u5176\u4e2d id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0c\u5176\u4ed6\u90fd\u662f\u666e\u901a\u5b57\u6bb5\u3002 \u5982\u679c\u4f7f\u7528\u7684\u662f MyISAM \u5b58\u50a8\u5f15\u64ce\uff0cB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u7684\u7269\u7406\u5730\u5740\uff0c\u5373\u7528\u6237\u6570\u636e\u7684\u6307\u9488\uff0c\u5982\u4e0b\u56fe\uff1a \u5982\u679c\u4f7f\u7528\u7684\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c B+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u672c\u8eab\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a InnoDB \u5b58\u50a8\u5f15\u64ce\u6839\u636e\u7d22\u5f15\u7c7b\u578b\u4e0d\u540c\uff0c\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\uff08\u4e0a\u56fe\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff09\u548c\u4e8c\u7ea7\u7d22\u5f15\u3002\u5b83\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u6570\u636e\u90fd\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u5982\u679c\u5c06 name \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u666e\u901a\u7d22\u5f15\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u957f\u4e0b\u56fe\u8fd9\u6837\uff0c\u53f6\u5b50\u8282\u70b9\u4ec5\u5b58\u653e\u4e3b\u952e\u503c\u3002 \u77e5\u9053\u4e86 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\u540e\uff0c\u63a5\u4e0b\u6765\u4e3e\u51e0\u4e2a\u67e5\u8be2\u8bed\u53e5\uff0c\u8bf4\u4e0b\u67e5\u8be2\u8fc7\u7a0b\u662f\u600e\u4e48\u9009\u62e9\u7528\u54ea\u4e2a\u7d22\u5f15\u7c7b\u578b\u7684\u3002 \u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e3b\u952e\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u90a3\u4e48\u5c31\u4f1a\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u4e2d\u7684 B+ \u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u76f4\u63a5\u8bfb\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\u3002\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a // id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15 select * from t_user where id=1; \u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u90a3\u4e48\u9700\u8981\u68c0\u7d22\u4e24\u9897B+\u6811\uff1a \u5148\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684 B+ \u6811\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff1b \u7136\u540e\u7528\u4e0a\u4e00\u6b65\u83b7\u53d6\u7684\u4e3b\u952e\u503c\uff0c\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u4e2d\u7684 B+ \u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\u3002 \u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a**\u56de\u8868**\uff0c\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where name=\"\u6797\u67d0\"; \u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684 B+ \u6811\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u8bfb\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a**\u8986\u76d6\u7d22\u5f15**\u3002\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select id from t_user where name=\"\u6797\u67d0\"; \u4e0a\u9762\u8fd9\u4e9b\u67e5\u8be2\u8bed\u53e5\u7684\u6761\u4ef6\u90fd\u7528\u5230\u4e86\u7d22\u5f15\u5217\uff0c\u6240\u4ee5\u5728\u67e5\u8be2\u8fc7\u7a0b\u90fd\u7528\u4e0a\u4e86\u7d22\u5f15\u3002 \u4f46\u662f\u5e76\u4e0d\u610f\u5473\u7740\uff0c\u67e5\u8be2\u6761\u4ef6\u7528\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u5c31\u67e5\u8be2\u8fc7\u7a0b\u5c31\u4e00\u5b9a\u90fd\u7528\u4e0a\u7d22\u5f15\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u4e00\u8d77\u770b\u770b\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u53d1\u751f\u5168\u8868\u626b\u63cf\u3002 \u9996\u5148\u8bf4\u660e\u4e0b\uff0c\u4e0b\u9762\u7684\u5b9e\u9a8c\u6848\u4f8b\uff0c\u6211\u4f7f\u7528\u7684 MySQL \u7248\u672c\u4e3a 8.0.26 \u3002 \u5bf9\u7d22\u5f15\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d \u00b6 \u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f like %xx \u6216\u8005 like %xx% \u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\u3002 \u6bd4\u5982\u4e0b\u9762\u7684 like \u8bed\u53e5\uff0c\u67e5\u8be2 name \u540e\u7f00\u4e3a\u300c\u6797\u300d\u7684\u7528\u6237\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=ALL \u5c31\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\uff0c\u800c\u6ca1\u6709\u8d70\u7d22\u5f15\u3002 // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where name like '%\u6797'; \u5982\u679c\u662f\u67e5\u8be2 name \u524d\u7f00\u4e3a\u6797\u7684\u7528\u6237\uff0c\u90a3\u4e48\u5c31\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=range \u8868\u793a\u8d70\u7d22\u5f15\u626b\u63cf\uff0ckey=index_name \u770b\u5230\u5b9e\u9645\u8d70\u4e86 index_name \u7d22\u5f15\uff1a // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where name like '\u6797%'; \u4e3a\u4ec0\u4e48 like \u5173\u952e\u5b57\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u65e0\u6cd5\u8d70\u7d22\u5f15\u5462\uff1f \u56e0\u4e3a\u7d22\u5f15 B+ \u6811\u662f\u6309\u7167\u300c\u7d22\u5f15\u503c\u300d\u6709\u5e8f\u6392\u5217\u5b58\u50a8\u7684\uff0c\u53ea\u80fd\u6839\u636e\u524d\u7f00\u8fdb\u884c\u6bd4\u8f83\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u8fd9\u5f20\u4e8c\u7ea7\u7d22\u5f15\u56fe\uff0c\u662f\u4ee5 name \u5b57\u6bb5\u6709\u5e8f\u6392\u5217\u5b58\u50a8\u7684\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u67e5\u8be2 name \u5b57\u6bb5\u524d\u7f00\u4e3a\u300c\u6797\u300d\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f name like '\u6797%' \uff0c\u626b\u63cf\u7d22\u5f15\u7684\u8fc7\u7a0b\uff1a \u9996\u8282\u70b9\u67e5\u8be2\u6bd4\u8f83\uff1a\u6797\u8fd9\u4e2a\u5b57\u7684\u62fc\u97f3\u5927\u5c0f\u6bd4\u9996\u8282\u70b9\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u9648\u5b57\u5927\uff0c\u4f46\u662f\u6bd4\u9996\u8282\u70b9\u7684\u7b2c\u4e8c\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u5468\u5b57\u5c0f\uff0c\u6240\u4ee5\u9009\u62e9\u53bb\u8282\u70b92\u7ee7\u7eed\u67e5\u8be2\uff1b \u8282\u70b9 2 \u67e5\u8be2\u6bd4\u8f83\uff1a\u8282\u70b92\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u9648\u5b57\u7684\u62fc\u97f3\u5927\u5c0f\u6bd4\u6797\u5b57\u5c0f\uff0c\u6240\u4ee5\u7ee7\u7eed\u770b\u4e0b\u4e00\u4e2a\u7d22\u5f15\u503c\uff0c\u53d1\u73b0\u8282\u70b92\u6709\u4e0e\u6797\u5b57\u524d\u7f00\u5339\u914d\u7684\u7d22\u5f15\u503c\uff0c\u4e8e\u662f\u5c31\u5f80\u53f6\u5b50\u8282\u70b9\u67e5\u8be2\uff0c\u5373\u53f6\u5b50\u8282\u70b94\uff1b \u8282\u70b9 4 \u67e5\u8be2\u6bd4\u8f83\uff1a\u8282\u70b94\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u7684\u524d\u7f00\u7b26\u5408\u6797\u5b57\uff0c\u4e8e\u662f\u5c31\u8bfb\u53d6\u8be5\u884c\u6570\u636e\uff0c\u63a5\u7740\u7ee7\u7eed\u5f80\u53f3\u5339\u914d\uff0c\u76f4\u5230\u5339\u914d\u4e0d\u5230\u524d\u7f00\u4e3a\u6797\u7684\u7d22\u5f15\u503c\u3002 \u5982\u679c\u4f7f\u7528 name like '%\u6797' \u65b9\u5f0f\u6765\u67e5\u8be2\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u7ed3\u679c\u53ef\u80fd\u662f\u300c\u9648\u6797\u3001\u5f20\u6797\u3001\u5468\u6797\u300d\u7b49\u4e4b\u7c7b\u7684\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u4ece\u54ea\u4e2a\u7d22\u5f15\u503c\u5f00\u59cb\u6bd4\u8f83\uff0c\u4e8e\u662f\u5c31\u53ea\u80fd\u901a\u8fc7\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u67e5\u8be2\u3002 \u60f3\u8981\u66f4\u8be6\u7ec6\u4e86\u89e3 InnoDB \u7684 B+ \u6811\u67e5\u8be2\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u6211\u5199\u7684\u8fd9\u7bc7\uff1a B+ \u6811\u91cc\u7684\u8282\u70b9\u91cc\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u67e5\u8be2\u6570\u636e\u7684\u8fc7\u7a0b\u53c8\u662f\u600e\u6837\u7684\uff1f \u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570 \u00b6 \u6709\u65f6\u5019\u6211\u4eec\u4f1a\u7528\u4e00\u4e9b MySQL \u81ea\u5e26\u7684\u51fd\u6570\u6765\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\uff0c\u8fd9\u65f6\u5019\u8981\u6ce8\u610f\u4e86\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5b57\u6bb5\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u6bd4\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9 name \u5b57\u6bb5\u4f7f\u7528\u4e86 LENGTH \u51fd\u6570\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=ALL\uff0c\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\uff1a // name \u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where length(name)=6; \u4e3a\u4ec0\u4e48\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u65e0\u6cd5\u8d70\u7d22\u5f15\u4e86\u5462\uff1f \u56e0\u4e3a\u7d22\u5f15\u4fdd\u5b58\u7684\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u539f\u59cb\u503c\uff0c\u800c\u4e0d\u662f\u7ecf\u8fc7\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u81ea\u7136\u5c31\u6ca1\u529e\u6cd5\u8d70\u7d22\u5f15\u4e86\u3002 \u4e0d\u8fc7\uff0c\u4ece MySQL 8.0 \u5f00\u59cb\uff0c\u7d22\u5f15\u7279\u6027\u589e\u52a0\u4e86\u51fd\u6570\u7d22\u5f15\uff0c\u5373\u53ef\u4ee5\u9488\u5bf9\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5\u7d22\u5f15\u7684\u503c\u662f\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u901a\u8fc7\u626b\u63cf\u7d22\u5f15\u6765\u67e5\u8be2\u6570\u636e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u901a\u8fc7\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff0c\u5bf9 length(name) \u7684\u8ba1\u7b97\u7ed3\u679c\u5efa\u7acb\u4e00\u4e2a\u540d\u4e3a idx_name_length \u7684\u7d22\u5f15\u3002 alter table t_user add key idx_name_length ((length(name))); \u7136\u540e\u6211\u518d\u7528\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd9\u65f6\u5019\u5c31\u4f1a\u8d70\u7d22\u5f15\u4e86\u3002 \u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97 \u00b6 \u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u4e5f\u662f\u65e0\u6cd5\u8d70\u7d22\u5f15\u7684\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u6267\u884c\u8ba1\u5212\u4e2d type = ALL\uff0c\u8bf4\u660e\u662f\u901a\u8fc7\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\u6570\u636e\u7684\uff1a explain select * from t_user where id + 1 = 10; \u4f46\u662f\uff0c\u5982\u679c\u628a\u67e5\u8be2\u8bed\u53e5\u7684\u6761\u4ef6\u6539\u6210 where id = 10 - 1\uff0c\u8fd9\u6837\u5c31\u4e0d\u662f\u5728\u7d22\u5f15\u5b57\u6bb5\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u4e86\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u8d70\u7d22\u5f15\u67e5\u8be2\u4e86\u3002 \u4e3a\u4ec0\u4e48\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u5c31\u65e0\u6cd5\u8d70\u7d22\u5f15\u4e86\u5462\uff1f \u539f\u56e0\u8ddf\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\u5dee\u4e0d\u591a\u3002 \u56e0\u4e3a\u7d22\u5f15\u4fdd\u5b58\u7684\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u539f\u59cb\u503c\uff0c\u800c\u4e0d\u662f id + 1 \u8868\u8fbe\u5f0f\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u6240\u4ee5\u65e0\u6cd5\u8d70\u7d22\u5f15\uff0c\u53ea\u80fd\u901a\u8fc7\u628a\u7d22\u5f15\u5b57\u6bb5\u7684\u53d6\u503c\u90fd\u53d6\u51fa\u6765\uff0c\u7136\u540e\u4f9d\u6b21\u8fdb\u884c\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u6765\u8fdb\u884c\u6761\u4ef6\u5224\u65ad\uff0c\u56e0\u6b64\u91c7\u7528\u7684\u5c31\u662f\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u3002 \u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u8bf4\uff0c\u8fd9\u79cd\u5bf9\u7d22\u5f15\u8fdb\u884c\u7b80\u5355\u7684\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u5728\u4ee3\u7801\u7279\u6b8a\u5904\u7406\u4e0b\uff0c\u5e94\u8be5\u662f\u53ef\u4ee5\u505a\u5230\u7d22\u5f15\u626b\u63cf\u7684\uff0c\u6bd4\u65b9\u5c06 id + 1 = 10 \u53d8\u6210 id = 10 - 1\u3002 \u662f\u7684\uff0c\u662f\u80fd\u591f\u5b9e\u73b0\uff0c\u4f46\u662f MySQL \u8fd8\u662f\u5077\u4e86\u8fd9\u4e2a\u61d2\uff0c\u6ca1\u6709\u5b9e\u73b0\u3002 \u6211\u7684\u60f3\u6cd5\u662f\uff0c\u53ef\u80fd\u4e5f\u662f\u56e0\u4e3a\uff0c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u7684\u60c5\u51b5\u591a\u79cd\u591a\u6837\uff0c\u6bcf\u79cd\u90fd\u8981\u8003\u8651\u7684\u8bdd\uff0c\u4ee3\u7801\u53ef\u80fd\u4f1a\u5f88\u81c3\u80bf\uff0c\u6240\u4ee5\u5e72\u8106\u5c06\u8fd9\u79cd\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\u544a\u8bc9\u7a0b\u5e8f\u5458\uff0c\u8ba9\u7a0b\u5e8f\u5458\u81ea\u5df1\u4fdd\u8bc1\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u4e0d\u8981\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u3002 \u5bf9\u7d22\u5f15\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362 \u00b6 \u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u662f\u5728\u6761\u4ef6\u67e5\u8be2\u4e2d\uff0c\u8f93\u5165\u7684\u53c2\u6570\u662f\u6574\u578b\u7684\u8bdd\uff0c\u4f60\u4f1a\u5728\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u53d1\u73b0\u8fd9\u6761\u8bed\u53e5\u4f1a\u8d70\u5168\u8868\u626b\u63cf\u3002 \u6211\u5728\u539f\u672c\u7684 t_user \u8868\u589e\u52a0\u4e86 phone \u5b57\u6bb5\uff0c\u662f\u4e8c\u7ea7\u7d22\u5f15\u4e14\u7c7b\u578b\u662f varchar\u3002 \u7136\u540e\u6211\u5728\u6761\u4ef6\u67e5\u8be2\u4e2d\uff0c\u7528\u6574\u578b\u4f5c\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u6b64\u65f6\u6267\u884c\u8ba1\u5212\u4e2d type = ALL\uff0c\u6240\u4ee5\u662f\u901a\u8fc7\u5168\u8868\u626b\u63cf\u6765\u67e5\u8be2\u6570\u636e\u7684\u3002 select * from t_user where phone = 1300000001; \u4f46\u662f\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u662f\u6574\u578b\u7c7b\u578b\uff0c\u67e5\u8be2\u6761\u4ef6\u4e2d\u7684\u8f93\u5165\u53c2\u6570\u5373\u4f7f\u5b57\u7b26\u4e32\uff0c\u662f\u4e0d\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u8fd8\u662f\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\u3002 \u6211\u4eec\u518d\u770b\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\uff0cid \u662f\u6574\u578b\uff0c\u4f46\u662f\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u8fd8\u662f\u8d70\u4e86\u7d22\u5f15\u626b\u63cf\u7684\u3002 explain select * from t_user where id = '1'; \u4e3a\u4ec0\u4e48\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u7b2c\u4e8c\u4f8b\u5b50\u4e0d\u4f1a\u5462\uff1f \u8981\u660e\u767d\u8fd9\u4e2a\u539f\u56e0\uff0c\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053 MySQL \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\u662f\u4ec0\u4e48\uff1f\u5c31\u662f\u770b MySQL \u662f\u4f1a\u5c06\u5b57\u7b26\u4e32\u8f6c\u6210\u6570\u5b57\u5904\u7406\uff0c\u8fd8\u662f\u5c06\u6570\u5b57\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u5904\u7406\u3002 \u6211\u5728\u770b\u300amysql45\u8bb2\u7684\u65f6\u5019\u300b\u770b\u5230\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u65b9\u5f0f\uff0c\u5c31\u662f\u901a\u8fc7 select \u201c10\u201d > 9 \u7684\u7ed3\u679c\u6765\u77e5\u9053MySQL \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\u662f\u4ec0\u4e48\uff1a \u5982\u679c\u89c4\u5219\u662f MySQL \u4f1a\u5c06\u81ea\u52a8\u300c\u5b57\u7b26\u4e32\u300d\u8f6c\u6362\u6210\u300c\u6570\u5b57\u300d\uff0c\u5c31\u76f8\u5f53\u4e8e select 10 > 9\uff0c\u8fd9\u4e2a\u5c31\u662f\u6570\u5b57\u6bd4\u8f83\uff0c\u6240\u4ee5\u7ed3\u679c\u5e94\u8be5\u662f 1\uff1b \u5982\u679c\u89c4\u5219\u662f MySQL \u4f1a\u5c06\u81ea\u52a8\u300c\u6570\u5b57\u300d\u8f6c\u6362\u6210\u300c\u5b57\u7b26\u4e32\u300d\uff0c\u5c31\u76f8\u5f53\u4e8e select \"10\" > \"9\"\uff0c\u8fd9\u4e2a\u662f\u5b57\u7b26\u4e32\u6bd4\u8f83\uff0c\u5b57\u7b26\u4e32\u6bd4\u8f83\u5927\u5c0f\u662f\u9010\u4f4d\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u9010\u4e2a\u6bd4\u8f83\uff08\u6309ascii\u7801\uff09 \uff0c\u90a3\u4e48\"10\"\u5b57\u7b26\u4e32\u76f8\u5f53\u4e8e \u201c1\u201d\u548c\u201c0\u201d\u5b57\u7b26\u7684\u7ec4\u5408\uff0c\u6240\u4ee5\u5148\u662f\u62ff \u201c1\u201d \u5b57\u7b26\u548c \u201c9\u201d \u5b57\u7b26\u6bd4\u8f83\uff0c\u56e0\u4e3a \u201c1\u201d \u5b57\u7b26\u6bd4 \u201c9\u201d \u5b57\u7b26\u5c0f\uff0c\u6240\u4ee5\u7ed3\u679c\u5e94\u8be5\u662f 0\u3002 \u5728 MySQL \u4e2d\uff0c\u6267\u884c\u7684\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a \u4e0a\u9762\u7684\u7ed3\u679c\u4e3a 1\uff0c\u8bf4\u660e MySQL \u5728\u9047\u5230\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6bd4\u8f83 \u3002 \u524d\u9762\u7684\u4f8b\u5b50\u4e00\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u6211\u4e5f\u8ddf\u5927\u5bb6\u8bf4\u4e86\u662f\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff1a //\u4f8b\u5b50\u4e00\u7684\u67e5\u8be2\u8bed\u53e5 select * from t_user where phone = 1300000001; \u8fd9\u662f\u56e0\u4e3a phone \u5b57\u6bb5\u4e3a\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5 MySQL \u8981\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u6240\u4ee5\u8fd9\u6761\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a select * from t_user where CAST(phone AS signed int) = 1300000001; \u53ef\u4ee5\u770b\u5230\uff0c CAST \u51fd\u6570\u662f\u4f5c\u7528\u5728\u4e86 phone \u5b57\u6bb5\uff0c\u800c phone \u5b57\u6bb5\u662f\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u5bf9\u7d22\u5f15\u4f7f\u7528\u4e86\u51fd\u6570\uff01\u800c\u524d\u9762\u6211\u4eec\u4e5f\u8bf4\u4e86\uff0c\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\u662f\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684 \u3002 \u4f8b\u5b50\u4e8c\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u6211\u8ddf\u5927\u5bb6\u8bf4\u4e86\u662f\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff1a //\u4f8b\u5b50\u4e8c\u7684\u67e5\u8be2\u8bed\u53e5 select * from t_user where id = \"1\"; \u8fd9\u65f6\u56e0\u4e3a\u5b57\u7b26\u4e32\u90e8\u5206\u662f\u8f93\u5165\u53c2\u6570\uff0c\u4e5f\u5c31\u9700\u8981\u5c06\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u6240\u4ee5\u8fd9\u6761\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a select * from t_user where id = CAST(\"1\" AS signed int); \u53ef\u4ee5\u770b\u5230\uff0c\u7d22\u5f15\u5b57\u6bb5\u5e76\u6ca1\u6709\u7528\u4efb\u4f55\u51fd\u6570\uff0cCAST \u51fd\u6570\u662f\u7528\u5728\u4e86\u8f93\u5165\u53c2\u6570\uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\u7684\u3002 \u8054\u5408\u7d22\u5f15\u975e\u6700\u5de6\u5339\u914d \u00b6 \u5bf9\u4e3b\u952e\u5b57\u6bb5\u5efa\u7acb\u7684\u7d22\u5f15\u53eb\u505a\u805a\u7c07\u7d22\u5f15\uff0c\u5bf9\u666e\u901a\u5b57\u6bb5\u5efa\u7acb\u7684\u7d22\u5f15\u53eb\u505a\u4e8c\u7ea7\u7d22\u5f15\u3002 \u90a3\u4e48**\u591a\u4e2a\u666e\u901a\u5b57\u6bb5\u7ec4\u5408\u5728\u4e00\u8d77\u521b\u5efa\u7684\u7d22\u5f15\u5c31\u53eb\u505a\u8054\u5408\u7d22\u5f15**\uff0c\u4e5f\u53eb\u7ec4\u5408\u7d22\u5f15\u3002 \u521b\u5efa\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u521b\u5efa\u65f6\u7684\u987a\u5e8f\u95ee\u9898\uff0c\u56e0\u4e3a\u8054\u5408\u7d22\u5f15 (a, b, c) \u548c (c, b, a) \u5728\u4f7f\u7528\u7684\u65f6\u5019\u4f1a\u5b58\u5728\u5dee\u522b\u3002 \u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa**\u6700\u5de6\u5339\u914d\u539f\u5219**\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\u3002 \u6bd4\u5982\uff0c\u5982\u679c\u521b\u5efa\u4e86\u4e00\u4e2a (a, b, c) \u8054\u5408\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u5c31\u53ef\u4ee5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff1a where a=1\uff1b where a=1 and b=2 and c=3\uff1b where a=1 and b=2\uff1b \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u6709\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u6240\u4ee5 a \u5b57\u6bb5\u5728 where \u5b50\u53e5\u7684\u987a\u5e8f\u5e76\u4e0d\u91cd\u8981\u3002 \u4f46\u662f\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u56e0\u4e3a\u4e0d\u7b26\u5408\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff0c\u8054\u5408\u7d22\u5f15\u5c31\u4f1a\u5931\u6548: where b=2\uff1b where c=3\uff1b where b=2 and c=3\uff1b \u6709\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684\u67e5\u8be2\u6761\u4ef6\uff1awhere a = 1 and c = 3 \uff0c\u7b26\u5408\u6700\u5de6\u5339\u914d\u5417\uff1f \u8fd9\u79cd\u5176\u5b9e\u4e25\u683c\u610f\u4e49\u4e0a\u6765\u8bf4\u662f\u5c5e\u4e8e\u7d22\u5f15\u622a\u65ad\uff0c\u4e0d\u540c\u7248\u672c\u5904\u7406\u65b9\u5f0f\u4e5f\u4e0d\u4e00\u6837\u3002 MySQL 5.5 \u7684\u8bdd\uff0c\u524d\u9762 a \u4f1a\u8d70\u7d22\u5f15\uff0c\u5728\u8054\u5408\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\u540e\uff0c\u5f00\u59cb\u56de\u8868\uff0c\u5230\u4e3b\u952e\u7d22\u5f15\u8bfb\u53d6\u6570\u636e\u884c\uff0c\u7136\u540e\u518d\u6bd4\u5bf9 c \u5b57\u6bb5\u7684\u503c\u3002 \u4ece MySQL 5.6 \u4e4b\u540e\uff0c\u6709\u4e00\u4e2a**\u7d22\u5f15\u4e0b\u63a8\u529f\u80fd**\uff0c\u53ef\u4ee5\u5728\u7d22\u5f15\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5b57\u6bb5\u5148\u505a\u5224\u65ad\uff0c\u76f4\u63a5\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570\u3002 \u5927\u6982\u539f\u7406\u662f\uff1a\u622a\u65ad\u7684\u5b57\u6bb5\u4f1a\u88ab\u4e0b\u63a8\u5230\u5b58\u50a8\u5f15\u64ce\u5c42\u8fdb\u884c\u6761\u4ef6\u5224\u65ad\uff08\u56e0\u4e3a c \u5b57\u6bb5\u7684\u503c\u662f\u5728 (a, b, c) \u8054\u5408\u7d22\u5f15\u91cc\u7684\uff09\uff0c\u7136\u540e\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u540e\u518d\u8fd4\u56de\u7ed9 Server \u5c42\u3002\u7531\u4e8e\u5728\u5f15\u64ce\u5c42\u5c31\u8fc7\u6ee4\u6389\u5927\u91cf\u7684\u6570\u636e\uff0c\u65e0\u9700\u518d\u56de\u8868\u8bfb\u53d6\u6570\u636e\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u5347\u4e86\u6027\u80fd\u3002 \u6bd4\u5982\u4e0b\u9762\u8fd9\u6761 where a = 1 and c = 0 \u8bed\u53e5\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u6267\u884c\u8ba1\u5212\u4e2d\u7684 Extra=Using index condition \u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u529f\u80fd\u3002 \u4e3a\u4ec0\u4e48\u8054\u5408\u7d22\u5f15\u4e0d\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\u5c31\u4f1a\u5931\u6548\uff1f \u539f\u56e0\u662f\uff0c\u5728\u8054\u5408\u7d22\u5f15\u7684\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u662f\u6309\u7167\u7d22\u5f15\u7b2c\u4e00\u5217\u6392\u5e8f\uff0c\u7b2c\u4e00\u5217\u6570\u636e\u76f8\u540c\u65f6\u624d\u4f1a\u6309\u7167\u7b2c\u4e8c\u5217\u6392\u5e8f\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u60f3\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u4e2d\u5c3d\u53ef\u80fd\u591a\u7684\u5217\uff0c\u67e5\u8be2\u6761\u4ef6\u4e2d\u7684\u5404\u4e2a\u5217\u5fc5\u987b\u662f\u8054\u5408\u7d22\u5f15\u4e2d\u4ece\u6700\u5de6\u8fb9\u5f00\u59cb\u8fde\u7eed\u7684\u5217\u3002\u5982\u679c\u6211\u4eec\u4ec5\u4ec5\u6309\u7167\u7b2c\u4e8c\u5217\u641c\u7d22\uff0c\u80af\u5b9a\u65e0\u6cd5\u8d70\u7d22\u5f15\u3002 WHERE \u5b50\u53e5\u4e2d\u7684 OR \u00b6 \u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u67e5\u8be2\u8bed\u53e5\uff0cid \u662f\u4e3b\u952e\uff0cage \u662f\u666e\u901a\u5217\uff0c\u4ece\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u770b\uff0c\u662f\u8d70\u4e86\u5168\u8868\u626b\u63cf\u3002 select * from t_user where id = 1 or age = 18; \u8fd9\u662f\u56e0\u4e3a OR \u7684\u542b\u4e49\u5c31\u662f\u4e24\u4e2a\u53ea\u8981\u6ee1\u8db3\u4e00\u4e2a\u5373\u53ef\uff0c\u56e0\u6b64\u53ea\u6709\u4e00\u4e2a\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u53ea\u8981\u6709\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u5c31\u4f1a\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002 \u8981\u89e3\u51b3\u529e\u6cd5\u5f88\u7b80\u5355\uff0c\u5c06 age \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u7d22\u5f15\u5373\u53ef\u3002 \u53ef\u4ee5\u770b\u5230 type=index merge\uff0c index merge \u7684\u610f\u601d\u5c31\u662f\u5bf9 id \u548c age \u5206\u522b\u8fdb\u884c\u4e86\u626b\u63cf\uff0c\u7136\u540e\u5c06\u8fd9\u4e24\u4e2a\u7ed3\u679c\u96c6\u8fdb\u884c\u4e86\u5408\u5e76\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\u907f\u514d\u4e86\u5168\u8868\u626b\u63cf\u3002 \u603b\u7ed3 \u00b6 \u4eca\u5929\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e86 6 \u79cd\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1a \u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f like %xx \u6216\u8005 like %xx% \u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b \u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u4e5f\u662f\u65e0\u6cd5\u8d70\u7d22\u5f15\u7684\u3002 MySQL \u5728\u9047\u5230\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6bd4\u8f83\u3002\u5982\u679c\u5b57\u7b26\u4e32\u662f\u7d22\u5f15\u5217\uff0c\u800c\u6761\u4ef6\u8bed\u53e5\u4e2d\u7684\u8f93\u5165\u53c2\u6570\u662f\u6570\u5b57\u7684\u8bdd\uff0c\u90a3\u4e48\u7d22\u5f15\u5217\u4f1a\u53d1\u751f\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff0c\u7531\u4e8e\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u662f\u901a\u8fc7 CAST \u51fd\u6570\u5b9e\u73b0\u7684\uff0c\u7b49\u540c\u4e8e\u5bf9\u7d22\u5f15\u5217\u4f7f\u7528\u4e86\u51fd\u6570\uff0c\u6240\u4ee5\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f"},{"location":"mysql/index/index_lose/#_1","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5728\u5de5\u4f5c\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u60f3\u63d0\u9ad8\u4e00\u6761\u8bed\u53e5\u67e5\u8be2\u901f\u5ea6\uff0c\u901a\u5e38\u90fd\u4f1a\u60f3\u5bf9\u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\u3002 \u4f46\u662f\u7d22\u5f15\u5e76\u4e0d\u662f\u4e07\u80fd\u7684\u3002\u5efa\u7acb\u4e86\u7d22\u5f15\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u4efb\u4f55\u67e5\u8be2\u8bed\u53e5\u90fd\u80fd\u8d70\u7d22\u5f15\u626b\u63cf\u3002 \u7a0d\u4e0d\u6ce8\u610f\uff0c\u53ef\u80fd\u4f60\u5199\u7684\u67e5\u8be2\u8bed\u53e5\u662f\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u4ece\u800c\u8d70\u4e86\u5168\u8868\u626b\u63cf\uff0c\u867d\u7136\u67e5\u8be2\u7684\u7ed3\u679c\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u67e5\u8be2\u7684\u6027\u80fd\u5927\u5927\u964d\u4f4e\u3002 \u4eca\u5929\u5c31\u6765\u8ddf\u5927\u5bb6\u76d8\u4e00\u76d8\uff0c\u5e38\u89c1\u7684 6 \u79cd\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\u3002 \u4e0d\u4ec5\u4f1a\u7528\u5b9e\u9a8c\u6848\u4f8b\u7ed9\u5927\u5bb6\u8bf4\u660e\uff0c\u4e5f\u4f1a\u6e05\u695a\u6bcf\u4e2a\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0 \u3002 \u53d1\u8f66\uff01","title":"\u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f"},{"location":"mysql/index/index_lose/#_2","text":"\u6211\u4eec\u5148\u6765\u770b\u770b\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\uff1f\u56e0\u4e3a\u53ea\u6709\u77e5\u9053\u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u624d\u80fd\u66f4\u597d\u7684\u7406\u89e3\u7d22\u5f15\u5931\u6548\u7684\u95ee\u9898\u3002 \u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\u8ddf MySQL \u4f7f\u7528\u54ea\u79cd\u5b58\u50a8\u5f15\u64ce\u6709\u5173\uff0c\u56e0\u4e3a\u5b58\u50a8\u5f15\u64ce\u5c31\u662f\u8d1f\u8d23\u5c06\u6570\u636e\u6301\u4e45\u5316\u5728\u78c1\u76d8\u4e2d\uff0c\u800c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u91c7\u7528\u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\u4e5f\u4f1a\u4e0d\u76f8\u540c\u3002 MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u662f InnoDB\uff0c\u5b83\u91c7\u7528 B+Tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u9009\u62e9 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784 \uff0c\u8be6\u7ec6\u7684\u5206\u6790\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a \u4e3a\u4ec0\u4e48 MySQL \u559c\u6b22 B+ \u6811\uff1f \u5728\u521b\u5efa\u8868\u65f6\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u5176\u5b83\u7d22\u5f15\u90fd\u5c5e\u4e8e\u4e8c\u7ea7\u7d22\u5f15\u3002 MySQL \u7684 MyISAM \u5b58\u50a8\u5f15\u64ce\u652f\u6301\u591a\u79cd\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u6bd4\u5982 B+ \u6811\u7d22\u5f15\u3001R \u6811\u7d22\u5f15\u3001Full-Text \u7d22\u5f15\u3002MyISAM \u5b58\u50a8\u5f15\u64ce\u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+ \u6811\u7d22\u5f15\u3002 \u867d\u7136\uff0cInnoDB \u548c MyISAM \u90fd\u652f\u6301 B+ \u6811\u7d22\u5f15\uff0c\u4f46\u662f\u5b83\u4eec\u6570\u636e\u7684\u5b58\u50a8\u7ed3\u6784\u5b9e\u73b0\u65b9\u5f0f\u4e0d\u540c\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a InnoDB \u5b58\u50a8\u5f15\u64ce\uff1aB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u672c\u8eab\uff1b MyISAM \u5b58\u50a8\u5f15\u64ce\uff1aB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u7684\u7269\u7406\u5730\u5740\uff1b \u63a5\u4e0b\u6765\uff0c\u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u7ed9\u5927\u5bb6\u5c55\u793a\u4e0b\u8fd9\u4e24\u79cd\u5b58\u50a8\u5f15\u64ce\u7684\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u7684\u533a\u522b\u3002 \u8fd9\u91cc\u6709\u4e00\u5f20 t_user \u8868\uff0c\u5176\u4e2d id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0c\u5176\u4ed6\u90fd\u662f\u666e\u901a\u5b57\u6bb5\u3002 \u5982\u679c\u4f7f\u7528\u7684\u662f MyISAM \u5b58\u50a8\u5f15\u64ce\uff0cB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u7684\u7269\u7406\u5730\u5740\uff0c\u5373\u7528\u6237\u6570\u636e\u7684\u6307\u9488\uff0c\u5982\u4e0b\u56fe\uff1a \u5982\u679c\u4f7f\u7528\u7684\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c B+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u672c\u8eab\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a InnoDB \u5b58\u50a8\u5f15\u64ce\u6839\u636e\u7d22\u5f15\u7c7b\u578b\u4e0d\u540c\uff0c\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\uff08\u4e0a\u56fe\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff09\u548c\u4e8c\u7ea7\u7d22\u5f15\u3002\u5b83\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u6570\u636e\u90fd\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u5982\u679c\u5c06 name \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u666e\u901a\u7d22\u5f15\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u957f\u4e0b\u56fe\u8fd9\u6837\uff0c\u53f6\u5b50\u8282\u70b9\u4ec5\u5b58\u653e\u4e3b\u952e\u503c\u3002 \u77e5\u9053\u4e86 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\u540e\uff0c\u63a5\u4e0b\u6765\u4e3e\u51e0\u4e2a\u67e5\u8be2\u8bed\u53e5\uff0c\u8bf4\u4e0b\u67e5\u8be2\u8fc7\u7a0b\u662f\u600e\u4e48\u9009\u62e9\u7528\u54ea\u4e2a\u7d22\u5f15\u7c7b\u578b\u7684\u3002 \u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e3b\u952e\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u90a3\u4e48\u5c31\u4f1a\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u4e2d\u7684 B+ \u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u76f4\u63a5\u8bfb\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\u3002\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a // id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15 select * from t_user where id=1; \u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u90a3\u4e48\u9700\u8981\u68c0\u7d22\u4e24\u9897B+\u6811\uff1a \u5148\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684 B+ \u6811\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff1b \u7136\u540e\u7528\u4e0a\u4e00\u6b65\u83b7\u53d6\u7684\u4e3b\u952e\u503c\uff0c\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u4e2d\u7684 B+ \u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\u3002 \u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a**\u56de\u8868**\uff0c\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where name=\"\u6797\u67d0\"; \u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684 B+ \u6811\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u8bfb\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a**\u8986\u76d6\u7d22\u5f15**\u3002\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select id from t_user where name=\"\u6797\u67d0\"; \u4e0a\u9762\u8fd9\u4e9b\u67e5\u8be2\u8bed\u53e5\u7684\u6761\u4ef6\u90fd\u7528\u5230\u4e86\u7d22\u5f15\u5217\uff0c\u6240\u4ee5\u5728\u67e5\u8be2\u8fc7\u7a0b\u90fd\u7528\u4e0a\u4e86\u7d22\u5f15\u3002 \u4f46\u662f\u5e76\u4e0d\u610f\u5473\u7740\uff0c\u67e5\u8be2\u6761\u4ef6\u7528\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u5c31\u67e5\u8be2\u8fc7\u7a0b\u5c31\u4e00\u5b9a\u90fd\u7528\u4e0a\u7d22\u5f15\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u4e00\u8d77\u770b\u770b\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u53d1\u751f\u5168\u8868\u626b\u63cf\u3002 \u9996\u5148\u8bf4\u660e\u4e0b\uff0c\u4e0b\u9762\u7684\u5b9e\u9a8c\u6848\u4f8b\uff0c\u6211\u4f7f\u7528\u7684 MySQL \u7248\u672c\u4e3a 8.0.26 \u3002","title":"\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\uff1f"},{"location":"mysql/index/index_lose/#_3","text":"\u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f like %xx \u6216\u8005 like %xx% \u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\u3002 \u6bd4\u5982\u4e0b\u9762\u7684 like \u8bed\u53e5\uff0c\u67e5\u8be2 name \u540e\u7f00\u4e3a\u300c\u6797\u300d\u7684\u7528\u6237\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=ALL \u5c31\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\uff0c\u800c\u6ca1\u6709\u8d70\u7d22\u5f15\u3002 // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where name like '%\u6797'; \u5982\u679c\u662f\u67e5\u8be2 name \u524d\u7f00\u4e3a\u6797\u7684\u7528\u6237\uff0c\u90a3\u4e48\u5c31\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=range \u8868\u793a\u8d70\u7d22\u5f15\u626b\u63cf\uff0ckey=index_name \u770b\u5230\u5b9e\u9645\u8d70\u4e86 index_name \u7d22\u5f15\uff1a // name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where name like '\u6797%'; \u4e3a\u4ec0\u4e48 like \u5173\u952e\u5b57\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u65e0\u6cd5\u8d70\u7d22\u5f15\u5462\uff1f \u56e0\u4e3a\u7d22\u5f15 B+ \u6811\u662f\u6309\u7167\u300c\u7d22\u5f15\u503c\u300d\u6709\u5e8f\u6392\u5217\u5b58\u50a8\u7684\uff0c\u53ea\u80fd\u6839\u636e\u524d\u7f00\u8fdb\u884c\u6bd4\u8f83\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u8fd9\u5f20\u4e8c\u7ea7\u7d22\u5f15\u56fe\uff0c\u662f\u4ee5 name \u5b57\u6bb5\u6709\u5e8f\u6392\u5217\u5b58\u50a8\u7684\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u67e5\u8be2 name \u5b57\u6bb5\u524d\u7f00\u4e3a\u300c\u6797\u300d\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f name like '\u6797%' \uff0c\u626b\u63cf\u7d22\u5f15\u7684\u8fc7\u7a0b\uff1a \u9996\u8282\u70b9\u67e5\u8be2\u6bd4\u8f83\uff1a\u6797\u8fd9\u4e2a\u5b57\u7684\u62fc\u97f3\u5927\u5c0f\u6bd4\u9996\u8282\u70b9\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u9648\u5b57\u5927\uff0c\u4f46\u662f\u6bd4\u9996\u8282\u70b9\u7684\u7b2c\u4e8c\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u5468\u5b57\u5c0f\uff0c\u6240\u4ee5\u9009\u62e9\u53bb\u8282\u70b92\u7ee7\u7eed\u67e5\u8be2\uff1b \u8282\u70b9 2 \u67e5\u8be2\u6bd4\u8f83\uff1a\u8282\u70b92\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u9648\u5b57\u7684\u62fc\u97f3\u5927\u5c0f\u6bd4\u6797\u5b57\u5c0f\uff0c\u6240\u4ee5\u7ee7\u7eed\u770b\u4e0b\u4e00\u4e2a\u7d22\u5f15\u503c\uff0c\u53d1\u73b0\u8282\u70b92\u6709\u4e0e\u6797\u5b57\u524d\u7f00\u5339\u914d\u7684\u7d22\u5f15\u503c\uff0c\u4e8e\u662f\u5c31\u5f80\u53f6\u5b50\u8282\u70b9\u67e5\u8be2\uff0c\u5373\u53f6\u5b50\u8282\u70b94\uff1b \u8282\u70b9 4 \u67e5\u8be2\u6bd4\u8f83\uff1a\u8282\u70b94\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u7684\u524d\u7f00\u7b26\u5408\u6797\u5b57\uff0c\u4e8e\u662f\u5c31\u8bfb\u53d6\u8be5\u884c\u6570\u636e\uff0c\u63a5\u7740\u7ee7\u7eed\u5f80\u53f3\u5339\u914d\uff0c\u76f4\u5230\u5339\u914d\u4e0d\u5230\u524d\u7f00\u4e3a\u6797\u7684\u7d22\u5f15\u503c\u3002 \u5982\u679c\u4f7f\u7528 name like '%\u6797' \u65b9\u5f0f\u6765\u67e5\u8be2\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u7ed3\u679c\u53ef\u80fd\u662f\u300c\u9648\u6797\u3001\u5f20\u6797\u3001\u5468\u6797\u300d\u7b49\u4e4b\u7c7b\u7684\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u4ece\u54ea\u4e2a\u7d22\u5f15\u503c\u5f00\u59cb\u6bd4\u8f83\uff0c\u4e8e\u662f\u5c31\u53ea\u80fd\u901a\u8fc7\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u67e5\u8be2\u3002 \u60f3\u8981\u66f4\u8be6\u7ec6\u4e86\u89e3 InnoDB \u7684 B+ \u6811\u67e5\u8be2\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u6211\u5199\u7684\u8fd9\u7bc7\uff1a B+ \u6811\u91cc\u7684\u8282\u70b9\u91cc\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u67e5\u8be2\u6570\u636e\u7684\u8fc7\u7a0b\u53c8\u662f\u600e\u6837\u7684\uff1f","title":"\u5bf9\u7d22\u5f15\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d"},{"location":"mysql/index/index_lose/#_4","text":"\u6709\u65f6\u5019\u6211\u4eec\u4f1a\u7528\u4e00\u4e9b MySQL \u81ea\u5e26\u7684\u51fd\u6570\u6765\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\uff0c\u8fd9\u65f6\u5019\u8981\u6ce8\u610f\u4e86\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5b57\u6bb5\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u6bd4\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9 name \u5b57\u6bb5\u4f7f\u7528\u4e86 LENGTH \u51fd\u6570\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=ALL\uff0c\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\uff1a // name \u4e3a\u4e8c\u7ea7\u7d22\u5f15 select * from t_user where length(name)=6; \u4e3a\u4ec0\u4e48\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u65e0\u6cd5\u8d70\u7d22\u5f15\u4e86\u5462\uff1f \u56e0\u4e3a\u7d22\u5f15\u4fdd\u5b58\u7684\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u539f\u59cb\u503c\uff0c\u800c\u4e0d\u662f\u7ecf\u8fc7\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u81ea\u7136\u5c31\u6ca1\u529e\u6cd5\u8d70\u7d22\u5f15\u4e86\u3002 \u4e0d\u8fc7\uff0c\u4ece MySQL 8.0 \u5f00\u59cb\uff0c\u7d22\u5f15\u7279\u6027\u589e\u52a0\u4e86\u51fd\u6570\u7d22\u5f15\uff0c\u5373\u53ef\u4ee5\u9488\u5bf9\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5\u7d22\u5f15\u7684\u503c\u662f\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u901a\u8fc7\u626b\u63cf\u7d22\u5f15\u6765\u67e5\u8be2\u6570\u636e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u901a\u8fc7\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff0c\u5bf9 length(name) \u7684\u8ba1\u7b97\u7ed3\u679c\u5efa\u7acb\u4e00\u4e2a\u540d\u4e3a idx_name_length \u7684\u7d22\u5f15\u3002 alter table t_user add key idx_name_length ((length(name))); \u7136\u540e\u6211\u518d\u7528\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd9\u65f6\u5019\u5c31\u4f1a\u8d70\u7d22\u5f15\u4e86\u3002","title":"\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570"},{"location":"mysql/index/index_lose/#_5","text":"\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u4e5f\u662f\u65e0\u6cd5\u8d70\u7d22\u5f15\u7684\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u6267\u884c\u8ba1\u5212\u4e2d type = ALL\uff0c\u8bf4\u660e\u662f\u901a\u8fc7\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\u6570\u636e\u7684\uff1a explain select * from t_user where id + 1 = 10; \u4f46\u662f\uff0c\u5982\u679c\u628a\u67e5\u8be2\u8bed\u53e5\u7684\u6761\u4ef6\u6539\u6210 where id = 10 - 1\uff0c\u8fd9\u6837\u5c31\u4e0d\u662f\u5728\u7d22\u5f15\u5b57\u6bb5\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u4e86\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u8d70\u7d22\u5f15\u67e5\u8be2\u4e86\u3002 \u4e3a\u4ec0\u4e48\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u5c31\u65e0\u6cd5\u8d70\u7d22\u5f15\u4e86\u5462\uff1f \u539f\u56e0\u8ddf\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\u5dee\u4e0d\u591a\u3002 \u56e0\u4e3a\u7d22\u5f15\u4fdd\u5b58\u7684\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u539f\u59cb\u503c\uff0c\u800c\u4e0d\u662f id + 1 \u8868\u8fbe\u5f0f\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u6240\u4ee5\u65e0\u6cd5\u8d70\u7d22\u5f15\uff0c\u53ea\u80fd\u901a\u8fc7\u628a\u7d22\u5f15\u5b57\u6bb5\u7684\u53d6\u503c\u90fd\u53d6\u51fa\u6765\uff0c\u7136\u540e\u4f9d\u6b21\u8fdb\u884c\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u6765\u8fdb\u884c\u6761\u4ef6\u5224\u65ad\uff0c\u56e0\u6b64\u91c7\u7528\u7684\u5c31\u662f\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u3002 \u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u8bf4\uff0c\u8fd9\u79cd\u5bf9\u7d22\u5f15\u8fdb\u884c\u7b80\u5355\u7684\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u5728\u4ee3\u7801\u7279\u6b8a\u5904\u7406\u4e0b\uff0c\u5e94\u8be5\u662f\u53ef\u4ee5\u505a\u5230\u7d22\u5f15\u626b\u63cf\u7684\uff0c\u6bd4\u65b9\u5c06 id + 1 = 10 \u53d8\u6210 id = 10 - 1\u3002 \u662f\u7684\uff0c\u662f\u80fd\u591f\u5b9e\u73b0\uff0c\u4f46\u662f MySQL \u8fd8\u662f\u5077\u4e86\u8fd9\u4e2a\u61d2\uff0c\u6ca1\u6709\u5b9e\u73b0\u3002 \u6211\u7684\u60f3\u6cd5\u662f\uff0c\u53ef\u80fd\u4e5f\u662f\u56e0\u4e3a\uff0c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u7684\u60c5\u51b5\u591a\u79cd\u591a\u6837\uff0c\u6bcf\u79cd\u90fd\u8981\u8003\u8651\u7684\u8bdd\uff0c\u4ee3\u7801\u53ef\u80fd\u4f1a\u5f88\u81c3\u80bf\uff0c\u6240\u4ee5\u5e72\u8106\u5c06\u8fd9\u79cd\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\u544a\u8bc9\u7a0b\u5e8f\u5458\uff0c\u8ba9\u7a0b\u5e8f\u5458\u81ea\u5df1\u4fdd\u8bc1\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u4e0d\u8981\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u3002","title":"\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97"},{"location":"mysql/index/index_lose/#_6","text":"\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u662f\u5728\u6761\u4ef6\u67e5\u8be2\u4e2d\uff0c\u8f93\u5165\u7684\u53c2\u6570\u662f\u6574\u578b\u7684\u8bdd\uff0c\u4f60\u4f1a\u5728\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u53d1\u73b0\u8fd9\u6761\u8bed\u53e5\u4f1a\u8d70\u5168\u8868\u626b\u63cf\u3002 \u6211\u5728\u539f\u672c\u7684 t_user \u8868\u589e\u52a0\u4e86 phone \u5b57\u6bb5\uff0c\u662f\u4e8c\u7ea7\u7d22\u5f15\u4e14\u7c7b\u578b\u662f varchar\u3002 \u7136\u540e\u6211\u5728\u6761\u4ef6\u67e5\u8be2\u4e2d\uff0c\u7528\u6574\u578b\u4f5c\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u6b64\u65f6\u6267\u884c\u8ba1\u5212\u4e2d type = ALL\uff0c\u6240\u4ee5\u662f\u901a\u8fc7\u5168\u8868\u626b\u63cf\u6765\u67e5\u8be2\u6570\u636e\u7684\u3002 select * from t_user where phone = 1300000001; \u4f46\u662f\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u662f\u6574\u578b\u7c7b\u578b\uff0c\u67e5\u8be2\u6761\u4ef6\u4e2d\u7684\u8f93\u5165\u53c2\u6570\u5373\u4f7f\u5b57\u7b26\u4e32\uff0c\u662f\u4e0d\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u8fd8\u662f\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\u3002 \u6211\u4eec\u518d\u770b\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\uff0cid \u662f\u6574\u578b\uff0c\u4f46\u662f\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u8fd8\u662f\u8d70\u4e86\u7d22\u5f15\u626b\u63cf\u7684\u3002 explain select * from t_user where id = '1'; \u4e3a\u4ec0\u4e48\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u7b2c\u4e8c\u4f8b\u5b50\u4e0d\u4f1a\u5462\uff1f \u8981\u660e\u767d\u8fd9\u4e2a\u539f\u56e0\uff0c\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053 MySQL \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\u662f\u4ec0\u4e48\uff1f\u5c31\u662f\u770b MySQL \u662f\u4f1a\u5c06\u5b57\u7b26\u4e32\u8f6c\u6210\u6570\u5b57\u5904\u7406\uff0c\u8fd8\u662f\u5c06\u6570\u5b57\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u5904\u7406\u3002 \u6211\u5728\u770b\u300amysql45\u8bb2\u7684\u65f6\u5019\u300b\u770b\u5230\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u65b9\u5f0f\uff0c\u5c31\u662f\u901a\u8fc7 select \u201c10\u201d > 9 \u7684\u7ed3\u679c\u6765\u77e5\u9053MySQL \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\u662f\u4ec0\u4e48\uff1a \u5982\u679c\u89c4\u5219\u662f MySQL \u4f1a\u5c06\u81ea\u52a8\u300c\u5b57\u7b26\u4e32\u300d\u8f6c\u6362\u6210\u300c\u6570\u5b57\u300d\uff0c\u5c31\u76f8\u5f53\u4e8e select 10 > 9\uff0c\u8fd9\u4e2a\u5c31\u662f\u6570\u5b57\u6bd4\u8f83\uff0c\u6240\u4ee5\u7ed3\u679c\u5e94\u8be5\u662f 1\uff1b \u5982\u679c\u89c4\u5219\u662f MySQL \u4f1a\u5c06\u81ea\u52a8\u300c\u6570\u5b57\u300d\u8f6c\u6362\u6210\u300c\u5b57\u7b26\u4e32\u300d\uff0c\u5c31\u76f8\u5f53\u4e8e select \"10\" > \"9\"\uff0c\u8fd9\u4e2a\u662f\u5b57\u7b26\u4e32\u6bd4\u8f83\uff0c\u5b57\u7b26\u4e32\u6bd4\u8f83\u5927\u5c0f\u662f\u9010\u4f4d\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u9010\u4e2a\u6bd4\u8f83\uff08\u6309ascii\u7801\uff09 \uff0c\u90a3\u4e48\"10\"\u5b57\u7b26\u4e32\u76f8\u5f53\u4e8e \u201c1\u201d\u548c\u201c0\u201d\u5b57\u7b26\u7684\u7ec4\u5408\uff0c\u6240\u4ee5\u5148\u662f\u62ff \u201c1\u201d \u5b57\u7b26\u548c \u201c9\u201d \u5b57\u7b26\u6bd4\u8f83\uff0c\u56e0\u4e3a \u201c1\u201d \u5b57\u7b26\u6bd4 \u201c9\u201d \u5b57\u7b26\u5c0f\uff0c\u6240\u4ee5\u7ed3\u679c\u5e94\u8be5\u662f 0\u3002 \u5728 MySQL \u4e2d\uff0c\u6267\u884c\u7684\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a \u4e0a\u9762\u7684\u7ed3\u679c\u4e3a 1\uff0c\u8bf4\u660e MySQL \u5728\u9047\u5230\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6bd4\u8f83 \u3002 \u524d\u9762\u7684\u4f8b\u5b50\u4e00\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u6211\u4e5f\u8ddf\u5927\u5bb6\u8bf4\u4e86\u662f\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff1a //\u4f8b\u5b50\u4e00\u7684\u67e5\u8be2\u8bed\u53e5 select * from t_user where phone = 1300000001; \u8fd9\u662f\u56e0\u4e3a phone \u5b57\u6bb5\u4e3a\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5 MySQL \u8981\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u6240\u4ee5\u8fd9\u6761\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a select * from t_user where CAST(phone AS signed int) = 1300000001; \u53ef\u4ee5\u770b\u5230\uff0c CAST \u51fd\u6570\u662f\u4f5c\u7528\u5728\u4e86 phone \u5b57\u6bb5\uff0c\u800c phone \u5b57\u6bb5\u662f\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u5bf9\u7d22\u5f15\u4f7f\u7528\u4e86\u51fd\u6570\uff01\u800c\u524d\u9762\u6211\u4eec\u4e5f\u8bf4\u4e86\uff0c\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\u662f\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684 \u3002 \u4f8b\u5b50\u4e8c\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u6211\u8ddf\u5927\u5bb6\u8bf4\u4e86\u662f\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff1a //\u4f8b\u5b50\u4e8c\u7684\u67e5\u8be2\u8bed\u53e5 select * from t_user where id = \"1\"; \u8fd9\u65f6\u56e0\u4e3a\u5b57\u7b26\u4e32\u90e8\u5206\u662f\u8f93\u5165\u53c2\u6570\uff0c\u4e5f\u5c31\u9700\u8981\u5c06\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u6240\u4ee5\u8fd9\u6761\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a select * from t_user where id = CAST(\"1\" AS signed int); \u53ef\u4ee5\u770b\u5230\uff0c\u7d22\u5f15\u5b57\u6bb5\u5e76\u6ca1\u6709\u7528\u4efb\u4f55\u51fd\u6570\uff0cCAST \u51fd\u6570\u662f\u7528\u5728\u4e86\u8f93\u5165\u53c2\u6570\uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\u7684\u3002","title":"\u5bf9\u7d22\u5f15\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362"},{"location":"mysql/index/index_lose/#_7","text":"\u5bf9\u4e3b\u952e\u5b57\u6bb5\u5efa\u7acb\u7684\u7d22\u5f15\u53eb\u505a\u805a\u7c07\u7d22\u5f15\uff0c\u5bf9\u666e\u901a\u5b57\u6bb5\u5efa\u7acb\u7684\u7d22\u5f15\u53eb\u505a\u4e8c\u7ea7\u7d22\u5f15\u3002 \u90a3\u4e48**\u591a\u4e2a\u666e\u901a\u5b57\u6bb5\u7ec4\u5408\u5728\u4e00\u8d77\u521b\u5efa\u7684\u7d22\u5f15\u5c31\u53eb\u505a\u8054\u5408\u7d22\u5f15**\uff0c\u4e5f\u53eb\u7ec4\u5408\u7d22\u5f15\u3002 \u521b\u5efa\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u521b\u5efa\u65f6\u7684\u987a\u5e8f\u95ee\u9898\uff0c\u56e0\u4e3a\u8054\u5408\u7d22\u5f15 (a, b, c) \u548c (c, b, a) \u5728\u4f7f\u7528\u7684\u65f6\u5019\u4f1a\u5b58\u5728\u5dee\u522b\u3002 \u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa**\u6700\u5de6\u5339\u914d\u539f\u5219**\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\u3002 \u6bd4\u5982\uff0c\u5982\u679c\u521b\u5efa\u4e86\u4e00\u4e2a (a, b, c) \u8054\u5408\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u5c31\u53ef\u4ee5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff1a where a=1\uff1b where a=1 and b=2 and c=3\uff1b where a=1 and b=2\uff1b \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u6709\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u6240\u4ee5 a \u5b57\u6bb5\u5728 where \u5b50\u53e5\u7684\u987a\u5e8f\u5e76\u4e0d\u91cd\u8981\u3002 \u4f46\u662f\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u56e0\u4e3a\u4e0d\u7b26\u5408\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff0c\u8054\u5408\u7d22\u5f15\u5c31\u4f1a\u5931\u6548: where b=2\uff1b where c=3\uff1b where b=2 and c=3\uff1b \u6709\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684\u67e5\u8be2\u6761\u4ef6\uff1awhere a = 1 and c = 3 \uff0c\u7b26\u5408\u6700\u5de6\u5339\u914d\u5417\uff1f \u8fd9\u79cd\u5176\u5b9e\u4e25\u683c\u610f\u4e49\u4e0a\u6765\u8bf4\u662f\u5c5e\u4e8e\u7d22\u5f15\u622a\u65ad\uff0c\u4e0d\u540c\u7248\u672c\u5904\u7406\u65b9\u5f0f\u4e5f\u4e0d\u4e00\u6837\u3002 MySQL 5.5 \u7684\u8bdd\uff0c\u524d\u9762 a \u4f1a\u8d70\u7d22\u5f15\uff0c\u5728\u8054\u5408\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\u540e\uff0c\u5f00\u59cb\u56de\u8868\uff0c\u5230\u4e3b\u952e\u7d22\u5f15\u8bfb\u53d6\u6570\u636e\u884c\uff0c\u7136\u540e\u518d\u6bd4\u5bf9 c \u5b57\u6bb5\u7684\u503c\u3002 \u4ece MySQL 5.6 \u4e4b\u540e\uff0c\u6709\u4e00\u4e2a**\u7d22\u5f15\u4e0b\u63a8\u529f\u80fd**\uff0c\u53ef\u4ee5\u5728\u7d22\u5f15\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5b57\u6bb5\u5148\u505a\u5224\u65ad\uff0c\u76f4\u63a5\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570\u3002 \u5927\u6982\u539f\u7406\u662f\uff1a\u622a\u65ad\u7684\u5b57\u6bb5\u4f1a\u88ab\u4e0b\u63a8\u5230\u5b58\u50a8\u5f15\u64ce\u5c42\u8fdb\u884c\u6761\u4ef6\u5224\u65ad\uff08\u56e0\u4e3a c \u5b57\u6bb5\u7684\u503c\u662f\u5728 (a, b, c) \u8054\u5408\u7d22\u5f15\u91cc\u7684\uff09\uff0c\u7136\u540e\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u540e\u518d\u8fd4\u56de\u7ed9 Server \u5c42\u3002\u7531\u4e8e\u5728\u5f15\u64ce\u5c42\u5c31\u8fc7\u6ee4\u6389\u5927\u91cf\u7684\u6570\u636e\uff0c\u65e0\u9700\u518d\u56de\u8868\u8bfb\u53d6\u6570\u636e\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u5347\u4e86\u6027\u80fd\u3002 \u6bd4\u5982\u4e0b\u9762\u8fd9\u6761 where a = 1 and c = 0 \u8bed\u53e5\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u6267\u884c\u8ba1\u5212\u4e2d\u7684 Extra=Using index condition \u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u529f\u80fd\u3002 \u4e3a\u4ec0\u4e48\u8054\u5408\u7d22\u5f15\u4e0d\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\u5c31\u4f1a\u5931\u6548\uff1f \u539f\u56e0\u662f\uff0c\u5728\u8054\u5408\u7d22\u5f15\u7684\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u662f\u6309\u7167\u7d22\u5f15\u7b2c\u4e00\u5217\u6392\u5e8f\uff0c\u7b2c\u4e00\u5217\u6570\u636e\u76f8\u540c\u65f6\u624d\u4f1a\u6309\u7167\u7b2c\u4e8c\u5217\u6392\u5e8f\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u60f3\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u4e2d\u5c3d\u53ef\u80fd\u591a\u7684\u5217\uff0c\u67e5\u8be2\u6761\u4ef6\u4e2d\u7684\u5404\u4e2a\u5217\u5fc5\u987b\u662f\u8054\u5408\u7d22\u5f15\u4e2d\u4ece\u6700\u5de6\u8fb9\u5f00\u59cb\u8fde\u7eed\u7684\u5217\u3002\u5982\u679c\u6211\u4eec\u4ec5\u4ec5\u6309\u7167\u7b2c\u4e8c\u5217\u641c\u7d22\uff0c\u80af\u5b9a\u65e0\u6cd5\u8d70\u7d22\u5f15\u3002","title":"\u8054\u5408\u7d22\u5f15\u975e\u6700\u5de6\u5339\u914d"},{"location":"mysql/index/index_lose/#where-or","text":"\u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u67e5\u8be2\u8bed\u53e5\uff0cid \u662f\u4e3b\u952e\uff0cage \u662f\u666e\u901a\u5217\uff0c\u4ece\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u770b\uff0c\u662f\u8d70\u4e86\u5168\u8868\u626b\u63cf\u3002 select * from t_user where id = 1 or age = 18; \u8fd9\u662f\u56e0\u4e3a OR \u7684\u542b\u4e49\u5c31\u662f\u4e24\u4e2a\u53ea\u8981\u6ee1\u8db3\u4e00\u4e2a\u5373\u53ef\uff0c\u56e0\u6b64\u53ea\u6709\u4e00\u4e2a\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u53ea\u8981\u6709\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u5c31\u4f1a\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002 \u8981\u89e3\u51b3\u529e\u6cd5\u5f88\u7b80\u5355\uff0c\u5c06 age \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u7d22\u5f15\u5373\u53ef\u3002 \u53ef\u4ee5\u770b\u5230 type=index merge\uff0c index merge \u7684\u610f\u601d\u5c31\u662f\u5bf9 id \u548c age \u5206\u522b\u8fdb\u884c\u4e86\u626b\u63cf\uff0c\u7136\u540e\u5c06\u8fd9\u4e24\u4e2a\u7ed3\u679c\u96c6\u8fdb\u884c\u4e86\u5408\u5e76\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\u907f\u514d\u4e86\u5168\u8868\u626b\u63cf\u3002","title":"WHERE \u5b50\u53e5\u4e2d\u7684 OR"},{"location":"mysql/index/index_lose/#_8","text":"\u4eca\u5929\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e86 6 \u79cd\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1a \u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f like %xx \u6216\u8005 like %xx% \u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b \u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u4e5f\u662f\u65e0\u6cd5\u8d70\u7d22\u5f15\u7684\u3002 MySQL \u5728\u9047\u5230\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6bd4\u8f83\u3002\u5982\u679c\u5b57\u7b26\u4e32\u662f\u7d22\u5f15\u5217\uff0c\u800c\u6761\u4ef6\u8bed\u53e5\u4e2d\u7684\u8f93\u5165\u53c2\u6570\u662f\u6570\u5b57\u7684\u8bdd\uff0c\u90a3\u4e48\u7d22\u5f15\u5217\u4f1a\u53d1\u751f\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff0c\u7531\u4e8e\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u662f\u901a\u8fc7 CAST \u51fd\u6570\u5b9e\u73b0\u7684\uff0c\u7b49\u540c\u4e8e\u5bf9\u7d22\u5f15\u5217\u4f7f\u7528\u4e86\u51fd\u6570\uff0c\u6240\u4ee5\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002 \u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/index/page/","text":"\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811 \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5927\u5bb6\u80cc\u516b\u80a1\u6587\u7684\u65f6\u5019\uff0c\u90fd\u77e5\u9053 MySQL \u91cc InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u91c7\u7528 B+ \u6811\u6765\u7ec4\u7ec7\u6570\u636e\u7684\u3002 \u8fd9\u70b9\u6ca1\u9519\uff0c\u4f46\u662f\u5927\u5bb6\u77e5\u9053 B+ \u6811\u91cc\u7684\u8282\u70b9\u91cc\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u67e5\u8be2\u6570\u636e\u7684\u8fc7\u7a0b\u53c8\u662f\u600e\u6837\u7684\uff1f \u8fd9\u6b21\uff0c\u6211\u4eec**\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811**\uff0c\u770b\u770b\u6bcf\u4e2a\u8282\u70b9\u957f\u5565\u6837\u3002 InnoDB \u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u7684\uff1f \u00b6 MySQL \u652f\u6301\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5b58\u50a8\u6570\u636e\u7684\u65b9\u5f0f\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u6211\u4eec\u6700\u5e38\u4f7f\u7528\u7684\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u6240\u4ee5\u5c31\u8ddf\u5927\u5bb6\u56fe\u89e3\u4e0bInnoDB \u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u7684\u3002 \u8bb0\u5f55\u662f\u6309\u7167\u884c\u6765\u5b58\u50a8\u7684\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7684\u8bfb\u53d6\u5e76\u4e0d\u4ee5\u300c\u884c\u300d\u4e3a\u5355\u4f4d\uff0c\u5426\u5219\u4e00\u6b21\u8bfb\u53d6\uff08\u4e5f\u5c31\u662f\u4e00\u6b21 I/O \u64cd\u4f5c\uff09\u53ea\u80fd\u5904\u7406\u4e00\u884c\u6570\u636e\uff0c\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\u3002 \u56e0\u6b64\uff0c InnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u6570\u636e\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u9700\u8981\u8bfb\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u5c06\u8fd9\u4e2a\u8bb0\u5f55\u672c\u8eab\u4ece\u78c1\u76d8\u8bfb\u51fa\u6765\uff0c\u800c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\uff0c\u5c06\u5176\u6574\u4f53\u8bfb\u5165\u5185\u5b58\u3002 \u6570\u636e\u5e93\u7684 I/O \u64cd\u4f5c\u7684\u6700\u5c0f\u5355\u4f4d\u662f\u9875\uff0c InnoDB \u6570\u636e\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u662f 16KB \uff0c\u610f\u5473\u7740\u6570\u636e\u5e93\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u4ee5 16KB \u4e3a\u5355\u4f4d\u7684\uff0c\u4e00\u6b21\u6700\u5c11\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6 16K \u7684\u5185\u5bb9\u5230\u5185\u5b58\u4e2d\uff0c\u4e00\u6b21\u6700\u5c11\u628a\u5185\u5b58\u4e2d\u7684 16K \u5185\u5bb9\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002 \u6570\u636e\u9875\u5305\u62ec\u4e03\u4e2a\u90e8\u5206\uff0c\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a \u8fd9 7 \u4e2a\u90e8\u5206\u7684\u4f5c\u7528\u5982\u4e0b\u56fe\uff1a \u5728 File Header \u4e2d\u6709\u4e24\u4e2a\u6307\u9488\uff0c\u5206\u522b\u6307\u5411\u4e0a\u4e00\u4e2a\u6570\u636e\u9875\u548c\u4e0b\u4e00\u4e2a\u6570\u636e\u9875\uff0c\u8fde\u63a5\u8d77\u6765\u7684\u9875\u76f8\u5f53\u4e8e\u4e00\u4e2a\u53cc\u5411\u7684\u94fe\u8868\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u91c7\u7528\u94fe\u8868\u7684\u7ed3\u6784\u662f\u8ba9\u6570\u636e\u9875\u4e4b\u95f4\u4e0d\u9700\u8981\u662f\u7269\u7406\u4e0a\u7684\u8fde\u7eed\u7684\uff0c\u800c\u662f\u903b\u8f91\u4e0a\u7684\u8fde\u7eed\u3002 \u6570\u636e\u9875\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5b58\u50a8\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u6240\u4ee5\u91cd\u70b9\u8bf4\u4e00\u4e0b\u6570\u636e\u9875\u4e2d\u7684 User Records \u662f\u600e\u4e48\u7ec4\u7ec7\u6570\u636e\u7684\u3002 \u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u6309\u7167\u300c\u4e3b\u952e\u300d\u987a\u5e8f\u7ec4\u6210\u5355\u5411\u94fe\u8868 \uff0c\u5355\u5411\u94fe\u8868\u7684\u7279\u70b9\u5c31\u662f\u63d2\u5165\u3001\u5220\u9664\u975e\u5e38\u65b9\u4fbf\uff0c\u4f46\u662f\u68c0\u7d22\u6548\u7387\u4e0d\u9ad8\uff0c\u6700\u5dee\u7684\u60c5\u51b5\u4e0b\u9700\u8981\u904d\u5386\u94fe\u8868\u4e0a\u7684\u6240\u6709\u8282\u70b9\u624d\u80fd\u5b8c\u6210\u68c0\u7d22\u3002 \u56e0\u6b64\uff0c\u6570\u636e\u9875\u4e2d\u6709\u4e00\u4e2a**\u9875\u76ee\u5f55**\uff0c\u8d77\u5230\u8bb0\u5f55\u7684\u7d22\u5f15\u4f5c\u7528\uff0c\u5c31\u50cf\u6211\u4eec\u4e66\u90a3\u6837\uff0c\u9488\u5bf9\u4e66\u4e2d\u5185\u5bb9\u7684\u6bcf\u4e2a\u7ae0\u8282\u8bbe\u7acb\u4e86\u4e00\u4e2a\u76ee\u5f55\uff0c\u60f3\u770b\u67d0\u4e2a\u7ae0\u8282\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u67e5\u770b\u76ee\u5f55\uff0c\u5feb\u901f\u627e\u5230\u5bf9\u5e94\u7684\u7ae0\u8282\u7684\u9875\u6570\uff0c\u800c\u6570\u636e\u9875\u4e2d\u7684\u9875\u76ee\u5f55\u5c31\u662f\u4e3a\u4e86\u80fd\u5feb\u901f\u627e\u5230\u8bb0\u5f55\u3002 \u90a3 InnoDB \u662f\u5982\u4f55\u7ed9\u8bb0\u5f55\u521b\u5efa\u9875\u76ee\u5f55\u7684\u5462\uff1f\u9875\u76ee\u5f55\u4e0e\u8bb0\u5f55\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u9875\u76ee\u5f55\u521b\u5efa\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a \u5c06\u6240\u6709\u7684\u8bb0\u5f55\u5212\u5206\u6210\u51e0\u4e2a\u7ec4\uff0c\u8fd9\u4e9b\u8bb0\u5f55\u5305\u62ec\u6700\u5c0f\u8bb0\u5f55\u548c\u6700\u5927\u8bb0\u5f55\uff0c\u4f46\u4e0d\u5305\u62ec\u6807\u8bb0\u4e3a\u201c\u5df2\u5220\u9664\u201d\u7684\u8bb0\u5f55\uff1b \u6bcf\u4e2a\u8bb0\u5f55\u7ec4\u7684\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u5c31\u662f\u7ec4\u5185\u6700\u5927\u7684\u90a3\u6761\u8bb0\u5f55\uff0c\u5e76\u4e14\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u5934\u4fe1\u606f\u4e2d\u4f1a\u5b58\u50a8\u8be5\u7ec4\u4e00\u5171\u6709\u591a\u5c11\u6761\u8bb0\u5f55\uff0c\u4f5c\u4e3a n_owned \u5b57\u6bb5\uff08\u4e0a\u56fe\u4e2d\u7c89\u7ea2\u8272\u5b57\u6bb5\uff09 \u9875\u76ee\u5f55\u7528\u6765\u5b58\u50a8\u6bcf\u7ec4\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u5730\u5740\u504f\u79fb\u91cf\uff0c\u8fd9\u4e9b\u5730\u5740\u504f\u79fb\u91cf\u4f1a\u6309\u7167\u5148\u540e\u987a\u5e8f\u5b58\u50a8\u8d77\u6765\uff0c\u6bcf\u7ec4\u7684\u5730\u5740\u504f\u79fb\u91cf\u4e5f\u88ab\u79f0\u4e4b\u4e3a\u69fd\uff08slot\uff09\uff0c \u6bcf\u4e2a\u69fd\u76f8\u5f53\u4e8e\u6307\u9488\u6307\u5411\u4e86\u4e0d\u540c\u7ec4\u7684\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55 \u3002 \u4ece\u56fe\u53ef\u4ee5\u770b\u5230\uff0c \u9875\u76ee\u5f55\u5c31\u662f\u7531\u591a\u4e2a\u69fd\u7ec4\u6210\u7684\uff0c\u69fd\u76f8\u5f53\u4e8e\u5206\u7ec4\u8bb0\u5f55\u7684\u7d22\u5f15 \u3002\u7136\u540e\uff0c\u56e0\u4e3a\u8bb0\u5f55\u662f\u6309\u7167\u300c\u4e3b\u952e\u503c\u300d\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u7684\uff0c\u6240\u4ee5**\u6211\u4eec\u901a\u8fc7\u69fd\u67e5\u627e\u8bb0\u5f55\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8981\u67e5\u8be2\u7684\u8bb0\u5f55\u5728\u54ea\u4e2a\u69fd\uff08\u54ea\u4e2a\u8bb0\u5f55\u5206\u7ec4\uff09\uff0c\u5b9a\u4f4d\u5230\u69fd\u540e\uff0c\u518d\u904d\u5386\u69fd\u5185\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u8bb0\u5f55**\uff0c\u65e0\u9700\u4ece\u6700\u5c0f\u8bb0\u5f55\u5f00\u59cb\u904d\u5386\u6574\u4e2a\u9875\u4e2d\u7684\u8bb0\u5f55\u94fe\u8868\u3002 \u4ee5\u4e0a\u9762\u90a3\u5f20\u56fe\u4e3e\u4e2a\u4f8b\u5b50\uff0c5 \u4e2a\u69fd\u7684\u7f16\u53f7\u5206\u522b\u4e3a 0\uff0c1\uff0c2\uff0c3\uff0c4\uff0c\u6211\u60f3\u67e5\u627e\u4e3b\u952e\u4e3a 11 \u7684\u7528\u6237\u8bb0\u5f55\uff1a \u5148\u4e8c\u5206\u5f97\u51fa\u69fd\u4e2d\u95f4\u4f4d\u662f (0+4)/2=2 \uff0c2\u53f7\u69fd\u91cc\u6700\u5927\u7684\u8bb0\u5f55\u4e3a 8\u3002\u56e0\u4e3a 11 > 8\uff0c\u6240\u4ee5\u9700\u8981\u4ece 2 \u53f7\u69fd\u540e\u7ee7\u7eed\u641c\u7d22\u8bb0\u5f55\uff1b \u518d\u4f7f\u7528\u4e8c\u5206\u641c\u7d22\u51fa 2 \u53f7\u548c 4 \u69fd\u7684\u4e2d\u95f4\u4f4d\u662f (2+4)/2= 3\uff0c3 \u53f7\u69fd\u91cc\u6700\u5927\u7684\u8bb0\u5f55\u4e3a 12\u3002\u56e0\u4e3a 11 < 12\uff0c\u6240\u4ee5\u4e3b\u952e\u4e3a 11 \u7684\u8bb0\u5f55\u5728 3 \u53f7\u69fd\u91cc\uff1b \u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0c \u300c\u69fd\u5bf9\u5e94\u7684\u503c\u90fd\u662f\u8fd9\u4e2a\u7ec4\u7684\u4e3b\u952e\u6700\u5927\u7684\u8bb0\u5f55\uff0c\u5982\u4f55\u627e\u5230\u7ec4\u91cc\u6700\u5c0f\u7684\u8bb0\u5f55\u300d \uff1f\u6bd4\u5982\u69fd 3 \u5bf9\u5e94\u6700\u5927\u4e3b\u952e\u662f 12 \u7684\u8bb0\u5f55\uff0c\u90a3\u5982\u4f55\u627e\u5230\u6700\u5c0f\u8bb0\u5f55 9\u3002\u89e3\u51b3\u529e\u6cd5\u662f\uff1a\u901a\u8fc7\u69fd 3 \u627e\u5230 \u69fd 2 \u5bf9\u5e94\u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u4e3b\u952e\u4e3a 8 \u7684\u8bb0\u5f55\u3002\u4e3b\u952e\u4e3a 8 \u7684\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u5c31\u662f\u69fd 3 \u5f53\u4e2d\u4e3b\u952e\u6700\u5c0f\u7684 9 \u8bb0\u5f55\uff0c\u7136\u540e\u5f00\u59cb\u5411\u4e0b\u641c\u7d22 2 \u6b21\uff0c\u5b9a\u4f4d\u5230\u4e3b\u952e\u4e3a 11 \u7684\u8bb0\u5f55\uff0c\u53d6\u51fa\u8be5\u6761\u8bb0\u5f55\u7684\u4fe1\u606f\u5373\u4e3a\u6211\u4eec\u60f3\u8981\u67e5\u627e\u7684\u5185\u5bb9\u3002 \u770b\u5230\u7b2c\u4e09\u6b65\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u6709\u7684\u540c\u5b66\u4f1a\u7591\u95ee\uff0c\u5982\u679c\u67d0\u4e2a\u69fd\u5185\u7684\u8bb0\u5f55\u5f88\u591a\uff0c\u7136\u540e\u56e0\u4e3a\u8bb0\u5f55\u90fd\u662f\u5355\u5411\u94fe\u8868\u4e32\u8d77\u6765\u7684\uff0c\u90a3\u8fd9\u6837\u5728\u69fd\u5185\u67e5\u627e\u67d0\u4e2a\u8bb0\u5f55\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u5c31\u662f O(n) \u4e86\u5417\uff1f \u8fd9\u70b9\u4e0d\u7528\u62c5\u5fc3\uff0cInnoDB \u5bf9\u6bcf\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u6761\u6570\u90fd\u662f\u6709\u89c4\u5b9a\u7684\uff0c\u69fd\u5185\u7684\u8bb0\u5f55\u5c31\u53ea\u6709\u51e0\u6761\uff1a \u7b2c\u4e00\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u53ea\u80fd\u6709 1 \u6761\u8bb0\u5f55\uff1b \u6700\u540e\u4e00\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u6761\u6570\u8303\u56f4\u53ea\u80fd\u5728 1-8 \u6761\u4e4b\u95f4\uff1b \u5269\u4e0b\u7684\u5206\u7ec4\u4e2d\u8bb0\u5f55\u6761\u6570\u8303\u56f4\u53ea\u80fd\u5728 4-8 \u6761\u4e4b\u95f4\u3002 B+ \u6811\u662f\u5982\u4f55\u8fdb\u884c\u67e5\u8be2\u7684\uff1f \u00b6 \u4e0a\u9762\u6211\u4eec\u90fd\u662f\u5728\u8bf4\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u68c0\u7d22\uff0c\u56e0\u4e3a\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u662f\u6709\u9650\u7684\uff0c\u4e14\u4e3b\u952e\u503c\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u901a\u8fc7\u5bf9\u6240\u6709\u8bb0\u5f55\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u5c06\u7ec4\u53f7\uff08\u69fd\u53f7\uff09\u5b58\u50a8\u5230\u9875\u76ee\u5f55\uff0c\u4f7f\u5176\u8d77\u5230\u7d22\u5f15\u4f5c\u7528\uff0c\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u7684\u65b9\u6cd5\u5feb\u901f\u68c0\u7d22\u5230\u8bb0\u5f55\u5728\u54ea\u4e2a\u5206\u7ec4\uff0c\u6765\u964d\u4f4e\u68c0\u7d22\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002 \u4f46\u662f\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5b58\u50a8\u5927\u91cf\u7684\u8bb0\u5f55\u65f6\uff0c\u5c31\u9700\u8981\u591a\u4e2a\u6570\u636e\u9875\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u8003\u8651\u5982\u4f55\u5efa\u7acb\u5408\u9002\u7684\u7d22\u5f15\uff0c\u624d\u80fd\u65b9\u4fbf\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u7684\u9875\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c InnoDB \u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15 \u3002\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u6b21\u6570\u5bf9\u7d22\u5f15\u7684\u4f7f\u7528\u6548\u7387\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u6b64\u5728\u6784\u9020\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u6211\u4eec\u66f4\u503e\u5411\u4e8e\u91c7\u7528\u201c\u77ee\u80d6\u201d\u7684 B+ \u6811\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u6837\u6240\u9700\u8981\u8fdb\u884c\u7684\u78c1\u76d8 I/O \u6b21\u6570\u66f4\u5c11\uff0c\u800c\u4e14 B+ \u6811 \u66f4\u9002\u5408\u8fdb\u884c\u5173\u952e\u5b57\u7684\u8303\u56f4\u67e5\u8be2\u3002 InnoDB \u91cc\u7684 B+ \u6811\u4e2d\u7684**\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u6570\u636e\u9875**\uff0c\u7ed3\u6784\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u901a\u8fc7\u4e0a\u56fe\uff0c\u6211\u4eec\u770b\u51fa B+ \u6811\u7684\u7279\u70b9\uff1a \u53ea\u6709\u53f6\u5b50\u8282\u70b9\uff08\u6700\u5e95\u5c42\u7684\u8282\u70b9\uff09\u624d\u5b58\u653e\u4e86\u6570\u636e\uff0c\u975e\u53f6\u5b50\u8282\u70b9\uff08\u5176\u4ed6\u4e0a\u5c42\u8282\uff09\u4ec5\u7528\u6765\u5b58\u653e\u76ee\u5f55\u9879\u4f5c\u4e3a\u7d22\u5f15\u3002 \u975e\u53f6\u5b50\u8282\u70b9\u5206\u4e3a\u4e0d\u540c\u5c42\u6b21\uff0c\u901a\u8fc7\u5206\u5c42\u6765\u964d\u4f4e\u6bcf\u4e00\u5c42\u7684\u641c\u7d22\u91cf\uff1b \u6240\u6709\u8282\u70b9\u6309\u7167\u7d22\u5f15\u952e\u5927\u5c0f\u6392\u5e8f\uff0c\u6784\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u4fbf\u4e8e\u8303\u56f4\u67e5\u8be2\uff1b \u6211\u4eec\u518d\u770b\u770b B+ \u6811\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u67e5\u627e\u4e3b\u952e\u4e3a 6 \u7684\u8bb0\u5f55\uff0c\u4ee5\u4e0a\u56fe\u4e3a\u4f8b\u5b50\uff1a \u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u7b26\u5408\u9875\u5185\u8303\u56f4\u5305\u542b\u67e5\u8be2\u503c\u7684\u9875\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u4e3b\u952e\u503c\u4e3a 6\uff0c\u5728[1, 7)\u8303\u56f4\u4e4b\u95f4\uff0c\u6240\u4ee5\u5230\u9875 30 \u4e2d\u67e5\u627e\u66f4\u8be6\u7ec6\u7684\u76ee\u5f55\u9879\uff1b \u5728\u975e\u53f6\u5b50\u8282\u70b9\uff08\u987530\uff09\u4e2d\uff0c\u7ee7\u7eed\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u7b26\u5408\u9875\u5185\u8303\u56f4\u5305\u542b\u67e5\u8be2\u503c\u7684\u9875\uff0c\u4e3b\u952e\u503c\u5927\u4e8e 5\uff0c\u6240\u4ee5\u5c31\u5230\u53f6\u5b50\u8282\u70b9\uff08\u987516\uff09\u67e5\u627e\u8bb0\u5f55\uff1b \u63a5\u7740\uff0c\u5728\u53f6\u5b50\u8282\u70b9\uff08\u987516\uff09\u4e2d\uff0c\u901a\u8fc7\u69fd\u67e5\u627e\u8bb0\u5f55\u65f6\uff0c\u4f7f\u7528\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8981\u67e5\u8be2\u7684\u8bb0\u5f55\u5728\u54ea\u4e2a\u69fd\uff08\u54ea\u4e2a\u8bb0\u5f55\u5206\u7ec4\uff09\uff0c\u5b9a\u4f4d\u5230\u69fd\u540e\uff0c\u518d\u904d\u5386\u69fd\u5185\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u627e\u5230\u4e3b\u952e\u4e3a 6 \u7684\u8bb0\u5f55\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u5728\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u54ea\u4e00\u4e2a\u9875\u65f6\uff0c\u4e5f\u662f\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u5305\u542b\u8be5\u8bb0\u5f55\u7684\u9875\u3002\u5b9a\u4f4d\u5230\u8be5\u9875\u540e\uff0c\u53c8\u4f1a\u5728\u8be5\u9875\u5185\u8fdb\u884c\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u7684\u5206\u7ec4\uff08\u69fd\u53f7\uff09\uff0c\u6700\u540e\u5728\u5206\u7ec4\u5185\u8fdb\u884c\u904d\u5386\u67e5\u627e\u3002 \u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15 \u00b6 \u53e6\u5916\uff0c\u7d22\u5f15\u53c8\u53ef\u4ee5\u5206\u6210\u805a\u7c07\u7d22\u5f15\u548c\u975e\u805a\u7c07\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u5b83\u4eec\u533a\u522b\u5c31\u5728\u4e8e\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u6570\u636e\uff1a \u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff1b \u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u56e0\u4e3a\u8868\u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e00\u5b9a\u4f1a\u4e3a\u8868\u521b\u5efa\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff0c\u4e14\u7531\u4e8e\u6570\u636e\u5728\u7269\u7406\u4e0a\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\uff0c\u6240\u4ee5\u805a\u7c07\u7d22\u5f15\u53ea\u80fd\u6709\u4e00\u4e2a\u3002 InnoDB \u5728\u521b\u5efa\u805a\u7c07\u7d22\u5f15\u65f6\uff0c\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u9009\u62e9\u4e0d\u540c\u7684\u5217\u4f5c\u4e3a\u7d22\u5f15\uff1a \u5982\u679c\u6709\u4e3b\u952e\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e3b\u952e\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b \u5982\u679c\u6ca1\u6709\u4e3b\u952e\uff0c\u5c31\u9009\u62e9\u7b2c\u4e00\u4e2a\u4e0d\u5305\u542b NULL \u503c\u7684\u552f\u4e00\u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b \u5728\u4e0a\u9762\u4e24\u4e2a\u90fd\u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5c06\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9690\u5f0f\u81ea\u589e id \u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b \u4e00\u5f20\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff0c\u90a3\u4e3a\u4e86\u5b9e\u73b0\u975e\u4e3b\u952e\u5b57\u6bb5\u7684\u5feb\u901f\u641c\u7d22\uff0c\u5c31\u5f15\u51fa\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff08\u975e\u805a\u7c07\u7d22\u5f15/\u8f85\u52a9\u7d22\u5f15\uff09\uff0c\u5b83\u4e5f\u662f\u5229\u7528\u4e86 B+ \u6811\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f46\u662f\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5982\u4e0b\u56fe\uff0c\u6570\u636e\u90e8\u5206\u4e3a\u4e3b\u952e\u503c\uff1a \u56e0\u6b64\uff0c \u5982\u679c\u67d0\u4e2a\u67e5\u8be2\u8bed\u53e5\u4f7f\u7528\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u662f\u4e3b\u952e\u503c\uff0c\u8fd9\u65f6\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\u540e\uff0c\u9700\u8981\u53bb\u805a\u7c07\u7d22\u5f15\u4e2d\u83b7\u5f97\u6570\u636e\u884c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u56de\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u67e5\u4e24\u4e2a B+ \u6811\u624d\u80fd\u67e5\u5230\u6570\u636e\u3002\u4e0d\u8fc7\uff0c\u5f53\u67e5\u8be2\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\u65f6\uff0c\u56e0\u4e3a\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u5c31\u80fd\u67e5\u8be2\u5230\uff0c\u4e0d\u7528\u518d\u53bb\u805a\u7c07\u7d22\u5f15\u67e5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u7d22\u5f15\u8986\u76d6\u300d\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u67e5\u4e00\u4e2a B+ \u6811\u5c31\u80fd\u627e\u5230\u6570\u636e\u3002 \u603b\u7ed3 \u00b6 InnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u6570\u636e\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684\uff0c\u9ed8\u8ba4\u6570\u636e\u9875\u5927\u5c0f\u4e3a 16 KB\u3002\u6bcf\u4e2a\u6570\u636e\u9875\u4e4b\u95f4\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u7684\u5f62\u5f0f\u7ec4\u7ec7\u8d77\u6765\uff0c\u7269\u7406\u4e0a\u4e0d\u8fde\u7eed\uff0c\u4f46\u662f\u903b\u8f91\u4e0a\u8fde\u7eed\u3002 \u6570\u636e\u9875\u5185\u5305\u542b\u7528\u6237\u8bb0\u5f55\uff0c\u6bcf\u4e2a\u8bb0\u5f55\u4e4b\u95f4\u7528\u5355\u5411\u94fe\u8868\u7684\u65b9\u5f0f\u7ec4\u7ec7\u8d77\u6765\uff0c\u4e3a\u4e86\u52a0\u5feb\u5728\u6570\u636e\u9875\u5185\u9ad8\u6548\u67e5\u8be2\u8bb0\u5f55\uff0c\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u9875\u76ee\u5f55\uff0c\u9875\u76ee\u5f55\u5b58\u50a8\u5404\u4e2a\u69fd\uff08\u5206\u7ec4\uff09\uff0c\u4e14\u4e3b\u952e\u503c\u662f\u6709\u5e8f\u7684\uff0c\u4e8e\u662f\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u6cd5\u7684\u65b9\u5f0f\u8fdb\u884c\u68c0\u7d22\u4ece\u800c\u63d0\u9ad8\u6548\u7387\u3002 \u4e3a\u4e86\u9ad8\u6548\u67e5\u8be2\u8bb0\u5f55\u6240\u5728\u7684\u6570\u636e\u9875\uff0cInnoDB \u91c7\u7528 b+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u6570\u636e\u9875\u3002 \u5982\u679c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u662f\u5b9e\u9645\u6570\u636e\u7684\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u4e00\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff1b\u5982\u679c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u4e0d\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c\u662f\u4e3b\u952e\u503c\u5219\u5c31\u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4e00\u4e2a\u8868\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u3002 \u5728\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u67e5\u627e\u6570\u636e\u65f6\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\uff0c\u90a3\u4e48\u5c31\u662f\u300c\u7d22\u5f15\u8986\u76d6\u300d\u64cd\u4f5c\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\uff0c\u5c31\u9700\u8981\u5148\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\uff0c\u9700\u8981\u53bb\u805a\u7c07\u7d22\u5f15\u4e2d\u83b7\u5f97\u6570\u636e\u884c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u56de\u8868\u300d\u3002 \u5173\u4e8e\u7d22\u5f15\u7684\u5185\u5bb9\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u7d22\u5f15\u5931\u6548\u3001\u7d22\u5f15\u4f18\u5316\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5185\u5bb9\u6211\u4e0b\u6b21\u5728\u8bb2\u5566\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811"},{"location":"mysql/index/page/#b","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u5927\u5bb6\u80cc\u516b\u80a1\u6587\u7684\u65f6\u5019\uff0c\u90fd\u77e5\u9053 MySQL \u91cc InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u91c7\u7528 B+ \u6811\u6765\u7ec4\u7ec7\u6570\u636e\u7684\u3002 \u8fd9\u70b9\u6ca1\u9519\uff0c\u4f46\u662f\u5927\u5bb6\u77e5\u9053 B+ \u6811\u91cc\u7684\u8282\u70b9\u91cc\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u67e5\u8be2\u6570\u636e\u7684\u8fc7\u7a0b\u53c8\u662f\u600e\u6837\u7684\uff1f \u8fd9\u6b21\uff0c\u6211\u4eec**\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811**\uff0c\u770b\u770b\u6bcf\u4e2a\u8282\u70b9\u957f\u5565\u6837\u3002","title":"\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811"},{"location":"mysql/index/page/#innodb","text":"MySQL \u652f\u6301\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5b58\u50a8\u6570\u636e\u7684\u65b9\u5f0f\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u6211\u4eec\u6700\u5e38\u4f7f\u7528\u7684\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u6240\u4ee5\u5c31\u8ddf\u5927\u5bb6\u56fe\u89e3\u4e0bInnoDB \u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u7684\u3002 \u8bb0\u5f55\u662f\u6309\u7167\u884c\u6765\u5b58\u50a8\u7684\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7684\u8bfb\u53d6\u5e76\u4e0d\u4ee5\u300c\u884c\u300d\u4e3a\u5355\u4f4d\uff0c\u5426\u5219\u4e00\u6b21\u8bfb\u53d6\uff08\u4e5f\u5c31\u662f\u4e00\u6b21 I/O \u64cd\u4f5c\uff09\u53ea\u80fd\u5904\u7406\u4e00\u884c\u6570\u636e\uff0c\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\u3002 \u56e0\u6b64\uff0c InnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u6570\u636e\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u9700\u8981\u8bfb\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u5c06\u8fd9\u4e2a\u8bb0\u5f55\u672c\u8eab\u4ece\u78c1\u76d8\u8bfb\u51fa\u6765\uff0c\u800c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\uff0c\u5c06\u5176\u6574\u4f53\u8bfb\u5165\u5185\u5b58\u3002 \u6570\u636e\u5e93\u7684 I/O \u64cd\u4f5c\u7684\u6700\u5c0f\u5355\u4f4d\u662f\u9875\uff0c InnoDB \u6570\u636e\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u662f 16KB \uff0c\u610f\u5473\u7740\u6570\u636e\u5e93\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u4ee5 16KB \u4e3a\u5355\u4f4d\u7684\uff0c\u4e00\u6b21\u6700\u5c11\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6 16K \u7684\u5185\u5bb9\u5230\u5185\u5b58\u4e2d\uff0c\u4e00\u6b21\u6700\u5c11\u628a\u5185\u5b58\u4e2d\u7684 16K \u5185\u5bb9\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002 \u6570\u636e\u9875\u5305\u62ec\u4e03\u4e2a\u90e8\u5206\uff0c\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a \u8fd9 7 \u4e2a\u90e8\u5206\u7684\u4f5c\u7528\u5982\u4e0b\u56fe\uff1a \u5728 File Header \u4e2d\u6709\u4e24\u4e2a\u6307\u9488\uff0c\u5206\u522b\u6307\u5411\u4e0a\u4e00\u4e2a\u6570\u636e\u9875\u548c\u4e0b\u4e00\u4e2a\u6570\u636e\u9875\uff0c\u8fde\u63a5\u8d77\u6765\u7684\u9875\u76f8\u5f53\u4e8e\u4e00\u4e2a\u53cc\u5411\u7684\u94fe\u8868\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u91c7\u7528\u94fe\u8868\u7684\u7ed3\u6784\u662f\u8ba9\u6570\u636e\u9875\u4e4b\u95f4\u4e0d\u9700\u8981\u662f\u7269\u7406\u4e0a\u7684\u8fde\u7eed\u7684\uff0c\u800c\u662f\u903b\u8f91\u4e0a\u7684\u8fde\u7eed\u3002 \u6570\u636e\u9875\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5b58\u50a8\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u6240\u4ee5\u91cd\u70b9\u8bf4\u4e00\u4e0b\u6570\u636e\u9875\u4e2d\u7684 User Records \u662f\u600e\u4e48\u7ec4\u7ec7\u6570\u636e\u7684\u3002 \u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u6309\u7167\u300c\u4e3b\u952e\u300d\u987a\u5e8f\u7ec4\u6210\u5355\u5411\u94fe\u8868 \uff0c\u5355\u5411\u94fe\u8868\u7684\u7279\u70b9\u5c31\u662f\u63d2\u5165\u3001\u5220\u9664\u975e\u5e38\u65b9\u4fbf\uff0c\u4f46\u662f\u68c0\u7d22\u6548\u7387\u4e0d\u9ad8\uff0c\u6700\u5dee\u7684\u60c5\u51b5\u4e0b\u9700\u8981\u904d\u5386\u94fe\u8868\u4e0a\u7684\u6240\u6709\u8282\u70b9\u624d\u80fd\u5b8c\u6210\u68c0\u7d22\u3002 \u56e0\u6b64\uff0c\u6570\u636e\u9875\u4e2d\u6709\u4e00\u4e2a**\u9875\u76ee\u5f55**\uff0c\u8d77\u5230\u8bb0\u5f55\u7684\u7d22\u5f15\u4f5c\u7528\uff0c\u5c31\u50cf\u6211\u4eec\u4e66\u90a3\u6837\uff0c\u9488\u5bf9\u4e66\u4e2d\u5185\u5bb9\u7684\u6bcf\u4e2a\u7ae0\u8282\u8bbe\u7acb\u4e86\u4e00\u4e2a\u76ee\u5f55\uff0c\u60f3\u770b\u67d0\u4e2a\u7ae0\u8282\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u67e5\u770b\u76ee\u5f55\uff0c\u5feb\u901f\u627e\u5230\u5bf9\u5e94\u7684\u7ae0\u8282\u7684\u9875\u6570\uff0c\u800c\u6570\u636e\u9875\u4e2d\u7684\u9875\u76ee\u5f55\u5c31\u662f\u4e3a\u4e86\u80fd\u5feb\u901f\u627e\u5230\u8bb0\u5f55\u3002 \u90a3 InnoDB \u662f\u5982\u4f55\u7ed9\u8bb0\u5f55\u521b\u5efa\u9875\u76ee\u5f55\u7684\u5462\uff1f\u9875\u76ee\u5f55\u4e0e\u8bb0\u5f55\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u9875\u76ee\u5f55\u521b\u5efa\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a \u5c06\u6240\u6709\u7684\u8bb0\u5f55\u5212\u5206\u6210\u51e0\u4e2a\u7ec4\uff0c\u8fd9\u4e9b\u8bb0\u5f55\u5305\u62ec\u6700\u5c0f\u8bb0\u5f55\u548c\u6700\u5927\u8bb0\u5f55\uff0c\u4f46\u4e0d\u5305\u62ec\u6807\u8bb0\u4e3a\u201c\u5df2\u5220\u9664\u201d\u7684\u8bb0\u5f55\uff1b \u6bcf\u4e2a\u8bb0\u5f55\u7ec4\u7684\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u5c31\u662f\u7ec4\u5185\u6700\u5927\u7684\u90a3\u6761\u8bb0\u5f55\uff0c\u5e76\u4e14\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u5934\u4fe1\u606f\u4e2d\u4f1a\u5b58\u50a8\u8be5\u7ec4\u4e00\u5171\u6709\u591a\u5c11\u6761\u8bb0\u5f55\uff0c\u4f5c\u4e3a n_owned \u5b57\u6bb5\uff08\u4e0a\u56fe\u4e2d\u7c89\u7ea2\u8272\u5b57\u6bb5\uff09 \u9875\u76ee\u5f55\u7528\u6765\u5b58\u50a8\u6bcf\u7ec4\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u5730\u5740\u504f\u79fb\u91cf\uff0c\u8fd9\u4e9b\u5730\u5740\u504f\u79fb\u91cf\u4f1a\u6309\u7167\u5148\u540e\u987a\u5e8f\u5b58\u50a8\u8d77\u6765\uff0c\u6bcf\u7ec4\u7684\u5730\u5740\u504f\u79fb\u91cf\u4e5f\u88ab\u79f0\u4e4b\u4e3a\u69fd\uff08slot\uff09\uff0c \u6bcf\u4e2a\u69fd\u76f8\u5f53\u4e8e\u6307\u9488\u6307\u5411\u4e86\u4e0d\u540c\u7ec4\u7684\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55 \u3002 \u4ece\u56fe\u53ef\u4ee5\u770b\u5230\uff0c \u9875\u76ee\u5f55\u5c31\u662f\u7531\u591a\u4e2a\u69fd\u7ec4\u6210\u7684\uff0c\u69fd\u76f8\u5f53\u4e8e\u5206\u7ec4\u8bb0\u5f55\u7684\u7d22\u5f15 \u3002\u7136\u540e\uff0c\u56e0\u4e3a\u8bb0\u5f55\u662f\u6309\u7167\u300c\u4e3b\u952e\u503c\u300d\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u7684\uff0c\u6240\u4ee5**\u6211\u4eec\u901a\u8fc7\u69fd\u67e5\u627e\u8bb0\u5f55\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8981\u67e5\u8be2\u7684\u8bb0\u5f55\u5728\u54ea\u4e2a\u69fd\uff08\u54ea\u4e2a\u8bb0\u5f55\u5206\u7ec4\uff09\uff0c\u5b9a\u4f4d\u5230\u69fd\u540e\uff0c\u518d\u904d\u5386\u69fd\u5185\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u8bb0\u5f55**\uff0c\u65e0\u9700\u4ece\u6700\u5c0f\u8bb0\u5f55\u5f00\u59cb\u904d\u5386\u6574\u4e2a\u9875\u4e2d\u7684\u8bb0\u5f55\u94fe\u8868\u3002 \u4ee5\u4e0a\u9762\u90a3\u5f20\u56fe\u4e3e\u4e2a\u4f8b\u5b50\uff0c5 \u4e2a\u69fd\u7684\u7f16\u53f7\u5206\u522b\u4e3a 0\uff0c1\uff0c2\uff0c3\uff0c4\uff0c\u6211\u60f3\u67e5\u627e\u4e3b\u952e\u4e3a 11 \u7684\u7528\u6237\u8bb0\u5f55\uff1a \u5148\u4e8c\u5206\u5f97\u51fa\u69fd\u4e2d\u95f4\u4f4d\u662f (0+4)/2=2 \uff0c2\u53f7\u69fd\u91cc\u6700\u5927\u7684\u8bb0\u5f55\u4e3a 8\u3002\u56e0\u4e3a 11 > 8\uff0c\u6240\u4ee5\u9700\u8981\u4ece 2 \u53f7\u69fd\u540e\u7ee7\u7eed\u641c\u7d22\u8bb0\u5f55\uff1b \u518d\u4f7f\u7528\u4e8c\u5206\u641c\u7d22\u51fa 2 \u53f7\u548c 4 \u69fd\u7684\u4e2d\u95f4\u4f4d\u662f (2+4)/2= 3\uff0c3 \u53f7\u69fd\u91cc\u6700\u5927\u7684\u8bb0\u5f55\u4e3a 12\u3002\u56e0\u4e3a 11 < 12\uff0c\u6240\u4ee5\u4e3b\u952e\u4e3a 11 \u7684\u8bb0\u5f55\u5728 3 \u53f7\u69fd\u91cc\uff1b \u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0c \u300c\u69fd\u5bf9\u5e94\u7684\u503c\u90fd\u662f\u8fd9\u4e2a\u7ec4\u7684\u4e3b\u952e\u6700\u5927\u7684\u8bb0\u5f55\uff0c\u5982\u4f55\u627e\u5230\u7ec4\u91cc\u6700\u5c0f\u7684\u8bb0\u5f55\u300d \uff1f\u6bd4\u5982\u69fd 3 \u5bf9\u5e94\u6700\u5927\u4e3b\u952e\u662f 12 \u7684\u8bb0\u5f55\uff0c\u90a3\u5982\u4f55\u627e\u5230\u6700\u5c0f\u8bb0\u5f55 9\u3002\u89e3\u51b3\u529e\u6cd5\u662f\uff1a\u901a\u8fc7\u69fd 3 \u627e\u5230 \u69fd 2 \u5bf9\u5e94\u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u4e3b\u952e\u4e3a 8 \u7684\u8bb0\u5f55\u3002\u4e3b\u952e\u4e3a 8 \u7684\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u5c31\u662f\u69fd 3 \u5f53\u4e2d\u4e3b\u952e\u6700\u5c0f\u7684 9 \u8bb0\u5f55\uff0c\u7136\u540e\u5f00\u59cb\u5411\u4e0b\u641c\u7d22 2 \u6b21\uff0c\u5b9a\u4f4d\u5230\u4e3b\u952e\u4e3a 11 \u7684\u8bb0\u5f55\uff0c\u53d6\u51fa\u8be5\u6761\u8bb0\u5f55\u7684\u4fe1\u606f\u5373\u4e3a\u6211\u4eec\u60f3\u8981\u67e5\u627e\u7684\u5185\u5bb9\u3002 \u770b\u5230\u7b2c\u4e09\u6b65\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u6709\u7684\u540c\u5b66\u4f1a\u7591\u95ee\uff0c\u5982\u679c\u67d0\u4e2a\u69fd\u5185\u7684\u8bb0\u5f55\u5f88\u591a\uff0c\u7136\u540e\u56e0\u4e3a\u8bb0\u5f55\u90fd\u662f\u5355\u5411\u94fe\u8868\u4e32\u8d77\u6765\u7684\uff0c\u90a3\u8fd9\u6837\u5728\u69fd\u5185\u67e5\u627e\u67d0\u4e2a\u8bb0\u5f55\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u5c31\u662f O(n) \u4e86\u5417\uff1f \u8fd9\u70b9\u4e0d\u7528\u62c5\u5fc3\uff0cInnoDB \u5bf9\u6bcf\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u6761\u6570\u90fd\u662f\u6709\u89c4\u5b9a\u7684\uff0c\u69fd\u5185\u7684\u8bb0\u5f55\u5c31\u53ea\u6709\u51e0\u6761\uff1a \u7b2c\u4e00\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u53ea\u80fd\u6709 1 \u6761\u8bb0\u5f55\uff1b \u6700\u540e\u4e00\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u6761\u6570\u8303\u56f4\u53ea\u80fd\u5728 1-8 \u6761\u4e4b\u95f4\uff1b \u5269\u4e0b\u7684\u5206\u7ec4\u4e2d\u8bb0\u5f55\u6761\u6570\u8303\u56f4\u53ea\u80fd\u5728 4-8 \u6761\u4e4b\u95f4\u3002","title":"InnoDB \u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u7684\uff1f"},{"location":"mysql/index/page/#b_1","text":"\u4e0a\u9762\u6211\u4eec\u90fd\u662f\u5728\u8bf4\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u68c0\u7d22\uff0c\u56e0\u4e3a\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u662f\u6709\u9650\u7684\uff0c\u4e14\u4e3b\u952e\u503c\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u901a\u8fc7\u5bf9\u6240\u6709\u8bb0\u5f55\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u5c06\u7ec4\u53f7\uff08\u69fd\u53f7\uff09\u5b58\u50a8\u5230\u9875\u76ee\u5f55\uff0c\u4f7f\u5176\u8d77\u5230\u7d22\u5f15\u4f5c\u7528\uff0c\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u7684\u65b9\u6cd5\u5feb\u901f\u68c0\u7d22\u5230\u8bb0\u5f55\u5728\u54ea\u4e2a\u5206\u7ec4\uff0c\u6765\u964d\u4f4e\u68c0\u7d22\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002 \u4f46\u662f\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5b58\u50a8\u5927\u91cf\u7684\u8bb0\u5f55\u65f6\uff0c\u5c31\u9700\u8981\u591a\u4e2a\u6570\u636e\u9875\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u8003\u8651\u5982\u4f55\u5efa\u7acb\u5408\u9002\u7684\u7d22\u5f15\uff0c\u624d\u80fd\u65b9\u4fbf\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u7684\u9875\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c InnoDB \u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15 \u3002\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u6b21\u6570\u5bf9\u7d22\u5f15\u7684\u4f7f\u7528\u6548\u7387\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u6b64\u5728\u6784\u9020\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u6211\u4eec\u66f4\u503e\u5411\u4e8e\u91c7\u7528\u201c\u77ee\u80d6\u201d\u7684 B+ \u6811\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u6837\u6240\u9700\u8981\u8fdb\u884c\u7684\u78c1\u76d8 I/O \u6b21\u6570\u66f4\u5c11\uff0c\u800c\u4e14 B+ \u6811 \u66f4\u9002\u5408\u8fdb\u884c\u5173\u952e\u5b57\u7684\u8303\u56f4\u67e5\u8be2\u3002 InnoDB \u91cc\u7684 B+ \u6811\u4e2d\u7684**\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u6570\u636e\u9875**\uff0c\u7ed3\u6784\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u901a\u8fc7\u4e0a\u56fe\uff0c\u6211\u4eec\u770b\u51fa B+ \u6811\u7684\u7279\u70b9\uff1a \u53ea\u6709\u53f6\u5b50\u8282\u70b9\uff08\u6700\u5e95\u5c42\u7684\u8282\u70b9\uff09\u624d\u5b58\u653e\u4e86\u6570\u636e\uff0c\u975e\u53f6\u5b50\u8282\u70b9\uff08\u5176\u4ed6\u4e0a\u5c42\u8282\uff09\u4ec5\u7528\u6765\u5b58\u653e\u76ee\u5f55\u9879\u4f5c\u4e3a\u7d22\u5f15\u3002 \u975e\u53f6\u5b50\u8282\u70b9\u5206\u4e3a\u4e0d\u540c\u5c42\u6b21\uff0c\u901a\u8fc7\u5206\u5c42\u6765\u964d\u4f4e\u6bcf\u4e00\u5c42\u7684\u641c\u7d22\u91cf\uff1b \u6240\u6709\u8282\u70b9\u6309\u7167\u7d22\u5f15\u952e\u5927\u5c0f\u6392\u5e8f\uff0c\u6784\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u4fbf\u4e8e\u8303\u56f4\u67e5\u8be2\uff1b \u6211\u4eec\u518d\u770b\u770b B+ \u6811\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u67e5\u627e\u4e3b\u952e\u4e3a 6 \u7684\u8bb0\u5f55\uff0c\u4ee5\u4e0a\u56fe\u4e3a\u4f8b\u5b50\uff1a \u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u7b26\u5408\u9875\u5185\u8303\u56f4\u5305\u542b\u67e5\u8be2\u503c\u7684\u9875\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u4e3b\u952e\u503c\u4e3a 6\uff0c\u5728[1, 7)\u8303\u56f4\u4e4b\u95f4\uff0c\u6240\u4ee5\u5230\u9875 30 \u4e2d\u67e5\u627e\u66f4\u8be6\u7ec6\u7684\u76ee\u5f55\u9879\uff1b \u5728\u975e\u53f6\u5b50\u8282\u70b9\uff08\u987530\uff09\u4e2d\uff0c\u7ee7\u7eed\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u7b26\u5408\u9875\u5185\u8303\u56f4\u5305\u542b\u67e5\u8be2\u503c\u7684\u9875\uff0c\u4e3b\u952e\u503c\u5927\u4e8e 5\uff0c\u6240\u4ee5\u5c31\u5230\u53f6\u5b50\u8282\u70b9\uff08\u987516\uff09\u67e5\u627e\u8bb0\u5f55\uff1b \u63a5\u7740\uff0c\u5728\u53f6\u5b50\u8282\u70b9\uff08\u987516\uff09\u4e2d\uff0c\u901a\u8fc7\u69fd\u67e5\u627e\u8bb0\u5f55\u65f6\uff0c\u4f7f\u7528\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8981\u67e5\u8be2\u7684\u8bb0\u5f55\u5728\u54ea\u4e2a\u69fd\uff08\u54ea\u4e2a\u8bb0\u5f55\u5206\u7ec4\uff09\uff0c\u5b9a\u4f4d\u5230\u69fd\u540e\uff0c\u518d\u904d\u5386\u69fd\u5185\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u627e\u5230\u4e3b\u952e\u4e3a 6 \u7684\u8bb0\u5f55\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u5728\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u54ea\u4e00\u4e2a\u9875\u65f6\uff0c\u4e5f\u662f\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u5305\u542b\u8be5\u8bb0\u5f55\u7684\u9875\u3002\u5b9a\u4f4d\u5230\u8be5\u9875\u540e\uff0c\u53c8\u4f1a\u5728\u8be5\u9875\u5185\u8fdb\u884c\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u7684\u5206\u7ec4\uff08\u69fd\u53f7\uff09\uff0c\u6700\u540e\u5728\u5206\u7ec4\u5185\u8fdb\u884c\u904d\u5386\u67e5\u627e\u3002","title":"B+ \u6811\u662f\u5982\u4f55\u8fdb\u884c\u67e5\u8be2\u7684\uff1f"},{"location":"mysql/index/page/#_1","text":"\u53e6\u5916\uff0c\u7d22\u5f15\u53c8\u53ef\u4ee5\u5206\u6210\u805a\u7c07\u7d22\u5f15\u548c\u975e\u805a\u7c07\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u5b83\u4eec\u533a\u522b\u5c31\u5728\u4e8e\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u6570\u636e\uff1a \u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff1b \u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u56e0\u4e3a\u8868\u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e00\u5b9a\u4f1a\u4e3a\u8868\u521b\u5efa\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff0c\u4e14\u7531\u4e8e\u6570\u636e\u5728\u7269\u7406\u4e0a\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\uff0c\u6240\u4ee5\u805a\u7c07\u7d22\u5f15\u53ea\u80fd\u6709\u4e00\u4e2a\u3002 InnoDB \u5728\u521b\u5efa\u805a\u7c07\u7d22\u5f15\u65f6\uff0c\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u9009\u62e9\u4e0d\u540c\u7684\u5217\u4f5c\u4e3a\u7d22\u5f15\uff1a \u5982\u679c\u6709\u4e3b\u952e\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e3b\u952e\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b \u5982\u679c\u6ca1\u6709\u4e3b\u952e\uff0c\u5c31\u9009\u62e9\u7b2c\u4e00\u4e2a\u4e0d\u5305\u542b NULL \u503c\u7684\u552f\u4e00\u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b \u5728\u4e0a\u9762\u4e24\u4e2a\u90fd\u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5c06\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9690\u5f0f\u81ea\u589e id \u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b \u4e00\u5f20\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff0c\u90a3\u4e3a\u4e86\u5b9e\u73b0\u975e\u4e3b\u952e\u5b57\u6bb5\u7684\u5feb\u901f\u641c\u7d22\uff0c\u5c31\u5f15\u51fa\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff08\u975e\u805a\u7c07\u7d22\u5f15/\u8f85\u52a9\u7d22\u5f15\uff09\uff0c\u5b83\u4e5f\u662f\u5229\u7528\u4e86 B+ \u6811\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f46\u662f\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5982\u4e0b\u56fe\uff0c\u6570\u636e\u90e8\u5206\u4e3a\u4e3b\u952e\u503c\uff1a \u56e0\u6b64\uff0c \u5982\u679c\u67d0\u4e2a\u67e5\u8be2\u8bed\u53e5\u4f7f\u7528\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u662f\u4e3b\u952e\u503c\uff0c\u8fd9\u65f6\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\u540e\uff0c\u9700\u8981\u53bb\u805a\u7c07\u7d22\u5f15\u4e2d\u83b7\u5f97\u6570\u636e\u884c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u56de\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u67e5\u4e24\u4e2a B+ \u6811\u624d\u80fd\u67e5\u5230\u6570\u636e\u3002\u4e0d\u8fc7\uff0c\u5f53\u67e5\u8be2\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\u65f6\uff0c\u56e0\u4e3a\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u5c31\u80fd\u67e5\u8be2\u5230\uff0c\u4e0d\u7528\u518d\u53bb\u805a\u7c07\u7d22\u5f15\u67e5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u7d22\u5f15\u8986\u76d6\u300d\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u67e5\u4e00\u4e2a B+ \u6811\u5c31\u80fd\u627e\u5230\u6570\u636e\u3002","title":"\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15"},{"location":"mysql/index/page/#_2","text":"InnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u6570\u636e\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684\uff0c\u9ed8\u8ba4\u6570\u636e\u9875\u5927\u5c0f\u4e3a 16 KB\u3002\u6bcf\u4e2a\u6570\u636e\u9875\u4e4b\u95f4\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u7684\u5f62\u5f0f\u7ec4\u7ec7\u8d77\u6765\uff0c\u7269\u7406\u4e0a\u4e0d\u8fde\u7eed\uff0c\u4f46\u662f\u903b\u8f91\u4e0a\u8fde\u7eed\u3002 \u6570\u636e\u9875\u5185\u5305\u542b\u7528\u6237\u8bb0\u5f55\uff0c\u6bcf\u4e2a\u8bb0\u5f55\u4e4b\u95f4\u7528\u5355\u5411\u94fe\u8868\u7684\u65b9\u5f0f\u7ec4\u7ec7\u8d77\u6765\uff0c\u4e3a\u4e86\u52a0\u5feb\u5728\u6570\u636e\u9875\u5185\u9ad8\u6548\u67e5\u8be2\u8bb0\u5f55\uff0c\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u9875\u76ee\u5f55\uff0c\u9875\u76ee\u5f55\u5b58\u50a8\u5404\u4e2a\u69fd\uff08\u5206\u7ec4\uff09\uff0c\u4e14\u4e3b\u952e\u503c\u662f\u6709\u5e8f\u7684\uff0c\u4e8e\u662f\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u6cd5\u7684\u65b9\u5f0f\u8fdb\u884c\u68c0\u7d22\u4ece\u800c\u63d0\u9ad8\u6548\u7387\u3002 \u4e3a\u4e86\u9ad8\u6548\u67e5\u8be2\u8bb0\u5f55\u6240\u5728\u7684\u6570\u636e\u9875\uff0cInnoDB \u91c7\u7528 b+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u6570\u636e\u9875\u3002 \u5982\u679c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u662f\u5b9e\u9645\u6570\u636e\u7684\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u4e00\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff1b\u5982\u679c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u4e0d\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c\u662f\u4e3b\u952e\u503c\u5219\u5c31\u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4e00\u4e2a\u8868\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u3002 \u5728\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u67e5\u627e\u6570\u636e\u65f6\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\uff0c\u90a3\u4e48\u5c31\u662f\u300c\u7d22\u5f15\u8986\u76d6\u300d\u64cd\u4f5c\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\uff0c\u5c31\u9700\u8981\u5148\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\uff0c\u9700\u8981\u53bb\u805a\u7c07\u7d22\u5f15\u4e2d\u83b7\u5f97\u6570\u636e\u884c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u56de\u8868\u300d\u3002 \u5173\u4e8e\u7d22\u5f15\u7684\u5185\u5bb9\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u7d22\u5f15\u5931\u6548\u3001\u7d22\u5f15\u4f18\u5316\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5185\u5bb9\u6211\u4e0b\u6b21\u5728\u8bb2\u5566\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/index/why_index_chose_bpuls_tree/","text":"\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u300c\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f\u300d\u8fd9\u53e5\u8bdd\uff0c\u662f\u4e0d\u662f\u5728\u9762\u8bd5\u65f6\u7ecf\u5e38\u51fa\u73b0\u3002 \u8981\u89e3\u91ca\u8fd9\u4e2a\u95ee\u9898\uff0c\u5176\u5b9e\u4e0d\u5355\u5355\u8981\u4ece\u6570\u636e\u7ed3\u6784\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u8fd8\u8981\u8003\u8651\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\uff0c\u56e0\u4e3a MySQL \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\u561b\u3002 \u8fd9\u6b21\uff0c\u5c31\u8ddf\u5927\u5bb6\u4e00\u5c42\u4e00\u5c42\u7684\u5206\u6790\u8fd9\u4e2a\u95ee\u9898\uff0c\u56fe\u4e2d\u5305\u542b\u5927\u91cf\u7684\u52a8\u56fe\u6765\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\uff0c\u76f8\u4fe1\u770b\u5b8c\u4f60\u5c31\u62ff\u634f\u8fd9\u9053\u9898\u76ee\u4e86\uff01 \u600e\u6837\u7684\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u662f\u597d\u7684\uff1f \u00b6 MySQL \u7684\u6570\u636e\u662f\u6301\u4e45\u5316\u7684\uff0c\u610f\u5473\u7740\u6570\u636e\uff08\u7d22\u5f15+\u8bb0\u5f55\uff09\u662f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u5373\u4f7f\u8bbe\u5907\u65ad\u7535\u4e86\uff0c\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002 \u78c1\u76d8\u662f\u4e00\u4e2a\u6162\u7684\u79bb\u8c31\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6709\u591a\u79bb\u8c31\u5462\uff1f \u4eba\u5bb6\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u662f\u7eb3\u79d2\u7ea7\u522b\u7684\uff0c\u800c\u78c1\u76d8\u8bbf\u95ee\u7684\u901f\u5ea6\u662f\u6beb\u79d2\u7ea7\u522b\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bfb\u53d6\u540c\u6837\u5927\u5c0f\u7684\u6570\u636e\uff0c\u78c1\u76d8\u4e2d\u8bfb\u53d6\u7684\u901f\u5ea6\u6bd4\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u7684\u901f\u5ea6\u8981\u6162\u4e0a\u4e07\u500d\uff0c\u751a\u81f3\u51e0\u5341\u4e07\u500d\u3002 \u78c1\u76d8\u8bfb\u5199\u7684\u6700\u5c0f\u5355\u4f4d\u662f**\u6247\u533a**\uff0c\u6247\u533a\u7684\u5927\u5c0f\u53ea\u6709 512B \u5927\u5c0f\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e00\u6b21\u4f1a\u8bfb\u5199\u591a\u4e2a\u6247\u533a\uff0c\u6240\u4ee5**\u64cd\u4f5c\u7cfb\u7edf\u7684\u6700\u5c0f\u8bfb\u5199\u5355\u4f4d\u662f\u5757\uff08Block\uff09\u3002Linux \u4e2d\u7684\u5757\u5927\u5c0f\u4e3a 4KB **\uff0c\u4e5f\u5c31\u662f\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u4f1a\u76f4\u63a5\u8bfb\u5199 8 \u4e2a\u6247\u533a\u3002 \u7531\u4e8e\u6570\u636e\u5e93\u7684\u7d22\u5f15\u662f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\uff0c\u56e0\u6b64\u5f53\u6211\u4eec\u901a\u8fc7\u7d22\u5f15\u67e5\u627e\u67d0\u884c\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5148\u4ece\u78c1\u76d8\u8bfb\u53d6\u7d22\u5f15\u5230\u5185\u5b58\uff0c\u518d\u901a\u8fc7\u7d22\u5f15\u4ece\u78c1\u76d8\u4e2d\u627e\u5230\u67d0\u884c\u6570\u636e\uff0c\u7136\u540e\u8bfb\u5165\u5230\u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u8bf4\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u53d1\u751f\u591a\u6b21\u78c1\u76d8 I/O\uff0c\u800c\u78c1\u76d8 I/O \u6b21\u6570\u8d8a\u591a\uff0c\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4e5f\u5c31\u8d8a\u5927\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5e0c\u671b\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u4e2d\u5b8c\u6210\u67e5\u8be2\u5de5\u4f5c\uff0c\u56e0\u4e3a\u78c1\u76d8 I/O \u64cd\u4f5c\u8d8a\u5c11\uff0c\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4e5f\u5c31\u8d8a\u5c0f\u3002 \u53e6\u5916\uff0cMySQL \u662f\u652f\u6301\u8303\u56f4\u67e5\u627e\u7684\uff0c\u6240\u4ee5\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u4e0d\u4ec5\u8981\u80fd\u9ad8\u6548\u5730\u67e5\u8be2\u67d0\u4e00\u4e2a\u8bb0\u5f55\uff0c\u800c\u4e14\u4e5f\u8981\u80fd\u9ad8\u6548\u5730\u6267\u884c\u8303\u56f4\u67e5\u627e\u3002 \u6240\u4ee5\uff0c\u8981\u8bbe\u8ba1\u4e00\u4e2a\u9002\u5408 MySQL \u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u81f3\u5c11\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a \u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u4e2d\u5b8c\u6210\u67e5\u8be2\u5de5\u4f5c\uff1b \u8981\u80fd\u9ad8\u6548\u5730\u67e5\u8be2\u67d0\u4e00\u4e2a\u8bb0\u5f55\uff0c\u4e5f\u8981\u80fd\u9ad8\u6548\u5730\u6267\u884c\u8303\u56f4\u67e5\u627e\uff1b \u5206\u6790\u5b8c\u8981\u6c42\u540e\uff0c\u6211\u4eec\u9488\u5bf9\u6bcf\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u5206\u6790\u4e00\u4e0b\u3002 \u4ec0\u4e48\u662f\u4e8c\u5206\u67e5\u627e\uff1f \u00b6 \u7d22\u5f15\u6570\u636e\u6700\u597d\u80fd\u6309\u987a\u5e8f\u6392\u5217\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u7528\u300c\u4e8c\u5206\u67e5\u627e\u6cd5\u300d\u9ad8\u6548\u5b9a\u4f4d\u6570\u636e\u3002 \u5047\u8bbe\u6211\u4eec\u73b0\u5728\u7528\u6570\u7ec4\u6765\u5b58\u50a8\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0b\u9762\u6709\u4e00\u4e2a\u6392\u5e8f\u7684\u6570\u7ec4\uff0c\u5982\u679c\u8981\u4ece\u4e2d\u627e\u51fa\u6570\u5b57 3\uff0c\u6700\u7b80\u5355\u529e\u6cd5\u5c31\u662f\u4ece\u5934\u4f9d\u6b21\u904d\u5386\u67e5\u8be2\uff0c\u8fd9\u79cd\u65b9\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\uff0c\u67e5\u8be2\u6548\u7387\u5e76\u4e0d\u9ad8\u3002\u56e0\u4e3a\u8be5\u6570\u7ec4\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4e8c\u5206\u67e5\u627e\u6cd5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u5f20\u91c7\u7528\u4e8c\u5206\u6cd5\u7684\u67e5\u8be2\u8fc7\u7a0b\u56fe\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e8c\u5206\u67e5\u627e\u6cd5\u6bcf\u6b21\u90fd\u628a\u67e5\u8be2\u7684\u8303\u56f4\u51cf\u534a\uff0c\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u964d\u5230\u4e86 O(logn)\uff0c\u4f46\u662f\u6bcf\u6b21\u67e5\u627e\u90fd\u9700\u8981\u4e0d\u65ad\u8ba1\u7b97\u4e2d\u95f4\u4f4d\u7f6e\u3002 \u4ec0\u4e48\u662f\u4e8c\u5206\u67e5\u627e\u6811\uff1f \u00b6 \u7528\u6570\u7ec4\u6765\u5b9e\u73b0\u7ebf\u6027\u6392\u5e8f\u7684\u6570\u636e\u867d\u7136\u7b80\u5355\u597d\u7528\uff0c\u4f46\u662f\u63d2\u5165\u65b0\u5143\u7d20\u7684\u65f6\u5019\u6027\u80fd\u592a\u4f4e\u3002 \u56e0\u4e3a\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u9700\u8981\u5c06\u8fd9\u4e2a\u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709\u5143\u7d20\u540e\u79fb\u4e00\u4f4d\uff0c\u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u53d1\u751f\u5728\u78c1\u76d8\u4e2d\u5462\uff1f\u8fd9\u5fc5\u7136\u662f\u707e\u96be\u6027\u7684\u3002\u56e0\u4e3a\u78c1\u76d8\u7684\u901f\u5ea6\u6bd4\u5185\u5b58\u6162\u51e0\u5341\u4e07\u500d\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u7528\u4e00\u79cd\u7ebf\u6027\u7ed3\u6784\u5c06\u78c1\u76d8\u6392\u5e8f\u3002 \u5176\u6b21\uff0c\u6709\u5e8f\u7684\u6570\u7ec4\u5728\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u67e5\u627e\u90fd\u8981\u4e0d\u65ad\u8ba1\u7b97\u4e2d\u95f4\u7684\u4f4d\u7f6e\u3002 \u90a3\u6211\u4eec\u80fd\u4e0d\u80fd\u8bbe\u8ba1\u4e00\u4e2a\u975e\u7ebf\u5f62\u4e14\u5929\u7136\u9002\u5408\u4e8c\u5206\u67e5\u627e\u7684\u6570\u636e\u7ed3\u6784\u5462\uff1f \u6709\u7684\uff0c\u8bf7\u770b\u4e0b\u56fe\u8fd9\u4e2a\u795e\u5947\u7684\u64cd\u4f5c\uff0c\u627e\u5230\u6240\u6709\u4e8c\u5206\u67e5\u627e\u4e2d\u7528\u5230\u7684\u6240\u6709\u4e2d\u95f4\u8282\u70b9\uff0c\u628a\u4ed6\u4eec\u7528\u6307\u9488\u8fde\u8d77\u6765\uff0c\u5e76\u5c06\u6700\u4e2d\u95f4\u7684\u8282\u70b9\u4f5c\u4e3a\u6839\u8282\u70b9\u3002 \u600e\u4e48\u6837\uff1f\u662f\u4e0d\u662f\u53d8\u6210\u4e86\u4e8c\u53c9\u6811\uff0c\u4e0d\u8fc7\u5b83\u4e0d\u662f\u666e\u901a\u7684\u4e8c\u53c9\u6811\uff0c\u5b83\u662f\u4e00\u4e2a**\u4e8c\u53c9\u67e5\u627e\u6811**\u3002 \u4e8c\u53c9\u67e5\u627e\u6811\u7684\u7279\u70b9\u662f\u4e00\u4e2a\u8282\u70b9\u7684\u5de6\u5b50\u6811\u7684\u6240\u6709\u8282\u70b9\u90fd\u5c0f\u4e8e\u8fd9\u4e2a\u8282\u70b9\uff0c\u53f3\u5b50\u6811\u7684\u6240\u6709\u8282\u70b9\u90fd\u5927\u4e8e\u8fd9\u4e2a\u8282\u70b9 \uff0c\u8fd9\u6837\u6211\u4eec\u5728\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u4e0d\u9700\u8981\u8ba1\u7b97\u4e2d\u95f4\u8282\u70b9\u7684\u4f4d\u7f6e\u4e86\uff0c\u53ea\u9700\u5c06\u67e5\u627e\u7684\u6570\u636e\u4e0e\u8282\u70b9\u7684\u6570\u636e\u8fdb\u884c\u6bd4\u8f83\u3002 \u5047\u8bbe\uff0c\u6211\u4eec\u67e5\u627e\u7d22\u5f15\u503c\u4e3a key \u7684\u8282\u70b9\uff1a \u5982\u679c key \u5927\u4e8e\u6839\u8282\u70b9\uff0c\u5219\u5728\u53f3\u5b50\u6811\u4e2d\u8fdb\u884c\u67e5\u627e\uff1b \u5982\u679c key \u5c0f\u4e8e\u6839\u8282\u70b9\uff0c\u5219\u5728\u5de6\u5b50\u6811\u4e2d\u8fdb\u884c\u67e5\u627e\uff1b \u5982\u679c key \u7b49\u4e8e\u6839\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u627e\u5230\u4e86\u8fd9\u4e2a\u8282\u70b9\uff0c\u8fd4\u56de\u6839\u8282\u70b9\u5373\u53ef\u3002 \u4e8c\u53c9\u67e5\u627e\u6811\u67e5\u627e\u67d0\u4e2a\u8282\u70b9\u7684\u52a8\u56fe\u6f14\u793a\u5982\u4e0b\uff0c\u6bd4\u5982\u8981\u67e5\u627e\u8282\u70b9 3 \uff1a \u53e6\u5916\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u89e3\u51b3\u4e86\u63d2\u5165\u65b0\u8282\u70b9\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u4e8c\u53c9\u67e5\u627e\u6811\u662f\u4e00\u4e2a\u8df3\u8dc3\u7ed3\u6784\uff0c\u4e0d\u5fc5\u8fde\u7eed\u6392\u5217\u3002\u8fd9\u6837\u5728\u63d2\u5165\u7684\u65f6\u5019\uff0c\u65b0\u8282\u70b9\u53ef\u4ee5\u653e\u5728\u4efb\u4f55\u4f4d\u7f6e\uff0c\u4e0d\u4f1a\u50cf\u7ebf\u6027\u7ed3\u6784\u90a3\u6837\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u6240\u6709\u5143\u7d20\u90fd\u9700\u8981\u5411\u540e\u6392\u5217\u3002 \u4e0b\u9762\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u63d2\u5165\u67d0\u4e2a\u8282\u70b9\u7684\u52a8\u56fe\u6f14\u793a\uff1a \u56e0\u6b64\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u89e3\u51b3\u4e86\u8fde\u7eed\u7ed3\u6784\u63d2\u5165\u65b0\u5143\u7d20\u5f00\u9500\u5f88\u5927\u7684\u95ee\u9898\uff0c\u540c\u65f6\u53c8\u4fdd\u6301\u7740\u5929\u7136\u7684\u4e8c\u5206\u7ed3\u6784\u3002 \u90a3\u662f\u4e0d\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u5c31\u53ef\u4ee5\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u4e86\u5462\uff1f \u4e0d\u884c\u4e0d\u884c\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u5b58\u5728\u4e00\u4e2a\u6781\u7aef\u60c5\u51b5\uff0c\u4f1a\u5bfc\u81f4\u5b83\u53d8\u6210\u4e00\u4e2a\u7638\u5b50\uff01 \u5f53\u6bcf\u6b21\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u6700\u5927\u7684\u5143\u7d20\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u5c31\u4f1a\u9000\u5316\u6210\u4e86\u4e00\u6761\u94fe\u8868\uff0c\u67e5\u627e\u6570\u636e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u6210\u4e86 O(n) \uff0c\u5982\u4e0b\u52a8\u56fe\u6f14\u793a\uff1a \u7531\u4e8e\u6811\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u8bbf\u95ee\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u5bf9\u5e94\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\uff08 \u5047\u8bbe\u4e00\u4e2a\u8282\u70b9\u7684\u5927\u5c0f\u300c\u5c0f\u4e8e\u300d\u64cd\u4f5c\u7cfb\u7edf\u7684\u6700\u5c0f\u8bfb\u5199\u5355\u4f4d\u5757\u7684\u5927\u5c0f \uff09\uff0c\u4e5f\u5c31\u662f\u8bf4**\u6811\u7684\u9ad8\u5ea6\u5c31\u7b49\u4e8e\u6bcf\u6b21\u67e5\u8be2\u6570\u636e\u65f6\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570**\uff0c\u6240\u4ee5\u6811\u7684\u9ad8\u5ea6\u8d8a\u9ad8\uff0c\u5c31\u4f1a\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002 \u4e8c\u53c9\u67e5\u627e\u6811\u7531\u4e8e\u5b58\u5728\u9000\u5316\u6210\u94fe\u8868\u7684\u53ef\u80fd\u6027\uff0c\u4f1a\u4f7f\u5f97\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4ece O(logn) \u5347\u4e3a O(n)\u3002 \u800c\u4e14\u4f1a\u968f\u7740\u63d2\u5165\u7684\u5143\u7d20\u8d8a\u591a\uff0c\u6811\u7684\u9ad8\u5ea6\u4e5f\u53d8\u9ad8\uff0c\u610f\u5473\u7740\u9700\u8981\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570\u5c31\u8d8a\u591a\uff0c\u8fd9\u6837\u5bfc\u81f4\u67e5\u8be2\u6027\u80fd\u4e25\u91cd\u4e0b\u964d\uff0c\u518d\u52a0\u4e0a\u4e0d\u80fd\u8303\u56f4\u67e5\u8be2\uff0c\u6240\u4ee5\u4e0d\u9002\u5408\u4f5c\u4e3a\u6570\u636e\u5e93\u7684\u7d22\u5f15\u7ed3\u6784\u3002 \u4ec0\u4e48\u662f\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\uff1f \u00b6 \u4e3a\u4e86\u89e3\u51b3\u4e8c\u53c9\u67e5\u627e\u6811\u4f1a\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\u9000\u5316\u6210\u94fe\u8868\u7684\u95ee\u9898\uff0c\u540e\u9762\u5c31\u6709\u4eba\u63d0\u51fa**\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\uff08AVL \u6811\uff09**\u3002 \u4e3b\u8981\u662f\u5728\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u4e9b\u6761\u4ef6\u7ea6\u675f\uff1a \u6bcf\u4e2a\u8282\u70b9\u7684\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\u7684\u9ad8\u5ea6\u5dee\u4e0d\u80fd\u8d85\u8fc7 1 \u3002\u4e5f\u5c31\u662f\u8bf4\u8282\u70b9\u7684\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\u4ecd\u7136\u4e3a\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u8fd9\u6837\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u4e00\u76f4\u7ef4\u6301\u5728 O(logn) \u3002 \u4e0b\u56fe\u662f\u6bcf\u6b21\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u6700\u5927\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4f1a\u7ef4\u6301\u81ea\u5e73\u8861\uff1a \u9664\u4e86\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u8fd8\u6709\u5f88\u591a\u81ea\u5e73\u8861\u7684\u4e8c\u53c9\u6811\uff0c\u6bd4\u5982\u7ea2\u9ed1\u6811\uff0c\u5b83\u4e5f\u662f\u901a\u8fc7\u4e00\u4e9b\u7ea6\u675f\u6761\u4ef6\u6765\u8fbe\u5230\u81ea\u5e73\u8861\uff0c\u4e0d\u8fc7\u7ea2\u9ed1\u6811\u7684\u7ea6\u675f\u6761\u4ef6\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u662f\u672c\u7bc7\u7684\u91cd\u70b9\u91cd\u70b9\uff0c\u5927\u5bb6\u53ef\u4ee5\u770b\u300a\u6570\u636e\u7ed3\u6784\u300b\u76f8\u5173\u7684\u4e66\u7c4d\u6765\u4e86\u89e3\u7ea2\u9ed1\u6811\u7684\u7ea6\u675f\u6761\u4ef6\u3002 \u4e0b\u9762\u662f\u7ea2\u9ed1\u6811\u63d2\u5165\u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u8fd9\u5de6\u65cb\u53f3\u65cb\u7684\u64cd\u4f5c\uff0c\u5c31\u662f\u4e3a\u4e86\u81ea\u5e73\u8861\u3002 \u4e0d\u7ba1\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u8fd8\u662f\u7ea2\u9ed1\u6811\uff0c\u90fd\u4f1a\u968f\u7740\u63d2\u5165\u7684\u5143\u7d20\u589e\u591a\uff0c\u800c\u5bfc\u81f4\u6811\u7684\u9ad8\u5ea6\u53d8\u9ad8\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\u591a\uff0c\u4f1a\u5f71\u54cd\u6574\u4f53\u6570\u636e\u67e5\u8be2\u7684\u6548\u7387 \u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u9ad8\u5ea6\u4e3a 5\uff0c\u90a3\u4e48\u5728\u8bbf\u95ee\u6700\u5e95\u90e8\u7684\u8282\u70b9\u65f6\uff0c\u5c31\u9700\u8981\u78c1\u76d8 5 \u6b21 I/O \u64cd\u4f5c\u3002 \u6839\u672c\u539f\u56e0\u662f\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u4e8c\u53c9\u6811\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u4fdd\u5b58 2 \u4e2a\u5b50\u8282\u70b9 \uff0c\u5982\u679c\u6211\u4eec\u628a\u4e8c\u53c9\u6811\u6539\u6210 M \u53c9\u6811\uff08M>2\uff09\u5462\uff1f \u6bd4\u5982\uff0c\u5f53 M=3 \u65f6\uff0c\u5728\u540c\u6837\u7684\u8282\u70b9\u4e2a\u6570\u60c5\u51b5\u4e0b\uff0c\u4e09\u53c9\u6811\u6bd4\u4e8c\u53c9\u6811\u7684\u6811\u9ad8\u8981\u77ee\u3002 \u56e0\u6b64\uff0c \u5f53\u6811\u7684\u8282\u70b9\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u5e76\u4e14\u6811\u7684\u5206\u53c9\u6570 M \u8d8a\u5927\u7684\u65f6\u5019\uff0cM \u53c9\u6811\u7684\u9ad8\u5ea6\u4f1a\u8fdc\u5c0f\u4e8e\u4e8c\u53c9\u6811\u7684\u9ad8\u5ea6 \u3002 \u4ec0\u4e48\u662f B \u6811 \u00b6 \u81ea\u5e73\u8861\u4e8c\u53c9\u6811\u867d\u7136\u80fd\u4fdd\u6301\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5728O(logn)\uff0c\u4f46\u662f\u56e0\u4e3a\u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u5f53\u8282\u70b9\u4e2a\u6570\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u6811\u7684\u9ad8\u5ea6\u4e5f\u4f1a\u76f8\u5e94\u53d8\u9ad8\uff0c\u8fd9\u6837\u5c31\u4f1a\u589e\u52a0\u78c1\u76d8\u7684 I/O \u6b21\u6570\uff0c\u4ece\u800c\u5f71\u54cd\u6570\u636e\u67e5\u8be2\u7684\u6548\u7387\u3002 \u4e3a\u4e86\u89e3\u51b3\u964d\u4f4e\u6811\u7684\u9ad8\u5ea6\u7684\u95ee\u9898\uff0c\u540e\u9762\u5c31\u51fa\u6765\u4e86 B \u6811\uff0c\u5b83\u4e0d\u518d\u9650\u5236\u4e00\u4e2a\u8282\u70b9\u5c31\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u800c\u662f\u5141\u8bb8 M \u4e2a\u5b50\u8282\u70b9 (M>2)\uff0c\u4ece\u800c\u964d\u4f4e\u6811\u7684\u9ad8\u5ea6\u3002 B \u6811\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u6700\u591a\u53ef\u4ee5\u5305\u62ec M \u4e2a\u5b50\u8282\u70b9\uff0cM \u79f0\u4e3a B \u6811\u7684\u9636\uff0c\u6240\u4ee5 B \u6811\u5c31\u662f\u4e00\u4e2a\u591a\u53c9\u6811\u3002 \u5047\u8bbe M = 3\uff0c\u90a3\u4e48\u5c31\u662f\u4e00\u68f5 3 \u9636\u7684 B \u6811\uff0c\u7279\u70b9\u5c31\u662f\u6bcf\u4e2a\u8282\u70b9\u6700\u591a\u6709 2 \u4e2a\uff08M-1\u4e2a\uff09\u6570\u636e\u548c\u6700\u591a\u6709 3 \u4e2a\uff08M\u4e2a\uff09\u5b50\u8282\u70b9\uff0c\u8d85\u8fc7\u8fd9\u4e9b\u8981\u6c42\u7684\u8bdd\uff0c\u5c31\u4f1a\u5206\u88c2\u8282\u70b9\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u7684\u52a8\u56fe\uff1a \u6211\u4eec\u6765\u770b\u770b\u4e00\u68f5 3 \u9636\u7684 B \u6811\u7684\u67e5\u8be2\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f \u5047\u8bbe\u6211\u4eec\u5728\u4e0a\u56fe\u4e00\u68f5 3 \u9636\u7684 B \u6811\u4e2d\u8981\u67e5\u627e\u7684\u7d22\u5f15\u503c\u662f 9 \u7684\u8bb0\u5f55\u90a3\u4e48\u6b65\u9aa4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u6b65\uff1a \u4e0e\u6839\u8282\u70b9\u7684\u7d22\u5f15(4\uff0c8\uff09\u8fdb\u884c\u6bd4\u8f83\uff0c9 \u5927\u4e8e 8\uff0c\u90a3\u4e48\u5f80\u53f3\u8fb9\u7684\u5b50\u8282\u70b9\u8d70\uff1b \u7136\u540e\u8be5\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u4e3a\uff0810\uff0c12\uff09\uff0c\u56e0\u4e3a 9 \u5c0f\u4e8e 10\uff0c\u6240\u4ee5\u4f1a\u5f80\u8be5\u8282\u70b9\u7684\u5de6\u8fb9\u5b50\u8282\u70b9\u8d70\uff1b \u8d70\u5230\u7d22\u5f15\u4e3a9\u7684\u8282\u70b9\uff0c\u7136\u540e\u6211\u4eec\u627e\u5230\u4e86\u7d22\u5f15\u503c 9 \u7684\u8282\u70b9\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u68f5 3 \u9636\u7684 B \u6811\u5728\u67e5\u8be2\u53f6\u5b50\u8282\u70b9\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u7531\u4e8e\u6811\u7684\u9ad8\u5ea6\u662f 3 \uff0c\u6240\u4ee5\u5728\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u53d1\u751f 3 \u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u3002 \u800c\u5982\u679c\u540c\u6837\u7684\u8282\u70b9\u6570\u91cf\u5728\u5e73\u8861\u4e8c\u53c9\u6811\u7684\u573a\u666f\u4e0b\uff0c\u6811\u7684\u9ad8\u5ea6\u5c31\u4f1a\u5f88\u9ad8\uff0c\u610f\u5473\u7740\u78c1\u76d8 I/O \u64cd\u4f5c\u4f1a\u66f4\u591a\u3002\u6240\u4ee5\uff0cB \u6811\u5728\u6570\u636e\u67e5\u8be2\u4e2d\u6bd4\u5e73\u8861\u4e8c\u53c9\u6811\u6548\u7387\u8981\u9ad8\u3002 \u4f46\u662f B \u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u5305\u542b\u6570\u636e\uff08\u7d22\u5f15+\u8bb0\u5f55\uff09\uff0c\u800c\u7528\u6237\u7684\u8bb0\u5f55\u6570\u636e\u7684\u5927\u5c0f\u5f88\u6709\u53ef\u80fd\u8fdc\u8fdc\u8d85\u8fc7\u4e86\u7d22\u5f15\u6570\u636e\uff0c\u8fd9\u5c31\u9700\u8981\u82b1\u8d39\u66f4\u591a\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\u6765\u8bfb\u5230\u300c\u6709\u7528\u7684\u7d22\u5f15\u6570\u636e\u300d\u3002 \u800c\u4e14\uff0c\u5728\u6211\u4eec\u67e5\u8be2\u4f4d\u4e8e\u5e95\u5c42\u7684\u67d0\u4e2a\u8282\u70b9\uff08\u6bd4\u5982 A \u8bb0\u5f55\uff09\u8fc7\u7a0b\u4e2d\uff0c\u300c\u975e A \u8bb0\u5f55\u8282\u70b9\u300d\u91cc\u7684\u8bb0\u5f55\u6570\u636e\u4f1a\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4f46\u662f\u8fd9\u4e9b\u8bb0\u5f55\u6570\u636e\u662f\u6ca1\u7528\u7684\uff0c\u6211\u4eec\u53ea\u662f\u60f3\u8bfb\u53d6\u8fd9\u4e9b\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e\u6765\u505a\u6bd4\u8f83\u67e5\u8be2\uff0c\u800c\u300c\u975e A \u8bb0\u5f55\u8282\u70b9\u300d\u91cc\u7684\u8bb0\u5f55\u6570\u636e\u5bf9\u6211\u4eec\u662f\u6ca1\u7528\u7684\uff0c\u8fd9\u6837\u4e0d\u4ec5\u589e\u591a\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\uff0c\u4e5f\u5360\u7528\u5185\u5b58\u8d44\u6e90\u3002 \u53e6\u5916\uff0c\u5982\u679c\u4f7f\u7528 B \u6811\u6765\u505a\u8303\u56f4\u67e5\u8be2\u7684\u8bdd\uff0c\u9700\u8981\u4f7f\u7528\u4e2d\u5e8f\u904d\u5386\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u95ee\u9898\uff0c\u4ece\u800c\u5bfc\u81f4\u6574\u4f53\u901f\u5ea6\u4e0b\u964d\u3002 \u4ec0\u4e48\u662f B+ \u6811\uff1f \u00b6 B+ \u6811\u5c31\u662f\u5bf9 B \u6811\u505a\u4e86\u4e00\u4e2a\u5347\u7ea7\uff0cMySQL \u4e2d\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\uff0cB+ \u6811\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a B+ \u6811\u4e0e B \u6811\u5dee\u5f02\u7684\u70b9\uff0c\u4e3b\u8981\u662f\u4ee5\u4e0b\u8fd9\u51e0\u70b9\uff1a \u53f6\u5b50\u8282\u70b9\uff08\u6700\u5e95\u90e8\u7684\u8282\u70b9\uff09\u624d\u4f1a\u5b58\u653e\u5b9e\u9645\u6570\u636e\uff08\u7d22\u5f15+\u8bb0\u5f55\uff09\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u4f1a\u5b58\u653e\u7d22\u5f15\uff1b \u6240\u6709\u7d22\u5f15\u90fd\u4f1a\u5728\u53f6\u5b50\u8282\u70b9\u51fa\u73b0\uff0c\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u6784\u6210\u4e00\u4e2a\u6709\u5e8f\u94fe\u8868\uff1b \u975e\u53f6\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u4e5f\u4f1a\u540c\u65f6\u5b58\u5728\u5728\u5b50\u8282\u70b9\u4e2d\uff0c\u5e76\u4e14\u662f\u5728\u5b50\u8282\u70b9\u4e2d\u6240\u6709\u7d22\u5f15\u7684\u6700\u5927\uff08\u6216\u6700\u5c0f\uff09\u3002 \u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u5b50\u8282\u70b9\uff0c\u5c31\u6709\u591a\u5c11\u4e2a\u7d22\u5f15\uff1b \u4e0b\u9762\u901a\u8fc7\u4e09\u4e2a\u65b9\u9762\uff0c\u6bd4\u8f83\u4e0b B+ \u548c B \u6811\u7684\u6027\u80fd\u533a\u522b\u3002 1\u3001\u5355\u70b9\u67e5\u8be2 \u00b6 B \u6811\u8fdb\u884c\u5355\u4e2a\u7d22\u5f15\u67e5\u8be2\u65f6\uff0c\u6700\u5feb\u53ef\u4ee5\u5728 O(1) \u7684\u65f6\u95f4\u4ee3\u4ef7\u5185\u5c31\u67e5\u5230\uff0c\u800c\u4ece\u5e73\u5747\u65f6\u95f4\u4ee3\u4ef7\u6765\u770b\uff0c\u4f1a\u6bd4 B+ \u6811\u7a0d\u5feb\u4e00\u4e9b\u3002 \u4f46\u662f B \u6811\u7684\u67e5\u8be2\u6ce2\u52a8\u4f1a\u6bd4\u8f83\u5927\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8282\u70b9\u5373\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\uff0c\u6240\u4ee5\u6709\u65f6\u5019\u8bbf\u95ee\u5230\u4e86\u975e\u53f6\u5b50\u8282\u70b9\u5c31\u53ef\u4ee5\u627e\u5230\u7d22\u5f15\uff0c\u800c\u6709\u65f6\u9700\u8981\u8bbf\u95ee\u5230\u53f6\u5b50\u8282\u70b9\u624d\u80fd\u627e\u5230\u7d22\u5f15\u3002 B+ \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u653e\u5b9e\u9645\u7684\u8bb0\u5f55\u6570\u636e\uff0c\u4ec5\u5b58\u653e\u7d22\u5f15\uff0c\u56e0\u6b64\u6570\u636e\u91cf\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u76f8\u6bd4\u5b58\u50a8\u5373\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\u7684 B \u6811\uff0cB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u7d22\u5f15\uff0c\u56e0\u6b64 B+ \u6811\u53ef\u4ee5\u6bd4 B \u6811\u66f4\u300c\u77ee\u80d6\u300d\uff0c\u67e5\u8be2\u5e95\u5c42\u8282\u70b9\u7684\u78c1\u76d8 I/O\u6b21\u6570\u4f1a\u66f4\u5c11 \u3002 2\u3001\u63d2\u5165\u548c\u5220\u9664\u6548\u7387 \u00b6 B+ \u6811\u6709\u5927\u91cf\u7684\u5197\u4f59\u8282\u70b9\uff0c\u8fd9\u6837\u4f7f\u5f97\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u53f6\u5b50\u8282\u70b9\u4e2d\u5220\u9664\uff0c\u751a\u81f3\u53ef\u4ee5\u4e0d\u52a8\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u8fd9\u6837\u5220\u9664\u975e\u5e38\u5feb\uff0c \u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B+ \u6811 0004 \u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u975e\u53f6\u5b50\u8282\u70b9\u6709 0004 \u7684\u5197\u4f59\u8282\u70b9\uff0c\u6240\u4ee5\u5728\u5220\u9664\u7684\u65f6\u5019\uff0c\u6811\u5f62\u7ed3\u6784\u53d8\u5316\u5f88\u5c0f\uff1a \u6ce8\u610f\uff0c\uff1aB+ \u6811\u5bf9\u4e8e\u975e\u53f6\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\u548c\u7d22\u5f15\u7684\u4e2a\u6570\uff0c\u5b9a\u4e49\u65b9\u5f0f\u53ef\u80fd\u4f1a\u6709\u4e0d\u540c\uff0c\u6709\u7684\u662f\u8bf4\u975e\u53f6\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\u7684\u4e2a\u6570\u4e3a M \u9636\uff0c\u800c\u7d22\u5f15\u7684\u4e2a\u6570\u4e3a M-1\uff08\u8fd9\u4e2a\u662f\u7ef4\u57fa\u767e\u79d1\u91cc\u7684\u5b9a\u4e49\uff09\uff0c\u56e0\u6b64\u6211\u672c\u6587\u5173\u4e8e B+ \u6811\u7684\u52a8\u56fe\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e2a\u3002\u4f46\u662f\u6211\u5728\u524d\u9762\u4ecb\u7ecd B+ \u6811\u4e0e B+ \u6811\u7684\u5dee\u5f02\u65f6\uff0c\u8bf4\u7684\u662f\u300c\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u5b50\u8282\u70b9\uff0c\u5c31\u6709\u591a\u5c11\u4e2a\u7d22\u5f15\u300d\uff0c\u4e3b\u8981\u662f MySQL \u7528\u5230\u7684 B+ \u6811\u5c31\u662f\u8fd9\u4e2a\u7279\u6027\u3002 \u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B \u6811 0008 \u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6811\u7684\u590d\u6742\u53d8\u5316\uff1a \u751a\u81f3\uff0cB+ \u6811\u5728\u5220\u9664\u6839\u8282\u70b9\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u5b58\u5728\u5197\u4f59\u7684\u8282\u70b9\uff0c\u6240\u4ee5\u4e0d\u4f1a\u53d1\u751f\u590d\u6742\u7684\u6811\u7684\u53d8\u5f62\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B+ \u6811\u6839\u8282\u70b9\u7684\u8fc7\u7a0b\uff1a B \u6811\u5219\u4e0d\u540c\uff0cB \u6811\u6ca1\u6709\u5197\u4f59\u8282\u70b9\uff0c\u5220\u9664\u8282\u70b9\u7684\u65f6\u5019\u975e\u5e38\u590d\u6742\uff0c\u6bd4\u5982\u5220\u9664\u6839\u8282\u70b9\u4e2d\u7684\u6570\u636e\uff0c\u53ef\u80fd\u6d89\u53ca\u590d\u6742\u7684\u6811\u7684\u53d8\u5f62\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B \u6811\u6839\u8282\u70b9\u7684\u8fc7\u7a0b\uff1a B+ \u6811\u7684\u63d2\u5165\u4e5f\u662f\u4e00\u6837\uff0c\u6709\u5197\u4f59\u8282\u70b9\uff0c\u63d2\u5165\u53ef\u80fd\u5b58\u5728\u8282\u70b9\u7684\u5206\u88c2\uff08\u5982\u679c\u8282\u70b9\u9971\u548c\uff09\uff0c\u4f46\u662f\u6700\u591a\u53ea\u6d89\u53ca\u6811\u7684\u4e00\u6761\u8def\u5f84\u3002\u800c\u4e14 B+ \u6811\u4f1a\u81ea\u52a8\u5e73\u8861\uff0c\u4e0d\u9700\u8981\u50cf\u66f4\u591a\u590d\u6742\u7684\u7b97\u6cd5\uff0c\u7c7b\u4f3c\u7ea2\u9ed1\u6811\u7684\u65cb\u8f6c\u64cd\u4f5c\u7b49\u3002 \u56e0\u6b64\uff0c B+ \u6811\u7684\u63d2\u5165\u548c\u5220\u9664\u6548\u7387\u66f4\u9ad8 \u3002 3\u3001\u8303\u56f4\u67e5\u8be2 \u00b6 B \u6811\u548c B+ \u6811\u7b49\u503c\u67e5\u8be2\u539f\u7406\u57fa\u672c\u4e00\u81f4\uff0c\u5148\u4ece\u6839\u8282\u70b9\u67e5\u627e\uff0c\u7136\u540e\u5bf9\u6bd4\u76ee\u6807\u6570\u636e\u7684\u8303\u56f4\uff0c\u6700\u540e\u9012\u5f52\u7684\u8fdb\u5165\u5b50\u8282\u70b9\u67e5\u627e\u3002 \u56e0\u4e3a B+ \u6811\u6240\u6709\u53f6\u5b50\u8282\u70b9\u95f4\u8fd8\u6709\u4e00\u4e2a\u94fe\u8868\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5bf9\u8303\u56f4\u67e5\u627e\u975e\u5e38\u6709\u5e2e\u52a9 \uff0c\u6bd4\u5982\u8bf4\u6211\u4eec\u60f3\u77e5\u9053 12 \u6708 1 \u65e5\u548c 12 \u6708 12 \u65e5\u4e4b\u95f4\u7684\u8ba2\u5355\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u5148\u67e5\u627e\u5230 12 \u6708 1 \u65e5\u6240\u5728\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u5229\u7528\u94fe\u8868\u5411\u53f3\u904d\u5386\uff0c\u76f4\u5230\u627e\u5230 12 \u670812 \u65e5\u7684\u8282\u70b9\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u4ece\u6839\u8282\u70b9\u67e5\u8be2\u4e86\uff0c\u8fdb\u4e00\u6b65\u8282\u7701\u67e5\u8be2\u9700\u8981\u7684\u65f6\u95f4\u3002 \u800c B \u6811\u6ca1\u6709\u5c06\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7528\u94fe\u8868\u4e32\u8054\u8d77\u6765\u7684\u7ed3\u6784\uff0c\u56e0\u6b64\u53ea\u80fd\u901a\u8fc7\u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u8303\u56f4\u67e5\u8be2\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u8303\u56f4\u67e5\u8be2\u6548\u7387\u4e0d\u5982 B+ \u6811\u3002 \u56e0\u6b64\uff0c\u5b58\u5728\u5927\u91cf\u8303\u56f4\u68c0\u7d22\u7684\u573a\u666f\uff0c\u9002\u5408\u4f7f\u7528 B+\u6811\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u3002\u800c\u5bf9\u4e8e\u5927\u91cf\u7684\u5355\u4e2a\u7d22\u5f15\u67e5\u8be2\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u8003\u8651 B \u6811\uff0c\u6bd4\u5982 nosql \u7684MongoDB\u3002 MySQL \u4e2d\u7684 B+ \u6811 \u00b6 MySQL \u7684\u5b58\u50a8\u65b9\u5f0f\u6839\u636e\u5b58\u50a8\u5f15\u64ce\u7684\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u6211\u4eec\u6700\u5e38\u7528\u7684\u5c31\u662f Innodb \u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u4e86\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u3002 \u4e0b\u56fe\u5c31\u662f Innodb \u91cc\u7684 B+ \u6811\uff1a \u4f46\u662f Innodb \u4f7f\u7528\u7684 B+ \u6811\u6709\u4e00\u4e9b\u7279\u522b\u7684\u70b9\uff0c\u6bd4\u5982\uff1a B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u662f\u7528\u300c\u53cc\u5411\u94fe\u8868\u300d\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u65e2\u80fd\u5411\u53f3\u904d\u5386\uff0c\u4e5f\u80fd\u5411\u5de6\u904d\u5386\u3002 B+ \u6811\u70b9\u8282\u70b9\u5185\u5bb9\u662f\u6570\u636e\u9875\uff0c\u6570\u636e\u9875\u91cc\u5b58\u653e\u4e86\u7528\u6237\u7684\u8bb0\u5f55\u4ee5\u53ca\u5404\u79cd\u4fe1\u606f\uff0c\u6bcf\u4e2a\u6570\u636e\u9875\u9ed8\u8ba4\u5927\u5c0f\u662f 16 KB\u3002 Innodb \u6839\u636e\u7d22\u5f15\u7c7b\u578b\u4e0d\u540c\uff0c\u5206\u4e3a\u805a\u96c6\u548c\u4e8c\u7ea7\u7d22\u5f15\u3002\u4ed6\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u96c6\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u805a\u96c6\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u56e0\u4e3a\u8868\u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728\u805a\u96c6\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e00\u5b9a\u4f1a\u4e3a\u8868\u521b\u5efa\u4e00\u4e2a\u805a\u96c6\u7d22\u5f15\uff0c\u4e14\u7531\u4e8e\u6570\u636e\u5728\u7269\u7406\u4e0a\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\uff0c\u6240\u4ee5\u805a\u7c07\u7d22\u5f15\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u3002 \u66f4\u591a\u5173\u4e8e Innodb \u7684 B+ \u6811\uff0c\u53ef\u4ee5\u770b\u6211\u4e4b\u524d\u5199\u7684\u8fd9\u7bc7\uff1a \u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811 \u3002 \u603b\u7ed3 \u00b6 MySQL \u662f\u4f1a\u5c06\u6570\u636e\u6301\u4e45\u5316\u5728\u786c\u76d8\uff0c\u800c\u5b58\u50a8\u529f\u80fd\u662f\u7531 MySQL \u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u8ba8\u8bba MySQL \u4f7f\u7528\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u7d22\u5f15\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u8ba8\u8bba\u5b58\u50a8\u5f15\u4f7f\u7528\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u7d22\u5f15\uff0cInnoDB \u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u3002 \u8981\u8bbe\u8ba1\u4e00\u4e2a MySQL \u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u4e0d\u4ec5\u4ec5\u8003\u8651\u6570\u636e\u7ed3\u6784\u589e\u5220\u6539\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u66f4\u91cd\u8981\u7684\u662f\u8981\u8003\u8651\u78c1\u76d8 I/0 \u7684\u64cd\u4f5c\u6b21\u6570\u3002\u56e0\u4e3a\u7d22\u5f15\u548c\u8bb0\u5f55\u90fd\u662f\u5b58\u653e\u5728\u786c\u76d8\uff0c\u786c\u76d8\u662f\u4e00\u4e2a\u975e\u5e38\u6162\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6211\u4eec\u5728\u67e5\u8be2\u6570\u636e\u7684\u65f6\u5019\uff0c\u6700\u597d\u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8 I/0 \u7684\u64cd\u4f5c\u6b21\u6570\u5185\u5b8c\u6210\u3002 \u4e8c\u5206\u67e5\u627e\u6811\u867d\u7136\u662f\u4e00\u4e2a\u5929\u7136\u7684\u4e8c\u5206\u7ed3\u6784\uff0c\u80fd\u5f88\u597d\u7684\u5229\u7528\u4e8c\u5206\u67e5\u627e\u5feb\u901f\u5b9a\u4f4d\u6570\u636e\uff0c\u4f46\u662f\u5b83\u5b58\u5728\u4e00\u79cd\u6781\u7aef\u7684\u60c5\u51b5\uff0c\u6bcf\u5f53\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u6811\u5185\u6700\u5927\u7684\u5143\u7d20\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e8c\u5206\u67e5\u627e\u6811\u9000\u5316\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u6b64\u65f6\u67e5\u8be2\u590d\u6742\u5ea6\u5c31\u4f1a\u4ece O(logn)\u964d\u4f4e\u4e3a O(n)\u3002 \u4e3a\u4e86\u89e3\u51b3\u4e8c\u5206\u67e5\u627e\u6811\u9000\u5316\u6210\u94fe\u8868\u7684\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u4fdd\u8bc1\u4e86\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u4e00\u76f4\u7ef4\u6301\u5728 O(logn) \u3002\u4f46\u662f\u5b83\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u968f\u7740\u5143\u7d20\u7684\u589e\u591a\uff0c\u6811\u7684\u9ad8\u5ea6\u4f1a\u8d8a\u6765\u8d8a\u9ad8\u3002 \u800c\u6811\u7684\u9ad8\u5ea6\u51b3\u5b9a\u4e8e\u78c1\u76d8 I/O \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u56e0\u4e3a\u6811\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u8bbf\u95ee\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u5bf9\u5e94\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4\u6811\u7684\u9ad8\u5ea6\u5c31\u7b49\u4e8e\u6bcf\u6b21\u67e5\u8be2\u6570\u636e\u65f6\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u6240\u4ee5\u6811\u7684\u9ad8\u5ea6\u8d8a\u9ad8\uff0c\u5c31\u4f1a\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002 B \u6811\u548c B+ \u90fd\u662f\u901a\u8fc7\u591a\u53c9\u6811\u7684\u65b9\u5f0f\uff0c\u4f1a\u5c06\u6811\u7684\u9ad8\u5ea6\u53d8\u77ee\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u6570\u636e\u7ed3\u6784\u975e\u5e38\u9002\u5408\u68c0\u7d22\u5b58\u4e8e\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u3002 \u4f46\u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce InnoDB \u91c7\u7528\u7684\u662f B+ \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u539f\u56e0\u6709\uff1a B+ \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u653e\u5b9e\u9645\u7684\u8bb0\u5f55\u6570\u636e\uff0c\u4ec5\u5b58\u653e\u7d22\u5f15\uff0c\u56e0\u6b64\u6570\u636e\u91cf\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u76f8\u6bd4\u5b58\u50a8\u5373\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\u7684 B \u6811\uff0cB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u7d22\u5f15\uff0c\u56e0\u6b64 B+ \u6811\u53ef\u4ee5\u6bd4 B \u6811\u66f4\u300c\u77ee\u80d6\u300d\uff0c\u67e5\u8be2\u5e95\u5c42\u8282\u70b9\u7684\u78c1\u76d8 I/O\u6b21\u6570\u4f1a\u66f4\u5c11\u3002 B+ \u6811\u6709\u5927\u91cf\u7684\u5197\u4f59\u8282\u70b9\uff08\u6240\u6709\u975e\u53f6\u5b50\u8282\u70b9\u90fd\u662f\u5197\u4f59\u7d22\u5f15\uff09\uff0c\u8fd9\u4e9b\u5197\u4f59\u7d22\u5f15\u8ba9 B+ \u6811\u5728\u63d2\u5165\u3001\u5220\u9664\u7684\u6548\u7387\u90fd\u66f4\u9ad8\uff0c\u6bd4\u5982\u5220\u9664\u6839\u8282\u70b9\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u50cf B \u6811\u90a3\u6837\u4f1a\u53d1\u751f\u590d\u6742\u7684\u6811\u7684\u53d8\u5316\uff1b B+ \u6811\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u7528\u94fe\u8868\u8fde\u63a5\u4e86\u8d77\u6765\uff0c\u6709\u5229\u4e8e\u8303\u56f4\u67e5\u8be2\uff0c\u800c B \u6811\u8981\u5b9e\u73b0\u8303\u56f4\u67e5\u8be2\uff0c\u56e0\u6b64\u53ea\u80fd\u901a\u8fc7\u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u8303\u56f4\u67e5\u8be2\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u8303\u56f4\u67e5\u8be2\u6548\u7387\u4e0d\u5982 B+ \u6811\u3002 \u5b8c\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f"},{"location":"mysql/index/why_index_chose_bpuls_tree/#mysql-b","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u300c\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f\u300d\u8fd9\u53e5\u8bdd\uff0c\u662f\u4e0d\u662f\u5728\u9762\u8bd5\u65f6\u7ecf\u5e38\u51fa\u73b0\u3002 \u8981\u89e3\u91ca\u8fd9\u4e2a\u95ee\u9898\uff0c\u5176\u5b9e\u4e0d\u5355\u5355\u8981\u4ece\u6570\u636e\u7ed3\u6784\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u8fd8\u8981\u8003\u8651\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\uff0c\u56e0\u4e3a MySQL \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\u561b\u3002 \u8fd9\u6b21\uff0c\u5c31\u8ddf\u5927\u5bb6\u4e00\u5c42\u4e00\u5c42\u7684\u5206\u6790\u8fd9\u4e2a\u95ee\u9898\uff0c\u56fe\u4e2d\u5305\u542b\u5927\u91cf\u7684\u52a8\u56fe\u6765\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\uff0c\u76f8\u4fe1\u770b\u5b8c\u4f60\u5c31\u62ff\u634f\u8fd9\u9053\u9898\u76ee\u4e86\uff01","title":"\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_1","text":"MySQL \u7684\u6570\u636e\u662f\u6301\u4e45\u5316\u7684\uff0c\u610f\u5473\u7740\u6570\u636e\uff08\u7d22\u5f15+\u8bb0\u5f55\uff09\u662f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u5373\u4f7f\u8bbe\u5907\u65ad\u7535\u4e86\uff0c\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002 \u78c1\u76d8\u662f\u4e00\u4e2a\u6162\u7684\u79bb\u8c31\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6709\u591a\u79bb\u8c31\u5462\uff1f \u4eba\u5bb6\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u662f\u7eb3\u79d2\u7ea7\u522b\u7684\uff0c\u800c\u78c1\u76d8\u8bbf\u95ee\u7684\u901f\u5ea6\u662f\u6beb\u79d2\u7ea7\u522b\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bfb\u53d6\u540c\u6837\u5927\u5c0f\u7684\u6570\u636e\uff0c\u78c1\u76d8\u4e2d\u8bfb\u53d6\u7684\u901f\u5ea6\u6bd4\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u7684\u901f\u5ea6\u8981\u6162\u4e0a\u4e07\u500d\uff0c\u751a\u81f3\u51e0\u5341\u4e07\u500d\u3002 \u78c1\u76d8\u8bfb\u5199\u7684\u6700\u5c0f\u5355\u4f4d\u662f**\u6247\u533a**\uff0c\u6247\u533a\u7684\u5927\u5c0f\u53ea\u6709 512B \u5927\u5c0f\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e00\u6b21\u4f1a\u8bfb\u5199\u591a\u4e2a\u6247\u533a\uff0c\u6240\u4ee5**\u64cd\u4f5c\u7cfb\u7edf\u7684\u6700\u5c0f\u8bfb\u5199\u5355\u4f4d\u662f\u5757\uff08Block\uff09\u3002Linux \u4e2d\u7684\u5757\u5927\u5c0f\u4e3a 4KB **\uff0c\u4e5f\u5c31\u662f\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u4f1a\u76f4\u63a5\u8bfb\u5199 8 \u4e2a\u6247\u533a\u3002 \u7531\u4e8e\u6570\u636e\u5e93\u7684\u7d22\u5f15\u662f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\uff0c\u56e0\u6b64\u5f53\u6211\u4eec\u901a\u8fc7\u7d22\u5f15\u67e5\u627e\u67d0\u884c\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5148\u4ece\u78c1\u76d8\u8bfb\u53d6\u7d22\u5f15\u5230\u5185\u5b58\uff0c\u518d\u901a\u8fc7\u7d22\u5f15\u4ece\u78c1\u76d8\u4e2d\u627e\u5230\u67d0\u884c\u6570\u636e\uff0c\u7136\u540e\u8bfb\u5165\u5230\u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u8bf4\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u53d1\u751f\u591a\u6b21\u78c1\u76d8 I/O\uff0c\u800c\u78c1\u76d8 I/O \u6b21\u6570\u8d8a\u591a\uff0c\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4e5f\u5c31\u8d8a\u5927\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5e0c\u671b\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u4e2d\u5b8c\u6210\u67e5\u8be2\u5de5\u4f5c\uff0c\u56e0\u4e3a\u78c1\u76d8 I/O \u64cd\u4f5c\u8d8a\u5c11\uff0c\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4e5f\u5c31\u8d8a\u5c0f\u3002 \u53e6\u5916\uff0cMySQL \u662f\u652f\u6301\u8303\u56f4\u67e5\u627e\u7684\uff0c\u6240\u4ee5\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u4e0d\u4ec5\u8981\u80fd\u9ad8\u6548\u5730\u67e5\u8be2\u67d0\u4e00\u4e2a\u8bb0\u5f55\uff0c\u800c\u4e14\u4e5f\u8981\u80fd\u9ad8\u6548\u5730\u6267\u884c\u8303\u56f4\u67e5\u627e\u3002 \u6240\u4ee5\uff0c\u8981\u8bbe\u8ba1\u4e00\u4e2a\u9002\u5408 MySQL \u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u81f3\u5c11\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a \u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u4e2d\u5b8c\u6210\u67e5\u8be2\u5de5\u4f5c\uff1b \u8981\u80fd\u9ad8\u6548\u5730\u67e5\u8be2\u67d0\u4e00\u4e2a\u8bb0\u5f55\uff0c\u4e5f\u8981\u80fd\u9ad8\u6548\u5730\u6267\u884c\u8303\u56f4\u67e5\u627e\uff1b \u5206\u6790\u5b8c\u8981\u6c42\u540e\uff0c\u6211\u4eec\u9488\u5bf9\u6bcf\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u5206\u6790\u4e00\u4e0b\u3002","title":"\u600e\u6837\u7684\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u662f\u597d\u7684\uff1f"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_2","text":"\u7d22\u5f15\u6570\u636e\u6700\u597d\u80fd\u6309\u987a\u5e8f\u6392\u5217\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u7528\u300c\u4e8c\u5206\u67e5\u627e\u6cd5\u300d\u9ad8\u6548\u5b9a\u4f4d\u6570\u636e\u3002 \u5047\u8bbe\u6211\u4eec\u73b0\u5728\u7528\u6570\u7ec4\u6765\u5b58\u50a8\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0b\u9762\u6709\u4e00\u4e2a\u6392\u5e8f\u7684\u6570\u7ec4\uff0c\u5982\u679c\u8981\u4ece\u4e2d\u627e\u51fa\u6570\u5b57 3\uff0c\u6700\u7b80\u5355\u529e\u6cd5\u5c31\u662f\u4ece\u5934\u4f9d\u6b21\u904d\u5386\u67e5\u8be2\uff0c\u8fd9\u79cd\u65b9\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\uff0c\u67e5\u8be2\u6548\u7387\u5e76\u4e0d\u9ad8\u3002\u56e0\u4e3a\u8be5\u6570\u7ec4\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4e8c\u5206\u67e5\u627e\u6cd5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u5f20\u91c7\u7528\u4e8c\u5206\u6cd5\u7684\u67e5\u8be2\u8fc7\u7a0b\u56fe\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e8c\u5206\u67e5\u627e\u6cd5\u6bcf\u6b21\u90fd\u628a\u67e5\u8be2\u7684\u8303\u56f4\u51cf\u534a\uff0c\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u964d\u5230\u4e86 O(logn)\uff0c\u4f46\u662f\u6bcf\u6b21\u67e5\u627e\u90fd\u9700\u8981\u4e0d\u65ad\u8ba1\u7b97\u4e2d\u95f4\u4f4d\u7f6e\u3002","title":"\u4ec0\u4e48\u662f\u4e8c\u5206\u67e5\u627e\uff1f"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_3","text":"\u7528\u6570\u7ec4\u6765\u5b9e\u73b0\u7ebf\u6027\u6392\u5e8f\u7684\u6570\u636e\u867d\u7136\u7b80\u5355\u597d\u7528\uff0c\u4f46\u662f\u63d2\u5165\u65b0\u5143\u7d20\u7684\u65f6\u5019\u6027\u80fd\u592a\u4f4e\u3002 \u56e0\u4e3a\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u9700\u8981\u5c06\u8fd9\u4e2a\u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709\u5143\u7d20\u540e\u79fb\u4e00\u4f4d\uff0c\u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u53d1\u751f\u5728\u78c1\u76d8\u4e2d\u5462\uff1f\u8fd9\u5fc5\u7136\u662f\u707e\u96be\u6027\u7684\u3002\u56e0\u4e3a\u78c1\u76d8\u7684\u901f\u5ea6\u6bd4\u5185\u5b58\u6162\u51e0\u5341\u4e07\u500d\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u7528\u4e00\u79cd\u7ebf\u6027\u7ed3\u6784\u5c06\u78c1\u76d8\u6392\u5e8f\u3002 \u5176\u6b21\uff0c\u6709\u5e8f\u7684\u6570\u7ec4\u5728\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u67e5\u627e\u90fd\u8981\u4e0d\u65ad\u8ba1\u7b97\u4e2d\u95f4\u7684\u4f4d\u7f6e\u3002 \u90a3\u6211\u4eec\u80fd\u4e0d\u80fd\u8bbe\u8ba1\u4e00\u4e2a\u975e\u7ebf\u5f62\u4e14\u5929\u7136\u9002\u5408\u4e8c\u5206\u67e5\u627e\u7684\u6570\u636e\u7ed3\u6784\u5462\uff1f \u6709\u7684\uff0c\u8bf7\u770b\u4e0b\u56fe\u8fd9\u4e2a\u795e\u5947\u7684\u64cd\u4f5c\uff0c\u627e\u5230\u6240\u6709\u4e8c\u5206\u67e5\u627e\u4e2d\u7528\u5230\u7684\u6240\u6709\u4e2d\u95f4\u8282\u70b9\uff0c\u628a\u4ed6\u4eec\u7528\u6307\u9488\u8fde\u8d77\u6765\uff0c\u5e76\u5c06\u6700\u4e2d\u95f4\u7684\u8282\u70b9\u4f5c\u4e3a\u6839\u8282\u70b9\u3002 \u600e\u4e48\u6837\uff1f\u662f\u4e0d\u662f\u53d8\u6210\u4e86\u4e8c\u53c9\u6811\uff0c\u4e0d\u8fc7\u5b83\u4e0d\u662f\u666e\u901a\u7684\u4e8c\u53c9\u6811\uff0c\u5b83\u662f\u4e00\u4e2a**\u4e8c\u53c9\u67e5\u627e\u6811**\u3002 \u4e8c\u53c9\u67e5\u627e\u6811\u7684\u7279\u70b9\u662f\u4e00\u4e2a\u8282\u70b9\u7684\u5de6\u5b50\u6811\u7684\u6240\u6709\u8282\u70b9\u90fd\u5c0f\u4e8e\u8fd9\u4e2a\u8282\u70b9\uff0c\u53f3\u5b50\u6811\u7684\u6240\u6709\u8282\u70b9\u90fd\u5927\u4e8e\u8fd9\u4e2a\u8282\u70b9 \uff0c\u8fd9\u6837\u6211\u4eec\u5728\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u4e0d\u9700\u8981\u8ba1\u7b97\u4e2d\u95f4\u8282\u70b9\u7684\u4f4d\u7f6e\u4e86\uff0c\u53ea\u9700\u5c06\u67e5\u627e\u7684\u6570\u636e\u4e0e\u8282\u70b9\u7684\u6570\u636e\u8fdb\u884c\u6bd4\u8f83\u3002 \u5047\u8bbe\uff0c\u6211\u4eec\u67e5\u627e\u7d22\u5f15\u503c\u4e3a key \u7684\u8282\u70b9\uff1a \u5982\u679c key \u5927\u4e8e\u6839\u8282\u70b9\uff0c\u5219\u5728\u53f3\u5b50\u6811\u4e2d\u8fdb\u884c\u67e5\u627e\uff1b \u5982\u679c key \u5c0f\u4e8e\u6839\u8282\u70b9\uff0c\u5219\u5728\u5de6\u5b50\u6811\u4e2d\u8fdb\u884c\u67e5\u627e\uff1b \u5982\u679c key \u7b49\u4e8e\u6839\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u627e\u5230\u4e86\u8fd9\u4e2a\u8282\u70b9\uff0c\u8fd4\u56de\u6839\u8282\u70b9\u5373\u53ef\u3002 \u4e8c\u53c9\u67e5\u627e\u6811\u67e5\u627e\u67d0\u4e2a\u8282\u70b9\u7684\u52a8\u56fe\u6f14\u793a\u5982\u4e0b\uff0c\u6bd4\u5982\u8981\u67e5\u627e\u8282\u70b9 3 \uff1a \u53e6\u5916\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u89e3\u51b3\u4e86\u63d2\u5165\u65b0\u8282\u70b9\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u4e8c\u53c9\u67e5\u627e\u6811\u662f\u4e00\u4e2a\u8df3\u8dc3\u7ed3\u6784\uff0c\u4e0d\u5fc5\u8fde\u7eed\u6392\u5217\u3002\u8fd9\u6837\u5728\u63d2\u5165\u7684\u65f6\u5019\uff0c\u65b0\u8282\u70b9\u53ef\u4ee5\u653e\u5728\u4efb\u4f55\u4f4d\u7f6e\uff0c\u4e0d\u4f1a\u50cf\u7ebf\u6027\u7ed3\u6784\u90a3\u6837\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u6240\u6709\u5143\u7d20\u90fd\u9700\u8981\u5411\u540e\u6392\u5217\u3002 \u4e0b\u9762\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u63d2\u5165\u67d0\u4e2a\u8282\u70b9\u7684\u52a8\u56fe\u6f14\u793a\uff1a \u56e0\u6b64\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u89e3\u51b3\u4e86\u8fde\u7eed\u7ed3\u6784\u63d2\u5165\u65b0\u5143\u7d20\u5f00\u9500\u5f88\u5927\u7684\u95ee\u9898\uff0c\u540c\u65f6\u53c8\u4fdd\u6301\u7740\u5929\u7136\u7684\u4e8c\u5206\u7ed3\u6784\u3002 \u90a3\u662f\u4e0d\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u5c31\u53ef\u4ee5\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u4e86\u5462\uff1f \u4e0d\u884c\u4e0d\u884c\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u5b58\u5728\u4e00\u4e2a\u6781\u7aef\u60c5\u51b5\uff0c\u4f1a\u5bfc\u81f4\u5b83\u53d8\u6210\u4e00\u4e2a\u7638\u5b50\uff01 \u5f53\u6bcf\u6b21\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u6700\u5927\u7684\u5143\u7d20\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u5c31\u4f1a\u9000\u5316\u6210\u4e86\u4e00\u6761\u94fe\u8868\uff0c\u67e5\u627e\u6570\u636e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u6210\u4e86 O(n) \uff0c\u5982\u4e0b\u52a8\u56fe\u6f14\u793a\uff1a \u7531\u4e8e\u6811\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u8bbf\u95ee\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u5bf9\u5e94\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\uff08 \u5047\u8bbe\u4e00\u4e2a\u8282\u70b9\u7684\u5927\u5c0f\u300c\u5c0f\u4e8e\u300d\u64cd\u4f5c\u7cfb\u7edf\u7684\u6700\u5c0f\u8bfb\u5199\u5355\u4f4d\u5757\u7684\u5927\u5c0f \uff09\uff0c\u4e5f\u5c31\u662f\u8bf4**\u6811\u7684\u9ad8\u5ea6\u5c31\u7b49\u4e8e\u6bcf\u6b21\u67e5\u8be2\u6570\u636e\u65f6\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570**\uff0c\u6240\u4ee5\u6811\u7684\u9ad8\u5ea6\u8d8a\u9ad8\uff0c\u5c31\u4f1a\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002 \u4e8c\u53c9\u67e5\u627e\u6811\u7531\u4e8e\u5b58\u5728\u9000\u5316\u6210\u94fe\u8868\u7684\u53ef\u80fd\u6027\uff0c\u4f1a\u4f7f\u5f97\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4ece O(logn) \u5347\u4e3a O(n)\u3002 \u800c\u4e14\u4f1a\u968f\u7740\u63d2\u5165\u7684\u5143\u7d20\u8d8a\u591a\uff0c\u6811\u7684\u9ad8\u5ea6\u4e5f\u53d8\u9ad8\uff0c\u610f\u5473\u7740\u9700\u8981\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570\u5c31\u8d8a\u591a\uff0c\u8fd9\u6837\u5bfc\u81f4\u67e5\u8be2\u6027\u80fd\u4e25\u91cd\u4e0b\u964d\uff0c\u518d\u52a0\u4e0a\u4e0d\u80fd\u8303\u56f4\u67e5\u8be2\uff0c\u6240\u4ee5\u4e0d\u9002\u5408\u4f5c\u4e3a\u6570\u636e\u5e93\u7684\u7d22\u5f15\u7ed3\u6784\u3002","title":"\u4ec0\u4e48\u662f\u4e8c\u5206\u67e5\u627e\u6811\uff1f"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_4","text":"\u4e3a\u4e86\u89e3\u51b3\u4e8c\u53c9\u67e5\u627e\u6811\u4f1a\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\u9000\u5316\u6210\u94fe\u8868\u7684\u95ee\u9898\uff0c\u540e\u9762\u5c31\u6709\u4eba\u63d0\u51fa**\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\uff08AVL \u6811\uff09**\u3002 \u4e3b\u8981\u662f\u5728\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u4e9b\u6761\u4ef6\u7ea6\u675f\uff1a \u6bcf\u4e2a\u8282\u70b9\u7684\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\u7684\u9ad8\u5ea6\u5dee\u4e0d\u80fd\u8d85\u8fc7 1 \u3002\u4e5f\u5c31\u662f\u8bf4\u8282\u70b9\u7684\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\u4ecd\u7136\u4e3a\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u8fd9\u6837\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u4e00\u76f4\u7ef4\u6301\u5728 O(logn) \u3002 \u4e0b\u56fe\u662f\u6bcf\u6b21\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u6700\u5927\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4f1a\u7ef4\u6301\u81ea\u5e73\u8861\uff1a \u9664\u4e86\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u8fd8\u6709\u5f88\u591a\u81ea\u5e73\u8861\u7684\u4e8c\u53c9\u6811\uff0c\u6bd4\u5982\u7ea2\u9ed1\u6811\uff0c\u5b83\u4e5f\u662f\u901a\u8fc7\u4e00\u4e9b\u7ea6\u675f\u6761\u4ef6\u6765\u8fbe\u5230\u81ea\u5e73\u8861\uff0c\u4e0d\u8fc7\u7ea2\u9ed1\u6811\u7684\u7ea6\u675f\u6761\u4ef6\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u662f\u672c\u7bc7\u7684\u91cd\u70b9\u91cd\u70b9\uff0c\u5927\u5bb6\u53ef\u4ee5\u770b\u300a\u6570\u636e\u7ed3\u6784\u300b\u76f8\u5173\u7684\u4e66\u7c4d\u6765\u4e86\u89e3\u7ea2\u9ed1\u6811\u7684\u7ea6\u675f\u6761\u4ef6\u3002 \u4e0b\u9762\u662f\u7ea2\u9ed1\u6811\u63d2\u5165\u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u8fd9\u5de6\u65cb\u53f3\u65cb\u7684\u64cd\u4f5c\uff0c\u5c31\u662f\u4e3a\u4e86\u81ea\u5e73\u8861\u3002 \u4e0d\u7ba1\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u8fd8\u662f\u7ea2\u9ed1\u6811\uff0c\u90fd\u4f1a\u968f\u7740\u63d2\u5165\u7684\u5143\u7d20\u589e\u591a\uff0c\u800c\u5bfc\u81f4\u6811\u7684\u9ad8\u5ea6\u53d8\u9ad8\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\u591a\uff0c\u4f1a\u5f71\u54cd\u6574\u4f53\u6570\u636e\u67e5\u8be2\u7684\u6548\u7387 \u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u9ad8\u5ea6\u4e3a 5\uff0c\u90a3\u4e48\u5728\u8bbf\u95ee\u6700\u5e95\u90e8\u7684\u8282\u70b9\u65f6\uff0c\u5c31\u9700\u8981\u78c1\u76d8 5 \u6b21 I/O \u64cd\u4f5c\u3002 \u6839\u672c\u539f\u56e0\u662f\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u4e8c\u53c9\u6811\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u4fdd\u5b58 2 \u4e2a\u5b50\u8282\u70b9 \uff0c\u5982\u679c\u6211\u4eec\u628a\u4e8c\u53c9\u6811\u6539\u6210 M \u53c9\u6811\uff08M>2\uff09\u5462\uff1f \u6bd4\u5982\uff0c\u5f53 M=3 \u65f6\uff0c\u5728\u540c\u6837\u7684\u8282\u70b9\u4e2a\u6570\u60c5\u51b5\u4e0b\uff0c\u4e09\u53c9\u6811\u6bd4\u4e8c\u53c9\u6811\u7684\u6811\u9ad8\u8981\u77ee\u3002 \u56e0\u6b64\uff0c \u5f53\u6811\u7684\u8282\u70b9\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u5e76\u4e14\u6811\u7684\u5206\u53c9\u6570 M \u8d8a\u5927\u7684\u65f6\u5019\uff0cM \u53c9\u6811\u7684\u9ad8\u5ea6\u4f1a\u8fdc\u5c0f\u4e8e\u4e8c\u53c9\u6811\u7684\u9ad8\u5ea6 \u3002","title":"\u4ec0\u4e48\u662f\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\uff1f"},{"location":"mysql/index/why_index_chose_bpuls_tree/#b","text":"\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\u867d\u7136\u80fd\u4fdd\u6301\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5728O(logn)\uff0c\u4f46\u662f\u56e0\u4e3a\u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u5f53\u8282\u70b9\u4e2a\u6570\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u6811\u7684\u9ad8\u5ea6\u4e5f\u4f1a\u76f8\u5e94\u53d8\u9ad8\uff0c\u8fd9\u6837\u5c31\u4f1a\u589e\u52a0\u78c1\u76d8\u7684 I/O \u6b21\u6570\uff0c\u4ece\u800c\u5f71\u54cd\u6570\u636e\u67e5\u8be2\u7684\u6548\u7387\u3002 \u4e3a\u4e86\u89e3\u51b3\u964d\u4f4e\u6811\u7684\u9ad8\u5ea6\u7684\u95ee\u9898\uff0c\u540e\u9762\u5c31\u51fa\u6765\u4e86 B \u6811\uff0c\u5b83\u4e0d\u518d\u9650\u5236\u4e00\u4e2a\u8282\u70b9\u5c31\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u800c\u662f\u5141\u8bb8 M \u4e2a\u5b50\u8282\u70b9 (M>2)\uff0c\u4ece\u800c\u964d\u4f4e\u6811\u7684\u9ad8\u5ea6\u3002 B \u6811\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u6700\u591a\u53ef\u4ee5\u5305\u62ec M \u4e2a\u5b50\u8282\u70b9\uff0cM \u79f0\u4e3a B \u6811\u7684\u9636\uff0c\u6240\u4ee5 B \u6811\u5c31\u662f\u4e00\u4e2a\u591a\u53c9\u6811\u3002 \u5047\u8bbe M = 3\uff0c\u90a3\u4e48\u5c31\u662f\u4e00\u68f5 3 \u9636\u7684 B \u6811\uff0c\u7279\u70b9\u5c31\u662f\u6bcf\u4e2a\u8282\u70b9\u6700\u591a\u6709 2 \u4e2a\uff08M-1\u4e2a\uff09\u6570\u636e\u548c\u6700\u591a\u6709 3 \u4e2a\uff08M\u4e2a\uff09\u5b50\u8282\u70b9\uff0c\u8d85\u8fc7\u8fd9\u4e9b\u8981\u6c42\u7684\u8bdd\uff0c\u5c31\u4f1a\u5206\u88c2\u8282\u70b9\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u7684\u52a8\u56fe\uff1a \u6211\u4eec\u6765\u770b\u770b\u4e00\u68f5 3 \u9636\u7684 B \u6811\u7684\u67e5\u8be2\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f \u5047\u8bbe\u6211\u4eec\u5728\u4e0a\u56fe\u4e00\u68f5 3 \u9636\u7684 B \u6811\u4e2d\u8981\u67e5\u627e\u7684\u7d22\u5f15\u503c\u662f 9 \u7684\u8bb0\u5f55\u90a3\u4e48\u6b65\u9aa4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u6b65\uff1a \u4e0e\u6839\u8282\u70b9\u7684\u7d22\u5f15(4\uff0c8\uff09\u8fdb\u884c\u6bd4\u8f83\uff0c9 \u5927\u4e8e 8\uff0c\u90a3\u4e48\u5f80\u53f3\u8fb9\u7684\u5b50\u8282\u70b9\u8d70\uff1b \u7136\u540e\u8be5\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u4e3a\uff0810\uff0c12\uff09\uff0c\u56e0\u4e3a 9 \u5c0f\u4e8e 10\uff0c\u6240\u4ee5\u4f1a\u5f80\u8be5\u8282\u70b9\u7684\u5de6\u8fb9\u5b50\u8282\u70b9\u8d70\uff1b \u8d70\u5230\u7d22\u5f15\u4e3a9\u7684\u8282\u70b9\uff0c\u7136\u540e\u6211\u4eec\u627e\u5230\u4e86\u7d22\u5f15\u503c 9 \u7684\u8282\u70b9\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u68f5 3 \u9636\u7684 B \u6811\u5728\u67e5\u8be2\u53f6\u5b50\u8282\u70b9\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u7531\u4e8e\u6811\u7684\u9ad8\u5ea6\u662f 3 \uff0c\u6240\u4ee5\u5728\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u53d1\u751f 3 \u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u3002 \u800c\u5982\u679c\u540c\u6837\u7684\u8282\u70b9\u6570\u91cf\u5728\u5e73\u8861\u4e8c\u53c9\u6811\u7684\u573a\u666f\u4e0b\uff0c\u6811\u7684\u9ad8\u5ea6\u5c31\u4f1a\u5f88\u9ad8\uff0c\u610f\u5473\u7740\u78c1\u76d8 I/O \u64cd\u4f5c\u4f1a\u66f4\u591a\u3002\u6240\u4ee5\uff0cB \u6811\u5728\u6570\u636e\u67e5\u8be2\u4e2d\u6bd4\u5e73\u8861\u4e8c\u53c9\u6811\u6548\u7387\u8981\u9ad8\u3002 \u4f46\u662f B \u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u5305\u542b\u6570\u636e\uff08\u7d22\u5f15+\u8bb0\u5f55\uff09\uff0c\u800c\u7528\u6237\u7684\u8bb0\u5f55\u6570\u636e\u7684\u5927\u5c0f\u5f88\u6709\u53ef\u80fd\u8fdc\u8fdc\u8d85\u8fc7\u4e86\u7d22\u5f15\u6570\u636e\uff0c\u8fd9\u5c31\u9700\u8981\u82b1\u8d39\u66f4\u591a\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\u6765\u8bfb\u5230\u300c\u6709\u7528\u7684\u7d22\u5f15\u6570\u636e\u300d\u3002 \u800c\u4e14\uff0c\u5728\u6211\u4eec\u67e5\u8be2\u4f4d\u4e8e\u5e95\u5c42\u7684\u67d0\u4e2a\u8282\u70b9\uff08\u6bd4\u5982 A \u8bb0\u5f55\uff09\u8fc7\u7a0b\u4e2d\uff0c\u300c\u975e A \u8bb0\u5f55\u8282\u70b9\u300d\u91cc\u7684\u8bb0\u5f55\u6570\u636e\u4f1a\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4f46\u662f\u8fd9\u4e9b\u8bb0\u5f55\u6570\u636e\u662f\u6ca1\u7528\u7684\uff0c\u6211\u4eec\u53ea\u662f\u60f3\u8bfb\u53d6\u8fd9\u4e9b\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e\u6765\u505a\u6bd4\u8f83\u67e5\u8be2\uff0c\u800c\u300c\u975e A \u8bb0\u5f55\u8282\u70b9\u300d\u91cc\u7684\u8bb0\u5f55\u6570\u636e\u5bf9\u6211\u4eec\u662f\u6ca1\u7528\u7684\uff0c\u8fd9\u6837\u4e0d\u4ec5\u589e\u591a\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\uff0c\u4e5f\u5360\u7528\u5185\u5b58\u8d44\u6e90\u3002 \u53e6\u5916\uff0c\u5982\u679c\u4f7f\u7528 B \u6811\u6765\u505a\u8303\u56f4\u67e5\u8be2\u7684\u8bdd\uff0c\u9700\u8981\u4f7f\u7528\u4e2d\u5e8f\u904d\u5386\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u95ee\u9898\uff0c\u4ece\u800c\u5bfc\u81f4\u6574\u4f53\u901f\u5ea6\u4e0b\u964d\u3002","title":"\u4ec0\u4e48\u662f B \u6811"},{"location":"mysql/index/why_index_chose_bpuls_tree/#b_1","text":"B+ \u6811\u5c31\u662f\u5bf9 B \u6811\u505a\u4e86\u4e00\u4e2a\u5347\u7ea7\uff0cMySQL \u4e2d\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\uff0cB+ \u6811\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a B+ \u6811\u4e0e B \u6811\u5dee\u5f02\u7684\u70b9\uff0c\u4e3b\u8981\u662f\u4ee5\u4e0b\u8fd9\u51e0\u70b9\uff1a \u53f6\u5b50\u8282\u70b9\uff08\u6700\u5e95\u90e8\u7684\u8282\u70b9\uff09\u624d\u4f1a\u5b58\u653e\u5b9e\u9645\u6570\u636e\uff08\u7d22\u5f15+\u8bb0\u5f55\uff09\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u4f1a\u5b58\u653e\u7d22\u5f15\uff1b \u6240\u6709\u7d22\u5f15\u90fd\u4f1a\u5728\u53f6\u5b50\u8282\u70b9\u51fa\u73b0\uff0c\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u6784\u6210\u4e00\u4e2a\u6709\u5e8f\u94fe\u8868\uff1b \u975e\u53f6\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u4e5f\u4f1a\u540c\u65f6\u5b58\u5728\u5728\u5b50\u8282\u70b9\u4e2d\uff0c\u5e76\u4e14\u662f\u5728\u5b50\u8282\u70b9\u4e2d\u6240\u6709\u7d22\u5f15\u7684\u6700\u5927\uff08\u6216\u6700\u5c0f\uff09\u3002 \u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u5b50\u8282\u70b9\uff0c\u5c31\u6709\u591a\u5c11\u4e2a\u7d22\u5f15\uff1b \u4e0b\u9762\u901a\u8fc7\u4e09\u4e2a\u65b9\u9762\uff0c\u6bd4\u8f83\u4e0b B+ \u548c B \u6811\u7684\u6027\u80fd\u533a\u522b\u3002","title":"\u4ec0\u4e48\u662f B+ \u6811\uff1f"},{"location":"mysql/index/why_index_chose_bpuls_tree/#1","text":"B \u6811\u8fdb\u884c\u5355\u4e2a\u7d22\u5f15\u67e5\u8be2\u65f6\uff0c\u6700\u5feb\u53ef\u4ee5\u5728 O(1) \u7684\u65f6\u95f4\u4ee3\u4ef7\u5185\u5c31\u67e5\u5230\uff0c\u800c\u4ece\u5e73\u5747\u65f6\u95f4\u4ee3\u4ef7\u6765\u770b\uff0c\u4f1a\u6bd4 B+ \u6811\u7a0d\u5feb\u4e00\u4e9b\u3002 \u4f46\u662f B \u6811\u7684\u67e5\u8be2\u6ce2\u52a8\u4f1a\u6bd4\u8f83\u5927\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8282\u70b9\u5373\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\uff0c\u6240\u4ee5\u6709\u65f6\u5019\u8bbf\u95ee\u5230\u4e86\u975e\u53f6\u5b50\u8282\u70b9\u5c31\u53ef\u4ee5\u627e\u5230\u7d22\u5f15\uff0c\u800c\u6709\u65f6\u9700\u8981\u8bbf\u95ee\u5230\u53f6\u5b50\u8282\u70b9\u624d\u80fd\u627e\u5230\u7d22\u5f15\u3002 B+ \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u653e\u5b9e\u9645\u7684\u8bb0\u5f55\u6570\u636e\uff0c\u4ec5\u5b58\u653e\u7d22\u5f15\uff0c\u56e0\u6b64\u6570\u636e\u91cf\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u76f8\u6bd4\u5b58\u50a8\u5373\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\u7684 B \u6811\uff0cB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u7d22\u5f15\uff0c\u56e0\u6b64 B+ \u6811\u53ef\u4ee5\u6bd4 B \u6811\u66f4\u300c\u77ee\u80d6\u300d\uff0c\u67e5\u8be2\u5e95\u5c42\u8282\u70b9\u7684\u78c1\u76d8 I/O\u6b21\u6570\u4f1a\u66f4\u5c11 \u3002","title":"1\u3001\u5355\u70b9\u67e5\u8be2"},{"location":"mysql/index/why_index_chose_bpuls_tree/#2","text":"B+ \u6811\u6709\u5927\u91cf\u7684\u5197\u4f59\u8282\u70b9\uff0c\u8fd9\u6837\u4f7f\u5f97\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u53f6\u5b50\u8282\u70b9\u4e2d\u5220\u9664\uff0c\u751a\u81f3\u53ef\u4ee5\u4e0d\u52a8\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u8fd9\u6837\u5220\u9664\u975e\u5e38\u5feb\uff0c \u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B+ \u6811 0004 \u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u975e\u53f6\u5b50\u8282\u70b9\u6709 0004 \u7684\u5197\u4f59\u8282\u70b9\uff0c\u6240\u4ee5\u5728\u5220\u9664\u7684\u65f6\u5019\uff0c\u6811\u5f62\u7ed3\u6784\u53d8\u5316\u5f88\u5c0f\uff1a \u6ce8\u610f\uff0c\uff1aB+ \u6811\u5bf9\u4e8e\u975e\u53f6\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\u548c\u7d22\u5f15\u7684\u4e2a\u6570\uff0c\u5b9a\u4e49\u65b9\u5f0f\u53ef\u80fd\u4f1a\u6709\u4e0d\u540c\uff0c\u6709\u7684\u662f\u8bf4\u975e\u53f6\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\u7684\u4e2a\u6570\u4e3a M \u9636\uff0c\u800c\u7d22\u5f15\u7684\u4e2a\u6570\u4e3a M-1\uff08\u8fd9\u4e2a\u662f\u7ef4\u57fa\u767e\u79d1\u91cc\u7684\u5b9a\u4e49\uff09\uff0c\u56e0\u6b64\u6211\u672c\u6587\u5173\u4e8e B+ \u6811\u7684\u52a8\u56fe\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e2a\u3002\u4f46\u662f\u6211\u5728\u524d\u9762\u4ecb\u7ecd B+ \u6811\u4e0e B+ \u6811\u7684\u5dee\u5f02\u65f6\uff0c\u8bf4\u7684\u662f\u300c\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u5b50\u8282\u70b9\uff0c\u5c31\u6709\u591a\u5c11\u4e2a\u7d22\u5f15\u300d\uff0c\u4e3b\u8981\u662f MySQL \u7528\u5230\u7684 B+ \u6811\u5c31\u662f\u8fd9\u4e2a\u7279\u6027\u3002 \u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B \u6811 0008 \u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6811\u7684\u590d\u6742\u53d8\u5316\uff1a \u751a\u81f3\uff0cB+ \u6811\u5728\u5220\u9664\u6839\u8282\u70b9\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u5b58\u5728\u5197\u4f59\u7684\u8282\u70b9\uff0c\u6240\u4ee5\u4e0d\u4f1a\u53d1\u751f\u590d\u6742\u7684\u6811\u7684\u53d8\u5f62\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B+ \u6811\u6839\u8282\u70b9\u7684\u8fc7\u7a0b\uff1a B \u6811\u5219\u4e0d\u540c\uff0cB \u6811\u6ca1\u6709\u5197\u4f59\u8282\u70b9\uff0c\u5220\u9664\u8282\u70b9\u7684\u65f6\u5019\u975e\u5e38\u590d\u6742\uff0c\u6bd4\u5982\u5220\u9664\u6839\u8282\u70b9\u4e2d\u7684\u6570\u636e\uff0c\u53ef\u80fd\u6d89\u53ca\u590d\u6742\u7684\u6811\u7684\u53d8\u5f62\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B \u6811\u6839\u8282\u70b9\u7684\u8fc7\u7a0b\uff1a B+ \u6811\u7684\u63d2\u5165\u4e5f\u662f\u4e00\u6837\uff0c\u6709\u5197\u4f59\u8282\u70b9\uff0c\u63d2\u5165\u53ef\u80fd\u5b58\u5728\u8282\u70b9\u7684\u5206\u88c2\uff08\u5982\u679c\u8282\u70b9\u9971\u548c\uff09\uff0c\u4f46\u662f\u6700\u591a\u53ea\u6d89\u53ca\u6811\u7684\u4e00\u6761\u8def\u5f84\u3002\u800c\u4e14 B+ \u6811\u4f1a\u81ea\u52a8\u5e73\u8861\uff0c\u4e0d\u9700\u8981\u50cf\u66f4\u591a\u590d\u6742\u7684\u7b97\u6cd5\uff0c\u7c7b\u4f3c\u7ea2\u9ed1\u6811\u7684\u65cb\u8f6c\u64cd\u4f5c\u7b49\u3002 \u56e0\u6b64\uff0c B+ \u6811\u7684\u63d2\u5165\u548c\u5220\u9664\u6548\u7387\u66f4\u9ad8 \u3002","title":"2\u3001\u63d2\u5165\u548c\u5220\u9664\u6548\u7387"},{"location":"mysql/index/why_index_chose_bpuls_tree/#3","text":"B \u6811\u548c B+ \u6811\u7b49\u503c\u67e5\u8be2\u539f\u7406\u57fa\u672c\u4e00\u81f4\uff0c\u5148\u4ece\u6839\u8282\u70b9\u67e5\u627e\uff0c\u7136\u540e\u5bf9\u6bd4\u76ee\u6807\u6570\u636e\u7684\u8303\u56f4\uff0c\u6700\u540e\u9012\u5f52\u7684\u8fdb\u5165\u5b50\u8282\u70b9\u67e5\u627e\u3002 \u56e0\u4e3a B+ \u6811\u6240\u6709\u53f6\u5b50\u8282\u70b9\u95f4\u8fd8\u6709\u4e00\u4e2a\u94fe\u8868\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5bf9\u8303\u56f4\u67e5\u627e\u975e\u5e38\u6709\u5e2e\u52a9 \uff0c\u6bd4\u5982\u8bf4\u6211\u4eec\u60f3\u77e5\u9053 12 \u6708 1 \u65e5\u548c 12 \u6708 12 \u65e5\u4e4b\u95f4\u7684\u8ba2\u5355\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u5148\u67e5\u627e\u5230 12 \u6708 1 \u65e5\u6240\u5728\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u5229\u7528\u94fe\u8868\u5411\u53f3\u904d\u5386\uff0c\u76f4\u5230\u627e\u5230 12 \u670812 \u65e5\u7684\u8282\u70b9\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u4ece\u6839\u8282\u70b9\u67e5\u8be2\u4e86\uff0c\u8fdb\u4e00\u6b65\u8282\u7701\u67e5\u8be2\u9700\u8981\u7684\u65f6\u95f4\u3002 \u800c B \u6811\u6ca1\u6709\u5c06\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7528\u94fe\u8868\u4e32\u8054\u8d77\u6765\u7684\u7ed3\u6784\uff0c\u56e0\u6b64\u53ea\u80fd\u901a\u8fc7\u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u8303\u56f4\u67e5\u8be2\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u8303\u56f4\u67e5\u8be2\u6548\u7387\u4e0d\u5982 B+ \u6811\u3002 \u56e0\u6b64\uff0c\u5b58\u5728\u5927\u91cf\u8303\u56f4\u68c0\u7d22\u7684\u573a\u666f\uff0c\u9002\u5408\u4f7f\u7528 B+\u6811\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u3002\u800c\u5bf9\u4e8e\u5927\u91cf\u7684\u5355\u4e2a\u7d22\u5f15\u67e5\u8be2\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u8003\u8651 B \u6811\uff0c\u6bd4\u5982 nosql \u7684MongoDB\u3002","title":"3\u3001\u8303\u56f4\u67e5\u8be2"},{"location":"mysql/index/why_index_chose_bpuls_tree/#mysql-b_1","text":"MySQL \u7684\u5b58\u50a8\u65b9\u5f0f\u6839\u636e\u5b58\u50a8\u5f15\u64ce\u7684\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u6211\u4eec\u6700\u5e38\u7528\u7684\u5c31\u662f Innodb \u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u4e86\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u3002 \u4e0b\u56fe\u5c31\u662f Innodb \u91cc\u7684 B+ \u6811\uff1a \u4f46\u662f Innodb \u4f7f\u7528\u7684 B+ \u6811\u6709\u4e00\u4e9b\u7279\u522b\u7684\u70b9\uff0c\u6bd4\u5982\uff1a B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u662f\u7528\u300c\u53cc\u5411\u94fe\u8868\u300d\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u65e2\u80fd\u5411\u53f3\u904d\u5386\uff0c\u4e5f\u80fd\u5411\u5de6\u904d\u5386\u3002 B+ \u6811\u70b9\u8282\u70b9\u5185\u5bb9\u662f\u6570\u636e\u9875\uff0c\u6570\u636e\u9875\u91cc\u5b58\u653e\u4e86\u7528\u6237\u7684\u8bb0\u5f55\u4ee5\u53ca\u5404\u79cd\u4fe1\u606f\uff0c\u6bcf\u4e2a\u6570\u636e\u9875\u9ed8\u8ba4\u5927\u5c0f\u662f 16 KB\u3002 Innodb \u6839\u636e\u7d22\u5f15\u7c7b\u578b\u4e0d\u540c\uff0c\u5206\u4e3a\u805a\u96c6\u548c\u4e8c\u7ea7\u7d22\u5f15\u3002\u4ed6\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u96c6\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u805a\u96c6\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002 \u56e0\u4e3a\u8868\u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728\u805a\u96c6\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e00\u5b9a\u4f1a\u4e3a\u8868\u521b\u5efa\u4e00\u4e2a\u805a\u96c6\u7d22\u5f15\uff0c\u4e14\u7531\u4e8e\u6570\u636e\u5728\u7269\u7406\u4e0a\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\uff0c\u6240\u4ee5\u805a\u7c07\u7d22\u5f15\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u3002 \u66f4\u591a\u5173\u4e8e Innodb \u7684 B+ \u6811\uff0c\u53ef\u4ee5\u770b\u6211\u4e4b\u524d\u5199\u7684\u8fd9\u7bc7\uff1a \u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811 \u3002","title":"MySQL \u4e2d\u7684 B+ \u6811"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_5","text":"MySQL \u662f\u4f1a\u5c06\u6570\u636e\u6301\u4e45\u5316\u5728\u786c\u76d8\uff0c\u800c\u5b58\u50a8\u529f\u80fd\u662f\u7531 MySQL \u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u8ba8\u8bba MySQL \u4f7f\u7528\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u7d22\u5f15\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u8ba8\u8bba\u5b58\u50a8\u5f15\u4f7f\u7528\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u7d22\u5f15\uff0cInnoDB \u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u3002 \u8981\u8bbe\u8ba1\u4e00\u4e2a MySQL \u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u4e0d\u4ec5\u4ec5\u8003\u8651\u6570\u636e\u7ed3\u6784\u589e\u5220\u6539\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u66f4\u91cd\u8981\u7684\u662f\u8981\u8003\u8651\u78c1\u76d8 I/0 \u7684\u64cd\u4f5c\u6b21\u6570\u3002\u56e0\u4e3a\u7d22\u5f15\u548c\u8bb0\u5f55\u90fd\u662f\u5b58\u653e\u5728\u786c\u76d8\uff0c\u786c\u76d8\u662f\u4e00\u4e2a\u975e\u5e38\u6162\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6211\u4eec\u5728\u67e5\u8be2\u6570\u636e\u7684\u65f6\u5019\uff0c\u6700\u597d\u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8 I/0 \u7684\u64cd\u4f5c\u6b21\u6570\u5185\u5b8c\u6210\u3002 \u4e8c\u5206\u67e5\u627e\u6811\u867d\u7136\u662f\u4e00\u4e2a\u5929\u7136\u7684\u4e8c\u5206\u7ed3\u6784\uff0c\u80fd\u5f88\u597d\u7684\u5229\u7528\u4e8c\u5206\u67e5\u627e\u5feb\u901f\u5b9a\u4f4d\u6570\u636e\uff0c\u4f46\u662f\u5b83\u5b58\u5728\u4e00\u79cd\u6781\u7aef\u7684\u60c5\u51b5\uff0c\u6bcf\u5f53\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u6811\u5185\u6700\u5927\u7684\u5143\u7d20\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e8c\u5206\u67e5\u627e\u6811\u9000\u5316\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u6b64\u65f6\u67e5\u8be2\u590d\u6742\u5ea6\u5c31\u4f1a\u4ece O(logn)\u964d\u4f4e\u4e3a O(n)\u3002 \u4e3a\u4e86\u89e3\u51b3\u4e8c\u5206\u67e5\u627e\u6811\u9000\u5316\u6210\u94fe\u8868\u7684\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u4fdd\u8bc1\u4e86\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u4e00\u76f4\u7ef4\u6301\u5728 O(logn) \u3002\u4f46\u662f\u5b83\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u968f\u7740\u5143\u7d20\u7684\u589e\u591a\uff0c\u6811\u7684\u9ad8\u5ea6\u4f1a\u8d8a\u6765\u8d8a\u9ad8\u3002 \u800c\u6811\u7684\u9ad8\u5ea6\u51b3\u5b9a\u4e8e\u78c1\u76d8 I/O \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u56e0\u4e3a\u6811\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u8bbf\u95ee\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u5bf9\u5e94\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4\u6811\u7684\u9ad8\u5ea6\u5c31\u7b49\u4e8e\u6bcf\u6b21\u67e5\u8be2\u6570\u636e\u65f6\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u6240\u4ee5\u6811\u7684\u9ad8\u5ea6\u8d8a\u9ad8\uff0c\u5c31\u4f1a\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002 B \u6811\u548c B+ \u90fd\u662f\u901a\u8fc7\u591a\u53c9\u6811\u7684\u65b9\u5f0f\uff0c\u4f1a\u5c06\u6811\u7684\u9ad8\u5ea6\u53d8\u77ee\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u6570\u636e\u7ed3\u6784\u975e\u5e38\u9002\u5408\u68c0\u7d22\u5b58\u4e8e\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u3002 \u4f46\u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce InnoDB \u91c7\u7528\u7684\u662f B+ \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u539f\u56e0\u6709\uff1a B+ \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u653e\u5b9e\u9645\u7684\u8bb0\u5f55\u6570\u636e\uff0c\u4ec5\u5b58\u653e\u7d22\u5f15\uff0c\u56e0\u6b64\u6570\u636e\u91cf\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u76f8\u6bd4\u5b58\u50a8\u5373\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\u7684 B \u6811\uff0cB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u7d22\u5f15\uff0c\u56e0\u6b64 B+ \u6811\u53ef\u4ee5\u6bd4 B \u6811\u66f4\u300c\u77ee\u80d6\u300d\uff0c\u67e5\u8be2\u5e95\u5c42\u8282\u70b9\u7684\u78c1\u76d8 I/O\u6b21\u6570\u4f1a\u66f4\u5c11\u3002 B+ \u6811\u6709\u5927\u91cf\u7684\u5197\u4f59\u8282\u70b9\uff08\u6240\u6709\u975e\u53f6\u5b50\u8282\u70b9\u90fd\u662f\u5197\u4f59\u7d22\u5f15\uff09\uff0c\u8fd9\u4e9b\u5197\u4f59\u7d22\u5f15\u8ba9 B+ \u6811\u5728\u63d2\u5165\u3001\u5220\u9664\u7684\u6548\u7387\u90fd\u66f4\u9ad8\uff0c\u6bd4\u5982\u5220\u9664\u6839\u8282\u70b9\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u50cf B \u6811\u90a3\u6837\u4f1a\u53d1\u751f\u590d\u6742\u7684\u6811\u7684\u53d8\u5316\uff1b B+ \u6811\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u7528\u94fe\u8868\u8fde\u63a5\u4e86\u8d77\u6765\uff0c\u6709\u5229\u4e8e\u8303\u56f4\u67e5\u8be2\uff0c\u800c B \u6811\u8981\u5b9e\u73b0\u8303\u56f4\u67e5\u8be2\uff0c\u56e0\u6b64\u53ea\u80fd\u901a\u8fc7\u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u8303\u56f4\u67e5\u8be2\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u8303\u56f4\u67e5\u8be2\u6548\u7387\u4e0d\u5982 B+ \u6811\u3002 \u5b8c\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/lock/deadlock/","text":"MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u8bf4\u4e2a\u5f88\u65e9\u4e4b\u524d\u81ea\u5df1\u9047\u5230\u8fc7\u6570\u636e\u5e93\u6b7b\u9501\u95ee\u9898\u3002 \u6709\u4e2a\u4e1a\u52a1\u4e3b\u8981\u903b\u8f91\u5c31\u662f\u65b0\u589e\u8ba2\u5355\u3001\u4fee\u6539\u8ba2\u5355\u3001\u67e5\u8be2\u8ba2\u5355\u7b49\u64cd\u4f5c\u3002\u7136\u540e\u56e0\u4e3a\u8ba2\u5355\u662f\u4e0d\u80fd\u91cd\u590d\u7684\uff0c\u6240\u4ee5\u5f53\u65f6\u5728\u65b0\u589e\u8ba2\u5355\u7684\u65f6\u5019\u505a\u4e86\u5e42\u7b49\u6027\u6821\u9a8c\uff0c\u505a\u6cd5\u5c31\u662f\u5728\u65b0\u589e\u8ba2\u5355\u8bb0\u5f55\u4e4b\u524d\uff0c\u5148\u901a\u8fc7 select ... for update \u8bed\u53e5\u67e5\u8be2\u8ba2\u5355\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u624d\u63d2\u5165\u8ba2\u5355\u8bb0\u5f55\u3002 \u800c\u6b63\u662f\u56e0\u4e3a\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u5f53\u4e1a\u52a1\u91cf\u5f88\u5927\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002 \u63a5\u4e0b\u6765\u8ddf\u5927\u5bb6\u804a\u4e0b**\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff0c\u4ee5\u53ca\u600e\u4e48\u907f\u514d\u6b7b\u9501**\u3002 \u6b7b\u9501\u7684\u53d1\u751f \u00b6 \u672c\u6b21\u6848\u4f8b\u4f7f\u7528\u5b58\u50a8\u5f15\u64ce Innodb\uff0c\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08RR\uff09\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u7528\u5b9e\u6218\u7684\u65b9\u5f0f\u6765\u5e26\u5927\u5bb6\u770b\u770b\u6b7b\u9501\u662f\u600e\u4e48\u53d1\u751f\u7684\u3002 \u6211\u5efa\u4e86\u4e00\u5f20\u8ba2\u5355\u8868\uff0c\u5176\u4e2d id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0corder_no \u5b57\u6bb5\u666e\u901a\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff1a CREATE TABLE ` t_order ` ( ` id ` int NOT NULL AUTO_INCREMENT , ` order_no ` int DEFAULT NULL , ` create_date ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` index_order ` ( ` order_no ` ) USING BTREE ) ENGINE = InnoDB ; \u7136\u540e\uff0c\u5148 t_order \u8868\u91cc\u73b0\u5728\u5df2\u7ecf\u6709\u4e86 6 \u6761\u8bb0\u5f55\uff1a \u5047\u8bbe\u8fd9\u65f6\u6709\u4e24\u4e8b\u52a1\uff0c\u4e00\u4e2a\u4e8b\u52a1\u8981\u63d2\u5165\u8ba2\u5355 1007 \uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u8981\u63d2\u5165\u8ba2\u5355 1008\uff0c\u56e0\u4e3a\u9700\u8981\u5bf9\u8ba2\u5355\u505a\u5e42\u7b49\u6027\u6821\u9a8c\uff0c\u6240\u4ee5\u4e24\u4e2a\u4e8b\u52a1\u5148\u8981\u67e5\u8be2\u8be5\u8ba2\u5355\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u624d\u63d2\u5165\u8bb0\u5f55\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u4e2a\u4e8b\u52a1\u90fd\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff08\u524d\u63d0\u6ca1\u6709\u6253\u5f00\u6b7b\u9501\u68c0\u6d4b\uff09\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u6b7b\u9501\uff0c\u56e0\u4e3a\u90fd\u5728\u76f8\u4e92\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u3002 \u8fd9\u91cc\u5728\u67e5\u8be2\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u4e86 select ... for update \u8bed\u53e5\uff0c\u76ee\u7684\u4e3a\u4e86\u9632\u6b62\u4e8b\u52a1\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u8bb0\u5f55\uff0c\u800c\u51fa\u73b0\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u5982\u679c\u6ca1\u6709\u4f7f\u7528 select ... for update \u8bed\u53e5\uff0c\u800c\u4f7f\u7528\u4e86\u5355\u7eaf\u7684 select \u8bed\u53e5\uff0c\u5982\u679c\u662f\u4e24\u4e2a\u8ba2\u5355\u53f7\u4e00\u6837\u7684\u8bf7\u6c42\u540c\u65f6\u8fdb\u6765\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e24\u4e2a\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u5e7b\u8bfb\uff0c\u5982\u4e0b\u56fe\uff1a \u4e3a\u4ec0\u4e48\u4f1a\u4ea7\u751f\u6b7b\u9501\uff1f \u00b6 \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u662f\u5b58\u5728\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 Innodb \u5f15\u64ce\u4e3a\u4e86\u89e3\u51b3\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\u7684\u5e7b\u8bfb\u95ee\u9898\uff0c\u5c31\u5f15\u51fa\u4e86 next-key \u9501 \uff0c\u5b83\u662f\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7684\u7ec4\u5408\u3002 Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u9501\u7684\u662f\u8bb0\u5f55\u672c\u8eab\uff1b Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u7684\u5c31\u662f\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u7a7a\u9699\uff0c\u4ee5\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u7a7a\u9699\u95f4\u63d2\u5165\u65b0\u7684\u6570\u636e\uff0c\u4ece\u800c\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u3002 \u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u662f\u901a\u8fc7 MVCC \u7684\u673a\u5236\u5b9e\u73b0\u7684\u5feb\u7167\u8bfb\uff0c\u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff1a begin ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 select ... lock in share mode ; commit ; // \u9501\u91ca\u653e begin ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u6392\u4ed6\u9501 select ... for update ; commit ; // \u9501\u91ca\u653e \u884c\u9501\u7684\u91ca\u653e\u65f6\u673a\u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\uff08commit\uff09\u540e\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e\uff0c\u5e76\u4e0d\u662f\u4e00\u6761\u8bed\u53e5\u6267\u884c\u5b8c\u5c31\u91ca\u653e\u884c\u9501\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u4e8b\u52a1 A \u67e5\u8be2\u8bed\u53e5\u4f1a\u9501\u4f4f (2, +\u221e] \u8303\u56f4\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u671f\u95f4\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u9501\u4f4f\u7684\u8303\u56f4\u63d2\u5165\u6570\u636e\u5c31\u4f1a\u88ab\u963b\u585e\u3002 next-key \u9501\u7684\u52a0\u9501\u89c4\u5219\u5176\u5b9e\u633a\u590d\u6742\u7684\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501\uff0c\u6211\u4e4b\u524d\u4e5f\u5199\u4e00\u7bc7\u52a0\u9501\u89c4\u5219\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c update \u8bed\u53e5\u7684 where \u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u5728\u4e00\u884c\u884c\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4ec5\u7ed9\u884c\u8bb0\u5f55\u52a0\u4e0a\u4e86\u884c\u9501\uff0c\u8fd8\u7ed9\u884c\u8bb0\u5f55\u4e24\u8fb9\u7684\u7a7a\u9699\u4e5f\u52a0\u4e0a\u4e86\u95f4\u9699\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4f4f\u6574\u4e2a\u8868\uff0c\u7136\u540e\u76f4\u5230\u4e8b\u52a1\u7ed3\u675f\u624d\u4f1a\u91ca\u653e\u9501\u3002 \u6240\u4ee5\u5728\u7ebf\u4e0a\u5343\u4e07\u4e0d\u8981\u6267\u884c\u6ca1\u6709\u5e26\u7d22\u5f15\u6761\u4ef6\u7684 update \u8bed\u53e5\uff0c\u4e0d\u7136\u4f1a\u9020\u6210\u4e1a\u52a1\u505c\u6ede\uff0c\u6211\u6709\u4e2a\u8bfb\u8005\u5c31\u56e0\u4e3a\u5e72\u4e86\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u7136\u540e\u88ab\u8001\u677f\u6559\u80b2\u4e86\u4e00\u6ce2\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f \u56de\u5230\u524d\u9762\u6b7b\u9501\u7684\u4f8b\u5b50\u3002 \u4e8b\u52a1 A \u5728\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff1a select id from t_order where order_no = 1007 for update ; \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff0c\u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f X \u578b\u7684 next-key \u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f X \u578b\u7684\u8bb0\u5f55\u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f X \u578b\u7684\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e8c\u7ea7\u7d22\u5f15\uff08INDEX_NAME : index_order\uff09\u4e0a\u52a0\u7684\u662f X \u578b\u7684 next-key \u9501\uff0c\u9501\u8303\u56f4\u662f (1006, +\u221e] \u3002 next-key \u9501\u7684\u8303\u56f4 (1006, +\u221e]\uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f supremum pseudo-record\uff0c\u8868\u793a\u7684\u662f +\u221e\u3002\u7136\u540e\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u662f t_order \u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 index_order \u7684\u503c\uff0c\u4e5f\u5c31\u662f 1006\u3002\u56e0\u6b64\uff0cnext-key \u9501\u7684\u8303\u56f4 (1006, +\u221e]\u3002 ::: tip \u6709\u7684\u8bfb\u8005\u95ee\uff0c MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f \u8fd9\u7bc7\u6587\u7ae0\u8bb2\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u8bf4\u300c\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u65f6\uff0c\u52a0 next-key lock\uff0c\u7136\u540e\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\u300d\u3002\u4e3a\u4ec0\u4e48\u4e0a\u9762\u4e8b\u52a1 A \u7684 next-key lock \u5e76\u6ca1\u6709\u9000\u5316\u4e3a\u95f4\u9699\u9501\uff1f \u5982\u679c\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 order_no \u4e3a 1005\uff0c\u90a3\u4e48\u7b49\u503c\u67e5\u8be2 order_no = 1006\uff08\u4e0d\u5b58\u5728\uff09\uff0c\u5c31\u662f next key lock\uff0c\u5982\u4e0a\u9762\u4e8b\u52a1 A \u7684\u60c5\u51b5\u3002 \u5982\u679c\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 order_no \u4e3a 1010\uff0c\u90a3\u4e48\u7b49\u503c\u67e5\u8be2 order_no = 1006\uff08\u4e0d\u5b58\u5728\uff09\uff0c\u5c31\u662f\u95f4\u9699\u9501\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a ::: \u5f53\u4e8b\u52a1 B \u5f80\u4e8b\u52a1 A next-key \u9501\u7684\u8303\u56f4 (1006, +\u221e] \u91cc\u63d2\u5165 id = 1008 \u7684\u8bb0\u5f55\u5c31\u4f1a\u88ab\u9501\u4f4f\uff1a Insert into t_order ( order_no , create_date ) values ( 1008 , now ()); \u56e0\u4e3a\u5f53\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u63d2\u5165\u8bed\u53e5\u65f6\uff0c\u4f1a\u5728\u63d2\u5165\u95f4\u9699\u4e0a\u83b7\u53d6\u63d2\u5165\u610f\u5411\u9501\uff0c \u800c\u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5f53\u5176\u5b83\u4e8b\u52a1\u6301\u6709\u8be5\u95f4\u9699\u7684\u95f4\u9699\u9501\u65f6\uff0c\u9700\u8981\u7b49\u5f85\u5176\u5b83\u4e8b\u52a1\u91ca\u653e\u95f4\u9699\u9501\u4e4b\u540e\uff0c\u624d\u80fd\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\u3002\u800c\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u6240\u4ee5\u6240\u4ee5\u4e24\u4e2a\u4e8b\u52a1\u4e2d select ... for update \u8bed\u53e5\u5e76\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd \u3002 \u6848\u4f8b\u4e2d\u7684\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u5728\u6267\u884c\u5b8c\u540e select ... for update \u8bed\u53e5\u540e\u90fd\u6301\u6709\u8303\u56f4\u4e3a (1006,+\u221e] \u7684next-key \u9501\uff0c\u800c\u63a5\u4e0b\u6765\u7684\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u5bfc\u81f4\u6b7b\u9501\u3002 \u4e3a\u4ec0\u4e48\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff1f \u5728MySQL\u5b98\u7f51\u4e0a\u8fd8\u6709\u4e00\u6bb5\u975e\u5e38\u5173\u952e\u7684\u63cf\u8ff0\uff1a Gap locks in InnoDB are \u201cpurely inhibitive\u201d, which means that their only purpose is to prevent other transactions from Inserting to the gap. Gap locks can co-exist. A gap lock taken by one transaction does not prevent another transaction from taking a gap lock on the same gap. There is no difference between shared and exclusive gap locks. They do not conflict with each other, and they perform the same function. \u95f4\u9699\u9501\u7684\u610f\u4e49\u53ea\u5728\u4e8e\u963b\u6b62\u533a\u95f4\u88ab\u63d2\u5165 \uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u5171\u5b58\u7684\u3002 \u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u7684\u95f4\u9699\u9501\u4e0d\u4f1a\u963b\u6b62\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u540c\u4e00\u4e2a\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501 \uff0c\u5171\u4eab\u548c\u6392\u4ed6\u7684\u95f4\u9699\u9501\u662f\u6ca1\u6709\u533a\u522b\u7684\uff0c\u4ed6\u4eec\u76f8\u4e92\u4e0d\u51b2\u7a81\uff0c\u4e14\u529f\u80fd\u76f8\u540c\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u7684\u95f4\u9699\u9501\u3002 \u8fd9\u91cc\u7684\u5171\u540c\u95f4\u9699\u5305\u62ec\u4e24\u79cd\u573a\u666f\uff1a \u5176\u4e00\u662f\u4e24\u4e2a\u95f4\u9699\u9501\u7684\u95f4\u9699\u533a\u95f4\u5b8c\u5168\u4e00\u6837\uff1b \u5176\u4e8c\u662f\u4e00\u4e2a\u95f4\u9699\u9501\u5305\u542b\u7684\u95f4\u9699\u533a\u95f4\u662f\u53e6\u4e00\u4e2a\u95f4\u9699\u9501\u5305\u542b\u95f4\u9699\u533a\u95f4\u7684\u5b50\u96c6\u3002 \u4f46\u662f\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684 \u3002 \u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\u3002X \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6bd4\u5982\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86 select ... where id = 1 for update\uff0c\u540e\u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u7684\u3002 \u4f46\u662f\u8fd8\u8981\u6ce8\u610f\uff01\u5bf9\u4e8e\u8fd9\u79cd\u8303\u56f4\u4e3a (1006, +\u221e] \u7684 next-key lock\uff0c\u4e24\u4e2a\u4e8b\u52a1\u662f\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u7684\uff0c\u4e0d\u4f1a\u51b2\u7a81\u3002\u56e0\u4e3a +\u221e \u5e76\u4e0d\u662f\u4e00\u4e2a\u771f\u5b9e\u7684\u8bb0\u5f55\uff0c\u81ea\u7136\u5c31\u4e0d\u9700\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\u3002 \u63d2\u5165\u610f\u5411\u9501\u662f\u4ec0\u4e48\uff1f \u6ce8\u610f\uff01\u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u867d\u7136\u6709\u610f\u5411\u9501\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u5728MySQL\u7684\u5b98\u65b9\u6587\u6863\u4e2d\u6709\u4ee5\u4e0b\u91cd\u8981\u63cf\u8ff0\uff1a An Insert intention lock is a type of gap lock set by Insert operations prior to row Insertion. This lock signals the intent to Insert in such a way that multiple transactions Inserting into the same index gap need not wait for each other if they are not Inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to Insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with Insert intention locks prior to obtaining the exclusive lock on the Inserted row, but do not block each other because the rows are nonconflicting. \u8fd9\u6bb5\u8bdd\u8868\u660e\u5c3d\u7ba1**\u63d2\u5165\u610f\u5411\u9501\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u4f46\u4e0d\u540c\u4e8e\u95f4\u9699\u9501\u7684\u662f\uff0c\u8be5\u9501\u53ea\u7528\u4e8e\u5e76\u53d1\u63d2\u5165\u64cd\u4f5c**\u3002 \u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a\u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002 \u53e6\u5916\uff0c\u6211\u8865\u5145\u4e00\u70b9\uff0c\u63d2\u5165\u610f\u5411\u9501\u7684\u751f\u6210\u65f6\u673a\uff1a \u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002 Insert \u8bed\u53e5\u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f \u00b6 Insert \u8bed\u53e5\u5728\u6b63\u5e38\u6267\u884c\u65f6\u662f\u4e0d\u4f1a\u751f\u6210\u9501\u7ed3\u6784\u7684\uff0c\u5b83\u662f\u9760\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u81ea\u5e26\u7684 trx_id \u9690\u85cf\u5217\u6765\u4f5c\u4e3a**\u9690\u5f0f\u9501**\u6765\u4fdd\u62a4\u8bb0\u5f55\u7684\u3002 \u4ec0\u4e48\u662f\u9690\u5f0f\u9501\uff1f \u5f53\u4e8b\u52a1\u9700\u8981\u52a0\u9501\u7684\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a\u9501\u4e0d\u53ef\u80fd\u53d1\u751f\u51b2\u7a81\uff0cInnoDB\u4f1a\u8df3\u8fc7\u52a0\u9501\u73af\u8282\uff0c\u8fd9\u79cd\u673a\u5236\u79f0\u4e3a\u9690\u5f0f\u9501\u3002\u9690\u5f0f\u9501\u662f InnoDB \u5b9e\u73b0\u7684\u4e00\u79cd\u5ef6\u8fdf\u52a0\u9501\u673a\u5236\uff0c\u5176\u7279\u70b9\u662f\u53ea\u6709\u5728\u53ef\u80fd\u53d1\u751f\u51b2\u7a81\u65f6\u624d\u52a0\u9501\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u9501\u7684\u6570\u91cf\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u6574\u4f53\u6027\u80fd\u3002 \u9690\u5f0f\u9501\u5c31\u662f\u5728 Insert \u8fc7\u7a0b\u4e2d\u4e0d\u52a0\u9501\uff0c\u53ea\u6709\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u5c06\u9690\u5f0f\u9501\u8f6c\u6362\u4e3a\u663e\u793a\u9501\uff0c\u8fd9\u91cc\u6211\u4eec\u5217\u4e3e\u4e24\u4e2a\u573a\u666f\u3002 \u5982\u679c\u8bb0\u5f55\u4e4b\u95f4\u52a0\u6709\u95f4\u9699\u9501\uff0c\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\uff0c\u6b64\u65f6\u662f\u4e0d\u80fd\u63d2\u5165\u8bb0\u5f55\u7684\uff1b \u5982\u679c Insert \u7684\u8bb0\u5f55\u548c\u5df2\u6709\u8bb0\u5f55\u5b58\u5728\u552f\u4e00\u952e\u51b2\u7a81\uff0c\u6b64\u65f6\u4e5f\u4e0d\u80fd\u63d2\u5165\u8bb0\u5f55\uff1b 1\u3001\u8bb0\u5f55\u4e4b\u95f4\u52a0\u6709\u95f4\u9699\u9501 \u00b6 \u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u73b0\u5728 t_order \u8868\u4e2d\uff0c\u53ea\u6709\u8fd9\u4e9b\u6570\u636e\uff0c order_no \u662f\u4e8c\u7ea7\u7d22\u5f15 \u3002 \u73b0\u5728\uff0c\u4e8b\u52a1 A \u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u3002 # \u4e8b\u52a1 A mysql > begin ; Query OK , 0 rows affected ( 0 . 01 sec ) mysql > select * from t_order where order_no = 1006 for update ; Empty set ( 0 . 01 sec ) \u63a5\u7740\uff0c\u6211\u4eec\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u672c\u6b21\u7684\u4f8b\u5b50\u52a0\u7684\u662f next-key \u9501\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\uff0c\u9501\u8303\u56f4\u662f \uff081005, +\u221e] \u3002 \u7136\u540e\uff0c\u6709\u4e2a\u4e8b\u52a1 B \u5728\u8fd9\u4e2a\u95f4\u9699\u9501\u4e2d\uff0c\u63d2\u5165\u4e86\u4e00\u4e2a\u8bb0\u5f55\uff0c\u90a3\u4e48\u6b64\u65f6\u8be5\u4e8b\u52a1 B \u5c31\u4f1a\u88ab\u963b\u585e\uff1a # \u4e8b\u52a1 B \u63d2\u5165\u4e00\u6761\u8bb0\u5f55 mysql > begin ; Query OK , 0 rows affected ( 0 . 01 sec ) mysql > insert into t_order ( order_no , create_date ) values ( 1010 , now ()); ### \u963b\u585e\u72b6\u6001\u3002\u3002\u3002\u3002 \u63a5\u7740\uff0c\u6211\u4eec\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1 B \u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 B \u7684\u72b6\u6001\u4e3a\u7b49\u5f85\u72b6\u6001\uff08LOCK_STATUS: WAITING\uff09\uff0c\u56e0\u4e3a\u5411\u4e8b\u52a1 A \u751f\u6210\u7684 next-key \u9501\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u8303\u56f4 \uff081005, +\u221e] \u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u7684\u63d2\u5165\u64cd\u4f5c\u751f\u6210\u4e86\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff08 LOCK_MODE: X,INSERT_INTENTION \uff09\uff0c\u9501\u7684\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u610f\u5473\u7740\u4e8b\u52a1 B \u5e76\u6ca1\u6709\u6210\u529f\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u56e0\u6b64\u4e8b\u52a1 B \u53d1\u751f\u963b\u585e\u3002 2\u3001\u9047\u5230\u552f\u4e00\u952e\u51b2\u7a81 \u00b6 \u5982\u679c\u5728\u63d2\u5165\u65b0\u8bb0\u5f55\u65f6\uff0c\u63d2\u5165\u4e86\u4e00\u4e2a\u4e0e\u300c\u5df2\u6709\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\u76f8\u540c\u300d\u7684\u8bb0\u5f55\uff08\u4e0d\u8fc7\u53ef\u4ee5\u6709\u591a\u6761\u8bb0\u5f55\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u7684\u503c\u540c\u65f6\u4e3aNULL\uff0c\u8fd9\u91cc\u4e0d\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\uff09\uff0c\u6b64\u65f6\u63d2\u5165\u5c31\u4f1a\u5931\u8d25\uff0c\u7136\u540e\u5bf9\u4e8e\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684\u9501 \u3002 \u81f3\u4e8e\u662f\u884c\u7ea7\u9501\u7684\u7c7b\u578b\u662f\u8bb0\u5f55\u9501\uff0c\u8fd8\u662f next-key \u9501\uff0c\u8ddf\u662f\u300c\u4e3b\u952e\u51b2\u7a81\u300d\u8fd8\u662f\u300c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81\u300d\u6709\u5173\u7cfb\u3002 \u5982\u679c\u4e3b\u952e\u7d22\u5f15\u91cd\u590d\uff1a \u5f53\u9694\u79bb\u7ea7\u522b\u4e3a**\u8bfb\u5df2\u63d0\u4ea4**\u65f6\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501**\u3002 \u5f53\u9694\u79bb\u7ea7\u522b\u662f**\u53ef\u91cd\u590d\u8bfb**\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501**\u3002 \u5982\u679c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u91cd\u590d\uff1a \u4e0d\u8bba\u662f\u54ea\u4e2a\u9694\u79bb\u7ea7\u522b \uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u90fd\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\u91cd\u590d\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b next-key \u9501**\u3002\u5bf9\u7684\uff0c\u6ca1\u9519\uff0c\u5373\u4f7f\u662f\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e5f\u662f\u52a0 next-key \u9501\uff0c\u8fd9\u662f\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e2d\u4e3a\u6570\u4e0d\u591a\u7684\u7ed9\u8bb0\u5f55\u6dfb\u52a0\u95f4\u9699\u9501\u7684\u573a\u666f\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u52a0 next-key \u9501\uff0c\u6211\u4e5f\u6ca1\u627e\u5230\u5408\u7406\u7684\u89e3\u91ca\u3002 \u4e3b\u952e\u7d22\u5f15\u51b2\u7a81 \u00b6 \u4e0b\u9762\u4e3e\u4e2a\u300c\u4e3b\u952e\u51b2\u7a81\u300d\u7684\u4f8b\u5b50\uff0cMySQL 8.0 \u7248\u672c\uff0c\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\u3002 t_order \u8868\u4e2d\u7684 id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0c\u5e76\u4e14\u5df2\u7ecf\u5b58\u5728 id \u503c\u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u6709\u4e2a\u4e8b\u52a1\uff0c\u63d2\u5165\u4e86\u4e00\u6761 id \u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u5c31\u4f1a\u62a5\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81\u7684\u9519\u8bef\u3002 \u4f46\u662f\u9664\u4e86\u62a5\u9519\u4e4b\u5916\uff0c\u8fd8\u505a\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5c31\u662f\u5bf9 id \u4e3a 5 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684\u8bb0\u5f55\u9501 \u3002 \u53ef\u4ee5\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5\uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e3b\u952e\u7d22\u5f15\u4e3a 5 \uff08LOCK_DATA\uff09\u7684\u8fd9\u6761\u8bb0\u5f55\u4e2d\u52a0\u4e86\u9501\u7c7b\u578b\u4e3a S \u578b\u7684\u8bb0\u5f55\u9501\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002\u5982\u679c\u662f S \u578b\u8bb0\u5f55\u9501\u7684\u8bdd\uff0cLOCK_MODE \u4f1a\u663e\u793a S, REC_NOT_GAP \u3002 \u6240\u4ee5\uff0c\u5728\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5728\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u53d1\u751f\u4e86\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501**\u3002 \u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81 \u00b6 \u4e0b\u9762\u4e3e\u4e2a\u300c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81\u300d\u7684\u4f8b\u5b50\uff0cMySQL 8.0 \u7248\u672c\uff0c\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\u3002 t_order \u8868\u4e2d\u7684 order_no \u5b57\u6bb5\u4e3a\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5e76\u4e14\u5df2\u7ecf\u5b58\u5728 order_no \u503c\u4e3a 1001 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u4e8b\u52a1 A\uff0c\u63d2\u5165\u4e86 order_no \u4e3a 1001 \u7684\u8bb0\u5f55\uff0c\u5c31\u51fa\u73b0\u4e86\u62a5\u9519\u3002 \u4f46\u662f\u9664\u4e86\u62a5\u9519\u4e4b\u5916\uff0c\u8fd8\u505a\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5c31\u662f\u5bf9 order_no \u503c\u4e3a 1001 \u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684 next-key \u9501 \u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u53ef\u4ee5\u770b\u5230\uff0c index_order \u4e8c\u7ea7\u7d22\u5f15\u52a0\u4e86 S \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\u662f(-\u221e, 1001] \u3002\u6ce8\u610f\uff0c\u8fd9\u91cc LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002\u5982\u679c\u662f\u8bb0\u5f55\u9501\u7684\u8bdd\uff0cLOCK_MODE \u4f1a\u663e\u793a S, REC_NOT_GAP \u3002 \u6b64\u65f6\uff0c\u4e8b\u52a1 B \u6267\u884c\u4e86 select * from t_order where order_no = 1001 for update; \u5c31\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u8fd9\u6761\u8bed\u53e5\u60f3\u52a0 X \u578b\u7684\u9501\uff0c\u662f\u4e0e S \u578b\u7684\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u4ece performance_schema.data_locks \u8fd9\u4e2a\u8868\u4e2d\u770b\u5230\uff0c\u4e8b\u52a1 B \u7684\u72b6\u6001\uff08LOCK_STATUS\uff09\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u52a0\u9501\u7684\u7c7b\u578b X \u578b\u7684\u8bb0\u5f55\u9501\uff08LOCK_MODE: X,REC_NOT_GAP \uff09\u3002 \u4e0a\u9762\u7684\u6848\u4f8b\u662f\u9488\u5bf9\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u91cd\u590d\u800c\u63d2\u5165\u5931\u8d25\u7684\u573a\u666f\u3002 \u63a5\u4e0b\u6765\uff0c\u5206\u6790\u4e24\u4e2a\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u4e86\u76f8\u540c\u7684 insert \u8bed\u53e5\u7684\u573a\u666f\u3002 \u73b0\u5728 t_order \u8868\u4e2d\uff0c\u53ea\u6709\u8fd9\u4e9b\u6570\u636e\uff0c order_no \u4e3a\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15 \u3002 \u5728\u9694\u79bb\u7ea7\u522b\u53ef\u91cd\u590d\u8bfb\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u542f\u4e24\u4e2a\u4e8b\u52a1\uff0c\u524d\u540e\u6267\u884c\u76f8\u540c\u7684 Insert \u8bed\u53e5\uff0c\u6b64\u65f6**\u4e8b\u52a1 B \u7684 Insert \u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e**\u3002 \u4e24\u4e2a\u4e8b\u52a1\u7684\u52a0\u9501\u8fc7\u7a0b\uff1a \u4e8b\u52a1 A \u5148\u63d2\u5165 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u53ef\u4ee5\u63d2\u5165\u6210\u529f\uff0c\u6b64\u65f6\u5bf9\u5e94\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u88ab\u300c\u9690\u5f0f\u9501\u300d\u4fdd\u62a4\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u5b9e\u9645\u7684\u9501\u7ed3\u6784\uff08\u6267\u884c\u5b8c\u8fd9\u91cc\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u770b\u67e5 performance_schema.data_locks \u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u6761\u8bb0\u5f55\u662f\u6ca1\u6709\u52a0\u4efb\u4f55\u9501\u7684\uff09\uff1b \u63a5\u7740\uff0c\u4e8b\u52a1 B \u4e5f\u63d2\u5165 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u5df2\u7ecf\u63d2\u5165 order_no \u503c\u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u63d2\u5165\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u65f6\u4f1a\u9047\u5230\u91cd\u590d\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u60f3\u83b7\u53d6\u4e00\u4e2a S \u578b next-key \u9501\uff0c\u4f46\u662f\u4e8b\u52a1 A \u5e76\u672a\u63d0\u4ea4\uff0c \u4e8b\u52a1 A \u63d2\u5165\u7684 order_no \u503c\u4e3a 1006 \u7684\u8bb0\u5f55\u4e0a\u7684\u300c\u9690\u5f0f\u9501\u300d\u4f1a\u53d8\u300c\u663e\u793a\u9501\u300d\u4e14\u9501\u7c7b\u578b\u4e3a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5411\u83b7\u53d6 S \u578b next-key \u9501\u65f6\u4f1a\u9047\u5230\u9501\u51b2\u7a81\uff0c\u4e8b\u52a1 B \u8fdb\u5165\u963b\u585e\u72b6\u6001 \u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u5148\u770b\u4e8b\u52a1 A \u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0\u4e86\u4ec0\u4e48\u9501\uff1f \u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c \u4e8b\u52a1 A \u5bf9 order_no \u4e3a 1006 \u8bb0\u5f55\u52a0\u4e0a\u4e86\u7c7b\u578b\u4e3a X \u578b\u7684\u8bb0\u5f55\u9501 \uff08 \u6ce8\u610f\uff0c\u8fd9\u4e2a\u662f\u5728\u6267\u884c\u4e8b\u52a1 B \u4e4b\u540e\u624d\u4ea7\u751f\u7684\u9501\uff0c\u6ca1\u6267\u884c\u4e8b\u52a1 B \u4e4b\u524d\uff0c\u8be5\u8bb0\u5f55\u8fd8\u662f\u9690\u5f0f\u9501 \uff09\u3002 \u7136\u540e\u770b\u4e8b\u52a1 B \u60f3\u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0\u4ec0\u4e48\u9501\uff1f \u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c \u4e8b\u52a1 B \u60f3\u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0 S \u578b\u7684 next-key \u9501\uff0c\u4f46\u662f\u7531\u4e8e\u4e8b\u52a1 A \u5728\u8be5\u8bb0\u5f55\u4e0a\u6301\u6709\u4e86 X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u8fd9\u4e24\u4e2a\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e8b\u52a1 B \u5904\u4e8e\u7b49\u5f85\u72b6\u6001 \u3002 \u4ece\u8fd9\u4e2a\u5b9e\u9a8c\u53ef\u4ee5\u5f97\u77e5\uff0c\u5e76\u53d1\u591a\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u5e76\u4e0d\u4f1a\u52a0\u9501\uff0c\u800c\u662f\u4f1a\u7528\u9690\u5f0f\u9501\u4fdd\u62a4\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u7684\u8bb0\u5f55\u3002 \u4f46\u662f\u5f53\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u672a\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e0e\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u5c31\u4f1a**\u88ab\u963b\u585e**\uff0c \u56e0\u4e3a\u6b64\u65f6\u7b2c\u4e00\u4e8b\u52a1\u63d2\u5165\u7684\u8bb0\u5f55\u4e2d\u7684\u9690\u5f0f\u9501\u4f1a\u53d8\u4e3a\u663e\u793a\u9501\u4e14\u7c7b\u578b\u662f X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u800c\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u662f\u60f3\u5bf9\u8be5\u8bb0\u5f55\u52a0\u4e0a S \u578b\u7684 next-key \u9501\uff0cX \u578b\u4e0e S \u578b\u7684\u9501\u662f\u51b2\u7a81\u7684 \uff0c\u6240\u4ee5\u5bfc\u81f4\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u4f1a\u7b49\u5f85\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0c\u91ca\u653e\u4e86\u9501\u3002 \u5982\u679c order_no \u4e0d\u662f\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u4e24\u4e2a\u4e8b\u52a1\uff0c\u524d\u540e\u6267\u884c\u76f8\u540c\u7684 Insert \u8bed\u53e5\uff0c\u662f\u4e0d\u4f1a\u53d1\u751f\u963b\u585e\u7684\uff0c\u5c31\u5982\u524d\u9762\u7684\u8fd9\u4e2a\u4f8b\u5b50\u3002 \u5982\u4f55\u907f\u514d\u6b7b\u9501\uff1f \u00b6 \u6b7b\u9501\u7684\u56db\u4e2a\u5fc5\u8981\u6761\u4ef6\uff1a \u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85 \u3002\u53ea\u8981\u7cfb\u7edf\u53d1\u751f\u6b7b\u9501\uff0c\u8fd9\u4e9b\u6761\u4ef6\u5fc5\u7136\u6210\u7acb\uff0c\u4f46\u662f\u53ea\u8981\u7834\u574f\u4efb\u610f\u4e00\u4e2a\u6761\u4ef6\u5c31\u6b7b\u9501\u5c31\u4e0d\u4f1a\u6210\u7acb\u3002 \u5728\u6570\u636e\u5e93\u5c42\u9762\uff0c\u6709\u4e24\u79cd\u7b56\u7565\u901a\u8fc7\u300c\u6253\u7834\u5faa\u73af\u7b49\u5f85\u6761\u4ef6\u300d\u6765\u89e3\u9664\u6b7b\u9501\u72b6\u6001\uff1a \u8bbe\u7f6e\u4e8b\u52a1\u7b49\u5f85\u9501\u7684\u8d85\u65f6\u65f6\u95f4 \u3002\u5f53\u4e00\u4e2a\u4e8b\u52a1\u7684\u7b49\u5f85\u65f6\u95f4\u8d85\u8fc7\u8be5\u503c\u540e\uff0c\u5c31\u5bf9\u8fd9\u4e2a\u4e8b\u52a1\u8fdb\u884c\u56de\u6eda\uff0c\u4e8e\u662f\u9501\u5c31\u91ca\u653e\u4e86\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u4e86\u3002\u5728 InnoDB \u4e2d\uff0c\u53c2\u6570 innodb_lock_wait_timeout \u662f\u7528\u6765\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u7684\uff0c\u9ed8\u8ba4\u503c\u65f6 50 \u79d2\u3002 \u5f53\u53d1\u751f\u8d85\u65f6\u540e\uff0c\u5c31\u51fa\u73b0\u4e0b\u9762\u8fd9\u4e2a\u63d0\u793a\uff1a \u5f00\u542f\u4e3b\u52a8\u6b7b\u9501\u68c0\u6d4b \u3002\u4e3b\u52a8\u6b7b\u9501\u68c0\u6d4b\u5728\u53d1\u73b0\u6b7b\u9501\u540e\uff0c\u4e3b\u52a8\u56de\u6eda\u6b7b\u9501\u94fe\u6761\u4e2d\u7684\u67d0\u4e00\u4e2a\u4e8b\u52a1\uff0c\u8ba9\u5176\u4ed6\u4e8b\u52a1\u5f97\u4ee5\u7ee7\u7eed\u6267\u884c\u3002\u5c06\u53c2\u6570 innodb_deadlock_detect \u8bbe\u7f6e\u4e3a on\uff0c\u8868\u793a\u5f00\u542f\u8fd9\u4e2a\u903b\u8f91\uff0c\u9ed8\u8ba4\u5c31\u5f00\u542f\u3002 \u5f53\u68c0\u6d4b\u5230\u6b7b\u9501\u540e\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0b\u9762\u8fd9\u4e2a\u63d0\u793a\uff1a \u4e0a\u9762\u8fd9\u4e2a\u4e24\u79cd\u7b56\u7565\u662f\u300c\u5f53\u6709\u6b7b\u9501\u53d1\u751f\u65f6\u300d\u7684\u907f\u514d\u65b9\u5f0f\u3002 \u6211\u4eec\u53ef\u4ee5\u56de\u5f52\u4e1a\u52a1\u7684\u89d2\u5ea6\u6765\u9884\u9632\u6b7b\u9501\uff0c\u5bf9\u8ba2\u5355\u505a\u5e42\u7b49\u6027\u6821\u9a8c\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06 order_no \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u552f\u4e00\u7d22\u5f15\u5217\uff0c\u5229\u7528\u5b83\u7684\u552f\u4e00\u6027\u6765\u4fdd\u8bc1\u8ba2\u5355\u8868\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u4e0d\u8fc7\u6709\u4e00\u70b9\u4e0d\u597d\u7684\u5730\u65b9\u5c31\u662f\u5728\u6211\u4eec\u63d2\u5165\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u8ba2\u5355\u8bb0\u5f55\u65f6\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\u3002 \u6700\u540e\u8bf4\u4e2a\u6bb5\u5b50\uff1a \u9762\u8bd5\u5b98: \u89e3\u91ca\u4e0b\u4ec0\u4e48\u662f\u6b7b\u9501? \u5e94\u8058\u8005: \u4f60\u5f55\u7528\u6211,\u6211\u5c31\u544a\u8bc9\u4f60 \u9762\u8bd5\u5b98: \u4f60\u544a\u8bc9\u6211,\u6211\u5c31\u5f55\u7528\u4f60 \u5e94\u8058\u8005: \u4f60\u5f55\u7528\u6211,\u6211\u5c31\u544a\u8bc9\u4f60 \u9762\u8bd5\u5b98: \u5367\u69fd\u6eda\uff01 ........... \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\uff1f\u300b http://mysql.taobao.org/monthly/2020/09/06/ \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f"},{"location":"mysql/lock/deadlock/#mysql","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u8bf4\u4e2a\u5f88\u65e9\u4e4b\u524d\u81ea\u5df1\u9047\u5230\u8fc7\u6570\u636e\u5e93\u6b7b\u9501\u95ee\u9898\u3002 \u6709\u4e2a\u4e1a\u52a1\u4e3b\u8981\u903b\u8f91\u5c31\u662f\u65b0\u589e\u8ba2\u5355\u3001\u4fee\u6539\u8ba2\u5355\u3001\u67e5\u8be2\u8ba2\u5355\u7b49\u64cd\u4f5c\u3002\u7136\u540e\u56e0\u4e3a\u8ba2\u5355\u662f\u4e0d\u80fd\u91cd\u590d\u7684\uff0c\u6240\u4ee5\u5f53\u65f6\u5728\u65b0\u589e\u8ba2\u5355\u7684\u65f6\u5019\u505a\u4e86\u5e42\u7b49\u6027\u6821\u9a8c\uff0c\u505a\u6cd5\u5c31\u662f\u5728\u65b0\u589e\u8ba2\u5355\u8bb0\u5f55\u4e4b\u524d\uff0c\u5148\u901a\u8fc7 select ... for update \u8bed\u53e5\u67e5\u8be2\u8ba2\u5355\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u624d\u63d2\u5165\u8ba2\u5355\u8bb0\u5f55\u3002 \u800c\u6b63\u662f\u56e0\u4e3a\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u5f53\u4e1a\u52a1\u91cf\u5f88\u5927\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002 \u63a5\u4e0b\u6765\u8ddf\u5927\u5bb6\u804a\u4e0b**\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff0c\u4ee5\u53ca\u600e\u4e48\u907f\u514d\u6b7b\u9501**\u3002","title":"MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f"},{"location":"mysql/lock/deadlock/#_1","text":"\u672c\u6b21\u6848\u4f8b\u4f7f\u7528\u5b58\u50a8\u5f15\u64ce Innodb\uff0c\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08RR\uff09\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u7528\u5b9e\u6218\u7684\u65b9\u5f0f\u6765\u5e26\u5927\u5bb6\u770b\u770b\u6b7b\u9501\u662f\u600e\u4e48\u53d1\u751f\u7684\u3002 \u6211\u5efa\u4e86\u4e00\u5f20\u8ba2\u5355\u8868\uff0c\u5176\u4e2d id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0corder_no \u5b57\u6bb5\u666e\u901a\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff1a CREATE TABLE ` t_order ` ( ` id ` int NOT NULL AUTO_INCREMENT , ` order_no ` int DEFAULT NULL , ` create_date ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` index_order ` ( ` order_no ` ) USING BTREE ) ENGINE = InnoDB ; \u7136\u540e\uff0c\u5148 t_order \u8868\u91cc\u73b0\u5728\u5df2\u7ecf\u6709\u4e86 6 \u6761\u8bb0\u5f55\uff1a \u5047\u8bbe\u8fd9\u65f6\u6709\u4e24\u4e8b\u52a1\uff0c\u4e00\u4e2a\u4e8b\u52a1\u8981\u63d2\u5165\u8ba2\u5355 1007 \uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u8981\u63d2\u5165\u8ba2\u5355 1008\uff0c\u56e0\u4e3a\u9700\u8981\u5bf9\u8ba2\u5355\u505a\u5e42\u7b49\u6027\u6821\u9a8c\uff0c\u6240\u4ee5\u4e24\u4e2a\u4e8b\u52a1\u5148\u8981\u67e5\u8be2\u8be5\u8ba2\u5355\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u624d\u63d2\u5165\u8bb0\u5f55\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u4e2a\u4e8b\u52a1\u90fd\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff08\u524d\u63d0\u6ca1\u6709\u6253\u5f00\u6b7b\u9501\u68c0\u6d4b\uff09\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u6b7b\u9501\uff0c\u56e0\u4e3a\u90fd\u5728\u76f8\u4e92\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u3002 \u8fd9\u91cc\u5728\u67e5\u8be2\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u4e86 select ... for update \u8bed\u53e5\uff0c\u76ee\u7684\u4e3a\u4e86\u9632\u6b62\u4e8b\u52a1\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u8bb0\u5f55\uff0c\u800c\u51fa\u73b0\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u5982\u679c\u6ca1\u6709\u4f7f\u7528 select ... for update \u8bed\u53e5\uff0c\u800c\u4f7f\u7528\u4e86\u5355\u7eaf\u7684 select \u8bed\u53e5\uff0c\u5982\u679c\u662f\u4e24\u4e2a\u8ba2\u5355\u53f7\u4e00\u6837\u7684\u8bf7\u6c42\u540c\u65f6\u8fdb\u6765\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e24\u4e2a\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u5e7b\u8bfb\uff0c\u5982\u4e0b\u56fe\uff1a","title":"\u6b7b\u9501\u7684\u53d1\u751f"},{"location":"mysql/lock/deadlock/#_2","text":"\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u662f\u5b58\u5728\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 Innodb \u5f15\u64ce\u4e3a\u4e86\u89e3\u51b3\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\u7684\u5e7b\u8bfb\u95ee\u9898\uff0c\u5c31\u5f15\u51fa\u4e86 next-key \u9501 \uff0c\u5b83\u662f\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7684\u7ec4\u5408\u3002 Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u9501\u7684\u662f\u8bb0\u5f55\u672c\u8eab\uff1b Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u7684\u5c31\u662f\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u7a7a\u9699\uff0c\u4ee5\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u7a7a\u9699\u95f4\u63d2\u5165\u65b0\u7684\u6570\u636e\uff0c\u4ece\u800c\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u3002 \u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u662f\u901a\u8fc7 MVCC \u7684\u673a\u5236\u5b9e\u73b0\u7684\u5feb\u7167\u8bfb\uff0c\u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff1a begin ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 select ... lock in share mode ; commit ; // \u9501\u91ca\u653e begin ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u6392\u4ed6\u9501 select ... for update ; commit ; // \u9501\u91ca\u653e \u884c\u9501\u7684\u91ca\u653e\u65f6\u673a\u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\uff08commit\uff09\u540e\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e\uff0c\u5e76\u4e0d\u662f\u4e00\u6761\u8bed\u53e5\u6267\u884c\u5b8c\u5c31\u91ca\u653e\u884c\u9501\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u4e8b\u52a1 A \u67e5\u8be2\u8bed\u53e5\u4f1a\u9501\u4f4f (2, +\u221e] \u8303\u56f4\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u671f\u95f4\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u9501\u4f4f\u7684\u8303\u56f4\u63d2\u5165\u6570\u636e\u5c31\u4f1a\u88ab\u963b\u585e\u3002 next-key \u9501\u7684\u52a0\u9501\u89c4\u5219\u5176\u5b9e\u633a\u590d\u6742\u7684\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501\uff0c\u6211\u4e4b\u524d\u4e5f\u5199\u4e00\u7bc7\u52a0\u9501\u89c4\u5219\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c update \u8bed\u53e5\u7684 where \u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u5728\u4e00\u884c\u884c\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4ec5\u7ed9\u884c\u8bb0\u5f55\u52a0\u4e0a\u4e86\u884c\u9501\uff0c\u8fd8\u7ed9\u884c\u8bb0\u5f55\u4e24\u8fb9\u7684\u7a7a\u9699\u4e5f\u52a0\u4e0a\u4e86\u95f4\u9699\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4f4f\u6574\u4e2a\u8868\uff0c\u7136\u540e\u76f4\u5230\u4e8b\u52a1\u7ed3\u675f\u624d\u4f1a\u91ca\u653e\u9501\u3002 \u6240\u4ee5\u5728\u7ebf\u4e0a\u5343\u4e07\u4e0d\u8981\u6267\u884c\u6ca1\u6709\u5e26\u7d22\u5f15\u6761\u4ef6\u7684 update \u8bed\u53e5\uff0c\u4e0d\u7136\u4f1a\u9020\u6210\u4e1a\u52a1\u505c\u6ede\uff0c\u6211\u6709\u4e2a\u8bfb\u8005\u5c31\u56e0\u4e3a\u5e72\u4e86\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u7136\u540e\u88ab\u8001\u677f\u6559\u80b2\u4e86\u4e00\u6ce2\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f \u56de\u5230\u524d\u9762\u6b7b\u9501\u7684\u4f8b\u5b50\u3002 \u4e8b\u52a1 A \u5728\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff1a select id from t_order where order_no = 1007 for update ; \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff0c\u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f X \u578b\u7684 next-key \u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f X \u578b\u7684\u8bb0\u5f55\u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f X \u578b\u7684\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e8c\u7ea7\u7d22\u5f15\uff08INDEX_NAME : index_order\uff09\u4e0a\u52a0\u7684\u662f X \u578b\u7684 next-key \u9501\uff0c\u9501\u8303\u56f4\u662f (1006, +\u221e] \u3002 next-key \u9501\u7684\u8303\u56f4 (1006, +\u221e]\uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f supremum pseudo-record\uff0c\u8868\u793a\u7684\u662f +\u221e\u3002\u7136\u540e\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u662f t_order \u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 index_order \u7684\u503c\uff0c\u4e5f\u5c31\u662f 1006\u3002\u56e0\u6b64\uff0cnext-key \u9501\u7684\u8303\u56f4 (1006, +\u221e]\u3002 ::: tip \u6709\u7684\u8bfb\u8005\u95ee\uff0c MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f \u8fd9\u7bc7\u6587\u7ae0\u8bb2\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u8bf4\u300c\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u65f6\uff0c\u52a0 next-key lock\uff0c\u7136\u540e\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\u300d\u3002\u4e3a\u4ec0\u4e48\u4e0a\u9762\u4e8b\u52a1 A \u7684 next-key lock \u5e76\u6ca1\u6709\u9000\u5316\u4e3a\u95f4\u9699\u9501\uff1f \u5982\u679c\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 order_no \u4e3a 1005\uff0c\u90a3\u4e48\u7b49\u503c\u67e5\u8be2 order_no = 1006\uff08\u4e0d\u5b58\u5728\uff09\uff0c\u5c31\u662f next key lock\uff0c\u5982\u4e0a\u9762\u4e8b\u52a1 A \u7684\u60c5\u51b5\u3002 \u5982\u679c\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 order_no \u4e3a 1010\uff0c\u90a3\u4e48\u7b49\u503c\u67e5\u8be2 order_no = 1006\uff08\u4e0d\u5b58\u5728\uff09\uff0c\u5c31\u662f\u95f4\u9699\u9501\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a ::: \u5f53\u4e8b\u52a1 B \u5f80\u4e8b\u52a1 A next-key \u9501\u7684\u8303\u56f4 (1006, +\u221e] \u91cc\u63d2\u5165 id = 1008 \u7684\u8bb0\u5f55\u5c31\u4f1a\u88ab\u9501\u4f4f\uff1a Insert into t_order ( order_no , create_date ) values ( 1008 , now ()); \u56e0\u4e3a\u5f53\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u63d2\u5165\u8bed\u53e5\u65f6\uff0c\u4f1a\u5728\u63d2\u5165\u95f4\u9699\u4e0a\u83b7\u53d6\u63d2\u5165\u610f\u5411\u9501\uff0c \u800c\u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5f53\u5176\u5b83\u4e8b\u52a1\u6301\u6709\u8be5\u95f4\u9699\u7684\u95f4\u9699\u9501\u65f6\uff0c\u9700\u8981\u7b49\u5f85\u5176\u5b83\u4e8b\u52a1\u91ca\u653e\u95f4\u9699\u9501\u4e4b\u540e\uff0c\u624d\u80fd\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\u3002\u800c\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u6240\u4ee5\u6240\u4ee5\u4e24\u4e2a\u4e8b\u52a1\u4e2d select ... for update \u8bed\u53e5\u5e76\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd \u3002 \u6848\u4f8b\u4e2d\u7684\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u5728\u6267\u884c\u5b8c\u540e select ... for update \u8bed\u53e5\u540e\u90fd\u6301\u6709\u8303\u56f4\u4e3a (1006,+\u221e] \u7684next-key \u9501\uff0c\u800c\u63a5\u4e0b\u6765\u7684\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u5bfc\u81f4\u6b7b\u9501\u3002 \u4e3a\u4ec0\u4e48\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff1f \u5728MySQL\u5b98\u7f51\u4e0a\u8fd8\u6709\u4e00\u6bb5\u975e\u5e38\u5173\u952e\u7684\u63cf\u8ff0\uff1a Gap locks in InnoDB are \u201cpurely inhibitive\u201d, which means that their only purpose is to prevent other transactions from Inserting to the gap. Gap locks can co-exist. A gap lock taken by one transaction does not prevent another transaction from taking a gap lock on the same gap. There is no difference between shared and exclusive gap locks. They do not conflict with each other, and they perform the same function. \u95f4\u9699\u9501\u7684\u610f\u4e49\u53ea\u5728\u4e8e\u963b\u6b62\u533a\u95f4\u88ab\u63d2\u5165 \uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u5171\u5b58\u7684\u3002 \u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u7684\u95f4\u9699\u9501\u4e0d\u4f1a\u963b\u6b62\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u540c\u4e00\u4e2a\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501 \uff0c\u5171\u4eab\u548c\u6392\u4ed6\u7684\u95f4\u9699\u9501\u662f\u6ca1\u6709\u533a\u522b\u7684\uff0c\u4ed6\u4eec\u76f8\u4e92\u4e0d\u51b2\u7a81\uff0c\u4e14\u529f\u80fd\u76f8\u540c\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u7684\u95f4\u9699\u9501\u3002 \u8fd9\u91cc\u7684\u5171\u540c\u95f4\u9699\u5305\u62ec\u4e24\u79cd\u573a\u666f\uff1a \u5176\u4e00\u662f\u4e24\u4e2a\u95f4\u9699\u9501\u7684\u95f4\u9699\u533a\u95f4\u5b8c\u5168\u4e00\u6837\uff1b \u5176\u4e8c\u662f\u4e00\u4e2a\u95f4\u9699\u9501\u5305\u542b\u7684\u95f4\u9699\u533a\u95f4\u662f\u53e6\u4e00\u4e2a\u95f4\u9699\u9501\u5305\u542b\u95f4\u9699\u533a\u95f4\u7684\u5b50\u96c6\u3002 \u4f46\u662f\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684 \u3002 \u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\u3002X \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6bd4\u5982\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86 select ... where id = 1 for update\uff0c\u540e\u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u7684\u3002 \u4f46\u662f\u8fd8\u8981\u6ce8\u610f\uff01\u5bf9\u4e8e\u8fd9\u79cd\u8303\u56f4\u4e3a (1006, +\u221e] \u7684 next-key lock\uff0c\u4e24\u4e2a\u4e8b\u52a1\u662f\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u7684\uff0c\u4e0d\u4f1a\u51b2\u7a81\u3002\u56e0\u4e3a +\u221e \u5e76\u4e0d\u662f\u4e00\u4e2a\u771f\u5b9e\u7684\u8bb0\u5f55\uff0c\u81ea\u7136\u5c31\u4e0d\u9700\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\u3002 \u63d2\u5165\u610f\u5411\u9501\u662f\u4ec0\u4e48\uff1f \u6ce8\u610f\uff01\u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u867d\u7136\u6709\u610f\u5411\u9501\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u5728MySQL\u7684\u5b98\u65b9\u6587\u6863\u4e2d\u6709\u4ee5\u4e0b\u91cd\u8981\u63cf\u8ff0\uff1a An Insert intention lock is a type of gap lock set by Insert operations prior to row Insertion. This lock signals the intent to Insert in such a way that multiple transactions Inserting into the same index gap need not wait for each other if they are not Inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to Insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with Insert intention locks prior to obtaining the exclusive lock on the Inserted row, but do not block each other because the rows are nonconflicting. \u8fd9\u6bb5\u8bdd\u8868\u660e\u5c3d\u7ba1**\u63d2\u5165\u610f\u5411\u9501\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u4f46\u4e0d\u540c\u4e8e\u95f4\u9699\u9501\u7684\u662f\uff0c\u8be5\u9501\u53ea\u7528\u4e8e\u5e76\u53d1\u63d2\u5165\u64cd\u4f5c**\u3002 \u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a\u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002 \u53e6\u5916\uff0c\u6211\u8865\u5145\u4e00\u70b9\uff0c\u63d2\u5165\u610f\u5411\u9501\u7684\u751f\u6210\u65f6\u673a\uff1a \u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002","title":"\u4e3a\u4ec0\u4e48\u4f1a\u4ea7\u751f\u6b7b\u9501\uff1f"},{"location":"mysql/lock/deadlock/#insert","text":"Insert \u8bed\u53e5\u5728\u6b63\u5e38\u6267\u884c\u65f6\u662f\u4e0d\u4f1a\u751f\u6210\u9501\u7ed3\u6784\u7684\uff0c\u5b83\u662f\u9760\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u81ea\u5e26\u7684 trx_id \u9690\u85cf\u5217\u6765\u4f5c\u4e3a**\u9690\u5f0f\u9501**\u6765\u4fdd\u62a4\u8bb0\u5f55\u7684\u3002 \u4ec0\u4e48\u662f\u9690\u5f0f\u9501\uff1f \u5f53\u4e8b\u52a1\u9700\u8981\u52a0\u9501\u7684\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a\u9501\u4e0d\u53ef\u80fd\u53d1\u751f\u51b2\u7a81\uff0cInnoDB\u4f1a\u8df3\u8fc7\u52a0\u9501\u73af\u8282\uff0c\u8fd9\u79cd\u673a\u5236\u79f0\u4e3a\u9690\u5f0f\u9501\u3002\u9690\u5f0f\u9501\u662f InnoDB \u5b9e\u73b0\u7684\u4e00\u79cd\u5ef6\u8fdf\u52a0\u9501\u673a\u5236\uff0c\u5176\u7279\u70b9\u662f\u53ea\u6709\u5728\u53ef\u80fd\u53d1\u751f\u51b2\u7a81\u65f6\u624d\u52a0\u9501\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u9501\u7684\u6570\u91cf\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u6574\u4f53\u6027\u80fd\u3002 \u9690\u5f0f\u9501\u5c31\u662f\u5728 Insert \u8fc7\u7a0b\u4e2d\u4e0d\u52a0\u9501\uff0c\u53ea\u6709\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u5c06\u9690\u5f0f\u9501\u8f6c\u6362\u4e3a\u663e\u793a\u9501\uff0c\u8fd9\u91cc\u6211\u4eec\u5217\u4e3e\u4e24\u4e2a\u573a\u666f\u3002 \u5982\u679c\u8bb0\u5f55\u4e4b\u95f4\u52a0\u6709\u95f4\u9699\u9501\uff0c\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\uff0c\u6b64\u65f6\u662f\u4e0d\u80fd\u63d2\u5165\u8bb0\u5f55\u7684\uff1b \u5982\u679c Insert \u7684\u8bb0\u5f55\u548c\u5df2\u6709\u8bb0\u5f55\u5b58\u5728\u552f\u4e00\u952e\u51b2\u7a81\uff0c\u6b64\u65f6\u4e5f\u4e0d\u80fd\u63d2\u5165\u8bb0\u5f55\uff1b","title":"Insert \u8bed\u53e5\u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f"},{"location":"mysql/lock/deadlock/#1","text":"\u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u73b0\u5728 t_order \u8868\u4e2d\uff0c\u53ea\u6709\u8fd9\u4e9b\u6570\u636e\uff0c order_no \u662f\u4e8c\u7ea7\u7d22\u5f15 \u3002 \u73b0\u5728\uff0c\u4e8b\u52a1 A \u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u3002 # \u4e8b\u52a1 A mysql > begin ; Query OK , 0 rows affected ( 0 . 01 sec ) mysql > select * from t_order where order_no = 1006 for update ; Empty set ( 0 . 01 sec ) \u63a5\u7740\uff0c\u6211\u4eec\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u672c\u6b21\u7684\u4f8b\u5b50\u52a0\u7684\u662f next-key \u9501\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\uff0c\u9501\u8303\u56f4\u662f \uff081005, +\u221e] \u3002 \u7136\u540e\uff0c\u6709\u4e2a\u4e8b\u52a1 B \u5728\u8fd9\u4e2a\u95f4\u9699\u9501\u4e2d\uff0c\u63d2\u5165\u4e86\u4e00\u4e2a\u8bb0\u5f55\uff0c\u90a3\u4e48\u6b64\u65f6\u8be5\u4e8b\u52a1 B \u5c31\u4f1a\u88ab\u963b\u585e\uff1a # \u4e8b\u52a1 B \u63d2\u5165\u4e00\u6761\u8bb0\u5f55 mysql > begin ; Query OK , 0 rows affected ( 0 . 01 sec ) mysql > insert into t_order ( order_no , create_date ) values ( 1010 , now ()); ### \u963b\u585e\u72b6\u6001\u3002\u3002\u3002\u3002 \u63a5\u7740\uff0c\u6211\u4eec\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1 B \u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 B \u7684\u72b6\u6001\u4e3a\u7b49\u5f85\u72b6\u6001\uff08LOCK_STATUS: WAITING\uff09\uff0c\u56e0\u4e3a\u5411\u4e8b\u52a1 A \u751f\u6210\u7684 next-key \u9501\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u8303\u56f4 \uff081005, +\u221e] \u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u7684\u63d2\u5165\u64cd\u4f5c\u751f\u6210\u4e86\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff08 LOCK_MODE: X,INSERT_INTENTION \uff09\uff0c\u9501\u7684\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u610f\u5473\u7740\u4e8b\u52a1 B \u5e76\u6ca1\u6709\u6210\u529f\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u56e0\u6b64\u4e8b\u52a1 B \u53d1\u751f\u963b\u585e\u3002","title":"1\u3001\u8bb0\u5f55\u4e4b\u95f4\u52a0\u6709\u95f4\u9699\u9501"},{"location":"mysql/lock/deadlock/#2","text":"\u5982\u679c\u5728\u63d2\u5165\u65b0\u8bb0\u5f55\u65f6\uff0c\u63d2\u5165\u4e86\u4e00\u4e2a\u4e0e\u300c\u5df2\u6709\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\u76f8\u540c\u300d\u7684\u8bb0\u5f55\uff08\u4e0d\u8fc7\u53ef\u4ee5\u6709\u591a\u6761\u8bb0\u5f55\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u7684\u503c\u540c\u65f6\u4e3aNULL\uff0c\u8fd9\u91cc\u4e0d\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\uff09\uff0c\u6b64\u65f6\u63d2\u5165\u5c31\u4f1a\u5931\u8d25\uff0c\u7136\u540e\u5bf9\u4e8e\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684\u9501 \u3002 \u81f3\u4e8e\u662f\u884c\u7ea7\u9501\u7684\u7c7b\u578b\u662f\u8bb0\u5f55\u9501\uff0c\u8fd8\u662f next-key \u9501\uff0c\u8ddf\u662f\u300c\u4e3b\u952e\u51b2\u7a81\u300d\u8fd8\u662f\u300c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81\u300d\u6709\u5173\u7cfb\u3002 \u5982\u679c\u4e3b\u952e\u7d22\u5f15\u91cd\u590d\uff1a \u5f53\u9694\u79bb\u7ea7\u522b\u4e3a**\u8bfb\u5df2\u63d0\u4ea4**\u65f6\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501**\u3002 \u5f53\u9694\u79bb\u7ea7\u522b\u662f**\u53ef\u91cd\u590d\u8bfb**\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501**\u3002 \u5982\u679c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u91cd\u590d\uff1a \u4e0d\u8bba\u662f\u54ea\u4e2a\u9694\u79bb\u7ea7\u522b \uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u90fd\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\u91cd\u590d\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b next-key \u9501**\u3002\u5bf9\u7684\uff0c\u6ca1\u9519\uff0c\u5373\u4f7f\u662f\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e5f\u662f\u52a0 next-key \u9501\uff0c\u8fd9\u662f\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e2d\u4e3a\u6570\u4e0d\u591a\u7684\u7ed9\u8bb0\u5f55\u6dfb\u52a0\u95f4\u9699\u9501\u7684\u573a\u666f\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u52a0 next-key \u9501\uff0c\u6211\u4e5f\u6ca1\u627e\u5230\u5408\u7406\u7684\u89e3\u91ca\u3002","title":"2\u3001\u9047\u5230\u552f\u4e00\u952e\u51b2\u7a81"},{"location":"mysql/lock/deadlock/#_3","text":"\u4e0b\u9762\u4e3e\u4e2a\u300c\u4e3b\u952e\u51b2\u7a81\u300d\u7684\u4f8b\u5b50\uff0cMySQL 8.0 \u7248\u672c\uff0c\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\u3002 t_order \u8868\u4e2d\u7684 id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0c\u5e76\u4e14\u5df2\u7ecf\u5b58\u5728 id \u503c\u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u6709\u4e2a\u4e8b\u52a1\uff0c\u63d2\u5165\u4e86\u4e00\u6761 id \u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u5c31\u4f1a\u62a5\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81\u7684\u9519\u8bef\u3002 \u4f46\u662f\u9664\u4e86\u62a5\u9519\u4e4b\u5916\uff0c\u8fd8\u505a\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5c31\u662f\u5bf9 id \u4e3a 5 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684\u8bb0\u5f55\u9501 \u3002 \u53ef\u4ee5\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5\uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e3b\u952e\u7d22\u5f15\u4e3a 5 \uff08LOCK_DATA\uff09\u7684\u8fd9\u6761\u8bb0\u5f55\u4e2d\u52a0\u4e86\u9501\u7c7b\u578b\u4e3a S \u578b\u7684\u8bb0\u5f55\u9501\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002\u5982\u679c\u662f S \u578b\u8bb0\u5f55\u9501\u7684\u8bdd\uff0cLOCK_MODE \u4f1a\u663e\u793a S, REC_NOT_GAP \u3002 \u6240\u4ee5\uff0c\u5728\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5728\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u53d1\u751f\u4e86\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55**\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501**\u3002","title":"\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81"},{"location":"mysql/lock/deadlock/#_4","text":"\u4e0b\u9762\u4e3e\u4e2a\u300c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81\u300d\u7684\u4f8b\u5b50\uff0cMySQL 8.0 \u7248\u672c\uff0c\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\u3002 t_order \u8868\u4e2d\u7684 order_no \u5b57\u6bb5\u4e3a\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5e76\u4e14\u5df2\u7ecf\u5b58\u5728 order_no \u503c\u4e3a 1001 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u4e8b\u52a1 A\uff0c\u63d2\u5165\u4e86 order_no \u4e3a 1001 \u7684\u8bb0\u5f55\uff0c\u5c31\u51fa\u73b0\u4e86\u62a5\u9519\u3002 \u4f46\u662f\u9664\u4e86\u62a5\u9519\u4e4b\u5916\uff0c\u8fd8\u505a\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5c31\u662f\u5bf9 order_no \u503c\u4e3a 1001 \u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684 next-key \u9501 \u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u53ef\u4ee5\u770b\u5230\uff0c index_order \u4e8c\u7ea7\u7d22\u5f15\u52a0\u4e86 S \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\u662f(-\u221e, 1001] \u3002\u6ce8\u610f\uff0c\u8fd9\u91cc LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002\u5982\u679c\u662f\u8bb0\u5f55\u9501\u7684\u8bdd\uff0cLOCK_MODE \u4f1a\u663e\u793a S, REC_NOT_GAP \u3002 \u6b64\u65f6\uff0c\u4e8b\u52a1 B \u6267\u884c\u4e86 select * from t_order where order_no = 1001 for update; \u5c31\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u8fd9\u6761\u8bed\u53e5\u60f3\u52a0 X \u578b\u7684\u9501\uff0c\u662f\u4e0e S \u578b\u7684\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u4ece performance_schema.data_locks \u8fd9\u4e2a\u8868\u4e2d\u770b\u5230\uff0c\u4e8b\u52a1 B \u7684\u72b6\u6001\uff08LOCK_STATUS\uff09\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u52a0\u9501\u7684\u7c7b\u578b X \u578b\u7684\u8bb0\u5f55\u9501\uff08LOCK_MODE: X,REC_NOT_GAP \uff09\u3002 \u4e0a\u9762\u7684\u6848\u4f8b\u662f\u9488\u5bf9\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u91cd\u590d\u800c\u63d2\u5165\u5931\u8d25\u7684\u573a\u666f\u3002 \u63a5\u4e0b\u6765\uff0c\u5206\u6790\u4e24\u4e2a\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u4e86\u76f8\u540c\u7684 insert \u8bed\u53e5\u7684\u573a\u666f\u3002 \u73b0\u5728 t_order \u8868\u4e2d\uff0c\u53ea\u6709\u8fd9\u4e9b\u6570\u636e\uff0c order_no \u4e3a\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15 \u3002 \u5728\u9694\u79bb\u7ea7\u522b\u53ef\u91cd\u590d\u8bfb\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u542f\u4e24\u4e2a\u4e8b\u52a1\uff0c\u524d\u540e\u6267\u884c\u76f8\u540c\u7684 Insert \u8bed\u53e5\uff0c\u6b64\u65f6**\u4e8b\u52a1 B \u7684 Insert \u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e**\u3002 \u4e24\u4e2a\u4e8b\u52a1\u7684\u52a0\u9501\u8fc7\u7a0b\uff1a \u4e8b\u52a1 A \u5148\u63d2\u5165 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u53ef\u4ee5\u63d2\u5165\u6210\u529f\uff0c\u6b64\u65f6\u5bf9\u5e94\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u88ab\u300c\u9690\u5f0f\u9501\u300d\u4fdd\u62a4\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u5b9e\u9645\u7684\u9501\u7ed3\u6784\uff08\u6267\u884c\u5b8c\u8fd9\u91cc\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u770b\u67e5 performance_schema.data_locks \u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u6761\u8bb0\u5f55\u662f\u6ca1\u6709\u52a0\u4efb\u4f55\u9501\u7684\uff09\uff1b \u63a5\u7740\uff0c\u4e8b\u52a1 B \u4e5f\u63d2\u5165 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u5df2\u7ecf\u63d2\u5165 order_no \u503c\u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u63d2\u5165\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u65f6\u4f1a\u9047\u5230\u91cd\u590d\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u60f3\u83b7\u53d6\u4e00\u4e2a S \u578b next-key \u9501\uff0c\u4f46\u662f\u4e8b\u52a1 A \u5e76\u672a\u63d0\u4ea4\uff0c \u4e8b\u52a1 A \u63d2\u5165\u7684 order_no \u503c\u4e3a 1006 \u7684\u8bb0\u5f55\u4e0a\u7684\u300c\u9690\u5f0f\u9501\u300d\u4f1a\u53d8\u300c\u663e\u793a\u9501\u300d\u4e14\u9501\u7c7b\u578b\u4e3a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5411\u83b7\u53d6 S \u578b next-key \u9501\u65f6\u4f1a\u9047\u5230\u9501\u51b2\u7a81\uff0c\u4e8b\u52a1 B \u8fdb\u5165\u963b\u585e\u72b6\u6001 \u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c select * from performance_schema.data_locks\\G; \u8bed\u53e5 \uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002 \u5148\u770b\u4e8b\u52a1 A \u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0\u4e86\u4ec0\u4e48\u9501\uff1f \u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c \u4e8b\u52a1 A \u5bf9 order_no \u4e3a 1006 \u8bb0\u5f55\u52a0\u4e0a\u4e86\u7c7b\u578b\u4e3a X \u578b\u7684\u8bb0\u5f55\u9501 \uff08 \u6ce8\u610f\uff0c\u8fd9\u4e2a\u662f\u5728\u6267\u884c\u4e8b\u52a1 B \u4e4b\u540e\u624d\u4ea7\u751f\u7684\u9501\uff0c\u6ca1\u6267\u884c\u4e8b\u52a1 B \u4e4b\u524d\uff0c\u8be5\u8bb0\u5f55\u8fd8\u662f\u9690\u5f0f\u9501 \uff09\u3002 \u7136\u540e\u770b\u4e8b\u52a1 B \u60f3\u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0\u4ec0\u4e48\u9501\uff1f \u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c \u4e8b\u52a1 B \u60f3\u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0 S \u578b\u7684 next-key \u9501\uff0c\u4f46\u662f\u7531\u4e8e\u4e8b\u52a1 A \u5728\u8be5\u8bb0\u5f55\u4e0a\u6301\u6709\u4e86 X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u8fd9\u4e24\u4e2a\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e8b\u52a1 B \u5904\u4e8e\u7b49\u5f85\u72b6\u6001 \u3002 \u4ece\u8fd9\u4e2a\u5b9e\u9a8c\u53ef\u4ee5\u5f97\u77e5\uff0c\u5e76\u53d1\u591a\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u5e76\u4e0d\u4f1a\u52a0\u9501\uff0c\u800c\u662f\u4f1a\u7528\u9690\u5f0f\u9501\u4fdd\u62a4\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u7684\u8bb0\u5f55\u3002 \u4f46\u662f\u5f53\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u672a\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e0e\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u5c31\u4f1a**\u88ab\u963b\u585e**\uff0c \u56e0\u4e3a\u6b64\u65f6\u7b2c\u4e00\u4e8b\u52a1\u63d2\u5165\u7684\u8bb0\u5f55\u4e2d\u7684\u9690\u5f0f\u9501\u4f1a\u53d8\u4e3a\u663e\u793a\u9501\u4e14\u7c7b\u578b\u662f X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u800c\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u662f\u60f3\u5bf9\u8be5\u8bb0\u5f55\u52a0\u4e0a S \u578b\u7684 next-key \u9501\uff0cX \u578b\u4e0e S \u578b\u7684\u9501\u662f\u51b2\u7a81\u7684 \uff0c\u6240\u4ee5\u5bfc\u81f4\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u4f1a\u7b49\u5f85\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0c\u91ca\u653e\u4e86\u9501\u3002 \u5982\u679c order_no \u4e0d\u662f\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u4e24\u4e2a\u4e8b\u52a1\uff0c\u524d\u540e\u6267\u884c\u76f8\u540c\u7684 Insert \u8bed\u53e5\uff0c\u662f\u4e0d\u4f1a\u53d1\u751f\u963b\u585e\u7684\uff0c\u5c31\u5982\u524d\u9762\u7684\u8fd9\u4e2a\u4f8b\u5b50\u3002","title":"\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81"},{"location":"mysql/lock/deadlock/#_5","text":"\u6b7b\u9501\u7684\u56db\u4e2a\u5fc5\u8981\u6761\u4ef6\uff1a \u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85 \u3002\u53ea\u8981\u7cfb\u7edf\u53d1\u751f\u6b7b\u9501\uff0c\u8fd9\u4e9b\u6761\u4ef6\u5fc5\u7136\u6210\u7acb\uff0c\u4f46\u662f\u53ea\u8981\u7834\u574f\u4efb\u610f\u4e00\u4e2a\u6761\u4ef6\u5c31\u6b7b\u9501\u5c31\u4e0d\u4f1a\u6210\u7acb\u3002 \u5728\u6570\u636e\u5e93\u5c42\u9762\uff0c\u6709\u4e24\u79cd\u7b56\u7565\u901a\u8fc7\u300c\u6253\u7834\u5faa\u73af\u7b49\u5f85\u6761\u4ef6\u300d\u6765\u89e3\u9664\u6b7b\u9501\u72b6\u6001\uff1a \u8bbe\u7f6e\u4e8b\u52a1\u7b49\u5f85\u9501\u7684\u8d85\u65f6\u65f6\u95f4 \u3002\u5f53\u4e00\u4e2a\u4e8b\u52a1\u7684\u7b49\u5f85\u65f6\u95f4\u8d85\u8fc7\u8be5\u503c\u540e\uff0c\u5c31\u5bf9\u8fd9\u4e2a\u4e8b\u52a1\u8fdb\u884c\u56de\u6eda\uff0c\u4e8e\u662f\u9501\u5c31\u91ca\u653e\u4e86\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u4e86\u3002\u5728 InnoDB \u4e2d\uff0c\u53c2\u6570 innodb_lock_wait_timeout \u662f\u7528\u6765\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u7684\uff0c\u9ed8\u8ba4\u503c\u65f6 50 \u79d2\u3002 \u5f53\u53d1\u751f\u8d85\u65f6\u540e\uff0c\u5c31\u51fa\u73b0\u4e0b\u9762\u8fd9\u4e2a\u63d0\u793a\uff1a \u5f00\u542f\u4e3b\u52a8\u6b7b\u9501\u68c0\u6d4b \u3002\u4e3b\u52a8\u6b7b\u9501\u68c0\u6d4b\u5728\u53d1\u73b0\u6b7b\u9501\u540e\uff0c\u4e3b\u52a8\u56de\u6eda\u6b7b\u9501\u94fe\u6761\u4e2d\u7684\u67d0\u4e00\u4e2a\u4e8b\u52a1\uff0c\u8ba9\u5176\u4ed6\u4e8b\u52a1\u5f97\u4ee5\u7ee7\u7eed\u6267\u884c\u3002\u5c06\u53c2\u6570 innodb_deadlock_detect \u8bbe\u7f6e\u4e3a on\uff0c\u8868\u793a\u5f00\u542f\u8fd9\u4e2a\u903b\u8f91\uff0c\u9ed8\u8ba4\u5c31\u5f00\u542f\u3002 \u5f53\u68c0\u6d4b\u5230\u6b7b\u9501\u540e\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0b\u9762\u8fd9\u4e2a\u63d0\u793a\uff1a \u4e0a\u9762\u8fd9\u4e2a\u4e24\u79cd\u7b56\u7565\u662f\u300c\u5f53\u6709\u6b7b\u9501\u53d1\u751f\u65f6\u300d\u7684\u907f\u514d\u65b9\u5f0f\u3002 \u6211\u4eec\u53ef\u4ee5\u56de\u5f52\u4e1a\u52a1\u7684\u89d2\u5ea6\u6765\u9884\u9632\u6b7b\u9501\uff0c\u5bf9\u8ba2\u5355\u505a\u5e42\u7b49\u6027\u6821\u9a8c\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06 order_no \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u552f\u4e00\u7d22\u5f15\u5217\uff0c\u5229\u7528\u5b83\u7684\u552f\u4e00\u6027\u6765\u4fdd\u8bc1\u8ba2\u5355\u8868\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u4e0d\u8fc7\u6709\u4e00\u70b9\u4e0d\u597d\u7684\u5730\u65b9\u5c31\u662f\u5728\u6211\u4eec\u63d2\u5165\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u8ba2\u5355\u8bb0\u5f55\u65f6\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\u3002 \u6700\u540e\u8bf4\u4e2a\u6bb5\u5b50\uff1a \u9762\u8bd5\u5b98: \u89e3\u91ca\u4e0b\u4ec0\u4e48\u662f\u6b7b\u9501? \u5e94\u8058\u8005: \u4f60\u5f55\u7528\u6211,\u6211\u5c31\u544a\u8bc9\u4f60 \u9762\u8bd5\u5b98: \u4f60\u544a\u8bc9\u6211,\u6211\u5c31\u5f55\u7528\u4f60 \u5e94\u8058\u8005: \u4f60\u5f55\u7528\u6211,\u6211\u5c31\u544a\u8bc9\u4f60 \u9762\u8bd5\u5b98: \u5367\u69fd\u6eda\uff01 ........... \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\uff1f\u300b http://mysql.taobao.org/monthly/2020/09/06/ \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u5982\u4f55\u907f\u514d\u6b7b\u9501\uff1f"},{"location":"mysql/lock/how_to_lock/","text":"MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u662f\u4e0d\u662f\u5f88\u591a\u4eba\u90fd\u5bf9 MySQL \u52a0\u884c\u7ea7\u9501\u7684\u89c4\u5219\u641e\u7684\u8ff7\u8ff7\u7cca\u7cca\uff0c\u5bf9\u8bb0\u5f55\u4e00\u4f1a\u52a0\u7684\u662f next-key \u9501\uff0c\u4e00\u4f1a\u52a0\u662f\u95f4\u9699\u9501\uff0c\u4e00\u4f1a\u53c8\u662f\u8bb0\u5f55\u9501\u3002 \u5766\u767d\u8bf4\uff0c\u786e\u5b9e\u8fd8\u633a\u590d\u6742\u7684\uff0c\u4f46\u662f\u597d\u5728\u6211\u627e\u70b9\u4e86\u70b9\u89c4\u5f8b\uff0c\u4e5f\u77e5\u9053\u5982\u4f55\u5982\u4f55\u7528\u547d\u4ee4\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u884c\u7ea7\u9501\u3002 \u4e4b\u524d\u6211\u5199\u8fc7\u4e00\u7bc7\u5173\u4e8e\u300cMySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f\u300d\u7684\u6587\u7ae0\uff0c\u968f\u7740\u6211\u5199 MySQL \u9501\u76f8\u5173\u7684\u6587\u7ae0\u8d8a\u6765\u8d8a\u591a\u65f6\uff0c\u540e\u6765\u53d1\u73b0\u5f53\u65f6\u7684\u6587\u7ae0\u5199\u7684\u4e0d\u591f\u8be6\u7ec6\u3002 \u4e3a\u4e86\u8ba9\u5927\u5bb6\u5f88\u6e05\u695a\u7684\u77e5\u9053 MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff0c\u4ee5\u53ca\u5982\u4f55\u7528\u547d\u4ee4\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u884c\u7ea7\u9501\uff0c\u518d\u52a0\u4e0a\u4e3a\u4e86\u89e3\u91ca\u6e05\u695a\u4e3a\u4ec0\u4e48 MySQL \u8981\u8fd9\u4e48\u52a0\u884c\u7ea7\u9501\uff0c\u6240\u4ee5**\u6211\u91cd\u5199\u4e86\u8fd9\u7bc7\u6587\u7ae0**\u3002 \u8fd9\u4e00\u91cd\u5199\uff0c\u5c31\u591a\u589e\u52a0\u4e86 1W \u591a\u5b57 + 30 \u5f20\u56fe\uff0c\u6240\u4ee5\u5168\u5b8c\u7b97\u662f\u65b0\u7684\u6587\u7ae0\u4e86\u3002 \u6587\u7ae0\u5185\u5bb9\u6bd4\u8f83\u957f\uff0c\u5927\u5bb6\u53ef\u4ee5\u8010\u5fc3\u770b\u4e0b\u53bb\uff0c\u770b\u5b8c\u4e4b\u540e\u4f60\u4f1a\u6709\u4e00\u79cd\u7a81\u7136\u88ab\u987f\u609f\u7684\u611f\u89c9\uff0c\u56e0\u4e3a\u6211\u81ea\u5df1\u5199\u5b8c\u8fd9\u7bc7\u6587\u7ae0\u540e\uff0c\u81ea\u5df1\u4e5f\u88ab\u81ea\u5df1\u987f\u609f\u4e86\u3002 \u4ec0\u4e48 SQL \u8bed\u53e5\u4f1a\u52a0\u884c\u7ea7\u9501\uff1f \u00b6 InnoDB \u5f15\u64ce\u662f\u652f\u6301\u884c\u7ea7\u9501\u7684\uff0c\u800c MyISAM \u5f15\u64ce\u5e76\u4e0d\u652f\u6301\u884c\u7ea7\u9501\uff0c\u6240\u4ee5\u540e\u9762\u7684\u5185\u5bb9\u90fd\u662f\u57fa\u4e8e InnoDB \u5f15\u64ce \u7684\u3002 \u6240\u4ee5\uff0c\u5728\u8bf4 MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u662f\u5728\u8bf4 InnoDB \u5f15\u64ce\u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\u3002 \u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u5feb\u7167\u8bfb\uff0c\u662f\u901a\u8fc7 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5b9e\u73b0\u7684\u3002 \u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u7ea7\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff0c\u8fd9\u4e24\u79cd\u67e5\u8be2\u4f1a\u52a0\u9501\u7684\u8bed\u53e5\u79f0\u4e3a**\u9501\u5b9a\u8bfb**\u3002 // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 ( S\u578b\u9501 ) select ... lock in share mode ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 ( X\u578b\u9501 ) select ... for update ; \u4e0a\u9762\u8fd9\u4e24\u6761\u8bed\u53e5\u5fc5\u987b\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c \u56e0\u4e3a\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e86\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e \uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u8fd9\u4e24\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u8981\u52a0\u4e0a begin \u6216\u8005 start transaction \u5f00\u542f\u4e8b\u52a1\u7684\u8bed\u53e5\u3002 \u9664\u4e86\u4e0a\u9762\u8fd9\u4e24\u6761\u9501\u5b9a\u8bfb\u8bed\u53e5\u4f1a\u52a0\u884c\u7ea7\u9501\u4e4b\u5916\uff0cupdate \u548c delete \u64cd\u4f5c\u90fd\u4f1a\u52a0\u884c\u7ea7\u9501\uff0c\u4e14\u9501\u7684\u7c7b\u578b\u90fd\u662f\u72ec\u5360\u9501(X\u578b\u9501) \u3002 // \u5bf9\u64cd\u4f5c\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 ( X\u578b\u9501 ) update table .... where id = 1 ; // \u5bf9\u64cd\u4f5c\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 ( X\u578b\u9501 ) delete from table where id = 1 ; \u5171\u4eab\u9501\uff08S\u9501\uff09\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\uff0c\u8bfb\u5199\u4e92\u65a5\u3002\u72ec\u5360\u9501\uff08X\u9501\uff09\u6ee1\u8db3\u5199\u5199\u4e92\u65a5\u3001\u8bfb\u5199\u4e92\u65a5\u3002 \u884c\u7ea7\u9501\u6709\u54ea\u4e9b\u79cd\u7c7b\uff1f \u00b6 \u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u662f\u4e0d\u540c\u7684\u3002 \u5728\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u53ea\u6709\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\u3002 \u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u9664\u4e86\u6709\u8bb0\u5f55\u9501\uff0c\u8fd8\u6709\u95f4\u9699\u9501\uff08\u76ee\u7684\u662f\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\uff09\uff0c\u6240\u4ee5\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u4e3b\u8981\u6709\u4e09\u7c7b\uff1a Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\uff1b Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u4f46\u662f\u4e0d\u5305\u542b\u8bb0\u5f55\u672c\u8eab\uff1b Next-Key Lock\uff1aRecord Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002 \u63a5\u4e0b\u6765\uff0c\u5206\u522b\u4ecb\u7ecd\u8fd9\u4e09\u79cd\u884c\u7ea7\u9501\u3002 Record Lock \u00b6 Record Lock \u79f0\u4e3a\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u662f\u4e00\u6761\u8bb0\u5f55\u3002\u800c\u4e14\u8bb0\u5f55\u9501\u662f\u6709 S \u9501\u548c X \u9501\u4e4b\u5206\u7684\uff1a \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 S \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e S \u9501\u517c\u5bb9\uff09\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09; \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 X \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e2\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08X \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a mysql > begin ; mysql > select * from t_test where id = 1 for update ; \u4e8b\u52a1\u4f1a\u5bf9\u8868\u4e2d\u4e3b\u952e id = 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u5982\u679c\u8fd9\u65f6\u5019\u5176\u4ed6\u4e8b\u52a1\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u5220\u9664\u6216\u8005\u66f4\u65b0\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u88ab\u963b\u585e\u3002\u6ce8\u610f\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 id = 1 \u7684\u65b0\u8bb0\u5f55\u5e76\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u800c\u662f\u4f1a\u62a5\u4e3b\u952e\u51b2\u7a81\u7684\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3a\u4e3b\u952e\u6709\u552f\u4e00\u6027\u7684\u7ea6\u675f\u3002 \u5f53\u4e8b\u52a1\u6267\u884c commit \u540e\uff0c\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u751f\u6210\u7684\u9501\u90fd\u4f1a\u88ab\u91ca\u653e\u3002 Gap Lock \u00b6 Gap Lock \u79f0\u4e3a\u95f4\u9699\u9501\uff0c\u53ea\u5b58\u5728\u4e8e\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u95f4\u9699\u9501\u867d\u7136\u5b58\u5728 X \u578b\u95f4\u9699\u9501\u548c S \u578b\u95f4\u9699\u9501\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c \u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5e76\u4e0d\u5b58\u5728\u4e92\u65a5\u5173\u7cfb\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u7684\u76ee\u7684\u662f\u9632\u6b62\u63d2\u5165\u5e7b\u5f71\u8bb0\u5f55\u800c\u63d0\u51fa\u7684 \u3002 Next-Key Lock \u00b6 Next-Key Lock \u79f0\u4e3a\u4e34\u952e\u9501\uff0c\u662f Record Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5] \u7684 next-key lock\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5373\u4e0d\u80fd\u63d2\u5165 id = 4 \u8bb0\u5f55\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539\u548c\u5220\u9664 id = 5 \u8fd9\u6761\u8bb0\u5f55\u3002 \u6240\u4ee5\uff0cnext-key lock \u5373\u80fd\u4fdd\u62a4\u8be5\u8bb0\u5f55\uff0c\u53c8\u80fd\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u5c06\u65b0\u8bb0\u5f55\u63d2\u5165\u5230\u88ab\u4fdd\u62a4\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u4e2d\u3002 next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684 \u3002 \u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\uff0cX \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\u3002 MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f \u00b6 \u884c\u7ea7\u9501\u52a0\u9501\u89c4\u5219\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u540c\u7684\u573a\u666f\uff0c\u52a0\u9501\u7684\u5f62\u5f0f\u662f\u4e0d\u540c\u7684\u3002 \u52a0\u9501\u7684\u5bf9\u8c61\u662f\u7d22\u5f15\uff0c\u52a0\u9501\u7684\u57fa\u672c\u5355\u4f4d\u662f next-key lock \uff0c\u5b83\u662f\u7531\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7ec4\u5408\u800c\u6210\u7684\uff0c next-key lock \u662f\u524d\u5f00\u540e\u95ed\u533a\u95f4\uff0c\u800c\u95f4\u9699\u9501\u662f\u524d\u5f00\u540e\u5f00\u533a\u95f4 \u3002 \u4f46\u662f\uff0cnext-key lock \u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501\u3002 \u90a3\u5230\u5e95\u662f\u4ec0\u4e48\u573a\u666f\u5462\uff1f\u603b\u7ed3\u4e00\u53e5\uff0c \u5728\u80fd\u4f7f\u7528\u8bb0\u5f55\u9501\u6216\u8005\u95f4\u9699\u9501\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f\u4e0b\uff0c next-key lock \u5c31\u4f1a\u9000\u5316\u6210\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501 \u3002 \u8fd9\u6b21\u4f1a\u4ee5\u4e0b\u9762\u8fd9\u4e2a\u8868\u7ed3\u6784\u6765\u8fdb\u884c\u5b9e\u9a8c\u8bf4\u660e\uff1a CREATE TABLE ` user ` ( ` id ` bigint NOT NULL AUTO_INCREMENT , ` name ` varchar ( 30 ) COLLATE utf8mb4_unicode_ci NOT NULL , ` age ` int NOT NULL , PRIMARY KEY ( ` id ` ), KEY ` index_age ` ( ` age ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ; \u5176\u4e2d\uff0cid \u662f\u4e3b\u952e\u7d22\u5f15\uff08\u552f\u4e00\u7d22\u5f15\uff09\uff0cage \u662f\u666e\u901a\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\uff0cname \u662f\u666e\u901a\u7684\u5217\u3002 \u8868\u4e2d\u7684\u6709\u8fd9\u4e9b\u884c\u8bb0\u5f55\uff1a \u8fd9\u6b21\u5b9e\u9a8c\u73af\u5883\u7684 MySQL \u7248\u672c\u662f 8.0.26\uff0c\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d \u3002 \u4e0d\u540c\u7248\u672c\u7684\u52a0\u9501\u89c4\u5219\u53ef\u80fd\u662f\u4e0d\u540c\u7684\uff0c\u4f46\u662f\u5927\u4f53\u4e0a\u662f\u76f8\u540c\u7684\u3002 \u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2 \u00b6 \u5f53\u6211\u4eec\u7528\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u5b58\u4e0d\u5b58\u5728\uff0c\u52a0\u9501\u7684\u89c4\u5219\u4e5f\u4f1a\u4e0d\u540c\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u8fd9\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u8bb0\u5f55\u9501\u300d**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d**\u3002 \u63a5\u4e0b\u91cc\u7528\u4e24\u4e2a\u6848\u4f8b\u6765\u8bf4\u660e\u3002 1\u3001\u8bb0\u5f55\u5b58\u5728\u7684\u60c5\u51b5 \u00b6 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u7b49\u503c\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u4e8e\u8868\u4e2d\u7684\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id = 1 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 1 | \u8def\u98de | 19 | + ----+--------+-----+ 1 row in set ( 0 . 02 sec ) \u90a3\u4e48\uff0c\u4e8b\u52a1 A \u4f1a\u4e3a id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u5c31\u4f1a\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501 \u3002 \u63a5\u4e0b\u6765\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\uff0c\u5bf9 id \u4e3a 1 \u7684\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u6216\u8005\u5220\u9664\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u66f4\u65b0\u6216\u8005\u5220\u9664\u64cd\u4f5c\u4e5f\u4f1a\u5bf9\u8bb0\u5f55\u52a0 X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u800c X \u9501\u548c X \u9501\u4e4b\u95f4\u662f\u4e92\u65a5\u5173\u7cfb\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a \u56e0\u4e3a\u4e8b\u52a1 A \u5bf9 id = 1\u7684\u8bb0\u5f55\u52a0\u4e86 X \u578b\u7684\u8bb0\u5f55\u9501 \uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u4fee\u6539 id=1 \u7684\u8bb0\u5f55\u65f6\u4f1a\u88ab\u963b\u585e\uff0c\u4e8b\u52a1 C \u5728\u5220\u9664 id=1 \u7684\u8bb0\u5f55\u65f6\u4e5f\u4f1a\u88ab\u963b\u585e\u3002 \u6709\u4ec0\u4e48\u547d\u4ee4\u53ef\u4ee5\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u9501\uff1f \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u6211\u4eec\u4ee5\u524d\u9762\u7684\u4e8b\u52a1 A \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u5206\u6790\u4e0b\u4e0b\u5b83\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u8bb0\u5f55\u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u7ea7\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002 \u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c**\u6b64\u65f6\u4e8b\u52a1 A \u5728 id = 1 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u7684\u662f\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u8303\u56f4\u662f id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u3002**\u8fd9\u6837\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u5bf9 id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u4e86\u3002 \u4ece\u8fd9\u91cc\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u77e5\uff0c \u52a0\u9501\u7684\u5bf9\u8c61\u662f\u9488\u5bf9\u7d22\u5f15 \uff0c\u56e0\u4e3a\u8fd9\u91cc\u67e5\u8be2\u8bed\u53e5\u626b\u63cf\u7684 B+ \u6811\u662f\u805a\u7c07\u7d22\u5f15\u6811\uff0c\u5373\u4e3b\u952e\u7d22\u5f15\u6811\uff0c\u6240\u4ee5\u662f\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u3002\u5c06\u5bf9\u5e94\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0 \u8bb0\u5f55\u9501\u540e\uff0c\u5c31\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5bf9\u8be5\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u4e86\u3002 \u4e3a\u4ec0\u4e48\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\uff1f \u539f\u56e0\u5c31\u662f\u5728\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u4ec5\u9760\u8bb0\u5f55\u9501\u4e5f\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u5e7b\u8bfb\u7684\u5b9a\u4e49\u5c31\u662f\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\uff0c\u4e0d\u76f8\u540c\u65f6\uff0c\u5c31\u8ba4\u4e3a\u53d1\u751f\u5e7b\u8bfb\u3002\u6240\u4ee5\uff0c\u8981\u907f\u514d\u5e7b\u8bfb\u5c31\u662f\u907f\u514d\u7ed3\u679c\u96c6\u67d0\u4e00\u6761\u8bb0\u5f55\u88ab\u5176\u4ed6\u4e8b\u52a1\u5220\u9664\uff0c\u6216\u8005\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u8fd9\u6837\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0d\u76f8\u540c\u7684\u60c5\u51b5\u3002 \u7531\u4e8e\u4e3b\u952e\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5**\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id = 1 \u7684\u65f6\u5019\uff0c\u4f1a\u56e0\u4e3a\u4e3b\u952e\u51b2\u7a81\uff0c\u5bfc\u81f4\u65e0\u6cd5\u63d2\u5165 id = 1 \u7684\u65b0\u8bb0\u5f55**\u3002\u8fd9\u6837\u4e8b\u52a1 A \u5728\u591a\u6b21\u67e5\u8be2 id = 1 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u4e0d\u540c\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u7531\u4e8e\u5bf9 id = 1 \u52a0\u4e86\u8bb0\u5f55\u9501\uff0c \u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5220\u9664\u8be5\u8bb0\u5f55 \uff0c\u8fd9\u6837\u4e8b\u52a1 A \u5728\u591a\u6b21\u67e5\u8be2 id = 1 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u4e0d\u540c\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 2\u3001\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5 \u00b6 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u7b49\u503c\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u4e8e\u8868\u4e2d\u7684\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id = 2 for update ; Empty set ( 0 . 03 sec ) \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c \u6b64\u65f6\u4e8b\u52a1 A \u5728 id = 5 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u7684\u662f\u95f4\u9699\u9501\uff0c\u9501\u4f4f\u7684\u8303\u56f4\u662f (1, 5)\u3002 \u63a5\u4e0b\u6765\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u8fd9\u4e00\u4e9b\u8bb0\u5f55\u7684\u8bdd\uff0c\u8fd9\u4e9b\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u53d1\u751f\u963b\u585e\u3002 \u6ce8\u610f\uff0c\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u7684 id = 1 \u6216\u8005 id = 5 \u7684\u8bb0\u5f55\u8bdd\uff0c\u5e76\u4e0d\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u800c\u662f\u62a5\u4e3b\u952e\u51b2\u7a81\u7684\u9519\u8bef\uff0c\u56e0\u4e3a\u8868\u4e2d\u5df2\u7ecf\u5b58\u5728 id = 1 \u548c id = 5 \u7684\u8bb0\u5f55\u4e86\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a \u56e0\u4e3a\u4e8b\u52a1 A \u5728 id = 5 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5) \u7684 X \u578b\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u63d2\u5165\u4e00\u6761 id \u4e3a 3 \u7684\u8bb0\u5f55\u65f6\u4f1a\u88ab\u963b\u585e\u4f4f\uff0c\u5373\u65e0\u6cd5\u63d2\u5165 id = 3 \u7684\u8bb0\u5f55\u3002 \u95f4\u9699\u9501\u7684\u8303\u56f4 (1, 5) \uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u300c\u53f3\u8fb9\u754c\u300d\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f 5\u3002 \u7136\u540e\u9501\u8303\u56f4\u7684\u300c\u5de6\u8fb9\u754c\u300d\u662f\u8868\u4e2d id \u4e3a 5 \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684 id \u503c\uff0c\u5373 1\u3002 \u56e0\u6b64\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4 (1, 5) \u3002 \u4e3a\u4ec0\u4e48\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u7684\u573a\u666f\u4e0b\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u8981\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d\uff1f \u539f\u56e0\u5c31\u662f\u5728\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u4ec5\u9760\u95f4\u9699\u9501\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u4e3a\u4ec0\u4e48 id = 5 \u8bb0\u5f55\u4e0a\u7684\u4e3b\u952e\u7d22\u5f15\u7684\u9501\u4e0d\u53ef\u4ee5\u662f next-key lock\uff1f\u5982\u679c\u662f next-key lock\uff0c\u5c31\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5220\u9664 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u8fd9\u6b21\u7684\u6848\u4f8b\u662f\u67e5\u8be2 id = 2 \u7684\u8bb0\u5f55\uff0c\u53ea\u8981\u4fdd\u8bc1\u524d\u540e\u4e24\u6b21\u67e5\u8be2 id = 2 \u7684\u7ed3\u679c\u96c6\u76f8\u540c\uff0c\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u4e86\uff0c\u6240\u4ee5\u5373\u4f7f id =5 \u88ab\u5220\u9664\uff0c\u4e5f\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\uff0c\u90a3\u5c31\u6ca1\u5fc5\u987b\u52a0 next-key lock\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u5728 id = 5 \u52a0\u95f4\u9699\u9501\uff0c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id = 2 \u7684\u65b0\u8bb0\u5f55\u5c31\u884c\u4e86\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u53ef\u4ee5\u9488\u5bf9\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u52a0\u8bb0\u5f55\u9501\uff1f\u9501\u662f\u52a0\u5728\u7d22\u5f15\u4e0a\u7684\uff0c\u800c\u8fd9\u4e2a\u573a\u666f\u4e0b\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u81ea\u7136\u5c31\u6ca1\u529e\u6cd5\u9501\u4f4f\u8fd9\u6761\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u3002 \u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2 \u00b6 \u8303\u56f4\u67e5\u8be2\u548c\u7b49\u503c\u67e5\u8be2\u7684\u52a0\u9501\u89c4\u5219\u662f\u4e0d\u540c\u7684\u3002 \u5f53\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c \u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u626b\u63cf\u5230\u7684\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u7136\u540e\u5982\u679c\u9047\u5230\u4e0b\u9762\u8fd9\u4e9b\u60c5\u51b5\uff0c\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u8005\u95f4\u9699\u9501 \uff1a \u60c5\u51b5\u4e00\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u56e0\u4e3a\u5b58\u5728\u7b49\u503c\u67e5\u8be2\u7684\u6761\u4ef6\uff0c\u90a3\u4e48\u5982\u679c\u7b49\u503c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u90a3\u4e48\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u8bb0\u5f55\u9501**\u3002 \u60c5\u51b5\u4e8c\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u8981\u770b\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u4e8e\u8868\u4e2d\uff1a \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c \u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501 \uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002 \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u5728\u8868\u4e2d\uff0c\u5982\u679c\u662f\u300c\u5c0f\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c \u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501 \uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\uff1b\u5982\u679c\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15 next-key \u9501\u4e0d\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002 \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u51e0\u4e2a\u5b9e\u9a8c\uff0c\u624d\u9a8c\u8bc1\u6211\u4e0a\u9762\u8bf4\u7684\u7ed3\u8bba\u3002 1\u3001\u9488\u5bf9\u300c\u5927\u4e8e\u6216\u8005\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2 \u00b6 \u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id > 15 for update ; + ----+-----------+-----+ | id | name | age | + ----+-----------+-----+ | 20 | \u9999\u514b\u65af | 39 | + ----+-----------+-----+ 1 row in set ( 0 . 01 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 20\uff0c\u7531\u4e8e\u67e5\u8be2\u8be5\u8bb0\u5f55\u4e0d\u662f\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\uff08\u4e0d\u662f\u5927\u4e8e\u7b49\u4e8e\u6761\u4ef6\u67e5\u8be2\uff09\uff0c\u6240\u4ee5\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u867d\u7136\u6211\u4eec\u770b\u89c1\u8868\u4e2d\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u662f id = 20 \u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u5b9e\u9645\u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u4f1a\u7528\u4e00\u4e2a\u7279\u6b8a\u7684\u8bb0\u5f55\u6765\u6807\u8bc6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff0c\u8be5\u7279\u6b8a\u7684\u8bb0\u5f55\u7684\u540d\u5b57\u53eb supremum pseudo-record \uff0c\u6240\u4ee5\u626b\u63cf\u7b2c\u4e8c\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u626b\u63cf\u5230\u4e86\u8fd9\u4e2a\u7279\u6b8a\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\u3002 \u505c\u6b62\u626b\u63cf\u3002 \u53ef\u4ee5\u5f97\u77e5\uff0c\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b \u7684 next-key \u9501\uff1a \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5f97\u5230**\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b \u7684next-key \u9501\uff1a** \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id >= 15 for update ; + ----+-----------+-----+ | id | name | age | + ----+-----------+-----+ | 15 | \u4e4c\u7d22\u666e | 20 | | 20 | \u9999\u514b\u65af | 39 | + ----+-----------+-----+ 2 rows in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 15\uff0c\u7531\u4e8e\u67e5\u8be2\u8be5\u8bb0\u5f55\u662f\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\uff08\u7b49\u4e8e 15\uff09\uff0c\u6240\u4ee5\u8be5\u4e3b\u952e\u7d22\u5f15\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u8bb0\u5f55\u9501**\uff0c\u4e5f\u5c31\u662f\u4ec5\u9501\u4f4f id = 15 \u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 20\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff1b \u63a5\u7740\u626b\u63cf\u5230\u7b2c\u4e09\u884c\u7684\u65f6\u5019\uff0c\u626b\u63cf\u5230\u4e86\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\u3002 \u505c\u6b62\u626b\u63cf\u3002 \u53ef\u4ee5\u5f97\u77e5\uff0c\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e09\u4e2a X \u578b \u7684\u9501\uff0c\u5206\u522b\u662f\uff1a \u5728 id = 15 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u8303\u56f4\u662f id = 15 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1b\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 15 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff1b \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 next-key \u9501\uff0c\u8303\u56f4\u662f (15, 20] \u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 next-key \u9501\uff0c\u8303\u56f4\u662f (20, +\u221e] \u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u901a\u8fc7\u524d\u9762\u8fd9\u4e2a\u5b9e\u9a8c\uff0c\u6211\u4eec\u8bc1\u660e\u4e86\uff1a \u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u4e0b\uff0c \u5982\u679c\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u90a3\u4e48\u7531\u4e8e\u67e5\u8be2\u8be5\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u662f\u5305\u542b\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u8bb0\u5f55\u9501**\u3002 2\u3001\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2 \u00b6 \u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff0c\u6ce8\u610f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 6\uff09\u5e76\u4e0d\u5b58\u5728\u4e8e\u8868\u4e2d\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id < 6 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 1 | \u8def\u98de | 19 | | 5 | \u7d22\u9686 | 21 | + ----+--------+-----+ 3 rows in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u6240\u4ee5\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u8bb0\u5f55\uff08id = 5\uff09\uff0c\u6ee1\u8db3 id < 6 \u6761\u4ef6\uff0c\u800c\u4e14\u4e5f\u6ca1\u6709\u8fbe\u5230\u7ec8\u6b62\u626b\u63cf\u7684\u6761\u4ef6\uff0c\u63a5\u7740\u4f1a\u7ee7\u7eed\u626b\u63cf\u3002 \u626b\u63cf\u5230\u7684\u7b2c\u4e09\u884c\u662f id = 10\uff0c\u8be5\u8bb0\u5f55\u4e0d\u6ee1\u8db3 id < 6 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5 id = 10 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (5, 10) \u7684\u95f4\u9699\u9501\u3002 \u7531\u4e8e\u626b\u63cf\u5230\u7684\u7b2c\u4e09\u884c\u8bb0\u5f55\uff08id = 10\uff09\uff0c\u4e0d\u6ee1\u8db3 id < 6 \u6761\u4ef6\uff0c\u8fbe\u5230\u4e86\u7ec8\u6b62\u626b\u63cf\u7684\u6761\u4ef6\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002 \u4ece\u4e0a\u9762\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u77e5\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e09\u4e2a X \u578b\u7684\u9501\uff1a \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 5 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (5, 10) \u7684\u95f4\u9699\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 6\u30017\u30018\u30019 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5f97\u77e5\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u4e09\u4e2a\u9501\uff0c\u5c31\u662f\u6211\u4eec\u524d\u9762\u5206\u6790\u51fa\u90a3\u4e09\u4e2a\u9501\u3002 \u867d\u7136\u8fd9\u6b21\u8303\u56f4\u67e5\u8be2\u7684\u6761\u4ef6\u662f\u300c\u5c0f\u4e8e\u300d\uff0c\u4f46\u662f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u4e8e\u8868\u4e2d\uff08 id \u4e3a 6 \u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff09\uff0c\u6240\u4ee5\u5982\u679c\u4e8b\u52a1 A \u7684\u8303\u56f4\u67e5\u8be2\u7684\u6761\u4ef6\u6539\u6210 <= 6 \u7684\u8bdd\uff0c\u52a0\u7684\u9501\u8fd8\u662f\u548c\u8303\u56f4\u67e5\u8be2\u6761\u4ef6\u4e3a < 6 \u662f\u4e00\u6837\u7684\u3002 \u5927\u5bb6\u81ea\u5df1\u4e5f\u9a8c\u8bc1\u4e0b\u8fd9\u4e2a\u7ed3\u8bba\u3002 \u56e0\u6b64\uff0c \u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u5982\u679c\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u4e2d\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u7684\u8bb0\u5f55\uff0c\u5219\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501 \u3002 \u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff0c\u6ce8\u610f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 5\uff09\u5b58\u5728\u4e8e\u8868\u4e2d\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id <= 5 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 1 | \u8def\u98de | 19 | | 5 | \u7d22\u9686 | 21 | + ----+--------+-----+ 2 rows in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\u3002 \u7531\u4e8e\u4e3b\u952e\u7d22\u5f15\u5177\u6709\u552f\u4e00\u6027\uff0c\u4e0d\u4f1a\u5b58\u5728\u4e24\u4e2a id = 5 \u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u518d\u7ee7\u7eed\u626b\u63cf\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002 \u4ece\u4e0a\u9762\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230**\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86 2 \u4e2a X \u578b\u7684\u9501**\uff1a \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 5 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b next-key \u9501\uff0c\u5206\u522b\u662f\uff1a \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a(1, 5 ] \u7684 next-key \u9501\u3002 \u5b9e\u9a8c\u4e09\uff1a\u518d\u6765\u770b\u9488\u5bf9\u300c\u5c0f\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002 \u5982\u679c\u4e8b\u52a1 A \u7684\u67e5\u8be2\u8bed\u53e5\u662f\u5c0f\u4e8e\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u4e14\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 5\uff09\u5b58\u5728\u4e8e\u8868\u4e2d\u3002 select * from user where id < 5 for update ; \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u8be5\u8bb0\u5f55\u662f\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3 id < 5 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f**\u8be5\u8bb0\u5f55\u7684\u9501\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\uff0c\u9501\u8303\u56f4\u662f (1,5)**\u3002 \u7531\u4e8e\u627e\u5230\u4e86\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3 id < 5 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002 \u53ef\u4ee5\u5f97\u77e5\uff0c\u6b64\u65f6**\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u79cd X \u578b\u9501\uff1a** \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1,5) \u7684\u95f4\u9699\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86 X \u578b\u7684\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff0c\u548c X \u578b\u7684\u8303\u56f4\u4e3a (1, 5) \u7684\u95f4\u9699\u9501 \u3002 \u56e0\u6b64\uff0c\u901a\u8fc7\u524d\u9762\u8fd9\u4e09\u4e2a\u5b9e\u9a8c\uff0c\u53ef\u4ee5\u5f97\u77e5\u3002 \u5728\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u552f\u4e00\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5b58\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4f1a\u5c06\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u7684\uff1a \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u4e0d\u5728\u300d\u8868\u4e2d\u65f6\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002 \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5728\u300d\u8868\u4e2d\u65f6\uff1a \u5982\u679c\u662f\u300c\u5c0f\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0 next-key \u9501\u3002 \u5982\u679c\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u300c\u4e0d\u4f1a\u300d\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002 \u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2 \u00b6 \u5f53\u6211\u4eec\u7528\u975e\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\uff0c \u56e0\u4e3a\u5b58\u5728\u4e24\u4e2a\u7d22\u5f15\uff0c\u4e00\u4e2a\u662f\u4e3b\u952e\u7d22\u5f15\uff0c\u4e00\u4e2a\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u6240\u4ee5\u5728\u52a0\u9501\u65f6\uff0c\u540c\u65f6\u4f1a\u5bf9\u8fd9\u4e24\u4e2a\u7d22\u5f15\u90fd\u52a0\u9501\uff0c\u4f46\u662f\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u7684\u65f6\u5019\uff0c\u53ea\u6709\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u624d\u4f1a\u5bf9\u5b83\u4eec\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u9501 \u3002 \u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u5b58\u4e0d\u5b58\u5728\uff0c\u52a0\u9501\u7684\u89c4\u5219\u4e5f\u4f1a\u4e0d\u540c\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u65f6\uff0c\u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u7d22\u5f15\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f**\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u626b\u63cf\u5230\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u5c31\u505c\u6b62\u626b\u63cf\uff0c\u7136\u540e\u5728\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u626b\u63cf\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f next-key \u9501\uff0c\u800c\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u540c\u65f6\uff0c\u5728\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u8bb0\u5f55\u9501**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u65f6\uff0c \u626b\u63cf\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u56e0\u4e3a\u4e0d\u5b58\u5728\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501 \u3002 \u63a5\u4e0b\u91cc\u7528\u4e24\u4e2a\u5b9e\u9a8c\u6765\u8bf4\u660e\u3002 1\u3001\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5 \u00b6 \u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u503c\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u3002 \u5148\u6765\u8bf4\u8bf4\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u5bf9\u975e\u552f\u4e00\u7d22\u5f15\uff08age\uff09\u8fdb\u884c\u4e86\u7b49\u503c\u67e5\u8be2\uff0c\u4e14\u8868\u4e2d\u4e0d\u5b58\u5728 age = 25 \u7684\u8bb0\u5f55\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where age = 25 for update ; Empty set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u5b9a\u4f4d\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u5373\u626b\u63cf\u5230 age = 39\uff0c\u4e8e\u662f**\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)**\u3002 \u505c\u6b62\u67e5\u8be2 \u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 X \u578b\u7684\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u300125\u300126\u3001....\u300138 \u8fd9\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 22 \u548c age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age \uff09\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501\u3002 \u6b64\u65f6\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86 age \u503c\u4e3a 23\u300124\u300125\u300126\u3001....\u300138 \u8fd9\u4e9b\u65b0\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e9b\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u53d1\u751f\u963b\u585e\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8bf4\uff01 \u5f53\u6709\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501 (22, 39) \u65f6\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8ba9\u5176\u4ed6\u4e8b\u52a1\u7684\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\u6210\u529f\uff1f\u53c8\u662f\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u65f6\u7684\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff1f \u6211\u4eec\u5148\u8981\u6e05\u695a\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\u3002 \u63d2\u5165\u8bed\u53e5\u5728\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b9a\u4f4d\u5230\u8be5\u8bb0\u5f55\u5728 B+\u6811 \u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u624d\u4f1a\u53d1\u751f\u963b\u585e \u3002 \u5728\u5206\u6790\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501\u662f\u5426\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u8bb0\u5f55\u65f6\uff0c\u6211\u4eec\u8981\u5148\u8981\u77e5\u9053\u4e8c\u7ea7\u7d22\u5f15\u6811\u662f\u5982\u4f55\u5b58\u653e\u8bb0\u5f55\u7684\uff1f \u4e8c\u7ea7\u7d22\u5f15\u6811\u662f\u6309\u7167\u4e8c\u7ea7\u7d22\u5f15\u503c\uff08age\u5217\uff09\u6309\u987a\u5e8f\u5b58\u653e\u7684\uff0c\u5728\u76f8\u540c\u7684\u4e8c\u7ea7\u7d22\u5f15\u503c\u60c5\u51b5\u4e0b\uff0c \u518d\u6309\u4e3b\u952e id \u7684\u987a\u5e8f\u5b58\u653e\u3002\u77e5\u9053\u4e86\u8fd9\u4e2a\u524d\u63d0\uff0c\u6211\u4eec\u624d\u80fd\u77e5\u9053\u6267\u884c\u63d2\u5165\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u8c01\u3002 \u57fa\u4e8e\u524d\u9762\u7684\u5b9e\u9a8c\uff0c\u4e8b\u52a1 A \u662f\u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 X \u578b\u7684\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)\u3002 \u63d2\u5165 age = 22 \u8bb0\u5f55\u7684\u6210\u529f\u548c\u5931\u8d25\u7684\u60c5\u51b5\u5206\u522b\u5982\u4e0b\uff1a \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 3 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 10\u3001age = 22 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6ca1\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u53ef\u4ee5\u6267\u884c\u6210\u529f**\u3002 \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 12 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f**\u3002 \u63d2\u5165 age = 39 \u8bb0\u5f55\u7684\u6210\u529f\u548c\u5931\u8d25\u7684\u60c5\u51b5\u5206\u522b\u5982\u4e0b\uff1a \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 39\uff0cid = 3 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f**\u3002 \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 39\uff0cid = 21 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0d\u5b58\u5728\uff0c\u4e5f\u5c31\u6ca1\u6709\u95f4\u9699\u9501\u4e86\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u53ef\u4ee5\u63d2\u5165\u6210\u529f**\u3002 \u6240\u4ee5\uff0c \u5f53\u6709\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501 (22, 39) \u65f6\uff0c\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\u662f\u5426\u53ef\u4ee5\u6267\u884c\u6210\u529f\uff0c\u5173\u952e\u8fd8\u8981\u8003\u8651\u63d2\u5165\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\uff0c\u56e0\u4e3a\u300c\u4e8c\u7ea7\u7d22\u5f15\u503c\uff08age\u5217\uff09+\u4e3b\u952e\u503c\uff08id\u5217\uff09\u300d\u624d\u53ef\u4ee5\u786e\u5b9a\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u786e\u5b9a\u4e86\u63d2\u5165\u4f4d\u7f6e\u540e\uff0c\u5c31\u8981\u770b\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u6709\u95f4\u9699\u9501\uff0c\u5982\u679c\u6709\u95f4\u9699\u9501\uff0c\u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u5982\u679c\u6ca1\u6709\u95f4\u9699\u9501\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f \u3002 \u77e5\u9053\u4e86\u8fd9\u4e2a\u7ed3\u8bba\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u56de\u8fc7\u5934\u770b\uff0c\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u65f6\uff0c\u6267\u884c select * from performance_schema.data_locks\\G; \u8f93\u51fa\u7684\u7ed3\u679c\u3002 \u5728\u524d\u9762\u5206\u6790\u8f93\u51fa\u7ed3\u679c\u7684\u65f6\u5019\uff0c\u6211\u8bf4\u7684\u7ed3\u8bba\u662f\uff1a\u300c \u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age \uff09\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501 \u300d\u3002\u8fd9\u4e2a\u7ed3\u8bba\u5176\u5b9e\u8fd8\u4e0d\u591f\u51c6\u786e\uff0c\u56e0\u4e3a\u53ea\u8003\u8651\u4e86 LOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\uff0839\uff09\uff0c\u6ca1\u6709\u8003\u8651 LOCK_DATA \u7b2c\u4e8c\u4e2a\u6570\u503c\uff0820\uff09\u3002 \u90a3 LOCK_DATA\uff1a39\uff0c20 \u662f\u4ec0\u4e48\u610f\u601d\uff1f LOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\uff0c\u4e5f\u5c31\u662f 39\uff0c \u5b83\u4ee3\u8868\u7684\u662f age \u503c\u3002\u4ece\u524d\u9762\u6211\u4eec\u4e5f\u77e5\u9053\u4e86\uff0cLOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\u662f next-key \u9501\u548c\u95f4\u9699\u9501**\u9501\u4f4f\u7684\u8303\u56f4\u7684\u53f3\u8fb9\u754c\u503c**\u3002 LOCK_DATA \u7b2c\u4e8c\u4e2a\u6570\u503c\uff0c\u4e5f\u5c31\u662f 20\uff0c \u5b83\u4ee3\u8868\u7684\u662f id \u503c\u3002 \u4e4b\u6240\u4ee5 LOCK_DATA \u8981\u591a\u663e\u793a\u4e00\u4e2a\u6570\u503c\uff08ID\u503c\uff09\uff0c\u662f\u56e0\u4e3a\u9488\u5bf9\u300c\u5f53\u67d0\u4e2a\u4e8b\u52a1\u6301\u6709\u975e\u552f\u4e00\u7d22\u5f15\u7684 (22, 39) \u95f4\u9699\u9501\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 39 \u65b0\u8bb0\u5f55\u300d\u7684\u95ee\u9898\uff0c\u8fd8\u9700\u8981\u8003\u8651\u63d2\u5165\u8bb0\u5f55\u7684 id \u503c\u3002\u800c LOCK_DATA \u7684\u7b2c\u4e8c\u4e2a\u6570\u503c\uff0c\u5c31\u662f\u8bf4\u660e\u5728\u63d2\u5165 age = 39 \u65b0\u8bb0\u5f55\u65f6\uff0c\u54ea\u4e9b\u8303\u56f4\u7684 id \u503c\u662f\u4e0d\u53ef\u4ee5\u63d2\u5165\u7684 \u3002 \u56e0\u6b64\uff0c LOCK_DATA\uff1a39\uff0c20 + LOCK_MODE : X, GAP \u7684\u610f\u601d\u662f\uff0c\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age \uff09\uff0c\u52a0\u4e86 age \u503c\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501\uff0c**\u540c\u65f6\u9488\u5bf9\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 39 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u4e0d\u5141\u8bb8\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 20 **\u3002\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 20\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002 \u4f46\u662f\u6211\u4eec\u65e0\u6cd5\u4ece select * from performance_schema.data_locks\\G; \u8f93\u51fa\u7684\u7ed3\u679c\u5206\u6790\u51fa\u300c\u5728\u63d2\u5165 age =22 \u65b0\u8bb0\u5f55\u65f6\uff0c\u54ea\u4e9b\u8303\u56f4\u7684 id \u503c\u662f\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u7684\u300d\uff0c\u8fd9\u65f6\u5019\u5c31**\u5f97\u81ea\u5df1\u753b\u51fa\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u7ed3\u6784\uff0c\u7136\u540e\u786e\u5b9a\u63d2\u5165\u4f4d\u7f6e\u540e\uff0c\u770b\u4e0b\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5982\u679c\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5219\u65e0\u6cd5\u63d2\u5165\u6210\u529f\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f**\u3002 2\u3001\u8bb0\u5f55\u5b58\u5728\u7684\u60c5\u51b5 \u00b6 \u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u503c\u5b58\u5728\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u5bf9\u975e\u552f\u4e00\u7d22\u5f15\uff08age\uff09\u8fdb\u884c\u4e86\u7b49\u503c\u67e5\u8be2\uff0c\u4e14\u8868\u4e2d\u5b58\u5728 age = 22 \u7684\u8bb0\u5f55\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where age = 22 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 10 | \u5c71\u6cbb | 22 | + ----+--------+-----+ 1 row in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f age = 22\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u4e0a\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\u3002\u540c\u65f6\uff0c\u56e0\u4e3a age = 22 \u7b26\u5408\u67e5\u8be2\u6761\u4ef6\uff0c\u4e8e\u662f\u5bf9 age = 22 \u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u4e0a\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 10 \u8fd9\u4e00\u884c\u52a0\u8bb0\u5f55\u9501\u3002 \u63a5\u7740\u7ee7\u7eed\u626b\u63cf\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f age = 39\uff0c\u8be5\u8bb0\u5f55\u662f\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u6240\u4ee5\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u8303\u56f4\u662f (22, 39)\u3002 \u505c\u6b62\u67e5\u8be2\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u90fd\u52a0\u4e86 X \u578b\u7684\u9501\uff1a \u4e3b\u952e\u7d22\u5f15\uff1a \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u4e8c\u7ea7\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\uff1a \u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 20 \u548c age = 21 \u65b0\u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002 \u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u3001..... \u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 22 \u548c age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e8c\u7ea7\u7d22\u5f15\uff08INDEX_NAME: index_age \uff09\u52a0\u4e86\u4e24\u4e2a X \u578b\u9501\uff0c\u5206\u522b\u662f\uff1a \u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u9488\u5bf9\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u548c age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u5206\u6790\u5982\u4e0b\uff1a \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c \u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 5\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u63d2\u5165\u6210\u529f \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 5\uff0cage = 21 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6ca1\u6709\u95f4\u9699\u9501\u3002 \u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 5\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u63d2\u5165\u6210\u529f \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 20\uff0cage = 39 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\u3002 \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece LOCK_DATA : 22, 10 \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c \u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff1b\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u5927\u4e8e 10\uff0c\u8fd8\u8981\u770b\u8be5\u65b0\u8bb0\u5f55\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u6709\u95f4\u9699\u9501\uff0c\u5982\u679c\u6ca1\u6709\u95f4\u9699\u9501\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\uff0c\u5982\u679c\u6709\u95f4\u9699\u9501\uff0c\u5219\u65e0\u6cd5\u63d2\u5165\u6210\u529f \u3002 \u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u3001..... \u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u9488\u5bf9\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u548c age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u5206\u6790\u5982\u4e0b\uff1a \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c \u5982\u679c\u63d2\u5165 age = 22 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165 \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 10\uff0cage = 22 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff08 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709 next-key \u9501\uff09\u3002 \u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 10\uff0c\u4e5f\u65e0\u6cd5\u63d2\u5165 \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 20\uff0cage = 39 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\u3002 \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece LOCK_DATA : 39, 20 \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 39 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c \u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 20\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u5927\u4e8e 20\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f \u3002 \u540c\u65f6\uff0c\u4e8b\u52a1 A \u8fd8\u5bf9\u4e3b\u952e\u7d22\u5f15\uff08INDEX_NAME: PRIMARY \uff09\u52a0\u4e86X \u578b\u7684\u8bb0\u5f55\u9501\uff1a \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u5b9e\u9a8c\u6848\u4f8b\u4e2d\uff0c\u9700\u8981\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\uff1f \u8981\u627e\u5230\u8fd9\u4e2a\u95ee\u9898\u7684\u7b54\u6848\uff0c\u6211\u4eec\u8981\u660e\u767d MySQL \u5728\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b\u573a\u666f\u4e0b\uff0c\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u95f4\u9699\u9501\uff1f\u5176\u5b9e**\u662f\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f**\u3002 \u5982\u679c\u8fd9\u4e2a\u5b9e\u9a8c\u6848\u4f8b\u4e2d\uff1a select * from user where age = 22 for update ; \u5982\u679c\u4e8b\u52a1 A \u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\uff0c\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f1a\u6709\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u524d\u9762\u6211\u4e5f\u8bf4\u8fc7\uff0c\u5728\u975e\u552f\u4e00\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u662f\u65e0\u6cd5\u5b8c\u5168\u9501\u4f4f age = 22 \u65b0\u8bb0\u5f55\u7684\u63d2\u5165\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece LOCK_DATA : 22, 10 \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff0c \u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 10\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f \u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\u4e0a\u52a0\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u6709\u53ef\u80fd\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u7684\uff08\u6bd4\u5982\u63d2\u5165\u4e00\u4e2a age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\uff09\uff0c\u90a3\u4e48\u5982\u679c\u4e8b\u52a1 A \u518d\u4e00\u6b21\u67e5\u8be2 age = 22 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u524d\u540e\u4e24\u6b21\u67e5\u8be2 age = 22 \u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u8fd9\u65f6\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002 \u90a3\u4e48\u5f53\u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684\u95f4\u9699\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u65e0\u6cd5\u63d2\u5165\u4e00\u4e2a age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\uff0c\u56e0\u4e3a\u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f \u3002 \u6240\u4ee5\uff0c\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff0c\u5c31\u9700\u8981\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002 \u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2 \u00b6 \u975e\u552f\u4e00\u7d22\u5f15\u548c\u4e3b\u952e\u7d22\u5f15\u7684\u8303\u56f4\u67e5\u8be2\u7684\u52a0\u9501\u4e5f\u6709\u6240\u4e0d\u540c\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e**\u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u7d22\u5f15\u7684 next-key lock \u4e0d\u4f1a\u6709\u9000\u5316\u4e3a\u95f4\u9699\u9501\u548c\u8bb0\u5f55\u9501\u7684\u60c5\u51b5**\uff0c\u4e5f\u5c31\u662f\u975e\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5bf9\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u9501\u90fd\u662f\u52a0 next-key \u9501\u3002 \u5c31\u5e26\u5927\u5bb6\u7b80\u5355\u5206\u6790\u4e00\u4e0b\uff0c\u4e8b\u52a1 A \u7684\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where age >= 22 for update ; + ----+-----------+-----+ | id | name | age | + ----+-----------+-----+ | 10 | \u5c71\u6cbb | 22 | | 20 | \u9999\u514b\u65af | 39 | + ----+-----------+-----+ 2 rows in set ( 0 . 01 sec ) \u4e8b\u52a1 A \u7684\u52a0\u9501\u53d8\u5316\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f age = 22\uff0c\u867d\u7136\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\u5305\u542b\u7b49\u503c\u67e5\u8be2\uff0c\u4f46\u662f\u8fd9\u91cc\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u6240\u4ee5\u662f\u4e0d\u4f1a\u53d1\u751f\u9000\u5316\u9501\u7684\u73b0\u8c61\uff0c\u56e0\u6b64\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0 next-key \u9501\uff0c\u8303\u56f4\u662f (21, 22]\u3002\u540c\u65f6\uff0c\u5bf9 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 10 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\u3002 \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u8be2\uff0c\u63a5\u7740\u7ee7\u7eed\u626b\u63cf\u5df2\u7ecf\u5b58\u5728\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u3002\u626b\u9762\u7684\u7b2c\u4e8c\u884c\u662f age = 39 \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0 next-key \u9501\uff0c\u8303\u56f4\u662f (22, 39]\uff0c\u540c\u65f6\uff0c\u5bf9 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 20 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\u3002 \u867d\u7136\u6211\u4eec\u770b\u89c1\u8868\u4e2d\u6700\u540e\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u662f age = 39 \u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u5b9e\u9645\u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u4f1a\u7528\u4e00\u4e2a\u7279\u6b8a\u7684\u8bb0\u5f55\u6765\u6807\u8bc6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff0c\u8be5\u7279\u6b8a\u7684\u8bb0\u5f55\u7684\u540d\u5b57\u53eb supremum pseudo-record \uff0c\u6240\u4ee5\u626b\u63cf\u7b2c\u4e8c\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u626b\u63cf\u5230\u4e86\u8fd9\u4e2a\u7279\u6b8a\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (39, +\u221e] \u7684 next-key \u9501\u3002 \u505c\u6b62\u67e5\u8be2 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u90fd\u52a0\u4e86 X \u578b\u7684\u9501\uff1a \u4e3b\u952e\u7d22\u5f15\uff08id \u5217\uff09\uff1a \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u4e8c\u7ea7\u7d22\u5f15\uff08age \u5217\uff09\uff1a \u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u4e0d\u8fc7\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u548c age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u9700\u8981\u770b\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u6709\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u6211\u4eec\u524d\u9762\u4e5f\u8bb2\u4e86\u3002 \u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 39 \u7684\u8fd9\u4e00\u4e9b\u8bb0\u5f55\uff0c\u4e5f\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u300125\u3001...\u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u548c age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u9700\u8981\u770b\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u6709\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u6211\u4eec\u524d\u9762\u4e5f\u8bb2\u4e86\u3002 \u5728\u7279\u6b8a\u7684\u8bb0\u5f55\uff08supremum pseudo-record\uff09\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (39, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u5927\u4e8e 39 \u7684\u8fd9\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 age >= 22 \u7684\u8303\u56f4\u67e5\u8be2\u4e2d\uff0c\u660e\u660e\u67e5\u8be2 age = 22 \u7684\u8bb0\u5f55\u5b58\u5728\u5e76\u4e14\u5c5e\u4e8e\u7b49\u503c\u67e5\u8be2\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u50cf\u552f\u4e00\u7d22\u5f15\u90a3\u6837\uff0c\u5c06 age = 22 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u7684 next-key \u9501\u9000\u5316\u4e3a\u8bb0\u5f55\u9501\uff1f \u56e0\u4e3a age \u5b57\u6bb5\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff0c\u4e0d\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u5982\u679c\u53ea\u52a0\u8bb0\u5f55\u9501\uff08\u8bb0\u5f55\u9501\u65e0\u6cd5\u9632\u6b62\u63d2\u5165\uff0c\u53ea\u80fd\u9632\u6b62\u5220\u9664\u6216\u8005\u4fee\u6539\uff09\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22 \u7684\u8bb0\u5f55\uff0c\u8fd9\u6837\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u76f8\u540c\u4e86\uff0c\u51fa\u73b0\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002 \u6ca1\u6709\u52a0\u7d22\u5f15\u7684\u67e5\u8be2 \u00b6 \u524d\u9762\u7684\u6848\u4f8b\uff0c\u6211\u4eec\u7684\u67e5\u8be2\u8bed\u53e5\u90fd\u6709\u4f7f\u7528\u7d22\u5f15\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u67e5\u8be2\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u662f\u901a\u8fc7\u7d22\u5f15\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\u7684\uff0c\u7136\u540e\u5bf9\u626b\u63cf\u51fa\u6765\u7684\u8bb0\u5f55\u8fdb\u884c\u52a0\u9501\u3002 \u5982\u679c\u9501\u5b9a\u8bfb\u67e5\u8be2\u8bed\u53e5\uff0c\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\u5217\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6\uff0c\u6216\u8005\u67e5\u8be2\u8bed\u53e5\u6ca1\u6709\u8d70\u7d22\u5f15\u67e5\u8be2\uff0c\u5bfc\u81f4\u626b\u63cf\u662f\u5168\u8868\u626b\u63cf\u3002\u90a3\u4e48\uff0c\u6bcf\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u90fd\u4f1a\u52a0 next-key \u9501\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u9501\u4f4f\u7684\u5168\u8868\uff0c\u8fd9\u65f6\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u5bf9\u8be5\u8868\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u88ab\u963b\u585e \u3002 \u4e0d\u53ea\u662f\u9501\u5b9a\u8bfb\u67e5\u8be2\u8bed\u53e5\u4e0d\u52a0\u7d22\u5f15\u624d\u4f1a\u5bfc\u81f4\u8fd9\u79cd\u60c5\u51b5\uff0cupdate \u548c delete \u8bed\u53e5\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e0d\u52a0\u7d22\u5f15\uff0c\u90a3\u4e48\u7531\u4e8e\u626b\u63cf\u7684\u65b9\u5f0f\u662f\u5168\u8868\u626b\u63cf\uff0c\u4e8e\u662f\u5c31\u4f1a\u5bf9\u6bcf\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u90fd\u4f1a\u52a0 next-key \u9501\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u9501\u4f4f\u7684\u5168\u8868\u3002 \u56e0\u6b64\uff0c \u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002 \u603b\u7ed3 \u00b6 \u8fd9\u6b21\u6211\u4ee5 MySQL 8.0.26 \u7248\u672c\uff0c\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e4b\u4e0b\uff0c\u505a\u4e86\u51e0\u4e2a\u5b9e\u9a8c\uff0c\u8ba9\u5927\u5bb6\u4e86\u89e3\u4e86\u552f\u4e00\u7d22\u5f15\u548c\u975e\u552f\u4e00\u7d22\u5f15\u7684\u884c\u7ea7\u9501\u7684\u52a0\u9501\u89c4\u5219\u3002 \u6211\u8fd9\u91cc\u603b\u7ed3\u4e0b\uff0c MySQL \u884c\u7ea7\u9501\u7684\u52a0\u9501\u89c4\u5219\u3002 \u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u8fd9\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u8bb0\u5f55\u9501\u300d**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d**\u3002 \u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u65f6\uff0c\u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u7d22\u5f15\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u626b\u63cf\u5230\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u5c31\u505c\u6b62\u626b\u63cf\uff0c\u7136\u540e**\u5728\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u626b\u63cf\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f next-key \u9501\uff0c\u800c\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u540c\u65f6\uff0c\u5728\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u8bb0\u5f55\u9501**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u65f6\uff0c \u626b\u63cf\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u56e0\u4e3a\u4e0d\u5b58\u5728\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501 \u3002 \u975e\u552f\u4e00\u7d22\u5f15\u548c\u4e3b\u952e\u7d22\u5f15\u7684\u8303\u56f4\u67e5\u8be2\u7684\u52a0\u9501\u89c4\u5219\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a \u552f\u4e00\u7d22\u5f15\u5728\u6ee1\u8db3\u4e00\u4e9b\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u7d22\u5f15\u7684 next-key lock \u9000\u5316\u4e3a\u95f4\u9699\u9501\u6216\u8005\u8bb0\u5f55\u9501\u3002 \u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u7d22\u5f15\u7684 next-key lock \u4e0d\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\u548c\u8bb0\u5f55\u9501\u3002 \u5176\u5b9e\u7406\u89e3 MySQL \u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u52a0\u9501\uff0c\u4e3b\u8981\u8981\u4ee5\u907f\u514d\u5e7b\u8bfb\u89d2\u5ea6\u53bb\u5206\u6790\uff0c\u8fd9\u6837\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u8fd9\u4e9b\u52a0\u9501\u7684\u89c4\u5219\u4e86\u3002 \u8fd8\u6709\u4e00\u4ef6\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c \u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002 \u6700\u540e\u9644\u4e0a\u300c@\u4e00\u53ea\u5c0f\u94ed\u300d\u540c\u5b66\u603b\u7ed3\u7684\u6d41\u7a0b\u56fe\u3002 \u552f\u4e00\u7d22\u5f15\u52a0\u9501\u7684\u6d41\u7a0b\u56fe\uff1a \u975e\u552f\u4e00\u7d22\u5f15\u52a0\u9501\u7684\u6d41\u7a0b\u56fe\uff1a \u5c31\u8bf4\u5230\u8fd9\u5566\uff0c \u6211\u4eec\u4e0b\u6b21\u89c1\u5566\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f"},{"location":"mysql/lock/how_to_lock/#mysql","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u662f\u4e0d\u662f\u5f88\u591a\u4eba\u90fd\u5bf9 MySQL \u52a0\u884c\u7ea7\u9501\u7684\u89c4\u5219\u641e\u7684\u8ff7\u8ff7\u7cca\u7cca\uff0c\u5bf9\u8bb0\u5f55\u4e00\u4f1a\u52a0\u7684\u662f next-key \u9501\uff0c\u4e00\u4f1a\u52a0\u662f\u95f4\u9699\u9501\uff0c\u4e00\u4f1a\u53c8\u662f\u8bb0\u5f55\u9501\u3002 \u5766\u767d\u8bf4\uff0c\u786e\u5b9e\u8fd8\u633a\u590d\u6742\u7684\uff0c\u4f46\u662f\u597d\u5728\u6211\u627e\u70b9\u4e86\u70b9\u89c4\u5f8b\uff0c\u4e5f\u77e5\u9053\u5982\u4f55\u5982\u4f55\u7528\u547d\u4ee4\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u884c\u7ea7\u9501\u3002 \u4e4b\u524d\u6211\u5199\u8fc7\u4e00\u7bc7\u5173\u4e8e\u300cMySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f\u300d\u7684\u6587\u7ae0\uff0c\u968f\u7740\u6211\u5199 MySQL \u9501\u76f8\u5173\u7684\u6587\u7ae0\u8d8a\u6765\u8d8a\u591a\u65f6\uff0c\u540e\u6765\u53d1\u73b0\u5f53\u65f6\u7684\u6587\u7ae0\u5199\u7684\u4e0d\u591f\u8be6\u7ec6\u3002 \u4e3a\u4e86\u8ba9\u5927\u5bb6\u5f88\u6e05\u695a\u7684\u77e5\u9053 MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff0c\u4ee5\u53ca\u5982\u4f55\u7528\u547d\u4ee4\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u884c\u7ea7\u9501\uff0c\u518d\u52a0\u4e0a\u4e3a\u4e86\u89e3\u91ca\u6e05\u695a\u4e3a\u4ec0\u4e48 MySQL \u8981\u8fd9\u4e48\u52a0\u884c\u7ea7\u9501\uff0c\u6240\u4ee5**\u6211\u91cd\u5199\u4e86\u8fd9\u7bc7\u6587\u7ae0**\u3002 \u8fd9\u4e00\u91cd\u5199\uff0c\u5c31\u591a\u589e\u52a0\u4e86 1W \u591a\u5b57 + 30 \u5f20\u56fe\uff0c\u6240\u4ee5\u5168\u5b8c\u7b97\u662f\u65b0\u7684\u6587\u7ae0\u4e86\u3002 \u6587\u7ae0\u5185\u5bb9\u6bd4\u8f83\u957f\uff0c\u5927\u5bb6\u53ef\u4ee5\u8010\u5fc3\u770b\u4e0b\u53bb\uff0c\u770b\u5b8c\u4e4b\u540e\u4f60\u4f1a\u6709\u4e00\u79cd\u7a81\u7136\u88ab\u987f\u609f\u7684\u611f\u89c9\uff0c\u56e0\u4e3a\u6211\u81ea\u5df1\u5199\u5b8c\u8fd9\u7bc7\u6587\u7ae0\u540e\uff0c\u81ea\u5df1\u4e5f\u88ab\u81ea\u5df1\u987f\u609f\u4e86\u3002","title":"MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f"},{"location":"mysql/lock/how_to_lock/#sql","text":"InnoDB \u5f15\u64ce\u662f\u652f\u6301\u884c\u7ea7\u9501\u7684\uff0c\u800c MyISAM \u5f15\u64ce\u5e76\u4e0d\u652f\u6301\u884c\u7ea7\u9501\uff0c\u6240\u4ee5\u540e\u9762\u7684\u5185\u5bb9\u90fd\u662f\u57fa\u4e8e InnoDB \u5f15\u64ce \u7684\u3002 \u6240\u4ee5\uff0c\u5728\u8bf4 MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u662f\u5728\u8bf4 InnoDB \u5f15\u64ce\u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\u3002 \u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u5feb\u7167\u8bfb\uff0c\u662f\u901a\u8fc7 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5b9e\u73b0\u7684\u3002 \u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u7ea7\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff0c\u8fd9\u4e24\u79cd\u67e5\u8be2\u4f1a\u52a0\u9501\u7684\u8bed\u53e5\u79f0\u4e3a**\u9501\u5b9a\u8bfb**\u3002 // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 ( S\u578b\u9501 ) select ... lock in share mode ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 ( X\u578b\u9501 ) select ... for update ; \u4e0a\u9762\u8fd9\u4e24\u6761\u8bed\u53e5\u5fc5\u987b\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c \u56e0\u4e3a\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e86\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e \uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u8fd9\u4e24\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u8981\u52a0\u4e0a begin \u6216\u8005 start transaction \u5f00\u542f\u4e8b\u52a1\u7684\u8bed\u53e5\u3002 \u9664\u4e86\u4e0a\u9762\u8fd9\u4e24\u6761\u9501\u5b9a\u8bfb\u8bed\u53e5\u4f1a\u52a0\u884c\u7ea7\u9501\u4e4b\u5916\uff0cupdate \u548c delete \u64cd\u4f5c\u90fd\u4f1a\u52a0\u884c\u7ea7\u9501\uff0c\u4e14\u9501\u7684\u7c7b\u578b\u90fd\u662f\u72ec\u5360\u9501(X\u578b\u9501) \u3002 // \u5bf9\u64cd\u4f5c\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 ( X\u578b\u9501 ) update table .... where id = 1 ; // \u5bf9\u64cd\u4f5c\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 ( X\u578b\u9501 ) delete from table where id = 1 ; \u5171\u4eab\u9501\uff08S\u9501\uff09\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\uff0c\u8bfb\u5199\u4e92\u65a5\u3002\u72ec\u5360\u9501\uff08X\u9501\uff09\u6ee1\u8db3\u5199\u5199\u4e92\u65a5\u3001\u8bfb\u5199\u4e92\u65a5\u3002","title":"\u4ec0\u4e48 SQL \u8bed\u53e5\u4f1a\u52a0\u884c\u7ea7\u9501\uff1f"},{"location":"mysql/lock/how_to_lock/#_1","text":"\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u662f\u4e0d\u540c\u7684\u3002 \u5728\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u53ea\u6709\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\u3002 \u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u9664\u4e86\u6709\u8bb0\u5f55\u9501\uff0c\u8fd8\u6709\u95f4\u9699\u9501\uff08\u76ee\u7684\u662f\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\uff09\uff0c\u6240\u4ee5\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u4e3b\u8981\u6709\u4e09\u7c7b\uff1a Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\uff1b Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u4f46\u662f\u4e0d\u5305\u542b\u8bb0\u5f55\u672c\u8eab\uff1b Next-Key Lock\uff1aRecord Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002 \u63a5\u4e0b\u6765\uff0c\u5206\u522b\u4ecb\u7ecd\u8fd9\u4e09\u79cd\u884c\u7ea7\u9501\u3002","title":"\u884c\u7ea7\u9501\u6709\u54ea\u4e9b\u79cd\u7c7b\uff1f"},{"location":"mysql/lock/how_to_lock/#record-lock","text":"Record Lock \u79f0\u4e3a\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u662f\u4e00\u6761\u8bb0\u5f55\u3002\u800c\u4e14\u8bb0\u5f55\u9501\u662f\u6709 S \u9501\u548c X \u9501\u4e4b\u5206\u7684\uff1a \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 S \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e S \u9501\u517c\u5bb9\uff09\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09; \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 X \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e2\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08X \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a mysql > begin ; mysql > select * from t_test where id = 1 for update ; \u4e8b\u52a1\u4f1a\u5bf9\u8868\u4e2d\u4e3b\u952e id = 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u5982\u679c\u8fd9\u65f6\u5019\u5176\u4ed6\u4e8b\u52a1\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u5220\u9664\u6216\u8005\u66f4\u65b0\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u88ab\u963b\u585e\u3002\u6ce8\u610f\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 id = 1 \u7684\u65b0\u8bb0\u5f55\u5e76\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u800c\u662f\u4f1a\u62a5\u4e3b\u952e\u51b2\u7a81\u7684\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3a\u4e3b\u952e\u6709\u552f\u4e00\u6027\u7684\u7ea6\u675f\u3002 \u5f53\u4e8b\u52a1\u6267\u884c commit \u540e\uff0c\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u751f\u6210\u7684\u9501\u90fd\u4f1a\u88ab\u91ca\u653e\u3002","title":"Record Lock"},{"location":"mysql/lock/how_to_lock/#gap-lock","text":"Gap Lock \u79f0\u4e3a\u95f4\u9699\u9501\uff0c\u53ea\u5b58\u5728\u4e8e\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u95f4\u9699\u9501\u867d\u7136\u5b58\u5728 X \u578b\u95f4\u9699\u9501\u548c S \u578b\u95f4\u9699\u9501\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c \u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5e76\u4e0d\u5b58\u5728\u4e92\u65a5\u5173\u7cfb\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u7684\u76ee\u7684\u662f\u9632\u6b62\u63d2\u5165\u5e7b\u5f71\u8bb0\u5f55\u800c\u63d0\u51fa\u7684 \u3002","title":"Gap Lock"},{"location":"mysql/lock/how_to_lock/#next-key-lock","text":"Next-Key Lock \u79f0\u4e3a\u4e34\u952e\u9501\uff0c\u662f Record Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5] \u7684 next-key lock\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5373\u4e0d\u80fd\u63d2\u5165 id = 4 \u8bb0\u5f55\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539\u548c\u5220\u9664 id = 5 \u8fd9\u6761\u8bb0\u5f55\u3002 \u6240\u4ee5\uff0cnext-key lock \u5373\u80fd\u4fdd\u62a4\u8be5\u8bb0\u5f55\uff0c\u53c8\u80fd\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u5c06\u65b0\u8bb0\u5f55\u63d2\u5165\u5230\u88ab\u4fdd\u62a4\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u4e2d\u3002 next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684 \u3002 \u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\uff0cX \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\u3002","title":"Next-Key Lock"},{"location":"mysql/lock/how_to_lock/#mysql_1","text":"\u884c\u7ea7\u9501\u52a0\u9501\u89c4\u5219\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u540c\u7684\u573a\u666f\uff0c\u52a0\u9501\u7684\u5f62\u5f0f\u662f\u4e0d\u540c\u7684\u3002 \u52a0\u9501\u7684\u5bf9\u8c61\u662f\u7d22\u5f15\uff0c\u52a0\u9501\u7684\u57fa\u672c\u5355\u4f4d\u662f next-key lock \uff0c\u5b83\u662f\u7531\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7ec4\u5408\u800c\u6210\u7684\uff0c next-key lock \u662f\u524d\u5f00\u540e\u95ed\u533a\u95f4\uff0c\u800c\u95f4\u9699\u9501\u662f\u524d\u5f00\u540e\u5f00\u533a\u95f4 \u3002 \u4f46\u662f\uff0cnext-key lock \u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501\u3002 \u90a3\u5230\u5e95\u662f\u4ec0\u4e48\u573a\u666f\u5462\uff1f\u603b\u7ed3\u4e00\u53e5\uff0c \u5728\u80fd\u4f7f\u7528\u8bb0\u5f55\u9501\u6216\u8005\u95f4\u9699\u9501\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f\u4e0b\uff0c next-key lock \u5c31\u4f1a\u9000\u5316\u6210\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501 \u3002 \u8fd9\u6b21\u4f1a\u4ee5\u4e0b\u9762\u8fd9\u4e2a\u8868\u7ed3\u6784\u6765\u8fdb\u884c\u5b9e\u9a8c\u8bf4\u660e\uff1a CREATE TABLE ` user ` ( ` id ` bigint NOT NULL AUTO_INCREMENT , ` name ` varchar ( 30 ) COLLATE utf8mb4_unicode_ci NOT NULL , ` age ` int NOT NULL , PRIMARY KEY ( ` id ` ), KEY ` index_age ` ( ` age ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ; \u5176\u4e2d\uff0cid \u662f\u4e3b\u952e\u7d22\u5f15\uff08\u552f\u4e00\u7d22\u5f15\uff09\uff0cage \u662f\u666e\u901a\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\uff0cname \u662f\u666e\u901a\u7684\u5217\u3002 \u8868\u4e2d\u7684\u6709\u8fd9\u4e9b\u884c\u8bb0\u5f55\uff1a \u8fd9\u6b21\u5b9e\u9a8c\u73af\u5883\u7684 MySQL \u7248\u672c\u662f 8.0.26\uff0c\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d \u3002 \u4e0d\u540c\u7248\u672c\u7684\u52a0\u9501\u89c4\u5219\u53ef\u80fd\u662f\u4e0d\u540c\u7684\uff0c\u4f46\u662f\u5927\u4f53\u4e0a\u662f\u76f8\u540c\u7684\u3002","title":"MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f"},{"location":"mysql/lock/how_to_lock/#_2","text":"\u5f53\u6211\u4eec\u7528\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u5b58\u4e0d\u5b58\u5728\uff0c\u52a0\u9501\u7684\u89c4\u5219\u4e5f\u4f1a\u4e0d\u540c\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u8fd9\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u8bb0\u5f55\u9501\u300d**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d**\u3002 \u63a5\u4e0b\u91cc\u7528\u4e24\u4e2a\u6848\u4f8b\u6765\u8bf4\u660e\u3002","title":"\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2"},{"location":"mysql/lock/how_to_lock/#1","text":"\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u7b49\u503c\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u4e8e\u8868\u4e2d\u7684\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id = 1 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 1 | \u8def\u98de | 19 | + ----+--------+-----+ 1 row in set ( 0 . 02 sec ) \u90a3\u4e48\uff0c\u4e8b\u52a1 A \u4f1a\u4e3a id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u5c31\u4f1a\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501 \u3002 \u63a5\u4e0b\u6765\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\uff0c\u5bf9 id \u4e3a 1 \u7684\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u6216\u8005\u5220\u9664\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u66f4\u65b0\u6216\u8005\u5220\u9664\u64cd\u4f5c\u4e5f\u4f1a\u5bf9\u8bb0\u5f55\u52a0 X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u800c X \u9501\u548c X \u9501\u4e4b\u95f4\u662f\u4e92\u65a5\u5173\u7cfb\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a \u56e0\u4e3a\u4e8b\u52a1 A \u5bf9 id = 1\u7684\u8bb0\u5f55\u52a0\u4e86 X \u578b\u7684\u8bb0\u5f55\u9501 \uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u4fee\u6539 id=1 \u7684\u8bb0\u5f55\u65f6\u4f1a\u88ab\u963b\u585e\uff0c\u4e8b\u52a1 C \u5728\u5220\u9664 id=1 \u7684\u8bb0\u5f55\u65f6\u4e5f\u4f1a\u88ab\u963b\u585e\u3002 \u6709\u4ec0\u4e48\u547d\u4ee4\u53ef\u4ee5\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u9501\uff1f \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u6211\u4eec\u4ee5\u524d\u9762\u7684\u4e8b\u52a1 A \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u5206\u6790\u4e0b\u4e0b\u5b83\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u8bb0\u5f55\u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u7ea7\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002 \u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c**\u6b64\u65f6\u4e8b\u52a1 A \u5728 id = 1 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u7684\u662f\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u8303\u56f4\u662f id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u3002**\u8fd9\u6837\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u5bf9 id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u4e86\u3002 \u4ece\u8fd9\u91cc\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u77e5\uff0c \u52a0\u9501\u7684\u5bf9\u8c61\u662f\u9488\u5bf9\u7d22\u5f15 \uff0c\u56e0\u4e3a\u8fd9\u91cc\u67e5\u8be2\u8bed\u53e5\u626b\u63cf\u7684 B+ \u6811\u662f\u805a\u7c07\u7d22\u5f15\u6811\uff0c\u5373\u4e3b\u952e\u7d22\u5f15\u6811\uff0c\u6240\u4ee5\u662f\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u3002\u5c06\u5bf9\u5e94\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0 \u8bb0\u5f55\u9501\u540e\uff0c\u5c31\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5bf9\u8be5\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u4e86\u3002 \u4e3a\u4ec0\u4e48\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\uff1f \u539f\u56e0\u5c31\u662f\u5728\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u4ec5\u9760\u8bb0\u5f55\u9501\u4e5f\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u5e7b\u8bfb\u7684\u5b9a\u4e49\u5c31\u662f\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\uff0c\u4e0d\u76f8\u540c\u65f6\uff0c\u5c31\u8ba4\u4e3a\u53d1\u751f\u5e7b\u8bfb\u3002\u6240\u4ee5\uff0c\u8981\u907f\u514d\u5e7b\u8bfb\u5c31\u662f\u907f\u514d\u7ed3\u679c\u96c6\u67d0\u4e00\u6761\u8bb0\u5f55\u88ab\u5176\u4ed6\u4e8b\u52a1\u5220\u9664\uff0c\u6216\u8005\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u8fd9\u6837\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0d\u76f8\u540c\u7684\u60c5\u51b5\u3002 \u7531\u4e8e\u4e3b\u952e\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5**\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id = 1 \u7684\u65f6\u5019\uff0c\u4f1a\u56e0\u4e3a\u4e3b\u952e\u51b2\u7a81\uff0c\u5bfc\u81f4\u65e0\u6cd5\u63d2\u5165 id = 1 \u7684\u65b0\u8bb0\u5f55**\u3002\u8fd9\u6837\u4e8b\u52a1 A \u5728\u591a\u6b21\u67e5\u8be2 id = 1 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u4e0d\u540c\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u7531\u4e8e\u5bf9 id = 1 \u52a0\u4e86\u8bb0\u5f55\u9501\uff0c \u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5220\u9664\u8be5\u8bb0\u5f55 \uff0c\u8fd9\u6837\u4e8b\u52a1 A \u5728\u591a\u6b21\u67e5\u8be2 id = 1 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u4e0d\u540c\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002","title":"1\u3001\u8bb0\u5f55\u5b58\u5728\u7684\u60c5\u51b5"},{"location":"mysql/lock/how_to_lock/#2","text":"\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u7b49\u503c\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u4e8e\u8868\u4e2d\u7684\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id = 2 for update ; Empty set ( 0 . 03 sec ) \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c \u6b64\u65f6\u4e8b\u52a1 A \u5728 id = 5 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u7684\u662f\u95f4\u9699\u9501\uff0c\u9501\u4f4f\u7684\u8303\u56f4\u662f (1, 5)\u3002 \u63a5\u4e0b\u6765\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u8fd9\u4e00\u4e9b\u8bb0\u5f55\u7684\u8bdd\uff0c\u8fd9\u4e9b\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u53d1\u751f\u963b\u585e\u3002 \u6ce8\u610f\uff0c\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u7684 id = 1 \u6216\u8005 id = 5 \u7684\u8bb0\u5f55\u8bdd\uff0c\u5e76\u4e0d\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u800c\u662f\u62a5\u4e3b\u952e\u51b2\u7a81\u7684\u9519\u8bef\uff0c\u56e0\u4e3a\u8868\u4e2d\u5df2\u7ecf\u5b58\u5728 id = 1 \u548c id = 5 \u7684\u8bb0\u5f55\u4e86\u3002 \u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a \u56e0\u4e3a\u4e8b\u52a1 A \u5728 id = 5 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5) \u7684 X \u578b\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u63d2\u5165\u4e00\u6761 id \u4e3a 3 \u7684\u8bb0\u5f55\u65f6\u4f1a\u88ab\u963b\u585e\u4f4f\uff0c\u5373\u65e0\u6cd5\u63d2\u5165 id = 3 \u7684\u8bb0\u5f55\u3002 \u95f4\u9699\u9501\u7684\u8303\u56f4 (1, 5) \uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u300c\u53f3\u8fb9\u754c\u300d\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f 5\u3002 \u7136\u540e\u9501\u8303\u56f4\u7684\u300c\u5de6\u8fb9\u754c\u300d\u662f\u8868\u4e2d id \u4e3a 5 \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684 id \u503c\uff0c\u5373 1\u3002 \u56e0\u6b64\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4 (1, 5) \u3002 \u4e3a\u4ec0\u4e48\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u7684\u573a\u666f\u4e0b\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u8981\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d\uff1f \u539f\u56e0\u5c31\u662f\u5728\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u4ec5\u9760\u95f4\u9699\u9501\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u4e3a\u4ec0\u4e48 id = 5 \u8bb0\u5f55\u4e0a\u7684\u4e3b\u952e\u7d22\u5f15\u7684\u9501\u4e0d\u53ef\u4ee5\u662f next-key lock\uff1f\u5982\u679c\u662f next-key lock\uff0c\u5c31\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5220\u9664 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u8fd9\u6b21\u7684\u6848\u4f8b\u662f\u67e5\u8be2 id = 2 \u7684\u8bb0\u5f55\uff0c\u53ea\u8981\u4fdd\u8bc1\u524d\u540e\u4e24\u6b21\u67e5\u8be2 id = 2 \u7684\u7ed3\u679c\u96c6\u76f8\u540c\uff0c\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u4e86\uff0c\u6240\u4ee5\u5373\u4f7f id =5 \u88ab\u5220\u9664\uff0c\u4e5f\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\uff0c\u90a3\u5c31\u6ca1\u5fc5\u987b\u52a0 next-key lock\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u5728 id = 5 \u52a0\u95f4\u9699\u9501\uff0c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id = 2 \u7684\u65b0\u8bb0\u5f55\u5c31\u884c\u4e86\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u53ef\u4ee5\u9488\u5bf9\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u52a0\u8bb0\u5f55\u9501\uff1f\u9501\u662f\u52a0\u5728\u7d22\u5f15\u4e0a\u7684\uff0c\u800c\u8fd9\u4e2a\u573a\u666f\u4e0b\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u81ea\u7136\u5c31\u6ca1\u529e\u6cd5\u9501\u4f4f\u8fd9\u6761\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u3002","title":"2\u3001\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5"},{"location":"mysql/lock/how_to_lock/#_3","text":"\u8303\u56f4\u67e5\u8be2\u548c\u7b49\u503c\u67e5\u8be2\u7684\u52a0\u9501\u89c4\u5219\u662f\u4e0d\u540c\u7684\u3002 \u5f53\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c \u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u626b\u63cf\u5230\u7684\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u7136\u540e\u5982\u679c\u9047\u5230\u4e0b\u9762\u8fd9\u4e9b\u60c5\u51b5\uff0c\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u8005\u95f4\u9699\u9501 \uff1a \u60c5\u51b5\u4e00\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u56e0\u4e3a\u5b58\u5728\u7b49\u503c\u67e5\u8be2\u7684\u6761\u4ef6\uff0c\u90a3\u4e48\u5982\u679c\u7b49\u503c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u90a3\u4e48\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u8bb0\u5f55\u9501**\u3002 \u60c5\u51b5\u4e8c\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u8981\u770b\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u4e8e\u8868\u4e2d\uff1a \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c \u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501 \uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002 \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u5728\u8868\u4e2d\uff0c\u5982\u679c\u662f\u300c\u5c0f\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c \u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501 \uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\uff1b\u5982\u679c\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15 next-key \u9501\u4e0d\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002 \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u51e0\u4e2a\u5b9e\u9a8c\uff0c\u624d\u9a8c\u8bc1\u6211\u4e0a\u9762\u8bf4\u7684\u7ed3\u8bba\u3002","title":"\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2"},{"location":"mysql/lock/how_to_lock/#1_1","text":"\u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id > 15 for update ; + ----+-----------+-----+ | id | name | age | + ----+-----------+-----+ | 20 | \u9999\u514b\u65af | 39 | + ----+-----------+-----+ 1 row in set ( 0 . 01 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 20\uff0c\u7531\u4e8e\u67e5\u8be2\u8be5\u8bb0\u5f55\u4e0d\u662f\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\uff08\u4e0d\u662f\u5927\u4e8e\u7b49\u4e8e\u6761\u4ef6\u67e5\u8be2\uff09\uff0c\u6240\u4ee5\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u867d\u7136\u6211\u4eec\u770b\u89c1\u8868\u4e2d\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u662f id = 20 \u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u5b9e\u9645\u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u4f1a\u7528\u4e00\u4e2a\u7279\u6b8a\u7684\u8bb0\u5f55\u6765\u6807\u8bc6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff0c\u8be5\u7279\u6b8a\u7684\u8bb0\u5f55\u7684\u540d\u5b57\u53eb supremum pseudo-record \uff0c\u6240\u4ee5\u626b\u63cf\u7b2c\u4e8c\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u626b\u63cf\u5230\u4e86\u8fd9\u4e2a\u7279\u6b8a\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\u3002 \u505c\u6b62\u626b\u63cf\u3002 \u53ef\u4ee5\u5f97\u77e5\uff0c\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b \u7684 next-key \u9501\uff1a \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5f97\u5230**\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b \u7684next-key \u9501\uff1a** \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id >= 15 for update ; + ----+-----------+-----+ | id | name | age | + ----+-----------+-----+ | 15 | \u4e4c\u7d22\u666e | 20 | | 20 | \u9999\u514b\u65af | 39 | + ----+-----------+-----+ 2 rows in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 15\uff0c\u7531\u4e8e\u67e5\u8be2\u8be5\u8bb0\u5f55\u662f\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\uff08\u7b49\u4e8e 15\uff09\uff0c\u6240\u4ee5\u8be5\u4e3b\u952e\u7d22\u5f15\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u8bb0\u5f55\u9501**\uff0c\u4e5f\u5c31\u662f\u4ec5\u9501\u4f4f id = 15 \u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 20\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff1b \u63a5\u7740\u626b\u63cf\u5230\u7b2c\u4e09\u884c\u7684\u65f6\u5019\uff0c\u626b\u63cf\u5230\u4e86\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\u3002 \u505c\u6b62\u626b\u63cf\u3002 \u53ef\u4ee5\u5f97\u77e5\uff0c\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e09\u4e2a X \u578b \u7684\u9501\uff0c\u5206\u522b\u662f\uff1a \u5728 id = 15 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u8303\u56f4\u662f id = 15 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1b\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 15 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff1b \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 next-key \u9501\uff0c\u8303\u56f4\u662f (15, 20] \u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728\u7279\u6b8a\u8bb0\u5f55\uff08 supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 next-key \u9501\uff0c\u8303\u56f4\u662f (20, +\u221e] \u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u901a\u8fc7\u524d\u9762\u8fd9\u4e2a\u5b9e\u9a8c\uff0c\u6211\u4eec\u8bc1\u660e\u4e86\uff1a \u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u4e0b\uff0c \u5982\u679c\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u90a3\u4e48\u7531\u4e8e\u67e5\u8be2\u8be5\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u662f\u5305\u542b\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u8bb0\u5f55\u9501**\u3002","title":"1\u3001\u9488\u5bf9\u300c\u5927\u4e8e\u6216\u8005\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2"},{"location":"mysql/lock/how_to_lock/#2_1","text":"\u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff0c\u6ce8\u610f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 6\uff09\u5e76\u4e0d\u5b58\u5728\u4e8e\u8868\u4e2d\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id < 6 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 1 | \u8def\u98de | 19 | | 5 | \u7d22\u9686 | 21 | + ----+--------+-----+ 3 rows in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u6240\u4ee5\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u8bb0\u5f55\uff08id = 5\uff09\uff0c\u6ee1\u8db3 id < 6 \u6761\u4ef6\uff0c\u800c\u4e14\u4e5f\u6ca1\u6709\u8fbe\u5230\u7ec8\u6b62\u626b\u63cf\u7684\u6761\u4ef6\uff0c\u63a5\u7740\u4f1a\u7ee7\u7eed\u626b\u63cf\u3002 \u626b\u63cf\u5230\u7684\u7b2c\u4e09\u884c\u662f id = 10\uff0c\u8be5\u8bb0\u5f55\u4e0d\u6ee1\u8db3 id < 6 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5 id = 10 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a (5, 10) \u7684\u95f4\u9699\u9501\u3002 \u7531\u4e8e\u626b\u63cf\u5230\u7684\u7b2c\u4e09\u884c\u8bb0\u5f55\uff08id = 10\uff09\uff0c\u4e0d\u6ee1\u8db3 id < 6 \u6761\u4ef6\uff0c\u8fbe\u5230\u4e86\u7ec8\u6b62\u626b\u63cf\u7684\u6761\u4ef6\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002 \u4ece\u4e0a\u9762\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u77e5\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e09\u4e2a X \u578b\u7684\u9501\uff1a \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 5 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (5, 10) \u7684\u95f4\u9699\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 6\u30017\u30018\u30019 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5f97\u77e5\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u4e09\u4e2a\u9501\uff0c\u5c31\u662f\u6211\u4eec\u524d\u9762\u5206\u6790\u51fa\u90a3\u4e09\u4e2a\u9501\u3002 \u867d\u7136\u8fd9\u6b21\u8303\u56f4\u67e5\u8be2\u7684\u6761\u4ef6\u662f\u300c\u5c0f\u4e8e\u300d\uff0c\u4f46\u662f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u4e8e\u8868\u4e2d\uff08 id \u4e3a 6 \u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff09\uff0c\u6240\u4ee5\u5982\u679c\u4e8b\u52a1 A \u7684\u8303\u56f4\u67e5\u8be2\u7684\u6761\u4ef6\u6539\u6210 <= 6 \u7684\u8bdd\uff0c\u52a0\u7684\u9501\u8fd8\u662f\u548c\u8303\u56f4\u67e5\u8be2\u6761\u4ef6\u4e3a < 6 \u662f\u4e00\u6837\u7684\u3002 \u5927\u5bb6\u81ea\u5df1\u4e5f\u9a8c\u8bc1\u4e0b\u8fd9\u4e2a\u7ed3\u8bba\u3002 \u56e0\u6b64\uff0c \u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u5982\u679c\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u4e2d\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u7684\u8bb0\u5f55\uff0c\u5219\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501 \u3002 \u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff0c\u6ce8\u610f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 5\uff09\u5b58\u5728\u4e8e\u8868\u4e2d\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where id <= 5 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 1 | \u8def\u98de | 19 | | 5 | \u7d22\u9686 | 21 | + ----+--------+-----+ 2 rows in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\u3002 \u7531\u4e8e\u4e3b\u952e\u7d22\u5f15\u5177\u6709\u552f\u4e00\u6027\uff0c\u4e0d\u4f1a\u5b58\u5728\u4e24\u4e2a id = 5 \u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u518d\u7ee7\u7eed\u626b\u63cf\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002 \u4ece\u4e0a\u9762\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230**\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86 2 \u4e2a X \u578b\u7684\u9501**\uff1a \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5] \u7684 next-key \u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 5 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b next-key \u9501\uff0c\u5206\u522b\u662f\uff1a \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a(1, 5 ] \u7684 next-key \u9501\u3002 \u5b9e\u9a8c\u4e09\uff1a\u518d\u6765\u770b\u9488\u5bf9\u300c\u5c0f\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002 \u5982\u679c\u4e8b\u52a1 A \u7684\u67e5\u8be2\u8bed\u53e5\u662f\u5c0f\u4e8e\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u4e14\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 5\uff09\u5b58\u5728\u4e8e\u8868\u4e2d\u3002 select * from user where id < 5 for update ; \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff1b \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u8be5\u8bb0\u5f55\u662f\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3 id < 5 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f**\u8be5\u8bb0\u5f55\u7684\u9501\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\uff0c\u9501\u8303\u56f4\u662f (1,5)**\u3002 \u7531\u4e8e\u627e\u5230\u4e86\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3 id < 5 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002 \u53ef\u4ee5\u5f97\u77e5\uff0c\u6b64\u65f6**\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u79cd X \u578b\u9501\uff1a** \u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1,5) \u7684\u95f4\u9699\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86 X \u578b\u7684\u8303\u56f4\u4e3a (-\u221e, 1] \u7684 next-key \u9501\uff0c\u548c X \u578b\u7684\u8303\u56f4\u4e3a (1, 5) \u7684\u95f4\u9699\u9501 \u3002 \u56e0\u6b64\uff0c\u901a\u8fc7\u524d\u9762\u8fd9\u4e09\u4e2a\u5b9e\u9a8c\uff0c\u53ef\u4ee5\u5f97\u77e5\u3002 \u5728\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u552f\u4e00\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5b58\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4f1a\u5c06\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u7684\uff1a \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u4e0d\u5728\u300d\u8868\u4e2d\u65f6\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002 \u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5728\u300d\u8868\u4e2d\u65f6\uff1a \u5982\u679c\u662f\u300c\u5c0f\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0 next-key \u9501\u3002 \u5982\u679c\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u300c\u4e0d\u4f1a\u300d\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002","title":"2\u3001\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2"},{"location":"mysql/lock/how_to_lock/#_4","text":"\u5f53\u6211\u4eec\u7528\u975e\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\uff0c \u56e0\u4e3a\u5b58\u5728\u4e24\u4e2a\u7d22\u5f15\uff0c\u4e00\u4e2a\u662f\u4e3b\u952e\u7d22\u5f15\uff0c\u4e00\u4e2a\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u6240\u4ee5\u5728\u52a0\u9501\u65f6\uff0c\u540c\u65f6\u4f1a\u5bf9\u8fd9\u4e24\u4e2a\u7d22\u5f15\u90fd\u52a0\u9501\uff0c\u4f46\u662f\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u7684\u65f6\u5019\uff0c\u53ea\u6709\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u624d\u4f1a\u5bf9\u5b83\u4eec\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u9501 \u3002 \u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u5b58\u4e0d\u5b58\u5728\uff0c\u52a0\u9501\u7684\u89c4\u5219\u4e5f\u4f1a\u4e0d\u540c\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u65f6\uff0c\u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u7d22\u5f15\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f**\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u626b\u63cf\u5230\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u5c31\u505c\u6b62\u626b\u63cf\uff0c\u7136\u540e\u5728\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u626b\u63cf\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f next-key \u9501\uff0c\u800c\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u540c\u65f6\uff0c\u5728\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u8bb0\u5f55\u9501**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u65f6\uff0c \u626b\u63cf\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u56e0\u4e3a\u4e0d\u5b58\u5728\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501 \u3002 \u63a5\u4e0b\u91cc\u7528\u4e24\u4e2a\u5b9e\u9a8c\u6765\u8bf4\u660e\u3002","title":"\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2"},{"location":"mysql/lock/how_to_lock/#1_2","text":"\u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u503c\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u3002 \u5148\u6765\u8bf4\u8bf4\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u5bf9\u975e\u552f\u4e00\u7d22\u5f15\uff08age\uff09\u8fdb\u884c\u4e86\u7b49\u503c\u67e5\u8be2\uff0c\u4e14\u8868\u4e2d\u4e0d\u5b58\u5728 age = 25 \u7684\u8bb0\u5f55\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where age = 25 for update ; Empty set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u5b9a\u4f4d\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u5373\u626b\u63cf\u5230 age = 39\uff0c\u4e8e\u662f**\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)**\u3002 \u505c\u6b62\u67e5\u8be2 \u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 X \u578b\u7684\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u300125\u300126\u3001....\u300138 \u8fd9\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 22 \u548c age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age \uff09\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501\u3002 \u6b64\u65f6\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86 age \u503c\u4e3a 23\u300124\u300125\u300126\u3001....\u300138 \u8fd9\u4e9b\u65b0\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e9b\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u53d1\u751f\u963b\u585e\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8bf4\uff01 \u5f53\u6709\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501 (22, 39) \u65f6\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8ba9\u5176\u4ed6\u4e8b\u52a1\u7684\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\u6210\u529f\uff1f\u53c8\u662f\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u65f6\u7684\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff1f \u6211\u4eec\u5148\u8981\u6e05\u695a\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\u3002 \u63d2\u5165\u8bed\u53e5\u5728\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b9a\u4f4d\u5230\u8be5\u8bb0\u5f55\u5728 B+\u6811 \u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u624d\u4f1a\u53d1\u751f\u963b\u585e \u3002 \u5728\u5206\u6790\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501\u662f\u5426\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u8bb0\u5f55\u65f6\uff0c\u6211\u4eec\u8981\u5148\u8981\u77e5\u9053\u4e8c\u7ea7\u7d22\u5f15\u6811\u662f\u5982\u4f55\u5b58\u653e\u8bb0\u5f55\u7684\uff1f \u4e8c\u7ea7\u7d22\u5f15\u6811\u662f\u6309\u7167\u4e8c\u7ea7\u7d22\u5f15\u503c\uff08age\u5217\uff09\u6309\u987a\u5e8f\u5b58\u653e\u7684\uff0c\u5728\u76f8\u540c\u7684\u4e8c\u7ea7\u7d22\u5f15\u503c\u60c5\u51b5\u4e0b\uff0c \u518d\u6309\u4e3b\u952e id \u7684\u987a\u5e8f\u5b58\u653e\u3002\u77e5\u9053\u4e86\u8fd9\u4e2a\u524d\u63d0\uff0c\u6211\u4eec\u624d\u80fd\u77e5\u9053\u6267\u884c\u63d2\u5165\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u8c01\u3002 \u57fa\u4e8e\u524d\u9762\u7684\u5b9e\u9a8c\uff0c\u4e8b\u52a1 A \u662f\u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 X \u578b\u7684\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)\u3002 \u63d2\u5165 age = 22 \u8bb0\u5f55\u7684\u6210\u529f\u548c\u5931\u8d25\u7684\u60c5\u51b5\u5206\u522b\u5982\u4e0b\uff1a \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 3 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 10\u3001age = 22 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6ca1\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u53ef\u4ee5\u6267\u884c\u6210\u529f**\u3002 \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 12 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f**\u3002 \u63d2\u5165 age = 39 \u8bb0\u5f55\u7684\u6210\u529f\u548c\u5931\u8d25\u7684\u60c5\u51b5\u5206\u522b\u5982\u4e0b\uff1a \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 39\uff0cid = 3 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f**\u3002 \u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 39\uff0cid = 21 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c**\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0d\u5b58\u5728\uff0c\u4e5f\u5c31\u6ca1\u6709\u95f4\u9699\u9501\u4e86\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u53ef\u4ee5\u63d2\u5165\u6210\u529f**\u3002 \u6240\u4ee5\uff0c \u5f53\u6709\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501 (22, 39) \u65f6\uff0c\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\u662f\u5426\u53ef\u4ee5\u6267\u884c\u6210\u529f\uff0c\u5173\u952e\u8fd8\u8981\u8003\u8651\u63d2\u5165\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\uff0c\u56e0\u4e3a\u300c\u4e8c\u7ea7\u7d22\u5f15\u503c\uff08age\u5217\uff09+\u4e3b\u952e\u503c\uff08id\u5217\uff09\u300d\u624d\u53ef\u4ee5\u786e\u5b9a\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u786e\u5b9a\u4e86\u63d2\u5165\u4f4d\u7f6e\u540e\uff0c\u5c31\u8981\u770b\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u6709\u95f4\u9699\u9501\uff0c\u5982\u679c\u6709\u95f4\u9699\u9501\uff0c\u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u5982\u679c\u6ca1\u6709\u95f4\u9699\u9501\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f \u3002 \u77e5\u9053\u4e86\u8fd9\u4e2a\u7ed3\u8bba\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u56de\u8fc7\u5934\u770b\uff0c\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u65f6\uff0c\u6267\u884c select * from performance_schema.data_locks\\G; \u8f93\u51fa\u7684\u7ed3\u679c\u3002 \u5728\u524d\u9762\u5206\u6790\u8f93\u51fa\u7ed3\u679c\u7684\u65f6\u5019\uff0c\u6211\u8bf4\u7684\u7ed3\u8bba\u662f\uff1a\u300c \u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age \uff09\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501 \u300d\u3002\u8fd9\u4e2a\u7ed3\u8bba\u5176\u5b9e\u8fd8\u4e0d\u591f\u51c6\u786e\uff0c\u56e0\u4e3a\u53ea\u8003\u8651\u4e86 LOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\uff0839\uff09\uff0c\u6ca1\u6709\u8003\u8651 LOCK_DATA \u7b2c\u4e8c\u4e2a\u6570\u503c\uff0820\uff09\u3002 \u90a3 LOCK_DATA\uff1a39\uff0c20 \u662f\u4ec0\u4e48\u610f\u601d\uff1f LOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\uff0c\u4e5f\u5c31\u662f 39\uff0c \u5b83\u4ee3\u8868\u7684\u662f age \u503c\u3002\u4ece\u524d\u9762\u6211\u4eec\u4e5f\u77e5\u9053\u4e86\uff0cLOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\u662f next-key \u9501\u548c\u95f4\u9699\u9501**\u9501\u4f4f\u7684\u8303\u56f4\u7684\u53f3\u8fb9\u754c\u503c**\u3002 LOCK_DATA \u7b2c\u4e8c\u4e2a\u6570\u503c\uff0c\u4e5f\u5c31\u662f 20\uff0c \u5b83\u4ee3\u8868\u7684\u662f id \u503c\u3002 \u4e4b\u6240\u4ee5 LOCK_DATA \u8981\u591a\u663e\u793a\u4e00\u4e2a\u6570\u503c\uff08ID\u503c\uff09\uff0c\u662f\u56e0\u4e3a\u9488\u5bf9\u300c\u5f53\u67d0\u4e2a\u4e8b\u52a1\u6301\u6709\u975e\u552f\u4e00\u7d22\u5f15\u7684 (22, 39) \u95f4\u9699\u9501\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 39 \u65b0\u8bb0\u5f55\u300d\u7684\u95ee\u9898\uff0c\u8fd8\u9700\u8981\u8003\u8651\u63d2\u5165\u8bb0\u5f55\u7684 id \u503c\u3002\u800c LOCK_DATA \u7684\u7b2c\u4e8c\u4e2a\u6570\u503c\uff0c\u5c31\u662f\u8bf4\u660e\u5728\u63d2\u5165 age = 39 \u65b0\u8bb0\u5f55\u65f6\uff0c\u54ea\u4e9b\u8303\u56f4\u7684 id \u503c\u662f\u4e0d\u53ef\u4ee5\u63d2\u5165\u7684 \u3002 \u56e0\u6b64\uff0c LOCK_DATA\uff1a39\uff0c20 + LOCK_MODE : X, GAP \u7684\u610f\u601d\u662f\uff0c\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age \uff09\uff0c\u52a0\u4e86 age \u503c\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501\uff0c**\u540c\u65f6\u9488\u5bf9\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 39 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u4e0d\u5141\u8bb8\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 20 **\u3002\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 20\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002 \u4f46\u662f\u6211\u4eec\u65e0\u6cd5\u4ece select * from performance_schema.data_locks\\G; \u8f93\u51fa\u7684\u7ed3\u679c\u5206\u6790\u51fa\u300c\u5728\u63d2\u5165 age =22 \u65b0\u8bb0\u5f55\u65f6\uff0c\u54ea\u4e9b\u8303\u56f4\u7684 id \u503c\u662f\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u7684\u300d\uff0c\u8fd9\u65f6\u5019\u5c31**\u5f97\u81ea\u5df1\u753b\u51fa\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u7ed3\u6784\uff0c\u7136\u540e\u786e\u5b9a\u63d2\u5165\u4f4d\u7f6e\u540e\uff0c\u770b\u4e0b\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5982\u679c\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5219\u65e0\u6cd5\u63d2\u5165\u6210\u529f\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f**\u3002","title":"1\u3001\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5"},{"location":"mysql/lock/how_to_lock/#2_2","text":"\u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u503c\u5b58\u5728\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u4e8b\u52a1 A \u5bf9\u975e\u552f\u4e00\u7d22\u5f15\uff08age\uff09\u8fdb\u884c\u4e86\u7b49\u503c\u67e5\u8be2\uff0c\u4e14\u8868\u4e2d\u5b58\u5728 age = 22 \u7684\u8bb0\u5f55\u3002 mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where age = 22 for update ; + ----+--------+-----+ | id | name | age | + ----+--------+-----+ | 10 | \u5c71\u6cbb | 22 | + ----+--------+-----+ 1 row in set ( 0 . 00 sec ) \u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a \u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f age = 22\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u4e0a\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\u3002\u540c\u65f6\uff0c\u56e0\u4e3a age = 22 \u7b26\u5408\u67e5\u8be2\u6761\u4ef6\uff0c\u4e8e\u662f\u5bf9 age = 22 \u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u4e0a\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 10 \u8fd9\u4e00\u884c\u52a0\u8bb0\u5f55\u9501\u3002 \u63a5\u7740\u7ee7\u7eed\u626b\u63cf\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f age = 39\uff0c\u8be5\u8bb0\u5f55\u662f\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u6240\u4ee5\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a**\u9000\u5316\u6210\u95f4\u9699\u9501**\uff0c\u8303\u56f4\u662f (22, 39)\u3002 \u505c\u6b62\u67e5\u8be2\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u90fd\u52a0\u4e86 X \u578b\u7684\u9501\uff1a \u4e3b\u952e\u7d22\u5f15\uff1a \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u4e8c\u7ea7\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\uff1a \u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 20 \u548c age = 21 \u65b0\u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002 \u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u3001..... \u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 22 \u548c age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002 \u4ece\u4e0a\u56fe\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e8c\u7ea7\u7d22\u5f15\uff08INDEX_NAME: index_age \uff09\u52a0\u4e86\u4e24\u4e2a X \u578b\u9501\uff0c\u5206\u522b\u662f\uff1a \u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u9488\u5bf9\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u548c age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u5206\u6790\u5982\u4e0b\uff1a \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c \u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 5\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u63d2\u5165\u6210\u529f \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 5\uff0cage = 21 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6ca1\u6709\u95f4\u9699\u9501\u3002 \u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 5\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u63d2\u5165\u6210\u529f \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 20\uff0cage = 39 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\u3002 \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece LOCK_DATA : 22, 10 \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c \u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff1b\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u5927\u4e8e 10\uff0c\u8fd8\u8981\u770b\u8be5\u65b0\u8bb0\u5f55\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u6709\u95f4\u9699\u9501\uff0c\u5982\u679c\u6ca1\u6709\u95f4\u9699\u9501\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\uff0c\u5982\u679c\u6709\u95f4\u9699\u9501\uff0c\u5219\u65e0\u6cd5\u63d2\u5165\u6210\u529f \u3002 \u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u3001..... \u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u9488\u5bf9\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u548c age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u5206\u6790\u5982\u4e0b\uff1a \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c \u5982\u679c\u63d2\u5165 age = 22 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165 \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 10\uff0cage = 22 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff08 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709 next-key \u9501\uff09\u3002 \u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 10\uff0c\u4e5f\u65e0\u6cd5\u63d2\u5165 \uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 20\uff0cage = 39 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\u3002 \u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece LOCK_DATA : 39, 20 \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 39 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c \u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 20\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u5927\u4e8e 20\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f \u3002 \u540c\u65f6\uff0c\u4e8b\u52a1 A \u8fd8\u5bf9\u4e3b\u952e\u7d22\u5f15\uff08INDEX_NAME: PRIMARY \uff09\u52a0\u4e86X \u578b\u7684\u8bb0\u5f55\u9501\uff1a \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u5b9e\u9a8c\u6848\u4f8b\u4e2d\uff0c\u9700\u8981\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\uff1f \u8981\u627e\u5230\u8fd9\u4e2a\u95ee\u9898\u7684\u7b54\u6848\uff0c\u6211\u4eec\u8981\u660e\u767d MySQL \u5728\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b\u573a\u666f\u4e0b\uff0c\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u95f4\u9699\u9501\uff1f\u5176\u5b9e**\u662f\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f**\u3002 \u5982\u679c\u8fd9\u4e2a\u5b9e\u9a8c\u6848\u4f8b\u4e2d\uff1a select * from user where age = 22 for update ; \u5982\u679c\u4e8b\u52a1 A \u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\uff0c\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f1a\u6709\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u524d\u9762\u6211\u4e5f\u8bf4\u8fc7\uff0c\u5728\u975e\u552f\u4e00\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u662f\u65e0\u6cd5\u5b8c\u5168\u9501\u4f4f age = 22 \u65b0\u8bb0\u5f55\u7684\u63d2\u5165\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece LOCK_DATA : 22, 10 \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff0c \u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 10\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f \u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\u4e0a\u52a0\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u6709\u53ef\u80fd\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u7684\uff08\u6bd4\u5982\u63d2\u5165\u4e00\u4e2a age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\uff09\uff0c\u90a3\u4e48\u5982\u679c\u4e8b\u52a1 A \u518d\u4e00\u6b21\u67e5\u8be2 age = 22 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u524d\u540e\u4e24\u6b21\u67e5\u8be2 age = 22 \u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u8fd9\u65f6\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002 \u90a3\u4e48\u5f53\u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684\u95f4\u9699\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u65e0\u6cd5\u63d2\u5165\u4e00\u4e2a age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\uff0c\u56e0\u4e3a\u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f \u3002 \u6240\u4ee5\uff0c\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff0c\u5c31\u9700\u8981\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002","title":"2\u3001\u8bb0\u5f55\u5b58\u5728\u7684\u60c5\u51b5"},{"location":"mysql/lock/how_to_lock/#_5","text":"\u975e\u552f\u4e00\u7d22\u5f15\u548c\u4e3b\u952e\u7d22\u5f15\u7684\u8303\u56f4\u67e5\u8be2\u7684\u52a0\u9501\u4e5f\u6709\u6240\u4e0d\u540c\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e**\u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u7d22\u5f15\u7684 next-key lock \u4e0d\u4f1a\u6709\u9000\u5316\u4e3a\u95f4\u9699\u9501\u548c\u8bb0\u5f55\u9501\u7684\u60c5\u51b5**\uff0c\u4e5f\u5c31\u662f\u975e\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5bf9\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u9501\u90fd\u662f\u52a0 next-key \u9501\u3002 \u5c31\u5e26\u5927\u5bb6\u7b80\u5355\u5206\u6790\u4e00\u4e0b\uff0c\u4e8b\u52a1 A \u7684\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from user where age >= 22 for update ; + ----+-----------+-----+ | id | name | age | + ----+-----------+-----+ | 10 | \u5c71\u6cbb | 22 | | 20 | \u9999\u514b\u65af | 39 | + ----+-----------+-----+ 2 rows in set ( 0 . 01 sec ) \u4e8b\u52a1 A \u7684\u52a0\u9501\u53d8\u5316\uff1a \u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f age = 22\uff0c\u867d\u7136\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\u5305\u542b\u7b49\u503c\u67e5\u8be2\uff0c\u4f46\u662f\u8fd9\u91cc\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u6240\u4ee5\u662f\u4e0d\u4f1a\u53d1\u751f\u9000\u5316\u9501\u7684\u73b0\u8c61\uff0c\u56e0\u6b64\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0 next-key \u9501\uff0c\u8303\u56f4\u662f (21, 22]\u3002\u540c\u65f6\uff0c\u5bf9 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 10 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\u3002 \u7531\u4e8e\u662f\u8303\u56f4\u67e5\u8be2\uff0c\u63a5\u7740\u7ee7\u7eed\u626b\u63cf\u5df2\u7ecf\u5b58\u5728\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u3002\u626b\u9762\u7684\u7b2c\u4e8c\u884c\u662f age = 39 \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0 next-key \u9501\uff0c\u8303\u56f4\u662f (22, 39]\uff0c\u540c\u65f6\uff0c\u5bf9 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 20 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\u3002 \u867d\u7136\u6211\u4eec\u770b\u89c1\u8868\u4e2d\u6700\u540e\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u662f age = 39 \u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u5b9e\u9645\u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u4f1a\u7528\u4e00\u4e2a\u7279\u6b8a\u7684\u8bb0\u5f55\u6765\u6807\u8bc6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff0c\u8be5\u7279\u6b8a\u7684\u8bb0\u5f55\u7684\u540d\u5b57\u53eb supremum pseudo-record \uff0c\u6240\u4ee5\u626b\u63cf\u7b2c\u4e8c\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u626b\u63cf\u5230\u4e86\u8fd9\u4e2a\u7279\u6b8a\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a (39, +\u221e] \u7684 next-key \u9501\u3002 \u505c\u6b62\u67e5\u8be2 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u90fd\u52a0\u4e86 X \u578b\u7684\u9501\uff1a \u4e3b\u952e\u7d22\u5f15\uff08id \u5217\uff09\uff1a \u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002 \u4e8c\u7ea7\u7d22\u5f15\uff08age \u5217\uff09\uff1a \u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u4e0d\u8fc7\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u548c age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u9700\u8981\u770b\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u6709\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u6211\u4eec\u524d\u9762\u4e5f\u8bb2\u4e86\u3002 \u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 39 \u7684\u8fd9\u4e00\u4e9b\u8bb0\u5f55\uff0c\u4e5f\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u300125\u3001...\u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u548c age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u9700\u8981\u770b\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u6709\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u6211\u4eec\u524d\u9762\u4e5f\u8bb2\u4e86\u3002 \u5728\u7279\u6b8a\u7684\u8bb0\u5f55\uff08supremum pseudo-record\uff09\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (39, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u5927\u4e8e 39 \u7684\u8fd9\u4e9b\u65b0\u8bb0\u5f55\u3002 \u5728 age >= 22 \u7684\u8303\u56f4\u67e5\u8be2\u4e2d\uff0c\u660e\u660e\u67e5\u8be2 age = 22 \u7684\u8bb0\u5f55\u5b58\u5728\u5e76\u4e14\u5c5e\u4e8e\u7b49\u503c\u67e5\u8be2\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u50cf\u552f\u4e00\u7d22\u5f15\u90a3\u6837\uff0c\u5c06 age = 22 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u7684 next-key \u9501\u9000\u5316\u4e3a\u8bb0\u5f55\u9501\uff1f \u56e0\u4e3a age \u5b57\u6bb5\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff0c\u4e0d\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u5982\u679c\u53ea\u52a0\u8bb0\u5f55\u9501\uff08\u8bb0\u5f55\u9501\u65e0\u6cd5\u9632\u6b62\u63d2\u5165\uff0c\u53ea\u80fd\u9632\u6b62\u5220\u9664\u6216\u8005\u4fee\u6539\uff09\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22 \u7684\u8bb0\u5f55\uff0c\u8fd9\u6837\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u76f8\u540c\u4e86\uff0c\u51fa\u73b0\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002","title":"\u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2"},{"location":"mysql/lock/how_to_lock/#_6","text":"\u524d\u9762\u7684\u6848\u4f8b\uff0c\u6211\u4eec\u7684\u67e5\u8be2\u8bed\u53e5\u90fd\u6709\u4f7f\u7528\u7d22\u5f15\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u67e5\u8be2\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u662f\u901a\u8fc7\u7d22\u5f15\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\u7684\uff0c\u7136\u540e\u5bf9\u626b\u63cf\u51fa\u6765\u7684\u8bb0\u5f55\u8fdb\u884c\u52a0\u9501\u3002 \u5982\u679c\u9501\u5b9a\u8bfb\u67e5\u8be2\u8bed\u53e5\uff0c\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\u5217\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6\uff0c\u6216\u8005\u67e5\u8be2\u8bed\u53e5\u6ca1\u6709\u8d70\u7d22\u5f15\u67e5\u8be2\uff0c\u5bfc\u81f4\u626b\u63cf\u662f\u5168\u8868\u626b\u63cf\u3002\u90a3\u4e48\uff0c\u6bcf\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u90fd\u4f1a\u52a0 next-key \u9501\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u9501\u4f4f\u7684\u5168\u8868\uff0c\u8fd9\u65f6\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u5bf9\u8be5\u8868\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u88ab\u963b\u585e \u3002 \u4e0d\u53ea\u662f\u9501\u5b9a\u8bfb\u67e5\u8be2\u8bed\u53e5\u4e0d\u52a0\u7d22\u5f15\u624d\u4f1a\u5bfc\u81f4\u8fd9\u79cd\u60c5\u51b5\uff0cupdate \u548c delete \u8bed\u53e5\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e0d\u52a0\u7d22\u5f15\uff0c\u90a3\u4e48\u7531\u4e8e\u626b\u63cf\u7684\u65b9\u5f0f\u662f\u5168\u8868\u626b\u63cf\uff0c\u4e8e\u662f\u5c31\u4f1a\u5bf9\u6bcf\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u90fd\u4f1a\u52a0 next-key \u9501\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u9501\u4f4f\u7684\u5168\u8868\u3002 \u56e0\u6b64\uff0c \u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002","title":"\u6ca1\u6709\u52a0\u7d22\u5f15\u7684\u67e5\u8be2"},{"location":"mysql/lock/how_to_lock/#_7","text":"\u8fd9\u6b21\u6211\u4ee5 MySQL 8.0.26 \u7248\u672c\uff0c\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e4b\u4e0b\uff0c\u505a\u4e86\u51e0\u4e2a\u5b9e\u9a8c\uff0c\u8ba9\u5927\u5bb6\u4e86\u89e3\u4e86\u552f\u4e00\u7d22\u5f15\u548c\u975e\u552f\u4e00\u7d22\u5f15\u7684\u884c\u7ea7\u9501\u7684\u52a0\u9501\u89c4\u5219\u3002 \u6211\u8fd9\u91cc\u603b\u7ed3\u4e0b\uff0c MySQL \u884c\u7ea7\u9501\u7684\u52a0\u9501\u89c4\u5219\u3002 \u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u8fd9\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u8bb0\u5f55\u9501\u300d**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a**\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d**\u3002 \u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\uff1a \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u65f6\uff0c\u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u7d22\u5f15\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u626b\u63cf\u5230\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u5c31\u505c\u6b62\u626b\u63cf\uff0c\u7136\u540e**\u5728\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u626b\u63cf\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f next-key \u9501\uff0c\u800c\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u540c\u65f6\uff0c\u5728\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u8bb0\u5f55\u9501**\u3002 \u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u65f6\uff0c \u626b\u63cf\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u56e0\u4e3a\u4e0d\u5b58\u5728\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501 \u3002 \u975e\u552f\u4e00\u7d22\u5f15\u548c\u4e3b\u952e\u7d22\u5f15\u7684\u8303\u56f4\u67e5\u8be2\u7684\u52a0\u9501\u89c4\u5219\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a \u552f\u4e00\u7d22\u5f15\u5728\u6ee1\u8db3\u4e00\u4e9b\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u7d22\u5f15\u7684 next-key lock \u9000\u5316\u4e3a\u95f4\u9699\u9501\u6216\u8005\u8bb0\u5f55\u9501\u3002 \u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u7d22\u5f15\u7684 next-key lock \u4e0d\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\u548c\u8bb0\u5f55\u9501\u3002 \u5176\u5b9e\u7406\u89e3 MySQL \u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u52a0\u9501\uff0c\u4e3b\u8981\u8981\u4ee5\u907f\u514d\u5e7b\u8bfb\u89d2\u5ea6\u53bb\u5206\u6790\uff0c\u8fd9\u6837\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u8fd9\u4e9b\u52a0\u9501\u7684\u89c4\u5219\u4e86\u3002 \u8fd8\u6709\u4e00\u4ef6\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c \u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002 \u6700\u540e\u9644\u4e0a\u300c@\u4e00\u53ea\u5c0f\u94ed\u300d\u540c\u5b66\u603b\u7ed3\u7684\u6d41\u7a0b\u56fe\u3002 \u552f\u4e00\u7d22\u5f15\u52a0\u9501\u7684\u6d41\u7a0b\u56fe\uff1a \u975e\u552f\u4e00\u7d22\u5f15\u52a0\u9501\u7684\u6d41\u7a0b\u56fe\uff1a \u5c31\u8bf4\u5230\u8fd9\u5566\uff0c \u6211\u4eec\u4e0b\u6b21\u89c1\u5566\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/lock/lock_phantom/","text":"MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6628\u5929\u6709\u4f4d\u8bfb\u8005\u5728\u7f8e\u56e2\u4e8c\u9762\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u5173\u4e8e\u5e7b\u8bfb\u7684\u95ee\u9898\uff1a \u9762\u8bd5\u5b98\u53cd\u95ee\u7684\u5927\u6982\u610f\u601d\u662f\uff0c MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f \u7b54\u6848\u662f\u53ef\u4ee5\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u51e0\u4e2a\u5c0f\u5b9e\u9a8c\u6765\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u5427\uff0c\u987a\u4fbf\u518d\u5e2e\u5927\u5bb6\u590d\u4e60\u4e00\u4e0b\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u3002 \u4ec0\u4e48\u662f\u5e7b\u8bfb\uff1f \u00b6 \u9996\u5148\u6765\u770b\u770b MySQL \u6587\u6863\u662f\u600e\u4e48\u5b9a\u4e49\u5e7b\u8bfb\uff08Phantom Read\uff09\u7684: The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a \u201cphantom\u201d row. \u7ffb\u8bd1\uff1a\u5f53\u540c\u4e00\u4e2a\u67e5\u8be2\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u4ea7\u751f\u4e0d\u540c\u7684\u7ed3\u679c\u96c6\u65f6\uff0c\u4e8b\u52a1\u4e2d\u5c31\u4f1a\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8c61\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5982\u679c SELECT \u6267\u884c\u4e86\u4e24\u6b21\uff0c\u4f46\u7b2c\u4e8c\u6b21\u8fd4\u56de\u4e86\u7b2c\u4e00\u6b21\u6ca1\u6709\u8fd4\u56de\u7684\u884c\uff0c\u5219\u8be5\u884c\u662f\u201c\u5e7b\u50cf\u201d\u884c\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e00\u4e2a\u4e8b\u52a1\u5728 T1 \u65f6\u523b\u548c T2 \u65f6\u523b\u5206\u522b\u6267\u884c\u4e86\u4e0b\u9762\u67e5\u8be2\u8bed\u53e5\uff0c\u9014\u4e2d\u6ca1\u6709\u6267\u884c\u5176\u4ed6\u4efb\u4f55\u8bed\u53e5\uff1a SELECT * FROM t_test WHERE id > 100 ; \u53ea\u8981 T1 \u548c T2 \u65f6\u523b\u6267\u884c\u4ea7\u751f\u7684\u7ed3\u679c\u96c6\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a - T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 6 \u6761\u884c\u8bb0\u5f55\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 - T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 4 \u6761\u884c\u8bb0\u5f55\uff0c\u4e5f\u662f\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 MySQL \u662f\u600e\u4e48\u89e3\u51b3\u5e7b\u8bfb\u7684\uff1f MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7 \u6587\u7ae0 \uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a - \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 - \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u5b9e\u9a8c\u9a8c\u8bc1 \u00b6 \u63a5\u4e0b\u6765\uff0c\u6765\u9a8c\u8bc1\u300c MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501**\u53ef\u4ee5\u9632\u6b62**\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u95ee\u9898\u300d\u7684\u7ed3\u8bba\u3002 \u5b9e\u9a8c\u73af\u5883\uff1aMySQL 8.0 \u7248\u672c\uff0c\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u3002 \u73b0\u5728\u6709\u4e00\u5f20\u7528\u6237\u8868\uff08t_user\uff09\uff0c\u8868\u91cc**\u53ea\u6709\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15**\uff0c\u8868\u91cc\u6709\u4ee5\u4e0b\u884c\u6570\u636e\uff1a \u73b0\u5728\u6709\u4e00\u4e2a A \u4e8b\u52a1\u6267\u884c\u4e86\u4e00\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u5230\u5e74\u9f84\u5927\u4e8e 20 \u5c81\u7684\u7528\u6237\u5171\u6709 6 \u6761\u884c\u8bb0\u5f55\u3002 \u7136\u540e\uff0c B \u4e8b\u52a1\u6267\u884c\u4e86\u4e00\u6761\u5220\u9664 id = 2 \u7684\u8bed\u53e5\uff1a \u6b64\u65f6\uff0cB \u4e8b\u52a1\u7684\u5220\u9664\u8bed\u53e5\u5c31\u9677\u5165\u4e86**\u7b49\u5f85\u72b6\u6001**\uff0c\u8bf4\u660e\u662f\u65e0\u6cd5\u8fdb\u884c\u5220\u9664\u7684\u3002 \u56e0\u6b64\uff0cMySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501**\u53ef\u4ee5\u9632\u6b62**\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u95ee\u9898\u3002 \u52a0\u9501\u5206\u6790 \u00b6 \u95ee\u9898\u6765\u4e86\uff0cA \u4e8b\u52a1\u5728\u6267\u884c select ... for update \u8bed\u53e5\u65f6\uff0c\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7684\u5185\u5bb9\u5f88\u591a\uff0c\u5171\u6709 11 \u884c\u4fe1\u606f\uff0c\u6211\u5220\u51cf\u4e86\u4e00\u4e9b\u4e0d\u91cd\u8981\u7684\u4fe1\u606f\uff1a \u4ece\u4e0a\u9762\u8f93\u51fa\u7684\u4fe1\u606f\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u79cd\u4e0d\u540c\u7c92\u5ea6\u7684\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff08 LOCK_TYPE: TABLE \uff09\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff08 LOCK_TYPE: RECORD \uff09\uff1aX \u7c7b\u578b\u7684 next-key \u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u300c\u884c\u9501\u300d\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff1a - \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b - \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b - \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b \u7136\u540e\u901a\u8fc7 LOCK_DATA \u4fe1\u606f\uff0c\u53ef\u4ee5\u786e\u8ba4 next-key \u9501\u7684\u8303\u56f4\uff0c\u5177\u4f53\u600e\u4e48\u786e\u5b9a\u5462\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c \uff0c\u800c\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u4e3a LOCK_DATA \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684\u503c\u3002 \u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\uff08 INDEX_NAME : PRIMARY \uff09\u4e0a\u52a0\u4e86 10 \u4e2a next-key \u9501\uff0c\u5982\u4e0b\uff1a - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(-\u221e, 1] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(1, 2] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(2, 3] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(3, 4] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(4, 5] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(5, 6] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(6, 7] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(7, 8] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(8, 9] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(9, +\u221e] \u8fd9\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u7ed9\u9501\u4f4f\u4e86\uff0c\u5176\u4ed6\u4e8b\u52a1\u5728\u5bf9\u8be5\u8868\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u7684\u65f6\u5019\u90fd\u4f1a\u88ab\u963b\u585e \u3002 \u53ea\u6709\u5728\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u4e8b\u52a1 A \u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u9501\u624d\u4f1a\u88ab\u91ca\u653e\u3002 \u4e3a\u4ec0\u4e48\u53ea\u662f\u67e5\u8be2\u5e74\u9f84 20 \u5c81\u4ee5\u4e0a\u884c\u8bb0\u5f55\uff0c\u800c\u628a\u6574\u4e2a\u8868\u7ed9\u9501\u4f4f\u4e86\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 A \u7684\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u662f**\u5168\u8868\u626b\u63cf\uff0c\u9501\u662f\u5728\u904d\u5386\u7d22\u5f15\u7684\u65f6\u5019\u52a0\u4e0a\u7684\uff0c\u5e76\u4e0d\u662f\u9488\u5bf9\u8f93\u51fa\u7684\u7ed3\u679c\u52a0\u9501**\u3002 \u56e0\u6b64\uff0c \u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002 \u5982\u679c\u5bf9 age \u5efa\u7acb\u7d22\u5f15\uff0c\u4e8b\u52a1 A \u8fd9\u6761\u67e5\u8be2\u4f1a\u52a0\u4ec0\u4e48\u9501\u5462\uff1f \u63a5\u4e0b\u6765\uff0c\u6211**\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15**\uff0c\u7136\u540e\u518d\u6267\u884c\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a \u63a5\u4e0b\u6765\uff0c\u7ee7\u7eed\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u5177\u4f53\u7684\u4fe1\u606f\uff0c\u6211\u5c31\u4e0d\u6253\u5370\u4e86\uff0c\u6211\u76f4\u63a5\u8bf4\u7ed3\u8bba\u5427\u3002 \u56e0\u4e3a\u8868\u4e2d\u6709\u4e24\u4e2a\u7d22\u5f15\uff0c\u5206\u522b\u662f\u4e3b\u952e\u7d22\u5f15\u548c age \u7d22\u5f15\uff0c\u6240\u4ee5\u4f1a\u5206\u522b\u5bf9\u8fd9\u4e24\u4e2a\u7d22\u5f15\u52a0\u9501\u3002 \u4e3b\u952e\u7d22\u5f15\u4f1a\u52a0\u5982\u4e0b\u7684\u9501\uff1a - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 2 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 3 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 5 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 6 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 7 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 8 \u7684\u8bb0\u5f55\uff1b \u5206\u6790 age \u7d22\u5f15\u52a0\u9501\u7684\u8303\u56f4\u65f6\uff0c\u8981\u5148\u5bf9 age \u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f\u3002 age \u7d22\u5f15\u52a0\u7684\u9501\uff1a - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (19, 21] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (21, 21] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (21, 23] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (23, 23] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (23, 39] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (39, 43] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (43, +\u221e] \u7684\u8bb0\u5f55\uff1b \u5316\u7b80\u4e00\u4e0b\uff0c age \u7d22\u5f15 next-key \u9501\u7684\u8303\u56f4\u662f (19, +\u221e]\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u4e86\u7d22\u5f15\u540e\uff0c\u67e5\u8be2\u8bed\u53e5\u662f\u7d22\u5f15\u67e5\u8be2\uff0c\u5e76\u4e0d\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u56e0\u6b64**\u4e0d\u4f1a\u628a\u6574\u5f20\u8868\u7ed9\u9501\u4f4f**\u3002 \u603b\u7ed3\u4e00\u4e0b\uff0c\u5728\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\u540e\uff0c\u4e8b\u52a1 A \u5728\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u4e3b\u952e\u7d22\u5f15\u548c age \u7d22\u5f15\u4f1a\u52a0\u4e0b\u56fe\u4e2d\u7684\u9501\u3002 \u4e8b\u52a1 A \u52a0\u4e0a\u9501\u540e\uff0c\u4e8b\u52a1 B\u3001C\u3001D\u3001E \u5728\u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\u90fd\u4f1a\u88ab\u963b\u585e\u3002 \u603b\u7ed3 \u00b6 \u5728 MySQL \u7684\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u9488\u5bf9\u5f53\u524d\u8bfb\u7684\u8bed\u53e5\u4f1a\u5bf9**\u7d22\u5f15**\u52a0\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u6267\u884c\u589e\u3001\u5220\u3001\u6539\u65f6\u5bfc\u81f4\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u6709\u4e00\u70b9\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86\uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002 \u5b8c\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f"},{"location":"mysql/lock/lock_phantom/#mysql","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6628\u5929\u6709\u4f4d\u8bfb\u8005\u5728\u7f8e\u56e2\u4e8c\u9762\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u5173\u4e8e\u5e7b\u8bfb\u7684\u95ee\u9898\uff1a \u9762\u8bd5\u5b98\u53cd\u95ee\u7684\u5927\u6982\u610f\u601d\u662f\uff0c MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f \u7b54\u6848\u662f\u53ef\u4ee5\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u51e0\u4e2a\u5c0f\u5b9e\u9a8c\u6765\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u5427\uff0c\u987a\u4fbf\u518d\u5e2e\u5927\u5bb6\u590d\u4e60\u4e00\u4e0b\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u3002","title":"MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f"},{"location":"mysql/lock/lock_phantom/#_1","text":"\u9996\u5148\u6765\u770b\u770b MySQL \u6587\u6863\u662f\u600e\u4e48\u5b9a\u4e49\u5e7b\u8bfb\uff08Phantom Read\uff09\u7684: The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a \u201cphantom\u201d row. \u7ffb\u8bd1\uff1a\u5f53\u540c\u4e00\u4e2a\u67e5\u8be2\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u4ea7\u751f\u4e0d\u540c\u7684\u7ed3\u679c\u96c6\u65f6\uff0c\u4e8b\u52a1\u4e2d\u5c31\u4f1a\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8c61\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5982\u679c SELECT \u6267\u884c\u4e86\u4e24\u6b21\uff0c\u4f46\u7b2c\u4e8c\u6b21\u8fd4\u56de\u4e86\u7b2c\u4e00\u6b21\u6ca1\u6709\u8fd4\u56de\u7684\u884c\uff0c\u5219\u8be5\u884c\u662f\u201c\u5e7b\u50cf\u201d\u884c\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e00\u4e2a\u4e8b\u52a1\u5728 T1 \u65f6\u523b\u548c T2 \u65f6\u523b\u5206\u522b\u6267\u884c\u4e86\u4e0b\u9762\u67e5\u8be2\u8bed\u53e5\uff0c\u9014\u4e2d\u6ca1\u6709\u6267\u884c\u5176\u4ed6\u4efb\u4f55\u8bed\u53e5\uff1a SELECT * FROM t_test WHERE id > 100 ; \u53ea\u8981 T1 \u548c T2 \u65f6\u523b\u6267\u884c\u4ea7\u751f\u7684\u7ed3\u679c\u96c6\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a - T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 6 \u6761\u884c\u8bb0\u5f55\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 - T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 4 \u6761\u884c\u8bb0\u5f55\uff0c\u4e5f\u662f\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 MySQL \u662f\u600e\u4e48\u89e3\u51b3\u5e7b\u8bfb\u7684\uff1f MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7 \u6587\u7ae0 \uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a - \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 - \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002","title":"\u4ec0\u4e48\u662f\u5e7b\u8bfb\uff1f"},{"location":"mysql/lock/lock_phantom/#_2","text":"\u63a5\u4e0b\u6765\uff0c\u6765\u9a8c\u8bc1\u300c MySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501**\u53ef\u4ee5\u9632\u6b62**\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u95ee\u9898\u300d\u7684\u7ed3\u8bba\u3002 \u5b9e\u9a8c\u73af\u5883\uff1aMySQL 8.0 \u7248\u672c\uff0c\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u3002 \u73b0\u5728\u6709\u4e00\u5f20\u7528\u6237\u8868\uff08t_user\uff09\uff0c\u8868\u91cc**\u53ea\u6709\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15**\uff0c\u8868\u91cc\u6709\u4ee5\u4e0b\u884c\u6570\u636e\uff1a \u73b0\u5728\u6709\u4e00\u4e2a A \u4e8b\u52a1\u6267\u884c\u4e86\u4e00\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u5230\u5e74\u9f84\u5927\u4e8e 20 \u5c81\u7684\u7528\u6237\u5171\u6709 6 \u6761\u884c\u8bb0\u5f55\u3002 \u7136\u540e\uff0c B \u4e8b\u52a1\u6267\u884c\u4e86\u4e00\u6761\u5220\u9664 id = 2 \u7684\u8bed\u53e5\uff1a \u6b64\u65f6\uff0cB \u4e8b\u52a1\u7684\u5220\u9664\u8bed\u53e5\u5c31\u9677\u5165\u4e86**\u7b49\u5f85\u72b6\u6001**\uff0c\u8bf4\u660e\u662f\u65e0\u6cd5\u8fdb\u884c\u5220\u9664\u7684\u3002 \u56e0\u6b64\uff0cMySQL \u8bb0\u5f55\u9501+\u95f4\u9699\u9501**\u53ef\u4ee5\u9632\u6b62**\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u95ee\u9898\u3002","title":"\u5b9e\u9a8c\u9a8c\u8bc1"},{"location":"mysql/lock/lock_phantom/#_3","text":"\u95ee\u9898\u6765\u4e86\uff0cA \u4e8b\u52a1\u5728\u6267\u884c select ... for update \u8bed\u53e5\u65f6\uff0c\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u8f93\u51fa\u7684\u5185\u5bb9\u5f88\u591a\uff0c\u5171\u6709 11 \u884c\u4fe1\u606f\uff0c\u6211\u5220\u51cf\u4e86\u4e00\u4e9b\u4e0d\u91cd\u8981\u7684\u4fe1\u606f\uff1a \u4ece\u4e0a\u9762\u8f93\u51fa\u7684\u4fe1\u606f\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u79cd\u4e0d\u540c\u7c92\u5ea6\u7684\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff08 LOCK_TYPE: TABLE \uff09\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff08 LOCK_TYPE: RECORD \uff09\uff1aX \u7c7b\u578b\u7684 next-key \u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u300c\u884c\u9501\u300d\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff1a - \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b - \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b - \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b \u7136\u540e\u901a\u8fc7 LOCK_DATA \u4fe1\u606f\uff0c\u53ef\u4ee5\u786e\u8ba4 next-key \u9501\u7684\u8303\u56f4\uff0c\u5177\u4f53\u600e\u4e48\u786e\u5b9a\u5462\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c \uff0c\u800c\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u4e3a LOCK_DATA \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684\u503c\u3002 \u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\uff08 INDEX_NAME : PRIMARY \uff09\u4e0a\u52a0\u4e86 10 \u4e2a next-key \u9501\uff0c\u5982\u4e0b\uff1a - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(-\u221e, 1] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(1, 2] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(2, 3] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(3, 4] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(4, 5] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(5, 6] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(6, 7] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(7, 8] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(8, 9] - X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(9, +\u221e] \u8fd9\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u7ed9\u9501\u4f4f\u4e86\uff0c\u5176\u4ed6\u4e8b\u52a1\u5728\u5bf9\u8be5\u8868\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u7684\u65f6\u5019\u90fd\u4f1a\u88ab\u963b\u585e \u3002 \u53ea\u6709\u5728\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u4e8b\u52a1 A \u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u9501\u624d\u4f1a\u88ab\u91ca\u653e\u3002 \u4e3a\u4ec0\u4e48\u53ea\u662f\u67e5\u8be2\u5e74\u9f84 20 \u5c81\u4ee5\u4e0a\u884c\u8bb0\u5f55\uff0c\u800c\u628a\u6574\u4e2a\u8868\u7ed9\u9501\u4f4f\u4e86\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 A \u7684\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u662f**\u5168\u8868\u626b\u63cf\uff0c\u9501\u662f\u5728\u904d\u5386\u7d22\u5f15\u7684\u65f6\u5019\u52a0\u4e0a\u7684\uff0c\u5e76\u4e0d\u662f\u9488\u5bf9\u8f93\u51fa\u7684\u7ed3\u679c\u52a0\u9501**\u3002 \u56e0\u6b64\uff0c \u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002 \u5982\u679c\u5bf9 age \u5efa\u7acb\u7d22\u5f15\uff0c\u4e8b\u52a1 A \u8fd9\u6761\u67e5\u8be2\u4f1a\u52a0\u4ec0\u4e48\u9501\u5462\uff1f \u63a5\u4e0b\u6765\uff0c\u6211**\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15**\uff0c\u7136\u540e\u518d\u6267\u884c\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a \u63a5\u4e0b\u6765\uff0c\u7ee7\u7eed\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u5177\u4f53\u7684\u4fe1\u606f\uff0c\u6211\u5c31\u4e0d\u6253\u5370\u4e86\uff0c\u6211\u76f4\u63a5\u8bf4\u7ed3\u8bba\u5427\u3002 \u56e0\u4e3a\u8868\u4e2d\u6709\u4e24\u4e2a\u7d22\u5f15\uff0c\u5206\u522b\u662f\u4e3b\u952e\u7d22\u5f15\u548c age \u7d22\u5f15\uff0c\u6240\u4ee5\u4f1a\u5206\u522b\u5bf9\u8fd9\u4e24\u4e2a\u7d22\u5f15\u52a0\u9501\u3002 \u4e3b\u952e\u7d22\u5f15\u4f1a\u52a0\u5982\u4e0b\u7684\u9501\uff1a - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 2 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 3 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 5 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 6 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 7 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 8 \u7684\u8bb0\u5f55\uff1b \u5206\u6790 age \u7d22\u5f15\u52a0\u9501\u7684\u8303\u56f4\u65f6\uff0c\u8981\u5148\u5bf9 age \u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f\u3002 age \u7d22\u5f15\u52a0\u7684\u9501\uff1a - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (19, 21] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (21, 21] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (21, 23] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (23, 23] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (23, 39] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (39, 43] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (43, +\u221e] \u7684\u8bb0\u5f55\uff1b \u5316\u7b80\u4e00\u4e0b\uff0c age \u7d22\u5f15 next-key \u9501\u7684\u8303\u56f4\u662f (19, +\u221e]\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u4e86\u7d22\u5f15\u540e\uff0c\u67e5\u8be2\u8bed\u53e5\u662f\u7d22\u5f15\u67e5\u8be2\uff0c\u5e76\u4e0d\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u56e0\u6b64**\u4e0d\u4f1a\u628a\u6574\u5f20\u8868\u7ed9\u9501\u4f4f**\u3002 \u603b\u7ed3\u4e00\u4e0b\uff0c\u5728\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\u540e\uff0c\u4e8b\u52a1 A \u5728\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u4e3b\u952e\u7d22\u5f15\u548c age \u7d22\u5f15\u4f1a\u52a0\u4e0b\u56fe\u4e2d\u7684\u9501\u3002 \u4e8b\u52a1 A \u52a0\u4e0a\u9501\u540e\uff0c\u4e8b\u52a1 B\u3001C\u3001D\u3001E \u5728\u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\u90fd\u4f1a\u88ab\u963b\u585e\u3002","title":"\u52a0\u9501\u5206\u6790"},{"location":"mysql/lock/lock_phantom/#_4","text":"\u5728 MySQL \u7684\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u9488\u5bf9\u5f53\u524d\u8bfb\u7684\u8bed\u53e5\u4f1a\u5bf9**\u7d22\u5f15**\u52a0\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u6267\u884c\u589e\u3001\u5220\u3001\u6539\u65f6\u5bfc\u81f4\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u6709\u4e00\u70b9\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86\uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002 \u5b8c\uff01 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/lock/mysql_lock/","text":"MySQL \u6709\u54ea\u4e9b\u9501\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u8fd9\u6b21\uff0c\u6765\u8bf4\u8bf4 MySQL \u7684\u9501 \uff0c\u4e3b\u8981\u662f Q&A \u7684\u5f62\u5f0f\uff0c\u770b\u8d77\u6765\u4f1a\u6bd4\u8f83\u8f7b\u677e\u3002 \u4e0d\u591a BB \u4e86\uff0c \u53d1\u8f66\uff01 \u5728 MySQL \u91cc\uff0c\u6839\u636e\u52a0\u9501\u7684\u8303\u56f4\uff0c\u53ef\u4ee5\u5206\u4e3a**\u5168\u5c40\u9501\u3001\u8868\u7ea7\u9501\u548c\u884c\u9501**\u4e09\u7c7b\u3002 \u5168\u5c40\u9501 \u00b6 \u5168\u5c40\u9501\u662f\u600e\u4e48\u7528\u7684\uff1f \u8981\u4f7f\u7528\u5168\u5c40\u9501\uff0c\u5219\u8981\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff1a flush tables with read lock \u6267\u884c\u540e\uff0c \u6574\u4e2a\u6570\u636e\u5e93\u5c31\u5904\u4e8e\u53ea\u8bfb\u72b6\u6001\u4e86 \uff0c\u8fd9\u65f6\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u90fd\u4f1a\u88ab\u963b\u585e\uff1a \u5bf9\u6570\u636e\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff0c\u6bd4\u5982 insert\u3001delete\u3001update\u7b49\u8bed\u53e5\uff1b \u5bf9\u8868\u7ed3\u6784\u7684\u66f4\u6539\u64cd\u4f5c\uff0c\u6bd4\u5982 alter table\u3001drop table \u7b49\u8bed\u53e5\u3002 \u5982\u679c\u8981\u91ca\u653e\u5168\u5c40\u9501\uff0c\u5219\u8981\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff1a unlock tables \u5f53\u7136\uff0c\u5f53\u4f1a\u8bdd\u65ad\u5f00\u4e86\uff0c\u5168\u5c40\u9501\u4f1a\u88ab\u81ea\u52a8\u91ca\u653e\u3002 \u5168\u5c40\u9501\u5e94\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f \u5168\u5c40\u9501\u4e3b\u8981\u5e94\u7528\u4e8e\u505a**\u5168\u5e93\u903b\u8f91\u5907\u4efd**\uff0c\u8fd9\u6837\u5728\u5907\u4efd\u6570\u636e\u5e93\u671f\u95f4\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u6570\u636e\u6216\u8868\u7ed3\u6784\u7684\u66f4\u65b0\uff0c\u800c\u51fa\u73b0\u5907\u4efd\u6587\u4ef6\u7684\u6570\u636e\u4e0e\u9884\u671f\u7684\u4e0d\u4e00\u6837\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u5927\u5bb6\u5c31\u77e5\u9053\u4e86\u3002 \u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u5047\u8bbe\u4e0d\u52a0\u5168\u5c40\u9501\u7684\u573a\u666f\uff0c\u770b\u770b\u4f1a\u51fa\u73b0\u4ec0\u4e48\u610f\u5916\u7684\u60c5\u51b5\u3002 \u5982\u679c\u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u6709\u7528\u6237\u8d2d\u4e70\u4e86\u4e00\u4ef6\u5546\u54c1\uff0c\u4e00\u822c\u8d2d\u4e70\u5546\u54c1\u7684\u4e1a\u52a1\u903b\u8f91\u662f\u4f1a\u6d89\u53ca\u5230\u591a\u5f20\u6570\u636e\u5e93\u8868\u7684\u66f4\u65b0\uff0c\u6bd4\u5982\u5728\u7528\u6237\u8868\u66f4\u65b0\u8be5\u7528\u6237\u7684\u4f59\u989d\uff0c\u7136\u540e\u5728\u5546\u54c1\u8868\u66f4\u65b0\u88ab\u8d2d\u4e70\u7684\u5546\u54c1\u7684\u5e93\u5b58\u3002 \u90a3\u4e48\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u987a\u5e8f\uff1a \u5148\u5907\u4efd\u4e86\u7528\u6237\u8868\u7684\u6570\u636e\uff1b \u7136\u540e\u6709\u7528\u6237\u53d1\u8d77\u4e86\u8d2d\u4e70\u5546\u54c1\u7684\u64cd\u4f5c\uff1b \u63a5\u7740\u518d\u5907\u4efd\u5546\u54c1\u8868\u7684\u6570\u636e\u3002 \u4e5f\u5c31\u662f\u5728\u5907\u4efd\u7528\u6237\u8868\u548c\u5546\u54c1\u8868\u4e4b\u95f4\uff0c\u6709\u7528\u6237\u8d2d\u4e70\u4e86\u5546\u54c1\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5907\u4efd\u7684\u7ed3\u679c\u662f\u7528\u6237\u8868\u4e2d\u8be5\u7528\u6237\u7684\u4f59\u989d\u5e76\u6ca1\u6709\u6263\u9664\uff0c\u53cd\u800c\u5546\u54c1\u8868\u4e2d\u8be5\u5546\u54c1\u7684\u5e93\u5b58\u88ab\u51cf\u5c11\u4e86\uff0c\u5982\u679c\u540e\u9762\u7528\u8fd9\u4e2a\u5907\u4efd\u6587\u4ef6\u6062\u590d\u6570\u636e\u5e93\u6570\u636e\u7684\u8bdd\uff0c\u7528\u6237\u94b1\u6ca1\u5c11\uff0c\u800c\u5e93\u5b58\u5c11\u4e86\uff0c\u7b49\u4e8e\u7528\u6237\u767d\u5ad6\u4e86\u4e00\u4ef6\u5546\u54c1\u3002 \u6240\u4ee5\uff0c\u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u52a0\u4e0a\u5168\u5c40\u9501\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u4e86\u3002 \u52a0\u5168\u5c40\u9501\u53c8\u4f1a\u5e26\u6765\u4ec0\u4e48\u7f3a\u70b9\u5462\uff1f \u52a0\u4e0a\u5168\u5c40\u9501\uff0c\u610f\u5473\u7740\u6574\u4e2a\u6570\u636e\u5e93\u90fd\u662f\u53ea\u8bfb\u72b6\u6001\u3002 \u90a3\u4e48\u5982\u679c\u6570\u636e\u5e93\u91cc\u6709\u5f88\u591a\u6570\u636e\uff0c\u5907\u4efd\u5c31\u4f1a\u82b1\u8d39\u5f88\u591a\u7684\u65f6\u95f4\uff0c\u5173\u952e\u662f\u5907\u4efd\u671f\u95f4\uff0c\u4e1a\u52a1\u53ea\u80fd\u8bfb\u6570\u636e\uff0c\u800c\u4e0d\u80fd\u66f4\u65b0\u6570\u636e\uff0c\u8fd9\u6837\u4f1a\u9020\u6210\u4e1a\u52a1\u505c\u6ede\u3002 \u65e2\u7136\u5907\u4efd\u6570\u636e\u5e93\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u5168\u5c40\u9501\u4f1a\u5f71\u54cd\u4e1a\u52a1\uff0c\u90a3\u6709\u4ec0\u4e48\u5176\u4ed6\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\uff1f \u6709\u7684\uff0c\u5982\u679c\u6570\u636e\u5e93\u7684\u5f15\u64ce\u652f\u6301\u7684\u4e8b\u52a1\u652f\u6301**\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b**\uff0c\u90a3\u4e48\u5728\u5907\u4efd\u6570\u636e\u5e93\u4e4b\u524d\u5148\u5f00\u542f\u4e8b\u52a1\uff0c\u4f1a\u5148\u521b\u5efa Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u6267\u884c\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u800c\u4e14\u7531\u4e8e MVCC \u7684\u652f\u6301\uff0c\u5907\u4efd\u671f\u95f4\u4e1a\u52a1\u4f9d\u7136\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u3002 \u56e0\u4e3a\u5728\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5373\u4f7f\u5176\u4ed6\u4e8b\u52a1\u66f4\u65b0\u4e86\u8868\u7684\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5907\u4efd\u6570\u636e\u5e93\u65f6\u7684 Read View\uff0c\u8fd9\u5c31\u662f\u4e8b\u52a1\u56db\u5927\u7279\u6027\u4e2d\u7684\u9694\u79bb\u6027\uff0c\u8fd9\u6837\u5907\u4efd\u671f\u95f4\u5907\u4efd\u7684\u6570\u636e\u4e00\u76f4\u662f\u5728\u5f00\u542f\u4e8b\u52a1\u65f6\u7684\u6570\u636e\u3002 \u5907\u4efd\u6570\u636e\u5e93\u7684\u5de5\u5177\u662f mysqldump\uff0c\u5728\u4f7f\u7528 mysqldump \u65f6\u52a0\u4e0a \u2013single-transaction \u53c2\u6570\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5728\u5907\u4efd\u6570\u636e\u5e93\u4e4b\u524d\u5148\u5f00\u542f\u4e8b\u52a1\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ea\u9002\u7528\u4e8e\u652f\u6301\u300c\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u300d\u7684\u5b58\u50a8\u5f15\u64ce\u3002 InnoDB \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u6b63\u662f\u53ef\u91cd\u590d\u8bfb\uff0c\u56e0\u6b64\u53ef\u4ee5\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u5907\u4efd\u6570\u636e\u5e93\u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e MyISAM \u8fd9\u79cd\u4e0d\u652f\u6301\u4e8b\u52a1\u7684\u5f15\u64ce\uff0c\u5728\u5907\u4efd\u6570\u636e\u5e93\u65f6\u5c31\u8981\u4f7f\u7528\u5168\u5c40\u9501\u7684\u65b9\u6cd5\u3002 \u8868\u7ea7\u9501 \u00b6 MySQL \u8868\u7ea7\u9501\u6709\u54ea\u4e9b\uff1f\u5177\u4f53\u600e\u4e48\u7528\u7684\u3002 MySQL \u91cc\u9762\u8868\u7ea7\u522b\u7684\u9501\u6709\u8fd9\u51e0\u79cd\uff1a \u8868\u9501\uff1b \u5143\u6570\u636e\u9501\uff08MDL\uff09; \u610f\u5411\u9501\uff1b AUTO-INC \u9501\uff1b \u8868\u9501 \u00b6 \u5148\u6765\u8bf4\u8bf4**\u8868\u9501**\u3002 \u5982\u679c\u6211\u4eec\u60f3\u5bf9\u5b66\u751f\u8868\uff08t_student\uff09\u52a0\u8868\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff1a // \u8868\u7ea7\u522b\u7684\u5171\u4eab\u9501\uff0c\u4e5f\u5c31\u662f\u8bfb\u9501\uff1b lock tables t_student read ; // \u8868\u7ea7\u522b\u7684\u72ec\u5360\u9501\uff0c\u4e5f\u5c31\u662f\u5199\u9501\uff1b lock tables t_stuent write ; \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8868\u9501\u9664\u4e86\u4f1a\u9650\u5236\u522b\u7684\u7ebf\u7a0b\u7684\u8bfb\u5199\u5916\uff0c\u4e5f\u4f1a\u9650\u5236\u672c\u7ebf\u7a0b\u63a5\u4e0b\u6765\u7684\u8bfb\u5199\u64cd\u4f5c\u3002 \u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u672c\u7ebf\u7a0b\u5bf9\u5b66\u751f\u8868\u52a0\u4e86\u300c\u5171\u4eab\u8868\u9501\u300d\uff0c\u90a3\u4e48\u672c\u7ebf\u7a0b\u63a5\u4e0b\u6765\u5982\u679c\u8981\u5bf9\u5b66\u751f\u8868\u6267\u884c\u5199\u64cd\u4f5c\u7684\u8bed\u53e5\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684\uff0c\u5f53\u7136\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u5b66\u751f\u8868\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\u4e5f\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u9501\u88ab\u91ca\u653e\u3002 \u8981\u91ca\u653e\u8868\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\uff0c\u4f1a\u91ca\u653e\u5f53\u524d\u4f1a\u8bdd\u7684\u6240\u6709\u8868\u9501\uff1a unlock tables \u53e6\u5916\uff0c\u5f53\u4f1a\u8bdd\u9000\u51fa\u540e\uff0c\u4e5f\u4f1a\u91ca\u653e\u6240\u6709\u8868\u9501\u3002 \u4e0d\u8fc7\u5c3d\u91cf\u907f\u514d\u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u4f7f\u7528\u8868\u9501\uff0c\u56e0\u4e3a\u8868\u9501\u7684\u9897\u7c92\u5ea6\u592a\u5927\uff0c\u4f1a\u5f71\u54cd\u5e76\u53d1\u6027\u80fd\uff0c InnoDB \u725b\u903c\u7684\u5730\u65b9\u5728\u4e8e\u5b9e\u73b0\u4e86\u9897\u7c92\u5ea6\u66f4\u7ec6\u7684\u884c\u7ea7\u9501 \u3002 \u5143\u6570\u636e\u9501 \u00b6 \u518d\u6765\u8bf4\u8bf4**\u5143\u6570\u636e\u9501**\uff08MDL\uff09\u3002 \u6211\u4eec\u4e0d\u9700\u8981\u663e\u793a\u7684\u4f7f\u7528 MDL\uff0c\u56e0\u4e3a\u5f53\u6211\u4eec\u5bf9\u6570\u636e\u5e93\u8868\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u4f1a\u81ea\u52a8\u7ed9\u8fd9\u4e2a\u8868\u52a0\u4e0a MDL\uff1a \u5bf9\u4e00\u5f20\u8868\u8fdb\u884c CRUD \u64cd\u4f5c\u65f6\uff0c\u52a0\u7684\u662f MDL \u8bfb\u9501 \uff1b \u5bf9\u4e00\u5f20\u8868\u505a\u7ed3\u6784\u53d8\u66f4\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u52a0\u7684\u662f MDL \u5199\u9501 \uff1b MDL \u662f\u4e3a\u4e86\u4fdd\u8bc1\u5f53\u7528\u6237\u5bf9\u8868\u6267\u884c CRUD \u64cd\u4f5c\u65f6\uff0c\u9632\u6b62\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8fd9\u4e2a\u8868\u7ed3\u6784\u505a\u4e86\u53d8\u66f4\u3002 \u5f53\u6709\u7ebf\u7a0b\u5728\u6267\u884c select \u8bed\u53e5\uff08 \u52a0 MDL \u8bfb\u9501\uff09\u7684\u671f\u95f4\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7ebf\u7a0b\u8981\u66f4\u6539\u8be5\u8868\u7684\u7ed3\u6784\uff08 \u7533\u8bf7 MDL \u5199\u9501\uff09\uff0c\u90a3\u4e48\u5c06\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u6267\u884c\u5b8c select \u8bed\u53e5\uff08 \u91ca\u653e MDL \u8bfb\u9501\uff09\u3002 \u53cd\u4e4b\uff0c\u5f53\u6709\u7ebf\u7a0b\u5bf9\u8868\u7ed3\u6784\u8fdb\u884c\u53d8\u66f4\uff08 \u52a0 MDL \u5199\u9501\uff09\u7684\u671f\u95f4\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u4e86 CRUD \u64cd\u4f5c\uff08 \u7533\u8bf7 MDL \u8bfb\u9501\uff09\uff0c\u90a3\u4e48\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u8868\u7ed3\u6784\u53d8\u66f4\u5b8c\u6210\uff08 \u91ca\u653e MDL \u5199\u9501\uff09\u3002 MDL \u4e0d\u9700\u8981\u663e\u793a\u8c03\u7528\uff0c\u90a3\u5b83\u662f\u5728\u4ec0\u4e48\u65f6\u5019\u91ca\u653e\u7684? MDL \u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u4f1a\u91ca\u653e\uff0c\u8fd9\u610f\u5473\u7740**\u4e8b\u52a1\u6267\u884c\u671f\u95f4\uff0cMDL \u662f\u4e00\u76f4\u6301\u6709\u7684**\u3002 \u90a3\u5982\u679c\u6570\u636e\u5e93\u6709\u4e00\u4e2a\u957f\u4e8b\u52a1\uff08\u6240\u8c13\u7684\u957f\u4e8b\u52a1\uff0c\u5c31\u662f\u5f00\u542f\u4e86\u4e8b\u52a1\uff0c\u4f46\u662f\u4e00\u76f4\u8fd8\u6ca1\u63d0\u4ea4\uff09\uff0c\u90a3\u5728\u5bf9\u8868\u7ed3\u6784\u505a\u53d8\u66f4\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u610f\u60f3\u4e0d\u5230\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u987a\u5e8f\u7684\u573a\u666f\uff1a \u9996\u5148\uff0c\u7ebf\u7a0b A \u5148\u542f\u7528\u4e86\u4e8b\u52a1\uff08\u4f46\u662f\u4e00\u76f4\u4e0d\u63d0\u4ea4\uff09\uff0c\u7136\u540e\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u6b64\u65f6\u5c31\u5148\u5bf9\u8be5\u8868\u52a0\u4e0a MDL \u8bfb\u9501\uff1b \u7136\u540e\uff0c\u7ebf\u7a0b B \u4e5f\u6267\u884c\u4e86\u540c\u6837\u7684 select \u8bed\u53e5\uff0c\u6b64\u65f6\u5e76\u4e0d\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u300c\u8bfb\u8bfb\u300d\u5e76\u4e0d\u51b2\u7a81\uff1b \u63a5\u7740\uff0c\u7ebf\u7a0b C \u4fee\u6539\u4e86\u8868\u5b57\u6bb5\uff0c\u6b64\u65f6\u7531\u4e8e\u7ebf\u7a0b A \u7684\u4e8b\u52a1\u5e76\u6ca1\u6709\u63d0\u4ea4\uff0c\u4e5f\u5c31\u662f MDL \u8bfb\u9501\u8fd8\u5728\u5360\u7528\u7740\uff0c\u8fd9\u65f6\u7ebf\u7a0b C \u5c31\u65e0\u6cd5\u7533\u8bf7\u5230 MDL \u5199\u9501\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\uff0c \u90a3\u4e48\u5728\u7ebf\u7a0b C \u963b\u585e\u540e\uff0c\u540e\u7eed\u6709\u5bf9\u8be5\u8868\u7684 select \u8bed\u53e5\uff0c\u5c31\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u5982\u679c\u6b64\u65f6\u6709\u5927\u91cf\u8be5\u8868\u7684 select \u8bed\u53e5\u7684\u8bf7\u6c42\u5230\u6765\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u7ebf\u7a0b\u88ab\u963b\u585e\u4f4f\uff0c\u8fd9\u65f6\u6570\u636e\u5e93\u7684\u7ebf\u7a0b\u5f88\u5feb\u5c31\u4f1a\u7206\u6ee1\u4e86\u3002 \u4e3a\u4ec0\u4e48\u7ebf\u7a0b C \u56e0\u4e3a\u7533\u8bf7\u4e0d\u5230 MDL \u5199\u9501\uff0c\u800c\u5bfc\u81f4\u540e\u7eed\u7684\u7533\u8bf7\u8bfb\u9501\u7684\u67e5\u8be2\u64cd\u4f5c\u4e5f\u4f1a\u88ab\u963b\u585e\uff1f \u8fd9\u662f\u56e0\u4e3a\u7533\u8bf7 MDL \u9501\u7684\u64cd\u4f5c\u4f1a\u5f62\u6210\u4e00\u4e2a\u961f\u5217\uff0c\u961f\u5217\u4e2d**\u5199\u9501\u83b7\u53d6\u4f18\u5148\u7ea7\u9ad8\u4e8e\u8bfb\u9501**\uff0c\u4e00\u65e6\u51fa\u73b0 MDL \u5199\u9501\u7b49\u5f85\uff0c\u4f1a\u963b\u585e\u540e\u7eed\u8be5\u8868\u7684\u6240\u6709 CRUD \u64cd\u4f5c\u3002 \u6240\u4ee5\u4e3a\u4e86\u80fd\u5b89\u5168\u7684\u5bf9\u8868\u7ed3\u6784\u8fdb\u884c\u53d8\u66f4\uff0c\u5728\u5bf9\u8868\u7ed3\u6784\u53d8\u66f4\u524d\uff0c\u5148\u8981\u770b\u770b\u6570\u636e\u5e93\u4e2d\u7684\u957f\u4e8b\u52a1\uff0c\u662f\u5426\u6709\u4e8b\u52a1\u5df2\u7ecf\u5bf9\u8868\u52a0\u4e0a\u4e86 MDL \u8bfb\u9501\uff0c\u5982\u679c\u53ef\u4ee5\u8003\u8651 kill \u6389\u8fd9\u4e2a\u957f\u4e8b\u52a1\uff0c\u7136\u540e\u518d\u505a\u8868\u7ed3\u6784\u7684\u53d8\u66f4\u3002 \u610f\u5411\u9501 \u00b6 \u63a5\u7740\uff0c\u8bf4\u8bf4**\u610f\u5411\u9501**\u3002 \u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u91cc\u5bf9\u67d0\u4e9b\u8bb0\u5f55\u52a0\u4e0a\u300c\u5171\u4eab\u9501\u300d\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e0a\u4e00\u4e2a\u300c\u610f\u5411\u5171\u4eab\u9501\u300d\uff1b \u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u91cc\u5bf9\u67d0\u4e9b\u7eaa\u5f55\u52a0\u4e0a\u300c\u72ec\u5360\u9501\u300d\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e0a\u4e00\u4e2a\u300c\u610f\u5411\u72ec\u5360\u9501\u300d\uff1b \u4e5f\u5c31\u662f\uff0c\u5f53\u6267\u884c\u63d2\u5165\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\uff0c\u9700\u8981\u5148\u5bf9\u8868\u52a0\u4e0a\u300c\u610f\u5411\u72ec\u5360\u9501\u300d\uff0c\u7136\u540e\u5bf9\u8be5\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u3002 \u800c\u666e\u901a\u7684 select \u662f\u4e0d\u4f1a\u52a0\u884c\u7ea7\u9501\u7684\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u5229\u7528 MVCC \u5b9e\u73b0\u4e00\u81f4\u6027\u8bfb\uff0c\u662f\u65e0\u9501\u7684\u3002 \u4e0d\u8fc7\uff0cselect \u4e5f\u662f\u53ef\u4ee5\u5bf9\u8bb0\u5f55\u52a0\u5171\u4eab\u9501\u548c\u72ec\u5360\u9501\u7684\uff0c\u5177\u4f53\u65b9\u5f0f\u5982\u4e0b\uff1a // \u5148\u5728\u8868\u4e0a\u52a0\u4e0a\u610f\u5411\u5171\u4eab\u9501\uff0c\u7136\u540e\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 select ... lock in share mode ; // \u5148\u8868\u4e0a\u52a0\u4e0a\u610f\u5411\u72ec\u5360\u9501\uff0c\u7136\u540e\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 select ... for update ; \u610f\u5411\u5171\u4eab\u9501\u548c\u610f\u5411\u72ec\u5360\u9501\u662f\u8868\u7ea7\u9501\uff0c\u4e0d\u4f1a\u548c\u884c\u7ea7\u7684\u5171\u4eab\u9501\u548c\u72ec\u5360\u9501\u53d1\u751f\u51b2\u7a81\uff0c\u800c\u4e14\u610f\u5411\u9501\u4e4b\u95f4\u4e5f\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff0c\u53ea\u4f1a\u548c\u5171\u4eab\u8868\u9501\uff08 lock tables ... read \uff09\u548c\u72ec\u5360\u8868\u9501\uff08 lock tables ... write \uff09\u53d1\u751f\u51b2\u7a81\u3002 \u8868\u9501\u548c\u884c\u9501\u662f\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\u3001\u8bfb\u5199\u4e92\u65a5\u3001\u5199\u5199\u4e92\u65a5\u7684\u3002 \u5982\u679c\u6ca1\u6709\u300c\u610f\u5411\u9501\u300d\uff0c\u90a3\u4e48\u52a0\u300c\u72ec\u5360\u8868\u9501\u300d\u65f6\uff0c\u5c31\u9700\u8981\u904d\u5386\u8868\u91cc\u6240\u6709\u8bb0\u5f55\uff0c\u67e5\u770b\u662f\u5426\u6709\u8bb0\u5f55\u5b58\u5728\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u6548\u7387\u4f1a\u5f88\u6162\u3002 \u90a3\u4e48\u6709\u4e86\u300c\u610f\u5411\u9501\u300d\uff0c\u7531\u4e8e\u5728\u5bf9\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u524d\uff0c\u5148\u4f1a\u52a0\u4e0a\u8868\u7ea7\u522b\u7684\u610f\u5411\u72ec\u5360\u9501\uff0c\u90a3\u4e48\u5728\u52a0\u300c\u72ec\u5360\u8868\u9501\u300d\u65f6\uff0c\u76f4\u63a5\u67e5\u8be5\u8868\u662f\u5426\u6709\u610f\u5411\u72ec\u5360\u9501\uff0c\u5982\u679c\u6709\u5c31\u610f\u5473\u7740\u8868\u91cc\u5df2\u7ecf\u6709\u8bb0\u5f55\u88ab\u52a0\u4e86\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u53bb\u904d\u5386\u8868\u91cc\u7684\u8bb0\u5f55\u3002 \u6240\u4ee5\uff0c \u610f\u5411\u9501\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5feb\u901f\u5224\u65ad\u8868\u91cc\u662f\u5426\u6709\u8bb0\u5f55\u88ab\u52a0\u9501 \u3002 AUTO-INC \u9501 \u00b6 \u8868\u91cc\u7684\u4e3b\u952e\u901a\u5e38\u90fd\u4f1a\u8bbe\u7f6e\u6210\u81ea\u589e\u7684\uff0c\u8fd9\u662f\u901a\u8fc7\u5bf9\u4e3b\u952e\u5b57\u6bb5\u58f0\u660e AUTO_INCREMENT \u5c5e\u6027\u5b9e\u73b0\u7684\u3002 \u4e4b\u540e\u53ef\u4ee5\u5728\u63d2\u5165\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u4e0d\u6307\u5b9a\u4e3b\u952e\u7684\u503c\uff0c\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u7ed9\u4e3b\u952e\u8d4b\u503c\u9012\u589e\u7684\u503c\uff0c\u8fd9\u4e3b\u8981\u662f\u901a\u8fc7 **AUTO-INC \u9501**\u5b9e\u73b0\u7684\u3002 AUTO-INC \u9501\u662f\u7279\u6b8a\u7684\u8868\u9501\u673a\u5236\uff0c\u9501**\u4e0d\u662f\u518d\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u91ca\u653e\uff0c\u800c\u662f\u518d\u6267\u884c\u5b8c\u63d2\u5165\u8bed\u53e5\u540e\u5c31\u4f1a\u7acb\u5373\u91ca\u653e**\u3002 \u5728\u63d2\u5165\u6570\u636e\u65f6\uff0c\u4f1a\u52a0\u4e00\u4e2a\u8868\u7ea7\u522b\u7684 AUTO-INC \u9501 \uff0c\u7136\u540e\u4e3a\u88ab AUTO_INCREMENT \u4fee\u9970\u7684\u5b57\u6bb5\u8d4b\u503c\u9012\u589e\u7684\u503c\uff0c\u7b49\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u628a AUTO-INC \u9501\u91ca\u653e\u6389\u3002 \u90a3\u4e48\uff0c\u4e00\u4e2a\u4e8b\u52a1\u5728\u6301\u6709 AUTO-INC \u9501\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5176\u4ed6\u4e8b\u52a1\u7684\u5982\u679c\u8981\u5411\u8be5\u8868\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u4ece\u800c\u4fdd\u8bc1\u63d2\u5165\u6570\u636e\u65f6\uff0c\u88ab AUTO_INCREMENT \u4fee\u9970\u7684\u5b57\u6bb5\u7684\u503c\u662f\u8fde\u7eed\u9012\u589e\u7684\u3002 \u4f46\u662f\uff0c AUTO-INC \u9501\u518d\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u63d2\u5165\u7684\u65f6\u5019\uff0c\u4f1a\u5f71\u54cd\u63d2\u5165\u6027\u80fd\uff0c\u56e0\u4e3a\u53e6\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u63d2\u5165\u4f1a\u88ab\u963b\u585e\u3002 \u56e0\u6b64\uff0c \u5728 MySQL 5.1.22 \u7248\u672c\u5f00\u59cb\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e00\u79cd**\u8f7b\u91cf\u7ea7\u7684\u9501**\u6765\u5b9e\u73b0\u81ea\u589e\u3002 \u4e00\u6837\u4e5f\u662f\u5728\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u88ab AUTO_INCREMENT \u4fee\u9970\u7684\u5b57\u6bb5\u52a0\u4e0a\u8f7b\u91cf\u7ea7\u9501\uff0c \u7136\u540e\u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c\u4e00\u4e2a\u81ea\u589e\u7684\u503c\uff0c\u5c31\u628a\u8fd9\u4e2a\u8f7b\u91cf\u7ea7\u9501\u91ca\u653e\u4e86\uff0c\u800c\u4e0d\u9700\u8981\u7b49\u5f85\u6574\u4e2a\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u540e\u624d\u91ca\u653e\u9501 \u3002 InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e2a innodb_autoinc_lock_mode \u7684\u7cfb\u7edf\u53d8\u91cf\uff0c\u662f\u7528\u6765\u63a7\u5236\u9009\u62e9\u7528 AUTO-INC \u9501\uff0c\u8fd8\u662f\u8f7b\u91cf\u7ea7\u7684\u9501\u3002 - \u5f53 innodb_autoinc_lock_mode = 0\uff0c\u5c31\u91c7\u7528 AUTO-INC \u9501\uff0c\u8bed\u53e5\u6267\u884c\u7ed3\u675f\u540e\u624d\u91ca\u653e\u9501\uff1b - \u5f53 innodb_autoinc_lock_mode = 2\uff0c\u5c31\u91c7\u7528\u8f7b\u91cf\u7ea7\u9501\uff0c\u7533\u8bf7\u81ea\u589e\u4e3b\u952e\u540e\u5c31\u91ca\u653e\u9501\uff0c\u5e76\u4e0d\u9700\u8981\u7b49\u8bed\u53e5\u6267\u884c\u540e\u624d\u91ca\u653e\u3002 - \u5f53 innodb_autoinc_lock_mode = 1\uff1a - \u666e\u901a insert \u8bed\u53e5\uff0c\u81ea\u589e\u9501\u5728\u7533\u8bf7\u4e4b\u540e\u5c31\u9a6c\u4e0a\u91ca\u653e\uff1b - \u7c7b\u4f3c insert \u2026 select \u8fd9\u6837\u7684\u6279\u91cf\u63d2\u5165\u6570\u636e\u7684\u8bed\u53e5\uff0c\u81ea\u589e\u9501\u8fd8\u662f\u8981\u7b49\u8bed\u53e5\u7ed3\u675f\u540e\u624d\u88ab\u91ca\u653e\uff1b \u5f53 innodb_autoinc_lock_mode = 2 \u662f\u6027\u80fd\u6700\u9ad8\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u5f53\u642d\u914d binlog \u7684\u65e5\u5fd7\u683c\u5f0f\u662f statement \u4e00\u8d77\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5728\u300c\u4e3b\u4ece\u590d\u5236\u7684\u573a\u666f\u300d\u4e2d\u4f1a\u53d1\u751f**\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898**\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8003\u8651\u4e0b\u9762\u573a\u666f\uff1a session A \u5f80\u8868 t \u4e2d\u63d2\u5165\u4e86 4 \u884c\u6570\u636e\uff0c\u7136\u540e\u521b\u5efa\u4e86\u4e00\u4e2a\u76f8\u540c\u7ed3\u6784\u7684\u8868 t2\uff0c\u7136\u540e**\u4e24\u4e2a session \u540c\u65f6\u6267\u884c\u5411\u8868 t2 \u4e2d\u63d2\u5165\u6570\u636e**\u3002 \u5982\u679c innodb_autoinc_lock_mode = 2\uff0c\u610f\u5473\u7740\u300c\u7533\u8bf7\u81ea\u589e\u4e3b\u952e\u540e\u5c31\u91ca\u653e\u9501\uff0c\u4e0d\u5fc5\u7b49\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u300d\u3002\u90a3\u4e48\u5c31\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff1a session B \u5148\u63d2\u5165\u4e86\u4e24\u4e2a\u8bb0\u5f55\uff0c(1,1,1)\u3001(2,2,2)\uff1b \u7136\u540e\uff0csession A \u6765\u7533\u8bf7\u81ea\u589e id \u5f97\u5230 id=3\uff0c\u63d2\u5165\u4e86\uff083,5,5)\uff1b \u4e4b\u540e\uff0csession B \u7ee7\u7eed\u6267\u884c\uff0c\u63d2\u5165\u4e24\u6761\u8bb0\u5f55 (4,3,3)\u3001 (5,4,4)\u3002 \u53ef\u4ee5\u770b\u5230\uff0c session B \u7684 insert \u8bed\u53e5\uff0c\u751f\u6210\u7684 id \u4e0d\u8fde\u7eed \u3002 \u5f53\u300c\u4e3b\u5e93\u300d\u53d1\u751f\u4e86\u8fd9\u79cd\u60c5\u51b5\uff0cbinlog \u9762\u5bf9 t2 \u8868\u7684\u66f4\u65b0\u53ea\u4f1a\u8bb0\u5f55\u8fd9\u4e24\u4e2a session \u7684 insert \u8bed\u53e5\uff0c\u5982\u679c binlog_format=statement\uff0c\u8bb0\u5f55\u7684\u8bed\u53e5\u5c31\u662f\u539f\u59cb\u8bed\u53e5\u3002\u8bb0\u5f55\u7684\u987a\u5e8f\u8981\u4e48\u5148\u8bb0 session A \u7684 insert \u8bed\u53e5\uff0c\u8981\u4e48\u5148\u8bb0 session B \u7684 insert \u8bed\u53e5\u3002 \u4f46\u4e0d\u8bba\u662f\u54ea\u4e00\u79cd\uff0c\u8fd9\u4e2a binlog \u62ff\u53bb\u300c\u4ece\u5e93\u300d\u6267\u884c\uff0c\u8fd9\u65f6\u4ece\u5e93\u662f\u6309\u300c\u987a\u5e8f\u300d\u6267\u884c\u8bed\u53e5\u7684\uff0c\u53ea\u6709\u5f53\u6267\u884c\u5b8c\u4e00\u6761 SQL \u8bed\u53e5\u540e\uff0c\u624d\u4f1a\u6267\u884c\u4e0b\u4e00\u6761 SQL\u3002\u56e0\u6b64\uff0c\u5728**\u4ece\u5e93\u4e0a\u300c\u4e0d\u4f1a\u300d\u53d1\u751f\u50cf\u4e3b\u5e93\u90a3\u6837\u4e24\u4e2a session \u300c\u540c\u65f6\u300d\u6267\u884c\u5411\u8868 t2 \u4e2d\u63d2\u5165\u6570\u636e\u7684\u573a\u666f\u3002\u6240\u4ee5\uff0c\u5728\u5907\u5e93\u4e0a\u6267\u884c\u4e86 session B \u7684 insert \u8bed\u53e5\uff0c\u751f\u6210\u7684\u7ed3\u679c\u91cc\u9762\uff0cid \u90fd\u662f\u8fde\u7eed\u7684\u3002\u8fd9\u65f6\uff0c\u4e3b\u4ece\u5e93\u5c31\u53d1\u751f\u4e86\u6570\u636e\u4e0d\u4e00\u81f4**\u3002 \u8981\u89e3\u51b3\u8fd9\u95ee\u9898\uff0cbinlog \u65e5\u5fd7\u683c\u5f0f\u8981\u8bbe\u7f6e\u4e3a row\uff0c\u8fd9\u6837\u5728 binlog \u91cc\u9762\u8bb0\u5f55\u7684\u662f\u4e3b\u5e93\u5206\u914d\u7684\u81ea\u589e\u503c\uff0c\u5230\u5907\u5e93\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e3b\u5e93\u7684\u81ea\u589e\u503c\u662f\u4ec0\u4e48\uff0c\u4ece\u5e93\u7684\u81ea\u589e\u503c\u5c31\u662f\u4ec0\u4e48\u3002 \u6240\u4ee5\uff0c \u5f53 innodb_autoinc_lock_mode = 2 \u65f6\uff0c\u5e76\u4e14 binlog_format = row\uff0c\u65e2\u80fd\u63d0\u5347\u5e76\u53d1\u6027\uff0c\u53c8\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898 \u3002 \u884c\u7ea7\u9501 \u00b6 InnoDB \u5f15\u64ce\u662f\u652f\u6301\u884c\u7ea7\u9501\u7684\uff0c\u800c MyISAM \u5f15\u64ce\u5e76\u4e0d\u652f\u6301\u884c\u7ea7\u9501\u3002 \u524d\u9762\u4e5f\u63d0\u5230\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u5feb\u7167\u8bfb\u3002\u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff0c\u8fd9\u79cd\u67e5\u8be2\u4f1a\u52a0\u9501\u7684\u8bed\u53e5\u79f0\u4e3a**\u9501\u5b9a\u8bfb**\u3002 // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 select ... lock in share mode ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 select ... for update ; \u4e0a\u9762\u8fd9\u4e24\u6761\u8bed\u53e5\u5fc5\u987b\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c \u56e0\u4e3a\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e86\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e \uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u8fd9\u4e24\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u8981\u52a0\u4e0a begin\u3001start transaction \u6216\u8005 set autocommit = 0\u3002 \u5171\u4eab\u9501\uff08S\u9501\uff09\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\uff0c\u8bfb\u5199\u4e92\u65a5\u3002\u72ec\u5360\u9501\uff08X\u9501\uff09\u6ee1\u8db3\u5199\u5199\u4e92\u65a5\u3001\u8bfb\u5199\u4e92\u65a5\u3002 \u884c\u7ea7\u9501\u7684\u7c7b\u578b\u4e3b\u8981\u6709\u4e09\u7c7b\uff1a Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\uff1b Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u4f46\u662f\u4e0d\u5305\u542b\u8bb0\u5f55\u672c\u8eab\uff1b Next-Key Lock\uff1aRecord Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002 Record Lock \u00b6 Record Lock \u79f0\u4e3a\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u662f\u4e00\u6761\u8bb0\u5f55\u3002\u800c\u4e14\u8bb0\u5f55\u9501\u662f\u6709 S \u9501\u548c X \u9501\u4e4b\u5206\u7684\uff1a \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 S \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e S \u9501\u517c\u5bb9\uff09\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09; \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 X \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e2\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08X \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a mysql > begin ; mysql > select * from t_test where id = 1 for update ; \u5c31\u662f\u5bf9 t_test \u8868\u4e2d\u4e3b\u952e id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u8fd9\u6837\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u4e86\u3002 \u5f53\u4e8b\u52a1\u6267\u884c commit \u540e\uff0c\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u751f\u6210\u7684\u9501\u90fd\u4f1a\u88ab\u91ca\u653e\u3002 Gap Lock \u00b6 Gap Lock \u79f0\u4e3a\u95f4\u9699\u9501\uff0c\u53ea\u5b58\u5728\u4e8e\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u95f4\u9699\u9501\u867d\u7136\u5b58\u5728 X \u578b\u95f4\u9699\u9501\u548c S \u578b\u95f4\u9699\u9501\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c \u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5e76\u4e0d\u5b58\u5728\u4e92\u65a5\u5173\u7cfb\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u7684\u76ee\u7684\u662f\u9632\u6b62\u63d2\u5165\u5e7b\u5f71\u8bb0\u5f55\u800c\u63d0\u51fa\u7684 \u3002 Next-Key Lock \u00b6 Next-Key Lock \u79f0\u4e3a\u4e34\u952e\u9501\uff0c\u662f Record Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5] \u7684 next-key lock\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5373\u4e0d\u80fd\u63d2\u5165 id = 4 \u8bb0\u5f55\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539 id = 5 \u8fd9\u6761\u8bb0\u5f55\u3002 \u6240\u4ee5\uff0cnext-key lock \u5373\u80fd\u4fdd\u62a4\u8be5\u8bb0\u5f55\uff0c\u53c8\u80fd\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u5c06\u65b0\u7eaa\u5f55\u63d2\u5165\u5230\u88ab\u4fdd\u62a4\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u4e2d\u3002 next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684 \u3002 \u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\uff0cX \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\u3002 \u63d2\u5165\u610f\u5411\u9501 \u00b6 \u4e00\u4e2a\u4e8b\u52a1\u5728\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u9700\u8981\u5224\u65ad\u63d2\u5165\u4f4d\u7f6e\u662f\u5426\u5df2\u88ab\u5176\u4ed6\u4e8b\u52a1\u52a0\u4e86\u95f4\u9699\u9501\uff08next-key lock \u4e5f\u5305\u542b\u95f4\u9699\u9501\uff09\u3002 \u5982\u679c\u6709\u7684\u8bdd\uff0c\u63d2\u5165\u64cd\u4f5c\u5c31\u4f1a\u53d1\u751f**\u963b\u585e**\uff0c\u76f4\u5230\u62e5\u6709\u95f4\u9699\u9501\u7684\u90a3\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u4e3a\u6b62\uff08\u91ca\u653e\u95f4\u9699\u9501\u7684\u65f6\u523b\uff09\uff0c\u5728\u6b64\u671f\u95f4\u4f1a\u751f\u6210\u4e00\u4e2a**\u63d2\u5165\u610f\u5411\u9501**\uff0c\u8868\u660e\u6709\u4e8b\u52a1\u60f3\u5728\u67d0\u4e2a\u533a\u95f4\u63d2\u5165\u65b0\u8bb0\u5f55\uff0c\u4f46\u662f\u73b0\u5728\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e8b\u52a1 A \u5df2\u7ecf\u5bf9\u8868\u52a0\u4e86\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\u3002 \u5f53\u4e8b\u52a1 A \u8fd8\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4e8b\u52a1 B \u5411\u8be5\u8868\u63d2\u5165\u4e00\u6761 id = 4 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd9\u65f6\u4f1a\u5224\u65ad\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\u5df2\u7ecf\u88ab\u4e8b\u52a1 A \u52a0\u4e86\u95f4\u9699\u9501\uff0c\u4e8e\u662f\u4e8b\u7269 B \u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u5c06\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u867d\u7136\u6709\u610f\u5411\u9501\uff0c\u4f46\u662f\u5b83\u5e76**\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u5c5e\u4e8e\u884c\u7ea7\u522b\u9501**\u3002 \u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a\u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL\u6280\u672f\u5185\u5e55\uff1ainnodb\u300b \u300aMySQL\u5b9e\u621845\u8bb2\u300b \u300a\u4ece\u6839\u513f\u4e0a\u7406\u89e3MySQL\u300b \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u6709\u54ea\u4e9b\u9501\uff1f"},{"location":"mysql/lock/mysql_lock/#mysql","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u8fd9\u6b21\uff0c\u6765\u8bf4\u8bf4 MySQL \u7684\u9501 \uff0c\u4e3b\u8981\u662f Q&A \u7684\u5f62\u5f0f\uff0c\u770b\u8d77\u6765\u4f1a\u6bd4\u8f83\u8f7b\u677e\u3002 \u4e0d\u591a BB \u4e86\uff0c \u53d1\u8f66\uff01 \u5728 MySQL \u91cc\uff0c\u6839\u636e\u52a0\u9501\u7684\u8303\u56f4\uff0c\u53ef\u4ee5\u5206\u4e3a**\u5168\u5c40\u9501\u3001\u8868\u7ea7\u9501\u548c\u884c\u9501**\u4e09\u7c7b\u3002","title":"MySQL \u6709\u54ea\u4e9b\u9501\uff1f"},{"location":"mysql/lock/mysql_lock/#_1","text":"\u5168\u5c40\u9501\u662f\u600e\u4e48\u7528\u7684\uff1f \u8981\u4f7f\u7528\u5168\u5c40\u9501\uff0c\u5219\u8981\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff1a flush tables with read lock \u6267\u884c\u540e\uff0c \u6574\u4e2a\u6570\u636e\u5e93\u5c31\u5904\u4e8e\u53ea\u8bfb\u72b6\u6001\u4e86 \uff0c\u8fd9\u65f6\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u90fd\u4f1a\u88ab\u963b\u585e\uff1a \u5bf9\u6570\u636e\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff0c\u6bd4\u5982 insert\u3001delete\u3001update\u7b49\u8bed\u53e5\uff1b \u5bf9\u8868\u7ed3\u6784\u7684\u66f4\u6539\u64cd\u4f5c\uff0c\u6bd4\u5982 alter table\u3001drop table \u7b49\u8bed\u53e5\u3002 \u5982\u679c\u8981\u91ca\u653e\u5168\u5c40\u9501\uff0c\u5219\u8981\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff1a unlock tables \u5f53\u7136\uff0c\u5f53\u4f1a\u8bdd\u65ad\u5f00\u4e86\uff0c\u5168\u5c40\u9501\u4f1a\u88ab\u81ea\u52a8\u91ca\u653e\u3002 \u5168\u5c40\u9501\u5e94\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f \u5168\u5c40\u9501\u4e3b\u8981\u5e94\u7528\u4e8e\u505a**\u5168\u5e93\u903b\u8f91\u5907\u4efd**\uff0c\u8fd9\u6837\u5728\u5907\u4efd\u6570\u636e\u5e93\u671f\u95f4\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u6570\u636e\u6216\u8868\u7ed3\u6784\u7684\u66f4\u65b0\uff0c\u800c\u51fa\u73b0\u5907\u4efd\u6587\u4ef6\u7684\u6570\u636e\u4e0e\u9884\u671f\u7684\u4e0d\u4e00\u6837\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u5927\u5bb6\u5c31\u77e5\u9053\u4e86\u3002 \u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u5047\u8bbe\u4e0d\u52a0\u5168\u5c40\u9501\u7684\u573a\u666f\uff0c\u770b\u770b\u4f1a\u51fa\u73b0\u4ec0\u4e48\u610f\u5916\u7684\u60c5\u51b5\u3002 \u5982\u679c\u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u6709\u7528\u6237\u8d2d\u4e70\u4e86\u4e00\u4ef6\u5546\u54c1\uff0c\u4e00\u822c\u8d2d\u4e70\u5546\u54c1\u7684\u4e1a\u52a1\u903b\u8f91\u662f\u4f1a\u6d89\u53ca\u5230\u591a\u5f20\u6570\u636e\u5e93\u8868\u7684\u66f4\u65b0\uff0c\u6bd4\u5982\u5728\u7528\u6237\u8868\u66f4\u65b0\u8be5\u7528\u6237\u7684\u4f59\u989d\uff0c\u7136\u540e\u5728\u5546\u54c1\u8868\u66f4\u65b0\u88ab\u8d2d\u4e70\u7684\u5546\u54c1\u7684\u5e93\u5b58\u3002 \u90a3\u4e48\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u987a\u5e8f\uff1a \u5148\u5907\u4efd\u4e86\u7528\u6237\u8868\u7684\u6570\u636e\uff1b \u7136\u540e\u6709\u7528\u6237\u53d1\u8d77\u4e86\u8d2d\u4e70\u5546\u54c1\u7684\u64cd\u4f5c\uff1b \u63a5\u7740\u518d\u5907\u4efd\u5546\u54c1\u8868\u7684\u6570\u636e\u3002 \u4e5f\u5c31\u662f\u5728\u5907\u4efd\u7528\u6237\u8868\u548c\u5546\u54c1\u8868\u4e4b\u95f4\uff0c\u6709\u7528\u6237\u8d2d\u4e70\u4e86\u5546\u54c1\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5907\u4efd\u7684\u7ed3\u679c\u662f\u7528\u6237\u8868\u4e2d\u8be5\u7528\u6237\u7684\u4f59\u989d\u5e76\u6ca1\u6709\u6263\u9664\uff0c\u53cd\u800c\u5546\u54c1\u8868\u4e2d\u8be5\u5546\u54c1\u7684\u5e93\u5b58\u88ab\u51cf\u5c11\u4e86\uff0c\u5982\u679c\u540e\u9762\u7528\u8fd9\u4e2a\u5907\u4efd\u6587\u4ef6\u6062\u590d\u6570\u636e\u5e93\u6570\u636e\u7684\u8bdd\uff0c\u7528\u6237\u94b1\u6ca1\u5c11\uff0c\u800c\u5e93\u5b58\u5c11\u4e86\uff0c\u7b49\u4e8e\u7528\u6237\u767d\u5ad6\u4e86\u4e00\u4ef6\u5546\u54c1\u3002 \u6240\u4ee5\uff0c\u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u52a0\u4e0a\u5168\u5c40\u9501\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u4e86\u3002 \u52a0\u5168\u5c40\u9501\u53c8\u4f1a\u5e26\u6765\u4ec0\u4e48\u7f3a\u70b9\u5462\uff1f \u52a0\u4e0a\u5168\u5c40\u9501\uff0c\u610f\u5473\u7740\u6574\u4e2a\u6570\u636e\u5e93\u90fd\u662f\u53ea\u8bfb\u72b6\u6001\u3002 \u90a3\u4e48\u5982\u679c\u6570\u636e\u5e93\u91cc\u6709\u5f88\u591a\u6570\u636e\uff0c\u5907\u4efd\u5c31\u4f1a\u82b1\u8d39\u5f88\u591a\u7684\u65f6\u95f4\uff0c\u5173\u952e\u662f\u5907\u4efd\u671f\u95f4\uff0c\u4e1a\u52a1\u53ea\u80fd\u8bfb\u6570\u636e\uff0c\u800c\u4e0d\u80fd\u66f4\u65b0\u6570\u636e\uff0c\u8fd9\u6837\u4f1a\u9020\u6210\u4e1a\u52a1\u505c\u6ede\u3002 \u65e2\u7136\u5907\u4efd\u6570\u636e\u5e93\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u5168\u5c40\u9501\u4f1a\u5f71\u54cd\u4e1a\u52a1\uff0c\u90a3\u6709\u4ec0\u4e48\u5176\u4ed6\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\uff1f \u6709\u7684\uff0c\u5982\u679c\u6570\u636e\u5e93\u7684\u5f15\u64ce\u652f\u6301\u7684\u4e8b\u52a1\u652f\u6301**\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b**\uff0c\u90a3\u4e48\u5728\u5907\u4efd\u6570\u636e\u5e93\u4e4b\u524d\u5148\u5f00\u542f\u4e8b\u52a1\uff0c\u4f1a\u5148\u521b\u5efa Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u6267\u884c\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u800c\u4e14\u7531\u4e8e MVCC \u7684\u652f\u6301\uff0c\u5907\u4efd\u671f\u95f4\u4e1a\u52a1\u4f9d\u7136\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u3002 \u56e0\u4e3a\u5728\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5373\u4f7f\u5176\u4ed6\u4e8b\u52a1\u66f4\u65b0\u4e86\u8868\u7684\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5907\u4efd\u6570\u636e\u5e93\u65f6\u7684 Read View\uff0c\u8fd9\u5c31\u662f\u4e8b\u52a1\u56db\u5927\u7279\u6027\u4e2d\u7684\u9694\u79bb\u6027\uff0c\u8fd9\u6837\u5907\u4efd\u671f\u95f4\u5907\u4efd\u7684\u6570\u636e\u4e00\u76f4\u662f\u5728\u5f00\u542f\u4e8b\u52a1\u65f6\u7684\u6570\u636e\u3002 \u5907\u4efd\u6570\u636e\u5e93\u7684\u5de5\u5177\u662f mysqldump\uff0c\u5728\u4f7f\u7528 mysqldump \u65f6\u52a0\u4e0a \u2013single-transaction \u53c2\u6570\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5728\u5907\u4efd\u6570\u636e\u5e93\u4e4b\u524d\u5148\u5f00\u542f\u4e8b\u52a1\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ea\u9002\u7528\u4e8e\u652f\u6301\u300c\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u300d\u7684\u5b58\u50a8\u5f15\u64ce\u3002 InnoDB \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u6b63\u662f\u53ef\u91cd\u590d\u8bfb\uff0c\u56e0\u6b64\u53ef\u4ee5\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u5907\u4efd\u6570\u636e\u5e93\u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e MyISAM \u8fd9\u79cd\u4e0d\u652f\u6301\u4e8b\u52a1\u7684\u5f15\u64ce\uff0c\u5728\u5907\u4efd\u6570\u636e\u5e93\u65f6\u5c31\u8981\u4f7f\u7528\u5168\u5c40\u9501\u7684\u65b9\u6cd5\u3002","title":"\u5168\u5c40\u9501"},{"location":"mysql/lock/mysql_lock/#_2","text":"MySQL \u8868\u7ea7\u9501\u6709\u54ea\u4e9b\uff1f\u5177\u4f53\u600e\u4e48\u7528\u7684\u3002 MySQL \u91cc\u9762\u8868\u7ea7\u522b\u7684\u9501\u6709\u8fd9\u51e0\u79cd\uff1a \u8868\u9501\uff1b \u5143\u6570\u636e\u9501\uff08MDL\uff09; \u610f\u5411\u9501\uff1b AUTO-INC \u9501\uff1b","title":"\u8868\u7ea7\u9501"},{"location":"mysql/lock/mysql_lock/#_3","text":"\u5148\u6765\u8bf4\u8bf4**\u8868\u9501**\u3002 \u5982\u679c\u6211\u4eec\u60f3\u5bf9\u5b66\u751f\u8868\uff08t_student\uff09\u52a0\u8868\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff1a // \u8868\u7ea7\u522b\u7684\u5171\u4eab\u9501\uff0c\u4e5f\u5c31\u662f\u8bfb\u9501\uff1b lock tables t_student read ; // \u8868\u7ea7\u522b\u7684\u72ec\u5360\u9501\uff0c\u4e5f\u5c31\u662f\u5199\u9501\uff1b lock tables t_stuent write ; \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8868\u9501\u9664\u4e86\u4f1a\u9650\u5236\u522b\u7684\u7ebf\u7a0b\u7684\u8bfb\u5199\u5916\uff0c\u4e5f\u4f1a\u9650\u5236\u672c\u7ebf\u7a0b\u63a5\u4e0b\u6765\u7684\u8bfb\u5199\u64cd\u4f5c\u3002 \u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u672c\u7ebf\u7a0b\u5bf9\u5b66\u751f\u8868\u52a0\u4e86\u300c\u5171\u4eab\u8868\u9501\u300d\uff0c\u90a3\u4e48\u672c\u7ebf\u7a0b\u63a5\u4e0b\u6765\u5982\u679c\u8981\u5bf9\u5b66\u751f\u8868\u6267\u884c\u5199\u64cd\u4f5c\u7684\u8bed\u53e5\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684\uff0c\u5f53\u7136\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u5b66\u751f\u8868\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\u4e5f\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u9501\u88ab\u91ca\u653e\u3002 \u8981\u91ca\u653e\u8868\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\uff0c\u4f1a\u91ca\u653e\u5f53\u524d\u4f1a\u8bdd\u7684\u6240\u6709\u8868\u9501\uff1a unlock tables \u53e6\u5916\uff0c\u5f53\u4f1a\u8bdd\u9000\u51fa\u540e\uff0c\u4e5f\u4f1a\u91ca\u653e\u6240\u6709\u8868\u9501\u3002 \u4e0d\u8fc7\u5c3d\u91cf\u907f\u514d\u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u4f7f\u7528\u8868\u9501\uff0c\u56e0\u4e3a\u8868\u9501\u7684\u9897\u7c92\u5ea6\u592a\u5927\uff0c\u4f1a\u5f71\u54cd\u5e76\u53d1\u6027\u80fd\uff0c InnoDB \u725b\u903c\u7684\u5730\u65b9\u5728\u4e8e\u5b9e\u73b0\u4e86\u9897\u7c92\u5ea6\u66f4\u7ec6\u7684\u884c\u7ea7\u9501 \u3002","title":"\u8868\u9501"},{"location":"mysql/lock/mysql_lock/#_4","text":"\u518d\u6765\u8bf4\u8bf4**\u5143\u6570\u636e\u9501**\uff08MDL\uff09\u3002 \u6211\u4eec\u4e0d\u9700\u8981\u663e\u793a\u7684\u4f7f\u7528 MDL\uff0c\u56e0\u4e3a\u5f53\u6211\u4eec\u5bf9\u6570\u636e\u5e93\u8868\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u4f1a\u81ea\u52a8\u7ed9\u8fd9\u4e2a\u8868\u52a0\u4e0a MDL\uff1a \u5bf9\u4e00\u5f20\u8868\u8fdb\u884c CRUD \u64cd\u4f5c\u65f6\uff0c\u52a0\u7684\u662f MDL \u8bfb\u9501 \uff1b \u5bf9\u4e00\u5f20\u8868\u505a\u7ed3\u6784\u53d8\u66f4\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u52a0\u7684\u662f MDL \u5199\u9501 \uff1b MDL \u662f\u4e3a\u4e86\u4fdd\u8bc1\u5f53\u7528\u6237\u5bf9\u8868\u6267\u884c CRUD \u64cd\u4f5c\u65f6\uff0c\u9632\u6b62\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8fd9\u4e2a\u8868\u7ed3\u6784\u505a\u4e86\u53d8\u66f4\u3002 \u5f53\u6709\u7ebf\u7a0b\u5728\u6267\u884c select \u8bed\u53e5\uff08 \u52a0 MDL \u8bfb\u9501\uff09\u7684\u671f\u95f4\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7ebf\u7a0b\u8981\u66f4\u6539\u8be5\u8868\u7684\u7ed3\u6784\uff08 \u7533\u8bf7 MDL \u5199\u9501\uff09\uff0c\u90a3\u4e48\u5c06\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u6267\u884c\u5b8c select \u8bed\u53e5\uff08 \u91ca\u653e MDL \u8bfb\u9501\uff09\u3002 \u53cd\u4e4b\uff0c\u5f53\u6709\u7ebf\u7a0b\u5bf9\u8868\u7ed3\u6784\u8fdb\u884c\u53d8\u66f4\uff08 \u52a0 MDL \u5199\u9501\uff09\u7684\u671f\u95f4\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u4e86 CRUD \u64cd\u4f5c\uff08 \u7533\u8bf7 MDL \u8bfb\u9501\uff09\uff0c\u90a3\u4e48\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u8868\u7ed3\u6784\u53d8\u66f4\u5b8c\u6210\uff08 \u91ca\u653e MDL \u5199\u9501\uff09\u3002 MDL \u4e0d\u9700\u8981\u663e\u793a\u8c03\u7528\uff0c\u90a3\u5b83\u662f\u5728\u4ec0\u4e48\u65f6\u5019\u91ca\u653e\u7684? MDL \u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u4f1a\u91ca\u653e\uff0c\u8fd9\u610f\u5473\u7740**\u4e8b\u52a1\u6267\u884c\u671f\u95f4\uff0cMDL \u662f\u4e00\u76f4\u6301\u6709\u7684**\u3002 \u90a3\u5982\u679c\u6570\u636e\u5e93\u6709\u4e00\u4e2a\u957f\u4e8b\u52a1\uff08\u6240\u8c13\u7684\u957f\u4e8b\u52a1\uff0c\u5c31\u662f\u5f00\u542f\u4e86\u4e8b\u52a1\uff0c\u4f46\u662f\u4e00\u76f4\u8fd8\u6ca1\u63d0\u4ea4\uff09\uff0c\u90a3\u5728\u5bf9\u8868\u7ed3\u6784\u505a\u53d8\u66f4\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u610f\u60f3\u4e0d\u5230\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u987a\u5e8f\u7684\u573a\u666f\uff1a \u9996\u5148\uff0c\u7ebf\u7a0b A \u5148\u542f\u7528\u4e86\u4e8b\u52a1\uff08\u4f46\u662f\u4e00\u76f4\u4e0d\u63d0\u4ea4\uff09\uff0c\u7136\u540e\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u6b64\u65f6\u5c31\u5148\u5bf9\u8be5\u8868\u52a0\u4e0a MDL \u8bfb\u9501\uff1b \u7136\u540e\uff0c\u7ebf\u7a0b B \u4e5f\u6267\u884c\u4e86\u540c\u6837\u7684 select \u8bed\u53e5\uff0c\u6b64\u65f6\u5e76\u4e0d\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u300c\u8bfb\u8bfb\u300d\u5e76\u4e0d\u51b2\u7a81\uff1b \u63a5\u7740\uff0c\u7ebf\u7a0b C \u4fee\u6539\u4e86\u8868\u5b57\u6bb5\uff0c\u6b64\u65f6\u7531\u4e8e\u7ebf\u7a0b A \u7684\u4e8b\u52a1\u5e76\u6ca1\u6709\u63d0\u4ea4\uff0c\u4e5f\u5c31\u662f MDL \u8bfb\u9501\u8fd8\u5728\u5360\u7528\u7740\uff0c\u8fd9\u65f6\u7ebf\u7a0b C \u5c31\u65e0\u6cd5\u7533\u8bf7\u5230 MDL \u5199\u9501\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\uff0c \u90a3\u4e48\u5728\u7ebf\u7a0b C \u963b\u585e\u540e\uff0c\u540e\u7eed\u6709\u5bf9\u8be5\u8868\u7684 select \u8bed\u53e5\uff0c\u5c31\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u5982\u679c\u6b64\u65f6\u6709\u5927\u91cf\u8be5\u8868\u7684 select \u8bed\u53e5\u7684\u8bf7\u6c42\u5230\u6765\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u7ebf\u7a0b\u88ab\u963b\u585e\u4f4f\uff0c\u8fd9\u65f6\u6570\u636e\u5e93\u7684\u7ebf\u7a0b\u5f88\u5feb\u5c31\u4f1a\u7206\u6ee1\u4e86\u3002 \u4e3a\u4ec0\u4e48\u7ebf\u7a0b C \u56e0\u4e3a\u7533\u8bf7\u4e0d\u5230 MDL \u5199\u9501\uff0c\u800c\u5bfc\u81f4\u540e\u7eed\u7684\u7533\u8bf7\u8bfb\u9501\u7684\u67e5\u8be2\u64cd\u4f5c\u4e5f\u4f1a\u88ab\u963b\u585e\uff1f \u8fd9\u662f\u56e0\u4e3a\u7533\u8bf7 MDL \u9501\u7684\u64cd\u4f5c\u4f1a\u5f62\u6210\u4e00\u4e2a\u961f\u5217\uff0c\u961f\u5217\u4e2d**\u5199\u9501\u83b7\u53d6\u4f18\u5148\u7ea7\u9ad8\u4e8e\u8bfb\u9501**\uff0c\u4e00\u65e6\u51fa\u73b0 MDL \u5199\u9501\u7b49\u5f85\uff0c\u4f1a\u963b\u585e\u540e\u7eed\u8be5\u8868\u7684\u6240\u6709 CRUD \u64cd\u4f5c\u3002 \u6240\u4ee5\u4e3a\u4e86\u80fd\u5b89\u5168\u7684\u5bf9\u8868\u7ed3\u6784\u8fdb\u884c\u53d8\u66f4\uff0c\u5728\u5bf9\u8868\u7ed3\u6784\u53d8\u66f4\u524d\uff0c\u5148\u8981\u770b\u770b\u6570\u636e\u5e93\u4e2d\u7684\u957f\u4e8b\u52a1\uff0c\u662f\u5426\u6709\u4e8b\u52a1\u5df2\u7ecf\u5bf9\u8868\u52a0\u4e0a\u4e86 MDL \u8bfb\u9501\uff0c\u5982\u679c\u53ef\u4ee5\u8003\u8651 kill \u6389\u8fd9\u4e2a\u957f\u4e8b\u52a1\uff0c\u7136\u540e\u518d\u505a\u8868\u7ed3\u6784\u7684\u53d8\u66f4\u3002","title":"\u5143\u6570\u636e\u9501"},{"location":"mysql/lock/mysql_lock/#_5","text":"\u63a5\u7740\uff0c\u8bf4\u8bf4**\u610f\u5411\u9501**\u3002 \u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u91cc\u5bf9\u67d0\u4e9b\u8bb0\u5f55\u52a0\u4e0a\u300c\u5171\u4eab\u9501\u300d\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e0a\u4e00\u4e2a\u300c\u610f\u5411\u5171\u4eab\u9501\u300d\uff1b \u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u91cc\u5bf9\u67d0\u4e9b\u7eaa\u5f55\u52a0\u4e0a\u300c\u72ec\u5360\u9501\u300d\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e0a\u4e00\u4e2a\u300c\u610f\u5411\u72ec\u5360\u9501\u300d\uff1b \u4e5f\u5c31\u662f\uff0c\u5f53\u6267\u884c\u63d2\u5165\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\uff0c\u9700\u8981\u5148\u5bf9\u8868\u52a0\u4e0a\u300c\u610f\u5411\u72ec\u5360\u9501\u300d\uff0c\u7136\u540e\u5bf9\u8be5\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u3002 \u800c\u666e\u901a\u7684 select \u662f\u4e0d\u4f1a\u52a0\u884c\u7ea7\u9501\u7684\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u5229\u7528 MVCC \u5b9e\u73b0\u4e00\u81f4\u6027\u8bfb\uff0c\u662f\u65e0\u9501\u7684\u3002 \u4e0d\u8fc7\uff0cselect \u4e5f\u662f\u53ef\u4ee5\u5bf9\u8bb0\u5f55\u52a0\u5171\u4eab\u9501\u548c\u72ec\u5360\u9501\u7684\uff0c\u5177\u4f53\u65b9\u5f0f\u5982\u4e0b\uff1a // \u5148\u5728\u8868\u4e0a\u52a0\u4e0a\u610f\u5411\u5171\u4eab\u9501\uff0c\u7136\u540e\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 select ... lock in share mode ; // \u5148\u8868\u4e0a\u52a0\u4e0a\u610f\u5411\u72ec\u5360\u9501\uff0c\u7136\u540e\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 select ... for update ; \u610f\u5411\u5171\u4eab\u9501\u548c\u610f\u5411\u72ec\u5360\u9501\u662f\u8868\u7ea7\u9501\uff0c\u4e0d\u4f1a\u548c\u884c\u7ea7\u7684\u5171\u4eab\u9501\u548c\u72ec\u5360\u9501\u53d1\u751f\u51b2\u7a81\uff0c\u800c\u4e14\u610f\u5411\u9501\u4e4b\u95f4\u4e5f\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff0c\u53ea\u4f1a\u548c\u5171\u4eab\u8868\u9501\uff08 lock tables ... read \uff09\u548c\u72ec\u5360\u8868\u9501\uff08 lock tables ... write \uff09\u53d1\u751f\u51b2\u7a81\u3002 \u8868\u9501\u548c\u884c\u9501\u662f\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\u3001\u8bfb\u5199\u4e92\u65a5\u3001\u5199\u5199\u4e92\u65a5\u7684\u3002 \u5982\u679c\u6ca1\u6709\u300c\u610f\u5411\u9501\u300d\uff0c\u90a3\u4e48\u52a0\u300c\u72ec\u5360\u8868\u9501\u300d\u65f6\uff0c\u5c31\u9700\u8981\u904d\u5386\u8868\u91cc\u6240\u6709\u8bb0\u5f55\uff0c\u67e5\u770b\u662f\u5426\u6709\u8bb0\u5f55\u5b58\u5728\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u6548\u7387\u4f1a\u5f88\u6162\u3002 \u90a3\u4e48\u6709\u4e86\u300c\u610f\u5411\u9501\u300d\uff0c\u7531\u4e8e\u5728\u5bf9\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u524d\uff0c\u5148\u4f1a\u52a0\u4e0a\u8868\u7ea7\u522b\u7684\u610f\u5411\u72ec\u5360\u9501\uff0c\u90a3\u4e48\u5728\u52a0\u300c\u72ec\u5360\u8868\u9501\u300d\u65f6\uff0c\u76f4\u63a5\u67e5\u8be5\u8868\u662f\u5426\u6709\u610f\u5411\u72ec\u5360\u9501\uff0c\u5982\u679c\u6709\u5c31\u610f\u5473\u7740\u8868\u91cc\u5df2\u7ecf\u6709\u8bb0\u5f55\u88ab\u52a0\u4e86\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u53bb\u904d\u5386\u8868\u91cc\u7684\u8bb0\u5f55\u3002 \u6240\u4ee5\uff0c \u610f\u5411\u9501\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5feb\u901f\u5224\u65ad\u8868\u91cc\u662f\u5426\u6709\u8bb0\u5f55\u88ab\u52a0\u9501 \u3002","title":"\u610f\u5411\u9501"},{"location":"mysql/lock/mysql_lock/#auto-inc","text":"\u8868\u91cc\u7684\u4e3b\u952e\u901a\u5e38\u90fd\u4f1a\u8bbe\u7f6e\u6210\u81ea\u589e\u7684\uff0c\u8fd9\u662f\u901a\u8fc7\u5bf9\u4e3b\u952e\u5b57\u6bb5\u58f0\u660e AUTO_INCREMENT \u5c5e\u6027\u5b9e\u73b0\u7684\u3002 \u4e4b\u540e\u53ef\u4ee5\u5728\u63d2\u5165\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u4e0d\u6307\u5b9a\u4e3b\u952e\u7684\u503c\uff0c\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u7ed9\u4e3b\u952e\u8d4b\u503c\u9012\u589e\u7684\u503c\uff0c\u8fd9\u4e3b\u8981\u662f\u901a\u8fc7 **AUTO-INC \u9501**\u5b9e\u73b0\u7684\u3002 AUTO-INC \u9501\u662f\u7279\u6b8a\u7684\u8868\u9501\u673a\u5236\uff0c\u9501**\u4e0d\u662f\u518d\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u91ca\u653e\uff0c\u800c\u662f\u518d\u6267\u884c\u5b8c\u63d2\u5165\u8bed\u53e5\u540e\u5c31\u4f1a\u7acb\u5373\u91ca\u653e**\u3002 \u5728\u63d2\u5165\u6570\u636e\u65f6\uff0c\u4f1a\u52a0\u4e00\u4e2a\u8868\u7ea7\u522b\u7684 AUTO-INC \u9501 \uff0c\u7136\u540e\u4e3a\u88ab AUTO_INCREMENT \u4fee\u9970\u7684\u5b57\u6bb5\u8d4b\u503c\u9012\u589e\u7684\u503c\uff0c\u7b49\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u628a AUTO-INC \u9501\u91ca\u653e\u6389\u3002 \u90a3\u4e48\uff0c\u4e00\u4e2a\u4e8b\u52a1\u5728\u6301\u6709 AUTO-INC \u9501\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5176\u4ed6\u4e8b\u52a1\u7684\u5982\u679c\u8981\u5411\u8be5\u8868\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u4ece\u800c\u4fdd\u8bc1\u63d2\u5165\u6570\u636e\u65f6\uff0c\u88ab AUTO_INCREMENT \u4fee\u9970\u7684\u5b57\u6bb5\u7684\u503c\u662f\u8fde\u7eed\u9012\u589e\u7684\u3002 \u4f46\u662f\uff0c AUTO-INC \u9501\u518d\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u63d2\u5165\u7684\u65f6\u5019\uff0c\u4f1a\u5f71\u54cd\u63d2\u5165\u6027\u80fd\uff0c\u56e0\u4e3a\u53e6\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u63d2\u5165\u4f1a\u88ab\u963b\u585e\u3002 \u56e0\u6b64\uff0c \u5728 MySQL 5.1.22 \u7248\u672c\u5f00\u59cb\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e00\u79cd**\u8f7b\u91cf\u7ea7\u7684\u9501**\u6765\u5b9e\u73b0\u81ea\u589e\u3002 \u4e00\u6837\u4e5f\u662f\u5728\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u88ab AUTO_INCREMENT \u4fee\u9970\u7684\u5b57\u6bb5\u52a0\u4e0a\u8f7b\u91cf\u7ea7\u9501\uff0c \u7136\u540e\u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c\u4e00\u4e2a\u81ea\u589e\u7684\u503c\uff0c\u5c31\u628a\u8fd9\u4e2a\u8f7b\u91cf\u7ea7\u9501\u91ca\u653e\u4e86\uff0c\u800c\u4e0d\u9700\u8981\u7b49\u5f85\u6574\u4e2a\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u540e\u624d\u91ca\u653e\u9501 \u3002 InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e2a innodb_autoinc_lock_mode \u7684\u7cfb\u7edf\u53d8\u91cf\uff0c\u662f\u7528\u6765\u63a7\u5236\u9009\u62e9\u7528 AUTO-INC \u9501\uff0c\u8fd8\u662f\u8f7b\u91cf\u7ea7\u7684\u9501\u3002 - \u5f53 innodb_autoinc_lock_mode = 0\uff0c\u5c31\u91c7\u7528 AUTO-INC \u9501\uff0c\u8bed\u53e5\u6267\u884c\u7ed3\u675f\u540e\u624d\u91ca\u653e\u9501\uff1b - \u5f53 innodb_autoinc_lock_mode = 2\uff0c\u5c31\u91c7\u7528\u8f7b\u91cf\u7ea7\u9501\uff0c\u7533\u8bf7\u81ea\u589e\u4e3b\u952e\u540e\u5c31\u91ca\u653e\u9501\uff0c\u5e76\u4e0d\u9700\u8981\u7b49\u8bed\u53e5\u6267\u884c\u540e\u624d\u91ca\u653e\u3002 - \u5f53 innodb_autoinc_lock_mode = 1\uff1a - \u666e\u901a insert \u8bed\u53e5\uff0c\u81ea\u589e\u9501\u5728\u7533\u8bf7\u4e4b\u540e\u5c31\u9a6c\u4e0a\u91ca\u653e\uff1b - \u7c7b\u4f3c insert \u2026 select \u8fd9\u6837\u7684\u6279\u91cf\u63d2\u5165\u6570\u636e\u7684\u8bed\u53e5\uff0c\u81ea\u589e\u9501\u8fd8\u662f\u8981\u7b49\u8bed\u53e5\u7ed3\u675f\u540e\u624d\u88ab\u91ca\u653e\uff1b \u5f53 innodb_autoinc_lock_mode = 2 \u662f\u6027\u80fd\u6700\u9ad8\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u5f53\u642d\u914d binlog \u7684\u65e5\u5fd7\u683c\u5f0f\u662f statement \u4e00\u8d77\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5728\u300c\u4e3b\u4ece\u590d\u5236\u7684\u573a\u666f\u300d\u4e2d\u4f1a\u53d1\u751f**\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898**\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8003\u8651\u4e0b\u9762\u573a\u666f\uff1a session A \u5f80\u8868 t \u4e2d\u63d2\u5165\u4e86 4 \u884c\u6570\u636e\uff0c\u7136\u540e\u521b\u5efa\u4e86\u4e00\u4e2a\u76f8\u540c\u7ed3\u6784\u7684\u8868 t2\uff0c\u7136\u540e**\u4e24\u4e2a session \u540c\u65f6\u6267\u884c\u5411\u8868 t2 \u4e2d\u63d2\u5165\u6570\u636e**\u3002 \u5982\u679c innodb_autoinc_lock_mode = 2\uff0c\u610f\u5473\u7740\u300c\u7533\u8bf7\u81ea\u589e\u4e3b\u952e\u540e\u5c31\u91ca\u653e\u9501\uff0c\u4e0d\u5fc5\u7b49\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u300d\u3002\u90a3\u4e48\u5c31\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff1a session B \u5148\u63d2\u5165\u4e86\u4e24\u4e2a\u8bb0\u5f55\uff0c(1,1,1)\u3001(2,2,2)\uff1b \u7136\u540e\uff0csession A \u6765\u7533\u8bf7\u81ea\u589e id \u5f97\u5230 id=3\uff0c\u63d2\u5165\u4e86\uff083,5,5)\uff1b \u4e4b\u540e\uff0csession B \u7ee7\u7eed\u6267\u884c\uff0c\u63d2\u5165\u4e24\u6761\u8bb0\u5f55 (4,3,3)\u3001 (5,4,4)\u3002 \u53ef\u4ee5\u770b\u5230\uff0c session B \u7684 insert \u8bed\u53e5\uff0c\u751f\u6210\u7684 id \u4e0d\u8fde\u7eed \u3002 \u5f53\u300c\u4e3b\u5e93\u300d\u53d1\u751f\u4e86\u8fd9\u79cd\u60c5\u51b5\uff0cbinlog \u9762\u5bf9 t2 \u8868\u7684\u66f4\u65b0\u53ea\u4f1a\u8bb0\u5f55\u8fd9\u4e24\u4e2a session \u7684 insert \u8bed\u53e5\uff0c\u5982\u679c binlog_format=statement\uff0c\u8bb0\u5f55\u7684\u8bed\u53e5\u5c31\u662f\u539f\u59cb\u8bed\u53e5\u3002\u8bb0\u5f55\u7684\u987a\u5e8f\u8981\u4e48\u5148\u8bb0 session A \u7684 insert \u8bed\u53e5\uff0c\u8981\u4e48\u5148\u8bb0 session B \u7684 insert \u8bed\u53e5\u3002 \u4f46\u4e0d\u8bba\u662f\u54ea\u4e00\u79cd\uff0c\u8fd9\u4e2a binlog \u62ff\u53bb\u300c\u4ece\u5e93\u300d\u6267\u884c\uff0c\u8fd9\u65f6\u4ece\u5e93\u662f\u6309\u300c\u987a\u5e8f\u300d\u6267\u884c\u8bed\u53e5\u7684\uff0c\u53ea\u6709\u5f53\u6267\u884c\u5b8c\u4e00\u6761 SQL \u8bed\u53e5\u540e\uff0c\u624d\u4f1a\u6267\u884c\u4e0b\u4e00\u6761 SQL\u3002\u56e0\u6b64\uff0c\u5728**\u4ece\u5e93\u4e0a\u300c\u4e0d\u4f1a\u300d\u53d1\u751f\u50cf\u4e3b\u5e93\u90a3\u6837\u4e24\u4e2a session \u300c\u540c\u65f6\u300d\u6267\u884c\u5411\u8868 t2 \u4e2d\u63d2\u5165\u6570\u636e\u7684\u573a\u666f\u3002\u6240\u4ee5\uff0c\u5728\u5907\u5e93\u4e0a\u6267\u884c\u4e86 session B \u7684 insert \u8bed\u53e5\uff0c\u751f\u6210\u7684\u7ed3\u679c\u91cc\u9762\uff0cid \u90fd\u662f\u8fde\u7eed\u7684\u3002\u8fd9\u65f6\uff0c\u4e3b\u4ece\u5e93\u5c31\u53d1\u751f\u4e86\u6570\u636e\u4e0d\u4e00\u81f4**\u3002 \u8981\u89e3\u51b3\u8fd9\u95ee\u9898\uff0cbinlog \u65e5\u5fd7\u683c\u5f0f\u8981\u8bbe\u7f6e\u4e3a row\uff0c\u8fd9\u6837\u5728 binlog \u91cc\u9762\u8bb0\u5f55\u7684\u662f\u4e3b\u5e93\u5206\u914d\u7684\u81ea\u589e\u503c\uff0c\u5230\u5907\u5e93\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e3b\u5e93\u7684\u81ea\u589e\u503c\u662f\u4ec0\u4e48\uff0c\u4ece\u5e93\u7684\u81ea\u589e\u503c\u5c31\u662f\u4ec0\u4e48\u3002 \u6240\u4ee5\uff0c \u5f53 innodb_autoinc_lock_mode = 2 \u65f6\uff0c\u5e76\u4e14 binlog_format = row\uff0c\u65e2\u80fd\u63d0\u5347\u5e76\u53d1\u6027\uff0c\u53c8\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898 \u3002","title":"AUTO-INC \u9501"},{"location":"mysql/lock/mysql_lock/#_6","text":"InnoDB \u5f15\u64ce\u662f\u652f\u6301\u884c\u7ea7\u9501\u7684\uff0c\u800c MyISAM \u5f15\u64ce\u5e76\u4e0d\u652f\u6301\u884c\u7ea7\u9501\u3002 \u524d\u9762\u4e5f\u63d0\u5230\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u5feb\u7167\u8bfb\u3002\u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff0c\u8fd9\u79cd\u67e5\u8be2\u4f1a\u52a0\u9501\u7684\u8bed\u53e5\u79f0\u4e3a**\u9501\u5b9a\u8bfb**\u3002 // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501 select ... lock in share mode ; // \u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501 select ... for update ; \u4e0a\u9762\u8fd9\u4e24\u6761\u8bed\u53e5\u5fc5\u987b\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c \u56e0\u4e3a\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e86\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e \uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u8fd9\u4e24\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u8981\u52a0\u4e0a begin\u3001start transaction \u6216\u8005 set autocommit = 0\u3002 \u5171\u4eab\u9501\uff08S\u9501\uff09\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\uff0c\u8bfb\u5199\u4e92\u65a5\u3002\u72ec\u5360\u9501\uff08X\u9501\uff09\u6ee1\u8db3\u5199\u5199\u4e92\u65a5\u3001\u8bfb\u5199\u4e92\u65a5\u3002 \u884c\u7ea7\u9501\u7684\u7c7b\u578b\u4e3b\u8981\u6709\u4e09\u7c7b\uff1a Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\uff1b Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u4f46\u662f\u4e0d\u5305\u542b\u8bb0\u5f55\u672c\u8eab\uff1b Next-Key Lock\uff1aRecord Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002","title":"\u884c\u7ea7\u9501"},{"location":"mysql/lock/mysql_lock/#record-lock","text":"Record Lock \u79f0\u4e3a\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u662f\u4e00\u6761\u8bb0\u5f55\u3002\u800c\u4e14\u8bb0\u5f55\u9501\u662f\u6709 S \u9501\u548c X \u9501\u4e4b\u5206\u7684\uff1a \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 S \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e S \u9501\u517c\u5bb9\uff09\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09; \u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 X \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e2\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08X \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a mysql > begin ; mysql > select * from t_test where id = 1 for update ; \u5c31\u662f\u5bf9 t_test \u8868\u4e2d\u4e3b\u952e id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u8fd9\u6837\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u4e86\u3002 \u5f53\u4e8b\u52a1\u6267\u884c commit \u540e\uff0c\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u751f\u6210\u7684\u9501\u90fd\u4f1a\u88ab\u91ca\u653e\u3002","title":"Record Lock"},{"location":"mysql/lock/mysql_lock/#gap-lock","text":"Gap Lock \u79f0\u4e3a\u95f4\u9699\u9501\uff0c\u53ea\u5b58\u5728\u4e8e\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u95f4\u9699\u9501\u867d\u7136\u5b58\u5728 X \u578b\u95f4\u9699\u9501\u548c S \u578b\u95f4\u9699\u9501\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c \u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5e76\u4e0d\u5b58\u5728\u4e92\u65a5\u5173\u7cfb\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u7684\u76ee\u7684\u662f\u9632\u6b62\u63d2\u5165\u5e7b\u5f71\u8bb0\u5f55\u800c\u63d0\u51fa\u7684 \u3002","title":"Gap Lock"},{"location":"mysql/lock/mysql_lock/#next-key-lock","text":"Next-Key Lock \u79f0\u4e3a\u4e34\u952e\u9501\uff0c\u662f Record Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5] \u7684 next-key lock\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5373\u4e0d\u80fd\u63d2\u5165 id = 4 \u8bb0\u5f55\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539 id = 5 \u8fd9\u6761\u8bb0\u5f55\u3002 \u6240\u4ee5\uff0cnext-key lock \u5373\u80fd\u4fdd\u62a4\u8be5\u8bb0\u5f55\uff0c\u53c8\u80fd\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u5c06\u65b0\u7eaa\u5f55\u63d2\u5165\u5230\u88ab\u4fdd\u62a4\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u4e2d\u3002 next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684 \u3002 \u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002 \u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\uff0cX \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\u3002","title":"Next-Key Lock"},{"location":"mysql/lock/mysql_lock/#_7","text":"\u4e00\u4e2a\u4e8b\u52a1\u5728\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u9700\u8981\u5224\u65ad\u63d2\u5165\u4f4d\u7f6e\u662f\u5426\u5df2\u88ab\u5176\u4ed6\u4e8b\u52a1\u52a0\u4e86\u95f4\u9699\u9501\uff08next-key lock \u4e5f\u5305\u542b\u95f4\u9699\u9501\uff09\u3002 \u5982\u679c\u6709\u7684\u8bdd\uff0c\u63d2\u5165\u64cd\u4f5c\u5c31\u4f1a\u53d1\u751f**\u963b\u585e**\uff0c\u76f4\u5230\u62e5\u6709\u95f4\u9699\u9501\u7684\u90a3\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u4e3a\u6b62\uff08\u91ca\u653e\u95f4\u9699\u9501\u7684\u65f6\u523b\uff09\uff0c\u5728\u6b64\u671f\u95f4\u4f1a\u751f\u6210\u4e00\u4e2a**\u63d2\u5165\u610f\u5411\u9501**\uff0c\u8868\u660e\u6709\u4e8b\u52a1\u60f3\u5728\u67d0\u4e2a\u533a\u95f4\u63d2\u5165\u65b0\u8bb0\u5f55\uff0c\u4f46\u662f\u73b0\u5728\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e8b\u52a1 A \u5df2\u7ecf\u5bf9\u8868\u52a0\u4e86\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\u3002 \u5f53\u4e8b\u52a1 A \u8fd8\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4e8b\u52a1 B \u5411\u8be5\u8868\u63d2\u5165\u4e00\u6761 id = 4 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd9\u65f6\u4f1a\u5224\u65ad\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\u5df2\u7ecf\u88ab\u4e8b\u52a1 A \u52a0\u4e86\u95f4\u9699\u9501\uff0c\u4e8e\u662f\u4e8b\u7269 B \u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u5c06\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u867d\u7136\u6709\u610f\u5411\u9501\uff0c\u4f46\u662f\u5b83\u5e76**\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u5c5e\u4e8e\u884c\u7ea7\u522b\u9501**\u3002 \u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a\u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL\u6280\u672f\u5185\u5e55\uff1ainnodb\u300b \u300aMySQL\u5b9e\u621845\u8bb2\u300b \u300a\u4ece\u6839\u513f\u4e0a\u7406\u89e3MySQL\u300b \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u63d2\u5165\u610f\u5411\u9501"},{"location":"mysql/lock/show_lock/","text":"\u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4e4b\u524d\u6536\u5230\u8bfb\u8005\u9762\u8bd5\u5b57\u8282\u65f6\uff0c\u88ab\u95ee\u5230\u4e00\u4e2a\u5173\u4e8e MySQL \u7684\u95ee\u9898\u3002 \u5982\u679c\u5bf9 MySQL \u52a0\u9501\u673a\u5236\u6bd4\u8f83\u719f\u6089\u7684\u540c\u5b66\uff0c\u5e94\u8be5\u4e00\u773c\u5c31\u80fd\u770b\u51fa**\u4f1a\u53d1\u751f\u6b7b\u9501**\uff0c\u4f46\u662f\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u6b7b\u9501\uff0c\u662f\u9700\u8981\u6211\u4eec\u5177\u4f53\u5206\u6790\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u5c31\u8ddf\u804a\u804a\u4e0a\u9762\u4e24\u4e2a\u4e8b\u52a1\u6267\u884c SQL \u8bed\u53e5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u4ece\u800c\u5bfc\u81f4\u6b7b\u9501\u7684\u3002 \u51c6\u5907\u5de5\u4f5c \u00b6 \u5148\u521b\u5efa\u4e00\u5f20 t_student \u8868\uff0c\u5047\u8bbe\u9664\u4e86 id \u5b57\u6bb5\uff0c\u5176\u4ed6\u5b57\u6bb5\u90fd\u662f\u666e\u901a\u5b57\u6bb5\u3002 CREATE TABLE ` t_student ` ( ` id ` int NOT NULL , ` no ` varchar ( 255 ) DEFAULT NULL , ` name ` varchar ( 255 ) DEFAULT NULL , ` age ` int DEFAULT NULL , ` score ` int DEFAULT NULL , PRIMARY KEY ( ` id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 ; \u7136\u540e\uff0c\u63d2\u5165\u76f8\u5173\u7684\u6570\u636e\u540e\uff0ct_student \u8868\u4e2d\u7684\u8bb0\u5f55\u5982\u4e0b\uff1a \u5f00\u59cb\u5b9e\u9a8c \u00b6 \u5728\u5b9e\u9a8c\u5f00\u59cb\u524d\uff0c\u5148\u8bf4\u660e\u4e0b\u5b9e\u9a8c\u73af\u5883\uff1a MySQL \u7248\u672c\uff1a8.0.26 \u9694\u79bb\u7ea7\u522b\uff1a\u53ef\u91cd\u590d\u8bfb\uff08RR\uff09 \u542f\u52a8\u4e24\u4e2a\u4e8b\u52a1\uff0c\u6309\u7167\u9898\u76ee\u7684 SQL \u6267\u884c\u987a\u5e8f\uff0c\u8fc7\u7a0b\u5982\u4e0b\u8868\u683c\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u90fd\u5728\u6267\u884c insert \u8bed\u53e5\u540e\uff0c\u90fd\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff08\u524d\u63d0\u6ca1\u6709\u6253\u5f00\u6b7b\u9501\u68c0\u6d4b\uff09\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u6b7b\u9501\uff0c\u56e0\u4e3a\u90fd\u5728\u76f8\u4e92\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u3002 \u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff1f \u00b6 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u63a5\u4e0b\u6765\uff0c\u9488\u5bf9\u6bcf\u4e00\u6761 SQL \u8bed\u53e5\u5206\u6790\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 Time 1 \u9636\u6bb5\u52a0\u9501\u5206\u6790 \u00b6 Time 1 \u9636\u6bb5\uff0c\u4e8b\u52a1 A \u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a # \u4e8b\u52a1 A mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > update t_student set score = 100 where id = 25 ; Query OK , 0 rows affected ( 0 . 01 sec ) Rows matched : 0 Changed : 0 Warnings : 0 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 A \u6b64\u65f6\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff0c\u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\uff08INDEX_NAME : PRIMARY\uff09\u4e0a\u52a0\u7684\u662f\u95f4\u9699\u9501\uff0c\u9501\u8303\u56f4\u662f (20, 30) \u3002 \u95f4\u9699\u9501\u7684\u8303\u56f4 (20, 30) \uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f 30\u3002 \u7136\u540e\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u662f t_student \u8868\u4e2d id \u4e3a 30 \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684 id \u503c\uff0c\u5373 20\u3002 \u56e0\u6b64\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4 (20, 30) \u3002 Time 2 \u9636\u6bb5\u52a0\u9501\u5206\u6790 \u00b6 Time 2 \u9636\u6bb5\uff0c\u4e8b\u52a1 B \u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a # \u4e8b\u52a1 B mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > update t_student set score = 100 where id = 26 ; Query OK , 0 rows affected ( 0 . 01 sec ) Rows matched : 0 Changed : 0 Warnings : 0 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 B \u6b64\u65f6\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u884c\u9501\u662f X \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4\u662f (20, 30) \u3002 \u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u7684\u95f4\u9699\u9501\u8303\u56f4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u51b2\u7a81\uff1f \u4e24\u4e2a\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4e0d\u4f1a\u4ea7\u751f\u51b2\u7a81\u3002 \u5728MySQL\u5b98\u7f51\u4e0a\u8fd8\u6709\u4e00\u6bb5\u975e\u5e38\u5173\u952e\u7684\u63cf\u8ff0\uff1a Gap locks in InnoDB are \u201cpurely inhibitive\u201d, which means that their only purpose is to prevent other transactions from Inserting to the gap. Gap locks can co-exist. A gap lock taken by one transaction does not prevent another transaction from taking a gap lock on the same gap. There is no difference between shared and exclusive gap locks. They do not conflict with each other, and they perform the same function. \u95f4\u9699\u9501\u7684\u610f\u4e49\u53ea\u5728\u4e8e\u963b\u6b62\u533a\u95f4\u88ab\u63d2\u5165 \uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u5171\u5b58\u7684\u3002 \u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u7684\u95f4\u9699\u9501\u4e0d\u4f1a\u963b\u6b62\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u540c\u4e00\u4e2a\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501 \uff0c\u5171\u4eab\uff08S\u578b\uff09\u548c\u6392\u4ed6\uff08X\u578b\uff09\u7684\u95f4\u9699\u9501\u662f\u6ca1\u6709\u533a\u522b\u7684\uff0c\u4ed6\u4eec\u76f8\u4e92\u4e0d\u51b2\u7a81\uff0c\u4e14\u529f\u80fd\u76f8\u540c\u3002 Time 3 \u9636\u6bb5\u52a0\u9501\u5206\u6790 \u00b6 Time 3\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff1a # Time 3 \u9636\u6bb5\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55 mysql > insert into t_student ( id , no , name , age , score ) value ( 25 , 'S0025' , 'sony' , 28 , 90 ); /// \u963b\u585e\u7b49\u5f85 ...... \u6b64\u65f6\uff0c\u4e8b\u52a1 A \u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 A \u5728\u83b7\u53d6\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u88ab\u963b\u585e\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u7684\u72b6\u6001\u4e3a\u7b49\u5f85\u72b6\u6001\uff08LOCK_STATUS: WAITING\uff09\uff0c\u56e0\u4e3a\u5411\u4e8b\u52a1 B \u751f\u6210\u7684\u95f4\u9699\u9501\uff08\u8303\u56f4 (20, 30) \uff09\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 A \u7684\u63d2\u5165\u64cd\u4f5c\u751f\u6210\u4e86\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff08 LOCK_MODE:INSERT_INTENTION \uff09\u3002 \u63d2\u5165\u610f\u5411\u9501\u662f\u4ec0\u4e48\uff1f \u6ce8\u610f\uff01\u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u91cc\u867d\u7136\u6709\u610f\u5411\u9501\u8fd9\u4e09\u4e2a\u5b57\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u5c5e\u4e8e\u884c\u7ea7\u9501\uff0c\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u5728MySQL\u7684\u5b98\u65b9\u6587\u6863\u4e2d\u6709\u4ee5\u4e0b\u91cd\u8981\u63cf\u8ff0\uff1a An Insert intention lock is a type of gap lock set by Insert operations prior to row Insertion. This lock signals the intent to Insert in such a way that multiple transactions Inserting into the same index gap need not wait for each other if they are not Inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to Insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with Insert intention locks prior to obtaining the exclusive lock on the Inserted row, but do not block each other because the rows are nonconflicting. \u8fd9\u6bb5\u8bdd\u8868\u660e\u5c3d\u7ba1**\u63d2\u5165\u610f\u5411\u9501\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u4f46\u4e0d\u540c\u4e8e\u95f4\u9699\u9501\u7684\u662f\uff0c\u8be5\u9501\u53ea\u7528\u4e8e\u5e76\u53d1\u63d2\u5165\u64cd\u4f5c**\u3002 \u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a \u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002\u6240\u4ee5\uff0c\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u51b2\u7a81\u7684 \u3002 \u53e6\u5916\uff0c\u6211\u8865\u5145\u4e00\u70b9\uff0c\u63d2\u5165\u610f\u5411\u9501\u7684\u751f\u6210\u65f6\u673a\uff1a \u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002 Time 4 \u9636\u6bb5\u52a0\u9501\u5206\u6790 \u00b6 Time 4\uff0c\u4e8b\u52a1 B \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff1a # Time 4 \u9636\u6bb5\uff0c\u4e8b\u52a1 B \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55 mysql > insert into t_student ( id , no , name , age , score ) value ( 26 , 'S0026' , 'ace' , 28 , 90 ); /// \u963b\u585e\u7b49\u5f85 ...... \u6b64\u65f6\uff0c\u4e8b\u52a1 B \u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 B \u5728\u83b7\u53d6\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u88ab\u963b\u585e\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 B \u5728\u751f\u6210\u63d2\u5165\u610f\u5411\u9501\u65f6\u800c\u5bfc\u81f4\u88ab\u963b\u585e\uff0c\u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 B \u5411\u4e8b\u52a1 A \u751f\u6210\u7684\u8303\u56f4\u4e3a (20, 30) \u7684\u95f4\u9699\u9501\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u800c\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u83b7\u53d6\u63d2\u5165\u610f\u5411\u9501\u65f6\u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002 \u6700\u540e\u56de\u7b54\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff1f \u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u5728\u6267\u884c\u5b8c\u540e update \u8bed\u53e5\u540e\u90fd\u6301\u6709\u8303\u56f4\u4e3a (20, 30\uff09 \u7684\u95f4\u9699\u9501\uff0c\u800c\u63a5\u4e0b\u6765\u7684\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u6ee1\u8db3\u4e86\u6b7b\u9501\u7684\u56db\u4e2a\u6761\u4ef6\uff1a \u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85 \uff0c\u56e0\u6b64\u53d1\u751f\u4e86\u6b7b\u9501\u3002 \u603b\u7ed3 \u00b6 \u4e24\u4e2a\u4e8b\u52a1\u5373\u4f7f\u751f\u6210\u7684\u95f4\u9699\u9501\u7684\u8303\u56f4\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u6570\u636e\uff0c\u56e0\u6b64\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u76f8\u4e92\u517c\u5bb9\u7684\u3002 \u5728\u6267\u884c\u63d2\u5165\u8bed\u53e5\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u8bb0\u5f55\u5728\u5176\u4ed6\u4e8b\u52a1\u6301\u6709\u95f4\u9699\u9501\u8303\u56f4\u5185\uff0c\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u63d2\u5165\u8bed\u53e5\u5728\u78b0\u5230\u95f4\u9699\u9501\u65f6\uff0c\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u4e92\u65a5\u7684\u5173\u7cfb\u3002 \u5982\u679c\u4e24\u4e2a\u4e8b\u52a1\u5206\u522b\u5411\u5bf9\u65b9\u6301\u6709\u7684\u95f4\u9699\u9501\u8303\u56f4\u5185\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u800c\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u6ee1\u8db3\u4e86\u6b7b\u9501\u7684\u56db\u4e2a\u6761\u4ef6\uff1a \u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85 \uff0c\u56e0\u6b64\u53d1\u751f\u4e86\u6b7b\u9501\u3002 \u8bfb\u8005\u95ee\u7b54 \u00b6 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f"},{"location":"mysql/lock/show_lock/#_1","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4e4b\u524d\u6536\u5230\u8bfb\u8005\u9762\u8bd5\u5b57\u8282\u65f6\uff0c\u88ab\u95ee\u5230\u4e00\u4e2a\u5173\u4e8e MySQL \u7684\u95ee\u9898\u3002 \u5982\u679c\u5bf9 MySQL \u52a0\u9501\u673a\u5236\u6bd4\u8f83\u719f\u6089\u7684\u540c\u5b66\uff0c\u5e94\u8be5\u4e00\u773c\u5c31\u80fd\u770b\u51fa**\u4f1a\u53d1\u751f\u6b7b\u9501**\uff0c\u4f46\u662f\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u6b7b\u9501\uff0c\u662f\u9700\u8981\u6211\u4eec\u5177\u4f53\u5206\u6790\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u5c31\u8ddf\u804a\u804a\u4e0a\u9762\u4e24\u4e2a\u4e8b\u52a1\u6267\u884c SQL \u8bed\u53e5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u4ece\u800c\u5bfc\u81f4\u6b7b\u9501\u7684\u3002","title":"\u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f"},{"location":"mysql/lock/show_lock/#_2","text":"\u5148\u521b\u5efa\u4e00\u5f20 t_student \u8868\uff0c\u5047\u8bbe\u9664\u4e86 id \u5b57\u6bb5\uff0c\u5176\u4ed6\u5b57\u6bb5\u90fd\u662f\u666e\u901a\u5b57\u6bb5\u3002 CREATE TABLE ` t_student ` ( ` id ` int NOT NULL , ` no ` varchar ( 255 ) DEFAULT NULL , ` name ` varchar ( 255 ) DEFAULT NULL , ` age ` int DEFAULT NULL , ` score ` int DEFAULT NULL , PRIMARY KEY ( ` id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 ; \u7136\u540e\uff0c\u63d2\u5165\u76f8\u5173\u7684\u6570\u636e\u540e\uff0ct_student \u8868\u4e2d\u7684\u8bb0\u5f55\u5982\u4e0b\uff1a","title":"\u51c6\u5907\u5de5\u4f5c"},{"location":"mysql/lock/show_lock/#_3","text":"\u5728\u5b9e\u9a8c\u5f00\u59cb\u524d\uff0c\u5148\u8bf4\u660e\u4e0b\u5b9e\u9a8c\u73af\u5883\uff1a MySQL \u7248\u672c\uff1a8.0.26 \u9694\u79bb\u7ea7\u522b\uff1a\u53ef\u91cd\u590d\u8bfb\uff08RR\uff09 \u542f\u52a8\u4e24\u4e2a\u4e8b\u52a1\uff0c\u6309\u7167\u9898\u76ee\u7684 SQL \u6267\u884c\u987a\u5e8f\uff0c\u8fc7\u7a0b\u5982\u4e0b\u8868\u683c\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u90fd\u5728\u6267\u884c insert \u8bed\u53e5\u540e\uff0c\u90fd\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff08\u524d\u63d0\u6ca1\u6709\u6253\u5f00\u6b7b\u9501\u68c0\u6d4b\uff09\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u6b7b\u9501\uff0c\u56e0\u4e3a\u90fd\u5728\u76f8\u4e92\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u3002","title":"\u5f00\u59cb\u5b9e\u9a8c"},{"location":"mysql/lock/show_lock/#_4","text":"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u63a5\u4e0b\u6765\uff0c\u9488\u5bf9\u6bcf\u4e00\u6761 SQL \u8bed\u53e5\u5206\u6790\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u3002","title":"\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff1f"},{"location":"mysql/lock/show_lock/#time-1","text":"Time 1 \u9636\u6bb5\uff0c\u4e8b\u52a1 A \u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a # \u4e8b\u52a1 A mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > update t_student set score = 100 where id = 25 ; Query OK , 0 rows affected ( 0 . 01 sec ) Rows matched : 0 Changed : 0 Warnings : 0 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 A \u6b64\u65f6\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a \u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b \u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b \u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff0c\u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a \u5982\u679c LOCK_MODE \u4e3a X \uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, REC_NOT_GAP \uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b \u5982\u679c LOCK_MODE \u4e3a X, GAP \uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b \u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\uff08INDEX_NAME : PRIMARY\uff09\u4e0a\u52a0\u7684\u662f\u95f4\u9699\u9501\uff0c\u9501\u8303\u56f4\u662f (20, 30) \u3002 \u95f4\u9699\u9501\u7684\u8303\u56f4 (20, 30) \uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f \u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f 30\u3002 \u7136\u540e\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u662f t_student \u8868\u4e2d id \u4e3a 30 \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684 id \u503c\uff0c\u5373 20\u3002 \u56e0\u6b64\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4 (20, 30) \u3002","title":"Time 1 \u9636\u6bb5\u52a0\u9501\u5206\u6790"},{"location":"mysql/lock/show_lock/#time-2","text":"Time 2 \u9636\u6bb5\uff0c\u4e8b\u52a1 B \u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a # \u4e8b\u52a1 B mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > update t_student set score = 100 where id = 26 ; Query OK , 0 rows affected ( 0 . 01 sec ) Rows matched : 0 Changed : 0 Warnings : 0 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 B \u6b64\u65f6\u52a0\u4e86\u4ec0\u4e48\u9501\u3002 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u884c\u9501\u662f X \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4\u662f (20, 30) \u3002 \u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u7684\u95f4\u9699\u9501\u8303\u56f4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u51b2\u7a81\uff1f \u4e24\u4e2a\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4e0d\u4f1a\u4ea7\u751f\u51b2\u7a81\u3002 \u5728MySQL\u5b98\u7f51\u4e0a\u8fd8\u6709\u4e00\u6bb5\u975e\u5e38\u5173\u952e\u7684\u63cf\u8ff0\uff1a Gap locks in InnoDB are \u201cpurely inhibitive\u201d, which means that their only purpose is to prevent other transactions from Inserting to the gap. Gap locks can co-exist. A gap lock taken by one transaction does not prevent another transaction from taking a gap lock on the same gap. There is no difference between shared and exclusive gap locks. They do not conflict with each other, and they perform the same function. \u95f4\u9699\u9501\u7684\u610f\u4e49\u53ea\u5728\u4e8e\u963b\u6b62\u533a\u95f4\u88ab\u63d2\u5165 \uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u5171\u5b58\u7684\u3002 \u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u7684\u95f4\u9699\u9501\u4e0d\u4f1a\u963b\u6b62\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u540c\u4e00\u4e2a\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501 \uff0c\u5171\u4eab\uff08S\u578b\uff09\u548c\u6392\u4ed6\uff08X\u578b\uff09\u7684\u95f4\u9699\u9501\u662f\u6ca1\u6709\u533a\u522b\u7684\uff0c\u4ed6\u4eec\u76f8\u4e92\u4e0d\u51b2\u7a81\uff0c\u4e14\u529f\u80fd\u76f8\u540c\u3002","title":"Time 2 \u9636\u6bb5\u52a0\u9501\u5206\u6790"},{"location":"mysql/lock/show_lock/#time-3","text":"Time 3\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff1a # Time 3 \u9636\u6bb5\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55 mysql > insert into t_student ( id , no , name , age , score ) value ( 25 , 'S0025' , 'sony' , 28 , 90 ); /// \u963b\u585e\u7b49\u5f85 ...... \u6b64\u65f6\uff0c\u4e8b\u52a1 A \u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 A \u5728\u83b7\u53d6\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u88ab\u963b\u585e\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u7684\u72b6\u6001\u4e3a\u7b49\u5f85\u72b6\u6001\uff08LOCK_STATUS: WAITING\uff09\uff0c\u56e0\u4e3a\u5411\u4e8b\u52a1 B \u751f\u6210\u7684\u95f4\u9699\u9501\uff08\u8303\u56f4 (20, 30) \uff09\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 A \u7684\u63d2\u5165\u64cd\u4f5c\u751f\u6210\u4e86\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff08 LOCK_MODE:INSERT_INTENTION \uff09\u3002 \u63d2\u5165\u610f\u5411\u9501\u662f\u4ec0\u4e48\uff1f \u6ce8\u610f\uff01\u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u91cc\u867d\u7136\u6709\u610f\u5411\u9501\u8fd9\u4e09\u4e2a\u5b57\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u5c5e\u4e8e\u884c\u7ea7\u9501\uff0c\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u5728MySQL\u7684\u5b98\u65b9\u6587\u6863\u4e2d\u6709\u4ee5\u4e0b\u91cd\u8981\u63cf\u8ff0\uff1a An Insert intention lock is a type of gap lock set by Insert operations prior to row Insertion. This lock signals the intent to Insert in such a way that multiple transactions Inserting into the same index gap need not wait for each other if they are not Inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to Insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with Insert intention locks prior to obtaining the exclusive lock on the Inserted row, but do not block each other because the rows are nonconflicting. \u8fd9\u6bb5\u8bdd\u8868\u660e\u5c3d\u7ba1**\u63d2\u5165\u610f\u5411\u9501\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u4f46\u4e0d\u540c\u4e8e\u95f4\u9699\u9501\u7684\u662f\uff0c\u8be5\u9501\u53ea\u7528\u4e8e\u5e76\u53d1\u63d2\u5165\u64cd\u4f5c**\u3002 \u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002 \u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a \u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002\u6240\u4ee5\uff0c\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u51b2\u7a81\u7684 \u3002 \u53e6\u5916\uff0c\u6211\u8865\u5145\u4e00\u70b9\uff0c\u63d2\u5165\u610f\u5411\u9501\u7684\u751f\u6210\u65f6\u673a\uff1a \u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08 PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501 \uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002","title":"Time 3 \u9636\u6bb5\u52a0\u9501\u5206\u6790"},{"location":"mysql/lock/show_lock/#time-4","text":"Time 4\uff0c\u4e8b\u52a1 B \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff1a # Time 4 \u9636\u6bb5\uff0c\u4e8b\u52a1 B \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55 mysql > insert into t_student ( id , no , name , age , score ) value ( 26 , 'S0026' , 'ace' , 28 , 90 ); /// \u963b\u585e\u7b49\u5f85 ...... \u6b64\u65f6\uff0c\u4e8b\u52a1 B \u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002 \u7136\u540e\u6267\u884c select * from performance_schema.data_locks\\G; \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 B \u5728\u83b7\u53d6\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u88ab\u963b\u585e\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 B \u5728\u751f\u6210\u63d2\u5165\u610f\u5411\u9501\u65f6\u800c\u5bfc\u81f4\u88ab\u963b\u585e\uff0c\u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 B \u5411\u4e8b\u52a1 A \u751f\u6210\u7684\u8303\u56f4\u4e3a (20, 30) \u7684\u95f4\u9699\u9501\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u800c\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u83b7\u53d6\u63d2\u5165\u610f\u5411\u9501\u65f6\u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002 \u6700\u540e\u56de\u7b54\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff1f \u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u5728\u6267\u884c\u5b8c\u540e update \u8bed\u53e5\u540e\u90fd\u6301\u6709\u8303\u56f4\u4e3a (20, 30\uff09 \u7684\u95f4\u9699\u9501\uff0c\u800c\u63a5\u4e0b\u6765\u7684\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u6ee1\u8db3\u4e86\u6b7b\u9501\u7684\u56db\u4e2a\u6761\u4ef6\uff1a \u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85 \uff0c\u56e0\u6b64\u53d1\u751f\u4e86\u6b7b\u9501\u3002","title":"Time 4 \u9636\u6bb5\u52a0\u9501\u5206\u6790"},{"location":"mysql/lock/show_lock/#_5","text":"\u4e24\u4e2a\u4e8b\u52a1\u5373\u4f7f\u751f\u6210\u7684\u95f4\u9699\u9501\u7684\u8303\u56f4\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u6570\u636e\uff0c\u56e0\u6b64\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u76f8\u4e92\u517c\u5bb9\u7684\u3002 \u5728\u6267\u884c\u63d2\u5165\u8bed\u53e5\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u8bb0\u5f55\u5728\u5176\u4ed6\u4e8b\u52a1\u6301\u6709\u95f4\u9699\u9501\u8303\u56f4\u5185\uff0c\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u63d2\u5165\u8bed\u53e5\u5728\u78b0\u5230\u95f4\u9699\u9501\u65f6\uff0c\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u4e92\u65a5\u7684\u5173\u7cfb\u3002 \u5982\u679c\u4e24\u4e2a\u4e8b\u52a1\u5206\u522b\u5411\u5bf9\u65b9\u6301\u6709\u7684\u95f4\u9699\u9501\u8303\u56f4\u5185\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u800c\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u6ee1\u8db3\u4e86\u6b7b\u9501\u7684\u56db\u4e2a\u6761\u4ef6\uff1a \u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85 \uff0c\u56e0\u6b64\u53d1\u751f\u4e86\u6b7b\u9501\u3002","title":"\u603b\u7ed3"},{"location":"mysql/lock/show_lock/#_6","text":"\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u8bfb\u8005\u95ee\u7b54"},{"location":"mysql/lock/update_index/","text":"update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6628\u665a\u5728\u7fa4\u5212\u6c34\u7684\u65f6\u5019\uff0c\u770b\u5230\u6709\u4f4d\u8bfb\u8005\u8bf4\u4e86\u8fd9\u4e48\u4e00\u4ef6\u4e8b\u3002 \u5927\u6982\u5c31\u662f\uff0c\u5728\u7ebf\u4e0a\u6267\u884c\u4e00\u6761 update \u8bed\u53e5\u4fee\u6539\u6570\u636e\u5e93\u6570\u636e\u7684\u65f6\u5019\uff0cwhere \u6761\u4ef6\u6ca1\u6709\u5e26\u4e0a\u7d22\u5f15\uff0c\u5bfc\u81f4\u4e1a\u52a1\u76f4\u63a5\u5d29\u4e86\uff0c\u88ab\u8001\u677f\u6559\u8bad\u4e86\u4e00\u6ce2 \u8fd9\u6b21\u6211\u4eec\u5c31\u6765\u770b\u770b\uff1a - \u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u7684\u4e8b\u6545\uff1f - \u53c8\u8be5\u5982\u4f55\u907f\u514d\u8fd9\u79cd\u4e8b\u6545\u7684\u53d1\u751f\uff1f \u8bf4\u4e2a\u524d\u63d0\uff0c\u63a5\u4e0b\u6765\u8bf4\u7684\u6848\u4f8b\u90fd\u662f\u57fa\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u4e14\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u662f\u53ef\u91cd\u590d\u8bfb\u3002 \u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u7684\u4e8b\u6545\uff1f \u00b6 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u9ed8\u8ba4\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5728\u8fd9\u4e2a\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5728\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6240\u8c13\u7684\u5e7b\u8bfb\u662f\u6307\u5728\u540c\u4e00\u4e8b\u52a1\u4e0b\uff0c\u8fde\u7eed\u6267\u884c\u4e24\u6b21\u540c\u6837\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u7b2c\u4e8c\u6b21\u7684\u67e5\u8be2\u8bed\u53e5\u53ef\u80fd\u4f1a\u8fd4\u56de\u4e4b\u524d\u4e0d\u5b58\u5728\u7684\u884c\u3002 \u56e0\u6b64 InnoDB \u5b58\u50a8\u5f15\u64ce\u81ea\u5df1\u5b9e\u73b0\u4e86\u884c\u9501\uff0c\u901a\u8fc7 next-key \u9501\uff08\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7684\u7ec4\u5408\uff09\u6765\u9501\u4f4f\u8bb0\u5f55\u672c\u8eab\u548c\u8bb0\u5f55\u4e4b\u95f4\u7684\u201c\u95f4\u9699\u201d\uff0c\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u8bb0\u5f55\u4e4b\u95f4\u63d2\u5165\u65b0\u7684\u8bb0\u5f55\uff0c\u4ece\u800c\u907f\u514d\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002 \u5f53\u6211\u4eec\u6267\u884c update \u8bed\u53e5\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\uff08X \u9501\uff09\u7684\uff0c\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u5bf9\u6301\u6709\u72ec\u5360\u9501\u7684\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u65f6\u662f\u4f1a\u88ab\u963b\u585e\u7684\u3002\u53e6\u5916\uff0c\u8fd9\u4e2a\u9501\u5e76\u4e0d\u662f\u6267\u884c\u5b8c update \u8bed\u53e5\u5c31\u4f1a\u91ca\u653e\u7684\uff0c\u800c\u662f\u4f1a\u7b49\u4e8b\u52a1\u7ed3\u675f\u65f6\u624d\u4f1a\u91ca\u653e\u3002 \u5728 InnoDB \u4e8b\u52a1\u4e2d\uff0c\u5bf9\u8bb0\u5f55\u52a0\u9501\u5e26\u57fa\u672c\u5355\u4f4d\u662f next-key \u9501\uff0c\u4f46\u662f\u4f1a\u56e0\u4e3a\u4e00\u4e9b\u6761\u4ef6\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u6216\u8005\u8bb0\u5f55\u9501\u3002\u52a0\u9501\u7684\u4f4d\u7f6e\u51c6\u786e\u7684\u8bf4\uff0c\u9501\u662f\u52a0\u5728\u7d22\u5f15\u4e0a\u7684\u800c\u975e\u884c\u4e0a\u3002 \u6bd4\u5982\uff0c\u5728 update \u8bed\u53e5\u7684 where \u6761\u4ef6\u4f7f\u7528\u4e86\u552f\u4e00\u7d22\u5f15\uff0c\u90a3\u4e48 next-key \u9501\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u53ea\u4f1a\u7ed9\u4e00\u884c\u8bb0\u5f55\u52a0\u9501\u3002 \u8fd9\u91cc\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8fd9\u91cc\u6709\u4e00\u5f20\u6570\u636e\u5e93\u8868\uff0c\u5176\u4e2d id \u4e3a\u4e3b\u952e\u7d22\u5f15\u3002 \u5047\u8bbe\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u7684 update \u8bed\u53e5\u4e2d where \u662f\u7b49\u503c\u67e5\u8be2\uff0c\u5e76\u4e14 id \u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u53ea\u4f1a\u5bf9 id = 1 \u8fd9\u6761\u8bb0\u5f55\u52a0\u9501\uff0c\u56e0\u6b64\uff0c\u4e8b\u52a1 B \u7684\u66f4\u65b0\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u963b\u585e\u3002 \u4f46\u662f\uff0c \u5728 update \u8bed\u53e5\u7684 where \u6761\u4ef6\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u4e8e\u662f\u5c31\u4f1a\u5bf9\u6240\u6709\u8bb0\u5f55\u52a0\u4e0a next-key \u9501\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \u3002 \u5047\u8bbe\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u6b21\u4e8b\u52a1 B \u7684 update \u8bed\u53e5\u88ab\u963b\u585e\u4e86\u3002 \u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 A\u7684 update \u8bed\u53e5\u4e2d where \u6761\u4ef6\u6ca1\u6709\u7d22\u5f15\u5217\uff0c\u89e6\u53d1\u4e86\u5168\u8868\u626b\u63cf\uff0c\u5728\u626b\u63cf\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9\u7d22\u5f15\u52a0\u9501\uff0c\u6240\u4ee5\u5168\u8868\u626b\u63cf\u7684\u573a\u666f\u4e0b\uff0c\u6240\u6709\u8bb0\u5f55\u90fd\u4f1a\u88ab\u52a0\u9501\uff0c\u4e5f\u5c31\u662f\u8fd9\u6761 update \u8bed\u53e5\u4ea7\u751f\u4e86 4 \u4e2a\u8bb0\u5f55\u9501\u548c 5 \u4e2a\u95f4\u9699\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4f4f\u4e86\u5168\u8868\u3002 \u56e0\u6b64\uff0c\u5f53\u5728\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u6570\u636e\u5e93\u8868\u6267\u884c update \u8bed\u53e5\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5c31\u4f1a\u7ed9\u5168\u8868\u7684\u52a0\u4e0a next-key \u9501\uff0c \u90a3\u4e48\u9501\u5c31\u4f1a\u6301\u7eed\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u76f4\u5230\u4e8b\u52a1\u7ed3\u675f\uff0c\u800c\u8fd9\u671f\u95f4\u9664\u4e86 select ... from \u8bed\u53e5\uff0c\u5176\u4ed6\u8bed\u53e5\u90fd\u4f1a\u88ab\u9501\u4f4f\u4e0d\u80fd\u6267\u884c\uff0c\u4e1a\u52a1\u4f1a\u56e0\u6b64\u505c\u6ede\uff0c\u63a5\u4e0b\u6765\u7b49\u7740\u4f60\u7684\uff0c\u5c31\u662f\u8001\u677f\u7684\u6328\u9a82\u3002 \u90a3 update \u8bed\u53e5\u7684 where \u5e26\u4e0a\u7d22\u5f15\u5c31\u80fd\u907f\u514d\u5168\u8868\u8bb0\u5f55\u52a0\u9501\u4e86\u5417\uff1f \u5e76\u4e0d\u662f\u3002 \u5173\u952e\u8fd8\u5f97\u770b\u8fd9\u6761\u8bed\u53e5\u5728\u6267\u884c\u8fc7\u7a0b\u79cd\uff0c\u4f18\u5316\u5668\u6700\u7ec8\u9009\u62e9\u7684\u662f\u7d22\u5f15\u626b\u63cf\uff0c\u8fd8\u662f\u5168\u8868\u626b\u63cf\uff0c\u5982\u679c\u8d70\u4e86\u5168\u8868\u626b\u63cf\uff0c\u5c31\u4f1a\u5bf9\u5168\u8868\u7684\u8bb0\u5f55\u52a0\u9501\u4e86 \u3002 :::tip \u7f51\u4e0a\u5f88\u591a\u8d44\u6599\u8bf4\uff0cupdate \u6ca1\u52a0\u9501\u7d22\u5f15\u4f1a\u52a0\u8868\u9501\uff0c\u8fd9\u662f\u4e0d\u5bf9\u7684\u3002 Innodb \u6e90\u7801\u91cc\u9762\u5728\u626b\u63cf\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u90fd\u662f\u9488\u5bf9\u7d22\u5f15\u9879\u8fd9\u4e2a\u5355\u4f4d\u53bb\u52a0\u9501\u7684\uff0c update \u4e0d\u5e26\u7d22\u5f15\u5c31\u662f\u5168\u8868\u626b\u626b\u63cf\uff0c\u4e5f\u5c31\u662f\u8868\u91cc\u7684\u7d22\u5f15\u9879\u90fd\u52a0\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4e86\u6574\u5f20\u8868\uff0c\u6240\u4ee5\u5927\u5bb6\u8bef\u4ee5\u4e3a\u52a0\u4e86\u8868\u9501\u3002 ::: \u5982\u4f55\u907f\u514d\u8fd9\u79cd\u4e8b\u6545\u7684\u53d1\u751f\uff1f \u00b6 \u6211\u4eec\u53ef\u4ee5\u5c06 MySQL \u91cc\u7684 sql_safe_updates \u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff0c\u5f00\u542f\u5b89\u5168\u66f4\u65b0\u6a21\u5f0f\u3002 \u5b98\u65b9\u7684\u89e3\u91ca\uff1a If set to 1, MySQL aborts UPDATE or DELETE statements that do not use a key in the WHERE clause or a LIMIT clause. (Specifically, UPDATE statements must have a WHERE clause that uses a key or a LIMIT clause, or both. DELETE statements must have both.) This makes it possible to catch UPDATE or DELETE statements where keys are not used properly and that would probably change or delete a large number of rows. The default value is 0. \u5927\u81f4\u7684\u610f\u601d\u662f\uff0c\u5f53 sql_safe_updates \u8bbe\u7f6e\u4e3a 1 \u65f6\u3002 update \u8bed\u53e5\u5fc5\u987b\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\u4e4b\u4e00\u624d\u80fd\u6267\u884c\u6210\u529f\uff1a - \u4f7f\u7528 where\uff0c\u5e76\u4e14 where \u6761\u4ef6\u4e2d\u5fc5\u987b\u6709\u7d22\u5f15\u5217\uff1b - \u4f7f\u7528 limit\uff1b - \u540c\u65f6\u4f7f\u7528 where \u548c limit\uff0c\u6b64\u65f6 where \u6761\u4ef6\u4e2d\u53ef\u4ee5\u6ca1\u6709\u7d22\u5f15\u5217\uff1b delete \u8bed\u53e5\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u80fd\u6267\u884c\u6210\u529f\uff1a - \u540c\u65f6\u4f7f\u7528 where \u548c limit\uff0c\u6b64\u65f6 where \u6761\u4ef6\u4e2d\u53ef\u4ee5\u6ca1\u6709\u7d22\u5f15\u5217\uff1b \u5982\u679c where \u6761\u4ef6\u5e26\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u4f46\u662f\u4f18\u5316\u5668\u6700\u7ec8\u626b\u63cf\u9009\u62e9\u7684\u662f\u5168\u8868\uff0c\u800c\u4e0d\u662f\u7d22\u5f15\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 force index([index_name]) \u53ef\u4ee5\u544a\u8bc9\u4f18\u5316\u5668\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\uff0c\u4ee5\u6b64\u907f\u514d\u6709\u51e0\u7387\u9501\u5168\u8868\u5e26\u6765\u7684\u9690\u60a3\u3002 \u603b\u7ed3 \u00b6 \u4e0d\u8981\u5c0f\u770b\u4e00\u6761 update \u8bed\u53e5\uff0c\u5728\u751f\u4ea7\u673a\u4e0a\u4f7f\u7528\u4e0d\u5f53\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u505c\u6ede\uff0c\u751a\u81f3\u5d29\u6e83\u3002 \u5f53\u6211\u4eec\u8981\u6267\u884c update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u786e\u4fdd where \u6761\u4ef6\u4e2d\u5e26\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u5e76\u4e14\u5728\u6d4b\u8bd5\u673a\u786e\u8ba4\u8be5\u8bed\u53e5\u662f\u5426\u8d70\u7684\u662f\u7d22\u5f15\u626b\u63cf\uff0c\u9632\u6b62\u56e0\u4e3a\u626b\u63cf\u5168\u8868\uff0c\u800c\u5bf9\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u52a0\u4e0a\u9501\u3002 \u6211\u4eec\u53ef\u4ee5\u6253\u5f00 MySQL sql_safe_updates \u53c2\u6570\uff0c\u8fd9\u6837\u53ef\u4ee5\u9884\u9632 update \u64cd\u4f5c\u65f6 where \u6761\u4ef6\u6ca1\u6709\u5e26\u4e0a\u7d22\u5f15\u5217\u3002 \u5982\u679c\u53d1\u73b0\u5373\u4f7f\u5728 where \u6761\u4ef6\u4e2d\u5e26\u4e0a\u4e86\u5217\u7d22\u5f15\u5217\uff0c\u4f18\u5316\u5668\u8d70\u7684\u8fd8\u662f\u5168\u6807\u626b\u63cf\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u8981\u4f7f\u7528 force index([index_name]) \u53ef\u4ee5\u544a\u8bc9\u4f18\u5316\u5668\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u3002 \u8fd9\u6b21\u5c31\u8bf4\u5230\u8fd9\u5566\uff0c\u4e0b\u6b21\u8981\u5c0f\u5fc3\u70b9\uff0c\u522b\u518d\u88ab\u8001\u677f\u6328\u9a82\u5566\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f"},{"location":"mysql/lock/update_index/#update","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6628\u665a\u5728\u7fa4\u5212\u6c34\u7684\u65f6\u5019\uff0c\u770b\u5230\u6709\u4f4d\u8bfb\u8005\u8bf4\u4e86\u8fd9\u4e48\u4e00\u4ef6\u4e8b\u3002 \u5927\u6982\u5c31\u662f\uff0c\u5728\u7ebf\u4e0a\u6267\u884c\u4e00\u6761 update \u8bed\u53e5\u4fee\u6539\u6570\u636e\u5e93\u6570\u636e\u7684\u65f6\u5019\uff0cwhere \u6761\u4ef6\u6ca1\u6709\u5e26\u4e0a\u7d22\u5f15\uff0c\u5bfc\u81f4\u4e1a\u52a1\u76f4\u63a5\u5d29\u4e86\uff0c\u88ab\u8001\u677f\u6559\u8bad\u4e86\u4e00\u6ce2 \u8fd9\u6b21\u6211\u4eec\u5c31\u6765\u770b\u770b\uff1a - \u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u7684\u4e8b\u6545\uff1f - \u53c8\u8be5\u5982\u4f55\u907f\u514d\u8fd9\u79cd\u4e8b\u6545\u7684\u53d1\u751f\uff1f \u8bf4\u4e2a\u524d\u63d0\uff0c\u63a5\u4e0b\u6765\u8bf4\u7684\u6848\u4f8b\u90fd\u662f\u57fa\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u4e14\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u662f\u53ef\u91cd\u590d\u8bfb\u3002","title":"update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f"},{"location":"mysql/lock/update_index/#_1","text":"InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u9ed8\u8ba4\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5728\u8fd9\u4e2a\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5728\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6240\u8c13\u7684\u5e7b\u8bfb\u662f\u6307\u5728\u540c\u4e00\u4e8b\u52a1\u4e0b\uff0c\u8fde\u7eed\u6267\u884c\u4e24\u6b21\u540c\u6837\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u7b2c\u4e8c\u6b21\u7684\u67e5\u8be2\u8bed\u53e5\u53ef\u80fd\u4f1a\u8fd4\u56de\u4e4b\u524d\u4e0d\u5b58\u5728\u7684\u884c\u3002 \u56e0\u6b64 InnoDB \u5b58\u50a8\u5f15\u64ce\u81ea\u5df1\u5b9e\u73b0\u4e86\u884c\u9501\uff0c\u901a\u8fc7 next-key \u9501\uff08\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7684\u7ec4\u5408\uff09\u6765\u9501\u4f4f\u8bb0\u5f55\u672c\u8eab\u548c\u8bb0\u5f55\u4e4b\u95f4\u7684\u201c\u95f4\u9699\u201d\uff0c\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u8bb0\u5f55\u4e4b\u95f4\u63d2\u5165\u65b0\u7684\u8bb0\u5f55\uff0c\u4ece\u800c\u907f\u514d\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002 \u5f53\u6211\u4eec\u6267\u884c update \u8bed\u53e5\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\uff08X \u9501\uff09\u7684\uff0c\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u5bf9\u6301\u6709\u72ec\u5360\u9501\u7684\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u65f6\u662f\u4f1a\u88ab\u963b\u585e\u7684\u3002\u53e6\u5916\uff0c\u8fd9\u4e2a\u9501\u5e76\u4e0d\u662f\u6267\u884c\u5b8c update \u8bed\u53e5\u5c31\u4f1a\u91ca\u653e\u7684\uff0c\u800c\u662f\u4f1a\u7b49\u4e8b\u52a1\u7ed3\u675f\u65f6\u624d\u4f1a\u91ca\u653e\u3002 \u5728 InnoDB \u4e8b\u52a1\u4e2d\uff0c\u5bf9\u8bb0\u5f55\u52a0\u9501\u5e26\u57fa\u672c\u5355\u4f4d\u662f next-key \u9501\uff0c\u4f46\u662f\u4f1a\u56e0\u4e3a\u4e00\u4e9b\u6761\u4ef6\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u6216\u8005\u8bb0\u5f55\u9501\u3002\u52a0\u9501\u7684\u4f4d\u7f6e\u51c6\u786e\u7684\u8bf4\uff0c\u9501\u662f\u52a0\u5728\u7d22\u5f15\u4e0a\u7684\u800c\u975e\u884c\u4e0a\u3002 \u6bd4\u5982\uff0c\u5728 update \u8bed\u53e5\u7684 where \u6761\u4ef6\u4f7f\u7528\u4e86\u552f\u4e00\u7d22\u5f15\uff0c\u90a3\u4e48 next-key \u9501\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u53ea\u4f1a\u7ed9\u4e00\u884c\u8bb0\u5f55\u52a0\u9501\u3002 \u8fd9\u91cc\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8fd9\u91cc\u6709\u4e00\u5f20\u6570\u636e\u5e93\u8868\uff0c\u5176\u4e2d id \u4e3a\u4e3b\u952e\u7d22\u5f15\u3002 \u5047\u8bbe\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u7684 update \u8bed\u53e5\u4e2d where \u662f\u7b49\u503c\u67e5\u8be2\uff0c\u5e76\u4e14 id \u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u53ea\u4f1a\u5bf9 id = 1 \u8fd9\u6761\u8bb0\u5f55\u52a0\u9501\uff0c\u56e0\u6b64\uff0c\u4e8b\u52a1 B \u7684\u66f4\u65b0\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u963b\u585e\u3002 \u4f46\u662f\uff0c \u5728 update \u8bed\u53e5\u7684 where \u6761\u4ef6\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u4e8e\u662f\u5c31\u4f1a\u5bf9\u6240\u6709\u8bb0\u5f55\u52a0\u4e0a next-key \u9501\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86 \u3002 \u5047\u8bbe\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u6b21\u4e8b\u52a1 B \u7684 update \u8bed\u53e5\u88ab\u963b\u585e\u4e86\u3002 \u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 A\u7684 update \u8bed\u53e5\u4e2d where \u6761\u4ef6\u6ca1\u6709\u7d22\u5f15\u5217\uff0c\u89e6\u53d1\u4e86\u5168\u8868\u626b\u63cf\uff0c\u5728\u626b\u63cf\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9\u7d22\u5f15\u52a0\u9501\uff0c\u6240\u4ee5\u5168\u8868\u626b\u63cf\u7684\u573a\u666f\u4e0b\uff0c\u6240\u6709\u8bb0\u5f55\u90fd\u4f1a\u88ab\u52a0\u9501\uff0c\u4e5f\u5c31\u662f\u8fd9\u6761 update \u8bed\u53e5\u4ea7\u751f\u4e86 4 \u4e2a\u8bb0\u5f55\u9501\u548c 5 \u4e2a\u95f4\u9699\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4f4f\u4e86\u5168\u8868\u3002 \u56e0\u6b64\uff0c\u5f53\u5728\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u6570\u636e\u5e93\u8868\u6267\u884c update \u8bed\u53e5\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5c31\u4f1a\u7ed9\u5168\u8868\u7684\u52a0\u4e0a next-key \u9501\uff0c \u90a3\u4e48\u9501\u5c31\u4f1a\u6301\u7eed\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u76f4\u5230\u4e8b\u52a1\u7ed3\u675f\uff0c\u800c\u8fd9\u671f\u95f4\u9664\u4e86 select ... from \u8bed\u53e5\uff0c\u5176\u4ed6\u8bed\u53e5\u90fd\u4f1a\u88ab\u9501\u4f4f\u4e0d\u80fd\u6267\u884c\uff0c\u4e1a\u52a1\u4f1a\u56e0\u6b64\u505c\u6ede\uff0c\u63a5\u4e0b\u6765\u7b49\u7740\u4f60\u7684\uff0c\u5c31\u662f\u8001\u677f\u7684\u6328\u9a82\u3002 \u90a3 update \u8bed\u53e5\u7684 where \u5e26\u4e0a\u7d22\u5f15\u5c31\u80fd\u907f\u514d\u5168\u8868\u8bb0\u5f55\u52a0\u9501\u4e86\u5417\uff1f \u5e76\u4e0d\u662f\u3002 \u5173\u952e\u8fd8\u5f97\u770b\u8fd9\u6761\u8bed\u53e5\u5728\u6267\u884c\u8fc7\u7a0b\u79cd\uff0c\u4f18\u5316\u5668\u6700\u7ec8\u9009\u62e9\u7684\u662f\u7d22\u5f15\u626b\u63cf\uff0c\u8fd8\u662f\u5168\u8868\u626b\u63cf\uff0c\u5982\u679c\u8d70\u4e86\u5168\u8868\u626b\u63cf\uff0c\u5c31\u4f1a\u5bf9\u5168\u8868\u7684\u8bb0\u5f55\u52a0\u9501\u4e86 \u3002 :::tip \u7f51\u4e0a\u5f88\u591a\u8d44\u6599\u8bf4\uff0cupdate \u6ca1\u52a0\u9501\u7d22\u5f15\u4f1a\u52a0\u8868\u9501\uff0c\u8fd9\u662f\u4e0d\u5bf9\u7684\u3002 Innodb \u6e90\u7801\u91cc\u9762\u5728\u626b\u63cf\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u90fd\u662f\u9488\u5bf9\u7d22\u5f15\u9879\u8fd9\u4e2a\u5355\u4f4d\u53bb\u52a0\u9501\u7684\uff0c update \u4e0d\u5e26\u7d22\u5f15\u5c31\u662f\u5168\u8868\u626b\u626b\u63cf\uff0c\u4e5f\u5c31\u662f\u8868\u91cc\u7684\u7d22\u5f15\u9879\u90fd\u52a0\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4e86\u6574\u5f20\u8868\uff0c\u6240\u4ee5\u5927\u5bb6\u8bef\u4ee5\u4e3a\u52a0\u4e86\u8868\u9501\u3002 :::","title":"\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u7684\u4e8b\u6545\uff1f"},{"location":"mysql/lock/update_index/#_2","text":"\u6211\u4eec\u53ef\u4ee5\u5c06 MySQL \u91cc\u7684 sql_safe_updates \u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff0c\u5f00\u542f\u5b89\u5168\u66f4\u65b0\u6a21\u5f0f\u3002 \u5b98\u65b9\u7684\u89e3\u91ca\uff1a If set to 1, MySQL aborts UPDATE or DELETE statements that do not use a key in the WHERE clause or a LIMIT clause. (Specifically, UPDATE statements must have a WHERE clause that uses a key or a LIMIT clause, or both. DELETE statements must have both.) This makes it possible to catch UPDATE or DELETE statements where keys are not used properly and that would probably change or delete a large number of rows. The default value is 0. \u5927\u81f4\u7684\u610f\u601d\u662f\uff0c\u5f53 sql_safe_updates \u8bbe\u7f6e\u4e3a 1 \u65f6\u3002 update \u8bed\u53e5\u5fc5\u987b\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\u4e4b\u4e00\u624d\u80fd\u6267\u884c\u6210\u529f\uff1a - \u4f7f\u7528 where\uff0c\u5e76\u4e14 where \u6761\u4ef6\u4e2d\u5fc5\u987b\u6709\u7d22\u5f15\u5217\uff1b - \u4f7f\u7528 limit\uff1b - \u540c\u65f6\u4f7f\u7528 where \u548c limit\uff0c\u6b64\u65f6 where \u6761\u4ef6\u4e2d\u53ef\u4ee5\u6ca1\u6709\u7d22\u5f15\u5217\uff1b delete \u8bed\u53e5\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u80fd\u6267\u884c\u6210\u529f\uff1a - \u540c\u65f6\u4f7f\u7528 where \u548c limit\uff0c\u6b64\u65f6 where \u6761\u4ef6\u4e2d\u53ef\u4ee5\u6ca1\u6709\u7d22\u5f15\u5217\uff1b \u5982\u679c where \u6761\u4ef6\u5e26\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u4f46\u662f\u4f18\u5316\u5668\u6700\u7ec8\u626b\u63cf\u9009\u62e9\u7684\u662f\u5168\u8868\uff0c\u800c\u4e0d\u662f\u7d22\u5f15\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 force index([index_name]) \u53ef\u4ee5\u544a\u8bc9\u4f18\u5316\u5668\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\uff0c\u4ee5\u6b64\u907f\u514d\u6709\u51e0\u7387\u9501\u5168\u8868\u5e26\u6765\u7684\u9690\u60a3\u3002","title":"\u5982\u4f55\u907f\u514d\u8fd9\u79cd\u4e8b\u6545\u7684\u53d1\u751f\uff1f"},{"location":"mysql/lock/update_index/#_3","text":"\u4e0d\u8981\u5c0f\u770b\u4e00\u6761 update \u8bed\u53e5\uff0c\u5728\u751f\u4ea7\u673a\u4e0a\u4f7f\u7528\u4e0d\u5f53\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u505c\u6ede\uff0c\u751a\u81f3\u5d29\u6e83\u3002 \u5f53\u6211\u4eec\u8981\u6267\u884c update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u786e\u4fdd where \u6761\u4ef6\u4e2d\u5e26\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u5e76\u4e14\u5728\u6d4b\u8bd5\u673a\u786e\u8ba4\u8be5\u8bed\u53e5\u662f\u5426\u8d70\u7684\u662f\u7d22\u5f15\u626b\u63cf\uff0c\u9632\u6b62\u56e0\u4e3a\u626b\u63cf\u5168\u8868\uff0c\u800c\u5bf9\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u52a0\u4e0a\u9501\u3002 \u6211\u4eec\u53ef\u4ee5\u6253\u5f00 MySQL sql_safe_updates \u53c2\u6570\uff0c\u8fd9\u6837\u53ef\u4ee5\u9884\u9632 update \u64cd\u4f5c\u65f6 where \u6761\u4ef6\u6ca1\u6709\u5e26\u4e0a\u7d22\u5f15\u5217\u3002 \u5982\u679c\u53d1\u73b0\u5373\u4f7f\u5728 where \u6761\u4ef6\u4e2d\u5e26\u4e0a\u4e86\u5217\u7d22\u5f15\u5217\uff0c\u4f18\u5316\u5668\u8d70\u7684\u8fd8\u662f\u5168\u6807\u626b\u63cf\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u8981\u4f7f\u7528 force index([index_name]) \u53ef\u4ee5\u544a\u8bc9\u4f18\u5316\u5668\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u3002 \u8fd9\u6b21\u5c31\u8bf4\u5230\u8fd9\u5566\uff0c\u4e0b\u6b21\u8981\u5c0f\u5fc3\u70b9\uff0c\u522b\u518d\u88ab\u8001\u677f\u6328\u9a82\u5566\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/log/","text":"redo log\u3001binlog\u3001undolog \u6b63\u5728\u8d76\u7a3f\u7684\u8def\u4e0a\u3002\u3002\u3002\u3002\u3002","title":"Index"},{"location":"mysql/log/how_update/","text":"MySQL \u65e5\u5fd7\uff1aundo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4ece\u8fd9\u7bc7\u300c \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \u300d\u4e2d\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u6761\u67e5\u8be2\u8bed\u53e5\u7ecf\u5386\u7684\u8fc7\u7a0b\uff0c\u8fd9\u5c5e\u4e8e\u300c\u8bfb\u300d\u4e00\u6761\u8bb0\u5f55\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a \u90a3\u4e48\uff0c \u6267\u884c\u4e00\u6761 update \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \uff0c\u6bd4\u5982\u8fd9\u4e00\u6761 update \u8bed\u53e5\uff1a UPDATE t_user SET name = 'xiaolin' WHERE id = 1 ; \u67e5\u8be2\u8bed\u53e5\u7684\u90a3\u4e00\u5957\u6d41\u7a0b\uff0c\u66f4\u65b0\u8bed\u53e5\u4e5f\u662f\u540c\u6837\u4f1a\u8d70\u4e00\u904d\uff1a \u5ba2\u6237\u7aef\u5148\u901a\u8fc7\u8fde\u63a5\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u8fde\u63a5\u5668\u81ea\u4f1a\u5224\u65ad\u7528\u6237\u8eab\u4efd\uff1b \u56e0\u4e3a\u8fd9\u662f\u4e00\u6761 update \u8bed\u53e5\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u7ecf\u8fc7\u67e5\u8be2\u7f13\u5b58\uff0c\u4f46\u662f\u8868\u4e0a\u6709\u66f4\u65b0\u8bed\u53e5\uff0c\u662f\u4f1a\u628a\u6574\u4e2a\u8868\u7684\u67e5\u8be2\u7f13\u5b58\u6e05\u7a7a\u7684\uff0c\u6240\u4ee5\u8bf4\u67e5\u8be2\u7f13\u5b58\u5f88\u9e21\u808b\uff0c\u5728 MySQL 8.0 \u5c31\u88ab\u79fb\u9664\u8fd9\u4e2a\u529f\u80fd\u4e86\uff1b \u89e3\u6790\u5668\u4f1a\u901a\u8fc7\u8bcd\u6cd5\u5206\u6790\u8bc6\u522b\u51fa\u5173\u952e\u5b57 update\uff0c\u8868\u540d\u7b49\u7b49\uff0c\u6784\u5efa\u51fa\u8bed\u6cd5\u6811\uff0c\u63a5\u7740\u8fd8\u4f1a\u505a\u8bed\u6cd5\u5206\u6790\uff0c\u5224\u65ad\u8f93\u5165\u7684\u8bed\u53e5\u662f\u5426\u7b26\u5408 MySQL \u8bed\u6cd5\uff1b \u9884\u5904\u7406\u5668\u4f1a\u5224\u65ad\u8868\u548c\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b \u4f18\u5316\u5668\u786e\u5b9a\u6267\u884c\u8ba1\u5212\uff0c\u56e0\u4e3a where \u6761\u4ef6\u4e2d\u7684 id \u662f\u4e3b\u952e\u7d22\u5f15\uff0c\u6240\u4ee5\u51b3\u5b9a\u8981\u4f7f\u7528 id \u8fd9\u4e2a\u7d22\u5f15\uff1b \u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u627e\u5230\u8fd9\u4e00\u884c\uff0c\u7136\u540e\u66f4\u65b0\u3002 \u4e0d\u8fc7\uff0c\u66f4\u65b0\u8bed\u53e5\u7684\u6d41\u7a0b\u4f1a\u6d89\u53ca\u5230 undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\u3001redo log\uff08\u91cd\u505a\u65e5\u5fd7\uff09 \u3001binlog \uff08\u5f52\u6863\u65e5\u5fd7\uff09\u8fd9\u4e09\u79cd\u65e5\u5fd7\uff1a undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09 \uff1a\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u5b9e\u73b0\u4e86\u4e8b\u52a1\u4e2d\u7684**\u539f\u5b50\u6027**\uff0c\u4e3b\u8981**\u7528\u4e8e\u4e8b\u52a1\u56de\u6eda\u548c MVCC**\u3002 redo log\uff08\u91cd\u505a\u65e5\u5fd7\uff09 \uff1a\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u5b9e\u73b0\u4e86\u4e8b\u52a1\u4e2d\u7684**\u6301\u4e45\u6027**\uff0c\u4e3b\u8981**\u7528\u4e8e\u6389\u7535\u7b49\u6545\u969c\u6062\u590d**\uff1b binlog \uff08\u5f52\u6863\u65e5\u5fd7\uff09 \uff1a\u662f Server \u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u4e3b\u8981**\u7528\u4e8e\u6570\u636e\u5907\u4efd\u548c\u4e3b\u4ece\u590d\u5236**\uff1b \u6240\u4ee5\u8fd9\u6b21\u5c31\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u770b\u770b\u8fd9\u4e09\u79cd\u65e5\u5fd7\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981 undo log\uff1f \u00b6 \u6211\u4eec\u5728\u6267\u884c\u6267\u884c\u4e00\u6761\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u867d\u7136\u6ca1\u6709\u8f93\u5165 begin \u5f00\u542f\u4e8b\u52a1\u548c commit \u63d0\u4ea4\u4e8b\u52a1\uff0c\u4f46\u662f MySQL \u4f1a**\u9690\u5f0f\u5f00\u542f\u4e8b\u52a1**\u6765\u6267\u884c\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u7684\uff0c\u6267\u884c\u5b8c\u5c31\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1\u7684\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u6267\u884c\u5b8c\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53ca\u65f6\u5728\u6570\u636e\u5e93\u8868\u770b\u5230\u201c\u589e\u5220\u6539\u201d\u7684\u7ed3\u679c\u4e86\u3002 \u6267\u884c\u4e00\u6761\u8bed\u53e5\u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1\uff0c\u662f\u7531 autocommit \u53c2\u6570\u51b3\u5b9a\u7684\uff0c\u9ed8\u8ba4\u662f\u5f00\u542f\u3002\u6240\u4ee5\uff0c\u6267\u884c\u4e00\u6761 update \u8bed\u53e5\u4e5f\u662f\u4f1a\u4f7f\u7528\u4e8b\u52a1\u7684\u3002 \u90a3\u4e48\uff0c\u8003\u8651\u4e00\u4e2a\u95ee\u9898\u3002\u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5728\u8fd8\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\u4e4b\u524d\uff0c\u5982\u679cMySQL \u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u8981\u600e\u4e48\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\u5462\uff1f \u5982\u679c\u6211\u4eec\u6bcf\u6b21\u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u8bb0\u5f55\u4e0b\u56de\u6eda\u65f6\u9700\u8981\u7684\u4fe1\u606f\u5230\u4e00\u4e2a\u65e5\u5fd7\u91cc\uff0c\u90a3\u4e48\u5728\u4e8b\u52a1\u6267\u884c\u4e2d\u9014\u53d1\u751f\u4e86 MySQL \u5d29\u6e83\u540e\uff0c\u5c31\u4e0d\u7528\u62c5\u5fc3\u65e0\u6cd5\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u65e5\u5fd7\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\u3002 \u5b9e\u73b0\u8fd9\u4e00\u673a\u5236\u5c31\u662f undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\uff0c\u5b83\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u7684 ACID \u7279\u6027 \u4e2d\u7684\u539f\u5b50\u6027\uff08Atomicity\uff09 \u3002 undo log \u662f\u4e00\u79cd\u7528\u4e8e\u64a4\u9500\u56de\u9000\u7684\u65e5\u5fd7\u3002\u5728\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u4e4b\u524d\uff0cMySQL \u4f1a\u5148\u8bb0\u5f55\u66f4\u65b0\u524d\u7684\u6570\u636e\u5230 undo log \u65e5\u5fd7\u6587\u4ef6\u91cc\u9762\uff0c\u5f53\u4e8b\u52a1\u56de\u6eda\u65f6\uff0c\u53ef\u4ee5\u5229\u7528 undo log \u6765\u8fdb\u884c\u56de\u6eda\u3002\u5982\u4e0b\u56fe\uff1a \u6bcf\u5f53 InnoDB \u5f15\u64ce\u5bf9\u4e00\u6761\u8bb0\u5f55\u8fdb\u884c\u64cd\u4f5c\uff08\u4fee\u6539\u3001\u5220\u9664\u3001\u65b0\u589e\uff09\u65f6\uff0c\u8981\u628a\u56de\u6eda\u65f6\u9700\u8981\u7684\u4fe1\u606f\u90fd\u8bb0\u5f55\u5230 undo log \u91cc\uff0c\u6bd4\u5982\uff1a \u5728**\u63d2\u5165**\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u53ea\u9700\u8981\u628a\u8fd9\u4e2a\u4e3b\u952e\u503c\u5bf9\u5e94\u7684\u8bb0\u5f55**\u5220\u6389**\u5c31\u597d\u4e86\uff1b \u5728**\u5220\u9664**\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u8fd9\u6761\u8bb0\u5f55\u4e2d\u7684\u5185\u5bb9\u90fd\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u518d\u628a\u7531\u8fd9\u4e9b\u5185\u5bb9\u7ec4\u6210\u7684\u8bb0\u5f55**\u63d2\u5165**\u5230\u8868\u4e2d\u5c31\u597d\u4e86\uff1b \u5728**\u66f4\u65b0**\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u518d\u628a\u8fd9\u4e9b\u5217**\u66f4\u65b0\u4e3a\u65e7\u503c**\u5c31\u597d\u4e86\u3002 \u5728\u53d1\u751f\u56de\u6eda\u65f6\uff0c\u5c31\u8bfb\u53d6 undo log \u91cc\u7684\u6570\u636e\uff0c\u7136\u540e\u505a\u539f\u5148\u76f8\u53cd\u64cd\u4f5c\u3002\u6bd4\u5982\u5f53 delete \u4e00\u6761\u8bb0\u5f55\u65f6\uff0cundo log \u4e2d\u4f1a\u628a\u8bb0\u5f55\u4e2d\u7684\u5185\u5bb9\u90fd\u8bb0\u4e0b\u6765\uff0c\u7136\u540e\u6267\u884c\u56de\u6eda\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5c31\u8bfb\u53d6 undo log \u91cc\u7684\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c insert \u64cd\u4f5c\u3002 \u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u8bb0\u5f55\u7684\u5185\u5bb9\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u4e0d\u540c\u7c7b\u578b\u7684\u64cd\u4f5c\uff08\u4fee\u6539\u3001\u5220\u9664\u3001\u65b0\u589e\uff09\u4ea7\u751f\u7684 undo log \u7684\u683c\u5f0f\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u5177\u4f53\u7684\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u7684 undo log \u7684\u683c\u5f0f\u6211\u5c31\u4e0d\u8be6\u7ec6\u4ecb\u7ecd\u4e86\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u53bb\u67e5\u67e5\u3002 \u4e00\u6761\u8bb0\u5f55\u7684\u6bcf\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u4ea7\u751f\u7684 undo log \u683c\u5f0f\u90fd\u6709\u4e00\u4e2a roll_pointer \u6307\u9488\u548c\u4e00\u4e2a trx_id \u4e8b\u52a1id\uff1a \u901a\u8fc7 trx_id \u53ef\u4ee5\u77e5\u9053\u8be5\u8bb0\u5f55\u662f\u88ab\u54ea\u4e2a\u4e8b\u52a1\u4fee\u6539\u7684\uff1b \u901a\u8fc7 roll_pointer \u6307\u9488\u53ef\u4ee5\u5c06\u8fd9\u4e9b undo log \u4e32\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u8fd9\u4e2a\u94fe\u8868\u5c31\u88ab\u79f0\u4e3a\u7248\u672c\u94fe\uff1b \u7248\u672c\u94fe\u5982\u4e0b\u56fe\uff1a \u53e6\u5916\uff0c undo log \u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\uff0c\u901a\u8fc7 ReadView + undo log \u5b9e\u73b0 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09 \u3002 \u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u7684\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\u662f\u901a\u8fc7 Read View + undo log \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff1a \u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u4e2a select \u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View\uff0c\u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u6570\u636e\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002 \u8fd9\u4e24\u4e2a\u9694\u79bb\u7ea7\u522b\u5b9e\u73b0\u662f\u901a\u8fc7\u300c\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u5b57\u6bb5\u300d\u548c\u300c\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\uff08trx_id \u548c roll_pointer\uff09\u300d\u7684\u6bd4\u5bf9\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\u53ef\u89c1\u884c\uff0c\u5c31\u4f1a\u987a\u7740 undo log \u7248\u672c\u94fe\u91cc\u627e\u5230\u6ee1\u8db3\u5176\u53ef\u89c1\u6027\u7684\u8bb0\u5f55\uff0c\u4ece\u800c\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\uff0c\u8fd9\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a \u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f \u56e0\u6b64\uff0cundo log \u4e24\u5927\u4f5c\u7528\uff1a \u5b9e\u73b0\u4e8b\u52a1\u56de\u6eda\uff0c\u4fdd\u969c\u4e8b\u52a1\u7684\u539f\u5b50\u6027 \u3002\u4e8b\u52a1\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u9519\u8bef\u6216\u8005\u7528\u6237\u6267 \u884c\u4e86 ROLLBACK \u8bed\u53e5\uff0cMySQL \u53ef\u4ee5\u5229\u7528 undo log \u4e2d\u7684\u5386\u53f2\u6570\u636e\u5c06\u6570\u636e\u6062\u590d\u5230\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u7684\u72b6\u6001\u3002 \u5b9e\u73b0 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5173\u952e\u56e0\u7d20\u4e4b\u4e00 \u3002MVCC \u662f\u901a\u8fc7 ReadView + undo log \u5b9e\u73b0\u7684\u3002undo log \u4e3a\u6bcf\u6761\u8bb0\u5f55\u4fdd\u5b58\u591a\u4efd\u5386\u53f2\u6570\u636e\uff0cMySQL \u5728\u6267\u884c\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u4fe1\u606f\uff0c\u987a\u7740 undo log \u7684\u7248\u672c\u94fe\u627e\u5230\u6ee1\u8db3\u5176\u53ef\u89c1\u6027\u7684\u8bb0\u5f55\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981 Buffer Pool\uff1f \u00b6 MySQL \u7684\u6570\u636e\u90fd\u662f\u5b58\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5f97\u5148\u8981\u4ece\u78c1\u76d8\u8bfb\u53d6\u8be5\u8bb0\u5f55\uff0c\u7136\u540e\u5728\u5185\u5b58\u4e2d\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u3002\u90a3\u4fee\u6539\u5b8c\u8fd9\u6761\u8bb0\u5f55\u662f\u9009\u62e9\u76f4\u63a5\u5199\u56de\u5230\u78c1\u76d8\uff0c\u8fd8\u662f\u9009\u62e9\u7f13\u5b58\u8d77\u6765\u5462\uff1f \u5f53\u7136\u662f\u7f13\u5b58\u8d77\u6765\u597d\uff0c\u8fd9\u6837\u4e0b\u6b21\u6709\u67e5\u8be2\u8bed\u53e5\u547d\u4e2d\u4e86\u8fd9\u6761\u8bb0\u5f55\uff0c\u76f4\u63a5\u8bfb\u53d6\u7f13\u5b58\u4e2d\u7684\u8bb0\u5f55\uff0c\u5c31\u4e0d\u9700\u8981\u4ece\u78c1\u76d8\u83b7\u53d6\u6570\u636e\u4e86\u3002 \u4e3a\u6b64\uff0cInnodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a**\u7f13\u51b2\u6c60\uff08Buffer Pool\uff09**\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002 \u6709\u4e86 Buffer Poo \u540e\uff1a \u5f53\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u76f4\u63a5\u8bfb\u53d6 Buffer Pool \u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u518d\u53bb\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002 \u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u90a3\u76f4\u63a5\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff08\u8be5\u9875\u7684\u5185\u5b58\u6570\u636e\u548c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u4e00\u81f4\uff09\uff0c\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002 Buffer Pool \u7f13\u5b58\u4ec0\u4e48\uff1f \u00b6 InnoDB \u4f1a\u628a\u5b58\u50a8\u7684\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u300c\u9875\u300d\uff0c\u4ee5\u9875\u4f5c\u4e3a\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e00\u4e2a\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16KB\u3002\u56e0\u6b64\uff0cBuffer Pool \u540c\u6837\u9700\u8981\u6309\u300c\u9875\u300d\u6765\u5212\u5206\u3002 \u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0c InnoDB \u4f1a\u4e3a Buffer Pool \u7533\u8bf7\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u6309\u7167\u9ed8\u8ba4\u7684 16KB \u7684\u5927\u5c0f\u5212\u5206\u51fa\u4e00\u4e2a\u4e2a\u7684\u9875\uff0c Buffer Pool \u4e2d\u7684\u9875\u5c31\u53eb\u505a\u7f13\u5b58\u9875 \u3002\u6b64\u65f6\u8fd9\u4e9b\u7f13\u5b58\u9875\u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u4e4b\u540e\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u624d\u4f1a\u6709\u78c1\u76d8\u4e0a\u7684\u9875\u88ab\u7f13\u5b58\u5230 Buffer Pool \u4e2d\u3002 \u6240\u4ee5\uff0cMySQL \u521a\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u89c2\u5bdf\u5230\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\uff0c\u800c\u4f7f\u7528\u5230\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u5374\u5f88\u5c0f\uff0c\u8fd9\u662f\u56e0\u4e3a\u53ea\u6709\u8fd9\u4e9b\u865a\u62df\u5185\u5b58\u88ab\u8bbf\u95ee\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u7533\u8bf7\u7269\u7406\u5185\u5b58\uff0c\u63a5\u7740\u5c06\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u3002 Buffer Pool \u9664\u4e86\u7f13\u5b58\u300c\u7d22\u5f15\u9875\u300d\u548c\u300c\u6570\u636e\u9875\u300d\uff0c\u8fd8\u5305\u62ec\u4e86 Undo \u9875\uff0c\u63d2\u5165\u7f13\u5b58\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u3001\u9501\u4fe1\u606f\u7b49\u7b49\u3002 Undo \u9875\u662f\u8bb0\u5f55\u4ec0\u4e48\uff1f \u5f00\u542f\u4e8b\u52a1\u540e\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5982\u679c\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\u3002 \u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u53ea\u9700\u8981\u7f13\u51b2\u4e00\u6761\u8bb0\u5f55\u5417\uff1f \u4e0d\u662f\u7684\u3002 \u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\u65f6\uff0cInnoDB \u662f\u4f1a\u628a\u6574\u4e2a\u9875\u7684\u6570\u636e\u52a0\u8f7d\u5230 Buffer Pool \u4e2d\uff0c\u5c06\u9875\u52a0\u8f7d\u5230 Buffer Pool \u540e\uff0c\u518d\u901a\u8fc7\u9875\u91cc\u7684\u300c\u9875\u76ee\u5f55\u300d\u53bb\u5b9a\u4f4d\u5230\u67d0\u6761\u5177\u4f53\u7684\u8bb0\u5f55\u3002 \u5173\u4e8e\u9875\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\u548c\u7d22\u5f15\u600e\u4e48\u67e5\u8be2\u6570\u636e\u7684\u95ee\u9898\u53ef\u4ee5\u5728\u8fd9\u7bc7\u627e\u5230\u7b54\u6848\uff1a \u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811 \u4e3a\u4ec0\u4e48\u9700\u8981 redo log \uff1f \u00b6 Buffer Pool \u662f\u63d0\u9ad8\u4e86\u8bfb\u5199\u6548\u7387\u6ca1\u9519\uff0c\u4f46\u662f\u95ee\u9898\u6765\u4e86\uff0cBuffer Pool \u662f\u57fa\u4e8e\u5185\u5b58\u7684\uff0c\u800c\u5185\u5b58\u603b\u662f\u4e0d\u53ef\u9760\uff0c\u4e07\u4e00\u65ad\u7535\u91cd\u542f\uff0c\u8fd8\u6ca1\u6765\u5f97\u53ca\u843d\u76d8\u7684\u810f\u9875\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u4e3a\u4e86\u9632\u6b62\u65ad\u7535\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\uff0c\u5f53\u6709\u4e00\u6761\u8bb0\u5f55\u9700\u8981\u66f4\u65b0\u7684\u65f6\u5019\uff0cInnoDB \u5f15\u64ce\u5c31\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u672c\u6b21\u5bf9\u8fd9\u4e2a\u9875\u7684\u4fee\u6539\u4ee5 redo log \u7684\u5f62\u5f0f\u8bb0\u5f55\u4e0b\u6765\uff0c \u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86 \u3002 \u540e\u7eed\uff0cInnoDB \u5f15\u64ce\u4f1a\u5728\u9002\u5f53\u7684\u65f6\u5019\uff0c\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u7f13\u5b58\u5728 Buffer Pool \u7684\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u91cc\uff0c\u8fd9\u5c31\u662f WAL \uff08Write-Ahead Logging\uff09\u6280\u672f \u3002 WAL \u6280\u672f\u6307\u7684\u662f\uff0c MySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199\u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5199\u5230\u78c1\u76d8\u4e0a \u3002 \u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a \u4ec0\u4e48\u662f redo log\uff1f redo log \u662f\u7269\u7406\u65e5\u5fd7\uff0c\u8bb0\u5f55\u4e86\u67d0\u4e2a\u6570\u636e\u9875\u505a\u4e86\u4ec0\u4e48\u4fee\u6539\uff0c\u6bd4\u5982**\u5bf9 XXX \u8868\u7a7a\u95f4\u4e2d\u7684 YYY \u6570\u636e\u9875 ZZZ \u504f\u79fb\u91cf\u7684\u5730\u65b9\u505a\u4e86AAA \u66f4\u65b0**\uff0c\u6bcf\u5f53\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u5c31\u4f1a\u4ea7\u751f\u8fd9\u6837\u7684\u4e00\u6761\u6216\u8005\u591a\u6761\u7269\u7406\u65e5\u5fd7\u3002 \u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u53ea\u8981\u5148\u5c06 redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\u5373\u53ef\uff0c\u53ef\u4ee5\u4e0d\u9700\u8981\u7b49\u5230\u5c06\u7f13\u5b58\u5728 Buffer Pool \u91cc\u7684\u810f\u9875\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u5f53\u7cfb\u7edf\u5d29\u6e83\u65f6\uff0c\u867d\u7136\u810f\u9875\u6570\u636e\u6ca1\u6709\u6301\u4e45\u5316\uff0c\u4f46\u662f redo log \u5df2\u7ecf\u6301\u4e45\u5316\uff0c\u63a5\u7740 MySQL \u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u6839\u636e redo log \u7684\u5185\u5bb9\uff0c\u5c06\u6240\u6709\u6570\u636e\u6062\u590d\u5230\u6700\u65b0\u7684\u72b6\u6001\u3002 \u88ab\u4fee\u6539 Undo \u9875\u9762\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94 redo log \u5417\uff1f \u9700\u8981\u7684\u3002 \u5f00\u542f\u4e8b\u52a1\u540e\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5982\u679c\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\u3002 \u4e0d\u8fc7\uff0c \u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log \u3002 redo log \u548c undo log \u533a\u522b\u5728\u54ea\uff1f \u8fd9\u4e24\u79cd\u65e5\u5fd7\u662f\u5c5e\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u65e5\u5fd7\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\uff1a redo log \u8bb0\u5f55\u4e86\u6b64\u6b21\u4e8b\u52a1\u300c \u5b8c\u6210\u540e \u300d\u7684\u6570\u636e\u72b6\u6001\uff0c\u8bb0\u5f55\u7684\u662f\u66f4\u65b0**\u4e4b\u540e**\u7684\u503c\uff1b undo log \u8bb0\u5f55\u4e86\u6b64\u6b21\u4e8b\u52a1\u300c \u5f00\u59cb\u524d \u300d\u7684\u6570\u636e\u72b6\u6001\uff0c\u8bb0\u5f55\u7684\u662f\u66f4\u65b0**\u4e4b\u524d**\u7684\u503c\uff1b \u4e8b\u52a1\u63d0\u4ea4\u4e4b\u524d\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4f1a\u901a\u8fc7 undo log \u56de\u6eda\u4e8b\u52a1\uff0c\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4f1a\u901a\u8fc7 redo log \u6062\u590d\u4e8b\u52a1\uff0c\u5982\u4e0b\u56fe\uff1a \u6240\u4ee5\u6709\u4e86 redo log\uff0c\u518d\u901a\u8fc7 WAL \u6280\u672f\uff0cInnoDB \u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5373\u4f7f\u6570\u636e\u5e93\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u4e4b\u524d\u5df2\u63d0\u4ea4\u7684\u8bb0\u5f55\u90fd\u4e0d\u4f1a\u4e22\u5931\uff0c\u8fd9\u4e2a\u80fd\u529b\u79f0\u4e3a crash-safe \uff08\u5d29\u6e83\u6062\u590d\uff09\u3002\u53ef\u4ee5\u770b\u51fa\u6765\uff0c redo log \u4fdd\u8bc1\u4e86\u4e8b\u52a1\u56db\u5927\u7279\u6027\u4e2d\u7684\u6301\u4e45\u6027 \u3002 redo log \u8981\u5199\u5230\u78c1\u76d8\uff0c\u6570\u636e\u4e5f\u8981\u5199\u78c1\u76d8\uff0c\u4e3a\u4ec0\u4e48\u8981\u591a\u6b64\u4e00\u4e3e\uff1f \u5199\u5165 redo log \u7684\u65b9\u5f0f\u4f7f\u7528\u4e86\u8ffd\u52a0\u64cd\u4f5c\uff0c \u6240\u4ee5\u78c1\u76d8\u64cd\u4f5c\u662f**\u987a\u5e8f\u5199**\uff0c\u800c\u5199\u5165\u6570\u636e\u9700\u8981\u5148\u627e\u5230\u5199\u5165\u4f4d\u7f6e\uff0c\u7136\u540e\u624d\u5199\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u78c1\u76d8\u64cd\u4f5c\u662f**\u968f\u673a\u5199**\u3002 \u78c1\u76d8\u7684\u300c\u987a\u5e8f\u5199 \u300d\u6bd4\u300c\u968f\u673a\u5199\u300d \u9ad8\u6548\u7684\u591a\uff0c\u56e0\u6b64 redo log \u5199\u5165\u78c1\u76d8\u7684\u5f00\u9500\u66f4\u5c0f\u3002 \u9488\u5bf9\u300c\u987a\u5e8f\u5199\u300d\u4e3a\u4ec0\u4e48\u6bd4\u300c\u968f\u673a\u5199\u300d\u66f4\u5feb\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u6bd4\u55bb\u4e3a\u4f60\u6709\u4e00\u4e2a\u672c\u5b50\uff0c\u6309\u7167\u987a\u5e8f\u4e00\u9875\u4e00\u9875\u5199\u80af\u5b9a\u6bd4\u5199\u4e00\u4e2a\u5b57\u90fd\u8981\u627e\u5230\u5bf9\u5e94\u9875\u5199\u5feb\u5f97\u591a\u3002 \u53ef\u4ee5\u8bf4\u8fd9\u662f WAL \u6280\u672f\u7684\u53e6\u5916\u4e00\u4e2a\u4f18\u70b9\uff1a MySQL \u7684\u5199\u64cd\u4f5c\u4ece\u78c1\u76d8\u7684\u300c\u968f\u673a\u5199\u300d\u53d8\u6210\u4e86\u300c\u987a\u5e8f\u5199\u300d \uff0c\u63d0\u5347\u8bed\u53e5\u7684\u6267\u884c\u6027\u80fd\u3002\u8fd9\u662f\u56e0\u4e3a MySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u66f4\u65b0\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e0a\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u66f4\u65b0\u5230\u78c1\u76d8\u4e0a \u3002 \u81f3\u6b64\uff0c \u9488\u5bf9\u4e3a\u4ec0\u4e48\u9700\u8981 redo log \u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u6709\u4e24\u4e2a\u7b54\u6848\uff1a \u5b9e\u73b0\u4e8b\u52a1\u7684\u6301\u4e45\u6027\uff0c\u8ba9 MySQL \u6709 crash-safe \u7684\u80fd\u529b \uff0c\u80fd\u591f\u4fdd\u8bc1 MySQL \u5728\u4efb\u4f55\u65f6\u95f4\u6bb5\u7a81\u7136\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4e4b\u524d\u5df2\u63d0\u4ea4\u7684\u8bb0\u5f55\u90fd\u4e0d\u4f1a\u4e22\u5931\uff1b \u5c06\u5199\u64cd\u4f5c\u4ece\u300c\u968f\u673a\u5199\u300d\u53d8\u6210\u4e86\u300c\u987a\u5e8f\u5199\u300d \uff0c\u63d0\u5347 MySQL \u5199\u5165\u78c1\u76d8\u7684\u6027\u80fd\u3002 \u4ea7\u751f\u7684 redo log \u662f\u76f4\u63a5\u5199\u5165\u78c1\u76d8\u7684\u5417\uff1f \u4e0d\u662f\u7684\u3002 \u5b9e\u9645\u4e0a\uff0c \u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4ea7\u751f\u7684 redo log \u4e5f\u4e0d\u662f\u76f4\u63a5\u5199\u5165\u78c1\u76d8\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u4ea7\u751f\u5927\u91cf\u7684 I/O \u64cd\u4f5c\uff0c\u800c\u4e14\u78c1\u76d8\u7684\u8fd0\u884c\u901f\u5ea6\u8fdc\u6162\u4e8e\u5185\u5b58\u3002 \u6240\u4ee5\uff0credo log \u4e5f\u6709\u81ea\u5df1\u7684\u7f13\u5b58\u2014\u2014 redo log buffer \uff0c\u6bcf\u5f53\u4ea7\u751f\u4e00\u6761 redo log \u65f6\uff0c\u4f1a\u5148\u5199\u5165\u5230 redo log buffer\uff0c\u540e\u7eed\u5728\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5982\u4e0b\u56fe\uff1a redo log buffer \u9ed8\u8ba4\u5927\u5c0f 16 MB\uff0c\u53ef\u4ee5\u901a\u8fc7 innodb_log_Buffer_size \u53c2\u6570\u52a8\u6001\u7684\u8c03\u6574\u5927\u5c0f\uff0c\u589e\u5927\u5b83\u7684\u5927\u5c0f\u53ef\u4ee5\u8ba9 MySQL \u5904\u7406\u300c\u5927\u4e8b\u52a1\u300d\u662f\u4e0d\u5fc5\u5199\u5165\u78c1\u76d8\uff0c\u8fdb\u800c\u63d0\u5347\u5199 IO \u6027\u80fd\u3002 redo log \u4ec0\u4e48\u65f6\u5019\u5237\u76d8\uff1f \u00b6 \u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u8fd8\u662f\u5728\u5185\u5b58\u4e2d\uff0c\u5b83\u4ec0\u4e48\u65f6\u5019\u5237\u65b0\u5230\u78c1\u76d8\uff1f \u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u4e2a\u65f6\u673a\uff1a MySQL \u6b63\u5e38\u5173\u95ed\u65f6\uff1b \u5f53 redo log buffer \u4e2d\u8bb0\u5f55\u7684\u5199\u5165\u91cf\u5927\u4e8e redo log buffer \u5185\u5b58\u7a7a\u95f4\u7684\u4e00\u534a\u65f6\uff0c\u4f1a\u89e6\u53d1\u843d\u76d8\uff1b InnoDB \u7684\u540e\u53f0\u7ebf\u7a0b\u6bcf\u9694 1 \u79d2\uff0c\u5c06 redo log buffer \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\u90fd\u5c06\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff08\u8fd9\u4e2a\u7b56\u7565\u53ef\u7531 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\uff0c\u4e0b\u9762\u4f1a\u8bf4\uff09\u3002 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\u7684\u662f\u4ec0\u4e48\uff1f \u5355\u72ec\u6267\u884c\u4e00\u4e2a\u66f4\u65b0\u8bed\u53e5\u7684\u65f6\u5019\uff0cInnoDB \u5f15\u64ce\u4f1a\u81ea\u5df1\u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5728\u6267\u884c\u66f4\u65b0\u8bed\u53e5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u751f\u6210\u7684 redo log \u5148\u5199\u5165\u5230 redo log buffer \u4e2d\uff0c\u7136\u540e\u7b49\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u518d\u5c06\u7f13\u5b58\u5728 redo log buffer \u4e2d\u7684 redo log \u6309\u7ec4\u7684\u65b9\u5f0f\u300c\u987a\u5e8f\u5199\u300d\u5230\u78c1\u76d8\u3002 \u4e0a\u9762\u8fd9\u79cd redo log \u5237\u76d8\u65f6\u673a\u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u9ed8\u8ba4\u7684\u884c\u4e3a\u3002 \u9664\u6b64\u4e4b\u5916\uff0cInnoDB \u8fd8\u63d0\u4f9b\u4e86\u53e6\u5916\u4e24\u79cd\u7b56\u7565\uff0c\u7531\u53c2\u6570 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\uff0c\u53ef\u53d6\u7684\u503c\u6709\uff1a0\u30011\u30012\uff0c\u9ed8\u8ba4\u503c\u4e3a 1\uff0c\u8fd9\u4e09\u4e2a\u503c\u5206\u522b\u4ee3\u8868\u7684\u7b56\u7565\u5982\u4e0b\uff1a \u5f53\u8bbe\u7f6e\u8be5**\u53c2\u6570\u4e3a 0 \u65f6**\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6 \uff0c\u8fd8\u662f**\u5c06 redo log \u7559\u5728 redo log buffer \u4e2d** \uff0c\u8be5\u6a21\u5f0f\u4e0b\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u4e0d\u4f1a\u4e3b\u52a8\u89e6\u53d1\u5199\u5165\u78c1\u76d8\u7684\u64cd\u4f5c\u3002 \u5f53\u8bbe\u7f6e\u8be5**\u53c2\u6570\u4e3a 1 \u65f6**\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd**\u5c06\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8**\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1 MySQL \u5f02\u5e38\u91cd\u542f\u4e4b\u540e\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002 \u5f53\u8bbe\u7f6e\u8be5**\u53c2\u6570\u4e3a 2 \u65f6**\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u53ea\u662f\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u5199\u5230 redo log \u6587\u4ef6\uff0c\u6ce8\u610f\u5199\u5165\u5230\u300c redo log \u6587\u4ef6\u300d\u5e76\u4e0d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u78c1\u76d8 \uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u4e2a Page Cache\uff08\u5982\u679c\u4f60\u60f3\u4e86\u89e3 Page Cache\uff0c\u53ef\u4ee5\u770b \u8fd9\u7bc7 \uff09\uff0cPage Cache \u662f\u4e13\u95e8\u7528\u6765\u7f13\u5b58\u6587\u4ef6\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5199\u5165\u300c redo log\u6587\u4ef6\u300d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7f13\u5b58\u3002 \u6211\u753b\u4e86\u4e00\u4e2a\u56fe\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff1a innodb_flush_log_at_trx_commit \u4e3a 0 \u548c 2 \u7684\u65f6\u5019\uff0c\u4ec0\u4e48\u65f6\u5019\u624d\u5c06 redo log \u5199\u5165\u78c1\u76d8\uff1f InnoDB \u7684\u540e\u53f0\u7ebf\u7a0b\u6bcf\u9694 1 \u79d2\uff1a \u9488\u5bf9\u53c2\u6570 0 \uff1a\u4f1a\u628a\u7f13\u5b58\u5728 redo log buffer \u4e2d\u7684 redo log \uff0c\u901a\u8fc7\u8c03\u7528 write() \u5199\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684 Page Cache\uff0c\u7136\u540e\u8c03\u7528 fsync() \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u6240\u4ee5\u53c2\u6570\u4e3a 0 \u7684\u7b56\u7565\uff0cMySQL \u8fdb\u7a0b\u7684\u5d29\u6e83\u4f1a\u5bfc\u81f4\u4e0a\u4e00\u79d2\u949f\u6240\u6709\u4e8b\u52a1\u6570\u636e\u7684\u4e22\u5931 ; \u9488\u5bf9\u53c2\u6570 2 \uff1a\u8c03\u7528 fsync\uff0c\u5c06\u7f13\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d Page Cache \u91cc\u7684 redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u6240\u4ee5\u53c2\u6570\u4e3a 2 \u7684\u7b56\u7565\uff0c\u8f83\u53d6\u503c\u4e3a 0 \u60c5\u51b5\u4e0b\u66f4\u5b89\u5168\uff0c\u56e0\u4e3a MySQL \u8fdb\u7a0b\u7684\u5d29\u6e83\u5e76\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u53ea\u6709\u5728\u64cd\u4f5c\u7cfb\u7edf\u5d29\u6e83\u6216\u8005\u7cfb\u7edf\u65ad\u7535\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0a\u4e00\u79d2\u949f\u6240\u6709\u4e8b\u52a1\u6570\u636e\u624d\u53ef\u80fd\u4e22\u5931 \u3002 \u52a0\u5165\u4e86\u540e\u53f0\u73b0\u7ebf\u7a0b\u540e\uff0cinnodb_flush_log_at_trx_commit \u7684\u5237\u76d8\u65f6\u673a\u5982\u4e0b\u56fe\uff1a \u8fd9\u4e09\u4e2a\u53c2\u6570\u7684\u5e94\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f \u8fd9\u4e09\u4e2a\u53c2\u6570\u7684\u6570\u636e\u5b89\u5168\u6027\u548c\u5199\u5165\u6027\u80fd\u7684\u6bd4\u8f83\u5982\u4e0b\uff1a \u6570\u636e\u5b89\u5168\u6027\uff1a\u53c2\u6570 1 > \u53c2\u6570 2 > \u53c2\u6570 0 \u5199\u5165\u6027\u80fd\uff1a\u53c2\u6570 0 > \u53c2\u6570 2> \u53c2\u6570 1 \u6240\u4ee5\uff0c\u6570\u636e\u5b89\u5168\u6027\u548c\u5199\u5165\u6027\u80fd\u662f\u718a\u638c\u4e0d\u53ef\u5f97\u517c\u7684\uff0c \u8981\u4e0d\u8ffd\u6c42\u6570\u636e\u5b89\u5168\u6027\uff0c\u727a\u7272\u6027\u80fd\uff1b\u8981\u4e0d\u8ffd\u6c42\u6027\u80fd\uff0c\u727a\u7272\u6570\u636e\u5b89\u5168\u6027 \u3002 \u5728\u4e00\u4e9b\u5bf9\u6570\u636e\u5b89\u5168\u6027\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\u4e2d\uff0c\u663e\u7136 innodb_flush_log_at_trx_commit \u53c2\u6570\u9700\u8981\u8bbe\u7f6e\u4e3a 1\u3002 \u5728\u4e00\u4e9b\u53ef\u4ee5\u5bb9\u5fcd\u6570\u636e\u5e93\u5d29\u6e83\u65f6\u4e22\u5931 1s \u6570\u636e\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a 0\uff0c\u8fd9\u6837\u53ef\u4ee5\u660e\u663e\u5730\u51cf\u5c11\u65e5\u5fd7\u540c\u6b65\u5230\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u3002 \u5b89\u5168\u6027\u548c\u6027\u80fd\u6298\u4e2d\u7684\u65b9\u6848\u5c31\u662f\u53c2\u6570 2\uff0c\u867d\u7136\u53c2\u6570 2 \u6ca1\u6709\u53c2\u6570 0 \u7684\u6027\u80fd\u9ad8\uff0c\u4f46\u662f\u6570\u636e\u5b89\u5168\u6027\u65b9\u9762\u6bd4\u53c2\u6570 0 \u5f3a\uff0c\u56e0\u4e3a\u53c2\u6570 2 \u53ea\u8981\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u5b95\u673a\uff0c\u5373\u4f7f\u6570\u636e\u5e93\u5d29\u6e83\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u540c\u65f6\u6027\u80fd\u65b9\u4fbf\u6bd4\u53c2\u6570 1 \u9ad8\u3002 redo log \u6587\u4ef6\u5199\u6ee1\u4e86\u600e\u4e48\u529e\uff1f \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c InnoDB \u5b58\u50a8\u5f15\u64ce\u6709 1 \u4e2a\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4( redo log Group\uff09\uff0c\u300c\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4\u300d\u7531\u6709 2 \u4e2a redo log \u6587\u4ef6\u7ec4\u6210\uff0c\u8fd9\u4e24\u4e2a redo \u65e5\u5fd7\u7684\u6587\u4ef6\u540d\u53eb \uff1a ib_logfile0 \u548c ib_logfile1 \u3002 \u5728\u91cd\u505a\u65e5\u5fd7\u7ec4\u4e2d\uff0c\u6bcf\u4e2a redo log File \u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u4e14\u4e00\u81f4\u7684\uff0c\u5047\u8bbe\u6bcf\u4e2a redo log File \u8bbe\u7f6e\u7684\u4e0a\u9650\u662f 1 GB\uff0c\u90a3\u4e48\u603b\u5171\u5c31\u53ef\u4ee5\u8bb0\u5f55 2GB \u7684\u64cd\u4f5c\u3002 \u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4\u662f\u4ee5**\u5faa\u73af\u5199**\u7684\u65b9\u5f0f\u5de5\u4f5c\u7684\uff0c\u4ece\u5934\u5f00\u59cb\u5199\uff0c\u5199\u5230\u672b\u5c3e\u5c31\u53c8\u56de\u5230\u5f00\u5934\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u73af\u5f62\u3002 \u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u5148\u5199 ib_logfile0 \u6587\u4ef6\uff0c\u5f53 ib_logfile0 \u6587\u4ef6\u88ab\u5199\u6ee1\u7684\u65f6\u5019\uff0c\u4f1a\u5207\u6362\u81f3 ib_logfile1 \u6587\u4ef6\uff0c\u5f53 ib_logfile1 \u6587\u4ef6\u4e5f\u88ab\u5199\u6ee1\u65f6\uff0c\u4f1a\u5207\u6362\u56de ib_logfile0 \u6587\u4ef6\u3002 \u6211\u4eec\u77e5\u9053 redo log \u662f\u4e3a\u4e86\u9632\u6b62 Buffer Pool \u4e2d\u7684\u810f\u9875\u4e22\u5931\u800c\u8bbe\u8ba1\u7684\uff0c\u90a3\u4e48\u5982\u679c\u968f\u7740\u7cfb\u7edf\u8fd0\u884c\uff0cBuffer Pool \u7684\u810f\u9875\u5237\u65b0\u5230\u4e86\u78c1\u76d8\u4e2d\uff0c\u90a3\u4e48 redo log \u5bf9\u5e94\u7684\u8bb0\u5f55\u4e5f\u5c31\u6ca1\u7528\u4e86\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u64e6\u9664\u8fd9\u4e9b\u65e7\u8bb0\u5f55\uff0c\u4ee5\u817e\u51fa\u7a7a\u95f4\u8bb0\u5f55\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\u3002 redo log \u662f\u5faa\u73af\u5199\u7684\u65b9\u5f0f\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u73af\u5f62\uff0cInnoDB \u7528 write pos \u8868\u793a redo log \u5f53\u524d\u8bb0\u5f55\u5199\u5230\u7684\u4f4d\u7f6e\uff0c\u7528 checkpoint \u8868\u793a\u5f53\u524d\u8981\u64e6\u9664\u7684\u4f4d\u7f6e\uff0c\u5982\u4e0b\u56fe\uff1a \u56fe\u4e2d\u7684\uff1a write pos \u548c checkpoint \u7684\u79fb\u52a8\u90fd\u662f\u987a\u65f6\u9488\u65b9\u5411\uff1b write pos \uff5e checkpoint \u4e4b\u95f4\u7684\u90e8\u5206\uff08\u56fe\u4e2d\u7684\u7ea2\u8272\u90e8\u5206\uff09\uff0c\u7528\u6765\u8bb0\u5f55\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\uff1b check point \uff5e write pos \u4e4b\u95f4\u7684\u90e8\u5206\uff08\u56fe\u4e2d\u84dd\u8272\u90e8\u5206\uff09\uff1a\u5f85\u843d\u76d8\u7684\u810f\u6570\u636e\u9875\u8bb0\u5f55\uff1b \u5982\u679c write pos \u8ffd\u4e0a\u4e86 checkpoint\uff0c\u5c31\u610f\u5473\u7740 redo log \u6587\u4ef6\u6ee1\u4e86\uff0c\u8fd9\u65f6 MySQL \u4e0d\u80fd\u518d\u6267\u884c\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4 MySQL \u4f1a\u88ab\u963b\u585e \uff08 \u56e0\u6b64\u6240\u4ee5\u9488\u5bf9\u5e76\u53d1\u91cf\u5927\u7684\u7cfb\u7edf\uff0c\u9002\u5f53\u8bbe\u7f6e redo log \u7684\u6587\u4ef6\u5927\u5c0f\u975e\u5e38\u91cd\u8981 \uff09\uff0c\u6b64\u65f6**\u4f1a\u505c\u4e0b\u6765\u5c06 Buffer Pool \u4e2d\u7684\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\uff0c\u7136\u540e\u6807\u8bb0 redo log \u54ea\u4e9b\u8bb0\u5f55\u53ef\u4ee5\u88ab\u64e6\u9664\uff0c\u63a5\u7740\u5bf9\u65e7\u7684 redo log \u8bb0\u5f55\u8fdb\u884c\u64e6\u9664\uff0c\u7b49\u64e6\u9664\u5b8c\u65e7\u8bb0\u5f55\u817e\u51fa\u4e86\u7a7a\u95f4\uff0ccheckpoint \u5c31\u4f1a\u5f80\u540e\u79fb\u52a8\uff08\u56fe\u4e2d\u987a\u65f6\u9488\uff09**\uff0c\u7136\u540e MySQL \u6062\u590d\u6b63\u5e38\u8fd0\u884c\uff0c\u7ee7\u7eed\u6267\u884c\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c\u4e00\u6b21 checkpoint \u7684\u8fc7\u7a0b\u5c31\u662f\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u53d8\u6210\u5e72\u51c0\u9875\uff0c\u7136\u540e\u6807\u8bb0 redo log \u54ea\u4e9b\u8bb0\u5f55\u53ef\u4ee5\u88ab\u8986\u76d6\u7684\u8fc7\u7a0b\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981 binlog \uff1f \u00b6 \u524d\u9762\u4ecb\u7ecd\u7684 undo log \u548c redo log \u8fd9\u4e24\u4e2a\u65e5\u5fd7\u90fd\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u751f\u6210\u7684\u3002 MySQL \u5728\u5b8c\u6210\u4e00\u6761\u66f4\u65b0\u64cd\u4f5c\u540e\uff0cServer \u5c42\u8fd8\u4f1a\u751f\u6210\u4e00\u6761 binlog\uff0c\u7b49\u4e4b\u540e\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u8be5\u4e8b\u7269\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u6240\u6709 binlog \u7edf\u4e00\u5199 \u5165 binlog \u6587\u4ef6\u3002 binlog \u6587\u4ef6\u662f\u8bb0\u5f55\u4e86\u6240\u6709\u6570\u636e\u5e93\u8868\u7ed3\u6784\u53d8\u66f4\u548c\u8868\u6570\u636e\u4fee\u6539\u7684\u65e5\u5fd7\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u67e5\u8be2\u7c7b\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982 SELECT \u548c SHOW \u64cd\u4f5c\u3002 \u4e3a\u4ec0\u4e48\u6709\u4e86 binlog\uff0c \u8fd8\u8981\u6709 redo log\uff1f \u8fd9\u4e2a\u95ee\u9898\u8ddf MySQL \u7684\u65f6\u95f4\u7ebf\u6709\u5173\u7cfb\u3002 \u6700\u5f00\u59cb MySQL \u91cc\u5e76\u6ca1\u6709 InnoDB \u5f15\u64ce\uff0cMySQL \u81ea\u5e26\u7684\u5f15\u64ce\u662f MyISAM\uff0c\u4f46\u662f MyISAM \u6ca1\u6709 crash-safe \u7684\u80fd\u529b\uff0cbinlog \u65e5\u5fd7\u53ea\u80fd\u7528\u4e8e\u5f52\u6863\u3002 \u800c InnoDB \u662f\u53e6\u4e00\u4e2a\u516c\u53f8\u4ee5\u63d2\u4ef6\u5f62\u5f0f\u5f15\u5165 MySQL \u7684\uff0c\u65e2\u7136\u53ea\u4f9d\u9760 binlog \u662f\u6ca1\u6709 crash-safe \u80fd\u529b\u7684\uff0c\u6240\u4ee5 InnoDB \u4f7f\u7528 redo log \u6765\u5b9e\u73b0 crash-safe \u80fd\u529b\u3002 redo log \u548c binlog \u6709\u4ec0\u4e48\u533a\u522b\uff1f \u00b6 \u8fd9\u4e24\u4e2a\u65e5\u5fd7\u6709\u56db\u4e2a\u533a\u522b\u3002 1\u3001\u9002\u7528\u5bf9\u8c61\u4e0d\u540c\uff1a binlog \u662f MySQL \u7684 Server \u5c42\u5b9e\u73b0\u7684\u65e5\u5fd7\uff0c\u6240\u6709\u5b58\u50a8\u5f15\u64ce\u90fd\u53ef\u4ee5\u4f7f\u7528\uff1b redo log \u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\u65e5\u5fd7\uff1b 2\u3001\u6587\u4ef6\u683c\u5f0f\u4e0d\u540c\uff1a binlog \u6709 3 \u79cd\u683c\u5f0f\u7c7b\u578b\uff0c\u5206\u522b\u662f STATEMENT\uff08\u9ed8\u8ba4\u683c\u5f0f\uff09\u3001ROW\u3001 MIXED\uff0c\u533a\u522b\u5982\u4e0b\uff1a STATEMENT\uff1a\u6bcf\u4e00\u6761\u4fee\u6539\u6570\u636e\u7684 SQL \u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230 binlog \u4e2d\uff08\u76f8\u5f53\u4e8e\u8bb0\u5f55\u4e86\u903b\u8f91\u64cd\u4f5c\uff0c\u6240\u4ee5\u9488\u5bf9\u8fd9\u79cd\u683c\u5f0f\uff0c binlog \u53ef\u4ee5\u79f0\u4e3a\u903b\u8f91\u65e5\u5fd7\uff09\uff0c\u4e3b\u4ece\u590d\u5236\u4e2d slave \u7aef\u518d\u6839\u636e SQL \u8bed\u53e5\u91cd\u73b0\u3002\u4f46 STATEMENT \u6709\u52a8\u6001\u51fd\u6570\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u4f60\u7528\u4e86 uuid \u6216\u8005 now \u8fd9\u4e9b\u51fd\u6570\uff0c\u4f60\u5728\u4e3b\u5e93\u4e0a\u6267\u884c\u7684\u7ed3\u679c\u5e76\u4e0d\u662f\u4f60\u5728\u4ece\u5e93\u6267\u884c\u7684\u7ed3\u679c\uff0c\u8fd9\u79cd\u968f\u65f6\u5728\u53d8\u7684\u51fd\u6570\u4f1a\u5bfc\u81f4\u590d\u5236\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff1b ROW\uff1a\u8bb0\u5f55\u884c\u6570\u636e\u6700\u7ec8\u88ab\u4fee\u6539\u6210\u4ec0\u4e48\u6837\u4e86\uff08\u8fd9\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7\uff0c\u5c31\u4e0d\u80fd\u79f0\u4e3a\u903b\u8f91\u65e5\u5fd7\u4e86\uff09\uff0c\u4e0d\u4f1a\u51fa\u73b0 STATEMENT \u4e0b\u52a8\u6001\u51fd\u6570\u7684\u95ee\u9898\u3002\u4f46 ROW \u7684\u7f3a\u70b9\u662f\u6bcf\u884c\u6570\u636e\u7684\u53d8\u5316\u7ed3\u679c\u90fd\u4f1a\u88ab\u8bb0\u5f55\uff0c\u6bd4\u5982\u6267\u884c\u6279\u91cf update \u8bed\u53e5\uff0c\u66f4\u65b0\u591a\u5c11\u884c\u6570\u636e\u5c31\u4f1a\u4ea7\u751f\u591a\u5c11\u6761\u8bb0\u5f55\uff0c\u4f7f binlog \u6587\u4ef6\u8fc7\u5927\uff0c\u800c\u5728 STATEMENT \u683c\u5f0f\u4e0b\u53ea\u4f1a\u8bb0\u5f55\u4e00\u4e2a update \u8bed\u53e5\u800c\u5df2\uff1b MIXED\uff1a\u5305\u542b\u4e86 STATEMENT \u548c ROW \u6a21\u5f0f\uff0c\u5b83\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u60c5\u51b5\u81ea\u52a8\u4f7f\u7528 ROW \u6a21\u5f0f\u548c STATEMENT \u6a21\u5f0f\uff1b redo log \u662f\u7269\u7406\u65e5\u5fd7\uff0c\u8bb0\u5f55\u7684\u662f\u5728\u67d0\u4e2a\u6570\u636e\u9875\u505a\u4e86\u4ec0\u4e48\u4fee\u6539\uff0c\u6bd4\u5982\u5bf9 XXX \u8868\u7a7a\u95f4\u4e2d\u7684 YYY \u6570\u636e\u9875 ZZZ \u504f\u79fb\u91cf\u7684\u5730\u65b9\u505a\u4e86AAA \u66f4\u65b0\uff1b 3\u3001\u5199\u5165\u65b9\u5f0f\u4e0d\u540c\uff1a binlog \u662f\u8ffd\u52a0\u5199\uff0c\u5199\u6ee1\u4e00\u4e2a\u6587\u4ef6\uff0c\u5c31\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u7ee7\u7eed\u5199\uff0c\u4e0d\u4f1a\u8986\u76d6\u4ee5\u524d\u7684\u65e5\u5fd7\uff0c\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u7684\u65e5\u5fd7\u3002 redo log \u662f\u5faa\u73af\u5199\uff0c\u65e5\u5fd7\u7a7a\u95f4\u5927\u5c0f\u662f\u56fa\u5b9a\uff0c\u5168\u90e8\u5199\u6ee1\u5c31\u4ece\u5934\u5f00\u59cb\uff0c\u4fdd\u5b58\u672a\u88ab\u5237\u5165\u78c1\u76d8\u7684\u810f\u9875\u65e5\u5fd7\u3002 4\u3001\u7528\u9014\u4e0d\u540c\uff1a binlog \u7528\u4e8e\u5907\u4efd\u6062\u590d\u3001\u4e3b\u4ece\u590d\u5236\uff1b redo log \u7528\u4e8e\u6389\u7535\u7b49\u6545\u969c\u6062\u590d\u3002 \u5982\u679c\u4e0d\u5c0f\u5fc3\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u88ab\u5220\u9664\u4e86\uff0c\u80fd\u4f7f\u7528 redo log \u6587\u4ef6\u6062\u590d\u6570\u636e\u5417\uff1f \u4e0d\u53ef\u4ee5\u4f7f\u7528 redo log \u6587\u4ef6\u6062\u590d\uff0c\u53ea\u80fd\u4f7f\u7528 binlog \u6587\u4ef6\u6062\u590d\u3002 \u56e0\u4e3a redo log \u6587\u4ef6\u662f\u5faa\u73af\u5199\uff0c\u662f\u4f1a\u8fb9\u5199\u8fb9\u64e6\u9664\u65e5\u5fd7\u7684\uff0c\u53ea\u8bb0\u5f55\u672a\u88ab\u5237\u5165\u78c1\u76d8\u7684\u6570\u636e\u7684\u7269\u7406\u65e5\u5fd7\uff0c\u5df2\u7ecf\u5237\u5165\u78c1\u76d8\u7684\u6570\u636e\u90fd\u4f1a\u4ece redo log \u6587\u4ef6\u91cc\u64e6\u9664\u3002 binlog \u6587\u4ef6\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u7684\u65e5\u5fd7\uff0c\u4e5f\u5c31\u662f\u4fdd\u5b58\u4e86\u6240\u6709\u6570\u636e\u53d8\u66f4\u7684\u60c5\u51b5\uff0c\u7406\u8bba\u4e0a\u53ea\u8981\u8bb0\u5f55\u5728 binlog \u4e0a\u7684\u6570\u636e\uff0c\u90fd\u53ef\u4ee5\u6062\u590d\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5c0f\u5fc3\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u88ab\u5220\u9664\u4e86\uff0c\u5f97\u7528 binlog \u6587\u4ef6\u6062\u590d\u6570\u636e\u3002 \u4e3b\u4ece\u590d\u5236\u662f\u600e\u4e48\u5b9e\u73b0\uff1f \u00b6 MySQL \u7684\u4e3b\u4ece\u590d\u5236\u4f9d\u8d56\u4e8e binlog \uff0c\u4e5f\u5c31\u662f\u8bb0\u5f55 MySQL \u4e0a\u7684\u6240\u6709\u53d8\u5316\u5e76\u4ee5\u4e8c\u8fdb\u5236\u5f62\u5f0f\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\u3002\u590d\u5236\u7684\u8fc7\u7a0b\u5c31\u662f\u5c06 binlog \u4e2d\u7684\u6570\u636e\u4ece\u4e3b\u5e93\u4f20\u8f93\u5230\u4ece\u5e93\u4e0a\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u822c\u662f**\u5f02\u6b65**\u7684\uff0c\u4e5f\u5c31\u662f\u4e3b\u5e93\u4e0a\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u7b49\u5f85\u590d\u5236 binlog \u7684\u7ebf\u7a0b\u540c\u6b65\u5b8c\u6210\u3002 MySQL \u96c6\u7fa4\u7684\u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\u68b3\u7406\u6210 3 \u4e2a\u9636\u6bb5\uff1a \u5199\u5165 Binlog \uff1a\u4e3b\u5e93\u5199 binlog \u65e5\u5fd7\uff0c\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5e76\u66f4\u65b0\u672c\u5730\u5b58\u50a8\u6570\u636e\u3002 \u540c\u6b65 Binlog \uff1a\u628a binlog \u590d\u5236\u5230\u6240\u6709\u4ece\u5e93\u4e0a\uff0c\u6bcf\u4e2a\u4ece\u5e93\u628a binlog \u5199\u5230\u6682\u5b58\u65e5\u5fd7\u4e2d\u3002 \u56de\u653e Binlog \uff1a\u56de\u653e binlog\uff0c\u5e76\u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\u3002 \u5177\u4f53\u8be6\u7ec6\u8fc7\u7a0b\u5982\u4e0b\uff1a MySQL \u4e3b\u5e93\u5728\u6536\u5230\u5ba2\u6237\u7aef\u63d0\u4ea4\u4e8b\u52a1\u7684\u8bf7\u6c42\u4e4b\u540e\uff0c\u4f1a\u5148\u5199\u5165 binlog\uff0c\u518d\u63d0\u4ea4\u4e8b\u52a1\uff0c\u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\uff0c\u4e8b\u52a1\u63d0\u4ea4\u5b8c\u6210\u540e\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u201c\u64cd\u4f5c\u6210\u529f\u201d\u7684\u54cd\u5e94\u3002 \u4ece\u5e93\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e13\u95e8\u7684 I/O \u7ebf\u7a0b\uff0c\u8fde\u63a5\u4e3b\u5e93\u7684 log dump \u7ebf\u7a0b\uff0c\u6765\u63a5\u6536\u4e3b\u5e93\u7684 binlog \u65e5\u5fd7\uff0c\u518d\u628a binlog \u4fe1\u606f\u5199\u5165 relay log \u7684\u4e2d\u7ee7\u65e5\u5fd7\u91cc\uff0c\u518d\u8fd4\u56de\u7ed9\u4e3b\u5e93\u201c\u590d\u5236\u6210\u529f\u201d\u7684\u54cd\u5e94\u3002 \u4ece\u5e93\u4f1a\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u56de\u653e binlog \u7684\u7ebf\u7a0b\uff0c\u53bb\u8bfb relay log \u4e2d\u7ee7\u65e5\u5fd7\uff0c\u7136\u540e\u56de\u653e binlog \u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\uff0c\u6700\u7ec8\u5b9e\u73b0\u4e3b\u4ece\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002 \u5728\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\u4e4b\u540e\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728\u5199\u6570\u636e\u65f6\u53ea\u5199\u4e3b\u5e93\uff0c\u5728\u8bfb\u6570\u636e\u65f6\u53ea\u8bfb\u4ece\u5e93\uff0c\u8fd9\u6837\u5373\u4f7f\u5199\u8bf7\u6c42\u4f1a\u9501\u8868\u6216\u8005\u9501\u8bb0\u5f55\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u8bfb\u8bf7\u6c42\u7684\u6267\u884c\u3002 \u4ece\u5e93\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff1f \u4e0d\u662f\u7684\u3002 \u56e0\u4e3a\u4ece\u5e93\u6570\u91cf\u589e\u52a0\uff0c\u4ece\u5e93\u8fde\u63a5\u4e0a\u6765\u7684 I/O \u7ebf\u7a0b\u4e5f\u6bd4\u8f83\u591a\uff0c \u4e3b\u5e93\u4e5f\u8981\u521b\u5efa\u540c\u6837\u591a\u7684 log dump \u7ebf\u7a0b\u6765\u5904\u7406\u590d\u5236\u7684\u8bf7\u6c42\uff0c\u5bf9\u4e3b\u5e93\u8d44\u6e90\u6d88\u8017\u6bd4\u8f83\u9ad8\uff0c\u540c\u65f6\u8fd8\u53d7\u9650\u4e8e\u4e3b\u5e93\u7684\u7f51\u7edc\u5e26\u5bbd \u3002 \u6240\u4ee5\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u4e00\u4e2a\u4e3b\u5e93\u4e00\u822c\u8ddf 2\uff5e3 \u4e2a\u4ece\u5e93\uff081 \u5957\u6570\u636e\u5e93\uff0c1 \u4e3b 2 \u4ece 1 \u5907\u4e3b\uff09\uff0c\u8fd9\u5c31\u662f\u4e00\u4e3b\u591a\u4ece\u7684 MySQL \u96c6\u7fa4\u7ed3\u6784\u3002 MySQL \u4e3b\u4ece\u590d\u5236\u8fd8\u6709\u54ea\u4e9b\u6a21\u578b\uff1f \u4e3b\u8981\u6709\u4e09\u79cd\uff1a \u540c\u6b65\u590d\u5236 \uff1aMySQL \u4e3b\u5e93\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ebf\u7a0b\u8981\u7b49\u5f85\u6240\u6709\u4ece\u5e93\u7684\u590d\u5236\u6210\u529f\u54cd\u5e94\uff0c\u624d\u8fd4\u56de\u5ba2\u6237\u7aef\u7ed3\u679c\u3002\u8fd9\u79cd\u65b9\u5f0f\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u57fa\u672c\u4e0a\u6ca1\u6cd5\u7528\uff0c\u539f\u56e0\u6709\u4e24\u4e2a\uff1a\u4e00\u662f\u6027\u80fd\u5f88\u5dee\uff0c\u56e0\u4e3a\u8981\u590d\u5236\u5230\u6240\u6709\u8282\u70b9\u624d\u8fd4\u56de\u54cd\u5e94\uff1b\u4e8c\u662f\u53ef\u7528\u6027\u4e5f\u5f88\u5dee\uff0c\u4e3b\u5e93\u548c\u6240\u6709\u4ece\u5e93\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u5e93\u51fa\u95ee\u9898\uff0c\u90fd\u4f1a\u5f71\u54cd\u4e1a\u52a1\u3002 \u5f02\u6b65\u590d\u5236 \uff08\u9ed8\u8ba4\u6a21\u578b\uff09\uff1aMySQL \u4e3b\u5e93\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u7b49\u5f85 binlog \u540c\u6b65\u5230\u5404\u4ece\u5e93\uff0c\u5c31\u8fd4\u56de\u5ba2\u6237\u7aef\u7ed3\u679c\u3002\u8fd9\u79cd\u6a21\u5f0f\u4e00\u65e6\u4e3b\u5e93\u5b95\u673a\uff0c\u6570\u636e\u5c31\u4f1a\u53d1\u751f\u4e22\u5931\u3002 \u534a\u540c\u6b65\u590d\u5236 \uff1aMySQL 5.7 \u7248\u672c\u4e4b\u540e\u589e\u52a0\u7684\u4e00\u79cd\u590d\u5236\u65b9\u5f0f\uff0c\u4ecb\u4e8e\u4e24\u8005\u4e4b\u95f4\uff0c\u4e8b\u52a1\u7ebf\u7a0b\u4e0d\u7528\u7b49\u5f85\u6240\u6709\u7684\u4ece\u5e93\u590d\u5236\u6210\u529f\u54cd\u5e94\uff0c\u53ea\u8981\u4e00\u90e8\u5206\u590d\u5236\u6210\u529f\u54cd\u5e94\u56de\u6765\u5c31\u884c\uff0c\u6bd4\u5982\u4e00\u4e3b\u4e8c\u4ece\u7684\u96c6\u7fa4\uff0c\u53ea\u8981\u6570\u636e\u6210\u529f\u590d\u5236\u5230\u4efb\u610f\u4e00\u4e2a\u4ece\u5e93\u4e0a\uff0c\u4e3b\u5e93\u7684\u4e8b\u52a1\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8fd9\u79cd**\u534a\u540c\u6b65\u590d\u5236\u7684\u65b9\u5f0f\uff0c\u517c\u987e\u4e86\u5f02\u6b65\u590d\u5236\u548c\u540c\u6b65\u590d\u5236\u7684\u4f18\u70b9\uff0c\u5373\u4f7f\u51fa\u73b0\u4e3b\u5e93\u5b95\u673a\uff0c\u81f3\u5c11\u8fd8\u6709\u4e00\u4e2a\u4ece\u5e93\u6709\u6700\u65b0\u7684\u6570\u636e\uff0c\u4e0d\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669**\u3002 binlog \u4ec0\u4e48\u65f6\u5019\u5237\u76d8\uff1f \u00b6 \u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5148\u628a\u65e5\u5fd7\u5199\u5230 binlog cache\uff08Server \u5c42\u7684 cache\uff09\uff0c\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u518d\u628a binlog cache \u5199\u5230 binlog \u6587\u4ef6\u4e2d\u3002 MySQL \u7ed9 binlog cache \u5206\u914d\u4e86\u4e00\u7247\u5185\u5b58\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u4e2a\uff0c\u53c2\u6570 binlog_cache_size \u7528\u4e8e\u63a7\u5236\u5355\u4e2a\u7ebf\u7a0b\u5185 binlog cache \u6240\u5360\u5185\u5b58\u7684\u5927\u5c0f\u3002\u5982\u679c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u53c2\u6570\u89c4\u5b9a\u7684\u5927\u5c0f\uff0c\u5c31\u8981\u6682\u5b58\u5230\u78c1\u76d8\u3002 \u4ec0\u4e48\u65f6\u5019 binlog cache \u4f1a\u5199\u5230 binlog \u6587\u4ef6\uff1f \u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u6267\u884c\u5668\u628a binlog cache \u91cc\u7684\u5b8c\u6574\u4e8b\u52a1\u5199\u5165\u5230 binlog \u6587\u4ef6\u4e2d\uff0c\u5e76\u6e05\u7a7a binlog cache\u3002\u5982\u4e0b\u56fe\uff1a \u867d\u7136\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1 binlog cache\uff0c\u4f46\u662f\u6700\u7ec8\u90fd\u5199\u5230\u540c\u4e00\u4e2a binlog \u6587\u4ef6\uff1a \u56fe\u4e2d\u7684 write\uff0c\u6307\u7684\u5c31\u662f\u6307\u628a\u65e5\u5fd7\u5199\u5165\u5230 binlog \u6587\u4ef6\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u628a\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u56e0\u4e3a\u6570\u636e\u8fd8\u7f13\u5b58\u5728\u6587\u4ef6\u7cfb\u7edf\u7684 page cache \u91cc\uff0cwrite \u7684\u5199\u5165\u901f\u5ea6\u8fd8\u662f\u6bd4\u8f83\u5feb\u7684\uff0c\u56e0\u4e3a\u4e0d\u6d89\u53ca\u78c1\u76d8 I/O\u3002 \u56fe\u4e2d\u7684 fsync\uff0c\u624d\u662f\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\uff0c\u8fd9\u91cc\u5c31\u4f1a\u6d89\u53ca\u78c1\u76d8 I/O\uff0c\u6240\u4ee5\u9891\u7e41\u7684 fsync \u4f1a\u5bfc\u81f4\u78c1\u76d8\u7684 I/O \u5347\u9ad8\u3002 MySQL\u63d0\u4f9b\u4e00\u4e2a sync_binlog \u53c2\u6570\u6765\u63a7\u5236\u6570\u636e\u5e93\u7684 binlog \u5237\u5230\u78c1\u76d8\u4e0a\u7684\u9891\u7387\uff1a sync_binlog = 0 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u53ea write\uff0c\u4e0d fsync\uff0c\u540e\u7eed\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff1b sync_binlog = 1 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a write\uff0c\u7136\u540e\u9a6c\u4e0a\u6267\u884c fsync\uff1b sync_binlog =N(N>1) \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd write\uff0c\u4f46\u7d2f\u79ef N \u4e2a\u4e8b\u52a1\u540e\u624d fsync\u3002 \u5728MySQL\u4e2d\u7cfb\u7edf\u9ed8\u8ba4\u7684\u8bbe\u7f6e\u662f sync_binlog = 0\uff0c\u4e5f\u5c31\u662f\u4e0d\u505a\u4efb\u4f55\u5f3a\u5236\u6027\u7684\u78c1\u76d8\u5237\u65b0\u6307\u4ee4\uff0c\u8fd9\u65f6\u5019\u7684\u6027\u80fd\u662f\u6700\u597d\u7684\uff0c\u4f46\u662f\u98ce\u9669\u4e5f\u662f\u6700\u5927\u7684\u3002\u56e0\u4e3a\u4e00\u65e6\u4e3b\u673a\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u8fd8\u6ca1\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u800c\u5f53 sync_binlog \u8bbe\u7f6e\u4e3a 1 \u7684\u65f6\u5019\uff0c\u662f\u6700\u5b89\u5168\u4f46\u662f\u6027\u80fd\u635f\u8017\u6700\u5927\u7684\u8bbe\u7f6e\u3002\u56e0\u4e3a\u5f53\u8bbe\u7f6e\u4e3a 1 \u7684\u65f6\u5019\uff0c\u5373\u4f7f\u4e3b\u673a\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u6700\u591a\u4e22\u5931\u4e00\u4e2a\u4e8b\u52a1\u7684 binlog\uff0c\u800c\u5df2\u7ecf\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u6570\u636e\u5c31\u4e0d\u4f1a\u6709\u5f71\u54cd\uff0c\u4e0d\u8fc7\u5c31\u662f\u5bf9\u5199\u5165\u6027\u80fd\u5f71\u54cd\u592a\u5927\u3002 \u5982\u679c\u80fd\u5bb9\u5c11\u91cf\u4e8b\u52a1\u7684 binlog \u65e5\u5fd7\u4e22\u5931\u7684\u98ce\u9669\uff0c\u4e3a\u4e86\u63d0\u9ad8\u5199\u5165\u7684\u6027\u80fd\uff0c\u4e00\u822c\u4f1a sync_binlog \u8bbe\u7f6e\u4e3a 100~1000 \u4e2d\u7684\u67d0\u4e2a\u6570\u503c\u3002 \u4e09\u4e2a\u65e5\u5fd7\u8bb2\u5b8c\u4e86\uff0c\u81f3\u6b64\u6211\u4eec\u53ef\u4ee5\u5148\u5c0f\u7ed3\u4e0b\uff0cupdate \u8bed\u53e5\u7684\u6267\u884c\u8fc7\u7a0b\u3002 \u5f53\u4f18\u5316\u5668\u5206\u6790\u51fa\u6210\u672c\u6700\u5c0f\u7684\u6267\u884c\u8ba1\u5212\u540e\uff0c\u6267\u884c\u5668\u5c31\u6309\u7167\u6267\u884c\u8ba1\u5212\u5f00\u59cb\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u3002 \u5177\u4f53\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55 UPDATE t_user SET name = 'xiaolin' WHERE id = 1; \u7684\u6d41\u7a0b\u5982\u4e0b: \u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u4f1a\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\uff0c\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u6811\u641c\u7d22\u83b7\u53d6 id = 1 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1a \u5982\u679c id=1 \u8fd9\u4e00\u884c\u6240\u5728\u7684\u6570\u636e\u9875\u672c\u6765\u5c31\u5728 buffer pool \u4e2d\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7ed9\u6267\u884c\u5668\u66f4\u65b0\uff1b \u5982\u679c\u8bb0\u5f55\u4e0d\u5728 buffer pool\uff0c\u5c06\u6570\u636e\u9875\u4ece\u78c1\u76d8\u8bfb\u5165\u5230 buffer pool\uff0c\u8fd4\u56de\u8bb0\u5f55\u7ed9\u6267\u884c\u5668\u3002 \u6267\u884c\u5668\u5f97\u5230\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u540e\uff0c\u4f1a\u770b\u4e00\u4e0b\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u662f\u5426\u4e00\u6837\uff1a \u5982\u679c\u4e00\u6837\u7684\u8bdd\u5c31\u4e0d\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u6d41\u7a0b\uff1b \u5982\u679c\u4e0d\u4e00\u6837\u7684\u8bdd\u5c31\u628a\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u90fd\u5f53\u4f5c\u53c2\u6570\u4f20\u7ed9 InnoDB \u5c42\uff0c\u8ba9 InnoDB \u771f\u6b63\u7684\u6267\u884c\u66f4\u65b0\u8bb0\u5f55\u7684\u64cd\u4f5c\uff1b \u5f00\u542f\u4e8b\u52a1\uff0c InnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u56e0\u4e3a\u8fd9\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\uff0c\u4e0d\u8fc7\u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log\u3002 InnoDB \u5c42\u5f00\u59cb\u66f4\u65b0\u8bb0\u5f55\uff0c\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u5199\u5230 redo log \u91cc\u9762\uff0c\u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86\u3002\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002\u8fd9\u5c31\u662f WAL \u6280\u672f \uff0cMySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199 redo \u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5c06\u4fee\u6539\u7684\u884c\u6570\u636e\u5199\u5230\u78c1\u76d8\u4e0a\u3002 \u81f3\u6b64\uff0c\u4e00\u6761\u8bb0\u5f55\u66f4\u65b0\u5b8c\u4e86\u3002 \u5728\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7136\u540e\u5f00\u59cb\u8bb0\u5f55\u8be5\u8bed\u53e5\u5bf9\u5e94\u7684 binlog\uff0c\u6b64\u65f6\u8bb0\u5f55\u7684 binlog \u4f1a\u88ab\u4fdd\u5b58\u5230 binlog cache\uff0c\u5e76\u6ca1\u6709\u5237\u65b0\u5230\u786c\u76d8\u4e0a\u7684 binlog \u6587\u4ef6\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u624d\u4f1a\u7edf\u4e00\u5c06\u8be5\u4e8b\u52a1\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709 binlog \u5237\u65b0\u5230\u786c\u76d8\u3002 \u4e8b\u52a1\u63d0\u4ea4\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u300c\u4e24\u9636\u6bb5\u63d0\u4ea4\u300d\u7684\u4e8b\u60c5\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u8bb2\u8fd9\u4e2a\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981\u4e24\u9636\u6bb5\u63d0\u4ea4\uff1f \u00b6 \u4e8b\u52a1\u63d0\u4ea4\u540e\uff0credo log \u548c binlog \u90fd\u8981\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u662f\u72ec\u7acb\u7684\u903b\u8f91\uff0c\u53ef\u80fd\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\uff0c\u8fd9\u6837\u5c31\u9020\u6210\u4e24\u4efd\u65e5\u5fd7\u4e4b\u95f4\u7684\u903b\u8f91\u4e0d\u4e00\u81f4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe id = 1 \u8fd9\u884c\u6570\u636e\u7684\u5b57\u6bb5 name \u7684\u503c\u539f\u672c\u662f 'jay'\uff0c\u7136\u540e\u6267\u884c UPDATE t_user SET name = 'xiaolin' WHERE id = 1; \u5982\u679c\u5728\u6301\u4e45\u5316 redo log \u548c binlog \u4e24\u4e2a\u65e5\u5fd7\u7684\u8fc7\u7a0b\u4e2d\uff0c\u51fa\u73b0\u4e86\u534a\u6210\u529f\u72b6\u6001\uff0c\u90a3\u4e48\u5c31\u6709\u4e24\u79cd\u60c5\u51b5\uff1a \u5982\u679c\u5728\u5c06 redo log \u5237\u5165\u5230\u78c1\u76d8\u4e4b\u540e\uff0c MySQL \u7a81\u7136\u5b95\u673a\u4e86\uff0c\u800c binlog \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165 \u3002MySQL \u91cd\u542f\u540e\uff0c\u901a\u8fc7 redo log \u80fd\u5c06 Buffer Pool \u4e2d id = 1 \u8fd9\u884c\u6570\u636e\u7684 name \u5b57\u6bb5\u6062\u590d\u5230\u65b0\u503c xiaolin\uff0c\u4f46\u662f binlog \u91cc\u9762\u6ca1\u6709\u8bb0\u5f55\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u5728\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0cbinlog \u4f1a\u88ab\u590d\u5236\u5230\u4ece\u5e93\uff0c\u7531\u4e8e binlog \u4e22\u5931\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u4ece\u5e93\u7684\u8fd9\u4e00\u884c name \u5b57\u6bb5\u662f\u65e7\u503c jay\uff0c\u4e0e\u4e3b\u5e93\u7684\u503c\u4e0d\u4e00\u81f4\u6027\uff1b \u5982\u679c\u5728\u5c06 binlog \u5237\u5165\u5230\u78c1\u76d8\u4e4b\u540e\uff0c MySQL \u7a81\u7136\u5b95\u673a\u4e86\uff0c\u800c redo log \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165 \u3002\u7531\u4e8e redo log \u8fd8\u6ca1\u5199\uff0c\u5d29\u6e83\u6062\u590d\u4ee5\u540e\u8fd9\u4e2a\u4e8b\u52a1\u65e0\u6548\uff0c\u6240\u4ee5 id = 1 \u8fd9\u884c\u6570\u636e\u7684 name \u5b57\u6bb5\u8fd8\u662f\u65e7\u503c jay\uff0c\u800c binlog \u91cc\u9762\u8bb0\u5f55\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u5728\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0cbinlog \u4f1a\u88ab\u590d\u5236\u5230\u4ece\u5e93\uff0c\u4ece\u5e93\u6267\u884c\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u90a3\u4e48\u8fd9\u4e00\u884c name \u5b57\u6bb5\u662f\u65b0\u503c xiaolin\uff0c\u4e0e\u4e3b\u5e93\u7684\u503c\u4e0d\u4e00\u81f4\u6027\uff1b \u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6301\u4e45\u5316 redo log \u548c binlog \u8fd9\u4e24\u4efd\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5982\u679c\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u4ece\u73af\u5883\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u3002\u8fd9\u662f\u56e0\u4e3a redo log \u5f71\u54cd\u4e3b\u5e93\u7684\u6570\u636e\uff0cbinlog \u5f71\u54cd\u4ece\u5e93\u7684\u6570\u636e\uff0c\u6240\u4ee5 redo log \u548c binlog \u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u624d\u80fd\u4fdd\u8bc1\u4e3b\u4ece\u6570\u636e\u4e00\u81f4\u3002 MySQL \u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u4e24\u4efd\u65e5\u5fd7\u4e4b\u95f4\u7684\u903b\u8f91\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u4f7f\u7528\u4e86\u300c\u4e24\u9636\u6bb5\u63d0\u4ea4\u300d\u6765\u89e3\u51b3 \uff0c\u4e24\u9636\u6bb5\u63d0\u4ea4\u5176\u5b9e\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u591a\u4e2a\u903b\u8f91\u64cd\u4f5c\u8981\u4e0d\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e0d\u5168\u90e8\u5931\u8d25\uff0c\u4e0d\u4f1a\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\u3002 \u4e24\u9636\u6bb5\u63d0\u4ea4\u628a\u5355\u4e2a\u4e8b\u52a1\u7684\u63d0\u4ea4\u62c6\u5206\u6210\u4e86 2 \u4e2a\u9636\u6bb5\uff0c\u5206\u522b\u662f\u300c\u51c6\u5907\uff08Prepare\uff09\u9636\u6bb5\u300d\u548c\u300c\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u300d \uff0c\u6bcf\u4e2a\u9636\u6bb5\u90fd\u7531\u534f\u8c03\u8005\uff08Coordinator\uff09\u548c\u53c2\u4e0e\u8005\uff08Participant\uff09\u5171\u540c\u5b8c\u6210\u3002\u6ce8\u610f\uff0c\u4e0d\u8981\u628a\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u548c commit \u8bed\u53e5\u6df7\u6dc6\u4e86\uff0ccommit \u8bed\u53e5\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u5305\u542b\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u3002 \u4e3e\u4e2a\u62f3\u51fb\u6bd4\u8d5b\u7684\u4f8b\u5b50\uff0c\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u5f00\u59cb\u6bd4\u8d5b\u4e4b\u524d\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u5728\u4e2d\u95f4\u786e\u8ba4\u4e24\u4f4d\u62f3\u51fb\u624b\u7684\u72b6\u6001\uff0c\u7c7b\u4f3c\u4e8e\u95ee\u4f60\u51c6\u5907\u597d\u4e86\u5417\uff1f \u51c6\u5907\u9636\u6bb5 \uff1a\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u4f9d\u6b21\u8be2\u95ee\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u662f\u5426\u51c6\u5907\u597d\u4e86\uff0c\u7136\u540e\u62f3\u51fb\u624b\u542c\u5230\u540e\u505a\u51fa\u5e94\u7b54\uff0c\u5982\u679c\u89c9\u5f97\u81ea\u5df1\u51c6\u5907\u597d\u4e86\uff0c\u5c31\u4f1a\u8ddf\u88c1\u5224\u8bf4\u51c6\u5907\u597d\u4e86\uff1b\u5982\u679c\u6ca1\u6709\u81ea\u5df1\u8fd8\u6ca1\u6709\u51c6\u5907\u597d\uff08\u6bd4\u5982\u62f3\u5957\u8fd8\u6ca1\u6709\u5e26\u597d\uff09\uff0c\u5c31\u4f1a\u8ddf\u88c1\u5224\u8bf4\u8fd8\u6ca1\u51c6\u5907\u597d\u3002 \u63d0\u4ea4\u9636\u6bb5 \uff1a\u5982\u679c\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u90fd\u56de\u7b54\u51c6\u5907\u597d\u4e86\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u5ba3\u5e03\u6bd4\u8d5b\u6b63\u5f0f\u5f00\u59cb\uff0c\u4e24\u4f4d\u62f3\u51fb\u624b\u5c31\u53ef\u4ee5\u76f4\u63a5\u5f00\u6253\uff1b\u5982\u679c\u4efb\u4f55\u4e00\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u56de\u7b54\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u5ba3\u5e03\u6bd4\u8d5b\u6682\u505c\uff0c\u5bf9\u5e94\u4e8b\u52a1\u4e2d\u7684\u56de\u6eda\u64cd\u4f5c\u3002 \u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f \u00b6 \u5728 MySQL \u7684 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u5f00\u542f binlog \u7684\u60c5\u51b5\u4e0b\uff0cMySQL \u4f1a\u540c\u65f6\u7ef4\u62a4 binlog \u65e5\u5fd7\u4e0e InnoDB \u7684 redo log\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u4e24\u4e2a\u65e5\u5fd7\u7684\u4e00\u81f4\u6027\uff0cMySQL \u4f7f\u7528\u4e86**\u5185\u90e8 XA \u4e8b\u52a1**\uff08\u662f\u7684\uff0c\u4e5f\u6709\u5916\u90e8 XA \u4e8b\u52a1\uff0c\u8ddf\u672c\u6587\u4e0d\u592a\u76f8\u5173\uff0c\u6211\u5c31\u4e0d\u4ecb\u7ecd\u4e86\uff09\uff0c\u5185\u90e8 XA \u4e8b\u52a1\u7531 binlog \u4f5c\u4e3a\u534f\u8c03\u8005\uff0c\u5b58\u50a8\u5f15\u64ce\u662f\u53c2\u4e0e\u8005\u3002 \u5f53\u5ba2\u6237\u7aef\u6267\u884c commit \u8bed\u53e5\u6216\u8005\u5728\u81ea\u52a8\u63d0\u4ea4\u7684\u60c5\u51b5\u4e0b\uff0cMySQL \u5185\u90e8\u5f00\u542f\u4e00\u4e2a XA \u4e8b\u52a1\uff0c \u5206\u4e24\u9636\u6bb5\u6765\u5b8c\u6210 XA \u4e8b\u52a1\u7684\u63d0\u4ea4 \uff0c\u5982\u4e0b\u56fe\uff1a \u4ece\u56fe\u4e2d\u53ef\u770b\u51fa\uff0c\u4e8b\u52a1\u7684\u63d0\u4ea4\u8fc7\u7a0b\u6709\u4e24\u4e2a\u9636\u6bb5\uff0c\u5c31\u662f**\u5c06 redo log \u7684\u5199\u5165\u62c6\u6210\u4e86\u4e24\u4e2a\u6b65\u9aa4\uff1aprepare \u548c commit\uff0c\u4e2d\u95f4\u518d\u7a7f\u63d2\u5199\u5165binlog**\uff0c\u5177\u4f53\u5982\u4e0b\uff1a prepare \u9636\u6bb5 \uff1a\u5c06 XID\uff08\u5185\u90e8 XA \u4e8b\u52a1\u7684 ID\uff09 \u5199\u5165\u5230 redo log\uff0c\u540c\u65f6\u5c06 redo log \u5bf9\u5e94\u7684\u4e8b\u52a1\u72b6\u6001\u8bbe\u7f6e\u4e3a prepare\uff0c\u7136\u540e\u5c06 redo log \u5237\u65b0\u5230\u786c\u76d8\uff1b commit \u9636\u6bb5 \uff1a\u628a XID \u5199\u5165\u5230 binlog\uff0c\u7136\u540e\u5c06 binlog \u5237\u65b0\u5230\u78c1\u76d8\uff0c\u63a5\u7740\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\uff08\u5c06\u4e8b\u52a1\u8bbe\u7f6e\u4e3a commit \u72b6\u6001\u540e\uff0c\u5237\u5165\u5230\u78c1\u76d8 redo log \u6587\u4ef6\uff0c\u6240\u4ee5 commit \u72b6\u6001\u4e5f\u662f\u4f1a\u5237\u76d8\u7684\uff09\uff1b \u5f02\u5e38\u91cd\u542f\u4f1a\u51fa\u73b0\u4ec0\u4e48\u73b0\u8c61\uff1f \u00b6 \u6211\u4eec\u6765\u770b\u770b\u5728\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u4e0d\u540c\u65f6\u523b\uff0cMySQL \u5f02\u5e38\u91cd\u542f\u4f1a\u51fa\u73b0\u4ec0\u4e48\u73b0\u8c61\uff1f\u4e0b\u56fe\u4e2d\u6709\u65f6\u523b A \u548c\u65f6\u523b B \u90fd\u6709\u53ef\u80fd\u53d1\u751f\u5d29\u6e83\uff1a \u4e0d\u7ba1\u662f\u65f6\u523b A\uff08\u5df2\u7ecf redo log\uff0c\u8fd8\u6ca1\u5199\u5165 binlog\uff09\uff0c\u8fd8\u662f\u65f6\u523b B \uff08\u5df2\u7ecf\u5199\u5165 redo log \u548c binlog\uff0c\u8fd8\u6ca1\u5199\u5165 commit \u6807\u8bc6\uff09\u5d29\u6e83\uff0c \u6b64\u65f6\u7684 redo log \u90fd\u5904\u4e8e prepare \u72b6\u6001 \u3002 \u5728 MySQL \u91cd\u542f\u540e\u4f1a\u6309\u987a\u5e8f\u626b\u63cf redo log \u6587\u4ef6\uff0c\u78b0\u5230\u5904\u4e8e prepare \u72b6\u6001\u7684 redo log\uff0c\u5c31\u62ff\u7740 redo log \u4e2d\u7684 XID \u53bb binlog \u67e5\u770b\u662f\u5426\u5b58\u5728\u6b64 XID\uff1a \u5982\u679c binlog \u4e2d\u6ca1\u6709\u5f53\u524d\u5185\u90e8 XA \u4e8b\u52a1\u7684 XID\uff0c\u8bf4\u660e redolog \u5b8c\u6210\u5237\u76d8\uff0c\u4f46\u662f binlog \u8fd8\u6ca1\u6709\u5237\u76d8\uff0c\u5219\u56de\u6eda\u4e8b\u52a1 \u3002\u5bf9\u5e94\u65f6\u523b A \u5d29\u6e83\u6062\u590d\u7684\u60c5\u51b5\u3002 \u5982\u679c binlog \u4e2d\u6709\u5f53\u524d\u5185\u90e8 XA \u4e8b\u52a1\u7684 XID\uff0c\u8bf4\u660e redolog \u548c binlog \u90fd\u5df2\u7ecf\u5b8c\u6210\u4e86\u5237\u76d8\uff0c\u5219\u63d0\u4ea4\u4e8b\u52a1 \u3002\u5bf9\u5e94\u65f6\u523b B \u5d29\u6e83\u6062\u590d\u7684\u60c5\u51b5\u3002 \u53ef\u4ee5\u770b\u5230\uff0c \u5bf9\u4e8e\u5904\u4e8e prepare \u9636\u6bb5\u7684 redo log\uff0c\u5373\u53ef\u4ee5\u63d0\u4ea4\u4e8b\u52a1\uff0c\u4e5f\u53ef\u4ee5\u56de\u6eda\u4e8b\u52a1\uff0c\u8fd9\u53d6\u51b3\u4e8e\u662f\u5426\u80fd\u5728 binlog \u4e2d\u67e5\u627e\u5230\u4e0e redo log \u76f8\u540c\u7684 XID \uff0c\u5982\u679c\u6709\u5c31\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u56de\u6eda\u4e8b\u52a1\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1 redo log \u548c binlog \u8fd9\u4e24\u4efd\u65e5\u5fd7\u7684\u4e00\u81f4\u6027\u4e86\u3002 \u6240\u4ee5\u8bf4\uff0c \u4e24\u9636\u6bb5\u63d0\u4ea4\u662f\u4ee5 binlog \u5199\u6210\u529f\u4e3a\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u7684\u6807\u8bc6 \uff0c\u56e0\u4e3a binlog \u5199\u6210\u529f\u4e86\uff0c\u5c31\u610f\u5473\u7740\u80fd\u5728 binlog \u4e2d\u67e5\u627e\u5230\u4e0e redo log \u76f8\u540c\u7684 XID\u3002 \u5904\u4e8e prepare \u9636\u6bb5\u7684 redo log \u52a0\u4e0a\u5b8c\u6574 binlog\uff0c\u91cd\u542f\u5c31\u63d0\u4ea4\u4e8b\u52a1\uff0cMySQL \u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1? binlog \u5df2\u7ecf\u5199\u5165\u4e86\uff0c\u4e4b\u540e\u5c31\u4f1a\u88ab\u4ece\u5e93\uff08\u6216\u8005\u7528\u8fd9\u4e2a binlog \u6062\u590d\u51fa\u6765\u7684\u5e93\uff09\u4f7f\u7528\u3002 \u6240\u4ee5\uff0c\u5728\u4e3b\u5e93\u4e0a\u4e5f\u8981\u63d0\u4ea4\u8fd9\u4e2a\u4e8b\u52a1\u3002\u91c7\u7528\u8fd9\u4e2a\u7b56\u7565\uff0c\u4e3b\u5e93\u548c\u5907\u5e93\u7684\u6570\u636e\u5c31\u4fdd\u8bc1\u4e86\u4e00\u81f4\u6027\u3002 \u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0credo log \u4f1a\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5417\uff1f \u4f1a\u7684\u3002 \u4e8b\u52a1\u6267\u884c\u4e2d\u95f4\u8fc7\u7a0b\u7684 redo log \u4e5f\u662f\u76f4\u63a5\u5199\u5728 redo log buffer \u4e2d\u7684\uff0c\u8fd9\u4e9b\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u4e5f\u4f1a\u88ab\u300c\u540e\u53f0\u7ebf\u7a0b\u300d\u6bcf\u9694\u4e00\u79d2\u4e00\u8d77\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0credo log \u4e5f\u662f\u53ef\u80fd\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u3002 \u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u95ee\uff0c\u5982\u679c mysql \u5d29\u6e83\u4e86\uff0c\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u7684 redo log \u5df2\u7ecf\u88ab\u6301\u4e45\u5316\u78c1\u76d8\u4e86\uff0cmysql \u91cd\u542f\u540e\uff0c\u6570\u636e\u4e0d\u5c31\u4e0d\u4e00\u81f4\u4e86\uff1f \u653e\u5fc3\uff0c\u8fd9\u79cd\u60c5\u51b5 mysql \u91cd\u542f\u4f1a\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\uff0c\u56e0\u4e3a\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0cbinlog \u662f\u8fd8\u6ca1\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u3002 \u6240\u4ee5\uff0c redo log \u53ef\u4ee5\u5728\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u4e4b\u524d\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u4f46\u662f binlog \u5fc5\u987b\u5728\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0c\u624d\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u4e24\u9636\u6bb5\u63d0\u4ea4\u6709\u4ec0\u4e48\u95ee\u9898\uff1f \u00b6 \u4e24\u9636\u6bb5\u63d0\u4ea4\u867d\u7136\u4fdd\u8bc1\u4e86\u4e24\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u6027\u80fd\u5f88\u5dee\uff0c\u4e3b\u8981\u6709\u4e24\u4e2a\u65b9\u9762\u7684\u5f71\u54cd\uff1a \u78c1\u76d8 I/O \u6b21\u6570\u9ad8 \uff1a\u5bf9\u4e8e\u201c\u53cc1\u201d\u914d\u7f6e\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u90fd\u4f1a\u8fdb\u884c\u4e24\u6b21 fsync\uff08\u5237\u76d8\uff09\uff0c\u4e00\u6b21\u662f redo log \u5237\u76d8\uff0c\u53e6\u4e00\u6b21\u662f binlog \u5237\u76d8\u3002 \u9501\u7ade\u4e89\u6fc0\u70c8 \uff1a\u4e24\u9636\u6bb5\u63d0\u4ea4\u867d\u7136\u80fd\u591f\u4fdd\u8bc1\u300c\u5355\u4e8b\u52a1\u300d\u4e24\u4e2a\u65e5\u5fd7\u7684\u5185\u5bb9\u4e00\u81f4\uff0c\u4f46\u5728\u300c\u591a\u4e8b\u52a1\u300d\u7684\u60c5\u51b5\u4e0b\uff0c\u5374\u4e0d\u80fd\u4fdd\u8bc1\u4e24\u8005\u7684\u63d0\u4ea4\u987a\u5e8f\u4e00\u81f4\uff0c\u56e0\u6b64\uff0c\u5728\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u6d41\u7a0b\u57fa\u7840\u4e0a\uff0c\u8fd8\u9700\u8981\u52a0\u4e00\u4e2a\u9501\u6765\u4fdd\u8bc1\u63d0\u4ea4\u7684\u539f\u5b50\u6027\uff0c\u4ece\u800c\u4fdd\u8bc1\u591a\u4e8b\u52a1\u7684\u60c5\u51b5\u4e0b\uff0c\u4e24\u4e2a\u65e5\u5fd7\u7684\u63d0\u4ea4\u987a\u5e8f\u4e00\u81f4\u3002 \u4e3a\u4ec0\u4e48\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4f1a\u5f88\u9ad8\uff1f binlog \u548c redo log \u5728\u5185\u5b58\u4e2d\u90fd\u5bf9\u5e94\u7684\u7f13\u5b58\u7a7a\u95f4\uff0cbinlog \u4f1a\u7f13\u5b58\u5728 binlog cache\uff0credo log \u4f1a\u7f13\u5b58\u5728 redo log buffer\uff0c\u5b83\u4eec\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u65f6\u673a\u5206\u522b\u7531\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u63a7\u5236\u3002\u4e00\u822c\u6211\u4eec\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u4e22\u5931\u7684\u98ce\u9669\uff0c\u4f1a\u5c06\u8fd9\u4e24\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff1a \u5f53 sync_binlog = 1 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a\u5c06 binlog cache \u91cc\u7684 binlog \u76f4\u63a5\u6301\u4e45\u5230\u78c1\u76d8\uff1b \u5f53 innodb_flush_log_at_trx_commit = 1 \u65f6\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u5c06\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff1b \u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c sync_binlog \u548c \u5f53 innodb_flush_log_at_trx_commit \u90fd\u8bbe\u7f6e\u4e3a 1\uff0c\u90a3\u4e48\u5728\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u8fc7\u7a0b\u4e2d\uff0c \u90fd\u4f1a\u81f3\u5c11\u8c03\u7528 2 \u6b21\u5237\u76d8\u64cd\u4f5c\uff0c\u4e00\u6b21\u662f redo log \u5237\u76d8\uff0c\u4e00\u6b21\u662f binlog \u843d\u76d8\uff0c\u6240\u4ee5\u8fd9\u4f1a\u6210\u4e3a\u6027\u80fd\u74f6\u9888\u3002 \u4e3a\u4ec0\u4e48\u9501\u7ade\u4e89\u6fc0\u70c8\uff1f \u5728\u65e9\u671f\u7684 MySQL \u7248\u672c\u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528 prepare_commit_mutex \u9501\u6765\u4fdd\u8bc1\u4e8b\u52a1\u63d0\u4ea4\u7684\u987a\u5e8f\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u5230\u9501\u65f6\u624d\u80fd\u8fdb\u5165 prepare \u9636\u6bb5\uff0c\u4e00\u76f4\u5230 commit \u9636\u6bb5\u7ed3\u675f\u624d\u80fd\u91ca\u653e\u9501\uff0c\u4e0b\u4e2a\u4e8b\u52a1\u624d\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c prepare \u64cd\u4f5c\u3002 \u901a\u8fc7\u52a0\u9501\u867d\u7136\u5b8c\u7f8e\u5730\u89e3\u51b3\u4e86\u987a\u5e8f\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u4f46\u5728\u5e76\u53d1\u91cf\u8f83\u5927\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5bf9\u9501\u7684\u4e89\u7528\uff0c\u6027\u80fd\u4e0d\u4f73\u3002 \u7ec4\u63d0\u4ea4 \u00b6 MySQL \u5f15\u5165\u4e86 binlog \u7ec4\u63d0\u4ea4\uff08group commit\uff09\u673a\u5236\uff0c\u5f53\u6709\u591a\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u591a\u4e2a binlog \u5237\u76d8\u64cd\u4f5c\u5408\u5e76\u6210\u4e00\u4e2a\uff0c\u4ece\u800c\u51cf\u5c11\u78c1\u76d8 I/O \u7684\u6b21\u6570 \uff0c\u5982\u679c\u8bf4 10 \u4e2a\u4e8b\u52a1\u4f9d\u6b21\u6392\u961f\u5237\u76d8\u7684\u65f6\u95f4\u6210\u672c\u662f 10\uff0c\u90a3\u4e48\u5c06\u8fd9 10 \u4e2a\u4e8b\u52a1\u4e00\u6b21\u6027\u4e00\u8d77\u5237\u76d8\u7684\u65f6\u95f4\u6210\u672c\u5219\u8fd1\u4f3c\u4e8e 1\u3002 \u5f15\u5165\u4e86\u7ec4\u63d0\u4ea4\u673a\u5236\u540e\uff0cprepare \u9636\u6bb5\u4e0d\u53d8\uff0c\u53ea\u9488\u5bf9 commit \u9636\u6bb5\uff0c\u5c06 commit \u9636\u6bb5\u62c6\u5206\u4e3a\u4e09\u4e2a\u8fc7\u7a0b\uff1a flush \u9636\u6bb5 \uff1a\u591a\u4e2a\u4e8b\u52a1\u6309\u8fdb\u5165\u7684\u987a\u5e8f\u5c06 binlog \u4ece cache \u5199\u5165\u6587\u4ef6\uff08\u4e0d\u5237\u76d8\uff09\uff1b sync \u9636\u6bb5 \uff1a\u5bf9 binlog \u6587\u4ef6\u505a fsync \u64cd\u4f5c\uff08\u591a\u4e2a\u4e8b\u52a1\u7684 binlog \u5408\u5e76\u4e00\u6b21\u5237\u76d8\uff09\uff1b commit \u9636\u6bb5 \uff1a\u5404\u4e2a\u4e8b\u52a1\u6309\u987a\u5e8f\u505a InnoDB commit \u64cd\u4f5c\uff1b \u4e0a\u9762\u7684**\u6bcf\u4e2a\u9636\u6bb5\u90fd\u6709\u4e00\u4e2a\u961f\u5217**\uff0c\u6bcf\u4e2a\u9636\u6bb5\u6709\u9501\u8fdb\u884c\u4fdd\u62a4\uff0c\u56e0\u6b64\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u5199\u5165\u7684\u987a\u5e8f\uff0c\u7b2c\u4e00\u4e2a\u8fdb\u5165\u961f\u5217\u7684\u4e8b\u52a1\u4f1a\u6210\u4e3a leader\uff0cleader\u9886\u5bfc\u6240\u5728\u961f\u5217\u7684\u6240\u6709\u4e8b\u52a1\uff0c\u5168\u6743\u8d1f\u8d23\u6574\u961f\u7684\u64cd\u4f5c\uff0c\u5b8c\u6210\u540e\u901a\u77e5\u961f\u5185\u5176\u4ed6\u4e8b\u52a1\u64cd\u4f5c\u7ed3\u675f\u3002 \u5bf9\u6bcf\u4e2a\u9636\u6bb5\u5f15\u5165\u4e86\u961f\u5217\u540e\uff0c\u9501\u5c31\u53ea\u9488\u5bf9\u6bcf\u4e2a\u961f\u5217\u8fdb\u884c\u4fdd\u62a4\uff0c\u4e0d\u518d\u9501\u4f4f\u63d0\u4ea4\u4e8b\u52a1\u7684\u6574\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u7684\u51fa\u6765\uff0c \u9501\u7c92\u5ea6\u51cf\u5c0f\u4e86\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u591a\u4e2a\u9636\u6bb5\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\uff0c\u4ece\u800c\u63d0\u5347\u6548\u7387 \u3002 \u6709 binlog \u7ec4\u63d0\u4ea4\uff0c\u90a3\u6709 redo log \u7ec4\u63d0\u4ea4\u5417\uff1f \u8fd9\u4e2a\u8981\u770b MySQL \u7248\u672c\uff0cMySQL 5.6 \u6ca1\u6709 redo log \u7ec4\u63d0\u4ea4\uff0cMySQL 5.7 \u6709 redo log \u7ec4\u63d0\u4ea4\u3002 \u5728 MySQL 5.6 \u7684\u7ec4\u63d0\u4ea4\u903b\u8f91\u4e2d\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u5404\u81ea\u6267\u884c prepare \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u5404\u81ea\u5c06 redo log \u5237\u76d8\uff0c\u8fd9\u6837\u5c31\u6ca1\u529e\u6cd5\u5bf9 redo log \u8fdb\u884c\u7ec4\u63d0\u4ea4\u3002 \u6240\u4ee5\u5728 MySQL 5.7 \u7248\u672c\u4e2d\uff0c\u505a\u4e86\u4e2a\u6539\u8fdb\uff0c\u5728 prepare \u9636\u6bb5\u4e0d\u518d\u8ba9\u4e8b\u52a1\u5404\u81ea\u6267\u884c redo log \u5237\u76d8\u64cd\u4f5c\uff0c\u800c\u662f\u63a8\u8fdf\u5230\u7ec4\u63d0\u4ea4\u7684 flush \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u8bf4 prepare \u9636\u6bb5\u878d\u5408\u5728\u4e86 flush \u9636\u6bb5\u3002 \u8fd9\u4e2a\u4f18\u5316\u662f\u5c06 redo log \u7684\u5237\u76d8\u5ef6\u8fdf\u5230\u4e86 flush \u9636\u6bb5\u4e4b\u4e2d\uff0csync \u9636\u6bb5\u4e4b\u524d\u3002\u901a\u8fc7\u5ef6\u8fdf\u5199 redo log \u7684\u65b9\u5f0f\uff0c\u4e3a redolog \u505a\u4e86\u4e00\u6b21\u7ec4\u5199\u5165\uff0c\u8fd9\u6837 binlog \u548c redo log \u90fd\u8fdb\u884c\u4e86\u4f18\u5316\u3002 \u63a5\u4e0b\u6765\u4ecb\u7ecd\u6bcf\u4e2a\u9636\u6bb5\u7684\u8fc7\u7a0b\uff0c\u6ce8\u610f\u4e0b\u9762\u7684\u8fc7\u7a0b\u9488\u5bf9\u7684\u662f\u201c\u53cc 1\u201d \u914d\u7f6e\uff08sync_binlog \u548c innodb_flush_log_at_trx_commit \u90fd\u914d\u7f6e\u4e3a 1\uff09\u3002 flush \u9636\u6bb5 \u7b2c\u4e00\u4e2a\u4e8b\u52a1\u4f1a\u6210\u4e3a flush \u9636\u6bb5\u7684 Leader\uff0c\u6b64\u65f6\u540e\u9762\u5230\u6765\u7684\u4e8b\u52a1\u90fd\u662f Follower \uff1a \u63a5\u7740\uff0c\u83b7\u53d6\u961f\u5217\u4e2d\u7684\u4e8b\u52a1\u7ec4\uff0c\u7531\u7eff\u8272\u4e8b\u52a1\u7ec4\u7684 Leader \u5bf9 rodo log \u505a\u4e00\u6b21 write + fsync\uff0c\u5373\u4e00\u6b21\u5c06\u540c\u7ec4\u4e8b\u52a1\u7684 redolog \u5237\u76d8\uff1a \u5b8c\u6210\u4e86 prepare \u9636\u6bb5\u540e\uff0c\u5c06\u7eff\u8272\u8fd9\u4e00\u7ec4\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684 binlog \u5199\u5165 binlog \u6587\u4ef6\uff08\u8c03\u7528 write\uff0c\u4e0d\u4f1a\u8c03\u7528 fsync\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5237\u76d8\uff0cbinlog \u7f13\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff09\u3002 \u4ece\u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u77e5\u9053 flush \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f**\u7528\u4e8e\u652f\u6491 redo log \u7684\u7ec4\u63d0\u4ea4**\u3002 \u5982\u679c\u5728\u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7531\u4e8e binlog \u4e2d\u6ca1\u6709\u8be5\u7ec4\u4e8b\u52a1\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5 MySQL \u4f1a\u5728\u91cd\u542f\u540e\u56de\u6eda\u8be5\u7ec4\u4e8b\u52a1\u3002 sync \u9636\u6bb5 \u7eff\u8272\u8fd9\u4e00\u7ec4\u4e8b\u52a1\u7684 binlog \u5199\u5165\u5230 binlog \u6587\u4ef6\u540e\uff0c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u6267\u884c\u5237\u76d8\u7684\u64cd\u4f5c\uff0c\u800c\u662f**\u4f1a\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4**\uff0c\u8fd9\u4e2a\u7b49\u5f85\u7684\u65f6\u957f\u7531 Binlog_group_commit_sync_delay \u53c2\u6570\u63a7\u5236\uff0c \u76ee\u7684\u662f\u4e3a\u4e86\u7ec4\u5408\u66f4\u591a\u4e8b\u52a1\u7684 binlog\uff0c\u7136\u540e\u518d\u4e00\u8d77\u5237\u76d8 \uff0c\u5982\u4e0b\u8fc7\u7a0b\uff1a \u4e0d\u8fc7\uff0c\u5728\u7b49\u5f85\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e8b\u52a1\u7684\u6570\u91cf\u63d0\u524d\u8fbe\u5230\u4e86 Binlog_group_commit_sync_no_delay_count \u53c2\u6570\u8bbe\u7f6e\u7684\u503c\uff0c\u5c31\u4e0d\u7528\u7ee7\u7eed\u7b49\u5f85\u4e86\uff0c\u5c31\u9a6c\u4e0a\u5c06 binlog \u5237\u76d8\uff0c\u5982\u4e0b\u56fe\uff1a \u4ece\u4e0a\u9762\u7684\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u77e5\u9053 sync \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f**\u7528\u4e8e\u652f\u6301 binlog \u7684\u7ec4\u63d0\u4ea4**\u3002 \u5982\u679c\u60f3\u63d0\u5347 binlog \u7ec4\u63d0\u4ea4\u7684\u6548\u679c\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u6765\u5b9e\u73b0\uff1a binlog_group_commit_sync_delay= N \uff0c\u8868\u793a\u5728\u7b49\u5f85 N \u5fae\u5999\u540e\uff0c\u76f4\u63a5\u8c03\u7528 fsync\uff0c\u5c06\u5904\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d page cache \u4e2d\u7684 binlog \u5237\u76d8\uff0c\u4e5f\u5c31\u662f\u5c06\u300c binlog \u6587\u4ef6\u300d\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 binlog_group_commit_sync_no_delay_count = N \uff0c\u8868\u793a\u5982\u679c\u961f\u5217\u4e2d\u7684\u4e8b\u52a1\u6570\u8fbe\u5230 N \u4e2a\uff0c\u5c31\u5ffd\u89c6binlog_group_commit_sync_delay \u7684\u8bbe\u7f6e\uff0c\u76f4\u63a5\u8c03\u7528 fsync\uff0c\u5c06\u5904\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d page cache \u4e2d\u7684 binlog \u5237\u76d8\u3002 \u5982\u679c\u5728\u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7531\u4e8e binlog \u4e2d\u5df2\u7ecf\u6709\u4e86\u4e8b\u52a1\u8bb0\u5f55\uff0cMySQL\u4f1a\u5728\u91cd\u542f\u540e\u901a\u8fc7 redo log \u5237\u76d8\u7684\u6570\u636e\u7ee7\u7eed\u8fdb\u884c\u4e8b\u52a1\u7684\u63d0\u4ea4\u3002 commit \u9636\u6bb5 \u6700\u540e\u8fdb\u5165 commit \u9636\u6bb5\uff0c\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\u3002 commit \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f\u627f\u63a5 sync \u9636\u6bb5\u7684\u4e8b\u52a1\uff0c\u5b8c\u6210\u6700\u540e\u7684\u5f15\u64ce\u63d0\u4ea4\uff0c\u4f7f\u5f97 sync \u53ef\u4ee5\u5c3d\u65e9\u7684\u5904\u7406\u4e0b\u4e00\u7ec4\u4e8b\u52a1\uff0c\u6700\u5927\u5316\u7ec4\u63d0\u4ea4\u7684\u6548\u7387\u3002 MySQL \u78c1\u76d8 I/O \u5f88\u9ad8\uff0c\u6709\u4ec0\u4e48\u4f18\u5316\u7684\u65b9\u6cd5\uff1f \u00b6 \u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e8b\u52a1\u5728\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u9700\u8981\u5c06 binlog \u548c redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u90a3\u4e48\u5982\u679c\u51fa\u73b0 MySQL \u78c1\u76d8 I/O \u5f88\u9ad8\u7684\u73b0\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u4ee5\u4e0b\u53c2\u6570\uff0c\u6765 \u201c\u5ef6\u8fdf\u201d binlog \u548c redo log \u5237\u76d8\u7684\u65f6\u673a\uff0c\u4ece\u800c\u964d\u4f4e\u78c1\u76d8 I/O \u7684\u9891\u7387\uff1a \u8bbe\u7f6e\u7ec4\u63d0\u4ea4\u7684\u4e24\u4e2a\u53c2\u6570\uff1a binlog_group_commit_sync_delay \u548c binlog_group_commit_sync_no_delay_count \u53c2\u6570\uff0c\u5ef6\u8fdf binlog \u5237\u76d8\u7684\u65f6\u673a\uff0c\u4ece\u800c\u51cf\u5c11 binlog \u7684\u5237\u76d8\u6b21\u6570\u3002\u8fd9\u4e2a\u65b9\u6cd5\u662f\u57fa\u4e8e\u201c\u989d\u5916\u7684\u6545\u610f\u7b49\u5f85\u201d\u6765\u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u589e\u52a0\u8bed\u53e5\u7684\u54cd\u5e94\u65f6\u95f4\uff0c\u4f46\u5373\u4f7f MySQL \u8fdb\u7a0b\u4e2d\u9014\u6302\u4e86\uff0c\u4e5f\u6ca1\u6709\u4e22\u5931\u6570\u636e\u7684\u98ce\u9669\uff0c\u56e0\u4e3a binlog \u65e9\u88ab\u5199\u5165\u5230 page cache \u4e86\uff0c\u53ea\u8981\u7cfb\u7edf\u6ca1\u6709\u5b95\u673a\uff0c\u7f13\u5b58\u5728 page cache \u91cc\u7684 binlog \u5c31\u4f1a\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u5c06 sync_binlog \u8bbe\u7f6e\u4e3a\u5927\u4e8e 1 \u7684\u503c\uff08\u6bd4\u8f83\u5e38\u89c1\u662f 100~1000\uff09\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd write\uff0c\u4f46\u7d2f\u79ef N \u4e2a\u4e8b\u52a1\u540e\u624d fsync\uff0c\u76f8\u5f53\u4e8e\u5ef6\u8fdf\u4e86 binlog \u5237\u76d8\u7684\u65f6\u673a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u98ce\u9669\u662f\uff0c\u4e3b\u673a\u6389\u7535\u65f6\u4f1a\u4e22 N \u4e2a\u4e8b\u52a1\u7684 binlog \u65e5\u5fd7\u3002 \u5c06 innodb_flush_log_at_trx_commit \u8bbe\u7f6e\u4e3a 2\u3002\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u53ea\u662f\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u5199\u5230 redo log \u6587\u4ef6\uff0c\u6ce8\u610f\u5199\u5165\u5230\u300c redo log \u6587\u4ef6\u300d\u5e76\u4e0d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u78c1\u76d8\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u4e2a Page Cache\uff0c\u4e13\u95e8\u7528\u6765\u7f13\u5b58\u6587\u4ef6\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5199\u5165\u300c redo log\u6587\u4ef6\u300d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7f13\u5b58\uff0c\u7136\u540e\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u65f6\u673a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u98ce\u9669\u662f\uff0c\u4e3b\u673a\u6389\u7535\u7684\u65f6\u5019\u4f1a\u4e22\u6570\u636e\u3002 \u603b\u7ed3 \u00b6 \u5177\u4f53\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55 UPDATE t_user SET name = 'xiaolin' WHERE id = 1; \u7684\u6d41\u7a0b\u5982\u4e0b: \u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u4f1a\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\uff0c\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u6811\u641c\u7d22\u83b7\u53d6 id = 1 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1a \u5982\u679c id=1 \u8fd9\u4e00\u884c\u6240\u5728\u7684\u6570\u636e\u9875\u672c\u6765\u5c31\u5728 buffer pool \u4e2d\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7ed9\u6267\u884c\u5668\u66f4\u65b0\uff1b \u5982\u679c\u8bb0\u5f55\u4e0d\u5728 buffer pool\uff0c\u5c06\u6570\u636e\u9875\u4ece\u78c1\u76d8\u8bfb\u5165\u5230 buffer pool\uff0c\u8fd4\u56de\u8bb0\u5f55\u7ed9\u6267\u884c\u5668\u3002 \u6267\u884c\u5668\u5f97\u5230\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u540e\uff0c\u4f1a\u770b\u4e00\u4e0b\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u662f\u5426\u4e00\u6837\uff1a \u5982\u679c\u4e00\u6837\u7684\u8bdd\u5c31\u4e0d\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u6d41\u7a0b\uff1b \u5982\u679c\u4e0d\u4e00\u6837\u7684\u8bdd\u5c31\u628a\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u90fd\u5f53\u4f5c\u53c2\u6570\u4f20\u7ed9 InnoDB \u5c42\uff0c\u8ba9 InnoDB \u771f\u6b63\u7684\u6267\u884c\u66f4\u65b0\u8bb0\u5f55\u7684\u64cd\u4f5c\uff1b \u5f00\u542f\u4e8b\u52a1\uff0c InnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u56e0\u4e3a\u8fd9\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\uff0c\u4e0d\u8fc7\u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log\u3002 InnoDB \u5c42\u5f00\u59cb\u66f4\u65b0\u8bb0\u5f55\uff0c\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u5199\u5230 redo log \u91cc\u9762\uff0c\u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86\u3002\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002\u8fd9\u5c31\u662f WAL \u6280\u672f \uff0cMySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199 redo \u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5c06\u4fee\u6539\u7684\u884c\u6570\u636e\u5199\u5230\u78c1\u76d8\u4e0a\u3002 \u81f3\u6b64\uff0c\u4e00\u6761\u8bb0\u5f55\u66f4\u65b0\u5b8c\u4e86\u3002 \u5728\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7136\u540e\u5f00\u59cb\u8bb0\u5f55\u8be5\u8bed\u53e5\u5bf9\u5e94\u7684 binlog\uff0c\u6b64\u65f6\u8bb0\u5f55\u7684 binlog \u4f1a\u88ab\u4fdd\u5b58\u5230 binlog cache\uff0c\u5e76\u6ca1\u6709\u5237\u65b0\u5230\u786c\u76d8\u4e0a\u7684 binlog \u6587\u4ef6\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u624d\u4f1a\u7edf\u4e00\u5c06\u8be5\u4e8b\u52a1\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709 binlog \u5237\u65b0\u5230\u786c\u76d8\u3002 \u4e8b\u52a1\u63d0\u4ea4\uff08\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\uff0c\u8fd9\u91cc\u4e0d\u8bf4\u7ec4\u63d0\u4ea4\u7684\u8fc7\u7a0b\uff0c\u53ea\u8bf4\u4e24\u9636\u6bb5\u63d0\u4ea4\uff09\uff1a prepare \u9636\u6bb5 \uff1a\u5c06 redo log \u5bf9\u5e94\u7684\u4e8b\u52a1\u72b6\u6001\u8bbe\u7f6e\u4e3a prepare\uff0c\u7136\u540e\u5c06 redo log \u5237\u65b0\u5230\u786c\u76d8\uff1b commit \u9636\u6bb5 \uff1a\u5c06 binlog \u5237\u65b0\u5230\u78c1\u76d8\uff0c\u63a5\u7740\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\uff08\u5c06\u4e8b\u52a1\u8bbe\u7f6e\u4e3a commit \u72b6\u6001\u540e\uff0c\u5237\u5165\u5230\u78c1\u76d8 redo log \u6587\u4ef6\uff09\uff1b \u81f3\u6b64\uff0c\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u3002 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL 45 \u8bb2\u300b \u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\uff1f\u300b https://developer.aliyun.com/article/617776 http://mysql.taobao.org/monthly/2021/10/01/ https://www.cnblogs.com/Neeo/articles/13883976.html https://www.cnblogs.com/mengxinJ/p/14211427.html \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u65e5\u5fd7\uff1aundo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f"},{"location":"mysql/log/how_update/#mysql-undo-logredo-logbinlog","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u4ece\u8fd9\u7bc7\u300c \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \u300d\u4e2d\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u6761\u67e5\u8be2\u8bed\u53e5\u7ecf\u5386\u7684\u8fc7\u7a0b\uff0c\u8fd9\u5c5e\u4e8e\u300c\u8bfb\u300d\u4e00\u6761\u8bb0\u5f55\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a \u90a3\u4e48\uff0c \u6267\u884c\u4e00\u6761 update \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f \uff0c\u6bd4\u5982\u8fd9\u4e00\u6761 update \u8bed\u53e5\uff1a UPDATE t_user SET name = 'xiaolin' WHERE id = 1 ; \u67e5\u8be2\u8bed\u53e5\u7684\u90a3\u4e00\u5957\u6d41\u7a0b\uff0c\u66f4\u65b0\u8bed\u53e5\u4e5f\u662f\u540c\u6837\u4f1a\u8d70\u4e00\u904d\uff1a \u5ba2\u6237\u7aef\u5148\u901a\u8fc7\u8fde\u63a5\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u8fde\u63a5\u5668\u81ea\u4f1a\u5224\u65ad\u7528\u6237\u8eab\u4efd\uff1b \u56e0\u4e3a\u8fd9\u662f\u4e00\u6761 update \u8bed\u53e5\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u7ecf\u8fc7\u67e5\u8be2\u7f13\u5b58\uff0c\u4f46\u662f\u8868\u4e0a\u6709\u66f4\u65b0\u8bed\u53e5\uff0c\u662f\u4f1a\u628a\u6574\u4e2a\u8868\u7684\u67e5\u8be2\u7f13\u5b58\u6e05\u7a7a\u7684\uff0c\u6240\u4ee5\u8bf4\u67e5\u8be2\u7f13\u5b58\u5f88\u9e21\u808b\uff0c\u5728 MySQL 8.0 \u5c31\u88ab\u79fb\u9664\u8fd9\u4e2a\u529f\u80fd\u4e86\uff1b \u89e3\u6790\u5668\u4f1a\u901a\u8fc7\u8bcd\u6cd5\u5206\u6790\u8bc6\u522b\u51fa\u5173\u952e\u5b57 update\uff0c\u8868\u540d\u7b49\u7b49\uff0c\u6784\u5efa\u51fa\u8bed\u6cd5\u6811\uff0c\u63a5\u7740\u8fd8\u4f1a\u505a\u8bed\u6cd5\u5206\u6790\uff0c\u5224\u65ad\u8f93\u5165\u7684\u8bed\u53e5\u662f\u5426\u7b26\u5408 MySQL \u8bed\u6cd5\uff1b \u9884\u5904\u7406\u5668\u4f1a\u5224\u65ad\u8868\u548c\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b \u4f18\u5316\u5668\u786e\u5b9a\u6267\u884c\u8ba1\u5212\uff0c\u56e0\u4e3a where \u6761\u4ef6\u4e2d\u7684 id \u662f\u4e3b\u952e\u7d22\u5f15\uff0c\u6240\u4ee5\u51b3\u5b9a\u8981\u4f7f\u7528 id \u8fd9\u4e2a\u7d22\u5f15\uff1b \u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u627e\u5230\u8fd9\u4e00\u884c\uff0c\u7136\u540e\u66f4\u65b0\u3002 \u4e0d\u8fc7\uff0c\u66f4\u65b0\u8bed\u53e5\u7684\u6d41\u7a0b\u4f1a\u6d89\u53ca\u5230 undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\u3001redo log\uff08\u91cd\u505a\u65e5\u5fd7\uff09 \u3001binlog \uff08\u5f52\u6863\u65e5\u5fd7\uff09\u8fd9\u4e09\u79cd\u65e5\u5fd7\uff1a undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09 \uff1a\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u5b9e\u73b0\u4e86\u4e8b\u52a1\u4e2d\u7684**\u539f\u5b50\u6027**\uff0c\u4e3b\u8981**\u7528\u4e8e\u4e8b\u52a1\u56de\u6eda\u548c MVCC**\u3002 redo log\uff08\u91cd\u505a\u65e5\u5fd7\uff09 \uff1a\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u5b9e\u73b0\u4e86\u4e8b\u52a1\u4e2d\u7684**\u6301\u4e45\u6027**\uff0c\u4e3b\u8981**\u7528\u4e8e\u6389\u7535\u7b49\u6545\u969c\u6062\u590d**\uff1b binlog \uff08\u5f52\u6863\u65e5\u5fd7\uff09 \uff1a\u662f Server \u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u4e3b\u8981**\u7528\u4e8e\u6570\u636e\u5907\u4efd\u548c\u4e3b\u4ece\u590d\u5236**\uff1b \u6240\u4ee5\u8fd9\u6b21\u5c31\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u770b\u770b\u8fd9\u4e09\u79cd\u65e5\u5fd7\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002","title":"MySQL \u65e5\u5fd7\uff1aundo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f"},{"location":"mysql/log/how_update/#undo-log","text":"\u6211\u4eec\u5728\u6267\u884c\u6267\u884c\u4e00\u6761\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u867d\u7136\u6ca1\u6709\u8f93\u5165 begin \u5f00\u542f\u4e8b\u52a1\u548c commit \u63d0\u4ea4\u4e8b\u52a1\uff0c\u4f46\u662f MySQL \u4f1a**\u9690\u5f0f\u5f00\u542f\u4e8b\u52a1**\u6765\u6267\u884c\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u7684\uff0c\u6267\u884c\u5b8c\u5c31\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1\u7684\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u6267\u884c\u5b8c\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53ca\u65f6\u5728\u6570\u636e\u5e93\u8868\u770b\u5230\u201c\u589e\u5220\u6539\u201d\u7684\u7ed3\u679c\u4e86\u3002 \u6267\u884c\u4e00\u6761\u8bed\u53e5\u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1\uff0c\u662f\u7531 autocommit \u53c2\u6570\u51b3\u5b9a\u7684\uff0c\u9ed8\u8ba4\u662f\u5f00\u542f\u3002\u6240\u4ee5\uff0c\u6267\u884c\u4e00\u6761 update \u8bed\u53e5\u4e5f\u662f\u4f1a\u4f7f\u7528\u4e8b\u52a1\u7684\u3002 \u90a3\u4e48\uff0c\u8003\u8651\u4e00\u4e2a\u95ee\u9898\u3002\u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5728\u8fd8\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\u4e4b\u524d\uff0c\u5982\u679cMySQL \u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u8981\u600e\u4e48\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\u5462\uff1f \u5982\u679c\u6211\u4eec\u6bcf\u6b21\u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u8bb0\u5f55\u4e0b\u56de\u6eda\u65f6\u9700\u8981\u7684\u4fe1\u606f\u5230\u4e00\u4e2a\u65e5\u5fd7\u91cc\uff0c\u90a3\u4e48\u5728\u4e8b\u52a1\u6267\u884c\u4e2d\u9014\u53d1\u751f\u4e86 MySQL \u5d29\u6e83\u540e\uff0c\u5c31\u4e0d\u7528\u62c5\u5fc3\u65e0\u6cd5\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u65e5\u5fd7\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\u3002 \u5b9e\u73b0\u8fd9\u4e00\u673a\u5236\u5c31\u662f undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\uff0c\u5b83\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u7684 ACID \u7279\u6027 \u4e2d\u7684\u539f\u5b50\u6027\uff08Atomicity\uff09 \u3002 undo log \u662f\u4e00\u79cd\u7528\u4e8e\u64a4\u9500\u56de\u9000\u7684\u65e5\u5fd7\u3002\u5728\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u4e4b\u524d\uff0cMySQL \u4f1a\u5148\u8bb0\u5f55\u66f4\u65b0\u524d\u7684\u6570\u636e\u5230 undo log \u65e5\u5fd7\u6587\u4ef6\u91cc\u9762\uff0c\u5f53\u4e8b\u52a1\u56de\u6eda\u65f6\uff0c\u53ef\u4ee5\u5229\u7528 undo log \u6765\u8fdb\u884c\u56de\u6eda\u3002\u5982\u4e0b\u56fe\uff1a \u6bcf\u5f53 InnoDB \u5f15\u64ce\u5bf9\u4e00\u6761\u8bb0\u5f55\u8fdb\u884c\u64cd\u4f5c\uff08\u4fee\u6539\u3001\u5220\u9664\u3001\u65b0\u589e\uff09\u65f6\uff0c\u8981\u628a\u56de\u6eda\u65f6\u9700\u8981\u7684\u4fe1\u606f\u90fd\u8bb0\u5f55\u5230 undo log \u91cc\uff0c\u6bd4\u5982\uff1a \u5728**\u63d2\u5165**\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u53ea\u9700\u8981\u628a\u8fd9\u4e2a\u4e3b\u952e\u503c\u5bf9\u5e94\u7684\u8bb0\u5f55**\u5220\u6389**\u5c31\u597d\u4e86\uff1b \u5728**\u5220\u9664**\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u8fd9\u6761\u8bb0\u5f55\u4e2d\u7684\u5185\u5bb9\u90fd\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u518d\u628a\u7531\u8fd9\u4e9b\u5185\u5bb9\u7ec4\u6210\u7684\u8bb0\u5f55**\u63d2\u5165**\u5230\u8868\u4e2d\u5c31\u597d\u4e86\uff1b \u5728**\u66f4\u65b0**\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u518d\u628a\u8fd9\u4e9b\u5217**\u66f4\u65b0\u4e3a\u65e7\u503c**\u5c31\u597d\u4e86\u3002 \u5728\u53d1\u751f\u56de\u6eda\u65f6\uff0c\u5c31\u8bfb\u53d6 undo log \u91cc\u7684\u6570\u636e\uff0c\u7136\u540e\u505a\u539f\u5148\u76f8\u53cd\u64cd\u4f5c\u3002\u6bd4\u5982\u5f53 delete \u4e00\u6761\u8bb0\u5f55\u65f6\uff0cundo log \u4e2d\u4f1a\u628a\u8bb0\u5f55\u4e2d\u7684\u5185\u5bb9\u90fd\u8bb0\u4e0b\u6765\uff0c\u7136\u540e\u6267\u884c\u56de\u6eda\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5c31\u8bfb\u53d6 undo log \u91cc\u7684\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c insert \u64cd\u4f5c\u3002 \u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u8bb0\u5f55\u7684\u5185\u5bb9\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u4e0d\u540c\u7c7b\u578b\u7684\u64cd\u4f5c\uff08\u4fee\u6539\u3001\u5220\u9664\u3001\u65b0\u589e\uff09\u4ea7\u751f\u7684 undo log \u7684\u683c\u5f0f\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u5177\u4f53\u7684\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u7684 undo log \u7684\u683c\u5f0f\u6211\u5c31\u4e0d\u8be6\u7ec6\u4ecb\u7ecd\u4e86\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u53bb\u67e5\u67e5\u3002 \u4e00\u6761\u8bb0\u5f55\u7684\u6bcf\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u4ea7\u751f\u7684 undo log \u683c\u5f0f\u90fd\u6709\u4e00\u4e2a roll_pointer \u6307\u9488\u548c\u4e00\u4e2a trx_id \u4e8b\u52a1id\uff1a \u901a\u8fc7 trx_id \u53ef\u4ee5\u77e5\u9053\u8be5\u8bb0\u5f55\u662f\u88ab\u54ea\u4e2a\u4e8b\u52a1\u4fee\u6539\u7684\uff1b \u901a\u8fc7 roll_pointer \u6307\u9488\u53ef\u4ee5\u5c06\u8fd9\u4e9b undo log \u4e32\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u8fd9\u4e2a\u94fe\u8868\u5c31\u88ab\u79f0\u4e3a\u7248\u672c\u94fe\uff1b \u7248\u672c\u94fe\u5982\u4e0b\u56fe\uff1a \u53e6\u5916\uff0c undo log \u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\uff0c\u901a\u8fc7 ReadView + undo log \u5b9e\u73b0 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09 \u3002 \u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u7684\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\u662f\u901a\u8fc7 Read View + undo log \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff1a \u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u4e2a select \u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View\uff0c\u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u6570\u636e\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002 \u8fd9\u4e24\u4e2a\u9694\u79bb\u7ea7\u522b\u5b9e\u73b0\u662f\u901a\u8fc7\u300c\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u5b57\u6bb5\u300d\u548c\u300c\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\uff08trx_id \u548c roll_pointer\uff09\u300d\u7684\u6bd4\u5bf9\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\u53ef\u89c1\u884c\uff0c\u5c31\u4f1a\u987a\u7740 undo log \u7248\u672c\u94fe\u91cc\u627e\u5230\u6ee1\u8db3\u5176\u53ef\u89c1\u6027\u7684\u8bb0\u5f55\uff0c\u4ece\u800c\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\uff0c\u8fd9\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a \u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f \u56e0\u6b64\uff0cundo log \u4e24\u5927\u4f5c\u7528\uff1a \u5b9e\u73b0\u4e8b\u52a1\u56de\u6eda\uff0c\u4fdd\u969c\u4e8b\u52a1\u7684\u539f\u5b50\u6027 \u3002\u4e8b\u52a1\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u9519\u8bef\u6216\u8005\u7528\u6237\u6267 \u884c\u4e86 ROLLBACK \u8bed\u53e5\uff0cMySQL \u53ef\u4ee5\u5229\u7528 undo log \u4e2d\u7684\u5386\u53f2\u6570\u636e\u5c06\u6570\u636e\u6062\u590d\u5230\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u7684\u72b6\u6001\u3002 \u5b9e\u73b0 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5173\u952e\u56e0\u7d20\u4e4b\u4e00 \u3002MVCC \u662f\u901a\u8fc7 ReadView + undo log \u5b9e\u73b0\u7684\u3002undo log \u4e3a\u6bcf\u6761\u8bb0\u5f55\u4fdd\u5b58\u591a\u4efd\u5386\u53f2\u6570\u636e\uff0cMySQL \u5728\u6267\u884c\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u4fe1\u606f\uff0c\u987a\u7740 undo log \u7684\u7248\u672c\u94fe\u627e\u5230\u6ee1\u8db3\u5176\u53ef\u89c1\u6027\u7684\u8bb0\u5f55\u3002","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 undo log\uff1f"},{"location":"mysql/log/how_update/#buffer-pool","text":"MySQL \u7684\u6570\u636e\u90fd\u662f\u5b58\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5f97\u5148\u8981\u4ece\u78c1\u76d8\u8bfb\u53d6\u8be5\u8bb0\u5f55\uff0c\u7136\u540e\u5728\u5185\u5b58\u4e2d\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u3002\u90a3\u4fee\u6539\u5b8c\u8fd9\u6761\u8bb0\u5f55\u662f\u9009\u62e9\u76f4\u63a5\u5199\u56de\u5230\u78c1\u76d8\uff0c\u8fd8\u662f\u9009\u62e9\u7f13\u5b58\u8d77\u6765\u5462\uff1f \u5f53\u7136\u662f\u7f13\u5b58\u8d77\u6765\u597d\uff0c\u8fd9\u6837\u4e0b\u6b21\u6709\u67e5\u8be2\u8bed\u53e5\u547d\u4e2d\u4e86\u8fd9\u6761\u8bb0\u5f55\uff0c\u76f4\u63a5\u8bfb\u53d6\u7f13\u5b58\u4e2d\u7684\u8bb0\u5f55\uff0c\u5c31\u4e0d\u9700\u8981\u4ece\u78c1\u76d8\u83b7\u53d6\u6570\u636e\u4e86\u3002 \u4e3a\u6b64\uff0cInnodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a**\u7f13\u51b2\u6c60\uff08Buffer Pool\uff09**\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002 \u6709\u4e86 Buffer Poo \u540e\uff1a \u5f53\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u76f4\u63a5\u8bfb\u53d6 Buffer Pool \u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u518d\u53bb\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002 \u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u90a3\u76f4\u63a5\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff08\u8be5\u9875\u7684\u5185\u5b58\u6570\u636e\u548c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u4e00\u81f4\uff09\uff0c\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 Buffer Pool\uff1f"},{"location":"mysql/log/how_update/#buffer-pool_1","text":"InnoDB \u4f1a\u628a\u5b58\u50a8\u7684\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u300c\u9875\u300d\uff0c\u4ee5\u9875\u4f5c\u4e3a\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e00\u4e2a\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16KB\u3002\u56e0\u6b64\uff0cBuffer Pool \u540c\u6837\u9700\u8981\u6309\u300c\u9875\u300d\u6765\u5212\u5206\u3002 \u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0c InnoDB \u4f1a\u4e3a Buffer Pool \u7533\u8bf7\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u6309\u7167\u9ed8\u8ba4\u7684 16KB \u7684\u5927\u5c0f\u5212\u5206\u51fa\u4e00\u4e2a\u4e2a\u7684\u9875\uff0c Buffer Pool \u4e2d\u7684\u9875\u5c31\u53eb\u505a\u7f13\u5b58\u9875 \u3002\u6b64\u65f6\u8fd9\u4e9b\u7f13\u5b58\u9875\u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u4e4b\u540e\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u624d\u4f1a\u6709\u78c1\u76d8\u4e0a\u7684\u9875\u88ab\u7f13\u5b58\u5230 Buffer Pool \u4e2d\u3002 \u6240\u4ee5\uff0cMySQL \u521a\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u89c2\u5bdf\u5230\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\uff0c\u800c\u4f7f\u7528\u5230\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u5374\u5f88\u5c0f\uff0c\u8fd9\u662f\u56e0\u4e3a\u53ea\u6709\u8fd9\u4e9b\u865a\u62df\u5185\u5b58\u88ab\u8bbf\u95ee\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u7533\u8bf7\u7269\u7406\u5185\u5b58\uff0c\u63a5\u7740\u5c06\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u3002 Buffer Pool \u9664\u4e86\u7f13\u5b58\u300c\u7d22\u5f15\u9875\u300d\u548c\u300c\u6570\u636e\u9875\u300d\uff0c\u8fd8\u5305\u62ec\u4e86 Undo \u9875\uff0c\u63d2\u5165\u7f13\u5b58\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u3001\u9501\u4fe1\u606f\u7b49\u7b49\u3002 Undo \u9875\u662f\u8bb0\u5f55\u4ec0\u4e48\uff1f \u5f00\u542f\u4e8b\u52a1\u540e\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5982\u679c\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\u3002 \u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u53ea\u9700\u8981\u7f13\u51b2\u4e00\u6761\u8bb0\u5f55\u5417\uff1f \u4e0d\u662f\u7684\u3002 \u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\u65f6\uff0cInnoDB \u662f\u4f1a\u628a\u6574\u4e2a\u9875\u7684\u6570\u636e\u52a0\u8f7d\u5230 Buffer Pool \u4e2d\uff0c\u5c06\u9875\u52a0\u8f7d\u5230 Buffer Pool \u540e\uff0c\u518d\u901a\u8fc7\u9875\u91cc\u7684\u300c\u9875\u76ee\u5f55\u300d\u53bb\u5b9a\u4f4d\u5230\u67d0\u6761\u5177\u4f53\u7684\u8bb0\u5f55\u3002 \u5173\u4e8e\u9875\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\u548c\u7d22\u5f15\u600e\u4e48\u67e5\u8be2\u6570\u636e\u7684\u95ee\u9898\u53ef\u4ee5\u5728\u8fd9\u7bc7\u627e\u5230\u7b54\u6848\uff1a \u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811","title":"Buffer Pool \u7f13\u5b58\u4ec0\u4e48\uff1f"},{"location":"mysql/log/how_update/#redo-log","text":"Buffer Pool \u662f\u63d0\u9ad8\u4e86\u8bfb\u5199\u6548\u7387\u6ca1\u9519\uff0c\u4f46\u662f\u95ee\u9898\u6765\u4e86\uff0cBuffer Pool \u662f\u57fa\u4e8e\u5185\u5b58\u7684\uff0c\u800c\u5185\u5b58\u603b\u662f\u4e0d\u53ef\u9760\uff0c\u4e07\u4e00\u65ad\u7535\u91cd\u542f\uff0c\u8fd8\u6ca1\u6765\u5f97\u53ca\u843d\u76d8\u7684\u810f\u9875\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u4e3a\u4e86\u9632\u6b62\u65ad\u7535\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\uff0c\u5f53\u6709\u4e00\u6761\u8bb0\u5f55\u9700\u8981\u66f4\u65b0\u7684\u65f6\u5019\uff0cInnoDB \u5f15\u64ce\u5c31\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u672c\u6b21\u5bf9\u8fd9\u4e2a\u9875\u7684\u4fee\u6539\u4ee5 redo log \u7684\u5f62\u5f0f\u8bb0\u5f55\u4e0b\u6765\uff0c \u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86 \u3002 \u540e\u7eed\uff0cInnoDB \u5f15\u64ce\u4f1a\u5728\u9002\u5f53\u7684\u65f6\u5019\uff0c\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u7f13\u5b58\u5728 Buffer Pool \u7684\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u91cc\uff0c\u8fd9\u5c31\u662f WAL \uff08Write-Ahead Logging\uff09\u6280\u672f \u3002 WAL \u6280\u672f\u6307\u7684\u662f\uff0c MySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199\u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5199\u5230\u78c1\u76d8\u4e0a \u3002 \u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a \u4ec0\u4e48\u662f redo log\uff1f redo log \u662f\u7269\u7406\u65e5\u5fd7\uff0c\u8bb0\u5f55\u4e86\u67d0\u4e2a\u6570\u636e\u9875\u505a\u4e86\u4ec0\u4e48\u4fee\u6539\uff0c\u6bd4\u5982**\u5bf9 XXX \u8868\u7a7a\u95f4\u4e2d\u7684 YYY \u6570\u636e\u9875 ZZZ \u504f\u79fb\u91cf\u7684\u5730\u65b9\u505a\u4e86AAA \u66f4\u65b0**\uff0c\u6bcf\u5f53\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u5c31\u4f1a\u4ea7\u751f\u8fd9\u6837\u7684\u4e00\u6761\u6216\u8005\u591a\u6761\u7269\u7406\u65e5\u5fd7\u3002 \u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u53ea\u8981\u5148\u5c06 redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\u5373\u53ef\uff0c\u53ef\u4ee5\u4e0d\u9700\u8981\u7b49\u5230\u5c06\u7f13\u5b58\u5728 Buffer Pool \u91cc\u7684\u810f\u9875\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u5f53\u7cfb\u7edf\u5d29\u6e83\u65f6\uff0c\u867d\u7136\u810f\u9875\u6570\u636e\u6ca1\u6709\u6301\u4e45\u5316\uff0c\u4f46\u662f redo log \u5df2\u7ecf\u6301\u4e45\u5316\uff0c\u63a5\u7740 MySQL \u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u6839\u636e redo log \u7684\u5185\u5bb9\uff0c\u5c06\u6240\u6709\u6570\u636e\u6062\u590d\u5230\u6700\u65b0\u7684\u72b6\u6001\u3002 \u88ab\u4fee\u6539 Undo \u9875\u9762\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94 redo log \u5417\uff1f \u9700\u8981\u7684\u3002 \u5f00\u542f\u4e8b\u52a1\u540e\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5982\u679c\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\u3002 \u4e0d\u8fc7\uff0c \u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log \u3002 redo log \u548c undo log \u533a\u522b\u5728\u54ea\uff1f \u8fd9\u4e24\u79cd\u65e5\u5fd7\u662f\u5c5e\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u65e5\u5fd7\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\uff1a redo log \u8bb0\u5f55\u4e86\u6b64\u6b21\u4e8b\u52a1\u300c \u5b8c\u6210\u540e \u300d\u7684\u6570\u636e\u72b6\u6001\uff0c\u8bb0\u5f55\u7684\u662f\u66f4\u65b0**\u4e4b\u540e**\u7684\u503c\uff1b undo log \u8bb0\u5f55\u4e86\u6b64\u6b21\u4e8b\u52a1\u300c \u5f00\u59cb\u524d \u300d\u7684\u6570\u636e\u72b6\u6001\uff0c\u8bb0\u5f55\u7684\u662f\u66f4\u65b0**\u4e4b\u524d**\u7684\u503c\uff1b \u4e8b\u52a1\u63d0\u4ea4\u4e4b\u524d\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4f1a\u901a\u8fc7 undo log \u56de\u6eda\u4e8b\u52a1\uff0c\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4f1a\u901a\u8fc7 redo log \u6062\u590d\u4e8b\u52a1\uff0c\u5982\u4e0b\u56fe\uff1a \u6240\u4ee5\u6709\u4e86 redo log\uff0c\u518d\u901a\u8fc7 WAL \u6280\u672f\uff0cInnoDB \u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5373\u4f7f\u6570\u636e\u5e93\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u4e4b\u524d\u5df2\u63d0\u4ea4\u7684\u8bb0\u5f55\u90fd\u4e0d\u4f1a\u4e22\u5931\uff0c\u8fd9\u4e2a\u80fd\u529b\u79f0\u4e3a crash-safe \uff08\u5d29\u6e83\u6062\u590d\uff09\u3002\u53ef\u4ee5\u770b\u51fa\u6765\uff0c redo log \u4fdd\u8bc1\u4e86\u4e8b\u52a1\u56db\u5927\u7279\u6027\u4e2d\u7684\u6301\u4e45\u6027 \u3002 redo log \u8981\u5199\u5230\u78c1\u76d8\uff0c\u6570\u636e\u4e5f\u8981\u5199\u78c1\u76d8\uff0c\u4e3a\u4ec0\u4e48\u8981\u591a\u6b64\u4e00\u4e3e\uff1f \u5199\u5165 redo log \u7684\u65b9\u5f0f\u4f7f\u7528\u4e86\u8ffd\u52a0\u64cd\u4f5c\uff0c \u6240\u4ee5\u78c1\u76d8\u64cd\u4f5c\u662f**\u987a\u5e8f\u5199**\uff0c\u800c\u5199\u5165\u6570\u636e\u9700\u8981\u5148\u627e\u5230\u5199\u5165\u4f4d\u7f6e\uff0c\u7136\u540e\u624d\u5199\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u78c1\u76d8\u64cd\u4f5c\u662f**\u968f\u673a\u5199**\u3002 \u78c1\u76d8\u7684\u300c\u987a\u5e8f\u5199 \u300d\u6bd4\u300c\u968f\u673a\u5199\u300d \u9ad8\u6548\u7684\u591a\uff0c\u56e0\u6b64 redo log \u5199\u5165\u78c1\u76d8\u7684\u5f00\u9500\u66f4\u5c0f\u3002 \u9488\u5bf9\u300c\u987a\u5e8f\u5199\u300d\u4e3a\u4ec0\u4e48\u6bd4\u300c\u968f\u673a\u5199\u300d\u66f4\u5feb\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u6bd4\u55bb\u4e3a\u4f60\u6709\u4e00\u4e2a\u672c\u5b50\uff0c\u6309\u7167\u987a\u5e8f\u4e00\u9875\u4e00\u9875\u5199\u80af\u5b9a\u6bd4\u5199\u4e00\u4e2a\u5b57\u90fd\u8981\u627e\u5230\u5bf9\u5e94\u9875\u5199\u5feb\u5f97\u591a\u3002 \u53ef\u4ee5\u8bf4\u8fd9\u662f WAL \u6280\u672f\u7684\u53e6\u5916\u4e00\u4e2a\u4f18\u70b9\uff1a MySQL \u7684\u5199\u64cd\u4f5c\u4ece\u78c1\u76d8\u7684\u300c\u968f\u673a\u5199\u300d\u53d8\u6210\u4e86\u300c\u987a\u5e8f\u5199\u300d \uff0c\u63d0\u5347\u8bed\u53e5\u7684\u6267\u884c\u6027\u80fd\u3002\u8fd9\u662f\u56e0\u4e3a MySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u66f4\u65b0\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e0a\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u66f4\u65b0\u5230\u78c1\u76d8\u4e0a \u3002 \u81f3\u6b64\uff0c \u9488\u5bf9\u4e3a\u4ec0\u4e48\u9700\u8981 redo log \u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u6709\u4e24\u4e2a\u7b54\u6848\uff1a \u5b9e\u73b0\u4e8b\u52a1\u7684\u6301\u4e45\u6027\uff0c\u8ba9 MySQL \u6709 crash-safe \u7684\u80fd\u529b \uff0c\u80fd\u591f\u4fdd\u8bc1 MySQL \u5728\u4efb\u4f55\u65f6\u95f4\u6bb5\u7a81\u7136\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4e4b\u524d\u5df2\u63d0\u4ea4\u7684\u8bb0\u5f55\u90fd\u4e0d\u4f1a\u4e22\u5931\uff1b \u5c06\u5199\u64cd\u4f5c\u4ece\u300c\u968f\u673a\u5199\u300d\u53d8\u6210\u4e86\u300c\u987a\u5e8f\u5199\u300d \uff0c\u63d0\u5347 MySQL \u5199\u5165\u78c1\u76d8\u7684\u6027\u80fd\u3002 \u4ea7\u751f\u7684 redo log \u662f\u76f4\u63a5\u5199\u5165\u78c1\u76d8\u7684\u5417\uff1f \u4e0d\u662f\u7684\u3002 \u5b9e\u9645\u4e0a\uff0c \u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4ea7\u751f\u7684 redo log \u4e5f\u4e0d\u662f\u76f4\u63a5\u5199\u5165\u78c1\u76d8\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u4ea7\u751f\u5927\u91cf\u7684 I/O \u64cd\u4f5c\uff0c\u800c\u4e14\u78c1\u76d8\u7684\u8fd0\u884c\u901f\u5ea6\u8fdc\u6162\u4e8e\u5185\u5b58\u3002 \u6240\u4ee5\uff0credo log \u4e5f\u6709\u81ea\u5df1\u7684\u7f13\u5b58\u2014\u2014 redo log buffer \uff0c\u6bcf\u5f53\u4ea7\u751f\u4e00\u6761 redo log \u65f6\uff0c\u4f1a\u5148\u5199\u5165\u5230 redo log buffer\uff0c\u540e\u7eed\u5728\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5982\u4e0b\u56fe\uff1a redo log buffer \u9ed8\u8ba4\u5927\u5c0f 16 MB\uff0c\u53ef\u4ee5\u901a\u8fc7 innodb_log_Buffer_size \u53c2\u6570\u52a8\u6001\u7684\u8c03\u6574\u5927\u5c0f\uff0c\u589e\u5927\u5b83\u7684\u5927\u5c0f\u53ef\u4ee5\u8ba9 MySQL \u5904\u7406\u300c\u5927\u4e8b\u52a1\u300d\u662f\u4e0d\u5fc5\u5199\u5165\u78c1\u76d8\uff0c\u8fdb\u800c\u63d0\u5347\u5199 IO \u6027\u80fd\u3002","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 redo log \uff1f"},{"location":"mysql/log/how_update/#redo-log_1","text":"\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u8fd8\u662f\u5728\u5185\u5b58\u4e2d\uff0c\u5b83\u4ec0\u4e48\u65f6\u5019\u5237\u65b0\u5230\u78c1\u76d8\uff1f \u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u4e2a\u65f6\u673a\uff1a MySQL \u6b63\u5e38\u5173\u95ed\u65f6\uff1b \u5f53 redo log buffer \u4e2d\u8bb0\u5f55\u7684\u5199\u5165\u91cf\u5927\u4e8e redo log buffer \u5185\u5b58\u7a7a\u95f4\u7684\u4e00\u534a\u65f6\uff0c\u4f1a\u89e6\u53d1\u843d\u76d8\uff1b InnoDB \u7684\u540e\u53f0\u7ebf\u7a0b\u6bcf\u9694 1 \u79d2\uff0c\u5c06 redo log buffer \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\u90fd\u5c06\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff08\u8fd9\u4e2a\u7b56\u7565\u53ef\u7531 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\uff0c\u4e0b\u9762\u4f1a\u8bf4\uff09\u3002 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\u7684\u662f\u4ec0\u4e48\uff1f \u5355\u72ec\u6267\u884c\u4e00\u4e2a\u66f4\u65b0\u8bed\u53e5\u7684\u65f6\u5019\uff0cInnoDB \u5f15\u64ce\u4f1a\u81ea\u5df1\u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5728\u6267\u884c\u66f4\u65b0\u8bed\u53e5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u751f\u6210\u7684 redo log \u5148\u5199\u5165\u5230 redo log buffer \u4e2d\uff0c\u7136\u540e\u7b49\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u518d\u5c06\u7f13\u5b58\u5728 redo log buffer \u4e2d\u7684 redo log \u6309\u7ec4\u7684\u65b9\u5f0f\u300c\u987a\u5e8f\u5199\u300d\u5230\u78c1\u76d8\u3002 \u4e0a\u9762\u8fd9\u79cd redo log \u5237\u76d8\u65f6\u673a\u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u9ed8\u8ba4\u7684\u884c\u4e3a\u3002 \u9664\u6b64\u4e4b\u5916\uff0cInnoDB \u8fd8\u63d0\u4f9b\u4e86\u53e6\u5916\u4e24\u79cd\u7b56\u7565\uff0c\u7531\u53c2\u6570 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\uff0c\u53ef\u53d6\u7684\u503c\u6709\uff1a0\u30011\u30012\uff0c\u9ed8\u8ba4\u503c\u4e3a 1\uff0c\u8fd9\u4e09\u4e2a\u503c\u5206\u522b\u4ee3\u8868\u7684\u7b56\u7565\u5982\u4e0b\uff1a \u5f53\u8bbe\u7f6e\u8be5**\u53c2\u6570\u4e3a 0 \u65f6**\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6 \uff0c\u8fd8\u662f**\u5c06 redo log \u7559\u5728 redo log buffer \u4e2d** \uff0c\u8be5\u6a21\u5f0f\u4e0b\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u4e0d\u4f1a\u4e3b\u52a8\u89e6\u53d1\u5199\u5165\u78c1\u76d8\u7684\u64cd\u4f5c\u3002 \u5f53\u8bbe\u7f6e\u8be5**\u53c2\u6570\u4e3a 1 \u65f6**\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd**\u5c06\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8**\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1 MySQL \u5f02\u5e38\u91cd\u542f\u4e4b\u540e\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002 \u5f53\u8bbe\u7f6e\u8be5**\u53c2\u6570\u4e3a 2 \u65f6**\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u53ea\u662f\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u5199\u5230 redo log \u6587\u4ef6\uff0c\u6ce8\u610f\u5199\u5165\u5230\u300c redo log \u6587\u4ef6\u300d\u5e76\u4e0d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u78c1\u76d8 \uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u4e2a Page Cache\uff08\u5982\u679c\u4f60\u60f3\u4e86\u89e3 Page Cache\uff0c\u53ef\u4ee5\u770b \u8fd9\u7bc7 \uff09\uff0cPage Cache \u662f\u4e13\u95e8\u7528\u6765\u7f13\u5b58\u6587\u4ef6\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5199\u5165\u300c redo log\u6587\u4ef6\u300d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7f13\u5b58\u3002 \u6211\u753b\u4e86\u4e00\u4e2a\u56fe\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff1a innodb_flush_log_at_trx_commit \u4e3a 0 \u548c 2 \u7684\u65f6\u5019\uff0c\u4ec0\u4e48\u65f6\u5019\u624d\u5c06 redo log \u5199\u5165\u78c1\u76d8\uff1f InnoDB \u7684\u540e\u53f0\u7ebf\u7a0b\u6bcf\u9694 1 \u79d2\uff1a \u9488\u5bf9\u53c2\u6570 0 \uff1a\u4f1a\u628a\u7f13\u5b58\u5728 redo log buffer \u4e2d\u7684 redo log \uff0c\u901a\u8fc7\u8c03\u7528 write() \u5199\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684 Page Cache\uff0c\u7136\u540e\u8c03\u7528 fsync() \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u6240\u4ee5\u53c2\u6570\u4e3a 0 \u7684\u7b56\u7565\uff0cMySQL \u8fdb\u7a0b\u7684\u5d29\u6e83\u4f1a\u5bfc\u81f4\u4e0a\u4e00\u79d2\u949f\u6240\u6709\u4e8b\u52a1\u6570\u636e\u7684\u4e22\u5931 ; \u9488\u5bf9\u53c2\u6570 2 \uff1a\u8c03\u7528 fsync\uff0c\u5c06\u7f13\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d Page Cache \u91cc\u7684 redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u6240\u4ee5\u53c2\u6570\u4e3a 2 \u7684\u7b56\u7565\uff0c\u8f83\u53d6\u503c\u4e3a 0 \u60c5\u51b5\u4e0b\u66f4\u5b89\u5168\uff0c\u56e0\u4e3a MySQL \u8fdb\u7a0b\u7684\u5d29\u6e83\u5e76\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u53ea\u6709\u5728\u64cd\u4f5c\u7cfb\u7edf\u5d29\u6e83\u6216\u8005\u7cfb\u7edf\u65ad\u7535\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0a\u4e00\u79d2\u949f\u6240\u6709\u4e8b\u52a1\u6570\u636e\u624d\u53ef\u80fd\u4e22\u5931 \u3002 \u52a0\u5165\u4e86\u540e\u53f0\u73b0\u7ebf\u7a0b\u540e\uff0cinnodb_flush_log_at_trx_commit \u7684\u5237\u76d8\u65f6\u673a\u5982\u4e0b\u56fe\uff1a \u8fd9\u4e09\u4e2a\u53c2\u6570\u7684\u5e94\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f \u8fd9\u4e09\u4e2a\u53c2\u6570\u7684\u6570\u636e\u5b89\u5168\u6027\u548c\u5199\u5165\u6027\u80fd\u7684\u6bd4\u8f83\u5982\u4e0b\uff1a \u6570\u636e\u5b89\u5168\u6027\uff1a\u53c2\u6570 1 > \u53c2\u6570 2 > \u53c2\u6570 0 \u5199\u5165\u6027\u80fd\uff1a\u53c2\u6570 0 > \u53c2\u6570 2> \u53c2\u6570 1 \u6240\u4ee5\uff0c\u6570\u636e\u5b89\u5168\u6027\u548c\u5199\u5165\u6027\u80fd\u662f\u718a\u638c\u4e0d\u53ef\u5f97\u517c\u7684\uff0c \u8981\u4e0d\u8ffd\u6c42\u6570\u636e\u5b89\u5168\u6027\uff0c\u727a\u7272\u6027\u80fd\uff1b\u8981\u4e0d\u8ffd\u6c42\u6027\u80fd\uff0c\u727a\u7272\u6570\u636e\u5b89\u5168\u6027 \u3002 \u5728\u4e00\u4e9b\u5bf9\u6570\u636e\u5b89\u5168\u6027\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\u4e2d\uff0c\u663e\u7136 innodb_flush_log_at_trx_commit \u53c2\u6570\u9700\u8981\u8bbe\u7f6e\u4e3a 1\u3002 \u5728\u4e00\u4e9b\u53ef\u4ee5\u5bb9\u5fcd\u6570\u636e\u5e93\u5d29\u6e83\u65f6\u4e22\u5931 1s \u6570\u636e\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a 0\uff0c\u8fd9\u6837\u53ef\u4ee5\u660e\u663e\u5730\u51cf\u5c11\u65e5\u5fd7\u540c\u6b65\u5230\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u3002 \u5b89\u5168\u6027\u548c\u6027\u80fd\u6298\u4e2d\u7684\u65b9\u6848\u5c31\u662f\u53c2\u6570 2\uff0c\u867d\u7136\u53c2\u6570 2 \u6ca1\u6709\u53c2\u6570 0 \u7684\u6027\u80fd\u9ad8\uff0c\u4f46\u662f\u6570\u636e\u5b89\u5168\u6027\u65b9\u9762\u6bd4\u53c2\u6570 0 \u5f3a\uff0c\u56e0\u4e3a\u53c2\u6570 2 \u53ea\u8981\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u5b95\u673a\uff0c\u5373\u4f7f\u6570\u636e\u5e93\u5d29\u6e83\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u540c\u65f6\u6027\u80fd\u65b9\u4fbf\u6bd4\u53c2\u6570 1 \u9ad8\u3002","title":"redo log \u4ec0\u4e48\u65f6\u5019\u5237\u76d8\uff1f"},{"location":"mysql/log/how_update/#redo-log_2","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c InnoDB \u5b58\u50a8\u5f15\u64ce\u6709 1 \u4e2a\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4( redo log Group\uff09\uff0c\u300c\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4\u300d\u7531\u6709 2 \u4e2a redo log \u6587\u4ef6\u7ec4\u6210\uff0c\u8fd9\u4e24\u4e2a redo \u65e5\u5fd7\u7684\u6587\u4ef6\u540d\u53eb \uff1a ib_logfile0 \u548c ib_logfile1 \u3002 \u5728\u91cd\u505a\u65e5\u5fd7\u7ec4\u4e2d\uff0c\u6bcf\u4e2a redo log File \u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u4e14\u4e00\u81f4\u7684\uff0c\u5047\u8bbe\u6bcf\u4e2a redo log File \u8bbe\u7f6e\u7684\u4e0a\u9650\u662f 1 GB\uff0c\u90a3\u4e48\u603b\u5171\u5c31\u53ef\u4ee5\u8bb0\u5f55 2GB \u7684\u64cd\u4f5c\u3002 \u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4\u662f\u4ee5**\u5faa\u73af\u5199**\u7684\u65b9\u5f0f\u5de5\u4f5c\u7684\uff0c\u4ece\u5934\u5f00\u59cb\u5199\uff0c\u5199\u5230\u672b\u5c3e\u5c31\u53c8\u56de\u5230\u5f00\u5934\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u73af\u5f62\u3002 \u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u5148\u5199 ib_logfile0 \u6587\u4ef6\uff0c\u5f53 ib_logfile0 \u6587\u4ef6\u88ab\u5199\u6ee1\u7684\u65f6\u5019\uff0c\u4f1a\u5207\u6362\u81f3 ib_logfile1 \u6587\u4ef6\uff0c\u5f53 ib_logfile1 \u6587\u4ef6\u4e5f\u88ab\u5199\u6ee1\u65f6\uff0c\u4f1a\u5207\u6362\u56de ib_logfile0 \u6587\u4ef6\u3002 \u6211\u4eec\u77e5\u9053 redo log \u662f\u4e3a\u4e86\u9632\u6b62 Buffer Pool \u4e2d\u7684\u810f\u9875\u4e22\u5931\u800c\u8bbe\u8ba1\u7684\uff0c\u90a3\u4e48\u5982\u679c\u968f\u7740\u7cfb\u7edf\u8fd0\u884c\uff0cBuffer Pool \u7684\u810f\u9875\u5237\u65b0\u5230\u4e86\u78c1\u76d8\u4e2d\uff0c\u90a3\u4e48 redo log \u5bf9\u5e94\u7684\u8bb0\u5f55\u4e5f\u5c31\u6ca1\u7528\u4e86\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u64e6\u9664\u8fd9\u4e9b\u65e7\u8bb0\u5f55\uff0c\u4ee5\u817e\u51fa\u7a7a\u95f4\u8bb0\u5f55\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\u3002 redo log \u662f\u5faa\u73af\u5199\u7684\u65b9\u5f0f\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u73af\u5f62\uff0cInnoDB \u7528 write pos \u8868\u793a redo log \u5f53\u524d\u8bb0\u5f55\u5199\u5230\u7684\u4f4d\u7f6e\uff0c\u7528 checkpoint \u8868\u793a\u5f53\u524d\u8981\u64e6\u9664\u7684\u4f4d\u7f6e\uff0c\u5982\u4e0b\u56fe\uff1a \u56fe\u4e2d\u7684\uff1a write pos \u548c checkpoint \u7684\u79fb\u52a8\u90fd\u662f\u987a\u65f6\u9488\u65b9\u5411\uff1b write pos \uff5e checkpoint \u4e4b\u95f4\u7684\u90e8\u5206\uff08\u56fe\u4e2d\u7684\u7ea2\u8272\u90e8\u5206\uff09\uff0c\u7528\u6765\u8bb0\u5f55\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\uff1b check point \uff5e write pos \u4e4b\u95f4\u7684\u90e8\u5206\uff08\u56fe\u4e2d\u84dd\u8272\u90e8\u5206\uff09\uff1a\u5f85\u843d\u76d8\u7684\u810f\u6570\u636e\u9875\u8bb0\u5f55\uff1b \u5982\u679c write pos \u8ffd\u4e0a\u4e86 checkpoint\uff0c\u5c31\u610f\u5473\u7740 redo log \u6587\u4ef6\u6ee1\u4e86\uff0c\u8fd9\u65f6 MySQL \u4e0d\u80fd\u518d\u6267\u884c\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4 MySQL \u4f1a\u88ab\u963b\u585e \uff08 \u56e0\u6b64\u6240\u4ee5\u9488\u5bf9\u5e76\u53d1\u91cf\u5927\u7684\u7cfb\u7edf\uff0c\u9002\u5f53\u8bbe\u7f6e redo log \u7684\u6587\u4ef6\u5927\u5c0f\u975e\u5e38\u91cd\u8981 \uff09\uff0c\u6b64\u65f6**\u4f1a\u505c\u4e0b\u6765\u5c06 Buffer Pool \u4e2d\u7684\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\uff0c\u7136\u540e\u6807\u8bb0 redo log \u54ea\u4e9b\u8bb0\u5f55\u53ef\u4ee5\u88ab\u64e6\u9664\uff0c\u63a5\u7740\u5bf9\u65e7\u7684 redo log \u8bb0\u5f55\u8fdb\u884c\u64e6\u9664\uff0c\u7b49\u64e6\u9664\u5b8c\u65e7\u8bb0\u5f55\u817e\u51fa\u4e86\u7a7a\u95f4\uff0ccheckpoint \u5c31\u4f1a\u5f80\u540e\u79fb\u52a8\uff08\u56fe\u4e2d\u987a\u65f6\u9488\uff09**\uff0c\u7136\u540e MySQL \u6062\u590d\u6b63\u5e38\u8fd0\u884c\uff0c\u7ee7\u7eed\u6267\u884c\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c\u4e00\u6b21 checkpoint \u7684\u8fc7\u7a0b\u5c31\u662f\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u53d8\u6210\u5e72\u51c0\u9875\uff0c\u7136\u540e\u6807\u8bb0 redo log \u54ea\u4e9b\u8bb0\u5f55\u53ef\u4ee5\u88ab\u8986\u76d6\u7684\u8fc7\u7a0b\u3002","title":"redo log \u6587\u4ef6\u5199\u6ee1\u4e86\u600e\u4e48\u529e\uff1f"},{"location":"mysql/log/how_update/#binlog","text":"\u524d\u9762\u4ecb\u7ecd\u7684 undo log \u548c redo log \u8fd9\u4e24\u4e2a\u65e5\u5fd7\u90fd\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u751f\u6210\u7684\u3002 MySQL \u5728\u5b8c\u6210\u4e00\u6761\u66f4\u65b0\u64cd\u4f5c\u540e\uff0cServer \u5c42\u8fd8\u4f1a\u751f\u6210\u4e00\u6761 binlog\uff0c\u7b49\u4e4b\u540e\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u8be5\u4e8b\u7269\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u6240\u6709 binlog \u7edf\u4e00\u5199 \u5165 binlog \u6587\u4ef6\u3002 binlog \u6587\u4ef6\u662f\u8bb0\u5f55\u4e86\u6240\u6709\u6570\u636e\u5e93\u8868\u7ed3\u6784\u53d8\u66f4\u548c\u8868\u6570\u636e\u4fee\u6539\u7684\u65e5\u5fd7\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u67e5\u8be2\u7c7b\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982 SELECT \u548c SHOW \u64cd\u4f5c\u3002 \u4e3a\u4ec0\u4e48\u6709\u4e86 binlog\uff0c \u8fd8\u8981\u6709 redo log\uff1f \u8fd9\u4e2a\u95ee\u9898\u8ddf MySQL \u7684\u65f6\u95f4\u7ebf\u6709\u5173\u7cfb\u3002 \u6700\u5f00\u59cb MySQL \u91cc\u5e76\u6ca1\u6709 InnoDB \u5f15\u64ce\uff0cMySQL \u81ea\u5e26\u7684\u5f15\u64ce\u662f MyISAM\uff0c\u4f46\u662f MyISAM \u6ca1\u6709 crash-safe \u7684\u80fd\u529b\uff0cbinlog \u65e5\u5fd7\u53ea\u80fd\u7528\u4e8e\u5f52\u6863\u3002 \u800c InnoDB \u662f\u53e6\u4e00\u4e2a\u516c\u53f8\u4ee5\u63d2\u4ef6\u5f62\u5f0f\u5f15\u5165 MySQL \u7684\uff0c\u65e2\u7136\u53ea\u4f9d\u9760 binlog \u662f\u6ca1\u6709 crash-safe \u80fd\u529b\u7684\uff0c\u6240\u4ee5 InnoDB \u4f7f\u7528 redo log \u6765\u5b9e\u73b0 crash-safe \u80fd\u529b\u3002","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 binlog \uff1f"},{"location":"mysql/log/how_update/#redo-log-binlog","text":"\u8fd9\u4e24\u4e2a\u65e5\u5fd7\u6709\u56db\u4e2a\u533a\u522b\u3002 1\u3001\u9002\u7528\u5bf9\u8c61\u4e0d\u540c\uff1a binlog \u662f MySQL \u7684 Server \u5c42\u5b9e\u73b0\u7684\u65e5\u5fd7\uff0c\u6240\u6709\u5b58\u50a8\u5f15\u64ce\u90fd\u53ef\u4ee5\u4f7f\u7528\uff1b redo log \u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\u65e5\u5fd7\uff1b 2\u3001\u6587\u4ef6\u683c\u5f0f\u4e0d\u540c\uff1a binlog \u6709 3 \u79cd\u683c\u5f0f\u7c7b\u578b\uff0c\u5206\u522b\u662f STATEMENT\uff08\u9ed8\u8ba4\u683c\u5f0f\uff09\u3001ROW\u3001 MIXED\uff0c\u533a\u522b\u5982\u4e0b\uff1a STATEMENT\uff1a\u6bcf\u4e00\u6761\u4fee\u6539\u6570\u636e\u7684 SQL \u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230 binlog \u4e2d\uff08\u76f8\u5f53\u4e8e\u8bb0\u5f55\u4e86\u903b\u8f91\u64cd\u4f5c\uff0c\u6240\u4ee5\u9488\u5bf9\u8fd9\u79cd\u683c\u5f0f\uff0c binlog \u53ef\u4ee5\u79f0\u4e3a\u903b\u8f91\u65e5\u5fd7\uff09\uff0c\u4e3b\u4ece\u590d\u5236\u4e2d slave \u7aef\u518d\u6839\u636e SQL \u8bed\u53e5\u91cd\u73b0\u3002\u4f46 STATEMENT \u6709\u52a8\u6001\u51fd\u6570\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u4f60\u7528\u4e86 uuid \u6216\u8005 now \u8fd9\u4e9b\u51fd\u6570\uff0c\u4f60\u5728\u4e3b\u5e93\u4e0a\u6267\u884c\u7684\u7ed3\u679c\u5e76\u4e0d\u662f\u4f60\u5728\u4ece\u5e93\u6267\u884c\u7684\u7ed3\u679c\uff0c\u8fd9\u79cd\u968f\u65f6\u5728\u53d8\u7684\u51fd\u6570\u4f1a\u5bfc\u81f4\u590d\u5236\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff1b ROW\uff1a\u8bb0\u5f55\u884c\u6570\u636e\u6700\u7ec8\u88ab\u4fee\u6539\u6210\u4ec0\u4e48\u6837\u4e86\uff08\u8fd9\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7\uff0c\u5c31\u4e0d\u80fd\u79f0\u4e3a\u903b\u8f91\u65e5\u5fd7\u4e86\uff09\uff0c\u4e0d\u4f1a\u51fa\u73b0 STATEMENT \u4e0b\u52a8\u6001\u51fd\u6570\u7684\u95ee\u9898\u3002\u4f46 ROW \u7684\u7f3a\u70b9\u662f\u6bcf\u884c\u6570\u636e\u7684\u53d8\u5316\u7ed3\u679c\u90fd\u4f1a\u88ab\u8bb0\u5f55\uff0c\u6bd4\u5982\u6267\u884c\u6279\u91cf update \u8bed\u53e5\uff0c\u66f4\u65b0\u591a\u5c11\u884c\u6570\u636e\u5c31\u4f1a\u4ea7\u751f\u591a\u5c11\u6761\u8bb0\u5f55\uff0c\u4f7f binlog \u6587\u4ef6\u8fc7\u5927\uff0c\u800c\u5728 STATEMENT \u683c\u5f0f\u4e0b\u53ea\u4f1a\u8bb0\u5f55\u4e00\u4e2a update \u8bed\u53e5\u800c\u5df2\uff1b MIXED\uff1a\u5305\u542b\u4e86 STATEMENT \u548c ROW \u6a21\u5f0f\uff0c\u5b83\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u60c5\u51b5\u81ea\u52a8\u4f7f\u7528 ROW \u6a21\u5f0f\u548c STATEMENT \u6a21\u5f0f\uff1b redo log \u662f\u7269\u7406\u65e5\u5fd7\uff0c\u8bb0\u5f55\u7684\u662f\u5728\u67d0\u4e2a\u6570\u636e\u9875\u505a\u4e86\u4ec0\u4e48\u4fee\u6539\uff0c\u6bd4\u5982\u5bf9 XXX \u8868\u7a7a\u95f4\u4e2d\u7684 YYY \u6570\u636e\u9875 ZZZ \u504f\u79fb\u91cf\u7684\u5730\u65b9\u505a\u4e86AAA \u66f4\u65b0\uff1b 3\u3001\u5199\u5165\u65b9\u5f0f\u4e0d\u540c\uff1a binlog \u662f\u8ffd\u52a0\u5199\uff0c\u5199\u6ee1\u4e00\u4e2a\u6587\u4ef6\uff0c\u5c31\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u7ee7\u7eed\u5199\uff0c\u4e0d\u4f1a\u8986\u76d6\u4ee5\u524d\u7684\u65e5\u5fd7\uff0c\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u7684\u65e5\u5fd7\u3002 redo log \u662f\u5faa\u73af\u5199\uff0c\u65e5\u5fd7\u7a7a\u95f4\u5927\u5c0f\u662f\u56fa\u5b9a\uff0c\u5168\u90e8\u5199\u6ee1\u5c31\u4ece\u5934\u5f00\u59cb\uff0c\u4fdd\u5b58\u672a\u88ab\u5237\u5165\u78c1\u76d8\u7684\u810f\u9875\u65e5\u5fd7\u3002 4\u3001\u7528\u9014\u4e0d\u540c\uff1a binlog \u7528\u4e8e\u5907\u4efd\u6062\u590d\u3001\u4e3b\u4ece\u590d\u5236\uff1b redo log \u7528\u4e8e\u6389\u7535\u7b49\u6545\u969c\u6062\u590d\u3002 \u5982\u679c\u4e0d\u5c0f\u5fc3\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u88ab\u5220\u9664\u4e86\uff0c\u80fd\u4f7f\u7528 redo log \u6587\u4ef6\u6062\u590d\u6570\u636e\u5417\uff1f \u4e0d\u53ef\u4ee5\u4f7f\u7528 redo log \u6587\u4ef6\u6062\u590d\uff0c\u53ea\u80fd\u4f7f\u7528 binlog \u6587\u4ef6\u6062\u590d\u3002 \u56e0\u4e3a redo log \u6587\u4ef6\u662f\u5faa\u73af\u5199\uff0c\u662f\u4f1a\u8fb9\u5199\u8fb9\u64e6\u9664\u65e5\u5fd7\u7684\uff0c\u53ea\u8bb0\u5f55\u672a\u88ab\u5237\u5165\u78c1\u76d8\u7684\u6570\u636e\u7684\u7269\u7406\u65e5\u5fd7\uff0c\u5df2\u7ecf\u5237\u5165\u78c1\u76d8\u7684\u6570\u636e\u90fd\u4f1a\u4ece redo log \u6587\u4ef6\u91cc\u64e6\u9664\u3002 binlog \u6587\u4ef6\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u7684\u65e5\u5fd7\uff0c\u4e5f\u5c31\u662f\u4fdd\u5b58\u4e86\u6240\u6709\u6570\u636e\u53d8\u66f4\u7684\u60c5\u51b5\uff0c\u7406\u8bba\u4e0a\u53ea\u8981\u8bb0\u5f55\u5728 binlog \u4e0a\u7684\u6570\u636e\uff0c\u90fd\u53ef\u4ee5\u6062\u590d\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5c0f\u5fc3\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u88ab\u5220\u9664\u4e86\uff0c\u5f97\u7528 binlog \u6587\u4ef6\u6062\u590d\u6570\u636e\u3002","title":"redo log \u548c binlog \u6709\u4ec0\u4e48\u533a\u522b\uff1f"},{"location":"mysql/log/how_update/#_1","text":"MySQL \u7684\u4e3b\u4ece\u590d\u5236\u4f9d\u8d56\u4e8e binlog \uff0c\u4e5f\u5c31\u662f\u8bb0\u5f55 MySQL \u4e0a\u7684\u6240\u6709\u53d8\u5316\u5e76\u4ee5\u4e8c\u8fdb\u5236\u5f62\u5f0f\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\u3002\u590d\u5236\u7684\u8fc7\u7a0b\u5c31\u662f\u5c06 binlog \u4e2d\u7684\u6570\u636e\u4ece\u4e3b\u5e93\u4f20\u8f93\u5230\u4ece\u5e93\u4e0a\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u822c\u662f**\u5f02\u6b65**\u7684\uff0c\u4e5f\u5c31\u662f\u4e3b\u5e93\u4e0a\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u7b49\u5f85\u590d\u5236 binlog \u7684\u7ebf\u7a0b\u540c\u6b65\u5b8c\u6210\u3002 MySQL \u96c6\u7fa4\u7684\u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\u68b3\u7406\u6210 3 \u4e2a\u9636\u6bb5\uff1a \u5199\u5165 Binlog \uff1a\u4e3b\u5e93\u5199 binlog \u65e5\u5fd7\uff0c\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5e76\u66f4\u65b0\u672c\u5730\u5b58\u50a8\u6570\u636e\u3002 \u540c\u6b65 Binlog \uff1a\u628a binlog \u590d\u5236\u5230\u6240\u6709\u4ece\u5e93\u4e0a\uff0c\u6bcf\u4e2a\u4ece\u5e93\u628a binlog \u5199\u5230\u6682\u5b58\u65e5\u5fd7\u4e2d\u3002 \u56de\u653e Binlog \uff1a\u56de\u653e binlog\uff0c\u5e76\u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\u3002 \u5177\u4f53\u8be6\u7ec6\u8fc7\u7a0b\u5982\u4e0b\uff1a MySQL \u4e3b\u5e93\u5728\u6536\u5230\u5ba2\u6237\u7aef\u63d0\u4ea4\u4e8b\u52a1\u7684\u8bf7\u6c42\u4e4b\u540e\uff0c\u4f1a\u5148\u5199\u5165 binlog\uff0c\u518d\u63d0\u4ea4\u4e8b\u52a1\uff0c\u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\uff0c\u4e8b\u52a1\u63d0\u4ea4\u5b8c\u6210\u540e\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u201c\u64cd\u4f5c\u6210\u529f\u201d\u7684\u54cd\u5e94\u3002 \u4ece\u5e93\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e13\u95e8\u7684 I/O \u7ebf\u7a0b\uff0c\u8fde\u63a5\u4e3b\u5e93\u7684 log dump \u7ebf\u7a0b\uff0c\u6765\u63a5\u6536\u4e3b\u5e93\u7684 binlog \u65e5\u5fd7\uff0c\u518d\u628a binlog \u4fe1\u606f\u5199\u5165 relay log \u7684\u4e2d\u7ee7\u65e5\u5fd7\u91cc\uff0c\u518d\u8fd4\u56de\u7ed9\u4e3b\u5e93\u201c\u590d\u5236\u6210\u529f\u201d\u7684\u54cd\u5e94\u3002 \u4ece\u5e93\u4f1a\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u56de\u653e binlog \u7684\u7ebf\u7a0b\uff0c\u53bb\u8bfb relay log \u4e2d\u7ee7\u65e5\u5fd7\uff0c\u7136\u540e\u56de\u653e binlog \u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\uff0c\u6700\u7ec8\u5b9e\u73b0\u4e3b\u4ece\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002 \u5728\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\u4e4b\u540e\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728\u5199\u6570\u636e\u65f6\u53ea\u5199\u4e3b\u5e93\uff0c\u5728\u8bfb\u6570\u636e\u65f6\u53ea\u8bfb\u4ece\u5e93\uff0c\u8fd9\u6837\u5373\u4f7f\u5199\u8bf7\u6c42\u4f1a\u9501\u8868\u6216\u8005\u9501\u8bb0\u5f55\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u8bfb\u8bf7\u6c42\u7684\u6267\u884c\u3002 \u4ece\u5e93\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff1f \u4e0d\u662f\u7684\u3002 \u56e0\u4e3a\u4ece\u5e93\u6570\u91cf\u589e\u52a0\uff0c\u4ece\u5e93\u8fde\u63a5\u4e0a\u6765\u7684 I/O \u7ebf\u7a0b\u4e5f\u6bd4\u8f83\u591a\uff0c \u4e3b\u5e93\u4e5f\u8981\u521b\u5efa\u540c\u6837\u591a\u7684 log dump \u7ebf\u7a0b\u6765\u5904\u7406\u590d\u5236\u7684\u8bf7\u6c42\uff0c\u5bf9\u4e3b\u5e93\u8d44\u6e90\u6d88\u8017\u6bd4\u8f83\u9ad8\uff0c\u540c\u65f6\u8fd8\u53d7\u9650\u4e8e\u4e3b\u5e93\u7684\u7f51\u7edc\u5e26\u5bbd \u3002 \u6240\u4ee5\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u4e00\u4e2a\u4e3b\u5e93\u4e00\u822c\u8ddf 2\uff5e3 \u4e2a\u4ece\u5e93\uff081 \u5957\u6570\u636e\u5e93\uff0c1 \u4e3b 2 \u4ece 1 \u5907\u4e3b\uff09\uff0c\u8fd9\u5c31\u662f\u4e00\u4e3b\u591a\u4ece\u7684 MySQL \u96c6\u7fa4\u7ed3\u6784\u3002 MySQL \u4e3b\u4ece\u590d\u5236\u8fd8\u6709\u54ea\u4e9b\u6a21\u578b\uff1f \u4e3b\u8981\u6709\u4e09\u79cd\uff1a \u540c\u6b65\u590d\u5236 \uff1aMySQL \u4e3b\u5e93\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ebf\u7a0b\u8981\u7b49\u5f85\u6240\u6709\u4ece\u5e93\u7684\u590d\u5236\u6210\u529f\u54cd\u5e94\uff0c\u624d\u8fd4\u56de\u5ba2\u6237\u7aef\u7ed3\u679c\u3002\u8fd9\u79cd\u65b9\u5f0f\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u57fa\u672c\u4e0a\u6ca1\u6cd5\u7528\uff0c\u539f\u56e0\u6709\u4e24\u4e2a\uff1a\u4e00\u662f\u6027\u80fd\u5f88\u5dee\uff0c\u56e0\u4e3a\u8981\u590d\u5236\u5230\u6240\u6709\u8282\u70b9\u624d\u8fd4\u56de\u54cd\u5e94\uff1b\u4e8c\u662f\u53ef\u7528\u6027\u4e5f\u5f88\u5dee\uff0c\u4e3b\u5e93\u548c\u6240\u6709\u4ece\u5e93\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u5e93\u51fa\u95ee\u9898\uff0c\u90fd\u4f1a\u5f71\u54cd\u4e1a\u52a1\u3002 \u5f02\u6b65\u590d\u5236 \uff08\u9ed8\u8ba4\u6a21\u578b\uff09\uff1aMySQL \u4e3b\u5e93\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u7b49\u5f85 binlog \u540c\u6b65\u5230\u5404\u4ece\u5e93\uff0c\u5c31\u8fd4\u56de\u5ba2\u6237\u7aef\u7ed3\u679c\u3002\u8fd9\u79cd\u6a21\u5f0f\u4e00\u65e6\u4e3b\u5e93\u5b95\u673a\uff0c\u6570\u636e\u5c31\u4f1a\u53d1\u751f\u4e22\u5931\u3002 \u534a\u540c\u6b65\u590d\u5236 \uff1aMySQL 5.7 \u7248\u672c\u4e4b\u540e\u589e\u52a0\u7684\u4e00\u79cd\u590d\u5236\u65b9\u5f0f\uff0c\u4ecb\u4e8e\u4e24\u8005\u4e4b\u95f4\uff0c\u4e8b\u52a1\u7ebf\u7a0b\u4e0d\u7528\u7b49\u5f85\u6240\u6709\u7684\u4ece\u5e93\u590d\u5236\u6210\u529f\u54cd\u5e94\uff0c\u53ea\u8981\u4e00\u90e8\u5206\u590d\u5236\u6210\u529f\u54cd\u5e94\u56de\u6765\u5c31\u884c\uff0c\u6bd4\u5982\u4e00\u4e3b\u4e8c\u4ece\u7684\u96c6\u7fa4\uff0c\u53ea\u8981\u6570\u636e\u6210\u529f\u590d\u5236\u5230\u4efb\u610f\u4e00\u4e2a\u4ece\u5e93\u4e0a\uff0c\u4e3b\u5e93\u7684\u4e8b\u52a1\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8fd9\u79cd**\u534a\u540c\u6b65\u590d\u5236\u7684\u65b9\u5f0f\uff0c\u517c\u987e\u4e86\u5f02\u6b65\u590d\u5236\u548c\u540c\u6b65\u590d\u5236\u7684\u4f18\u70b9\uff0c\u5373\u4f7f\u51fa\u73b0\u4e3b\u5e93\u5b95\u673a\uff0c\u81f3\u5c11\u8fd8\u6709\u4e00\u4e2a\u4ece\u5e93\u6709\u6700\u65b0\u7684\u6570\u636e\uff0c\u4e0d\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669**\u3002","title":"\u4e3b\u4ece\u590d\u5236\u662f\u600e\u4e48\u5b9e\u73b0\uff1f"},{"location":"mysql/log/how_update/#binlog_1","text":"\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5148\u628a\u65e5\u5fd7\u5199\u5230 binlog cache\uff08Server \u5c42\u7684 cache\uff09\uff0c\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u518d\u628a binlog cache \u5199\u5230 binlog \u6587\u4ef6\u4e2d\u3002 MySQL \u7ed9 binlog cache \u5206\u914d\u4e86\u4e00\u7247\u5185\u5b58\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u4e2a\uff0c\u53c2\u6570 binlog_cache_size \u7528\u4e8e\u63a7\u5236\u5355\u4e2a\u7ebf\u7a0b\u5185 binlog cache \u6240\u5360\u5185\u5b58\u7684\u5927\u5c0f\u3002\u5982\u679c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u53c2\u6570\u89c4\u5b9a\u7684\u5927\u5c0f\uff0c\u5c31\u8981\u6682\u5b58\u5230\u78c1\u76d8\u3002 \u4ec0\u4e48\u65f6\u5019 binlog cache \u4f1a\u5199\u5230 binlog \u6587\u4ef6\uff1f \u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u6267\u884c\u5668\u628a binlog cache \u91cc\u7684\u5b8c\u6574\u4e8b\u52a1\u5199\u5165\u5230 binlog \u6587\u4ef6\u4e2d\uff0c\u5e76\u6e05\u7a7a binlog cache\u3002\u5982\u4e0b\u56fe\uff1a \u867d\u7136\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1 binlog cache\uff0c\u4f46\u662f\u6700\u7ec8\u90fd\u5199\u5230\u540c\u4e00\u4e2a binlog \u6587\u4ef6\uff1a \u56fe\u4e2d\u7684 write\uff0c\u6307\u7684\u5c31\u662f\u6307\u628a\u65e5\u5fd7\u5199\u5165\u5230 binlog \u6587\u4ef6\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u628a\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u56e0\u4e3a\u6570\u636e\u8fd8\u7f13\u5b58\u5728\u6587\u4ef6\u7cfb\u7edf\u7684 page cache \u91cc\uff0cwrite \u7684\u5199\u5165\u901f\u5ea6\u8fd8\u662f\u6bd4\u8f83\u5feb\u7684\uff0c\u56e0\u4e3a\u4e0d\u6d89\u53ca\u78c1\u76d8 I/O\u3002 \u56fe\u4e2d\u7684 fsync\uff0c\u624d\u662f\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\uff0c\u8fd9\u91cc\u5c31\u4f1a\u6d89\u53ca\u78c1\u76d8 I/O\uff0c\u6240\u4ee5\u9891\u7e41\u7684 fsync \u4f1a\u5bfc\u81f4\u78c1\u76d8\u7684 I/O \u5347\u9ad8\u3002 MySQL\u63d0\u4f9b\u4e00\u4e2a sync_binlog \u53c2\u6570\u6765\u63a7\u5236\u6570\u636e\u5e93\u7684 binlog \u5237\u5230\u78c1\u76d8\u4e0a\u7684\u9891\u7387\uff1a sync_binlog = 0 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u53ea write\uff0c\u4e0d fsync\uff0c\u540e\u7eed\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff1b sync_binlog = 1 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a write\uff0c\u7136\u540e\u9a6c\u4e0a\u6267\u884c fsync\uff1b sync_binlog =N(N>1) \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd write\uff0c\u4f46\u7d2f\u79ef N \u4e2a\u4e8b\u52a1\u540e\u624d fsync\u3002 \u5728MySQL\u4e2d\u7cfb\u7edf\u9ed8\u8ba4\u7684\u8bbe\u7f6e\u662f sync_binlog = 0\uff0c\u4e5f\u5c31\u662f\u4e0d\u505a\u4efb\u4f55\u5f3a\u5236\u6027\u7684\u78c1\u76d8\u5237\u65b0\u6307\u4ee4\uff0c\u8fd9\u65f6\u5019\u7684\u6027\u80fd\u662f\u6700\u597d\u7684\uff0c\u4f46\u662f\u98ce\u9669\u4e5f\u662f\u6700\u5927\u7684\u3002\u56e0\u4e3a\u4e00\u65e6\u4e3b\u673a\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u8fd8\u6ca1\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u800c\u5f53 sync_binlog \u8bbe\u7f6e\u4e3a 1 \u7684\u65f6\u5019\uff0c\u662f\u6700\u5b89\u5168\u4f46\u662f\u6027\u80fd\u635f\u8017\u6700\u5927\u7684\u8bbe\u7f6e\u3002\u56e0\u4e3a\u5f53\u8bbe\u7f6e\u4e3a 1 \u7684\u65f6\u5019\uff0c\u5373\u4f7f\u4e3b\u673a\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u6700\u591a\u4e22\u5931\u4e00\u4e2a\u4e8b\u52a1\u7684 binlog\uff0c\u800c\u5df2\u7ecf\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u6570\u636e\u5c31\u4e0d\u4f1a\u6709\u5f71\u54cd\uff0c\u4e0d\u8fc7\u5c31\u662f\u5bf9\u5199\u5165\u6027\u80fd\u5f71\u54cd\u592a\u5927\u3002 \u5982\u679c\u80fd\u5bb9\u5c11\u91cf\u4e8b\u52a1\u7684 binlog \u65e5\u5fd7\u4e22\u5931\u7684\u98ce\u9669\uff0c\u4e3a\u4e86\u63d0\u9ad8\u5199\u5165\u7684\u6027\u80fd\uff0c\u4e00\u822c\u4f1a sync_binlog \u8bbe\u7f6e\u4e3a 100~1000 \u4e2d\u7684\u67d0\u4e2a\u6570\u503c\u3002 \u4e09\u4e2a\u65e5\u5fd7\u8bb2\u5b8c\u4e86\uff0c\u81f3\u6b64\u6211\u4eec\u53ef\u4ee5\u5148\u5c0f\u7ed3\u4e0b\uff0cupdate \u8bed\u53e5\u7684\u6267\u884c\u8fc7\u7a0b\u3002 \u5f53\u4f18\u5316\u5668\u5206\u6790\u51fa\u6210\u672c\u6700\u5c0f\u7684\u6267\u884c\u8ba1\u5212\u540e\uff0c\u6267\u884c\u5668\u5c31\u6309\u7167\u6267\u884c\u8ba1\u5212\u5f00\u59cb\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u3002 \u5177\u4f53\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55 UPDATE t_user SET name = 'xiaolin' WHERE id = 1; \u7684\u6d41\u7a0b\u5982\u4e0b: \u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u4f1a\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\uff0c\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u6811\u641c\u7d22\u83b7\u53d6 id = 1 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1a \u5982\u679c id=1 \u8fd9\u4e00\u884c\u6240\u5728\u7684\u6570\u636e\u9875\u672c\u6765\u5c31\u5728 buffer pool \u4e2d\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7ed9\u6267\u884c\u5668\u66f4\u65b0\uff1b \u5982\u679c\u8bb0\u5f55\u4e0d\u5728 buffer pool\uff0c\u5c06\u6570\u636e\u9875\u4ece\u78c1\u76d8\u8bfb\u5165\u5230 buffer pool\uff0c\u8fd4\u56de\u8bb0\u5f55\u7ed9\u6267\u884c\u5668\u3002 \u6267\u884c\u5668\u5f97\u5230\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u540e\uff0c\u4f1a\u770b\u4e00\u4e0b\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u662f\u5426\u4e00\u6837\uff1a \u5982\u679c\u4e00\u6837\u7684\u8bdd\u5c31\u4e0d\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u6d41\u7a0b\uff1b \u5982\u679c\u4e0d\u4e00\u6837\u7684\u8bdd\u5c31\u628a\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u90fd\u5f53\u4f5c\u53c2\u6570\u4f20\u7ed9 InnoDB \u5c42\uff0c\u8ba9 InnoDB \u771f\u6b63\u7684\u6267\u884c\u66f4\u65b0\u8bb0\u5f55\u7684\u64cd\u4f5c\uff1b \u5f00\u542f\u4e8b\u52a1\uff0c InnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u56e0\u4e3a\u8fd9\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\uff0c\u4e0d\u8fc7\u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log\u3002 InnoDB \u5c42\u5f00\u59cb\u66f4\u65b0\u8bb0\u5f55\uff0c\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u5199\u5230 redo log \u91cc\u9762\uff0c\u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86\u3002\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002\u8fd9\u5c31\u662f WAL \u6280\u672f \uff0cMySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199 redo \u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5c06\u4fee\u6539\u7684\u884c\u6570\u636e\u5199\u5230\u78c1\u76d8\u4e0a\u3002 \u81f3\u6b64\uff0c\u4e00\u6761\u8bb0\u5f55\u66f4\u65b0\u5b8c\u4e86\u3002 \u5728\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7136\u540e\u5f00\u59cb\u8bb0\u5f55\u8be5\u8bed\u53e5\u5bf9\u5e94\u7684 binlog\uff0c\u6b64\u65f6\u8bb0\u5f55\u7684 binlog \u4f1a\u88ab\u4fdd\u5b58\u5230 binlog cache\uff0c\u5e76\u6ca1\u6709\u5237\u65b0\u5230\u786c\u76d8\u4e0a\u7684 binlog \u6587\u4ef6\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u624d\u4f1a\u7edf\u4e00\u5c06\u8be5\u4e8b\u52a1\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709 binlog \u5237\u65b0\u5230\u786c\u76d8\u3002 \u4e8b\u52a1\u63d0\u4ea4\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u300c\u4e24\u9636\u6bb5\u63d0\u4ea4\u300d\u7684\u4e8b\u60c5\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u8bb2\u8fd9\u4e2a\u3002","title":"binlog \u4ec0\u4e48\u65f6\u5019\u5237\u76d8\uff1f"},{"location":"mysql/log/how_update/#_2","text":"\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0credo log \u548c binlog \u90fd\u8981\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u662f\u72ec\u7acb\u7684\u903b\u8f91\uff0c\u53ef\u80fd\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\uff0c\u8fd9\u6837\u5c31\u9020\u6210\u4e24\u4efd\u65e5\u5fd7\u4e4b\u95f4\u7684\u903b\u8f91\u4e0d\u4e00\u81f4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe id = 1 \u8fd9\u884c\u6570\u636e\u7684\u5b57\u6bb5 name \u7684\u503c\u539f\u672c\u662f 'jay'\uff0c\u7136\u540e\u6267\u884c UPDATE t_user SET name = 'xiaolin' WHERE id = 1; \u5982\u679c\u5728\u6301\u4e45\u5316 redo log \u548c binlog \u4e24\u4e2a\u65e5\u5fd7\u7684\u8fc7\u7a0b\u4e2d\uff0c\u51fa\u73b0\u4e86\u534a\u6210\u529f\u72b6\u6001\uff0c\u90a3\u4e48\u5c31\u6709\u4e24\u79cd\u60c5\u51b5\uff1a \u5982\u679c\u5728\u5c06 redo log \u5237\u5165\u5230\u78c1\u76d8\u4e4b\u540e\uff0c MySQL \u7a81\u7136\u5b95\u673a\u4e86\uff0c\u800c binlog \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165 \u3002MySQL \u91cd\u542f\u540e\uff0c\u901a\u8fc7 redo log \u80fd\u5c06 Buffer Pool \u4e2d id = 1 \u8fd9\u884c\u6570\u636e\u7684 name \u5b57\u6bb5\u6062\u590d\u5230\u65b0\u503c xiaolin\uff0c\u4f46\u662f binlog \u91cc\u9762\u6ca1\u6709\u8bb0\u5f55\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u5728\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0cbinlog \u4f1a\u88ab\u590d\u5236\u5230\u4ece\u5e93\uff0c\u7531\u4e8e binlog \u4e22\u5931\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u4ece\u5e93\u7684\u8fd9\u4e00\u884c name \u5b57\u6bb5\u662f\u65e7\u503c jay\uff0c\u4e0e\u4e3b\u5e93\u7684\u503c\u4e0d\u4e00\u81f4\u6027\uff1b \u5982\u679c\u5728\u5c06 binlog \u5237\u5165\u5230\u78c1\u76d8\u4e4b\u540e\uff0c MySQL \u7a81\u7136\u5b95\u673a\u4e86\uff0c\u800c redo log \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165 \u3002\u7531\u4e8e redo log \u8fd8\u6ca1\u5199\uff0c\u5d29\u6e83\u6062\u590d\u4ee5\u540e\u8fd9\u4e2a\u4e8b\u52a1\u65e0\u6548\uff0c\u6240\u4ee5 id = 1 \u8fd9\u884c\u6570\u636e\u7684 name \u5b57\u6bb5\u8fd8\u662f\u65e7\u503c jay\uff0c\u800c binlog \u91cc\u9762\u8bb0\u5f55\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u5728\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0cbinlog \u4f1a\u88ab\u590d\u5236\u5230\u4ece\u5e93\uff0c\u4ece\u5e93\u6267\u884c\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u90a3\u4e48\u8fd9\u4e00\u884c name \u5b57\u6bb5\u662f\u65b0\u503c xiaolin\uff0c\u4e0e\u4e3b\u5e93\u7684\u503c\u4e0d\u4e00\u81f4\u6027\uff1b \u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6301\u4e45\u5316 redo log \u548c binlog \u8fd9\u4e24\u4efd\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5982\u679c\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u4ece\u73af\u5883\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u3002\u8fd9\u662f\u56e0\u4e3a redo log \u5f71\u54cd\u4e3b\u5e93\u7684\u6570\u636e\uff0cbinlog \u5f71\u54cd\u4ece\u5e93\u7684\u6570\u636e\uff0c\u6240\u4ee5 redo log \u548c binlog \u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u624d\u80fd\u4fdd\u8bc1\u4e3b\u4ece\u6570\u636e\u4e00\u81f4\u3002 MySQL \u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u4e24\u4efd\u65e5\u5fd7\u4e4b\u95f4\u7684\u903b\u8f91\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u4f7f\u7528\u4e86\u300c\u4e24\u9636\u6bb5\u63d0\u4ea4\u300d\u6765\u89e3\u51b3 \uff0c\u4e24\u9636\u6bb5\u63d0\u4ea4\u5176\u5b9e\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u591a\u4e2a\u903b\u8f91\u64cd\u4f5c\u8981\u4e0d\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e0d\u5168\u90e8\u5931\u8d25\uff0c\u4e0d\u4f1a\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\u3002 \u4e24\u9636\u6bb5\u63d0\u4ea4\u628a\u5355\u4e2a\u4e8b\u52a1\u7684\u63d0\u4ea4\u62c6\u5206\u6210\u4e86 2 \u4e2a\u9636\u6bb5\uff0c\u5206\u522b\u662f\u300c\u51c6\u5907\uff08Prepare\uff09\u9636\u6bb5\u300d\u548c\u300c\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u300d \uff0c\u6bcf\u4e2a\u9636\u6bb5\u90fd\u7531\u534f\u8c03\u8005\uff08Coordinator\uff09\u548c\u53c2\u4e0e\u8005\uff08Participant\uff09\u5171\u540c\u5b8c\u6210\u3002\u6ce8\u610f\uff0c\u4e0d\u8981\u628a\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u548c commit \u8bed\u53e5\u6df7\u6dc6\u4e86\uff0ccommit \u8bed\u53e5\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u5305\u542b\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u3002 \u4e3e\u4e2a\u62f3\u51fb\u6bd4\u8d5b\u7684\u4f8b\u5b50\uff0c\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u5f00\u59cb\u6bd4\u8d5b\u4e4b\u524d\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u5728\u4e2d\u95f4\u786e\u8ba4\u4e24\u4f4d\u62f3\u51fb\u624b\u7684\u72b6\u6001\uff0c\u7c7b\u4f3c\u4e8e\u95ee\u4f60\u51c6\u5907\u597d\u4e86\u5417\uff1f \u51c6\u5907\u9636\u6bb5 \uff1a\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u4f9d\u6b21\u8be2\u95ee\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u662f\u5426\u51c6\u5907\u597d\u4e86\uff0c\u7136\u540e\u62f3\u51fb\u624b\u542c\u5230\u540e\u505a\u51fa\u5e94\u7b54\uff0c\u5982\u679c\u89c9\u5f97\u81ea\u5df1\u51c6\u5907\u597d\u4e86\uff0c\u5c31\u4f1a\u8ddf\u88c1\u5224\u8bf4\u51c6\u5907\u597d\u4e86\uff1b\u5982\u679c\u6ca1\u6709\u81ea\u5df1\u8fd8\u6ca1\u6709\u51c6\u5907\u597d\uff08\u6bd4\u5982\u62f3\u5957\u8fd8\u6ca1\u6709\u5e26\u597d\uff09\uff0c\u5c31\u4f1a\u8ddf\u88c1\u5224\u8bf4\u8fd8\u6ca1\u51c6\u5907\u597d\u3002 \u63d0\u4ea4\u9636\u6bb5 \uff1a\u5982\u679c\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u90fd\u56de\u7b54\u51c6\u5907\u597d\u4e86\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u5ba3\u5e03\u6bd4\u8d5b\u6b63\u5f0f\u5f00\u59cb\uff0c\u4e24\u4f4d\u62f3\u51fb\u624b\u5c31\u53ef\u4ee5\u76f4\u63a5\u5f00\u6253\uff1b\u5982\u679c\u4efb\u4f55\u4e00\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u56de\u7b54\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u5ba3\u5e03\u6bd4\u8d5b\u6682\u505c\uff0c\u5bf9\u5e94\u4e8b\u52a1\u4e2d\u7684\u56de\u6eda\u64cd\u4f5c\u3002","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u4e24\u9636\u6bb5\u63d0\u4ea4\uff1f"},{"location":"mysql/log/how_update/#_3","text":"\u5728 MySQL \u7684 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u5f00\u542f binlog \u7684\u60c5\u51b5\u4e0b\uff0cMySQL \u4f1a\u540c\u65f6\u7ef4\u62a4 binlog \u65e5\u5fd7\u4e0e InnoDB \u7684 redo log\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u4e24\u4e2a\u65e5\u5fd7\u7684\u4e00\u81f4\u6027\uff0cMySQL \u4f7f\u7528\u4e86**\u5185\u90e8 XA \u4e8b\u52a1**\uff08\u662f\u7684\uff0c\u4e5f\u6709\u5916\u90e8 XA \u4e8b\u52a1\uff0c\u8ddf\u672c\u6587\u4e0d\u592a\u76f8\u5173\uff0c\u6211\u5c31\u4e0d\u4ecb\u7ecd\u4e86\uff09\uff0c\u5185\u90e8 XA \u4e8b\u52a1\u7531 binlog \u4f5c\u4e3a\u534f\u8c03\u8005\uff0c\u5b58\u50a8\u5f15\u64ce\u662f\u53c2\u4e0e\u8005\u3002 \u5f53\u5ba2\u6237\u7aef\u6267\u884c commit \u8bed\u53e5\u6216\u8005\u5728\u81ea\u52a8\u63d0\u4ea4\u7684\u60c5\u51b5\u4e0b\uff0cMySQL \u5185\u90e8\u5f00\u542f\u4e00\u4e2a XA \u4e8b\u52a1\uff0c \u5206\u4e24\u9636\u6bb5\u6765\u5b8c\u6210 XA \u4e8b\u52a1\u7684\u63d0\u4ea4 \uff0c\u5982\u4e0b\u56fe\uff1a \u4ece\u56fe\u4e2d\u53ef\u770b\u51fa\uff0c\u4e8b\u52a1\u7684\u63d0\u4ea4\u8fc7\u7a0b\u6709\u4e24\u4e2a\u9636\u6bb5\uff0c\u5c31\u662f**\u5c06 redo log \u7684\u5199\u5165\u62c6\u6210\u4e86\u4e24\u4e2a\u6b65\u9aa4\uff1aprepare \u548c commit\uff0c\u4e2d\u95f4\u518d\u7a7f\u63d2\u5199\u5165binlog**\uff0c\u5177\u4f53\u5982\u4e0b\uff1a prepare \u9636\u6bb5 \uff1a\u5c06 XID\uff08\u5185\u90e8 XA \u4e8b\u52a1\u7684 ID\uff09 \u5199\u5165\u5230 redo log\uff0c\u540c\u65f6\u5c06 redo log \u5bf9\u5e94\u7684\u4e8b\u52a1\u72b6\u6001\u8bbe\u7f6e\u4e3a prepare\uff0c\u7136\u540e\u5c06 redo log \u5237\u65b0\u5230\u786c\u76d8\uff1b commit \u9636\u6bb5 \uff1a\u628a XID \u5199\u5165\u5230 binlog\uff0c\u7136\u540e\u5c06 binlog \u5237\u65b0\u5230\u78c1\u76d8\uff0c\u63a5\u7740\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\uff08\u5c06\u4e8b\u52a1\u8bbe\u7f6e\u4e3a commit \u72b6\u6001\u540e\uff0c\u5237\u5165\u5230\u78c1\u76d8 redo log \u6587\u4ef6\uff0c\u6240\u4ee5 commit \u72b6\u6001\u4e5f\u662f\u4f1a\u5237\u76d8\u7684\uff09\uff1b","title":"\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f"},{"location":"mysql/log/how_update/#_4","text":"\u6211\u4eec\u6765\u770b\u770b\u5728\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u4e0d\u540c\u65f6\u523b\uff0cMySQL \u5f02\u5e38\u91cd\u542f\u4f1a\u51fa\u73b0\u4ec0\u4e48\u73b0\u8c61\uff1f\u4e0b\u56fe\u4e2d\u6709\u65f6\u523b A \u548c\u65f6\u523b B \u90fd\u6709\u53ef\u80fd\u53d1\u751f\u5d29\u6e83\uff1a \u4e0d\u7ba1\u662f\u65f6\u523b A\uff08\u5df2\u7ecf redo log\uff0c\u8fd8\u6ca1\u5199\u5165 binlog\uff09\uff0c\u8fd8\u662f\u65f6\u523b B \uff08\u5df2\u7ecf\u5199\u5165 redo log \u548c binlog\uff0c\u8fd8\u6ca1\u5199\u5165 commit \u6807\u8bc6\uff09\u5d29\u6e83\uff0c \u6b64\u65f6\u7684 redo log \u90fd\u5904\u4e8e prepare \u72b6\u6001 \u3002 \u5728 MySQL \u91cd\u542f\u540e\u4f1a\u6309\u987a\u5e8f\u626b\u63cf redo log \u6587\u4ef6\uff0c\u78b0\u5230\u5904\u4e8e prepare \u72b6\u6001\u7684 redo log\uff0c\u5c31\u62ff\u7740 redo log \u4e2d\u7684 XID \u53bb binlog \u67e5\u770b\u662f\u5426\u5b58\u5728\u6b64 XID\uff1a \u5982\u679c binlog \u4e2d\u6ca1\u6709\u5f53\u524d\u5185\u90e8 XA \u4e8b\u52a1\u7684 XID\uff0c\u8bf4\u660e redolog \u5b8c\u6210\u5237\u76d8\uff0c\u4f46\u662f binlog \u8fd8\u6ca1\u6709\u5237\u76d8\uff0c\u5219\u56de\u6eda\u4e8b\u52a1 \u3002\u5bf9\u5e94\u65f6\u523b A \u5d29\u6e83\u6062\u590d\u7684\u60c5\u51b5\u3002 \u5982\u679c binlog \u4e2d\u6709\u5f53\u524d\u5185\u90e8 XA \u4e8b\u52a1\u7684 XID\uff0c\u8bf4\u660e redolog \u548c binlog \u90fd\u5df2\u7ecf\u5b8c\u6210\u4e86\u5237\u76d8\uff0c\u5219\u63d0\u4ea4\u4e8b\u52a1 \u3002\u5bf9\u5e94\u65f6\u523b B \u5d29\u6e83\u6062\u590d\u7684\u60c5\u51b5\u3002 \u53ef\u4ee5\u770b\u5230\uff0c \u5bf9\u4e8e\u5904\u4e8e prepare \u9636\u6bb5\u7684 redo log\uff0c\u5373\u53ef\u4ee5\u63d0\u4ea4\u4e8b\u52a1\uff0c\u4e5f\u53ef\u4ee5\u56de\u6eda\u4e8b\u52a1\uff0c\u8fd9\u53d6\u51b3\u4e8e\u662f\u5426\u80fd\u5728 binlog \u4e2d\u67e5\u627e\u5230\u4e0e redo log \u76f8\u540c\u7684 XID \uff0c\u5982\u679c\u6709\u5c31\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u56de\u6eda\u4e8b\u52a1\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1 redo log \u548c binlog \u8fd9\u4e24\u4efd\u65e5\u5fd7\u7684\u4e00\u81f4\u6027\u4e86\u3002 \u6240\u4ee5\u8bf4\uff0c \u4e24\u9636\u6bb5\u63d0\u4ea4\u662f\u4ee5 binlog \u5199\u6210\u529f\u4e3a\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u7684\u6807\u8bc6 \uff0c\u56e0\u4e3a binlog \u5199\u6210\u529f\u4e86\uff0c\u5c31\u610f\u5473\u7740\u80fd\u5728 binlog \u4e2d\u67e5\u627e\u5230\u4e0e redo log \u76f8\u540c\u7684 XID\u3002 \u5904\u4e8e prepare \u9636\u6bb5\u7684 redo log \u52a0\u4e0a\u5b8c\u6574 binlog\uff0c\u91cd\u542f\u5c31\u63d0\u4ea4\u4e8b\u52a1\uff0cMySQL \u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1? binlog \u5df2\u7ecf\u5199\u5165\u4e86\uff0c\u4e4b\u540e\u5c31\u4f1a\u88ab\u4ece\u5e93\uff08\u6216\u8005\u7528\u8fd9\u4e2a binlog \u6062\u590d\u51fa\u6765\u7684\u5e93\uff09\u4f7f\u7528\u3002 \u6240\u4ee5\uff0c\u5728\u4e3b\u5e93\u4e0a\u4e5f\u8981\u63d0\u4ea4\u8fd9\u4e2a\u4e8b\u52a1\u3002\u91c7\u7528\u8fd9\u4e2a\u7b56\u7565\uff0c\u4e3b\u5e93\u548c\u5907\u5e93\u7684\u6570\u636e\u5c31\u4fdd\u8bc1\u4e86\u4e00\u81f4\u6027\u3002 \u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0credo log \u4f1a\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5417\uff1f \u4f1a\u7684\u3002 \u4e8b\u52a1\u6267\u884c\u4e2d\u95f4\u8fc7\u7a0b\u7684 redo log \u4e5f\u662f\u76f4\u63a5\u5199\u5728 redo log buffer \u4e2d\u7684\uff0c\u8fd9\u4e9b\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u4e5f\u4f1a\u88ab\u300c\u540e\u53f0\u7ebf\u7a0b\u300d\u6bcf\u9694\u4e00\u79d2\u4e00\u8d77\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0credo log \u4e5f\u662f\u53ef\u80fd\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u3002 \u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u95ee\uff0c\u5982\u679c mysql \u5d29\u6e83\u4e86\uff0c\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u7684 redo log \u5df2\u7ecf\u88ab\u6301\u4e45\u5316\u78c1\u76d8\u4e86\uff0cmysql \u91cd\u542f\u540e\uff0c\u6570\u636e\u4e0d\u5c31\u4e0d\u4e00\u81f4\u4e86\uff1f \u653e\u5fc3\uff0c\u8fd9\u79cd\u60c5\u51b5 mysql \u91cd\u542f\u4f1a\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\uff0c\u56e0\u4e3a\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0cbinlog \u662f\u8fd8\u6ca1\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u3002 \u6240\u4ee5\uff0c redo log \u53ef\u4ee5\u5728\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u4e4b\u524d\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u4f46\u662f binlog \u5fc5\u987b\u5728\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0c\u624d\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002","title":"\u5f02\u5e38\u91cd\u542f\u4f1a\u51fa\u73b0\u4ec0\u4e48\u73b0\u8c61\uff1f"},{"location":"mysql/log/how_update/#_5","text":"\u4e24\u9636\u6bb5\u63d0\u4ea4\u867d\u7136\u4fdd\u8bc1\u4e86\u4e24\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u6027\u80fd\u5f88\u5dee\uff0c\u4e3b\u8981\u6709\u4e24\u4e2a\u65b9\u9762\u7684\u5f71\u54cd\uff1a \u78c1\u76d8 I/O \u6b21\u6570\u9ad8 \uff1a\u5bf9\u4e8e\u201c\u53cc1\u201d\u914d\u7f6e\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u90fd\u4f1a\u8fdb\u884c\u4e24\u6b21 fsync\uff08\u5237\u76d8\uff09\uff0c\u4e00\u6b21\u662f redo log \u5237\u76d8\uff0c\u53e6\u4e00\u6b21\u662f binlog \u5237\u76d8\u3002 \u9501\u7ade\u4e89\u6fc0\u70c8 \uff1a\u4e24\u9636\u6bb5\u63d0\u4ea4\u867d\u7136\u80fd\u591f\u4fdd\u8bc1\u300c\u5355\u4e8b\u52a1\u300d\u4e24\u4e2a\u65e5\u5fd7\u7684\u5185\u5bb9\u4e00\u81f4\uff0c\u4f46\u5728\u300c\u591a\u4e8b\u52a1\u300d\u7684\u60c5\u51b5\u4e0b\uff0c\u5374\u4e0d\u80fd\u4fdd\u8bc1\u4e24\u8005\u7684\u63d0\u4ea4\u987a\u5e8f\u4e00\u81f4\uff0c\u56e0\u6b64\uff0c\u5728\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u6d41\u7a0b\u57fa\u7840\u4e0a\uff0c\u8fd8\u9700\u8981\u52a0\u4e00\u4e2a\u9501\u6765\u4fdd\u8bc1\u63d0\u4ea4\u7684\u539f\u5b50\u6027\uff0c\u4ece\u800c\u4fdd\u8bc1\u591a\u4e8b\u52a1\u7684\u60c5\u51b5\u4e0b\uff0c\u4e24\u4e2a\u65e5\u5fd7\u7684\u63d0\u4ea4\u987a\u5e8f\u4e00\u81f4\u3002 \u4e3a\u4ec0\u4e48\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4f1a\u5f88\u9ad8\uff1f binlog \u548c redo log \u5728\u5185\u5b58\u4e2d\u90fd\u5bf9\u5e94\u7684\u7f13\u5b58\u7a7a\u95f4\uff0cbinlog \u4f1a\u7f13\u5b58\u5728 binlog cache\uff0credo log \u4f1a\u7f13\u5b58\u5728 redo log buffer\uff0c\u5b83\u4eec\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u65f6\u673a\u5206\u522b\u7531\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u63a7\u5236\u3002\u4e00\u822c\u6211\u4eec\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u4e22\u5931\u7684\u98ce\u9669\uff0c\u4f1a\u5c06\u8fd9\u4e24\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff1a \u5f53 sync_binlog = 1 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a\u5c06 binlog cache \u91cc\u7684 binlog \u76f4\u63a5\u6301\u4e45\u5230\u78c1\u76d8\uff1b \u5f53 innodb_flush_log_at_trx_commit = 1 \u65f6\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u5c06\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff1b \u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c sync_binlog \u548c \u5f53 innodb_flush_log_at_trx_commit \u90fd\u8bbe\u7f6e\u4e3a 1\uff0c\u90a3\u4e48\u5728\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u8fc7\u7a0b\u4e2d\uff0c \u90fd\u4f1a\u81f3\u5c11\u8c03\u7528 2 \u6b21\u5237\u76d8\u64cd\u4f5c\uff0c\u4e00\u6b21\u662f redo log \u5237\u76d8\uff0c\u4e00\u6b21\u662f binlog \u843d\u76d8\uff0c\u6240\u4ee5\u8fd9\u4f1a\u6210\u4e3a\u6027\u80fd\u74f6\u9888\u3002 \u4e3a\u4ec0\u4e48\u9501\u7ade\u4e89\u6fc0\u70c8\uff1f \u5728\u65e9\u671f\u7684 MySQL \u7248\u672c\u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528 prepare_commit_mutex \u9501\u6765\u4fdd\u8bc1\u4e8b\u52a1\u63d0\u4ea4\u7684\u987a\u5e8f\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u5230\u9501\u65f6\u624d\u80fd\u8fdb\u5165 prepare \u9636\u6bb5\uff0c\u4e00\u76f4\u5230 commit \u9636\u6bb5\u7ed3\u675f\u624d\u80fd\u91ca\u653e\u9501\uff0c\u4e0b\u4e2a\u4e8b\u52a1\u624d\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c prepare \u64cd\u4f5c\u3002 \u901a\u8fc7\u52a0\u9501\u867d\u7136\u5b8c\u7f8e\u5730\u89e3\u51b3\u4e86\u987a\u5e8f\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u4f46\u5728\u5e76\u53d1\u91cf\u8f83\u5927\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5bf9\u9501\u7684\u4e89\u7528\uff0c\u6027\u80fd\u4e0d\u4f73\u3002","title":"\u4e24\u9636\u6bb5\u63d0\u4ea4\u6709\u4ec0\u4e48\u95ee\u9898\uff1f"},{"location":"mysql/log/how_update/#_6","text":"MySQL \u5f15\u5165\u4e86 binlog \u7ec4\u63d0\u4ea4\uff08group commit\uff09\u673a\u5236\uff0c\u5f53\u6709\u591a\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u591a\u4e2a binlog \u5237\u76d8\u64cd\u4f5c\u5408\u5e76\u6210\u4e00\u4e2a\uff0c\u4ece\u800c\u51cf\u5c11\u78c1\u76d8 I/O \u7684\u6b21\u6570 \uff0c\u5982\u679c\u8bf4 10 \u4e2a\u4e8b\u52a1\u4f9d\u6b21\u6392\u961f\u5237\u76d8\u7684\u65f6\u95f4\u6210\u672c\u662f 10\uff0c\u90a3\u4e48\u5c06\u8fd9 10 \u4e2a\u4e8b\u52a1\u4e00\u6b21\u6027\u4e00\u8d77\u5237\u76d8\u7684\u65f6\u95f4\u6210\u672c\u5219\u8fd1\u4f3c\u4e8e 1\u3002 \u5f15\u5165\u4e86\u7ec4\u63d0\u4ea4\u673a\u5236\u540e\uff0cprepare \u9636\u6bb5\u4e0d\u53d8\uff0c\u53ea\u9488\u5bf9 commit \u9636\u6bb5\uff0c\u5c06 commit \u9636\u6bb5\u62c6\u5206\u4e3a\u4e09\u4e2a\u8fc7\u7a0b\uff1a flush \u9636\u6bb5 \uff1a\u591a\u4e2a\u4e8b\u52a1\u6309\u8fdb\u5165\u7684\u987a\u5e8f\u5c06 binlog \u4ece cache \u5199\u5165\u6587\u4ef6\uff08\u4e0d\u5237\u76d8\uff09\uff1b sync \u9636\u6bb5 \uff1a\u5bf9 binlog \u6587\u4ef6\u505a fsync \u64cd\u4f5c\uff08\u591a\u4e2a\u4e8b\u52a1\u7684 binlog \u5408\u5e76\u4e00\u6b21\u5237\u76d8\uff09\uff1b commit \u9636\u6bb5 \uff1a\u5404\u4e2a\u4e8b\u52a1\u6309\u987a\u5e8f\u505a InnoDB commit \u64cd\u4f5c\uff1b \u4e0a\u9762\u7684**\u6bcf\u4e2a\u9636\u6bb5\u90fd\u6709\u4e00\u4e2a\u961f\u5217**\uff0c\u6bcf\u4e2a\u9636\u6bb5\u6709\u9501\u8fdb\u884c\u4fdd\u62a4\uff0c\u56e0\u6b64\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u5199\u5165\u7684\u987a\u5e8f\uff0c\u7b2c\u4e00\u4e2a\u8fdb\u5165\u961f\u5217\u7684\u4e8b\u52a1\u4f1a\u6210\u4e3a leader\uff0cleader\u9886\u5bfc\u6240\u5728\u961f\u5217\u7684\u6240\u6709\u4e8b\u52a1\uff0c\u5168\u6743\u8d1f\u8d23\u6574\u961f\u7684\u64cd\u4f5c\uff0c\u5b8c\u6210\u540e\u901a\u77e5\u961f\u5185\u5176\u4ed6\u4e8b\u52a1\u64cd\u4f5c\u7ed3\u675f\u3002 \u5bf9\u6bcf\u4e2a\u9636\u6bb5\u5f15\u5165\u4e86\u961f\u5217\u540e\uff0c\u9501\u5c31\u53ea\u9488\u5bf9\u6bcf\u4e2a\u961f\u5217\u8fdb\u884c\u4fdd\u62a4\uff0c\u4e0d\u518d\u9501\u4f4f\u63d0\u4ea4\u4e8b\u52a1\u7684\u6574\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u7684\u51fa\u6765\uff0c \u9501\u7c92\u5ea6\u51cf\u5c0f\u4e86\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u591a\u4e2a\u9636\u6bb5\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\uff0c\u4ece\u800c\u63d0\u5347\u6548\u7387 \u3002 \u6709 binlog \u7ec4\u63d0\u4ea4\uff0c\u90a3\u6709 redo log \u7ec4\u63d0\u4ea4\u5417\uff1f \u8fd9\u4e2a\u8981\u770b MySQL \u7248\u672c\uff0cMySQL 5.6 \u6ca1\u6709 redo log \u7ec4\u63d0\u4ea4\uff0cMySQL 5.7 \u6709 redo log \u7ec4\u63d0\u4ea4\u3002 \u5728 MySQL 5.6 \u7684\u7ec4\u63d0\u4ea4\u903b\u8f91\u4e2d\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u5404\u81ea\u6267\u884c prepare \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u5404\u81ea\u5c06 redo log \u5237\u76d8\uff0c\u8fd9\u6837\u5c31\u6ca1\u529e\u6cd5\u5bf9 redo log \u8fdb\u884c\u7ec4\u63d0\u4ea4\u3002 \u6240\u4ee5\u5728 MySQL 5.7 \u7248\u672c\u4e2d\uff0c\u505a\u4e86\u4e2a\u6539\u8fdb\uff0c\u5728 prepare \u9636\u6bb5\u4e0d\u518d\u8ba9\u4e8b\u52a1\u5404\u81ea\u6267\u884c redo log \u5237\u76d8\u64cd\u4f5c\uff0c\u800c\u662f\u63a8\u8fdf\u5230\u7ec4\u63d0\u4ea4\u7684 flush \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u8bf4 prepare \u9636\u6bb5\u878d\u5408\u5728\u4e86 flush \u9636\u6bb5\u3002 \u8fd9\u4e2a\u4f18\u5316\u662f\u5c06 redo log \u7684\u5237\u76d8\u5ef6\u8fdf\u5230\u4e86 flush \u9636\u6bb5\u4e4b\u4e2d\uff0csync \u9636\u6bb5\u4e4b\u524d\u3002\u901a\u8fc7\u5ef6\u8fdf\u5199 redo log \u7684\u65b9\u5f0f\uff0c\u4e3a redolog \u505a\u4e86\u4e00\u6b21\u7ec4\u5199\u5165\uff0c\u8fd9\u6837 binlog \u548c redo log \u90fd\u8fdb\u884c\u4e86\u4f18\u5316\u3002 \u63a5\u4e0b\u6765\u4ecb\u7ecd\u6bcf\u4e2a\u9636\u6bb5\u7684\u8fc7\u7a0b\uff0c\u6ce8\u610f\u4e0b\u9762\u7684\u8fc7\u7a0b\u9488\u5bf9\u7684\u662f\u201c\u53cc 1\u201d \u914d\u7f6e\uff08sync_binlog \u548c innodb_flush_log_at_trx_commit \u90fd\u914d\u7f6e\u4e3a 1\uff09\u3002 flush \u9636\u6bb5 \u7b2c\u4e00\u4e2a\u4e8b\u52a1\u4f1a\u6210\u4e3a flush \u9636\u6bb5\u7684 Leader\uff0c\u6b64\u65f6\u540e\u9762\u5230\u6765\u7684\u4e8b\u52a1\u90fd\u662f Follower \uff1a \u63a5\u7740\uff0c\u83b7\u53d6\u961f\u5217\u4e2d\u7684\u4e8b\u52a1\u7ec4\uff0c\u7531\u7eff\u8272\u4e8b\u52a1\u7ec4\u7684 Leader \u5bf9 rodo log \u505a\u4e00\u6b21 write + fsync\uff0c\u5373\u4e00\u6b21\u5c06\u540c\u7ec4\u4e8b\u52a1\u7684 redolog \u5237\u76d8\uff1a \u5b8c\u6210\u4e86 prepare \u9636\u6bb5\u540e\uff0c\u5c06\u7eff\u8272\u8fd9\u4e00\u7ec4\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684 binlog \u5199\u5165 binlog \u6587\u4ef6\uff08\u8c03\u7528 write\uff0c\u4e0d\u4f1a\u8c03\u7528 fsync\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5237\u76d8\uff0cbinlog \u7f13\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff09\u3002 \u4ece\u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u77e5\u9053 flush \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f**\u7528\u4e8e\u652f\u6491 redo log \u7684\u7ec4\u63d0\u4ea4**\u3002 \u5982\u679c\u5728\u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7531\u4e8e binlog \u4e2d\u6ca1\u6709\u8be5\u7ec4\u4e8b\u52a1\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5 MySQL \u4f1a\u5728\u91cd\u542f\u540e\u56de\u6eda\u8be5\u7ec4\u4e8b\u52a1\u3002 sync \u9636\u6bb5 \u7eff\u8272\u8fd9\u4e00\u7ec4\u4e8b\u52a1\u7684 binlog \u5199\u5165\u5230 binlog \u6587\u4ef6\u540e\uff0c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u6267\u884c\u5237\u76d8\u7684\u64cd\u4f5c\uff0c\u800c\u662f**\u4f1a\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4**\uff0c\u8fd9\u4e2a\u7b49\u5f85\u7684\u65f6\u957f\u7531 Binlog_group_commit_sync_delay \u53c2\u6570\u63a7\u5236\uff0c \u76ee\u7684\u662f\u4e3a\u4e86\u7ec4\u5408\u66f4\u591a\u4e8b\u52a1\u7684 binlog\uff0c\u7136\u540e\u518d\u4e00\u8d77\u5237\u76d8 \uff0c\u5982\u4e0b\u8fc7\u7a0b\uff1a \u4e0d\u8fc7\uff0c\u5728\u7b49\u5f85\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e8b\u52a1\u7684\u6570\u91cf\u63d0\u524d\u8fbe\u5230\u4e86 Binlog_group_commit_sync_no_delay_count \u53c2\u6570\u8bbe\u7f6e\u7684\u503c\uff0c\u5c31\u4e0d\u7528\u7ee7\u7eed\u7b49\u5f85\u4e86\uff0c\u5c31\u9a6c\u4e0a\u5c06 binlog \u5237\u76d8\uff0c\u5982\u4e0b\u56fe\uff1a \u4ece\u4e0a\u9762\u7684\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u77e5\u9053 sync \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f**\u7528\u4e8e\u652f\u6301 binlog \u7684\u7ec4\u63d0\u4ea4**\u3002 \u5982\u679c\u60f3\u63d0\u5347 binlog \u7ec4\u63d0\u4ea4\u7684\u6548\u679c\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u6765\u5b9e\u73b0\uff1a binlog_group_commit_sync_delay= N \uff0c\u8868\u793a\u5728\u7b49\u5f85 N \u5fae\u5999\u540e\uff0c\u76f4\u63a5\u8c03\u7528 fsync\uff0c\u5c06\u5904\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d page cache \u4e2d\u7684 binlog \u5237\u76d8\uff0c\u4e5f\u5c31\u662f\u5c06\u300c binlog \u6587\u4ef6\u300d\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 binlog_group_commit_sync_no_delay_count = N \uff0c\u8868\u793a\u5982\u679c\u961f\u5217\u4e2d\u7684\u4e8b\u52a1\u6570\u8fbe\u5230 N \u4e2a\uff0c\u5c31\u5ffd\u89c6binlog_group_commit_sync_delay \u7684\u8bbe\u7f6e\uff0c\u76f4\u63a5\u8c03\u7528 fsync\uff0c\u5c06\u5904\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d page cache \u4e2d\u7684 binlog \u5237\u76d8\u3002 \u5982\u679c\u5728\u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7531\u4e8e binlog \u4e2d\u5df2\u7ecf\u6709\u4e86\u4e8b\u52a1\u8bb0\u5f55\uff0cMySQL\u4f1a\u5728\u91cd\u542f\u540e\u901a\u8fc7 redo log \u5237\u76d8\u7684\u6570\u636e\u7ee7\u7eed\u8fdb\u884c\u4e8b\u52a1\u7684\u63d0\u4ea4\u3002 commit \u9636\u6bb5 \u6700\u540e\u8fdb\u5165 commit \u9636\u6bb5\uff0c\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\u3002 commit \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f\u627f\u63a5 sync \u9636\u6bb5\u7684\u4e8b\u52a1\uff0c\u5b8c\u6210\u6700\u540e\u7684\u5f15\u64ce\u63d0\u4ea4\uff0c\u4f7f\u5f97 sync \u53ef\u4ee5\u5c3d\u65e9\u7684\u5904\u7406\u4e0b\u4e00\u7ec4\u4e8b\u52a1\uff0c\u6700\u5927\u5316\u7ec4\u63d0\u4ea4\u7684\u6548\u7387\u3002","title":"\u7ec4\u63d0\u4ea4"},{"location":"mysql/log/how_update/#mysql-io","text":"\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e8b\u52a1\u5728\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u9700\u8981\u5c06 binlog \u548c redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u90a3\u4e48\u5982\u679c\u51fa\u73b0 MySQL \u78c1\u76d8 I/O \u5f88\u9ad8\u7684\u73b0\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u4ee5\u4e0b\u53c2\u6570\uff0c\u6765 \u201c\u5ef6\u8fdf\u201d binlog \u548c redo log \u5237\u76d8\u7684\u65f6\u673a\uff0c\u4ece\u800c\u964d\u4f4e\u78c1\u76d8 I/O \u7684\u9891\u7387\uff1a \u8bbe\u7f6e\u7ec4\u63d0\u4ea4\u7684\u4e24\u4e2a\u53c2\u6570\uff1a binlog_group_commit_sync_delay \u548c binlog_group_commit_sync_no_delay_count \u53c2\u6570\uff0c\u5ef6\u8fdf binlog \u5237\u76d8\u7684\u65f6\u673a\uff0c\u4ece\u800c\u51cf\u5c11 binlog \u7684\u5237\u76d8\u6b21\u6570\u3002\u8fd9\u4e2a\u65b9\u6cd5\u662f\u57fa\u4e8e\u201c\u989d\u5916\u7684\u6545\u610f\u7b49\u5f85\u201d\u6765\u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u589e\u52a0\u8bed\u53e5\u7684\u54cd\u5e94\u65f6\u95f4\uff0c\u4f46\u5373\u4f7f MySQL \u8fdb\u7a0b\u4e2d\u9014\u6302\u4e86\uff0c\u4e5f\u6ca1\u6709\u4e22\u5931\u6570\u636e\u7684\u98ce\u9669\uff0c\u56e0\u4e3a binlog \u65e9\u88ab\u5199\u5165\u5230 page cache \u4e86\uff0c\u53ea\u8981\u7cfb\u7edf\u6ca1\u6709\u5b95\u673a\uff0c\u7f13\u5b58\u5728 page cache \u91cc\u7684 binlog \u5c31\u4f1a\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u5c06 sync_binlog \u8bbe\u7f6e\u4e3a\u5927\u4e8e 1 \u7684\u503c\uff08\u6bd4\u8f83\u5e38\u89c1\u662f 100~1000\uff09\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd write\uff0c\u4f46\u7d2f\u79ef N \u4e2a\u4e8b\u52a1\u540e\u624d fsync\uff0c\u76f8\u5f53\u4e8e\u5ef6\u8fdf\u4e86 binlog \u5237\u76d8\u7684\u65f6\u673a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u98ce\u9669\u662f\uff0c\u4e3b\u673a\u6389\u7535\u65f6\u4f1a\u4e22 N \u4e2a\u4e8b\u52a1\u7684 binlog \u65e5\u5fd7\u3002 \u5c06 innodb_flush_log_at_trx_commit \u8bbe\u7f6e\u4e3a 2\u3002\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u53ea\u662f\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u5199\u5230 redo log \u6587\u4ef6\uff0c\u6ce8\u610f\u5199\u5165\u5230\u300c redo log \u6587\u4ef6\u300d\u5e76\u4e0d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u78c1\u76d8\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u4e2a Page Cache\uff0c\u4e13\u95e8\u7528\u6765\u7f13\u5b58\u6587\u4ef6\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5199\u5165\u300c redo log\u6587\u4ef6\u300d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7f13\u5b58\uff0c\u7136\u540e\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u65f6\u673a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u98ce\u9669\u662f\uff0c\u4e3b\u673a\u6389\u7535\u7684\u65f6\u5019\u4f1a\u4e22\u6570\u636e\u3002","title":"MySQL \u78c1\u76d8 I/O \u5f88\u9ad8\uff0c\u6709\u4ec0\u4e48\u4f18\u5316\u7684\u65b9\u6cd5\uff1f"},{"location":"mysql/log/how_update/#_7","text":"\u5177\u4f53\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55 UPDATE t_user SET name = 'xiaolin' WHERE id = 1; \u7684\u6d41\u7a0b\u5982\u4e0b: \u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u4f1a\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\uff0c\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u6811\u641c\u7d22\u83b7\u53d6 id = 1 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1a \u5982\u679c id=1 \u8fd9\u4e00\u884c\u6240\u5728\u7684\u6570\u636e\u9875\u672c\u6765\u5c31\u5728 buffer pool \u4e2d\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7ed9\u6267\u884c\u5668\u66f4\u65b0\uff1b \u5982\u679c\u8bb0\u5f55\u4e0d\u5728 buffer pool\uff0c\u5c06\u6570\u636e\u9875\u4ece\u78c1\u76d8\u8bfb\u5165\u5230 buffer pool\uff0c\u8fd4\u56de\u8bb0\u5f55\u7ed9\u6267\u884c\u5668\u3002 \u6267\u884c\u5668\u5f97\u5230\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u540e\uff0c\u4f1a\u770b\u4e00\u4e0b\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u662f\u5426\u4e00\u6837\uff1a \u5982\u679c\u4e00\u6837\u7684\u8bdd\u5c31\u4e0d\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u6d41\u7a0b\uff1b \u5982\u679c\u4e0d\u4e00\u6837\u7684\u8bdd\u5c31\u628a\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u90fd\u5f53\u4f5c\u53c2\u6570\u4f20\u7ed9 InnoDB \u5c42\uff0c\u8ba9 InnoDB \u771f\u6b63\u7684\u6267\u884c\u66f4\u65b0\u8bb0\u5f55\u7684\u64cd\u4f5c\uff1b \u5f00\u542f\u4e8b\u52a1\uff0c InnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u56e0\u4e3a\u8fd9\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\uff0c\u4e0d\u8fc7\u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log\u3002 InnoDB \u5c42\u5f00\u59cb\u66f4\u65b0\u8bb0\u5f55\uff0c\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u5199\u5230 redo log \u91cc\u9762\uff0c\u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86\u3002\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002\u8fd9\u5c31\u662f WAL \u6280\u672f \uff0cMySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199 redo \u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5c06\u4fee\u6539\u7684\u884c\u6570\u636e\u5199\u5230\u78c1\u76d8\u4e0a\u3002 \u81f3\u6b64\uff0c\u4e00\u6761\u8bb0\u5f55\u66f4\u65b0\u5b8c\u4e86\u3002 \u5728\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7136\u540e\u5f00\u59cb\u8bb0\u5f55\u8be5\u8bed\u53e5\u5bf9\u5e94\u7684 binlog\uff0c\u6b64\u65f6\u8bb0\u5f55\u7684 binlog \u4f1a\u88ab\u4fdd\u5b58\u5230 binlog cache\uff0c\u5e76\u6ca1\u6709\u5237\u65b0\u5230\u786c\u76d8\u4e0a\u7684 binlog \u6587\u4ef6\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u624d\u4f1a\u7edf\u4e00\u5c06\u8be5\u4e8b\u52a1\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709 binlog \u5237\u65b0\u5230\u786c\u76d8\u3002 \u4e8b\u52a1\u63d0\u4ea4\uff08\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\uff0c\u8fd9\u91cc\u4e0d\u8bf4\u7ec4\u63d0\u4ea4\u7684\u8fc7\u7a0b\uff0c\u53ea\u8bf4\u4e24\u9636\u6bb5\u63d0\u4ea4\uff09\uff1a prepare \u9636\u6bb5 \uff1a\u5c06 redo log \u5bf9\u5e94\u7684\u4e8b\u52a1\u72b6\u6001\u8bbe\u7f6e\u4e3a prepare\uff0c\u7136\u540e\u5c06 redo log \u5237\u65b0\u5230\u786c\u76d8\uff1b commit \u9636\u6bb5 \uff1a\u5c06 binlog \u5237\u65b0\u5230\u78c1\u76d8\uff0c\u63a5\u7740\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\uff08\u5c06\u4e8b\u52a1\u8bbe\u7f6e\u4e3a commit \u72b6\u6001\u540e\uff0c\u5237\u5165\u5230\u78c1\u76d8 redo log \u6587\u4ef6\uff09\uff1b \u81f3\u6b64\uff0c\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u3002 \u53c2\u8003\u8d44\u6599\uff1a \u300aMySQL 45 \u8bb2\u300b \u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\uff1f\u300b https://developer.aliyun.com/article/617776 http://mysql.taobao.org/monthly/2021/10/01/ https://www.cnblogs.com/Neeo/articles/13883976.html https://www.cnblogs.com/mengxinJ/p/14211427.html \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/transaction/mvcc/","text":"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f \u00b6 \u8fd9\u662f\u6211\u7684\u94b1\u5305\uff0c\u5171\u6709 100 \u4e07\u5143\u3002 \u4eca\u5929\u6211\u5fc3\u60c5\u597d\uff0c\u6211\u51b3\u5b9a\u7ed9\u4f60\u7684\u8f6c\u8d26 100 \u4e07\uff0c\u6700\u540e\u7684\u7ed3\u679c\u80af\u5b9a\u662f\u6211\u7684\u4f59\u989d\u53d8\u4e3a 0 \u5143\uff0c\u4f60\u7684\u4f59\u989d\u591a\u4e86 100 \u4e07\u5143\uff0c\u662f\u4e0d\u662f\u60f3\u5230\u5c31\u5f88\u5f00\u5fc3\uff1f \u8f6c\u8d26\u8fd9\u4e00\u52a8\u4f5c\u5728\u7a0b\u5e8f\u91cc\u4f1a\u6d89\u53ca\u5230\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\uff0c\u5047\u8bbe\u6211\u5411\u4f60\u8f6c\u8d26 100 \u4e07\u7684\u8fc7\u7a0b\u662f\u6709\u4e0b\u9762\u8fd9\u51e0\u4e2a\u6b65\u9aa4\u7ec4\u6210\u7684\uff1a \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u8f6c\u8d26\u7684\u8fc7\u7a0b\u6d89\u53ca\u5230\u4e86\u4e24\u6b21\u4fee\u6539\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002 \u5047\u8bbe\u5728\u6267\u884c\u7b2c\u4e09\u6b65\u9aa4\u4e4b\u540e\uff0c\u670d\u52a1\u5668\u5ffd\u7136\u6389\u7535\u4e86\uff0c\u5c31\u4f1a\u53d1\u751f\u4e00\u4e2a\u86cb\u75bc\u7684\u4e8b\u60c5\uff0c\u6211\u7684\u8d26\u6237\u6263\u4e86 100 \u4e07\uff0c\u4f46\u662f\u94b1\u5e76\u6ca1\u6709\u5230\u4f60\u7684\u8d26\u6237\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4**\u8fd9 100 \u4e07\u6d88\u5931\u4e86\uff01** \u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u8981\u4fdd\u8bc1\u8f6c\u8d26\u4e1a\u52a1\u91cc\u7684\u6240\u6709\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u662f\u4e0d\u53ef\u5206\u5272\u7684\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u6210\u529f \uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\uff0c\u4e0d\u5141\u8bb8\u51fa\u73b0\u4e2d\u95f4\u72b6\u6001\u7684\u6570\u636e\u3002 \u6570\u636e\u5e93\u4e2d\u7684\u300c \u4e8b\u52a1\uff08 Transaction \uff09 \u300d\u5c31\u80fd\u8fbe\u5230\u8fd9\u6837\u7684\u6548\u679c\u3002 \u6211\u4eec\u5728\u8f6c\u8d26\u64cd\u4f5c\u524d\u5148\u5f00\u542f\u4e8b\u52a1\uff0c\u7b49\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u8be5\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u4fee\u6539\u5c06\u6c38\u4e45\u751f\u6548\uff0c\u5982\u679c\u4e2d\u9014\u53d1\u751f\u53d1\u751f\u4e2d\u65ad\u6216\u9519\u8bef\uff0c\u90a3\u4e48\u8be5\u4e8b\u52a1\u671f\u95f4\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u4fee\u6539\u5c06\u4f1a\u88ab\u56de\u6eda\u5230\u6ca1\u6267\u884c\u8be5\u4e8b\u52a1\u4e4b\u524d\u7684\u72b6\u6001\u3002 \u6ca1\u9519\uff0c\u4eca\u5929\u5c31\u6765\u56fe\u89e3 MySQL \u4e8b\u52a1\u5566\uff0c\u5f00\u8f66\uff01 \u4e8b\u52a1\u6709\u54ea\u4e9b\u7279\u6027\uff1f \u00b6 \u4e8b\u52a1\u662f\u7531 MySQL \u7684\u5f15\u64ce\u6765\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5e38\u89c1\u7684 InnoDB \u5f15\u64ce\u5b83\u662f\u652f\u6301\u4e8b\u52a1\u7684\u3002 \u4e0d\u8fc7\u5e76\u4e0d\u662f\u6240\u6709\u7684\u5f15\u64ce\u90fd\u80fd\u652f\u6301\u4e8b\u52a1\uff0c\u6bd4\u5982 MySQL \u539f\u751f\u7684 MyISAM \u5f15\u64ce\u5c31\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u4e5f\u6b63\u662f\u8fd9\u6837\uff0c\u6240\u4ee5\u5927\u591a\u6570 MySQL \u7684\u5f15\u64ce\u90fd\u662f\u7528 InnoDB\u3002 \u4e8b\u52a1\u770b\u8d77\u6765\u611f\u89c9\u7b80\u5355\uff0c\u4f46\u662f\u8981\u5b9e\u73b0\u4e8b\u52a1\u5fc5\u987b\u8981\u9075\u5b88 4 \u4e2a\u7279\u6027\uff0c\u5206\u522b\u5982\u4e0b\uff1a \u539f\u5b50\u6027\uff08Atomicity\uff09 \uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5b8c\u6210\uff0c\u4e0d\u4f1a\u7ed3\u675f\u5728\u4e2d\u95f4\u67d0\u4e2a\u73af\u8282\uff0c\u800c\u4e14\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\uff0c\u4f1a\u88ab\u56de\u6eda\u5230\u4e8b\u52a1\u5f00\u59cb\u524d\u7684\u72b6\u6001\uff0c\u5c31\u50cf\u8fd9\u4e2a\u4e8b\u52a1\u4ece\u6765\u6ca1\u6709\u6267\u884c\u8fc7\u4e00\u6837\uff0c\u5c31\u597d\u6bd4\u4e70\u4e00\u4ef6\u5546\u54c1\uff0c\u8d2d\u4e70\u6210\u529f\u65f6\uff0c\u5219\u7ed9\u5546\u5bb6\u4ed8\u4e86\u94b1\uff0c\u5546\u54c1\u5230\u624b\uff1b\u8d2d\u4e70\u5931\u8d25\u65f6\uff0c\u5219\u5546\u54c1\u5728\u5546\u5bb6\u624b\u4e2d\uff0c\u6d88\u8d39\u8005\u7684\u94b1\u4e5f\u6ca1\u82b1\u51fa\u53bb\u3002 \u4e00\u81f4\u6027\uff08Consistency\uff09 \uff1a\u662f\u6307\u4e8b\u52a1\u64cd\u4f5c\u524d\u548c\u64cd\u4f5c\u540e\uff0c\u6570\u636e\u6ee1\u8db3\u5b8c\u6574\u6027\u7ea6\u675f\uff0c\u6570\u636e\u5e93\u4fdd\u6301\u4e00\u81f4\u6027\u72b6\u6001\u3002\u6bd4\u5982\uff0c\u7528\u6237 A \u548c\u7528\u6237 B \u5728\u94f6\u884c\u5206\u522b\u6709 800 \u5143\u548c 600 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u7528\u6237 A \u7ed9\u7528\u6237 B \u8f6c\u8d26 200 \u5143\uff0c\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u4ece A \u7684\u8d26\u6237\u6263\u9664 200 \u5143\u548c\u5bf9 B \u7684\u8d26\u6237\u589e\u52a0 200 \u5143\u3002\u4e00\u81f4\u6027\u5c31\u662f\u8981\u6c42\u4e0a\u8ff0\u6b65\u9aa4\u64cd\u4f5c\u540e\uff0c\u6700\u540e\u7684\u7ed3\u679c\u662f\u7528\u6237 A \u8fd8\u6709 600 \u5143\uff0c\u7528\u6237 B \u6709 800 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u7528\u6237 A \u6263\u9664\u4e86 200 \u5143\uff0c\u4f46\u7528\u6237 B \u672a\u589e\u52a0\u7684\u60c5\u51b5\uff08\u8be5\u60c5\u51b5\uff0c\u7528\u6237 A \u548c B \u5747\u4e3a 600 \u5143\uff0c\u603b\u5171 1200 \u5143\uff09\u3002 \u9694\u79bb\u6027\uff08Isolation\uff09 \uff1a\u6570\u636e\u5e93\u5141\u8bb8\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u540c\u65f6\u5bf9\u5176\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u548c\u4fee\u6539\u7684\u80fd\u529b\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u7531\u4e8e\u4ea4\u53c9\u6267\u884c\u800c\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u591a\u4e2a\u4e8b\u52a1\u540c\u65f6\u4f7f\u7528\u76f8\u540c\u7684\u6570\u636e\u65f6\uff0c\u4e0d\u4f1a\u76f8\u4e92\u5e72\u6270\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u90fd\u6709\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u7a7a\u95f4\uff0c\u5bf9\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u662f\u9694\u79bb\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6d88\u8d39\u8005\u8d2d\u4e70\u5546\u54c1\u8fd9\u4e2a\u4e8b\u52a1\uff0c\u662f\u4e0d\u5f71\u54cd\u5176\u4ed6\u6d88\u8d39\u8005\u8d2d\u4e70\u7684\u3002 \u6301\u4e45\u6027\uff08Durability\uff09 \uff1a\u4e8b\u52a1\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u5c31\u662f\u6c38\u4e45\u7684\uff0c\u5373\u4fbf\u7cfb\u7edf\u6545\u969c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002 InnoDB \u5f15\u64ce\u901a\u8fc7\u4ec0\u4e48\u6280\u672f\u6765\u4fdd\u8bc1\u4e8b\u52a1\u7684\u8fd9\u56db\u4e2a\u7279\u6027\u7684\u5462\uff1f \u6301\u4e45\u6027\u662f\u901a\u8fc7 redo log \uff08\u91cd\u505a\u65e5\u5fd7\uff09\u6765\u4fdd\u8bc1\u7684\uff1b \u539f\u5b50\u6027\u662f\u901a\u8fc7 undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09 \u6765\u4fdd\u8bc1\u7684\uff1b \u9694\u79bb\u6027\u662f\u901a\u8fc7 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09 \u6216\u9501\u673a\u5236\u6765\u4fdd\u8bc1\u7684\uff1b \u4e00\u81f4\u6027\u5219\u662f\u901a\u8fc7\u6301\u4e45\u6027+\u539f\u5b50\u6027+\u9694\u79bb\u6027\u6765\u4fdd\u8bc1\uff1b \u8fd9\u6b21\u5c06**\u91cd\u70b9\u4ecb\u7ecd\u4e8b\u52a1\u7684\u9694\u79bb\u6027**\uff0c\u8fd9\u4e5f\u662f\u9762\u8bd5\u65f6\u6700\u5e38\u95ee\u7684\u77e5\u8bc6\u7684\u70b9\u3002 \u4e3a\u4ec0\u4e48\u4e8b\u52a1\u8981\u6709\u9694\u79bb\u6027\uff0c\u6211\u4eec\u5c31\u8981\u77e5\u9053\u5e76\u53d1\u4e8b\u52a1\u65f6\u4f1a\u5f15\u53d1\u4ec0\u4e48\u95ee\u9898\u3002 \u5e76\u884c\u4e8b\u52a1\u4f1a\u5f15\u53d1\u4ec0\u4e48\u95ee\u9898\uff1f \u00b6 MySQL \u670d\u52a1\u7aef\u662f\u5141\u8bb8\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\uff0c\u8fd9\u610f\u5473\u7740 MySQL \u4f1a\u51fa\u73b0\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4e8b\u52a1\u7684\u60c5\u51b5\u3002 \u90a3\u4e48**\u5728\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u810f\u8bfb\uff08dirty read\uff09\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\uff08non-repeatable read\uff09\u3001\u5e7b\u8bfb\uff08phantom read\uff09\u7684\u95ee\u9898**\u3002 \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u4e3e\u4f8b\u5b50\u7ed9\u5927\u5bb6\u8bf4\u660e\uff0c\u8fd9\u4e9b\u95ee\u9898\u662f\u5982\u4f55\u53d1\u751f\u7684\u3002 \u810f\u8bfb \u00b6 \u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u300c\u8bfb\u5230\u300d\u4e86\u53e6\u4e00\u4e2a\u300c\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fee\u6539\u8fc7\u7684\u6570\u636e\u300d\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u810f\u8bfb\u300d\u73b0\u8c61\u3002 \u4e3e\u4e2a\u6817\u5b50\u3002 \u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u7136\u540e\u518d\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\uff0c\u5982\u679c\u6b64\u65f6\u4e8b\u52a1 A \u8fd8\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u800c\u6b64\u65f6\u6b63\u597d\u4e8b\u52a1 B \u4e5f\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u90a3\u4e48\u4e8b\u52a1 B \u8bfb\u53d6\u5230\u7684\u4f59\u989d\u6570\u636e\u662f\u521a\u624d\u4e8b\u52a1 A \u66f4\u65b0\u540e\u7684\u6570\u636e\uff0c\u5373\u4f7f\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\u3002 \u56e0\u4e3a\u4e8b\u52a1 A \u662f\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u7684\uff0c\u4e5f\u5c31\u662f\u5b83\u968f\u65f6\u53ef\u80fd\u53d1\u751f\u56de\u6eda\u64cd\u4f5c\uff0c \u5982\u679c\u5728\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u4e8b\u52a1 A \u53d1\u751f\u4e86\u56de\u6eda\uff0c\u90a3\u4e48\u4e8b\u52a1 B \u521a\u624d\u5f97\u5230\u7684\u6570\u636e\u5c31\u662f\u8fc7\u671f\u7684\u6570\u636e\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u810f\u8bfb\u3002 \u4e0d\u53ef\u91cd\u590d\u8bfb \u00b6 \u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u4e2a\u6570\u636e\uff0c\u5982\u679c\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u8bfb\u5230\u7684\u6570\u636e\u4e0d\u4e00\u6837\u7684\u60c5\u51b5\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u4e0d\u53ef\u91cd\u590d\u8bfb\u300d\u73b0\u8c61\u3002 \u4e3e\u4e2a\u6817\u5b50\u3002 \u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\u4ee3\u7801\u903b\u8f91\u5904\u7406\uff0c \u5728\u8fd9\u8fc7\u7a0b\u4e2d\u5982\u679c\u4e8b\u52a1 B \u66f4\u65b0\u4e86\u8fd9\u6761\u6570\u636e\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u90a3\u4e48\u5f53\u4e8b\u52a1 A \u518d\u6b21\u8bfb\u53d6\u8be5\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u53d1\u73b0\u524d\u540e\u4e24\u6b21\u8bfb\u5230\u7684\u6570\u636e\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u4e0d\u53ef\u91cd\u590d\u8bfb\u3002 \u5e7b\u8bfb \u00b6 \u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\u591a\u6b21\u67e5\u8be2\u67d0\u4e2a\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u300c\u8bb0\u5f55\u6570\u91cf\u300d\uff0c\u5982\u679c\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u6837\u7684\u60c5\u51b5\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u5e7b\u8bfb\u300d\u73b0\u8c61\u3002 \u4e3e\u4e2a\u6817\u5b50\u3002 \u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u5927\u4e8e 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u53d1\u73b0\u5171\u6709 5 \u6761\uff0c\u7136\u540e\u4e8b\u52a1 B \u4e5f\u6309\u76f8\u540c\u7684\u641c\u7d22\u6761\u4ef6\u4e5f\u662f\u67e5\u8be2\u51fa\u4e86 5 \u6761\u8bb0\u5f55\u3002 \u63a5\u4e0b\u6765\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u4f59\u989d\u8d85\u8fc7 100 \u4e07\u7684\u8d26\u53f7\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u6b64\u65f6\u6570\u636e\u5e93\u8d85\u8fc7 100 \u4e07\u4f59\u989d\u7684\u8d26\u53f7\u4e2a\u6570\u5c31\u53d8\u4e3a 6\u3002 \u7136\u540e\u4e8b\u52a1 B \u518d\u6b21\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u5927\u4e8e 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u67e5\u8be2\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u6709 6 \u6761\uff0c \u53d1\u73b0\u548c\u524d\u4e00\u6b21\u8bfb\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u6837\u4e86\uff0c\u5c31\u611f\u89c9\u53d1\u751f\u4e86\u5e7b\u89c9\u4e00\u6837\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u5e7b\u8bfb\u3002 \u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u6709\u54ea\u4e9b\uff1f \u00b6 \u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u5f53\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u53ef\u80fd\u4f1a\u9047\u5230\u300c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u300d\u7684\u73b0\u8c61\uff0c\u8fd9\u4e9b\u73b0\u8c61\u4f1a\u5bf9\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u4ea7\u751f\u4e0d\u540c\u7a0b\u5e8f\u7684\u5f71\u54cd\u3002 \u810f\u8bfb\uff1a\u8bfb\u5230\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff1b \u4e0d\u53ef\u91cd\u590d\u8bfb\uff1a\u524d\u540e\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff1b \u5e7b\u8bfb\uff1a\u524d\u540e\u8bfb\u53d6\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u81f4\u3002 \u8fd9\u4e09\u4e2a\u73b0\u8c61\u7684\u4e25\u91cd\u6027\u6392\u5e8f\u5982\u4e0b\uff1a SQL \u6807\u51c6\u63d0\u51fa\u4e86\u56db\u79cd\u9694\u79bb\u7ea7\u522b\u6765\u89c4\u907f\u8fd9\u4e9b\u73b0\u8c61\uff0c\u9694\u79bb\u7ea7\u522b\u8d8a\u9ad8\uff0c\u6027\u80fd\u6548\u7387\u5c31\u8d8a\u4f4e\uff0c\u8fd9\u56db\u4e2a\u9694\u79bb\u7ea7\u522b\u5982\u4e0b\uff1a \u8bfb\u672a\u63d0\u4ea4\uff08 read uncommitted \uff09 \uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u6ca1\u63d0\u4ea4\u65f6\uff0c\u5b83\u505a\u7684\u53d8\u66f4\u5c31\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u770b\u5230\uff1b \u8bfb\u63d0\u4ea4\uff08 read committed \uff09 \uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0c\u5b83\u505a\u7684\u53d8\u66f4\u624d\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u770b\u5230\uff1b \u53ef\u91cd\u590d\u8bfb\uff08 repeatable read \uff09 \uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b \uff1b \u4e32\u884c\u5316\uff08 serializable \uff09 \uff1b\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u4e0a\u8bfb\u5199\u9501\uff0c\u5728\u591a\u4e2a\u4e8b\u52a1\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8bfb\u5199\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u540e\u8bbf\u95ee\u7684\u4e8b\u52a1\u5fc5\u987b\u7b49\u524d\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u5b8c\u6210\uff0c\u624d\u80fd\u7ee7\u7eed\u6267\u884c\uff1b \u6309\u9694\u79bb\u6c34\u5e73\u9ad8\u4f4e\u6392\u5e8f\u5982\u4e0b\uff1a \u9488\u5bf9\u4e0d\u540c\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u5e76\u53d1\u4e8b\u52a1\u65f6\u53ef\u80fd\u53d1\u751f\u7684\u73b0\u8c61\u4e5f\u4f1a\u4e0d\u540c\u3002 \u4e5f\u5c31\u662f\u8bf4\uff1a \u5728\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\uff1b \u5728\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u4e0d\u53ef\u80fd\u53d1\u751f\u810f\u8bfb\u73b0\u8c61\uff1b \u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u4e0d\u53ef\u80fd\u810f\u8bfb\u548c\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff1b \u5728\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\u90fd\u4e0d\u53ef\u80fd\u4f1a\u53d1\u751f\u3002 \u6240\u4ee5\uff0c\u8981\u89e3\u51b3\u810f\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5347\u7ea7\u5230\u300c\u8bfb\u63d0\u4ea4\u300d\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\uff1b\u8981\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5347\u7ea7\u5230\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u8981\u89e3\u51b3\u5e7b\u8bfb\u73b0\u8c61\u4e0d\u5efa\u8bae\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u300c\u4e32\u884c\u5316\u300d\u3002 \u4e0d\u540c\u7684\u6570\u636e\u5e93\u5382\u5546\u5bf9 SQL \u6807\u51c6\u4e2d\u89c4\u5b9a\u7684 4 \u79cd\u9694\u79bb\u7ea7\u522b\u7684\u652f\u6301\u4e0d\u4e00\u6837\uff0c\u6709\u7684\u6570\u636e\u5e93\u53ea\u5b9e\u73b0\u4e86\u5176\u4e2d\u51e0\u79cd\u9694\u79bb\u7ea7\u522b\uff0c \u6211\u4eec\u8ba8\u8bba\u7684 MySQL \u867d\u7136\u652f\u6301 4 \u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u4f46\u662f\u4e0eSQL \u6807\u51c6\u4e2d\u89c4\u5b9a\u7684\u5404\u7ea7\u9694\u79bb\u7ea7\u522b\u5141\u8bb8\u53d1\u751f\u7684\u73b0\u8c61\u5374\u6709\u4e9b\u51fa\u5165 \u3002 MySQL \u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff08\u6ce8\u610f\u662f\u5f88\u5927\u7a0b\u5ea6\u907f\u514d\uff0c\u5e76\u4e0d\u662f\u5f7b\u5e95\u907f\u514d\uff09\uff0c\u6240\u4ee5 MySQL \u5e76\u4e0d\u4f1a\u4f7f\u7528\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u6765\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff0c\u56e0\u4e3a\u4f7f\u7528\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4f1a\u5f71\u54cd\u6027\u80fd\u3002 MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7 \u6587\u7ae0 \uff09 \uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u63a5\u4e0b\u6765\uff0c\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u8fd9\u56db\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u6709\u4e00\u5f20\u8d26\u6237\u4f59\u989d\u8868\uff0c\u91cc\u9762\u6709\u4e00\u6761\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\u7684\u8bb0\u5f55\u3002\u7136\u540e\u6709\u4e24\u4e2a\u5e76\u53d1\u7684\u4e8b\u52a1\uff0c\u4e8b\u52a1 A \u53ea\u8d1f\u8d23\u67e5\u8be2\u4f59\u989d\uff0c\u4e8b\u52a1 B \u5219\u4f1a\u5c06\u6211\u7684\u4f59\u989d\u6539\u6210 200 \u4e07\uff0c\u4e0b\u9762\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u6267\u884c\u4e24\u4e2a\u4e8b\u52a1\u7684\u884c\u4e3a\uff1a \u5728\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u6267\u884c\u8fc7\u7a0b\u4e2d\u67e5\u8be2\u5230\u7684\u4f59\u989d\u53ef\u80fd\u4f1a\u4e0d\u540c\uff1a \u5728\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u4fee\u6539\u4f59\u989d\u540e\uff0c\u867d\u7136\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u4f46\u662f\u6b64\u65f6\u7684\u4f59\u989d\u5df2\u7ecf\u53ef\u4ee5\u88ab\u4e8b\u52a1 A \u770b\u89c1\u4e86\uff0c\u4e8e\u662f\u4e8b\u52a1 A \u4e2d\u4f59\u989d V1 \u67e5\u8be2\u7684\u503c\u662f 200 \u4e07\uff0c\u4f59\u989d V2\u3001V3 \u81ea\u7136\u4e5f\u662f 200 \u4e07\u4e86\uff1b \u5728\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u4fee\u6539\u4f59\u989d\u540e\uff0c\u56e0\u4e3a\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u6240\u4ee5\u4e8b\u52a1 A \u4e2d\u4f59\u989d V1 \u7684\u503c\u8fd8\u662f 100 \u4e07\uff0c\u7b49\u4e8b\u52a1 B \u63d0\u4ea4\u5b8c\u540e\uff0c\u6700\u65b0\u7684\u4f59\u989d\u6570\u636e\u624d\u80fd\u88ab\u4e8b\u52a1 A \u770b\u89c1\uff0c\u56e0\u6b64\u989d V2\u3001V3 \u90fd\u662f 200 \u4e07\uff1b \u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u53ea\u80fd\u770b\u89c1\u542f\u52a8\u4e8b\u52a1\u65f6\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4f59\u989d V1\u3001\u4f59\u989d V2 \u7684\u503c\u90fd\u662f 100 \u4e07\uff0c\u5f53\u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u5c31\u80fd\u770b\u89c1\u6700\u65b0\u7684\u4f59\u989d\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u4f59\u989d V3 \u7684\u503c\u662f 200 \u4e07\uff1b \u5728\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u5728\u6267\u884c\u5c06\u4f59\u989d 100 \u4e07\u4fee\u6539\u4e3a 200 \u4e07\u65f6\uff0c\u7531\u4e8e\u6b64\u524d\u4e8b\u52a1 A \u6267\u884c\u4e86\u8bfb\u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u53d1\u751f\u4e86\u8bfb\u5199\u51b2\u7a81\uff0c\u4e8e\u662f\u5c31\u4f1a\u88ab\u9501\u4f4f\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c\u4e8b\u52a1 B \u624d\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\uff0c\u6240\u4ee5\u4ece A \u7684\u89d2\u5ea6\u770b\uff0c\u4f59\u989d V1\u3001V2 \u7684\u503c\u662f 100 \u4e07\uff0c\u4f59\u989d V3 \u7684\u503c\u662f 200\u4e07\u3002 \u8fd9\u56db\u79cd\u9694\u79bb\u7ea7\u522b\u5177\u4f53\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462\uff1f \u5bf9\u4e8e\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u56e0\u4e3a\u53ef\u4ee5\u8bfb\u5230\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\uff0c\u6240\u4ee5\u76f4\u63a5\u8bfb\u53d6\u6700\u65b0\u7684\u6570\u636e\u5c31\u597d\u4e86\uff1b \u5bf9\u4e8e\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u901a\u8fc7\u52a0\u8bfb\u5199\u9501\u7684\u65b9\u5f0f\u6765\u907f\u514d\u5e76\u884c\u8bbf\u95ee\uff1b \u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u901a\u8fc7 Read View **\u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff0c\u5927\u5bb6\u53ef\u4ee5\u628a Read View \u7406\u89e3\u6210\u4e00\u4e2a\u6570\u636e\u5feb\u7167\uff0c\u5c31\u50cf\u76f8\u673a\u62cd\u7167\u90a3\u6837\uff0c\u5b9a\u683c\u67d0\u4e00\u65f6\u523b\u7684\u98ce\u666f\u3002 \u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u300c\u6bcf\u4e2a\u8bed\u53e5\u6267\u884c\u524d\u300d\u90fd\u4f1a\u91cd\u65b0\u751f\u6210\u4e00\u4e2a Read View\uff0c\u800c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u300c\u542f\u52a8\u4e8b\u52a1\u65f6\u300d\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View**\u3002 \u6ce8\u610f\uff0c\u6267\u884c\u300c\u5f00\u59cb\u4e8b\u52a1\u300d\u547d\u4ee4\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u542f\u52a8\u4e86\u4e8b\u52a1\u3002\u5728 MySQL \u6709\u4e24\u79cd\u5f00\u542f\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u5206\u522b\u662f\uff1a \u7b2c\u4e00\u79cd\uff1abegin/start transaction \u547d\u4ee4\uff1b \u7b2c\u4e8c\u79cd\uff1astart transaction with consistent snapshot \u547d\u4ee4\uff1b \u8fd9\u4e24\u79cd\u5f00\u542f\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u4e8b\u52a1\u7684\u542f\u52a8\u65f6\u673a\u662f\u4e0d\u540c\u7684\uff1a \u6267\u884c\u4e86 begin/start transaction \u547d\u4ee4\u540e\uff0c\u5e76\u4e0d\u4ee3\u8868\u4e8b\u52a1\u542f\u52a8\u4e86\u3002\u53ea\u6709\u5728\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u6267\u884c\u4e86\u589e\u5220\u67e5\u6539\u64cd\u4f5c\u7684 SQL \u8bed\u53e5\uff0c\u624d\u662f\u4e8b\u52a1\u771f\u6b63\u542f\u52a8\u7684\u65f6\u673a\uff1b \u6267\u884c\u4e86 start transaction with consistent snapshot \u547d\u4ee4\uff0c\u5c31\u4f1a\u9a6c\u4e0a\u542f\u52a8\u4e8b\u52a1\u3002 \u63a5\u4e0b\u6765\u8be6\u7ec6\u8bf4\u4e0b\uff0cRead View \u5728 MVCC \u91cc\u5982\u4f55\u5de5\u4f5c\u7684\uff1f Read View \u5728 MVCC \u91cc\u5982\u4f55\u5de5\u4f5c\u7684\uff1f \u00b6 \u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e24\u4e2a\u77e5\u8bc6\uff1a Read View \u4e2d\u56db\u4e2a\u5b57\u6bb5\u4f5c\u7528\uff1b \u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u4e24\u4e2a\u8ddf\u4e8b\u52a1\u6709\u5173\u7684\u9690\u85cf\u5217\uff1b \u90a3 Read View \u5230\u5e95\u662f\u4e2a\u4ec0\u4e48\u4e1c\u897f\uff1f Read View \u6709\u56db\u4e2a\u91cd\u8981\u7684\u5b57\u6bb5\uff1a m_ids \uff1a\u6307\u7684\u662f\u5728\u521b\u5efa Read View \u65f6\uff0c\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u300c\u6d3b\u8dc3\u4e8b\u52a1\u300d\u7684**\u4e8b\u52a1 id \u5217\u8868**\uff0c\u6ce8\u610f\u662f\u4e00\u4e2a\u5217\u8868\uff0c \u201c\u6d3b\u8dc3\u4e8b\u52a1\u201d\u6307\u7684\u5c31\u662f\uff0c\u542f\u52a8\u4e86\u4f46\u8fd8\u6ca1\u63d0\u4ea4\u7684\u4e8b\u52a1 \u3002 min_trx_id \uff1a\u6307\u7684\u662f\u5728\u521b\u5efa Read View \u65f6\uff0c\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u300c\u6d3b\u8dc3\u4e8b\u52a1\u300d\u4e2d\u4e8b\u52a1 id \u6700\u5c0f\u7684\u4e8b\u52a1 \uff0c\u4e5f\u5c31\u662f m_ids \u7684\u6700\u5c0f\u503c\u3002 max_trx_id \uff1a\u8fd9\u4e2a\u5e76\u4e0d\u662f m_ids \u7684\u6700\u5927\u503c\uff0c\u800c\u662f**\u521b\u5efa Read View \u65f6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u5e94\u8be5\u7ed9\u4e0b\u4e00\u4e2a\u4e8b\u52a1\u7684 id \u503c**\uff0c\u4e5f\u5c31\u662f\u5168\u5c40\u4e8b\u52a1\u4e2d\u6700\u5927\u7684\u4e8b\u52a1 id \u503c + 1\uff1b creator_trx_id \uff1a\u6307\u7684\u662f**\u521b\u5efa\u8be5 Read View \u7684\u4e8b\u52a1\u7684\u4e8b\u52a1 id**\u3002 \u77e5\u9053\u4e86 Read View \u7684\u5b57\u6bb5\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e86\u89e3\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\u3002 \u5047\u8bbe\u5728\u8d26\u6237\u4f59\u989d\u8868\u63d2\u5165\u4e00\u6761\u5c0f\u6797\u4f59\u989d\u4e3a 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u6211\u628a\u8fd9\u4e24\u4e2a\u9690\u85cf\u5217\u4e5f\u753b\u51fa\u6765\uff0c\u8be5\u8bb0\u5f55\u7684\u6574\u4e2a\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u5bf9\u4e8e\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u6570\u636e\u5e93\u8868\uff0c\u5b83\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u90fd\u5305\u542b\u4e0b\u9762\u4e24\u4e2a\u9690\u85cf\u5217\uff1a trx_id\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u8fdb\u884c\u6539\u52a8\u65f6\uff0c\u5c31\u4f1a**\u628a\u8be5\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u8bb0\u5f55\u5728 trx_id \u9690\u85cf\u5217\u91cc**\uff1b roll_pointer\uff0c\u6bcf\u6b21\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u8fdb\u884c\u6539\u52a8\u65f6\uff0c\u90fd\u4f1a\u628a\u65e7\u7248\u672c\u7684\u8bb0\u5f55\u5199\u5165\u5230 undo \u65e5\u5fd7\u4e2d\uff0c\u7136\u540e**\u8fd9\u4e2a\u9690\u85cf\u5217\u662f\u4e2a\u6307\u9488\uff0c\u6307\u5411\u6bcf\u4e00\u4e2a\u65e7\u7248\u672c\u8bb0\u5f55**\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u901a\u8fc7\u5b83\u627e\u5230\u4fee\u6539\u524d\u7684\u8bb0\u5f55\u3002 \u5728\u521b\u5efa Read View \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8bb0\u5f55\u4e2d\u7684 trx_id \u5212\u5206\u8fd9\u4e09\u79cd\u60c5\u51b5\uff1a \u4e00\u4e2a\u4e8b\u52a1\u53bb\u8bbf\u95ee\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u9664\u4e86\u81ea\u5df1\u7684\u66f4\u65b0\u8bb0\u5f55\u603b\u662f\u53ef\u89c1\u4e4b\u5916\uff0c\u8fd8\u6709\u8fd9\u51e0\u79cd\u60c5\u51b5\uff1a \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5c0f\u4e8e Read View \u4e2d\u7684 min_trx_id \u503c\uff0c\u8868\u793a\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5728\u521b\u5efa Read View \u524d**\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u53ef\u89c1 \u3002 \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5927\u4e8e\u7b49\u4e8e Read View \u4e2d\u7684 max_trx_id \u503c\uff0c\u8868\u793a\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5728\u521b\u5efa Read View \u540e**\u624d\u542f\u52a8\u7684\u4e8b\u52a1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u4e0d\u53ef\u89c1 \u3002 \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5728 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u9700\u8981\u5224\u65ad trx_id \u662f\u5426\u5728 m_ids \u5217\u8868\u4e2d\uff1a \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u5728 m_ids \u5217\u8868\u4e2d\uff0c\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u8bb0\u5f55\u7684\u6d3b\u8dc3\u4e8b\u52a1\u4f9d\u7136\u6d3b\u8dc3\u7740\uff08\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u4e0d\u53ef\u89c1**\u3002 \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u4e0d\u5728 m_ids \u5217\u8868\u4e2d\uff0c\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u8bb0\u5f55\u7684\u6d3b\u8dc3\u4e8b\u52a1\u5df2\u7ecf\u88ab\u63d0\u4ea4\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u53ef\u89c1**\u3002 \u8fd9\u79cd\u901a\u8fc7\u300c\u7248\u672c\u94fe\u300d\u6765\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002 \u53ef\u91cd\u590d\u8bfb\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f \u00b6 \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View \u3002 \u5047\u8bbe\u4e8b\u52a1 A \uff08\u4e8b\u52a1 id \u4e3a51\uff09\u542f\u52a8\u540e\uff0c\u7d27\u63a5\u7740\u4e8b\u52a1 B \uff08\u4e8b\u52a1 id \u4e3a52\uff09\u4e5f\u542f\u52a8\u4e86\uff0c\u90a3\u8fd9\u4e24\u4e2a\u4e8b\u52a1\u521b\u5efa\u7684 Read View \u5982\u4e0b\uff1a \u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u7684 Read View \u5177\u4f53\u5185\u5bb9\u5982\u4e0b\uff1a \u5728\u4e8b\u52a1 A \u7684 Read View \u4e2d\uff0c\u5b83\u7684\u4e8b\u52a1 id \u662f 51\uff0c\u7531\u4e8e\u5b83\u662f\u7b2c\u4e00\u4e2a\u542f\u52a8\u7684\u4e8b\u52a1\uff0c\u6240\u4ee5\u6b64\u65f6\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u5c31\u53ea\u6709 51\uff0c\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u4e2d\u6700\u5c0f\u7684\u4e8b\u52a1 id \u662f\u4e8b\u52a1 A \u672c\u8eab\uff0c\u4e0b\u4e00\u4e2a\u4e8b\u52a1 id \u5219\u662f 52\u3002 \u5728\u4e8b\u52a1 B \u7684 Read View \u4e2d\uff0c\u5b83\u7684\u4e8b\u52a1 id \u662f 52\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u662f\u6d3b\u8dc3\u7684\uff0c\u6240\u4ee5\u6b64\u65f6\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u662f 51 \u548c 52\uff0c \u6d3b\u8dc3\u7684\u4e8b\u52a1 id \u4e2d\u6700\u5c0f\u7684\u4e8b\u52a1 id \u662f\u4e8b\u52a1 A \uff0c\u4e0b\u4e00\u4e2a\u4e8b\u52a1 id \u5e94\u8be5\u662f 53\u3002 \u63a5\u7740\uff0c\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u6309\u987a\u5e8f\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u662f 100 \u4e07\uff1b \u4e8b\u52a1 A \u5c06\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\u4fee\u6539\u6210 200 \u4e07\uff0c\u5e76\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u8fd8\u662f 100 \u4e07\uff1b \u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u4f9d\u7136\u8fd8\u662f 100 \u4e07\uff1b \u63a5\u4e0b\u6765\uff0c\u8ddf\u5927\u5bb6\u5177\u4f53\u5206\u6790\u4e0b\u3002 \u4e8b\u52a1 B \u7b2c\u4e00\u6b21\u8bfb\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u5728\u627e\u5230\u8bb0\u5f55\u540e\uff0c\u5b83\u4f1a\u5148\u770b\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id\uff0c\u6b64\u65f6**\u53d1\u73b0 trx_id \u4e3a 50\uff0c\u6bd4\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0851\uff09\u8fd8\u5c0f\uff0c\u8fd9\u610f\u5473\u7740\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1\u65e9\u5c31\u5728\u4e8b\u52a1 B \u542f\u52a8\u524d\u63d0\u4ea4\u8fc7\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u4e8b\u52a1 B \u53ef\u89c1\u7684**\uff0c\u4e5f\u5c31\u662f\u4e8b\u52a1 B \u53ef\u4ee5\u83b7\u53d6\u5230\u8fd9\u6761\u8bb0\u5f55\u3002 \u63a5\u7740\uff0c\u4e8b\u52a1 A \u901a\u8fc7 update \u8bed\u53e5\u5c06\u8fd9\u6761\u8bb0\u5f55\u4fee\u6539\u4e86\uff08\u8fd8\u672a\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u5c06\u5c0f\u6797\u7684\u4f59\u989d\u6539\u6210 200 \u4e07\uff0c\u8fd9\u65f6 MySQL \u4f1a\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5e76\u4ee5\u94fe\u8868\u7684\u65b9\u5f0f\u4e32\u8054\u8d77\u6765\uff0c\u5f62\u6210**\u7248\u672c\u94fe**\uff0c\u5982\u4e0b\u56fe\uff1a \u4f60\u53ef\u4ee5\u5728\u4e0a\u56fe\u7684\u300c\u8bb0\u5f55\u7684\u5b57\u6bb5\u300d\u770b\u5230\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u4ee5\u524d\u7684\u8bb0\u5f55\u5c31\u53d8\u6210\u65e7\u7248\u672c\u8bb0\u5f55\u4e86\uff0c\u4e8e\u662f\u6700\u65b0\u8bb0\u5f55\u548c\u65e7\u7248\u672c\u8bb0\u5f55\u901a\u8fc7\u94fe\u8868\u7684\u65b9\u5f0f\u4e32\u8d77\u6765\uff0c\u800c\u4e14\u6700\u65b0\u8bb0\u5f55\u7684 trx_id \u662f\u4e8b\u52a1 A \u7684\u4e8b\u52a1 id\uff08trx_id = 51\uff09\u3002 \u7136\u540e\u4e8b\u52a1 B \u7b2c\u4e8c\u6b21\u53bb\u8bfb\u53d6\u8be5\u8bb0\u5f55\uff0c \u53d1\u73b0\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u503c\u4e3a 51\uff0c\u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u5219\u9700\u8981\u5224\u65ad trx_id \u503c\u662f\u5426\u5728 m_ids \u8303\u56f4\u5185\uff0c\u5224\u65ad\u7684\u7ed3\u679c\u662f\u5728\u7684\uff0c\u90a3\u4e48\u8bf4\u660e\u8fd9\u6761\u8bb0\u5f55\u662f\u88ab\u8fd8\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fee\u6539\u7684\uff0c\u8fd9\u65f6\u4e8b\u52a1 B \u5e76\u4e0d\u4f1a\u8bfb\u53d6\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u3002\u800c\u662f\u6cbf\u7740 undo log \u94fe\u6761\u5f80\u4e0b\u627e\u65e7\u7248\u672c\u7684\u8bb0\u5f55\uff0c\u76f4\u5230\u627e\u5230 trx_id \u300c\u5c0f\u4e8e\u300d\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55 \uff0c\u6240\u4ee5\u4e8b\u52a1 B \u80fd\u8bfb\u53d6\u5230\u7684\u662f trx_id \u4e3a 50 \u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55\u3002 \u6700\u540e\uff0c\u5f53\u4e8b\u7269 A \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c \u7531\u4e8e\u9694\u79bb\u7ea7\u522b\u65f6\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u518d\u6b21\u8bfb\u53d6\u8bb0\u5f55\u65f6\uff0c\u8fd8\u662f\u57fa\u4e8e\u542f\u52a8\u4e8b\u52a1\u65f6\u521b\u5efa\u7684 Read View \u6765\u5224\u65ad\u5f53\u524d\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5426\u53ef\u89c1\u3002\u6240\u4ee5\uff0c\u5373\u4f7f\u4e8b\u7269 A \u5c06\u5c0f\u6797\u4f59\u989d\u4fee\u6539\u4e3a 200 \u4e07\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c \u4e8b\u52a1 B \u7b2c\u4e09\u6b21\u8bfb\u53d6\u8bb0\u5f55\u65f6\uff0c\u8bfb\u5230\u7684\u8bb0\u5f55\u90fd\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55 \u3002 \u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\uff0c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u8bb0\u5f55\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002 \u8bfb\u63d0\u4ea4\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f \u00b6 \u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View \u3002 \u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u90a3\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5de5\u4f5c\u5462\uff1f\u6211\u4eec\u8fd8\u662f\u4ee5\u524d\u9762\u7684\u4f8b\u5b50\u6765\u804a\u804a\u3002 \u5047\u8bbe\u4e8b\u52a1 A \uff08\u4e8b\u52a1 id \u4e3a51\uff09\u542f\u52a8\u540e\uff0c\u7d27\u63a5\u7740\u4e8b\u52a1 B \uff08\u4e8b\u52a1 id \u4e3a52\uff09\u4e5f\u542f\u52a8\u4e86\uff0c\u63a5\u7740\u6309\u987a\u5e8f\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\uff1b \u4e8b\u52a1 A \u4fee\u6539\u6570\u636e\uff08\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u5c06\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4ece 100 \u4e07\u4fee\u6539\u6210\u4e86 200 \u4e07\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\uff1b \u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 200 \u4e07\uff1b \u90a3\u5177\u4f53\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f\u6211\u4eec\u91cd\u70b9\u770b\u4e8b\u52a1 B \u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684 Read View\u3002\u524d\u4e24\u6b21 \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684 Read View \u5982\u4e0b\u56fe\uff1a \u6211\u4eec\u6765\u5206\u6790\u4e0b\u4e3a\u4ec0\u4e48\u4e8b\u52a1 B \u7b2c\u4e8c\u6b21\u8bfb\u6570\u636e\u65f6\uff0c\u8bfb\u4e0d\u5230\u4e8b\u52a1 A \uff08\u8fd8\u672a\u63d0\u4ea4\u4e8b\u52a1\uff09\u4fee\u6539\u7684\u6570\u636e\uff1f \u4e8b\u52a1 B \u5728\u627e\u5230\u5c0f\u6797\u8fd9\u6761\u8bb0\u5f55\u65f6\uff0c\u4f1a\u770b\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u662f 51\uff0c\u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u5224\u65ad trx_id \u503c\u662f\u5426\u5728 m_ids \u8303\u56f4\u5185\uff0c\u5224\u65ad\u7684\u7ed3\u679c\u662f\u5728\u7684\uff0c\u90a3\u4e48\u8bf4\u660e**\u8fd9\u6761\u8bb0\u5f55\u662f\u88ab\u8fd8\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fee\u6539\u7684\uff0c\u8fd9\u65f6\u4e8b\u52a1 B \u5e76\u4e0d\u4f1a\u8bfb\u53d6\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55**\u3002\u800c\u662f\uff0c\u6cbf\u7740 undo log \u94fe\u6761\u5f80\u4e0b\u627e\u65e7\u7248\u672c\u7684\u8bb0\u5f55\uff0c\u76f4\u5230\u627e\u5230 trx_id \u300c\u5c0f\u4e8e\u300d\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u80fd\u8bfb\u53d6\u5230\u7684\u662f trx_id \u4e3a 50 \u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55\u3002 \u6211\u4eec\u6765\u5206\u6790\u4e0b\u4e3a\u4ec0\u4e48\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c\u4e8b\u52a1 B \u5c31\u53ef\u4ee5\u8bfb\u5230\u4e8b\u52a1 A \u4fee\u6539\u7684\u6570\u636e\uff1f \u5728\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c \u7531\u4e8e\u9694\u79bb\u7ea7\u522b\u662f\u300c\u8bfb\u63d0\u4ea4\u300d\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u6bcf\u6b21\u8bfb\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u91cd\u65b0\u521b\u5efa Read View \uff0c\u6b64\u65f6\u4e8b\u52a1 B \u7b2c\u4e09\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684 Read View \u5982\u4e0b\uff1a \u4e8b\u52a1 B \u5728\u627e\u5230\u5c0f\u6797\u8fd9\u6761\u8bb0\u5f55\u65f6\uff0c \u4f1a\u53d1\u73b0\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u662f 51\uff0c\u6bd4\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0852\uff09\u8fd8\u5c0f\uff0c\u8fd9\u610f\u5473\u7740\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1\u65e9\u5c31\u5728\u521b\u5efa Read View \u524d\u63d0\u4ea4\u8fc7\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u4e8b\u52a1 B \u662f\u53ef\u89c1\u7684 \u3002 \u6b63\u662f\u56e0\u4e3a\u5728\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6bcf\u6b21\u8bfb\u6570\u636e\u65f6\u90fd\u91cd\u65b0\u521b\u5efa Read View\uff0c\u90a3\u4e48\u5728\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u603b\u7ed3 \u00b6 \u4e8b\u52a1\u662f\u5728 MySQL \u5f15\u64ce\u5c42\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5e38\u89c1\u7684 InnoDB \u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u4e8b\u52a1\u7684\u56db\u5927\u7279\u6027\u662f\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u3001\u9694\u79bb\u6027\u3001\u6301\u4e45\u6027\uff0c\u6211\u4eec\u8fd9\u6b21\u4e3b\u8981\u8bb2\u7684\u662f\u9694\u79bb\u6027\u3002 \u5f53\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u5f15\u53d1\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u8fd9\u4e9b\u95ee\u9898\uff0c\u90a3\u4e3a\u4e86\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\uff0cSQL \u63d0\u51fa\u4e86\u56db\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u5206\u522b\u662f\u8bfb\u672a\u63d0\u4ea4\u3001\u8bfb\u5df2\u63d0\u4ea4\u3001\u53ef\u91cd\u590d\u8bfb\u3001\u4e32\u884c\u5316\uff0c\u4ece\u5de6\u5f80\u53f3\u9694\u79bb\u7ea7\u522b\u987a\u5e8f\u9012\u589e\uff0c\u9694\u79bb\u7ea7\u522b\u8d8a\u9ad8\uff0c\u610f\u5473\u7740\u6027\u80fd\u8d8a\u5dee\uff0cInnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662f\u53ef\u91cd\u590d\u8bfb\u3002 \u8981\u89e3\u51b3\u810f\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u8bfb\u5df2\u63d0\u4ea4\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u8981\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u53ef\u91cd\u590d\u8bfb\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\u3002 \u800c\u5bf9\u4e8e\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4e0d\u5efa\u8bae\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u4e3a\u4e32\u884c\u5316\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u5e76\u53d1\u65f6\u6027\u80fd\u5f88\u5dee\u3002MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7 \u6587\u7ae0 \uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u901a\u8fc7 Read View \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff1a \u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u4e2a select \u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View\uff0c\u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u6570\u636e\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002 \u8fd9\u4e24\u4e2a\u9694\u79bb\u7ea7\u522b\u5b9e\u73b0\u662f\u901a\u8fc7\u300c\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u5b57\u6bb5\u300d\u548c\u300c\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\u300d\u7684\u6bd4\u5bf9\uff0c\u6765\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\uff0c\u8fd9\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002 \u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e2d\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u5c31\u662f\u57fa\u4e8e MVCC \u5b9e\u73b0\u7684\u5feb\u7167\u8bfb\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u52a0\u9501\u7684\u3002\u800c select .. for update \u8bed\u53e5\u5c31\u4e0d\u662f\u5feb\u7167\u8bfb\u4e86\uff0c\u800c\u662f\u5f53\u524d\u8bfb\u4e86\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u8bfb\u90fd\u662f\u62ff\u5230\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff0c\u4f46\u662f\u5b83\u4f1a\u5bf9\u8bfb\u5230\u7684\u8bb0\u5f55\u52a0\u4e0a next-key lock \u9501\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f"},{"location":"mysql/transaction/mvcc/#_1","text":"\u8fd9\u662f\u6211\u7684\u94b1\u5305\uff0c\u5171\u6709 100 \u4e07\u5143\u3002 \u4eca\u5929\u6211\u5fc3\u60c5\u597d\uff0c\u6211\u51b3\u5b9a\u7ed9\u4f60\u7684\u8f6c\u8d26 100 \u4e07\uff0c\u6700\u540e\u7684\u7ed3\u679c\u80af\u5b9a\u662f\u6211\u7684\u4f59\u989d\u53d8\u4e3a 0 \u5143\uff0c\u4f60\u7684\u4f59\u989d\u591a\u4e86 100 \u4e07\u5143\uff0c\u662f\u4e0d\u662f\u60f3\u5230\u5c31\u5f88\u5f00\u5fc3\uff1f \u8f6c\u8d26\u8fd9\u4e00\u52a8\u4f5c\u5728\u7a0b\u5e8f\u91cc\u4f1a\u6d89\u53ca\u5230\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\uff0c\u5047\u8bbe\u6211\u5411\u4f60\u8f6c\u8d26 100 \u4e07\u7684\u8fc7\u7a0b\u662f\u6709\u4e0b\u9762\u8fd9\u51e0\u4e2a\u6b65\u9aa4\u7ec4\u6210\u7684\uff1a \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u8f6c\u8d26\u7684\u8fc7\u7a0b\u6d89\u53ca\u5230\u4e86\u4e24\u6b21\u4fee\u6539\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002 \u5047\u8bbe\u5728\u6267\u884c\u7b2c\u4e09\u6b65\u9aa4\u4e4b\u540e\uff0c\u670d\u52a1\u5668\u5ffd\u7136\u6389\u7535\u4e86\uff0c\u5c31\u4f1a\u53d1\u751f\u4e00\u4e2a\u86cb\u75bc\u7684\u4e8b\u60c5\uff0c\u6211\u7684\u8d26\u6237\u6263\u4e86 100 \u4e07\uff0c\u4f46\u662f\u94b1\u5e76\u6ca1\u6709\u5230\u4f60\u7684\u8d26\u6237\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4**\u8fd9 100 \u4e07\u6d88\u5931\u4e86\uff01** \u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u8981\u4fdd\u8bc1\u8f6c\u8d26\u4e1a\u52a1\u91cc\u7684\u6240\u6709\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u662f\u4e0d\u53ef\u5206\u5272\u7684\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u6210\u529f \uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\uff0c\u4e0d\u5141\u8bb8\u51fa\u73b0\u4e2d\u95f4\u72b6\u6001\u7684\u6570\u636e\u3002 \u6570\u636e\u5e93\u4e2d\u7684\u300c \u4e8b\u52a1\uff08 Transaction \uff09 \u300d\u5c31\u80fd\u8fbe\u5230\u8fd9\u6837\u7684\u6548\u679c\u3002 \u6211\u4eec\u5728\u8f6c\u8d26\u64cd\u4f5c\u524d\u5148\u5f00\u542f\u4e8b\u52a1\uff0c\u7b49\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u8be5\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u4fee\u6539\u5c06\u6c38\u4e45\u751f\u6548\uff0c\u5982\u679c\u4e2d\u9014\u53d1\u751f\u53d1\u751f\u4e2d\u65ad\u6216\u9519\u8bef\uff0c\u90a3\u4e48\u8be5\u4e8b\u52a1\u671f\u95f4\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u4fee\u6539\u5c06\u4f1a\u88ab\u56de\u6eda\u5230\u6ca1\u6267\u884c\u8be5\u4e8b\u52a1\u4e4b\u524d\u7684\u72b6\u6001\u3002 \u6ca1\u9519\uff0c\u4eca\u5929\u5c31\u6765\u56fe\u89e3 MySQL \u4e8b\u52a1\u5566\uff0c\u5f00\u8f66\uff01","title":"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f"},{"location":"mysql/transaction/mvcc/#_2","text":"\u4e8b\u52a1\u662f\u7531 MySQL \u7684\u5f15\u64ce\u6765\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5e38\u89c1\u7684 InnoDB \u5f15\u64ce\u5b83\u662f\u652f\u6301\u4e8b\u52a1\u7684\u3002 \u4e0d\u8fc7\u5e76\u4e0d\u662f\u6240\u6709\u7684\u5f15\u64ce\u90fd\u80fd\u652f\u6301\u4e8b\u52a1\uff0c\u6bd4\u5982 MySQL \u539f\u751f\u7684 MyISAM \u5f15\u64ce\u5c31\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u4e5f\u6b63\u662f\u8fd9\u6837\uff0c\u6240\u4ee5\u5927\u591a\u6570 MySQL \u7684\u5f15\u64ce\u90fd\u662f\u7528 InnoDB\u3002 \u4e8b\u52a1\u770b\u8d77\u6765\u611f\u89c9\u7b80\u5355\uff0c\u4f46\u662f\u8981\u5b9e\u73b0\u4e8b\u52a1\u5fc5\u987b\u8981\u9075\u5b88 4 \u4e2a\u7279\u6027\uff0c\u5206\u522b\u5982\u4e0b\uff1a \u539f\u5b50\u6027\uff08Atomicity\uff09 \uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5b8c\u6210\uff0c\u4e0d\u4f1a\u7ed3\u675f\u5728\u4e2d\u95f4\u67d0\u4e2a\u73af\u8282\uff0c\u800c\u4e14\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\uff0c\u4f1a\u88ab\u56de\u6eda\u5230\u4e8b\u52a1\u5f00\u59cb\u524d\u7684\u72b6\u6001\uff0c\u5c31\u50cf\u8fd9\u4e2a\u4e8b\u52a1\u4ece\u6765\u6ca1\u6709\u6267\u884c\u8fc7\u4e00\u6837\uff0c\u5c31\u597d\u6bd4\u4e70\u4e00\u4ef6\u5546\u54c1\uff0c\u8d2d\u4e70\u6210\u529f\u65f6\uff0c\u5219\u7ed9\u5546\u5bb6\u4ed8\u4e86\u94b1\uff0c\u5546\u54c1\u5230\u624b\uff1b\u8d2d\u4e70\u5931\u8d25\u65f6\uff0c\u5219\u5546\u54c1\u5728\u5546\u5bb6\u624b\u4e2d\uff0c\u6d88\u8d39\u8005\u7684\u94b1\u4e5f\u6ca1\u82b1\u51fa\u53bb\u3002 \u4e00\u81f4\u6027\uff08Consistency\uff09 \uff1a\u662f\u6307\u4e8b\u52a1\u64cd\u4f5c\u524d\u548c\u64cd\u4f5c\u540e\uff0c\u6570\u636e\u6ee1\u8db3\u5b8c\u6574\u6027\u7ea6\u675f\uff0c\u6570\u636e\u5e93\u4fdd\u6301\u4e00\u81f4\u6027\u72b6\u6001\u3002\u6bd4\u5982\uff0c\u7528\u6237 A \u548c\u7528\u6237 B \u5728\u94f6\u884c\u5206\u522b\u6709 800 \u5143\u548c 600 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u7528\u6237 A \u7ed9\u7528\u6237 B \u8f6c\u8d26 200 \u5143\uff0c\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u4ece A \u7684\u8d26\u6237\u6263\u9664 200 \u5143\u548c\u5bf9 B \u7684\u8d26\u6237\u589e\u52a0 200 \u5143\u3002\u4e00\u81f4\u6027\u5c31\u662f\u8981\u6c42\u4e0a\u8ff0\u6b65\u9aa4\u64cd\u4f5c\u540e\uff0c\u6700\u540e\u7684\u7ed3\u679c\u662f\u7528\u6237 A \u8fd8\u6709 600 \u5143\uff0c\u7528\u6237 B \u6709 800 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u7528\u6237 A \u6263\u9664\u4e86 200 \u5143\uff0c\u4f46\u7528\u6237 B \u672a\u589e\u52a0\u7684\u60c5\u51b5\uff08\u8be5\u60c5\u51b5\uff0c\u7528\u6237 A \u548c B \u5747\u4e3a 600 \u5143\uff0c\u603b\u5171 1200 \u5143\uff09\u3002 \u9694\u79bb\u6027\uff08Isolation\uff09 \uff1a\u6570\u636e\u5e93\u5141\u8bb8\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u540c\u65f6\u5bf9\u5176\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u548c\u4fee\u6539\u7684\u80fd\u529b\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u7531\u4e8e\u4ea4\u53c9\u6267\u884c\u800c\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u591a\u4e2a\u4e8b\u52a1\u540c\u65f6\u4f7f\u7528\u76f8\u540c\u7684\u6570\u636e\u65f6\uff0c\u4e0d\u4f1a\u76f8\u4e92\u5e72\u6270\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u90fd\u6709\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u7a7a\u95f4\uff0c\u5bf9\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u662f\u9694\u79bb\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6d88\u8d39\u8005\u8d2d\u4e70\u5546\u54c1\u8fd9\u4e2a\u4e8b\u52a1\uff0c\u662f\u4e0d\u5f71\u54cd\u5176\u4ed6\u6d88\u8d39\u8005\u8d2d\u4e70\u7684\u3002 \u6301\u4e45\u6027\uff08Durability\uff09 \uff1a\u4e8b\u52a1\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u5c31\u662f\u6c38\u4e45\u7684\uff0c\u5373\u4fbf\u7cfb\u7edf\u6545\u969c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002 InnoDB \u5f15\u64ce\u901a\u8fc7\u4ec0\u4e48\u6280\u672f\u6765\u4fdd\u8bc1\u4e8b\u52a1\u7684\u8fd9\u56db\u4e2a\u7279\u6027\u7684\u5462\uff1f \u6301\u4e45\u6027\u662f\u901a\u8fc7 redo log \uff08\u91cd\u505a\u65e5\u5fd7\uff09\u6765\u4fdd\u8bc1\u7684\uff1b \u539f\u5b50\u6027\u662f\u901a\u8fc7 undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09 \u6765\u4fdd\u8bc1\u7684\uff1b \u9694\u79bb\u6027\u662f\u901a\u8fc7 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09 \u6216\u9501\u673a\u5236\u6765\u4fdd\u8bc1\u7684\uff1b \u4e00\u81f4\u6027\u5219\u662f\u901a\u8fc7\u6301\u4e45\u6027+\u539f\u5b50\u6027+\u9694\u79bb\u6027\u6765\u4fdd\u8bc1\uff1b \u8fd9\u6b21\u5c06**\u91cd\u70b9\u4ecb\u7ecd\u4e8b\u52a1\u7684\u9694\u79bb\u6027**\uff0c\u8fd9\u4e5f\u662f\u9762\u8bd5\u65f6\u6700\u5e38\u95ee\u7684\u77e5\u8bc6\u7684\u70b9\u3002 \u4e3a\u4ec0\u4e48\u4e8b\u52a1\u8981\u6709\u9694\u79bb\u6027\uff0c\u6211\u4eec\u5c31\u8981\u77e5\u9053\u5e76\u53d1\u4e8b\u52a1\u65f6\u4f1a\u5f15\u53d1\u4ec0\u4e48\u95ee\u9898\u3002","title":"\u4e8b\u52a1\u6709\u54ea\u4e9b\u7279\u6027\uff1f"},{"location":"mysql/transaction/mvcc/#_3","text":"MySQL \u670d\u52a1\u7aef\u662f\u5141\u8bb8\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\uff0c\u8fd9\u610f\u5473\u7740 MySQL \u4f1a\u51fa\u73b0\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4e8b\u52a1\u7684\u60c5\u51b5\u3002 \u90a3\u4e48**\u5728\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u810f\u8bfb\uff08dirty read\uff09\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\uff08non-repeatable read\uff09\u3001\u5e7b\u8bfb\uff08phantom read\uff09\u7684\u95ee\u9898**\u3002 \u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u4e3e\u4f8b\u5b50\u7ed9\u5927\u5bb6\u8bf4\u660e\uff0c\u8fd9\u4e9b\u95ee\u9898\u662f\u5982\u4f55\u53d1\u751f\u7684\u3002","title":"\u5e76\u884c\u4e8b\u52a1\u4f1a\u5f15\u53d1\u4ec0\u4e48\u95ee\u9898\uff1f"},{"location":"mysql/transaction/mvcc/#_4","text":"\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u300c\u8bfb\u5230\u300d\u4e86\u53e6\u4e00\u4e2a\u300c\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fee\u6539\u8fc7\u7684\u6570\u636e\u300d\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u810f\u8bfb\u300d\u73b0\u8c61\u3002 \u4e3e\u4e2a\u6817\u5b50\u3002 \u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u7136\u540e\u518d\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\uff0c\u5982\u679c\u6b64\u65f6\u4e8b\u52a1 A \u8fd8\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u800c\u6b64\u65f6\u6b63\u597d\u4e8b\u52a1 B \u4e5f\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u90a3\u4e48\u4e8b\u52a1 B \u8bfb\u53d6\u5230\u7684\u4f59\u989d\u6570\u636e\u662f\u521a\u624d\u4e8b\u52a1 A \u66f4\u65b0\u540e\u7684\u6570\u636e\uff0c\u5373\u4f7f\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\u3002 \u56e0\u4e3a\u4e8b\u52a1 A \u662f\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u7684\uff0c\u4e5f\u5c31\u662f\u5b83\u968f\u65f6\u53ef\u80fd\u53d1\u751f\u56de\u6eda\u64cd\u4f5c\uff0c \u5982\u679c\u5728\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u4e8b\u52a1 A \u53d1\u751f\u4e86\u56de\u6eda\uff0c\u90a3\u4e48\u4e8b\u52a1 B \u521a\u624d\u5f97\u5230\u7684\u6570\u636e\u5c31\u662f\u8fc7\u671f\u7684\u6570\u636e\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u810f\u8bfb\u3002","title":"\u810f\u8bfb"},{"location":"mysql/transaction/mvcc/#_5","text":"\u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u4e2a\u6570\u636e\uff0c\u5982\u679c\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u8bfb\u5230\u7684\u6570\u636e\u4e0d\u4e00\u6837\u7684\u60c5\u51b5\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u4e0d\u53ef\u91cd\u590d\u8bfb\u300d\u73b0\u8c61\u3002 \u4e3e\u4e2a\u6817\u5b50\u3002 \u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\u4ee3\u7801\u903b\u8f91\u5904\u7406\uff0c \u5728\u8fd9\u8fc7\u7a0b\u4e2d\u5982\u679c\u4e8b\u52a1 B \u66f4\u65b0\u4e86\u8fd9\u6761\u6570\u636e\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u90a3\u4e48\u5f53\u4e8b\u52a1 A \u518d\u6b21\u8bfb\u53d6\u8be5\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u53d1\u73b0\u524d\u540e\u4e24\u6b21\u8bfb\u5230\u7684\u6570\u636e\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u4e0d\u53ef\u91cd\u590d\u8bfb\u3002","title":"\u4e0d\u53ef\u91cd\u590d\u8bfb"},{"location":"mysql/transaction/mvcc/#_6","text":"\u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\u591a\u6b21\u67e5\u8be2\u67d0\u4e2a\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u300c\u8bb0\u5f55\u6570\u91cf\u300d\uff0c\u5982\u679c\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u6837\u7684\u60c5\u51b5\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u5e7b\u8bfb\u300d\u73b0\u8c61\u3002 \u4e3e\u4e2a\u6817\u5b50\u3002 \u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u5927\u4e8e 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u53d1\u73b0\u5171\u6709 5 \u6761\uff0c\u7136\u540e\u4e8b\u52a1 B \u4e5f\u6309\u76f8\u540c\u7684\u641c\u7d22\u6761\u4ef6\u4e5f\u662f\u67e5\u8be2\u51fa\u4e86 5 \u6761\u8bb0\u5f55\u3002 \u63a5\u4e0b\u6765\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u4f59\u989d\u8d85\u8fc7 100 \u4e07\u7684\u8d26\u53f7\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u6b64\u65f6\u6570\u636e\u5e93\u8d85\u8fc7 100 \u4e07\u4f59\u989d\u7684\u8d26\u53f7\u4e2a\u6570\u5c31\u53d8\u4e3a 6\u3002 \u7136\u540e\u4e8b\u52a1 B \u518d\u6b21\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u5927\u4e8e 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u67e5\u8be2\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u6709 6 \u6761\uff0c \u53d1\u73b0\u548c\u524d\u4e00\u6b21\u8bfb\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u6837\u4e86\uff0c\u5c31\u611f\u89c9\u53d1\u751f\u4e86\u5e7b\u89c9\u4e00\u6837\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u5e7b\u8bfb\u3002","title":"\u5e7b\u8bfb"},{"location":"mysql/transaction/mvcc/#_7","text":"\u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u5f53\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u53ef\u80fd\u4f1a\u9047\u5230\u300c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u300d\u7684\u73b0\u8c61\uff0c\u8fd9\u4e9b\u73b0\u8c61\u4f1a\u5bf9\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u4ea7\u751f\u4e0d\u540c\u7a0b\u5e8f\u7684\u5f71\u54cd\u3002 \u810f\u8bfb\uff1a\u8bfb\u5230\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff1b \u4e0d\u53ef\u91cd\u590d\u8bfb\uff1a\u524d\u540e\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff1b \u5e7b\u8bfb\uff1a\u524d\u540e\u8bfb\u53d6\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u81f4\u3002 \u8fd9\u4e09\u4e2a\u73b0\u8c61\u7684\u4e25\u91cd\u6027\u6392\u5e8f\u5982\u4e0b\uff1a SQL \u6807\u51c6\u63d0\u51fa\u4e86\u56db\u79cd\u9694\u79bb\u7ea7\u522b\u6765\u89c4\u907f\u8fd9\u4e9b\u73b0\u8c61\uff0c\u9694\u79bb\u7ea7\u522b\u8d8a\u9ad8\uff0c\u6027\u80fd\u6548\u7387\u5c31\u8d8a\u4f4e\uff0c\u8fd9\u56db\u4e2a\u9694\u79bb\u7ea7\u522b\u5982\u4e0b\uff1a \u8bfb\u672a\u63d0\u4ea4\uff08 read uncommitted \uff09 \uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u6ca1\u63d0\u4ea4\u65f6\uff0c\u5b83\u505a\u7684\u53d8\u66f4\u5c31\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u770b\u5230\uff1b \u8bfb\u63d0\u4ea4\uff08 read committed \uff09 \uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0c\u5b83\u505a\u7684\u53d8\u66f4\u624d\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u770b\u5230\uff1b \u53ef\u91cd\u590d\u8bfb\uff08 repeatable read \uff09 \uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b \uff1b \u4e32\u884c\u5316\uff08 serializable \uff09 \uff1b\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u4e0a\u8bfb\u5199\u9501\uff0c\u5728\u591a\u4e2a\u4e8b\u52a1\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8bfb\u5199\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u540e\u8bbf\u95ee\u7684\u4e8b\u52a1\u5fc5\u987b\u7b49\u524d\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u5b8c\u6210\uff0c\u624d\u80fd\u7ee7\u7eed\u6267\u884c\uff1b \u6309\u9694\u79bb\u6c34\u5e73\u9ad8\u4f4e\u6392\u5e8f\u5982\u4e0b\uff1a \u9488\u5bf9\u4e0d\u540c\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u5e76\u53d1\u4e8b\u52a1\u65f6\u53ef\u80fd\u53d1\u751f\u7684\u73b0\u8c61\u4e5f\u4f1a\u4e0d\u540c\u3002 \u4e5f\u5c31\u662f\u8bf4\uff1a \u5728\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\uff1b \u5728\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u4e0d\u53ef\u80fd\u53d1\u751f\u810f\u8bfb\u73b0\u8c61\uff1b \u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u4e0d\u53ef\u80fd\u810f\u8bfb\u548c\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff1b \u5728\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\u90fd\u4e0d\u53ef\u80fd\u4f1a\u53d1\u751f\u3002 \u6240\u4ee5\uff0c\u8981\u89e3\u51b3\u810f\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5347\u7ea7\u5230\u300c\u8bfb\u63d0\u4ea4\u300d\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\uff1b\u8981\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5347\u7ea7\u5230\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u8981\u89e3\u51b3\u5e7b\u8bfb\u73b0\u8c61\u4e0d\u5efa\u8bae\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u300c\u4e32\u884c\u5316\u300d\u3002 \u4e0d\u540c\u7684\u6570\u636e\u5e93\u5382\u5546\u5bf9 SQL \u6807\u51c6\u4e2d\u89c4\u5b9a\u7684 4 \u79cd\u9694\u79bb\u7ea7\u522b\u7684\u652f\u6301\u4e0d\u4e00\u6837\uff0c\u6709\u7684\u6570\u636e\u5e93\u53ea\u5b9e\u73b0\u4e86\u5176\u4e2d\u51e0\u79cd\u9694\u79bb\u7ea7\u522b\uff0c \u6211\u4eec\u8ba8\u8bba\u7684 MySQL \u867d\u7136\u652f\u6301 4 \u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u4f46\u662f\u4e0eSQL \u6807\u51c6\u4e2d\u89c4\u5b9a\u7684\u5404\u7ea7\u9694\u79bb\u7ea7\u522b\u5141\u8bb8\u53d1\u751f\u7684\u73b0\u8c61\u5374\u6709\u4e9b\u51fa\u5165 \u3002 MySQL \u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff08\u6ce8\u610f\u662f\u5f88\u5927\u7a0b\u5ea6\u907f\u514d\uff0c\u5e76\u4e0d\u662f\u5f7b\u5e95\u907f\u514d\uff09\uff0c\u6240\u4ee5 MySQL \u5e76\u4e0d\u4f1a\u4f7f\u7528\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u6765\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff0c\u56e0\u4e3a\u4f7f\u7528\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4f1a\u5f71\u54cd\u6027\u80fd\u3002 MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7 \u6587\u7ae0 \uff09 \uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u63a5\u4e0b\u6765\uff0c\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u8fd9\u56db\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u6709\u4e00\u5f20\u8d26\u6237\u4f59\u989d\u8868\uff0c\u91cc\u9762\u6709\u4e00\u6761\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\u7684\u8bb0\u5f55\u3002\u7136\u540e\u6709\u4e24\u4e2a\u5e76\u53d1\u7684\u4e8b\u52a1\uff0c\u4e8b\u52a1 A \u53ea\u8d1f\u8d23\u67e5\u8be2\u4f59\u989d\uff0c\u4e8b\u52a1 B \u5219\u4f1a\u5c06\u6211\u7684\u4f59\u989d\u6539\u6210 200 \u4e07\uff0c\u4e0b\u9762\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u6267\u884c\u4e24\u4e2a\u4e8b\u52a1\u7684\u884c\u4e3a\uff1a \u5728\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u6267\u884c\u8fc7\u7a0b\u4e2d\u67e5\u8be2\u5230\u7684\u4f59\u989d\u53ef\u80fd\u4f1a\u4e0d\u540c\uff1a \u5728\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u4fee\u6539\u4f59\u989d\u540e\uff0c\u867d\u7136\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u4f46\u662f\u6b64\u65f6\u7684\u4f59\u989d\u5df2\u7ecf\u53ef\u4ee5\u88ab\u4e8b\u52a1 A \u770b\u89c1\u4e86\uff0c\u4e8e\u662f\u4e8b\u52a1 A \u4e2d\u4f59\u989d V1 \u67e5\u8be2\u7684\u503c\u662f 200 \u4e07\uff0c\u4f59\u989d V2\u3001V3 \u81ea\u7136\u4e5f\u662f 200 \u4e07\u4e86\uff1b \u5728\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u4fee\u6539\u4f59\u989d\u540e\uff0c\u56e0\u4e3a\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u6240\u4ee5\u4e8b\u52a1 A \u4e2d\u4f59\u989d V1 \u7684\u503c\u8fd8\u662f 100 \u4e07\uff0c\u7b49\u4e8b\u52a1 B \u63d0\u4ea4\u5b8c\u540e\uff0c\u6700\u65b0\u7684\u4f59\u989d\u6570\u636e\u624d\u80fd\u88ab\u4e8b\u52a1 A \u770b\u89c1\uff0c\u56e0\u6b64\u989d V2\u3001V3 \u90fd\u662f 200 \u4e07\uff1b \u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u53ea\u80fd\u770b\u89c1\u542f\u52a8\u4e8b\u52a1\u65f6\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4f59\u989d V1\u3001\u4f59\u989d V2 \u7684\u503c\u90fd\u662f 100 \u4e07\uff0c\u5f53\u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u5c31\u80fd\u770b\u89c1\u6700\u65b0\u7684\u4f59\u989d\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u4f59\u989d V3 \u7684\u503c\u662f 200 \u4e07\uff1b \u5728\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u5728\u6267\u884c\u5c06\u4f59\u989d 100 \u4e07\u4fee\u6539\u4e3a 200 \u4e07\u65f6\uff0c\u7531\u4e8e\u6b64\u524d\u4e8b\u52a1 A \u6267\u884c\u4e86\u8bfb\u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u53d1\u751f\u4e86\u8bfb\u5199\u51b2\u7a81\uff0c\u4e8e\u662f\u5c31\u4f1a\u88ab\u9501\u4f4f\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c\u4e8b\u52a1 B \u624d\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\uff0c\u6240\u4ee5\u4ece A \u7684\u89d2\u5ea6\u770b\uff0c\u4f59\u989d V1\u3001V2 \u7684\u503c\u662f 100 \u4e07\uff0c\u4f59\u989d V3 \u7684\u503c\u662f 200\u4e07\u3002 \u8fd9\u56db\u79cd\u9694\u79bb\u7ea7\u522b\u5177\u4f53\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462\uff1f \u5bf9\u4e8e\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u56e0\u4e3a\u53ef\u4ee5\u8bfb\u5230\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\uff0c\u6240\u4ee5\u76f4\u63a5\u8bfb\u53d6\u6700\u65b0\u7684\u6570\u636e\u5c31\u597d\u4e86\uff1b \u5bf9\u4e8e\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u901a\u8fc7\u52a0\u8bfb\u5199\u9501\u7684\u65b9\u5f0f\u6765\u907f\u514d\u5e76\u884c\u8bbf\u95ee\uff1b \u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u901a\u8fc7 Read View **\u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff0c\u5927\u5bb6\u53ef\u4ee5\u628a Read View \u7406\u89e3\u6210\u4e00\u4e2a\u6570\u636e\u5feb\u7167\uff0c\u5c31\u50cf\u76f8\u673a\u62cd\u7167\u90a3\u6837\uff0c\u5b9a\u683c\u67d0\u4e00\u65f6\u523b\u7684\u98ce\u666f\u3002 \u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u300c\u6bcf\u4e2a\u8bed\u53e5\u6267\u884c\u524d\u300d\u90fd\u4f1a\u91cd\u65b0\u751f\u6210\u4e00\u4e2a Read View\uff0c\u800c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u300c\u542f\u52a8\u4e8b\u52a1\u65f6\u300d\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View**\u3002 \u6ce8\u610f\uff0c\u6267\u884c\u300c\u5f00\u59cb\u4e8b\u52a1\u300d\u547d\u4ee4\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u542f\u52a8\u4e86\u4e8b\u52a1\u3002\u5728 MySQL \u6709\u4e24\u79cd\u5f00\u542f\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u5206\u522b\u662f\uff1a \u7b2c\u4e00\u79cd\uff1abegin/start transaction \u547d\u4ee4\uff1b \u7b2c\u4e8c\u79cd\uff1astart transaction with consistent snapshot \u547d\u4ee4\uff1b \u8fd9\u4e24\u79cd\u5f00\u542f\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u4e8b\u52a1\u7684\u542f\u52a8\u65f6\u673a\u662f\u4e0d\u540c\u7684\uff1a \u6267\u884c\u4e86 begin/start transaction \u547d\u4ee4\u540e\uff0c\u5e76\u4e0d\u4ee3\u8868\u4e8b\u52a1\u542f\u52a8\u4e86\u3002\u53ea\u6709\u5728\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u6267\u884c\u4e86\u589e\u5220\u67e5\u6539\u64cd\u4f5c\u7684 SQL \u8bed\u53e5\uff0c\u624d\u662f\u4e8b\u52a1\u771f\u6b63\u542f\u52a8\u7684\u65f6\u673a\uff1b \u6267\u884c\u4e86 start transaction with consistent snapshot \u547d\u4ee4\uff0c\u5c31\u4f1a\u9a6c\u4e0a\u542f\u52a8\u4e8b\u52a1\u3002 \u63a5\u4e0b\u6765\u8be6\u7ec6\u8bf4\u4e0b\uff0cRead View \u5728 MVCC \u91cc\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","title":"\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u6709\u54ea\u4e9b\uff1f"},{"location":"mysql/transaction/mvcc/#read-view-mvcc","text":"\u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e24\u4e2a\u77e5\u8bc6\uff1a Read View \u4e2d\u56db\u4e2a\u5b57\u6bb5\u4f5c\u7528\uff1b \u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u4e24\u4e2a\u8ddf\u4e8b\u52a1\u6709\u5173\u7684\u9690\u85cf\u5217\uff1b \u90a3 Read View \u5230\u5e95\u662f\u4e2a\u4ec0\u4e48\u4e1c\u897f\uff1f Read View \u6709\u56db\u4e2a\u91cd\u8981\u7684\u5b57\u6bb5\uff1a m_ids \uff1a\u6307\u7684\u662f\u5728\u521b\u5efa Read View \u65f6\uff0c\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u300c\u6d3b\u8dc3\u4e8b\u52a1\u300d\u7684**\u4e8b\u52a1 id \u5217\u8868**\uff0c\u6ce8\u610f\u662f\u4e00\u4e2a\u5217\u8868\uff0c \u201c\u6d3b\u8dc3\u4e8b\u52a1\u201d\u6307\u7684\u5c31\u662f\uff0c\u542f\u52a8\u4e86\u4f46\u8fd8\u6ca1\u63d0\u4ea4\u7684\u4e8b\u52a1 \u3002 min_trx_id \uff1a\u6307\u7684\u662f\u5728\u521b\u5efa Read View \u65f6\uff0c\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u300c\u6d3b\u8dc3\u4e8b\u52a1\u300d\u4e2d\u4e8b\u52a1 id \u6700\u5c0f\u7684\u4e8b\u52a1 \uff0c\u4e5f\u5c31\u662f m_ids \u7684\u6700\u5c0f\u503c\u3002 max_trx_id \uff1a\u8fd9\u4e2a\u5e76\u4e0d\u662f m_ids \u7684\u6700\u5927\u503c\uff0c\u800c\u662f**\u521b\u5efa Read View \u65f6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u5e94\u8be5\u7ed9\u4e0b\u4e00\u4e2a\u4e8b\u52a1\u7684 id \u503c**\uff0c\u4e5f\u5c31\u662f\u5168\u5c40\u4e8b\u52a1\u4e2d\u6700\u5927\u7684\u4e8b\u52a1 id \u503c + 1\uff1b creator_trx_id \uff1a\u6307\u7684\u662f**\u521b\u5efa\u8be5 Read View \u7684\u4e8b\u52a1\u7684\u4e8b\u52a1 id**\u3002 \u77e5\u9053\u4e86 Read View \u7684\u5b57\u6bb5\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e86\u89e3\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\u3002 \u5047\u8bbe\u5728\u8d26\u6237\u4f59\u989d\u8868\u63d2\u5165\u4e00\u6761\u5c0f\u6797\u4f59\u989d\u4e3a 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u6211\u628a\u8fd9\u4e24\u4e2a\u9690\u85cf\u5217\u4e5f\u753b\u51fa\u6765\uff0c\u8be5\u8bb0\u5f55\u7684\u6574\u4e2a\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u5bf9\u4e8e\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u6570\u636e\u5e93\u8868\uff0c\u5b83\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u90fd\u5305\u542b\u4e0b\u9762\u4e24\u4e2a\u9690\u85cf\u5217\uff1a trx_id\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u8fdb\u884c\u6539\u52a8\u65f6\uff0c\u5c31\u4f1a**\u628a\u8be5\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u8bb0\u5f55\u5728 trx_id \u9690\u85cf\u5217\u91cc**\uff1b roll_pointer\uff0c\u6bcf\u6b21\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u8fdb\u884c\u6539\u52a8\u65f6\uff0c\u90fd\u4f1a\u628a\u65e7\u7248\u672c\u7684\u8bb0\u5f55\u5199\u5165\u5230 undo \u65e5\u5fd7\u4e2d\uff0c\u7136\u540e**\u8fd9\u4e2a\u9690\u85cf\u5217\u662f\u4e2a\u6307\u9488\uff0c\u6307\u5411\u6bcf\u4e00\u4e2a\u65e7\u7248\u672c\u8bb0\u5f55**\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u901a\u8fc7\u5b83\u627e\u5230\u4fee\u6539\u524d\u7684\u8bb0\u5f55\u3002 \u5728\u521b\u5efa Read View \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8bb0\u5f55\u4e2d\u7684 trx_id \u5212\u5206\u8fd9\u4e09\u79cd\u60c5\u51b5\uff1a \u4e00\u4e2a\u4e8b\u52a1\u53bb\u8bbf\u95ee\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u9664\u4e86\u81ea\u5df1\u7684\u66f4\u65b0\u8bb0\u5f55\u603b\u662f\u53ef\u89c1\u4e4b\u5916\uff0c\u8fd8\u6709\u8fd9\u51e0\u79cd\u60c5\u51b5\uff1a \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5c0f\u4e8e Read View \u4e2d\u7684 min_trx_id \u503c\uff0c\u8868\u793a\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5728\u521b\u5efa Read View \u524d**\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u53ef\u89c1 \u3002 \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5927\u4e8e\u7b49\u4e8e Read View \u4e2d\u7684 max_trx_id \u503c\uff0c\u8868\u793a\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5728\u521b\u5efa Read View \u540e**\u624d\u542f\u52a8\u7684\u4e8b\u52a1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u4e0d\u53ef\u89c1 \u3002 \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5728 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u9700\u8981\u5224\u65ad trx_id \u662f\u5426\u5728 m_ids \u5217\u8868\u4e2d\uff1a \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u5728 m_ids \u5217\u8868\u4e2d\uff0c\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u8bb0\u5f55\u7684\u6d3b\u8dc3\u4e8b\u52a1\u4f9d\u7136\u6d3b\u8dc3\u7740\uff08\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u4e0d\u53ef\u89c1**\u3002 \u5982\u679c\u8bb0\u5f55\u7684 trx_id \u4e0d\u5728 m_ids \u5217\u8868\u4e2d\uff0c\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u8bb0\u5f55\u7684\u6d3b\u8dc3\u4e8b\u52a1\u5df2\u7ecf\u88ab\u63d0\u4ea4\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1**\u53ef\u89c1**\u3002 \u8fd9\u79cd\u901a\u8fc7\u300c\u7248\u672c\u94fe\u300d\u6765\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002","title":"Read View \u5728 MVCC \u91cc\u5982\u4f55\u5de5\u4f5c\u7684\uff1f"},{"location":"mysql/transaction/mvcc/#_8","text":"\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View \u3002 \u5047\u8bbe\u4e8b\u52a1 A \uff08\u4e8b\u52a1 id \u4e3a51\uff09\u542f\u52a8\u540e\uff0c\u7d27\u63a5\u7740\u4e8b\u52a1 B \uff08\u4e8b\u52a1 id \u4e3a52\uff09\u4e5f\u542f\u52a8\u4e86\uff0c\u90a3\u8fd9\u4e24\u4e2a\u4e8b\u52a1\u521b\u5efa\u7684 Read View \u5982\u4e0b\uff1a \u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u7684 Read View \u5177\u4f53\u5185\u5bb9\u5982\u4e0b\uff1a \u5728\u4e8b\u52a1 A \u7684 Read View \u4e2d\uff0c\u5b83\u7684\u4e8b\u52a1 id \u662f 51\uff0c\u7531\u4e8e\u5b83\u662f\u7b2c\u4e00\u4e2a\u542f\u52a8\u7684\u4e8b\u52a1\uff0c\u6240\u4ee5\u6b64\u65f6\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u5c31\u53ea\u6709 51\uff0c\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u4e2d\u6700\u5c0f\u7684\u4e8b\u52a1 id \u662f\u4e8b\u52a1 A \u672c\u8eab\uff0c\u4e0b\u4e00\u4e2a\u4e8b\u52a1 id \u5219\u662f 52\u3002 \u5728\u4e8b\u52a1 B \u7684 Read View \u4e2d\uff0c\u5b83\u7684\u4e8b\u52a1 id \u662f 52\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u662f\u6d3b\u8dc3\u7684\uff0c\u6240\u4ee5\u6b64\u65f6\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u662f 51 \u548c 52\uff0c \u6d3b\u8dc3\u7684\u4e8b\u52a1 id \u4e2d\u6700\u5c0f\u7684\u4e8b\u52a1 id \u662f\u4e8b\u52a1 A \uff0c\u4e0b\u4e00\u4e2a\u4e8b\u52a1 id \u5e94\u8be5\u662f 53\u3002 \u63a5\u7740\uff0c\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u6309\u987a\u5e8f\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u662f 100 \u4e07\uff1b \u4e8b\u52a1 A \u5c06\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\u4fee\u6539\u6210 200 \u4e07\uff0c\u5e76\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u8fd8\u662f 100 \u4e07\uff1b \u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u4f9d\u7136\u8fd8\u662f 100 \u4e07\uff1b \u63a5\u4e0b\u6765\uff0c\u8ddf\u5927\u5bb6\u5177\u4f53\u5206\u6790\u4e0b\u3002 \u4e8b\u52a1 B \u7b2c\u4e00\u6b21\u8bfb\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u5728\u627e\u5230\u8bb0\u5f55\u540e\uff0c\u5b83\u4f1a\u5148\u770b\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id\uff0c\u6b64\u65f6**\u53d1\u73b0 trx_id \u4e3a 50\uff0c\u6bd4\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0851\uff09\u8fd8\u5c0f\uff0c\u8fd9\u610f\u5473\u7740\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1\u65e9\u5c31\u5728\u4e8b\u52a1 B \u542f\u52a8\u524d\u63d0\u4ea4\u8fc7\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u4e8b\u52a1 B \u53ef\u89c1\u7684**\uff0c\u4e5f\u5c31\u662f\u4e8b\u52a1 B \u53ef\u4ee5\u83b7\u53d6\u5230\u8fd9\u6761\u8bb0\u5f55\u3002 \u63a5\u7740\uff0c\u4e8b\u52a1 A \u901a\u8fc7 update \u8bed\u53e5\u5c06\u8fd9\u6761\u8bb0\u5f55\u4fee\u6539\u4e86\uff08\u8fd8\u672a\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u5c06\u5c0f\u6797\u7684\u4f59\u989d\u6539\u6210 200 \u4e07\uff0c\u8fd9\u65f6 MySQL \u4f1a\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5e76\u4ee5\u94fe\u8868\u7684\u65b9\u5f0f\u4e32\u8054\u8d77\u6765\uff0c\u5f62\u6210**\u7248\u672c\u94fe**\uff0c\u5982\u4e0b\u56fe\uff1a \u4f60\u53ef\u4ee5\u5728\u4e0a\u56fe\u7684\u300c\u8bb0\u5f55\u7684\u5b57\u6bb5\u300d\u770b\u5230\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u4ee5\u524d\u7684\u8bb0\u5f55\u5c31\u53d8\u6210\u65e7\u7248\u672c\u8bb0\u5f55\u4e86\uff0c\u4e8e\u662f\u6700\u65b0\u8bb0\u5f55\u548c\u65e7\u7248\u672c\u8bb0\u5f55\u901a\u8fc7\u94fe\u8868\u7684\u65b9\u5f0f\u4e32\u8d77\u6765\uff0c\u800c\u4e14\u6700\u65b0\u8bb0\u5f55\u7684 trx_id \u662f\u4e8b\u52a1 A \u7684\u4e8b\u52a1 id\uff08trx_id = 51\uff09\u3002 \u7136\u540e\u4e8b\u52a1 B \u7b2c\u4e8c\u6b21\u53bb\u8bfb\u53d6\u8be5\u8bb0\u5f55\uff0c \u53d1\u73b0\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u503c\u4e3a 51\uff0c\u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u5219\u9700\u8981\u5224\u65ad trx_id \u503c\u662f\u5426\u5728 m_ids \u8303\u56f4\u5185\uff0c\u5224\u65ad\u7684\u7ed3\u679c\u662f\u5728\u7684\uff0c\u90a3\u4e48\u8bf4\u660e\u8fd9\u6761\u8bb0\u5f55\u662f\u88ab\u8fd8\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fee\u6539\u7684\uff0c\u8fd9\u65f6\u4e8b\u52a1 B \u5e76\u4e0d\u4f1a\u8bfb\u53d6\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u3002\u800c\u662f\u6cbf\u7740 undo log \u94fe\u6761\u5f80\u4e0b\u627e\u65e7\u7248\u672c\u7684\u8bb0\u5f55\uff0c\u76f4\u5230\u627e\u5230 trx_id \u300c\u5c0f\u4e8e\u300d\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55 \uff0c\u6240\u4ee5\u4e8b\u52a1 B \u80fd\u8bfb\u53d6\u5230\u7684\u662f trx_id \u4e3a 50 \u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55\u3002 \u6700\u540e\uff0c\u5f53\u4e8b\u7269 A \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c \u7531\u4e8e\u9694\u79bb\u7ea7\u522b\u65f6\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u518d\u6b21\u8bfb\u53d6\u8bb0\u5f55\u65f6\uff0c\u8fd8\u662f\u57fa\u4e8e\u542f\u52a8\u4e8b\u52a1\u65f6\u521b\u5efa\u7684 Read View \u6765\u5224\u65ad\u5f53\u524d\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5426\u53ef\u89c1\u3002\u6240\u4ee5\uff0c\u5373\u4f7f\u4e8b\u7269 A \u5c06\u5c0f\u6797\u4f59\u989d\u4fee\u6539\u4e3a 200 \u4e07\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c \u4e8b\u52a1 B \u7b2c\u4e09\u6b21\u8bfb\u53d6\u8bb0\u5f55\u65f6\uff0c\u8bfb\u5230\u7684\u8bb0\u5f55\u90fd\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55 \u3002 \u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\uff0c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u8bb0\u5f55\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002","title":"\u53ef\u91cd\u590d\u8bfb\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f"},{"location":"mysql/transaction/mvcc/#_9","text":"\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View \u3002 \u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u90a3\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5de5\u4f5c\u5462\uff1f\u6211\u4eec\u8fd8\u662f\u4ee5\u524d\u9762\u7684\u4f8b\u5b50\u6765\u804a\u804a\u3002 \u5047\u8bbe\u4e8b\u52a1 A \uff08\u4e8b\u52a1 id \u4e3a51\uff09\u542f\u52a8\u540e\uff0c\u7d27\u63a5\u7740\u4e8b\u52a1 B \uff08\u4e8b\u52a1 id \u4e3a52\uff09\u4e5f\u542f\u52a8\u4e86\uff0c\u63a5\u7740\u6309\u987a\u5e8f\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\uff1b \u4e8b\u52a1 A \u4fee\u6539\u6570\u636e\uff08\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u5c06\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4ece 100 \u4e07\u4fee\u6539\u6210\u4e86 200 \u4e07\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\uff1b \u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\uff1b \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 200 \u4e07\uff1b \u90a3\u5177\u4f53\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f\u6211\u4eec\u91cd\u70b9\u770b\u4e8b\u52a1 B \u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684 Read View\u3002\u524d\u4e24\u6b21 \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684 Read View \u5982\u4e0b\u56fe\uff1a \u6211\u4eec\u6765\u5206\u6790\u4e0b\u4e3a\u4ec0\u4e48\u4e8b\u52a1 B \u7b2c\u4e8c\u6b21\u8bfb\u6570\u636e\u65f6\uff0c\u8bfb\u4e0d\u5230\u4e8b\u52a1 A \uff08\u8fd8\u672a\u63d0\u4ea4\u4e8b\u52a1\uff09\u4fee\u6539\u7684\u6570\u636e\uff1f \u4e8b\u52a1 B \u5728\u627e\u5230\u5c0f\u6797\u8fd9\u6761\u8bb0\u5f55\u65f6\uff0c\u4f1a\u770b\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u662f 51\uff0c\u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u5224\u65ad trx_id \u503c\u662f\u5426\u5728 m_ids \u8303\u56f4\u5185\uff0c\u5224\u65ad\u7684\u7ed3\u679c\u662f\u5728\u7684\uff0c\u90a3\u4e48\u8bf4\u660e**\u8fd9\u6761\u8bb0\u5f55\u662f\u88ab\u8fd8\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fee\u6539\u7684\uff0c\u8fd9\u65f6\u4e8b\u52a1 B \u5e76\u4e0d\u4f1a\u8bfb\u53d6\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55**\u3002\u800c\u662f\uff0c\u6cbf\u7740 undo log \u94fe\u6761\u5f80\u4e0b\u627e\u65e7\u7248\u672c\u7684\u8bb0\u5f55\uff0c\u76f4\u5230\u627e\u5230 trx_id \u300c\u5c0f\u4e8e\u300d\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u80fd\u8bfb\u53d6\u5230\u7684\u662f trx_id \u4e3a 50 \u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55\u3002 \u6211\u4eec\u6765\u5206\u6790\u4e0b\u4e3a\u4ec0\u4e48\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c\u4e8b\u52a1 B \u5c31\u53ef\u4ee5\u8bfb\u5230\u4e8b\u52a1 A \u4fee\u6539\u7684\u6570\u636e\uff1f \u5728\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c \u7531\u4e8e\u9694\u79bb\u7ea7\u522b\u662f\u300c\u8bfb\u63d0\u4ea4\u300d\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u6bcf\u6b21\u8bfb\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u91cd\u65b0\u521b\u5efa Read View \uff0c\u6b64\u65f6\u4e8b\u52a1 B \u7b2c\u4e09\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684 Read View \u5982\u4e0b\uff1a \u4e8b\u52a1 B \u5728\u627e\u5230\u5c0f\u6797\u8fd9\u6761\u8bb0\u5f55\u65f6\uff0c \u4f1a\u53d1\u73b0\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u662f 51\uff0c\u6bd4\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0852\uff09\u8fd8\u5c0f\uff0c\u8fd9\u610f\u5473\u7740\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1\u65e9\u5c31\u5728\u521b\u5efa Read View \u524d\u63d0\u4ea4\u8fc7\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u4e8b\u52a1 B \u662f\u53ef\u89c1\u7684 \u3002 \u6b63\u662f\u56e0\u4e3a\u5728\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6bcf\u6b21\u8bfb\u6570\u636e\u65f6\u90fd\u91cd\u65b0\u521b\u5efa Read View\uff0c\u90a3\u4e48\u5728\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002","title":"\u8bfb\u63d0\u4ea4\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f"},{"location":"mysql/transaction/mvcc/#_10","text":"\u4e8b\u52a1\u662f\u5728 MySQL \u5f15\u64ce\u5c42\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5e38\u89c1\u7684 InnoDB \u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u4e8b\u52a1\u7684\u56db\u5927\u7279\u6027\u662f\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u3001\u9694\u79bb\u6027\u3001\u6301\u4e45\u6027\uff0c\u6211\u4eec\u8fd9\u6b21\u4e3b\u8981\u8bb2\u7684\u662f\u9694\u79bb\u6027\u3002 \u5f53\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u5f15\u53d1\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u8fd9\u4e9b\u95ee\u9898\uff0c\u90a3\u4e3a\u4e86\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\uff0cSQL \u63d0\u51fa\u4e86\u56db\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u5206\u522b\u662f\u8bfb\u672a\u63d0\u4ea4\u3001\u8bfb\u5df2\u63d0\u4ea4\u3001\u53ef\u91cd\u590d\u8bfb\u3001\u4e32\u884c\u5316\uff0c\u4ece\u5de6\u5f80\u53f3\u9694\u79bb\u7ea7\u522b\u987a\u5e8f\u9012\u589e\uff0c\u9694\u79bb\u7ea7\u522b\u8d8a\u9ad8\uff0c\u610f\u5473\u7740\u6027\u80fd\u8d8a\u5dee\uff0cInnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662f\u53ef\u91cd\u590d\u8bfb\u3002 \u8981\u89e3\u51b3\u810f\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u8bfb\u5df2\u63d0\u4ea4\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u8981\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u53ef\u91cd\u590d\u8bfb\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\u3002 \u800c\u5bf9\u4e8e\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4e0d\u5efa\u8bae\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u4e3a\u4e32\u884c\u5316\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u5e76\u53d1\u65f6\u6027\u80fd\u5f88\u5dee\u3002MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7 \u6587\u7ae0 \uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u901a\u8fc7 Read View \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff1a \u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u4e2a select \u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View\uff0c\u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 \u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u6570\u636e\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002 \u8fd9\u4e24\u4e2a\u9694\u79bb\u7ea7\u522b\u5b9e\u73b0\u662f\u901a\u8fc7\u300c\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u5b57\u6bb5\u300d\u548c\u300c\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\u300d\u7684\u6bd4\u5bf9\uff0c\u6765\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\uff0c\u8fd9\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002 \u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e2d\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u5c31\u662f\u57fa\u4e8e MVCC \u5b9e\u73b0\u7684\u5feb\u7167\u8bfb\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u52a0\u9501\u7684\u3002\u800c select .. for update \u8bed\u53e5\u5c31\u4e0d\u662f\u5feb\u7167\u8bfb\u4e86\uff0c\u800c\u662f\u5f53\u524d\u8bfb\u4e86\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u8bfb\u90fd\u662f\u62ff\u5230\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff0c\u4f46\u662f\u5b83\u4f1a\u5bf9\u8bfb\u5230\u7684\u8bb0\u5f55\u52a0\u4e0a next-key lock \u9501\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"mysql/transaction/phantom/","text":"MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f \u00b6 \u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6211\u5728 \u4e0a\u4e00\u7bc7\u6587\u7ae0 \u63d0\u5230\uff0cMySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u8fd9\u4e24\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u89e3\u51b3\u4e86\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u8fd8\u662f\u6709\u4e2a\u522b\u7684\u60c5\u51b5\u9020\u6210\u7684\u5e7b\u8bfb\u73b0\u8c61\u662f\u65e0\u6cd5\u89e3\u51b3\u7684\u3002 \u8fd9\u6b21\uff0c\u5c31\u8ddf\u5927\u5bb6\u597d\u597d\u804a\u8fd9\u4e2a\u95ee\u9898\u3002 \u4ec0\u4e48\u662f\u5e7b\u8bfb\uff1f \u00b6 \u9996\u5148\u6765\u770b\u770b MySQL \u6587\u6863\u662f\u600e\u4e48\u5b9a\u4e49\u5e7b\u8bfb\uff08Phantom Read\uff09\u7684: The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a \u201cphantom\u201d row. \u7ffb\u8bd1\uff1a\u5f53\u540c\u4e00\u4e2a\u67e5\u8be2\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u4ea7\u751f\u4e0d\u540c\u7684\u7ed3\u679c\u96c6\u65f6\uff0c\u4e8b\u52a1\u4e2d\u5c31\u4f1a\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8c61\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5982\u679c SELECT \u6267\u884c\u4e86\u4e24\u6b21\uff0c\u4f46\u7b2c\u4e8c\u6b21\u8fd4\u56de\u4e86\u7b2c\u4e00\u6b21\u6ca1\u6709\u8fd4\u56de\u7684\u884c\uff0c\u5219\u8be5\u884c\u662f\u201c\u5e7b\u50cf\u201d\u884c\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e00\u4e2a\u4e8b\u52a1\u5728 T1 \u65f6\u523b\u548c T2 \u65f6\u523b\u5206\u522b\u6267\u884c\u4e86\u4e0b\u9762\u67e5\u8be2\u8bed\u53e5\uff0c\u9014\u4e2d\u6ca1\u6709\u6267\u884c\u5176\u4ed6\u4efb\u4f55\u8bed\u53e5\uff1a SELECT * FROM t_test WHERE id > 100 ; \u53ea\u8981 T1 \u548c T2 \u65f6\u523b\u6267\u884c\u4ea7\u751f\u7684\u7ed3\u679c\u96c6\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 6 \u6761\u884c\u8bb0\u5f55\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 4 \u6761\u884c\u8bb0\u5f55\uff0c\u4e5f\u662f\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 \u5feb\u7167\u8bfb\u662f\u5982\u4f55\u907f\u514d\u5e7b\u8bfb\u7684\uff1f \u00b6 \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u662f\u7531 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5b9e\u73b0\u7684\uff0c\u5b9e\u73b0\u7684\u65b9\u5f0f\u662f\u542f\u52a8\u4e8b\u52a1\u540e\uff0c\u5728\u6267\u884c\u7b2c\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a Read View\uff0c \u540e\u7eed\u7684\u67e5\u8be2\u8bed\u53e5\u5229\u7528\u8fd9\u4e2a Read View\uff0c\u901a\u8fc7\u8fd9\u4e2a Read View \u5c31\u53ef\u4ee5\u5728 undo log \u7248\u672c\u94fe\u627e\u5230\u4e8b\u52a1\u5f00\u59cb\u65f6\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u6bcf\u6b21\u67e5\u8be2\u7684\u6570\u636e\u90fd\u662f\u4e00\u6837\u7684 \uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u65b0\u7eaa\u5f55\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u505a\u4e2a\u5b9e\u9a8c\uff0c\u6570\u636e\u5e93\u8868 t_stu \u5982\u4e0b\uff0c\u5176\u4e2d id \u4e3a\u4e3b\u952e\u3002 \u7136\u540e\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a \u4ece\u8fd9\u4e2a\u5b9e\u9a8c\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u5373\u4f7f\u4e8b\u52a1 B \u4e2d\u9014\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u4e8b\u52a1 A \u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5e76\u6ca1\u6709\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8bfb\u73b0\u8c61\u3002 \u5f53\u524d\u8bfb\u662f\u5982\u4f55\u907f\u514d\u5e7b\u8bfb\u7684\uff1f \u00b6 MySQL \u91cc\u9664\u4e86\u666e\u901a\u67e5\u8be2\u662f\u5feb\u7167\u8bfb\uff0c\u5176\u4ed6\u90fd\u662f**\u5f53\u524d\u8bfb**\uff0c\u6bd4\u5982 update\u3001insert\u3001delete\uff0c\u8fd9\u4e9b\u8bed\u53e5\u6267\u884c\u524d\u90fd\u4f1a\u67e5\u8be2\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u505a\u8fdb\u4e00\u6b65\u7684\u64cd\u4f5c\u3002 \u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u5047\u8bbe\u4f60\u8981 update \u4e00\u4e2a\u8bb0\u5f55\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5df2\u7ecf delete \u8fd9\u6761\u8bb0\u5f55\u5e76\u4e14\u63d0\u4ea4\u4e8b\u52a1\u4e86\uff0c\u8fd9\u6837\u4e0d\u662f\u4f1a\u4ea7\u751f\u51b2\u7a81\u5417\uff0c\u6240\u4ee5 update \u7684\u65f6\u5019\u80af\u5b9a\u8981\u77e5\u9053\u6700\u65b0\u7684\u6570\u636e\u3002 \u53e6\u5916\uff0c select ... for update \u8fd9\u79cd\u67e5\u8be2\u8bed\u53e5\u662f\u5f53\u524d\u8bfb\uff0c\u6bcf\u6b21\u6267\u884c\u7684\u65f6\u5019\u90fd\u662f\u8bfb\u53d6\u6700\u65b0\u7684\u6570\u636e\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5047\u8bbe select ... for update \u5f53\u524d\u8bfb\u662f\u4e0d\u4f1a\u52a0\u9501\u7684\uff08\u5b9e\u9645\u4e0a\u662f\u4f1a\u52a0\u9501\u7684\uff09\uff0c\u5728\u505a\u4e00\u904d\u5b9e\u9a8c\u3002 \u8fd9\u65f6\u5019\uff0c\u4e8b\u52a1 B \u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u5c31\u4f1a\u88ab\u4e8b\u52a1 A \u7684\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u5230\uff08\u56e0\u4e3a\u662f\u5f53\u524d\u8bfb\uff09\uff0c\u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5408\u4e0d\u4e00\u6837\uff0c\u8fd9\u5c31\u51fa\u73b0\u4e86\u5e7b\u8bfb\u3002 \u6240\u4ee5\uff0c Innodb \u5f15\u64ce\u4e3a\u4e86\u89e3\u51b3\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4f7f\u7528\u300c\u5f53\u524d\u8bfb\u300d\u800c\u9020\u6210\u7684\u5e7b\u8bfb\u95ee\u9898\uff0c\u5c31\u5f15\u51fa\u4e86\u95f4\u9699\u9501 \u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u4e3e\u4e2a\u5177\u4f53\u4f8b\u5b50\uff0c\u573a\u666f\u5982\u4e0b\uff1a \u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u9762\u8fd9\u6761\u9501\u5b9a\u8bfb\u8bed\u53e5\u540e\uff0c\u5c31\u5728\u5bf9\u8868\u4e2d\u7684\u8bb0\u5f55\u52a0\u4e0a id \u8303\u56f4\u4e3a (2, +\u221e] \u7684 next-key lock\uff08next-key lock \u662f\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\u7ec4\u5408\uff09\u3002 \u7136\u540e\uff0c\u4e8b\u52a1 B \u5728\u6267\u884c\u63d2\u5165\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5224\u65ad\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\u88ab\u4e8b\u52a1 A \u52a0\u4e86 next-key lock\uff0c\u4e8e\u662f\u4e8b\u7269 B \u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u540c\u65f6\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002\u8fd9\u5c31\u907f\u514d\u4e86\u7531\u4e8e\u4e8b\u52a1 B \u63d2\u5165\u65b0\u8bb0\u5f55\u800c\u5bfc\u81f4\u4e8b\u52a1 A \u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002 \u5e7b\u8bfb\u88ab\u5b8c\u5168\u89e3\u51b3\u4e86\u5417\uff1f \u00b6 \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u867d\u7136\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5e7b\u8bfb\uff0c\u4f46\u662f\u8fd8\u662f\u6ca1\u6709\u80fd\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb \u3002 \u6211\u4e3e\u4f8b\u4e00\u4e2a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f\u3002 \u7b2c\u4e00\u4e2a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f \u00b6 \u8fd8\u662f\u4ee5\u8fd9\u5f20\u8868\u4f5c\u4e3a\u4f8b\u5b50\uff1a \u4e8b\u52a1 A \u6267\u884c\u67e5\u8be2 id = 5 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u8868\u4e2d\u662f\u6ca1\u6709\u8be5\u8bb0\u5f55\u7684\uff0c\u6240\u4ee5\u67e5\u8be2\u4e0d\u51fa\u6765\u3002 # \u4e8b\u52a1 A mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from t_stu where id = 5 ; Empty set ( 0 . 01 sec ) \u7136\u540e\u4e8b\u52a1 B \u63d2\u5165\u4e00\u6761 id = 5 \u7684\u8bb0\u5f55\uff0c\u5e76\u4e14\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 # \u4e8b\u52a1 B mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > insert into t_stu values ( 5 , '\u5c0f\u7f8e' , 18 ); Query OK , 1 row affected ( 0 . 00 sec ) mysql > commit ; Query OK , 0 rows affected ( 0 . 00 sec ) \u6b64\u65f6\uff0c \u4e8b\u52a1 A \u66f4\u65b0 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u5bf9\u6ca1\u9519\uff0c\u4e8b\u52a1 A \u770b\u4e0d\u5230 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u4ed6\u53bb\u66f4\u65b0\u4e86\u8fd9\u6761\u8bb0\u5f55\uff0c\u8fd9\u573a\u666f\u786e\u5b9e\u5f88\u8fdd\u548c\uff0c\u7136\u540e\u518d\u6b21\u67e5\u8be2 id = 5 \u7684\u8bb0\u5f55\uff0c\u4e8b\u52a1 A \u5c31\u80fd\u770b\u5230\u4e8b\u52a1 B \u63d2\u5165\u7684\u7eaa\u5f55\u4e86\uff0c\u5e7b\u8bfb\u5c31\u662f\u53d1\u751f\u5728\u8fd9\u79cd\u8fdd\u548c\u7684\u573a\u666f \u3002 # \u4e8b\u52a1 A mysql > update t_stu set name = '\u5c0f\u6797coding' where id = 5 ; Query OK , 1 row affected ( 0 . 01 sec ) Rows matched : 1 Changed : 1 Warnings : 0 mysql > select * from t_stu where id = 5 ; + ----+--------------+------+ | id | name | age | + ----+--------------+------+ | 5 | \u5c0f\u6797 coding | 18 | + ----+--------------+------+ 1 row in set ( 0 . 00 sec ) \u6574\u4e2a\u53d1\u751f\u5e7b\u8bfb\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a \u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u7b2c\u4e00\u6b21\u6267\u884c\u666e\u901a\u7684 select \u8bed\u53e5\u65f6\u751f\u6210\u4e86\u4e00\u4e2a ReadView\uff0c\u4e4b\u540e\u4e8b\u52a1 B \u5411\u8868\u4e2d\u65b0\u63d2\u5165\u4e86\u4e00\u6761 id = 5 \u7684\u8bb0\u5f55\u5e76\u63d0\u4ea4\u3002\u63a5\u7740\uff0c\u4e8b\u52a1 A \u5bf9 id = 5 \u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u4e86\u66f4\u65b0\u64cd\u4f5c\uff0c\u5728\u8fd9\u4e2a\u65f6\u523b\uff0c\u8fd9\u6761\u65b0\u8bb0\u5f55\u7684 trx_id \u9690\u85cf\u5217\u7684\u503c\u5c31\u53d8\u6210\u4e86\u4e8b\u52a1 A \u7684\u4e8b\u52a1 id\uff0c\u4e4b\u540e\u4e8b\u52a1 A \u518d\u4f7f\u7528\u666e\u901a select \u8bed\u53e5\u53bb\u67e5\u8be2\u8fd9\u6761\u8bb0\u5f55\u65f6\u5c31\u53ef\u4ee5\u770b\u5230\u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u4e8e\u662f\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u3002 \u56e0\u4e3a\u8fd9\u79cd\u7279\u6b8a\u73b0\u8c61\u7684\u5b58\u5728\uff0c\u6240\u4ee5\u6211\u4eec\u8ba4\u4e3a MySQL Innodb \u4e2d\u7684 MVCC \u5e76\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61 \u3002 \u7b2c\u4e8c\u4e2a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f \u00b6 \u9664\u4e86\u4e0a\u9762\u8fd9\u4e00\u79cd\u573a\u666f\u4f1a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u4e4b\u5916\uff0c\u8fd8\u6709\u4e0b\u9762\u8fd9\u4e2a\u573a\u666f\u4e5f\u4f1a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u3002 T1 \u65f6\u523b\uff1a\u4e8b\u52a1 A \u5148\u6267\u884c\u300c\u5feb\u7167\u8bfb\u8bed\u53e5\u300d\uff1aselect * from t_test where id > 100 \u5f97\u5230\u4e86 3 \u6761\u8bb0\u5f55\u3002 T2 \u65f6\u523b\uff1a\u4e8b\u52a1 B \u5f80\u63d2\u5165\u4e00\u4e2a id= 200 \u7684\u8bb0\u5f55\u5e76\u63d0\u4ea4\uff1b T3 \u65f6\u523b\uff1a\u4e8b\u52a1 A \u518d\u6267\u884c\u300c\u5f53\u524d\u8bfb\u8bed\u53e5\u300d select * from t_test where id > 100 for update \u5c31\u4f1a\u5f97\u5230 4 \u6761\u8bb0\u5f55\uff0c\u6b64\u65f6\u4e5f\u53d1\u751f\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002 \u8981\u907f\u514d\u8fd9\u7c7b\u7279\u6b8a\u573a\u666f\u4e0b\u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u7684\u8bdd\uff0c\u5c31\u662f\u5c3d\u91cf\u5728\u5f00\u542f\u4e8b\u52a1\u4e4b\u540e\uff0c\u9a6c\u4e0a\u6267\u884c select ... for update \u8fd9\u7c7b\u5f53\u524d\u8bfb\u7684\u8bed\u53e5 \uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bf9\u8bb0\u5f55\u52a0 next-key lock\uff0c\u4ece\u800c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\u3002 \u603b\u7ed3 \u00b6 MySQL InnoDB \u5f15\u64ce\u7684\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\uff09\uff0c\u6839\u636e\u4e0d\u540c\u7684\u67e5\u8be2\u65b9\u5f0f\uff0c\u5206\u522b\u63d0\u51fa\u4e86\u907f\u514d\u5e7b\u8bfb\u7684\u65b9\u6848\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\u3002 \u6211\u4e3e\u4f8b\u4e86\u4e24\u4e2a\u53d1\u751f\u5e7b\u8bfb\u573a\u666f\u7684\u4f8b\u5b50\u3002 \u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff1a\u5bf9\u4e8e\u5feb\u7167\u8bfb\uff0c MVCC \u5e76\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u3002\u56e0\u4e3a\u5f53\u4e8b\u52a1 A \u66f4\u65b0\u4e86\u4e00\u6761\u4e8b\u52a1 B \u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u90a3\u4e48\u4e8b\u52a1 A \u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u8bb0\u5f55\u6761\u76ee\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5c31\u53d1\u751f\u5e7b\u8bfb\u3002 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\uff1a\u5bf9\u4e8e\u5f53\u524d\u8bfb\uff0c\u5982\u679c\u4e8b\u52a1\u5f00\u542f\u540e\uff0c\u5e76\u6ca1\u6709\u6267\u884c\u5f53\u524d\u8bfb\uff0c\u800c\u662f\u5148\u5feb\u7167\u8bfb\uff0c\u7136\u540e\u8fd9\u671f\u95f4\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u4e8b\u52a1\u540e\u7eed\u4f7f\u7528\u5f53\u524d\u8bfb\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53d1\u73b0\u4e24\u6b21\u67e5\u8be2\u7684\u8bb0\u5f55\u6761\u76ee\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5c31\u53d1\u751f\u5e7b\u8bfb\u3002 \u6240\u4ee5\uff0c MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u5e76\u6ca1\u6709\u5f7b\u5e95\u89e3\u51b3\u5e7b\u8bfb\uff0c\u53ea\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u8981\u907f\u514d\u8fd9\u7c7b\u7279\u6b8a\u573a\u666f\u4e0b\u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u7684\u8bdd\uff0c\u5c31\u662f\u5c3d\u91cf\u5728\u5f00\u542f\u4e8b\u52a1\u4e4b\u540e\uff0c\u9a6c\u4e0a\u6267\u884c select ... for update \u8fd9\u7c7b\u5f53\u524d\u8bfb\u7684\u8bed\u53e5\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bf9\u8bb0\u5f55\u52a0 next-key lock\uff0c\u4ece\u800c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f"},{"location":"mysql/transaction/phantom/#mysql","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002 \u6211\u5728 \u4e0a\u4e00\u7bc7\u6587\u7ae0 \u63d0\u5230\uff0cMySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f**\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb**\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u8fd9\u4e24\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u89e3\u51b3\u4e86\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u8fd8\u662f\u6709\u4e2a\u522b\u7684\u60c5\u51b5\u9020\u6210\u7684\u5e7b\u8bfb\u73b0\u8c61\u662f\u65e0\u6cd5\u89e3\u51b3\u7684\u3002 \u8fd9\u6b21\uff0c\u5c31\u8ddf\u5927\u5bb6\u597d\u597d\u804a\u8fd9\u4e2a\u95ee\u9898\u3002","title":"MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f"},{"location":"mysql/transaction/phantom/#_1","text":"\u9996\u5148\u6765\u770b\u770b MySQL \u6587\u6863\u662f\u600e\u4e48\u5b9a\u4e49\u5e7b\u8bfb\uff08Phantom Read\uff09\u7684: The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a \u201cphantom\u201d row. \u7ffb\u8bd1\uff1a\u5f53\u540c\u4e00\u4e2a\u67e5\u8be2\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u4ea7\u751f\u4e0d\u540c\u7684\u7ed3\u679c\u96c6\u65f6\uff0c\u4e8b\u52a1\u4e2d\u5c31\u4f1a\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8c61\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5982\u679c SELECT \u6267\u884c\u4e86\u4e24\u6b21\uff0c\u4f46\u7b2c\u4e8c\u6b21\u8fd4\u56de\u4e86\u7b2c\u4e00\u6b21\u6ca1\u6709\u8fd4\u56de\u7684\u884c\uff0c\u5219\u8be5\u884c\u662f\u201c\u5e7b\u50cf\u201d\u884c\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e00\u4e2a\u4e8b\u52a1\u5728 T1 \u65f6\u523b\u548c T2 \u65f6\u523b\u5206\u522b\u6267\u884c\u4e86\u4e0b\u9762\u67e5\u8be2\u8bed\u53e5\uff0c\u9014\u4e2d\u6ca1\u6709\u6267\u884c\u5176\u4ed6\u4efb\u4f55\u8bed\u53e5\uff1a SELECT * FROM t_test WHERE id > 100 ; \u53ea\u8981 T1 \u548c T2 \u65f6\u523b\u6267\u884c\u4ea7\u751f\u7684\u7ed3\u679c\u96c6\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 6 \u6761\u884c\u8bb0\u5f55\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 4 \u6761\u884c\u8bb0\u5f55\uff0c\u4e5f\u662f\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002","title":"\u4ec0\u4e48\u662f\u5e7b\u8bfb\uff1f"},{"location":"mysql/transaction/phantom/#_2","text":"\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u662f\u7531 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5b9e\u73b0\u7684\uff0c\u5b9e\u73b0\u7684\u65b9\u5f0f\u662f\u542f\u52a8\u4e8b\u52a1\u540e\uff0c\u5728\u6267\u884c\u7b2c\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a Read View\uff0c \u540e\u7eed\u7684\u67e5\u8be2\u8bed\u53e5\u5229\u7528\u8fd9\u4e2a Read View\uff0c\u901a\u8fc7\u8fd9\u4e2a Read View \u5c31\u53ef\u4ee5\u5728 undo log \u7248\u672c\u94fe\u627e\u5230\u4e8b\u52a1\u5f00\u59cb\u65f6\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u6bcf\u6b21\u67e5\u8be2\u7684\u6570\u636e\u90fd\u662f\u4e00\u6837\u7684 \uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u65b0\u7eaa\u5f55\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 \u505a\u4e2a\u5b9e\u9a8c\uff0c\u6570\u636e\u5e93\u8868 t_stu \u5982\u4e0b\uff0c\u5176\u4e2d id \u4e3a\u4e3b\u952e\u3002 \u7136\u540e\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a \u4ece\u8fd9\u4e2a\u5b9e\u9a8c\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u5373\u4f7f\u4e8b\u52a1 B \u4e2d\u9014\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u4e8b\u52a1 A \u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5e76\u6ca1\u6709\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8bfb\u73b0\u8c61\u3002","title":"\u5feb\u7167\u8bfb\u662f\u5982\u4f55\u907f\u514d\u5e7b\u8bfb\u7684\uff1f"},{"location":"mysql/transaction/phantom/#_3","text":"MySQL \u91cc\u9664\u4e86\u666e\u901a\u67e5\u8be2\u662f\u5feb\u7167\u8bfb\uff0c\u5176\u4ed6\u90fd\u662f**\u5f53\u524d\u8bfb**\uff0c\u6bd4\u5982 update\u3001insert\u3001delete\uff0c\u8fd9\u4e9b\u8bed\u53e5\u6267\u884c\u524d\u90fd\u4f1a\u67e5\u8be2\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u505a\u8fdb\u4e00\u6b65\u7684\u64cd\u4f5c\u3002 \u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u5047\u8bbe\u4f60\u8981 update \u4e00\u4e2a\u8bb0\u5f55\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5df2\u7ecf delete \u8fd9\u6761\u8bb0\u5f55\u5e76\u4e14\u63d0\u4ea4\u4e8b\u52a1\u4e86\uff0c\u8fd9\u6837\u4e0d\u662f\u4f1a\u4ea7\u751f\u51b2\u7a81\u5417\uff0c\u6240\u4ee5 update \u7684\u65f6\u5019\u80af\u5b9a\u8981\u77e5\u9053\u6700\u65b0\u7684\u6570\u636e\u3002 \u53e6\u5916\uff0c select ... for update \u8fd9\u79cd\u67e5\u8be2\u8bed\u53e5\u662f\u5f53\u524d\u8bfb\uff0c\u6bcf\u6b21\u6267\u884c\u7684\u65f6\u5019\u90fd\u662f\u8bfb\u53d6\u6700\u65b0\u7684\u6570\u636e\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5047\u8bbe select ... for update \u5f53\u524d\u8bfb\u662f\u4e0d\u4f1a\u52a0\u9501\u7684\uff08\u5b9e\u9645\u4e0a\u662f\u4f1a\u52a0\u9501\u7684\uff09\uff0c\u5728\u505a\u4e00\u904d\u5b9e\u9a8c\u3002 \u8fd9\u65f6\u5019\uff0c\u4e8b\u52a1 B \u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u5c31\u4f1a\u88ab\u4e8b\u52a1 A \u7684\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u5230\uff08\u56e0\u4e3a\u662f\u5f53\u524d\u8bfb\uff09\uff0c\u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5408\u4e0d\u4e00\u6837\uff0c\u8fd9\u5c31\u51fa\u73b0\u4e86\u5e7b\u8bfb\u3002 \u6240\u4ee5\uff0c Innodb \u5f15\u64ce\u4e3a\u4e86\u89e3\u51b3\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4f7f\u7528\u300c\u5f53\u524d\u8bfb\u300d\u800c\u9020\u6210\u7684\u5e7b\u8bfb\u95ee\u9898\uff0c\u5c31\u5f15\u51fa\u4e86\u95f4\u9699\u9501 \u3002 \u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u4e3e\u4e2a\u5177\u4f53\u4f8b\u5b50\uff0c\u573a\u666f\u5982\u4e0b\uff1a \u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u9762\u8fd9\u6761\u9501\u5b9a\u8bfb\u8bed\u53e5\u540e\uff0c\u5c31\u5728\u5bf9\u8868\u4e2d\u7684\u8bb0\u5f55\u52a0\u4e0a id \u8303\u56f4\u4e3a (2, +\u221e] \u7684 next-key lock\uff08next-key lock \u662f\u95f4\u9699\u9501+\u8bb0\u5f55\u9501\u7684\u7ec4\u5408\uff09\u3002 \u7136\u540e\uff0c\u4e8b\u52a1 B \u5728\u6267\u884c\u63d2\u5165\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5224\u65ad\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\u88ab\u4e8b\u52a1 A \u52a0\u4e86 next-key lock\uff0c\u4e8e\u662f\u4e8b\u7269 B \u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u540c\u65f6\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002\u8fd9\u5c31\u907f\u514d\u4e86\u7531\u4e8e\u4e8b\u52a1 B \u63d2\u5165\u65b0\u8bb0\u5f55\u800c\u5bfc\u81f4\u4e8b\u52a1 A \u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002","title":"\u5f53\u524d\u8bfb\u662f\u5982\u4f55\u907f\u514d\u5e7b\u8bfb\u7684\uff1f"},{"location":"mysql/transaction/phantom/#_4","text":"\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u867d\u7136\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5e7b\u8bfb\uff0c\u4f46\u662f\u8fd8\u662f\u6ca1\u6709\u80fd\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb \u3002 \u6211\u4e3e\u4f8b\u4e00\u4e2a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f\u3002","title":"\u5e7b\u8bfb\u88ab\u5b8c\u5168\u89e3\u51b3\u4e86\u5417\uff1f"},{"location":"mysql/transaction/phantom/#_5","text":"\u8fd8\u662f\u4ee5\u8fd9\u5f20\u8868\u4f5c\u4e3a\u4f8b\u5b50\uff1a \u4e8b\u52a1 A \u6267\u884c\u67e5\u8be2 id = 5 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u8868\u4e2d\u662f\u6ca1\u6709\u8be5\u8bb0\u5f55\u7684\uff0c\u6240\u4ee5\u67e5\u8be2\u4e0d\u51fa\u6765\u3002 # \u4e8b\u52a1 A mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > select * from t_stu where id = 5 ; Empty set ( 0 . 01 sec ) \u7136\u540e\u4e8b\u52a1 B \u63d2\u5165\u4e00\u6761 id = 5 \u7684\u8bb0\u5f55\uff0c\u5e76\u4e14\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002 # \u4e8b\u52a1 B mysql > begin ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > insert into t_stu values ( 5 , '\u5c0f\u7f8e' , 18 ); Query OK , 1 row affected ( 0 . 00 sec ) mysql > commit ; Query OK , 0 rows affected ( 0 . 00 sec ) \u6b64\u65f6\uff0c \u4e8b\u52a1 A \u66f4\u65b0 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u5bf9\u6ca1\u9519\uff0c\u4e8b\u52a1 A \u770b\u4e0d\u5230 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u4ed6\u53bb\u66f4\u65b0\u4e86\u8fd9\u6761\u8bb0\u5f55\uff0c\u8fd9\u573a\u666f\u786e\u5b9e\u5f88\u8fdd\u548c\uff0c\u7136\u540e\u518d\u6b21\u67e5\u8be2 id = 5 \u7684\u8bb0\u5f55\uff0c\u4e8b\u52a1 A \u5c31\u80fd\u770b\u5230\u4e8b\u52a1 B \u63d2\u5165\u7684\u7eaa\u5f55\u4e86\uff0c\u5e7b\u8bfb\u5c31\u662f\u53d1\u751f\u5728\u8fd9\u79cd\u8fdd\u548c\u7684\u573a\u666f \u3002 # \u4e8b\u52a1 A mysql > update t_stu set name = '\u5c0f\u6797coding' where id = 5 ; Query OK , 1 row affected ( 0 . 01 sec ) Rows matched : 1 Changed : 1 Warnings : 0 mysql > select * from t_stu where id = 5 ; + ----+--------------+------+ | id | name | age | + ----+--------------+------+ | 5 | \u5c0f\u6797 coding | 18 | + ----+--------------+------+ 1 row in set ( 0 . 00 sec ) \u6574\u4e2a\u53d1\u751f\u5e7b\u8bfb\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a \u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u7b2c\u4e00\u6b21\u6267\u884c\u666e\u901a\u7684 select \u8bed\u53e5\u65f6\u751f\u6210\u4e86\u4e00\u4e2a ReadView\uff0c\u4e4b\u540e\u4e8b\u52a1 B \u5411\u8868\u4e2d\u65b0\u63d2\u5165\u4e86\u4e00\u6761 id = 5 \u7684\u8bb0\u5f55\u5e76\u63d0\u4ea4\u3002\u63a5\u7740\uff0c\u4e8b\u52a1 A \u5bf9 id = 5 \u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u4e86\u66f4\u65b0\u64cd\u4f5c\uff0c\u5728\u8fd9\u4e2a\u65f6\u523b\uff0c\u8fd9\u6761\u65b0\u8bb0\u5f55\u7684 trx_id \u9690\u85cf\u5217\u7684\u503c\u5c31\u53d8\u6210\u4e86\u4e8b\u52a1 A \u7684\u4e8b\u52a1 id\uff0c\u4e4b\u540e\u4e8b\u52a1 A \u518d\u4f7f\u7528\u666e\u901a select \u8bed\u53e5\u53bb\u67e5\u8be2\u8fd9\u6761\u8bb0\u5f55\u65f6\u5c31\u53ef\u4ee5\u770b\u5230\u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u4e8e\u662f\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u3002 \u56e0\u4e3a\u8fd9\u79cd\u7279\u6b8a\u73b0\u8c61\u7684\u5b58\u5728\uff0c\u6240\u4ee5\u6211\u4eec\u8ba4\u4e3a MySQL Innodb \u4e2d\u7684 MVCC \u5e76\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61 \u3002","title":"\u7b2c\u4e00\u4e2a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f"},{"location":"mysql/transaction/phantom/#_6","text":"\u9664\u4e86\u4e0a\u9762\u8fd9\u4e00\u79cd\u573a\u666f\u4f1a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u4e4b\u5916\uff0c\u8fd8\u6709\u4e0b\u9762\u8fd9\u4e2a\u573a\u666f\u4e5f\u4f1a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u3002 T1 \u65f6\u523b\uff1a\u4e8b\u52a1 A \u5148\u6267\u884c\u300c\u5feb\u7167\u8bfb\u8bed\u53e5\u300d\uff1aselect * from t_test where id > 100 \u5f97\u5230\u4e86 3 \u6761\u8bb0\u5f55\u3002 T2 \u65f6\u523b\uff1a\u4e8b\u52a1 B \u5f80\u63d2\u5165\u4e00\u4e2a id= 200 \u7684\u8bb0\u5f55\u5e76\u63d0\u4ea4\uff1b T3 \u65f6\u523b\uff1a\u4e8b\u52a1 A \u518d\u6267\u884c\u300c\u5f53\u524d\u8bfb\u8bed\u53e5\u300d select * from t_test where id > 100 for update \u5c31\u4f1a\u5f97\u5230 4 \u6761\u8bb0\u5f55\uff0c\u6b64\u65f6\u4e5f\u53d1\u751f\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002 \u8981\u907f\u514d\u8fd9\u7c7b\u7279\u6b8a\u573a\u666f\u4e0b\u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u7684\u8bdd\uff0c\u5c31\u662f\u5c3d\u91cf\u5728\u5f00\u542f\u4e8b\u52a1\u4e4b\u540e\uff0c\u9a6c\u4e0a\u6267\u884c select ... for update \u8fd9\u7c7b\u5f53\u524d\u8bfb\u7684\u8bed\u53e5 \uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bf9\u8bb0\u5f55\u52a0 next-key lock\uff0c\u4ece\u800c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\u3002","title":"\u7b2c\u4e8c\u4e2a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f"},{"location":"mysql/transaction/phantom/#_7","text":"MySQL InnoDB \u5f15\u64ce\u7684\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\uff09\uff0c\u6839\u636e\u4e0d\u540c\u7684\u67e5\u8be2\u65b9\u5f0f\uff0c\u5206\u522b\u63d0\u51fa\u4e86\u907f\u514d\u5e7b\u8bfb\u7684\u65b9\u6848\uff1a \u9488\u5bf9**\u5feb\u7167\u8bfb**\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\u3002 \u9488\u5bf9**\u5f53\u524d\u8bfb**\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501+\u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\u3002 \u6211\u4e3e\u4f8b\u4e86\u4e24\u4e2a\u53d1\u751f\u5e7b\u8bfb\u573a\u666f\u7684\u4f8b\u5b50\u3002 \u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff1a\u5bf9\u4e8e\u5feb\u7167\u8bfb\uff0c MVCC \u5e76\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u3002\u56e0\u4e3a\u5f53\u4e8b\u52a1 A \u66f4\u65b0\u4e86\u4e00\u6761\u4e8b\u52a1 B \u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u90a3\u4e48\u4e8b\u52a1 A \u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u8bb0\u5f55\u6761\u76ee\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5c31\u53d1\u751f\u5e7b\u8bfb\u3002 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\uff1a\u5bf9\u4e8e\u5f53\u524d\u8bfb\uff0c\u5982\u679c\u4e8b\u52a1\u5f00\u542f\u540e\uff0c\u5e76\u6ca1\u6709\u6267\u884c\u5f53\u524d\u8bfb\uff0c\u800c\u662f\u5148\u5feb\u7167\u8bfb\uff0c\u7136\u540e\u8fd9\u671f\u95f4\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u4e8b\u52a1\u540e\u7eed\u4f7f\u7528\u5f53\u524d\u8bfb\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53d1\u73b0\u4e24\u6b21\u67e5\u8be2\u7684\u8bb0\u5f55\u6761\u76ee\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5c31\u53d1\u751f\u5e7b\u8bfb\u3002 \u6240\u4ee5\uff0c MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u5e76\u6ca1\u6709\u5f7b\u5e95\u89e3\u51b3\u5e7b\u8bfb\uff0c\u53ea\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002 \u8981\u907f\u514d\u8fd9\u7c7b\u7279\u6b8a\u573a\u666f\u4e0b\u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u7684\u8bdd\uff0c\u5c31\u662f\u5c3d\u91cf\u5728\u5f00\u542f\u4e8b\u52a1\u4e4b\u540e\uff0c\u9a6c\u4e0a\u6267\u884c select ... for update \u8fd9\u7c7b\u5f53\u524d\u8bfb\u7684\u8bed\u53e5\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bf9\u8bb0\u5f55\u52a0 next-key lock\uff0c\u4ece\u800c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\u3002 \u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002","title":"\u603b\u7ed3"},{"location":"projectManagement/scrcpy/","text":"scrcpy\u5b89\u88c5 \u00b6 https://github.com/Genymobile/scrcpy The application is available in Homebrew. Just install it: brew install scrcpy You need adb, accessible from your PATH. If you don't have it yet: brew install android-platform-tools Run \u00b6 Plug an Android device into your computer, and execute: scrcpy It accepts command-line arguments, listed by: scrcpy --help Features \u00b6 \u67e5\u770b\u5f53\u524d\u6709\u51e0\u53f0\u624b\u673a\u8fde\u63a5 adb devices List of devices attached A7Q0218223002753 device #\u624b\u673a1 R28M31YAQQM device #\u624b\u673a2 scrcpy --window-title '\u624b\u673a1' -s A7Q0218223002753 scrcpy --window-title '\u624b\u673a2' -s R28M31YAQQM \u542f\u52a8\u65f6\u62a5\u9519 \u00b6 dyld[46627]: Library not loaded: /opt/homebrew/opt/rav1e/lib/librav1e.0.5.dylib \u89e3\u51b3\u65b9\u6cd5 brew reinstall rav1e \u53c2\u8003\uff1ahttps://github.com/Genymobile/scrcpy/issues/3578","title":"\u624b\u673a\u6295\u5c4f"},{"location":"projectManagement/scrcpy/#scrcpy","text":"https://github.com/Genymobile/scrcpy The application is available in Homebrew. Just install it: brew install scrcpy You need adb, accessible from your PATH. If you don't have it yet: brew install android-platform-tools","title":"scrcpy\u5b89\u88c5"},{"location":"projectManagement/scrcpy/#run","text":"Plug an Android device into your computer, and execute: scrcpy It accepts command-line arguments, listed by: scrcpy --help","title":"Run"},{"location":"projectManagement/scrcpy/#features","text":"\u67e5\u770b\u5f53\u524d\u6709\u51e0\u53f0\u624b\u673a\u8fde\u63a5 adb devices List of devices attached A7Q0218223002753 device #\u624b\u673a1 R28M31YAQQM device #\u624b\u673a2 scrcpy --window-title '\u624b\u673a1' -s A7Q0218223002753 scrcpy --window-title '\u624b\u673a2' -s R28M31YAQQM","title":"Features"},{"location":"projectManagement/scrcpy/#_1","text":"dyld[46627]: Library not loaded: /opt/homebrew/opt/rav1e/lib/librav1e.0.5.dylib \u89e3\u51b3\u65b9\u6cd5 brew reinstall rav1e \u53c2\u8003\uff1ahttps://github.com/Genymobile/scrcpy/issues/3578","title":"\u542f\u52a8\u65f6\u62a5\u9519"},{"location":"projectManagement/varchar/","text":"MySQL\u7684varchar(10)\u80fd\u5b58\u591a\u5c11\u4e2a\u6c49\u5b57\uff1f \u00b6 \u95ee\u9898 MySQL\u7684varchar(10)\u80fd\u5b58\u591a\u5c11\u4e2a\u6c49\u5b57\uff1f \u5982\u679c\u662f\u6570\u5b57\u6216\u82f1\u6587\uff0c\u53ef\u4ee5\u5b5810\u4e2a\uff0c\u5982\u679c\u662f\u6c49\u5b57\u5462\uff0c\u80fd\u5b58\u591a\u5c11\u4e2a\uff1f \u5b9e\u8df5 \u67e5\u770bMySQL\u7248\u672c\u53f7\uff1a ` select version(); select @@version; \u672c\u673aMySQL\u7248\u672c\u4e3a5.6.16\u3002 \u521b\u5efa\u6d4b\u8bd5\u8868\uff1a create table test_table ( id bigint(20) not null, product_code varchar(10) not null, primary key (id) ) engine=innodb default charset=utf8mb4; \u5148\u7528\u6570\u5b57\u6765\u6d4b\u8bd5\u4e0b\uff0c\u5199\u516510\u4e2a\u6570\u5b57\uff1a insert into test_table(id,product_code) values(1,'1234567890'); \u5199\u5165\u6210\u529f\uff0c\u67e5\u8be2\u6570\u636e\uff1a select id,product_code,length(product_code), char_length(product_code) from test_table; \u67e5\u8be2\u7ed3\u679c\uff1a id product_code length(product_code) char_length(product_code) 1 1234567890 10 10 \u5176\u4e2d\uff0clength()\u8fd4\u56de\u7684\u5b57\u8282\u6570\u4e3a10\uff0cchar_length()\u8fd4\u56de\u7684\u5b57\u7b26\u6570\u4e5f\u4e3a10\u3002 \u5199\u516511\u4e2a\u6570\u5b57\u8bd5\u8bd5\uff1a insert into test_table(id,product_code) values(2,'12345678901'); \u5199\u5165\u62a5\u9519\uff0c\u9519\u8bef\u63d0\u793a\u4e3a\uff1a [22001][1406]Data truncation: Data too long for column 'product_code' at row ... \u56e0\u4e3a\u8d85\u8fc710\u4e2a\u6570\u5b57\u4e86\uff0c\u56e0\u6b64\u5199\u5165\u5931\u8d25\u3002 \u63a5\u4e0b\u91cc\u7528\u6c49\u5b57\u8bd5\u8bd5\uff0c\u5199\u516510\u4e2a\u6c49\u5b57\uff1a insert into test_table(id,product_code) values(3,'\u5929\u9752\u8272\u7b49\u70df\u96e8\u800c\u6211\u5728\u7b49'); \u5199\u5165\u6210\u529f\uff0c\u67e5\u8be2\u6570\u636e\uff1a select id,product_code,length(product_code), char_length(product_code) from test_table; \u67e5\u8be2\u7ed3\u679c\uff1a id product_code length(product_code) char_length(product_code) 1 1234567890 10 10 3 \u5929\u9752\u8272\u7b49\u70df\u96e8\u800c\u6211\u5728\u7b49 30 10 \u5176\u4e2d\uff0c\u6c49\u5b57\u7684length()\u8fd4\u56de\u7684\u5b57\u8282\u6570\u662f30\uff0cchar_length()\u8fd4\u56de\u7684\u5b57\u7b26\u6570\u4e3a10\uff0c \u53ef\u89c1\uff0c1\u4e2a\u6c49\u5b57\u53603\u4e2a\u5b57\u8282\uff0cMySQL\u628a\u6c49\u5b57\u5f53\u4f5c\u5b57\u7b26\u5904\u7406\uff0cvarchar(10)\u53ef\u5b58\u50a8\u7684\u6c49\u5b57\u6570\u4e3a10\u3002 \u5199\u516511\u4e2a\u6c49\u5b57\u8bd5\u8bd5\uff1a insert into test_table(id,product_code) values(4,'\u5929\u9752\u8272\u7b49\u70df\u96e8\u800c\u6211\u5728\u7b49\u4f60'); \u5199\u5165\u62a5\u9519\uff0c\u9519\u8bef\u63d0\u793a\u4e3a\uff1a [22001][1406]Data truncation: Data too long for column 'product_code' at row ... 1\u4e2a\u6c49\u5b57\u53601\u4e2a\u5b57\u7b26\uff0c11\u4e2a\u6c49\u5b57\u8d85\u8fc710\u4e2a\u5b57\u7b26\uff0c\u56e0\u6b64\u5199\u5165\u5931\u8d25\u3002 \u603b\u7ed3 \u5f53MySQL\u7248\u672c\u4e3a5.6\u65f6\uff1a varchar(10)\u8868\u793a\u5b58\u50a8\u7684\u5b57\u7b26\u6570\u4e3a10\uff0c1\u4e2a\u6c49\u5b57\u53601\u4e2a\u5b57\u7b26(3\u4e2a\u5b57\u8282) varchar(10)\u53ef\u5b58\u50a810\u4e2a\u6c49\u5b57 \u53c2\u8003 mysql varchar(50)\u5230\u5e95\u80fd\u5b58\u591a\u5c11\u4e2a\u6c49\u5b57 https://blog.csdn.net/u012491783/article/details/78339269 \u4e00\u7bc7\u6587\u7ae0\u770b\u61c2mysql\u4e2dvarchar\u80fd\u5b58\u591a\u5c11\u6c49\u5b57\u3001\u6570\u5b57\uff0c\u4ee5\u53cavarchar(100)\u548cvarchar(10)\u7684\u533a\u522b https://www.cnblogs.com/zhuyeshen/p/11642211.html","title":"\u5b57\u7b26\u4e0e\u5b57\u8282\uff08mysql\uff09"},{"location":"projectManagement/varchar/#mysqlvarchar10","text":"\u95ee\u9898 MySQL\u7684varchar(10)\u80fd\u5b58\u591a\u5c11\u4e2a\u6c49\u5b57\uff1f \u5982\u679c\u662f\u6570\u5b57\u6216\u82f1\u6587\uff0c\u53ef\u4ee5\u5b5810\u4e2a\uff0c\u5982\u679c\u662f\u6c49\u5b57\u5462\uff0c\u80fd\u5b58\u591a\u5c11\u4e2a\uff1f \u5b9e\u8df5 \u67e5\u770bMySQL\u7248\u672c\u53f7\uff1a ` select version(); select @@version; \u672c\u673aMySQL\u7248\u672c\u4e3a5.6.16\u3002 \u521b\u5efa\u6d4b\u8bd5\u8868\uff1a create table test_table ( id bigint(20) not null, product_code varchar(10) not null, primary key (id) ) engine=innodb default charset=utf8mb4; \u5148\u7528\u6570\u5b57\u6765\u6d4b\u8bd5\u4e0b\uff0c\u5199\u516510\u4e2a\u6570\u5b57\uff1a insert into test_table(id,product_code) values(1,'1234567890'); \u5199\u5165\u6210\u529f\uff0c\u67e5\u8be2\u6570\u636e\uff1a select id,product_code,length(product_code), char_length(product_code) from test_table; \u67e5\u8be2\u7ed3\u679c\uff1a id product_code length(product_code) char_length(product_code) 1 1234567890 10 10 \u5176\u4e2d\uff0clength()\u8fd4\u56de\u7684\u5b57\u8282\u6570\u4e3a10\uff0cchar_length()\u8fd4\u56de\u7684\u5b57\u7b26\u6570\u4e5f\u4e3a10\u3002 \u5199\u516511\u4e2a\u6570\u5b57\u8bd5\u8bd5\uff1a insert into test_table(id,product_code) values(2,'12345678901'); \u5199\u5165\u62a5\u9519\uff0c\u9519\u8bef\u63d0\u793a\u4e3a\uff1a [22001][1406]Data truncation: Data too long for column 'product_code' at row ... \u56e0\u4e3a\u8d85\u8fc710\u4e2a\u6570\u5b57\u4e86\uff0c\u56e0\u6b64\u5199\u5165\u5931\u8d25\u3002 \u63a5\u4e0b\u91cc\u7528\u6c49\u5b57\u8bd5\u8bd5\uff0c\u5199\u516510\u4e2a\u6c49\u5b57\uff1a insert into test_table(id,product_code) values(3,'\u5929\u9752\u8272\u7b49\u70df\u96e8\u800c\u6211\u5728\u7b49'); \u5199\u5165\u6210\u529f\uff0c\u67e5\u8be2\u6570\u636e\uff1a select id,product_code,length(product_code), char_length(product_code) from test_table; \u67e5\u8be2\u7ed3\u679c\uff1a id product_code length(product_code) char_length(product_code) 1 1234567890 10 10 3 \u5929\u9752\u8272\u7b49\u70df\u96e8\u800c\u6211\u5728\u7b49 30 10 \u5176\u4e2d\uff0c\u6c49\u5b57\u7684length()\u8fd4\u56de\u7684\u5b57\u8282\u6570\u662f30\uff0cchar_length()\u8fd4\u56de\u7684\u5b57\u7b26\u6570\u4e3a10\uff0c \u53ef\u89c1\uff0c1\u4e2a\u6c49\u5b57\u53603\u4e2a\u5b57\u8282\uff0cMySQL\u628a\u6c49\u5b57\u5f53\u4f5c\u5b57\u7b26\u5904\u7406\uff0cvarchar(10)\u53ef\u5b58\u50a8\u7684\u6c49\u5b57\u6570\u4e3a10\u3002 \u5199\u516511\u4e2a\u6c49\u5b57\u8bd5\u8bd5\uff1a insert into test_table(id,product_code) values(4,'\u5929\u9752\u8272\u7b49\u70df\u96e8\u800c\u6211\u5728\u7b49\u4f60'); \u5199\u5165\u62a5\u9519\uff0c\u9519\u8bef\u63d0\u793a\u4e3a\uff1a [22001][1406]Data truncation: Data too long for column 'product_code' at row ... 1\u4e2a\u6c49\u5b57\u53601\u4e2a\u5b57\u7b26\uff0c11\u4e2a\u6c49\u5b57\u8d85\u8fc710\u4e2a\u5b57\u7b26\uff0c\u56e0\u6b64\u5199\u5165\u5931\u8d25\u3002 \u603b\u7ed3 \u5f53MySQL\u7248\u672c\u4e3a5.6\u65f6\uff1a varchar(10)\u8868\u793a\u5b58\u50a8\u7684\u5b57\u7b26\u6570\u4e3a10\uff0c1\u4e2a\u6c49\u5b57\u53601\u4e2a\u5b57\u7b26(3\u4e2a\u5b57\u8282) varchar(10)\u53ef\u5b58\u50a810\u4e2a\u6c49\u5b57 \u53c2\u8003 mysql varchar(50)\u5230\u5e95\u80fd\u5b58\u591a\u5c11\u4e2a\u6c49\u5b57 https://blog.csdn.net/u012491783/article/details/78339269 \u4e00\u7bc7\u6587\u7ae0\u770b\u61c2mysql\u4e2dvarchar\u80fd\u5b58\u591a\u5c11\u6c49\u5b57\u3001\u6570\u5b57\uff0c\u4ee5\u53cavarchar(100)\u548cvarchar(10)\u7684\u533a\u522b https://www.cnblogs.com/zhuyeshen/p/11642211.html","title":"MySQL\u7684varchar(10)\u80fd\u5b58\u591a\u5c11\u4e2a\u6c49\u5b57\uff1f"},{"location":"python/mkdocs/","text":"Welcome to MkDocs \u00b6 For full documentation visit mkdocs.org . Commands \u00b6 mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout \u00b6 mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files. about mkdocs \u00b6 MkDocs \u662f\u4e00\u4e2a\u7528 Python \u5f00\u53d1\u7684\u9759\u6001\u7ad9\u70b9\u751f\u6210\u5668\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u5feb\u901f\u7684\u521b\u5efa\u9879\u76ee\u6587\u6863\u3002MkDocs \u7684\u6587\u6863\u6e90\u7801\u4f7f\u7528 Markdown \u7f16\u5199\uff0c\u914d\u7f6e\u6587\u4ef6\u4f7f\u7528 YAML \u7f16\u5199\uff0c\u53ef\u4ee5\u4e00\u952e\u7f16\u8bd1\u6210\u9759\u6001\u7ad9\u70b9\u3002 pip install mkdocs \u540e\u4f1a\u4e00\u540c\u5b89\u88c5\u5982\u4e0b\u7a0b\u5e8f\uff1a click 8.0.4 ghp-import 2.1.0 importlib-metadata 4.8.3 Jinja2 3.0.3 Markdown 3.3.7 MarkupSafe 2.0.1 mergedeep 1.3.4 mkdocs 1.3.1 packaging 21.3 pyparsing 3.0.9 python-dateutil 2.8.2 PyYAML 6.0 pyyaml_env_tag 0.1 six 1.16.0 typing_extensions 4.1.1 watchdog 2.1.9 zipp 3.6.0 material\u7684\u4e00\u4e9b\u7279\u6027\u5c55\u793a \u00b6 \u652f\u6301\u4ee3\u7801\u9ad8\u4eae\u8fd8\u652f\u6301\u4ee3\u7801\u6807\u9898 \u00b6 demo.py def sayhi (): return \"hi,Python\u5168\u6808\u5f00\u53d1\" \u4ee3\u7801\u81ea\u7531\u6ce8\u91ca \u00b6 theme : features : - content.code.annotate # (1) :man_raising_hand: I'm a code annotation! I can contain code , formatted text , images, ... basically anything that can be written in Markdown. \u63d0\u793a\u6846 \u00b6 \u8fd9\u662f note \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u63d0\u793a\uff1a\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9\u8bb0\u5f97\u5173\u6ce8\u6211\u554a 1 2 3 4 \u8fd9\u662f note \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u63d0\u793a\uff1a\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9\u8bb0\u5f97\u5173\u6ce8\u6211\u554a \u8fd9\u662f success \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u6210\u529f\uff01 \u8fd9\u662f failure \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u5931\u8d25\uff01 \u8fd9\u662f bug \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u53d1\u73b0\u4e00\u4e2a bug\uff0c\u8bf7\u5c3d\u5feb\u4fee\u590d\uff01 table \u00b6 Method Description GET :material-check: Fetch resource PUT :material-check-all: Update resource DELETE :material-close: Delete resource","title":"about mkdocs"},{"location":"python/mkdocs/#welcome-to-mkdocs","text":"For full documentation visit mkdocs.org .","title":"Welcome to MkDocs"},{"location":"python/mkdocs/#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"python/mkdocs/#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"python/mkdocs/#about-mkdocs","text":"MkDocs \u662f\u4e00\u4e2a\u7528 Python \u5f00\u53d1\u7684\u9759\u6001\u7ad9\u70b9\u751f\u6210\u5668\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u5feb\u901f\u7684\u521b\u5efa\u9879\u76ee\u6587\u6863\u3002MkDocs \u7684\u6587\u6863\u6e90\u7801\u4f7f\u7528 Markdown \u7f16\u5199\uff0c\u914d\u7f6e\u6587\u4ef6\u4f7f\u7528 YAML \u7f16\u5199\uff0c\u53ef\u4ee5\u4e00\u952e\u7f16\u8bd1\u6210\u9759\u6001\u7ad9\u70b9\u3002 pip install mkdocs \u540e\u4f1a\u4e00\u540c\u5b89\u88c5\u5982\u4e0b\u7a0b\u5e8f\uff1a click 8.0.4 ghp-import 2.1.0 importlib-metadata 4.8.3 Jinja2 3.0.3 Markdown 3.3.7 MarkupSafe 2.0.1 mergedeep 1.3.4 mkdocs 1.3.1 packaging 21.3 pyparsing 3.0.9 python-dateutil 2.8.2 PyYAML 6.0 pyyaml_env_tag 0.1 six 1.16.0 typing_extensions 4.1.1 watchdog 2.1.9 zipp 3.6.0","title":"about mkdocs"},{"location":"python/mkdocs/#material","text":"","title":"material\u7684\u4e00\u4e9b\u7279\u6027\u5c55\u793a"},{"location":"python/mkdocs/#_1","text":"demo.py def sayhi (): return \"hi,Python\u5168\u6808\u5f00\u53d1\"","title":"\u652f\u6301\u4ee3\u7801\u9ad8\u4eae\u8fd8\u652f\u6301\u4ee3\u7801\u6807\u9898"},{"location":"python/mkdocs/#_2","text":"theme : features : - content.code.annotate # (1) :man_raising_hand: I'm a code annotation! I can contain code , formatted text , images, ... basically anything that can be written in Markdown.","title":"\u4ee3\u7801\u81ea\u7531\u6ce8\u91ca"},{"location":"python/mkdocs/#_3","text":"\u8fd9\u662f note \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u63d0\u793a\uff1a\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9\u8bb0\u5f97\u5173\u6ce8\u6211\u554a 1 2 3 4 \u8fd9\u662f note \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u63d0\u793a\uff1a\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9\u8bb0\u5f97\u5173\u6ce8\u6211\u554a \u8fd9\u662f success \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u6210\u529f\uff01 \u8fd9\u662f failure \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u5931\u8d25\uff01 \u8fd9\u662f bug \u7c7b\u578b\u7684\u63d0\u793a\u6846 \u53d1\u73b0\u4e00\u4e2a bug\uff0c\u8bf7\u5c3d\u5feb\u4fee\u590d\uff01","title":"\u63d0\u793a\u6846"},{"location":"python/mkdocs/#table","text":"Method Description GET :material-check: Fetch resource PUT :material-check-all: Update resource DELETE :material-close: Delete resource","title":"table"},{"location":"vps/acme/","text":"acme.sh\u4f7f\u7528 \u00b6 \u73af\u5883\uff1acentos7 \u5b89\u88c5acme \u00b6 wget -qO- get.acme.sh | bash source ~/.bashrc cd ~/.acme.sh/ \u8bbe\u7f6e\u65f6\u533a \u00b6 cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \u8bbe\u7f6e\u9ed8\u8ba4\u83b7\u53d6\u8bc1\u4e66\u673a\u6784 \u00b6 \u8bbe\u7f6e\u9ed8\u8ba4\u8bc1\u4e66\u5206\u53d1\u673a\u6784\u4e3aletsencrypt.org acme . sh -- set - default - ca -- server letsencrypt dns\u65b9\u5f0f\u83b7\u53d6\u8bc1\u4e66 \u00b6 // \u53c2\u8003\u7f51\u5740 https://github.com/acmesh-official/acme.sh/wiki/dnsapi Using the global API key First you need to login to your Cloudflare account to get your API key. Each token generated is not stored on cloudflare account and will have expiry if not set correctly. You will get this in API keys section. https://dash.cloudflare.com/profile // \u6d4b\u8bd5\u4ee4\u724c\u662f\u5426\u53ef\u884c \u00b6 \u6d4b\u8bd5\u6b64\u4ee4\u724c \u8981\u786e\u8ba4\u60a8\u7684\u4ee4\u724c\u662f\u5426\u5de5\u4f5c\u6b63\u5e38\uff0c\u8bf7\u590d\u5236\u4e0b\u9762\u7684 CURL \u547d\u4ee4\u5e76\u5c06\u5176\u7c98\u8d34\u5230\u7ec8\u7aef Shell \u4e2d\u8fdb\u884c\u6d4b\u8bd5\u3002 curl -X GET \"https://api.cloudflare.com/client/v4/user/tokens/verify\" \\ -H \"Authorization: Bearer \u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" \\ -H \"Content-Type:application/json\" \u4e0a\u9762\u7b2c\u4e00\u6b65\u521b\u5efa\u7684\u4ee4\u724c\uff0c\u5373\u4e3atoken CF_Token=\"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\u201c \u5206\u522b\u83b7\u53d6\u8d26\u6237ID\u548c\u533a\u57dfID CF_Account_ID=\"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" CF_Zone_ID=\"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" //\u6b64\u9879\u975e\u5fc5\u987b \u7ec8\u7aef\u8f93\u5165\u547d\u4ee4 export CF_Token = \"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" export CF_Account_ID = \"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" export CF_Zone_ID = \"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" \u7533\u8bf7\u8bc1\u4e66 \uff08\u7528ecc\u6a21\u5f0f\u5427 \u00b6 acme.sh --issue -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d2 --dns dns_cf -k ec-256 \u5173\u4e8e\u5b9a\u65f6\u4efb\u52a1\uff1a\u7f16\u8f91\u5f53\u524d\u7528\u6237\u7684\u5b9a\u65f6\u4efb\u52a1\u8868: crontab -e \u67e5\u770b\u5f53\u524d\u7528\u6237\u7684\u5b9a\u65f6\u4efb\u52a1: crontab -l \u5b89\u88c5\u8bc1\u4e66 \u00b6 /root/.acme.sh/acme.sh --installcert -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d --fullchain-file /\u81ea\u5b9a\u4e49\u8def\u5f84/cert.crt --key-file /\u81ea\u5b9a\u4e49\u8def\u5f84/private.key --ecc \u8bbe\u7f6ecrontab\u5c06acme\u81ea\u52a8\u7eed\u671f\u7684\u8bc1\u4e66\u5b89\u88c5\u5230\u81ea\u5b9a\u4e49\u7684\u76ee\u5f55\u91cc \u00b6 \u521b\u5efa renew.sh\u811a\u672c\uff0c\u5e76\u4f7f\u7528crontab\u5b9a\u65f6\u8dd1\u811a\u672c renew.sh / root /. acme . sh / acme . sh -- installcert - d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d - d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d -- fullchain - file / \u81ea\u5b9a\u4e49\u8def\u5f84 / cert . crt -- key - file / \u81ea\u5b9a\u4e49\u8def\u5f84 / private . key -- ecc echo \"Certificates Renewed\" chmod + r / \u81ea\u5b9a\u4e49\u8def\u5f84private . key echo \"Read Permission Granted for Private Key\" docker restart nginx echo \"nginx Restarted\" docker\u5b89\u88c5 \u00b6 \u5b89\u88c5 Docker curl - fsSL https : // get . docker . com | sh or wget - qO - get . docker . com | bash docker pull nginx docker pull containrrr / watchtower \u6bcf\u5929\u51cc\u66682:00\u8f6e\u8be2\u68c0\u67e5\u66f4\u65b0 \u00b6 docker run -d \\ --name watchtower \\ --restart unless-stopped \\ -v /var/run/docker.sock:/var/run/docker.sock \\ containrrr/watchtower -c \\ --schedule \"0 0 2 * * *\" \u5982\u679c\u5df2\u7ecf\u542f\u52a8\u7684\u9879\u76ee\uff0c\u5219\u4f7f\u7528update\u66f4\u65b0\uff1a \u00b6 docker update --restart=always \u3010dockername\u3011 \u00b6 \u9644\u5f55 \u00b6 ```\u624b\u52a8\u66f4\u65b0\u8bc1\u4e66\uff1a acme.sh --renew -d example.com --force ```\u67e5\u770b\u8bc1\u4e66\u5217\u8868\uff1a acme.sh --list acme.sh --remove -d example.com \u5e38\u89c1\u95ee\u9898 -bash: acme.sh: command not found \u6211\u6682\u65f6\u53ea\u9047\u5230\u4e86\u8be5\u95ee\u9898\uff0c\u89e3\u51b3\u529e\u6cd5\u662f\u4f7f\u7528 acme \u7684\u7edd\u5bf9\u5730\u5740\u6216\u8005\u5728acme.sh\u524d\u52a0./ /root/.acme.sh/acme.sh --issue -d example.com --dns dns_cf -d *.example.com #\u65b9\u6cd51 ./acme.sh --issue -d example.com --dns dns_cf -d *.example.com #\u65b9\u6cd52 \u9644\u5f552 firewall \u00b6 [root@centos7 ~]# firewall-cmd --zone=public --add-port=80/tcp --permanent ```\u67e5\u8be2\u7aef\u53e3\u53f780 \u662f\u5426\u5f00\u542f\uff1a [root@centos7 ~]# firewall-cmd --query-port=80/tcp ```\u91cd\u542f\u9632\u706b\u5899\uff1a [root@centos7 ~]# firewall-cmd --reload ```\u67e5\u8be2\u6709\u54ea\u4e9b\u7aef\u53e3\u662f\u5f00\u542f\u7684: [root@centos7 ~]# firewall-cmd --list-port \u547d\u4ee4\u542b\u4e49\uff1a --zone #\u4f5c\u7528\u57df --add-port=80/tcp #\u6dfb\u52a0\u7aef\u53e3\uff0c\u683c\u5f0f\u4e3a\uff1a\u7aef\u53e3/\u901a\u8baf\u534f\u8bae --permanent #\u6c38\u4e45\u751f\u6548\uff0c\u6ca1\u6709\u6b64\u53c2\u6570\u91cd\u542f\u540e\u5931\u6548 ```\u5173\u95edfirewall\uff1a systemctl stop firewalld.service #\u505c\u6b62firewall systemctl disable firewalld.service #\u7981\u6b62firewall\u5f00\u673a\u542f\u52a8","title":"acme\u4f7f\u7528"},{"location":"vps/acme/#acmesh","text":"\u73af\u5883\uff1acentos7","title":"acme.sh\u4f7f\u7528"},{"location":"vps/acme/#acme","text":"wget -qO- get.acme.sh | bash source ~/.bashrc cd ~/.acme.sh/","title":"\u5b89\u88c5acme"},{"location":"vps/acme/#_1","text":"cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime","title":"\u8bbe\u7f6e\u65f6\u533a"},{"location":"vps/acme/#_2","text":"\u8bbe\u7f6e\u9ed8\u8ba4\u8bc1\u4e66\u5206\u53d1\u673a\u6784\u4e3aletsencrypt.org acme . sh -- set - default - ca -- server letsencrypt","title":"\u8bbe\u7f6e\u9ed8\u8ba4\u83b7\u53d6\u8bc1\u4e66\u673a\u6784"},{"location":"vps/acme/#dns","text":"// \u53c2\u8003\u7f51\u5740 https://github.com/acmesh-official/acme.sh/wiki/dnsapi Using the global API key First you need to login to your Cloudflare account to get your API key. Each token generated is not stored on cloudflare account and will have expiry if not set correctly. You will get this in API keys section. https://dash.cloudflare.com/profile //","title":"dns\u65b9\u5f0f\u83b7\u53d6\u8bc1\u4e66"},{"location":"vps/acme/#_3","text":"\u6d4b\u8bd5\u6b64\u4ee4\u724c \u8981\u786e\u8ba4\u60a8\u7684\u4ee4\u724c\u662f\u5426\u5de5\u4f5c\u6b63\u5e38\uff0c\u8bf7\u590d\u5236\u4e0b\u9762\u7684 CURL \u547d\u4ee4\u5e76\u5c06\u5176\u7c98\u8d34\u5230\u7ec8\u7aef Shell \u4e2d\u8fdb\u884c\u6d4b\u8bd5\u3002 curl -X GET \"https://api.cloudflare.com/client/v4/user/tokens/verify\" \\ -H \"Authorization: Bearer \u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" \\ -H \"Content-Type:application/json\" \u4e0a\u9762\u7b2c\u4e00\u6b65\u521b\u5efa\u7684\u4ee4\u724c\uff0c\u5373\u4e3atoken CF_Token=\"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\u201c \u5206\u522b\u83b7\u53d6\u8d26\u6237ID\u548c\u533a\u57dfID CF_Account_ID=\"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" CF_Zone_ID=\"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" //\u6b64\u9879\u975e\u5fc5\u987b \u7ec8\u7aef\u8f93\u5165\u547d\u4ee4 export CF_Token = \"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" export CF_Account_ID = \"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\" export CF_Zone_ID = \"\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u7684\u503c\"","title":"\u6d4b\u8bd5\u4ee4\u724c\u662f\u5426\u53ef\u884c"},{"location":"vps/acme/#ecc","text":"acme.sh --issue -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d2 --dns dns_cf -k ec-256 \u5173\u4e8e\u5b9a\u65f6\u4efb\u52a1\uff1a\u7f16\u8f91\u5f53\u524d\u7528\u6237\u7684\u5b9a\u65f6\u4efb\u52a1\u8868: crontab -e \u67e5\u770b\u5f53\u524d\u7528\u6237\u7684\u5b9a\u65f6\u4efb\u52a1: crontab -l","title":"\u7533\u8bf7\u8bc1\u4e66 \uff08\u7528ecc\u6a21\u5f0f\u5427"},{"location":"vps/acme/#_4","text":"/root/.acme.sh/acme.sh --installcert -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d -d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d --fullchain-file /\u81ea\u5b9a\u4e49\u8def\u5f84/cert.crt --key-file /\u81ea\u5b9a\u4e49\u8def\u5f84/private.key --ecc","title":"\u5b89\u88c5\u8bc1\u4e66"},{"location":"vps/acme/#crontabacme","text":"\u521b\u5efa renew.sh\u811a\u672c\uff0c\u5e76\u4f7f\u7528crontab\u5b9a\u65f6\u8dd1\u811a\u672c renew.sh / root /. acme . sh / acme . sh -- installcert - d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d - d \u8fd9\u91cc\u662f\u4f60\u7684\u57df\u540d -- fullchain - file / \u81ea\u5b9a\u4e49\u8def\u5f84 / cert . crt -- key - file / \u81ea\u5b9a\u4e49\u8def\u5f84 / private . key -- ecc echo \"Certificates Renewed\" chmod + r / \u81ea\u5b9a\u4e49\u8def\u5f84private . key echo \"Read Permission Granted for Private Key\" docker restart nginx echo \"nginx Restarted\"","title":"\u8bbe\u7f6ecrontab\u5c06acme\u81ea\u52a8\u7eed\u671f\u7684\u8bc1\u4e66\u5b89\u88c5\u5230\u81ea\u5b9a\u4e49\u7684\u76ee\u5f55\u91cc"},{"location":"vps/acme/#docker","text":"\u5b89\u88c5 Docker curl - fsSL https : // get . docker . com | sh or wget - qO - get . docker . com | bash docker pull nginx docker pull containrrr / watchtower","title":"docker\u5b89\u88c5"},{"location":"vps/acme/#200","text":"docker run -d \\ --name watchtower \\ --restart unless-stopped \\ -v /var/run/docker.sock:/var/run/docker.sock \\ containrrr/watchtower -c \\ --schedule \"0 0 2 * * *\"","title":"\u6bcf\u5929\u51cc\u66682:00\u8f6e\u8be2\u68c0\u67e5\u66f4\u65b0"},{"location":"vps/acme/#update","text":"","title":"\u5982\u679c\u5df2\u7ecf\u542f\u52a8\u7684\u9879\u76ee\uff0c\u5219\u4f7f\u7528update\u66f4\u65b0\uff1a"},{"location":"vps/acme/#docker-update-restartalways-dockername","text":"","title":"docker update --restart=always \u3010dockername\u3011\n"},{"location":"vps/acme/#_5","text":"```\u624b\u52a8\u66f4\u65b0\u8bc1\u4e66\uff1a acme.sh --renew -d example.com --force ```\u67e5\u770b\u8bc1\u4e66\u5217\u8868\uff1a acme.sh --list acme.sh --remove -d example.com \u5e38\u89c1\u95ee\u9898 -bash: acme.sh: command not found \u6211\u6682\u65f6\u53ea\u9047\u5230\u4e86\u8be5\u95ee\u9898\uff0c\u89e3\u51b3\u529e\u6cd5\u662f\u4f7f\u7528 acme \u7684\u7edd\u5bf9\u5730\u5740\u6216\u8005\u5728acme.sh\u524d\u52a0./ /root/.acme.sh/acme.sh --issue -d example.com --dns dns_cf -d *.example.com #\u65b9\u6cd51 ./acme.sh --issue -d example.com --dns dns_cf -d *.example.com #\u65b9\u6cd52","title":"\u9644\u5f55"},{"location":"vps/acme/#2-firewall","text":"[root@centos7 ~]# firewall-cmd --zone=public --add-port=80/tcp --permanent ```\u67e5\u8be2\u7aef\u53e3\u53f780 \u662f\u5426\u5f00\u542f\uff1a [root@centos7 ~]# firewall-cmd --query-port=80/tcp ```\u91cd\u542f\u9632\u706b\u5899\uff1a [root@centos7 ~]# firewall-cmd --reload ```\u67e5\u8be2\u6709\u54ea\u4e9b\u7aef\u53e3\u662f\u5f00\u542f\u7684: [root@centos7 ~]# firewall-cmd --list-port \u547d\u4ee4\u542b\u4e49\uff1a --zone #\u4f5c\u7528\u57df --add-port=80/tcp #\u6dfb\u52a0\u7aef\u53e3\uff0c\u683c\u5f0f\u4e3a\uff1a\u7aef\u53e3/\u901a\u8baf\u534f\u8bae --permanent #\u6c38\u4e45\u751f\u6548\uff0c\u6ca1\u6709\u6b64\u53c2\u6570\u91cd\u542f\u540e\u5931\u6548 ```\u5173\u95edfirewall\uff1a systemctl stop firewalld.service #\u505c\u6b62firewall systemctl disable firewalld.service #\u7981\u6b62firewall\u5f00\u673a\u542f\u52a8","title":"\u9644\u5f552 firewall"},{"location":"vps/telegramBot/","text":"telegram \u673a\u5668\u4eba \u00b6 \u7533\u8bf7\u673a\u5668\u4eba \u00b6 \u901a\u8fc7 @BotFather \u8fdb\u884c\u64cd\u4f5c\uff0c\u81ea\u884c\u67e5\u627e\u64cd\u4f5c\u6559\u7a0b \u901a\u8fc7 @userinfobot \u6216\u8005 @myid_bot \u67e5\u627e\u4e2a\u4ebaid \uff08\u5907\u7528\uff09 \u767b\u5f55vps\u540e\u901a\u8fc7bot\u53d1\u9001\u4fe1\u606f \u00b6 vi SSHLoginAlert.sh #!/bin/bash #This script can send a alert when someone login into vps #date:2021-09-02 #name\uff1aSSHLoginAlert.sh #author:FranzKafka echo \"This is a script for ssh login alert\" token = xxxxxxxxxxxxxxxxx echo \"my token is $token\" id = xxxxxx echo \"my id is $id\" message = $ ( hostname && TZ = UTC - 8 date && who && w && last - 1 | awk 'BEGIN{ORS=\" \\t \"}{print $1,$15}' ) echo \"send message is $message,begin....\" curl - v \"https://api.telegram.org/bot$ {token} /sendMessage?chat_id=$ {id} \" -- data - binary \"&text=$ {message} \" echo \"send alert end\" hostname \uff1a\u4e3b\u673a\u540d\uff0c\u4e5f\u5c31\u662f\u4f60\u670d\u52a1\u5668\u7684\u540d\u5b57 TZ=UTC-8 \uff1a\u8bbe\u5b9a\u65f6\u533a\u4e3a\u5317\u4eac\u65f6\u95f4 who \uff1a\u5f53\u524d\u767b\u5f55\u8005\u7684\u4fe1\u606f\uff0c\u5305\u542b\u7528\u6237\u540d\u4e0eid w\uff1a\u5f53\u524d\u7528\u6237\u6240\u4f7f\u7528\u7684\u6267\u884c\u7684\u547d\u4ee4\u4fe1\u606f last\uff1a\u4e4b\u524d\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f \u5c06\u8be5\u811a\u672c\u79fb\u52a8\u5230/etc/profile.d/\u8fd9\u4e2a\u6587\u4ef6\u5939\u4e0b chmod 555 SSHLoginAlert . sh cp SSHLoginAlert . sh / etc / profile . d / \u6b64\u6587\u4ef6\u5939 /etc/profile.d/ \u4e0b\u7684\u811a\u672c\u4f1a\u4e3a\u7cfb\u7edf\u7684\u6bcf\u4e00\u4e2a\u7528\u6237\u8bbe\u7f6e\u73af\u5883\u4fe1\u606f\u3002\u5f53\u7528\u6237\u767b\u5f55\u65f6\uff0c\u8be5\u76ee\u5f55\u4e0b\u7684\u811a\u672c\u4f1a\u81ea\u52a8\u6267\u884c \u5176\u4ed6 \u00b6 \u83b7\u53d6\u7fa4\u804aid \u00b6 \u7f51\u4e0a\u627e\u5230\u7684\u539f\u65871 \u4e3a\u4e86\u83b7\u5f97\u7fa4\u804aID\uff0c\u8bf7\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5c06\u7535\u62a5BOT\u6dfb\u52a0\u5230\u7ec4\u4e2d\u3002 \u83b7\u53d6\u60a8\u7684BOT\u7684\u66f4\u65b0\u5217\u8868\uff1a https://api.telegram.org/bot /getUpdates \u4f8b\u5982\uff1a https://api.telegram.org/bot123456789:jbd78sadvbdy63d37gda37bd8/getUpdates \u67e5\u627e\u201c\u804a\u5929\u201d\u5bf9\u8c61\uff1a {\u201c update_id\u201d\uff1a8393\uff0c\u201c message\u201d\uff1a{\u201c message_id\u201d\uff1a3\uff0c\u201c from\u201d\uff1a{\u201c id\u201d\uff1a7474\uff0c\u201c first_name\u201d\uff1a\u201c AAA\u201d}\uff0c\u201c\u804a\u5929\u201d\uff1a{\u201c id\u201d :,\u201c\u6807\u9898\u201c\uff1a\u201d\u201c}\uff0c\u201d date\u201c\uff1a25497\uff0c\u201d new_chat_participant\u201c\uff1a{\u201d id\u201c\uff1a71\uff0c\u201d first_name\u201c\uff1a\u201d NAME\u201c\uff0c\u201d\u7528\u6237\u540d\u201c\uff1a\u201d YOUR_BOT_NAME\u201c}}} \u5f53\u60a8\u5c06BOT\u6dfb\u52a0\u5230\u7ec4\u4e2d\u65f6\uff0c\u8fd9\u662f\u54cd\u5e94\u7684\u793a\u4f8b\u3002 \u4f7f\u7528\u201c\u804a\u5929\u201d\u5bf9\u8c61\u7684\u201c id\u201d\u53d1\u9001\u6d88\u606f\u3002 \u7f51\u4e0a\u627e\u5230\u7684\u539f\u65872 \u5047\u8bbe\u673a\u5668\u4eba\u540d\u79f0\u4e3amy_bot\u3002 1-\u5c06\u673a\u5668\u4eba\u6dfb\u52a0\u5230\u7ec4\u4e2d\u3002 \u8f6c\u5230\u8be5\u7ec4\uff0c\u5355\u51fb\u7ec4\u540d\uff0c\u5355\u51fb\u201c\u6dfb\u52a0\u6210\u5458\u201d\uff0c\u5728\u641c\u7d22\u6846\u4e2d\u641c\u7d22\u60a8\u7684\u673a\u5668\u4eba\uff0c\u5982\u4e0b\u6240\u793a\uff1a@my_bot\uff0c\u9009\u62e9\u60a8\u7684\u673a\u5668\u4eba\u5e76\u5355\u51fb\u201c\u6dfb\u52a0\u201d\u3002 2-\u5411\u673a\u5668\u4eba\u53d1\u9001\u865a\u62df\u6d88\u606f\u3002 \u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u793a\u4f8b\uff1a\uff08/my_id @my_bot \u6211\u5c1d\u8bd5\u4e86\u4e00\u4e9b\u6d88\u606f\uff0c\u4f46\u5e76\u975e\u6240\u6709\u6d88\u606f\u90fd\u8d77\u4f5c\u7528\u3002\u4e0a\u9762\u7684\u793a\u4f8b\u5f88\u597d\u7528\u3002\u4e5f\u8bb8\u6d88\u606f\u5e94\u8be5\u4ee5/\u5f00\u5934\uff09 3-\u8f6c\u5230\u4ee5\u4e0b\u7f51\u5740\uff1a https://api.telegram.org/botXXX:YYYY/getUpdates \u7528\u60a8\u7684\u673a\u5668\u4eba\u4ee4\u724c\u66ff\u6362XXX\uff1aYYYY 4-\u67e5\u627e\u201c\u804a\u5929\u201d\uff1a{\u201c id\u201d\uff1a-zzzzzzzzzzzz\uff0c -zzzzzzzzzzzz\u662f\u60a8\u7684\u804a\u5929ID\uff08\u5e26\u8d1f\u53f7\uff09\u3002 5- \u6d4b\u8bd5\uff1a\u60a8\u53ef\u4ee5\u6d4b\u8bd5\u662f\u5426\u5411\u5377\u66f2\u7684\u7fa4\u7ec4\u53d1\u9001\u6d88\u606f\uff1a curl -X POST \"https://api.telegram.org/botXXX:YYYY/sendMessage\" -d \"chat_id=-zzzzzzzzzz&text=my sample text\" \u5982\u679c\u60a8\u9519\u8fc7\u4e86\u7b2c2\u6b65\uff0c\u90a3\u4e48\u60a8\u8981\u67e5\u627e\u7684\u7ec4\u5c06\u4e0d\u4f1a\u6709\u4efb\u4f55\u66f4\u65b0\u3002\u53e6\u5916\uff0c\u5982\u679c\u6709\u591a\u4e2a\u7ec4\uff0c\u5219\u53ef\u4ee5\u5728\u54cd\u5e94\u4e2d\u67e5\u627e\u7ec4\u540d\uff08\u201c title\u201d\uff1a\u201c group_name \u201d\uff09\u3002 \u901a\u8fc7\u7ec8\u7aef\u5f80\u7fa4\u804a\u6216\u4eba\u53d1\u6d88\u606f \u00b6 \u901a\u8fc7\u7ec8\u7aef\u5f80\u7fa4\u804a\u6216\u4eba\u53d1\u6d88\u606f curl - X POST \"https://api.telegram.org/bot<YourBOTToken>\" - d \"chat_id=<\u4e2a\u4ebaid\u6216\u7fa4\u7ec4id>&text=<YourMessage>\" \u53c2\u8003\uff1a https://coderfan.net/how-to-use-telegram-bot-to-alarm-you-when-someone-login-into-your-vps.html https://qastack.cn/programming/32423837/telegram-bot-how-to-get-a-group-chat-id","title":"telegramBot"},{"location":"vps/telegramBot/#telegram","text":"","title":"telegram \u673a\u5668\u4eba"},{"location":"vps/telegramBot/#_1","text":"\u901a\u8fc7 @BotFather \u8fdb\u884c\u64cd\u4f5c\uff0c\u81ea\u884c\u67e5\u627e\u64cd\u4f5c\u6559\u7a0b \u901a\u8fc7 @userinfobot \u6216\u8005 @myid_bot \u67e5\u627e\u4e2a\u4ebaid \uff08\u5907\u7528\uff09","title":"\u7533\u8bf7\u673a\u5668\u4eba"},{"location":"vps/telegramBot/#vpsbot","text":"vi SSHLoginAlert.sh #!/bin/bash #This script can send a alert when someone login into vps #date:2021-09-02 #name\uff1aSSHLoginAlert.sh #author:FranzKafka echo \"This is a script for ssh login alert\" token = xxxxxxxxxxxxxxxxx echo \"my token is $token\" id = xxxxxx echo \"my id is $id\" message = $ ( hostname && TZ = UTC - 8 date && who && w && last - 1 | awk 'BEGIN{ORS=\" \\t \"}{print $1,$15}' ) echo \"send message is $message,begin....\" curl - v \"https://api.telegram.org/bot$ {token} /sendMessage?chat_id=$ {id} \" -- data - binary \"&text=$ {message} \" echo \"send alert end\" hostname \uff1a\u4e3b\u673a\u540d\uff0c\u4e5f\u5c31\u662f\u4f60\u670d\u52a1\u5668\u7684\u540d\u5b57 TZ=UTC-8 \uff1a\u8bbe\u5b9a\u65f6\u533a\u4e3a\u5317\u4eac\u65f6\u95f4 who \uff1a\u5f53\u524d\u767b\u5f55\u8005\u7684\u4fe1\u606f\uff0c\u5305\u542b\u7528\u6237\u540d\u4e0eid w\uff1a\u5f53\u524d\u7528\u6237\u6240\u4f7f\u7528\u7684\u6267\u884c\u7684\u547d\u4ee4\u4fe1\u606f last\uff1a\u4e4b\u524d\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f \u5c06\u8be5\u811a\u672c\u79fb\u52a8\u5230/etc/profile.d/\u8fd9\u4e2a\u6587\u4ef6\u5939\u4e0b chmod 555 SSHLoginAlert . sh cp SSHLoginAlert . sh / etc / profile . d / \u6b64\u6587\u4ef6\u5939 /etc/profile.d/ \u4e0b\u7684\u811a\u672c\u4f1a\u4e3a\u7cfb\u7edf\u7684\u6bcf\u4e00\u4e2a\u7528\u6237\u8bbe\u7f6e\u73af\u5883\u4fe1\u606f\u3002\u5f53\u7528\u6237\u767b\u5f55\u65f6\uff0c\u8be5\u76ee\u5f55\u4e0b\u7684\u811a\u672c\u4f1a\u81ea\u52a8\u6267\u884c","title":"\u767b\u5f55vps\u540e\u901a\u8fc7bot\u53d1\u9001\u4fe1\u606f"},{"location":"vps/telegramBot/#_2","text":"","title":"\u5176\u4ed6"},{"location":"vps/telegramBot/#id","text":"\u7f51\u4e0a\u627e\u5230\u7684\u539f\u65871 \u4e3a\u4e86\u83b7\u5f97\u7fa4\u804aID\uff0c\u8bf7\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5c06\u7535\u62a5BOT\u6dfb\u52a0\u5230\u7ec4\u4e2d\u3002 \u83b7\u53d6\u60a8\u7684BOT\u7684\u66f4\u65b0\u5217\u8868\uff1a https://api.telegram.org/bot /getUpdates \u4f8b\u5982\uff1a https://api.telegram.org/bot123456789:jbd78sadvbdy63d37gda37bd8/getUpdates \u67e5\u627e\u201c\u804a\u5929\u201d\u5bf9\u8c61\uff1a {\u201c update_id\u201d\uff1a8393\uff0c\u201c message\u201d\uff1a{\u201c message_id\u201d\uff1a3\uff0c\u201c from\u201d\uff1a{\u201c id\u201d\uff1a7474\uff0c\u201c first_name\u201d\uff1a\u201c AAA\u201d}\uff0c\u201c\u804a\u5929\u201d\uff1a{\u201c id\u201d :,\u201c\u6807\u9898\u201c\uff1a\u201d\u201c}\uff0c\u201d date\u201c\uff1a25497\uff0c\u201d new_chat_participant\u201c\uff1a{\u201d id\u201c\uff1a71\uff0c\u201d first_name\u201c\uff1a\u201d NAME\u201c\uff0c\u201d\u7528\u6237\u540d\u201c\uff1a\u201d YOUR_BOT_NAME\u201c}}} \u5f53\u60a8\u5c06BOT\u6dfb\u52a0\u5230\u7ec4\u4e2d\u65f6\uff0c\u8fd9\u662f\u54cd\u5e94\u7684\u793a\u4f8b\u3002 \u4f7f\u7528\u201c\u804a\u5929\u201d\u5bf9\u8c61\u7684\u201c id\u201d\u53d1\u9001\u6d88\u606f\u3002 \u7f51\u4e0a\u627e\u5230\u7684\u539f\u65872 \u5047\u8bbe\u673a\u5668\u4eba\u540d\u79f0\u4e3amy_bot\u3002 1-\u5c06\u673a\u5668\u4eba\u6dfb\u52a0\u5230\u7ec4\u4e2d\u3002 \u8f6c\u5230\u8be5\u7ec4\uff0c\u5355\u51fb\u7ec4\u540d\uff0c\u5355\u51fb\u201c\u6dfb\u52a0\u6210\u5458\u201d\uff0c\u5728\u641c\u7d22\u6846\u4e2d\u641c\u7d22\u60a8\u7684\u673a\u5668\u4eba\uff0c\u5982\u4e0b\u6240\u793a\uff1a@my_bot\uff0c\u9009\u62e9\u60a8\u7684\u673a\u5668\u4eba\u5e76\u5355\u51fb\u201c\u6dfb\u52a0\u201d\u3002 2-\u5411\u673a\u5668\u4eba\u53d1\u9001\u865a\u62df\u6d88\u606f\u3002 \u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u793a\u4f8b\uff1a\uff08/my_id @my_bot \u6211\u5c1d\u8bd5\u4e86\u4e00\u4e9b\u6d88\u606f\uff0c\u4f46\u5e76\u975e\u6240\u6709\u6d88\u606f\u90fd\u8d77\u4f5c\u7528\u3002\u4e0a\u9762\u7684\u793a\u4f8b\u5f88\u597d\u7528\u3002\u4e5f\u8bb8\u6d88\u606f\u5e94\u8be5\u4ee5/\u5f00\u5934\uff09 3-\u8f6c\u5230\u4ee5\u4e0b\u7f51\u5740\uff1a https://api.telegram.org/botXXX:YYYY/getUpdates \u7528\u60a8\u7684\u673a\u5668\u4eba\u4ee4\u724c\u66ff\u6362XXX\uff1aYYYY 4-\u67e5\u627e\u201c\u804a\u5929\u201d\uff1a{\u201c id\u201d\uff1a-zzzzzzzzzzzz\uff0c -zzzzzzzzzzzz\u662f\u60a8\u7684\u804a\u5929ID\uff08\u5e26\u8d1f\u53f7\uff09\u3002 5- \u6d4b\u8bd5\uff1a\u60a8\u53ef\u4ee5\u6d4b\u8bd5\u662f\u5426\u5411\u5377\u66f2\u7684\u7fa4\u7ec4\u53d1\u9001\u6d88\u606f\uff1a curl -X POST \"https://api.telegram.org/botXXX:YYYY/sendMessage\" -d \"chat_id=-zzzzzzzzzz&text=my sample text\" \u5982\u679c\u60a8\u9519\u8fc7\u4e86\u7b2c2\u6b65\uff0c\u90a3\u4e48\u60a8\u8981\u67e5\u627e\u7684\u7ec4\u5c06\u4e0d\u4f1a\u6709\u4efb\u4f55\u66f4\u65b0\u3002\u53e6\u5916\uff0c\u5982\u679c\u6709\u591a\u4e2a\u7ec4\uff0c\u5219\u53ef\u4ee5\u5728\u54cd\u5e94\u4e2d\u67e5\u627e\u7ec4\u540d\uff08\u201c title\u201d\uff1a\u201c group_name \u201d\uff09\u3002","title":"\u83b7\u53d6\u7fa4\u804aid"},{"location":"vps/telegramBot/#_3","text":"\u901a\u8fc7\u7ec8\u7aef\u5f80\u7fa4\u804a\u6216\u4eba\u53d1\u6d88\u606f curl - X POST \"https://api.telegram.org/bot<YourBOTToken>\" - d \"chat_id=<\u4e2a\u4ebaid\u6216\u7fa4\u7ec4id>&text=<YourMessage>\" \u53c2\u8003\uff1a https://coderfan.net/how-to-use-telegram-bot-to-alarm-you-when-someone-login-into-your-vps.html https://qastack.cn/programming/32423837/telegram-bot-how-to-get-a-group-chat-id","title":"\u901a\u8fc7\u7ec8\u7aef\u5f80\u7fa4\u804a\u6216\u4eba\u53d1\u6d88\u606f"},{"location":"vps/tmuxCheatSheet/","text":"Tmux \u5feb\u6377\u952e \u00b6 \u542f\u52a8\u65b0\u4f1a\u8bdd\uff1a \u00b6 tmux [new -s \u4f1a\u8bdd\u540d -n \u7a97\u53e3\u540d] tmux new -s tmuxxx \u6062\u590d\u4f1a\u8bdd\uff1a \u00b6 tmux at [-t \u4f1a\u8bdd\u540d] tmux a #attach the 1st session tmux a -t tmuxxx \u5217\u51fa\u6240\u6709\u4f1a\u8bdd\uff1a \u00b6 tmux ls \u5173\u95ed\u4f1a\u8bdd\uff1a \u00b6 tmux kill-session -t \u4f1a\u8bdd\u540d \u5728 Tmux \u4e2d\uff0c\u6309\u4e0b Tmux \u524d\u7f00 ctrl+b\uff0c\u7136\u540e\uff1a \u00b6 \u4f1a\u8bdd session \u00b6 :new<\u56de\u8f66> \u542f\u52a8\u65b0\u4f1a\u8bdd s \u5217\u51fa\u6240\u6709\u4f1a\u8bdd $ \u91cd\u547d\u540d\u5f53\u524d\u4f1a\u8bdd \u7a97\u53e3 (\u6807\u7b7e\u9875) window \u00b6 c \u521b\u5efa\u65b0\u7a97\u53e3 w \u5217\u51fa\u6240\u6709\u7a97\u53e3 n \u540e\u4e00\u4e2a\u7a97\u53e3 p \u524d\u4e00\u4e2a\u7a97\u53e3 f \u67e5\u627e\u7a97\u53e3 , \u91cd\u547d\u540d\u5f53\u524d\u7a97\u53e3 & \u5173\u95ed\u5f53\u524d\u7a97\u53e3 \u7a97\u683c\uff08\u5206\u5272\u7a97\u53e3\uff09 pane \u00b6 % \u5782\u76f4\u5206\u5272 \" \u6c34\u5e73\u5206\u5272 o \u4ea4\u6362\u7a97\u683c x \u5173\u95ed\u7a97\u683c \u237d \u5de6\u8fb9\u8fd9\u4e2a\u7b26\u53f7\u4ee3\u8868\u7a7a\u683c\u952e - \u5207\u6362\u5e03\u5c40 q \u663e\u793a\u6bcf\u4e2a\u7a97\u683c\u662f\u7b2c\u51e0\u4e2a\uff0c\u5f53\u6570\u5b57\u51fa\u73b0\u7684\u65f6\u5019\u6309\u6570\u5b57\u51e0\u5c31\u9009\u4e2d\u7b2c\u51e0\u4e2a\u7a97\u683c { \u4e0e\u4e0a\u4e00\u4e2a\u7a97\u683c\u4ea4\u6362\u4f4d\u7f6e } \u4e0e\u4e0b\u4e00\u4e2a\u7a97\u683c\u4ea4\u6362\u4f4d\u7f6e z \u5207\u6362\u7a97\u683c\u6700\u5927\u5316/\u6700\u5c0f\u5316 \u6742\u9879\uff1a \u00b6 d \u9000\u51fa tmux\uff08tmux \u4ecd\u5728\u540e\u53f0\u8fd0\u884c\uff09 t \u7a97\u53e3\u4e2d\u592e\u663e\u793a\u4e00\u4e2a\u6570\u5b57\u65f6\u949f ? \u5217\u51fa\u6240\u6709\u5feb\u6377\u952e : \u547d\u4ee4\u63d0\u793a\u7b26 \u9644\u5f55 \u00b6 bind-key C-b send-prefix [20/20] bind-key C-o rotate-window bind-key C-z suspend-client bind-key Space next-layout bind-key ! break-pane bind-key \" split-window bind-key # list-buffers bind-key $ command-prompt -I #S \"rename-session '%%'\" bind-key % split-window -h bind-key & confirm-before -p \"kill-window #W? (y/n)\" kill-window bind-key ' command-prompt -p index \"select-window -t ':%%'\" bind-key ( switch-client -p bind-key ) switch-client -n bind-key , command-prompt -I #W \"rename-window '%%'\" bind-key - delete-buffer bind-key . command-prompt \"move-window -t '%%'\" bind-key 0 select-window -t :0 bind-key 1 select-window -t :1 bind-key 2 select-window -t :2 bind-key 3 select-window -t :3 bind-key 4 select-window -t :4 bind-key 5 select-window -t :5 bind-key 6 select-window -t :6 bind-key 7 select-window -t :7 bind-key 8 select-window -t :8 bind-key 9 select-window -t :9 bind-key : command-prompt bind-key ; last-pane bind-key = choose-buffer bind-key ? list-keys bind-key D choose-client bind-key L switch-client -l bind-key [ copy-mode bind-key ] paste-buffer bind-key c new-window bind-key d detach-client bind-key f command-prompt \"find-window '%%'\" bind-key i display-message bind-key l last-window bind-key n next-window bind-key o select-pane -t :.+ bind-key p previous-window bind-key q display-panes bind-key r refresh-client bind-key s choose-tree bind-key t clock-mode bind-key w choose-window bind-key x confirm-before -p \"kill-pane #P? (y/n)\" kill-pane bind-key z resize-pane -Z bind-key { swap-pane -U bind-key } swap-pane -D bind-key ~ show-messages bind-key PPage copy-mode -u bind-key -r Up select-pane -U bind-key -r Down select-pane -D bind-key -r Left select-pane -L bind-key -r Right select-pane -R bind-key M-1 select-layout even-horizontal bind-key M-2 select-layout even-vertical bind-key M-3 select-layout main-horizontal bind-key M-4 select-layout main-vertical bind-key M-5 select-layout tiled bind-key M-n next-window -a bind-key M-o rotate-window -D bind-key M-p previous-window -a bind-key -r M-Up resize-pane -U 5 bind-key -r M-Down resize-pane -D 5 bind-key -r M-Left resize-pane -L 5 bind-key -r M-Right resize-pane -R 5 bind-key -r C-Up resize-pane -U bind-key -r C-Down resize-pane -D bind-key -r C-Left resize-pane -L bind-key -r C-Right resize-pane -R","title":"tmux\u5feb\u6377\u952e"},{"location":"vps/tmuxCheatSheet/#tmux","text":"","title":"Tmux \u5feb\u6377\u952e"},{"location":"vps/tmuxCheatSheet/#_1","text":"tmux [new -s \u4f1a\u8bdd\u540d -n \u7a97\u53e3\u540d] tmux new -s tmuxxx","title":"\u542f\u52a8\u65b0\u4f1a\u8bdd\uff1a"},{"location":"vps/tmuxCheatSheet/#_2","text":"tmux at [-t \u4f1a\u8bdd\u540d] tmux a #attach the 1st session tmux a -t tmuxxx","title":"\u6062\u590d\u4f1a\u8bdd\uff1a"},{"location":"vps/tmuxCheatSheet/#_3","text":"tmux ls","title":"\u5217\u51fa\u6240\u6709\u4f1a\u8bdd\uff1a"},{"location":"vps/tmuxCheatSheet/#_4","text":"tmux kill-session -t \u4f1a\u8bdd\u540d","title":"\u5173\u95ed\u4f1a\u8bdd\uff1a"},{"location":"vps/tmuxCheatSheet/#tmux-tmux-ctrlb","text":"","title":"\u5728 Tmux \u4e2d\uff0c\u6309\u4e0b Tmux \u524d\u7f00 ctrl+b\uff0c\u7136\u540e\uff1a"},{"location":"vps/tmuxCheatSheet/#session","text":":new<\u56de\u8f66> \u542f\u52a8\u65b0\u4f1a\u8bdd s \u5217\u51fa\u6240\u6709\u4f1a\u8bdd $ \u91cd\u547d\u540d\u5f53\u524d\u4f1a\u8bdd","title":"\u4f1a\u8bdd session"},{"location":"vps/tmuxCheatSheet/#window","text":"c \u521b\u5efa\u65b0\u7a97\u53e3 w \u5217\u51fa\u6240\u6709\u7a97\u53e3 n \u540e\u4e00\u4e2a\u7a97\u53e3 p \u524d\u4e00\u4e2a\u7a97\u53e3 f \u67e5\u627e\u7a97\u53e3 , \u91cd\u547d\u540d\u5f53\u524d\u7a97\u53e3 & \u5173\u95ed\u5f53\u524d\u7a97\u53e3","title":"\u7a97\u53e3 (\u6807\u7b7e\u9875) window"},{"location":"vps/tmuxCheatSheet/#pane","text":"% \u5782\u76f4\u5206\u5272 \" \u6c34\u5e73\u5206\u5272 o \u4ea4\u6362\u7a97\u683c x \u5173\u95ed\u7a97\u683c \u237d \u5de6\u8fb9\u8fd9\u4e2a\u7b26\u53f7\u4ee3\u8868\u7a7a\u683c\u952e - \u5207\u6362\u5e03\u5c40 q \u663e\u793a\u6bcf\u4e2a\u7a97\u683c\u662f\u7b2c\u51e0\u4e2a\uff0c\u5f53\u6570\u5b57\u51fa\u73b0\u7684\u65f6\u5019\u6309\u6570\u5b57\u51e0\u5c31\u9009\u4e2d\u7b2c\u51e0\u4e2a\u7a97\u683c { \u4e0e\u4e0a\u4e00\u4e2a\u7a97\u683c\u4ea4\u6362\u4f4d\u7f6e } \u4e0e\u4e0b\u4e00\u4e2a\u7a97\u683c\u4ea4\u6362\u4f4d\u7f6e z \u5207\u6362\u7a97\u683c\u6700\u5927\u5316/\u6700\u5c0f\u5316","title":"\u7a97\u683c\uff08\u5206\u5272\u7a97\u53e3\uff09 pane"},{"location":"vps/tmuxCheatSheet/#_5","text":"d \u9000\u51fa tmux\uff08tmux \u4ecd\u5728\u540e\u53f0\u8fd0\u884c\uff09 t \u7a97\u53e3\u4e2d\u592e\u663e\u793a\u4e00\u4e2a\u6570\u5b57\u65f6\u949f ? \u5217\u51fa\u6240\u6709\u5feb\u6377\u952e : \u547d\u4ee4\u63d0\u793a\u7b26","title":"\u6742\u9879\uff1a"},{"location":"vps/tmuxCheatSheet/#_6","text":"bind-key C-b send-prefix [20/20] bind-key C-o rotate-window bind-key C-z suspend-client bind-key Space next-layout bind-key ! break-pane bind-key \" split-window bind-key # list-buffers bind-key $ command-prompt -I #S \"rename-session '%%'\" bind-key % split-window -h bind-key & confirm-before -p \"kill-window #W? (y/n)\" kill-window bind-key ' command-prompt -p index \"select-window -t ':%%'\" bind-key ( switch-client -p bind-key ) switch-client -n bind-key , command-prompt -I #W \"rename-window '%%'\" bind-key - delete-buffer bind-key . command-prompt \"move-window -t '%%'\" bind-key 0 select-window -t :0 bind-key 1 select-window -t :1 bind-key 2 select-window -t :2 bind-key 3 select-window -t :3 bind-key 4 select-window -t :4 bind-key 5 select-window -t :5 bind-key 6 select-window -t :6 bind-key 7 select-window -t :7 bind-key 8 select-window -t :8 bind-key 9 select-window -t :9 bind-key : command-prompt bind-key ; last-pane bind-key = choose-buffer bind-key ? list-keys bind-key D choose-client bind-key L switch-client -l bind-key [ copy-mode bind-key ] paste-buffer bind-key c new-window bind-key d detach-client bind-key f command-prompt \"find-window '%%'\" bind-key i display-message bind-key l last-window bind-key n next-window bind-key o select-pane -t :.+ bind-key p previous-window bind-key q display-panes bind-key r refresh-client bind-key s choose-tree bind-key t clock-mode bind-key w choose-window bind-key x confirm-before -p \"kill-pane #P? (y/n)\" kill-pane bind-key z resize-pane -Z bind-key { swap-pane -U bind-key } swap-pane -D bind-key ~ show-messages bind-key PPage copy-mode -u bind-key -r Up select-pane -U bind-key -r Down select-pane -D bind-key -r Left select-pane -L bind-key -r Right select-pane -R bind-key M-1 select-layout even-horizontal bind-key M-2 select-layout even-vertical bind-key M-3 select-layout main-horizontal bind-key M-4 select-layout main-vertical bind-key M-5 select-layout tiled bind-key M-n next-window -a bind-key M-o rotate-window -D bind-key M-p previous-window -a bind-key -r M-Up resize-pane -U 5 bind-key -r M-Down resize-pane -D 5 bind-key -r M-Left resize-pane -L 5 bind-key -r M-Right resize-pane -R 5 bind-key -r C-Up resize-pane -U bind-key -r C-Down resize-pane -D bind-key -r C-Left resize-pane -L bind-key -r C-Right resize-pane -R","title":"\u9644\u5f55"},{"location":"vps/updateCentos7Git/","text":"\u5347\u7ea7centos7\u73af\u5883\u4e2d\u7684git \u00b6 centos 7 \u9ed8\u8ba41.x\u7248\u672c\u7684git\uff0c\u4f7f\u7528vscode remote\u65f6\uff0c\u7ecf\u5e38\u63d0\u793agit\u7248\u672c\u8fc7\u4f4e\u3002 \u67e5\u770bgit\u7248\u672c \u00b6 git --version \u5220\u9664\u65e7\u7248\u672cgit \u00b6 sudo yum remove git sudo yum remove git-* \u901a\u8fc7yum\u5b89\u88c5\u65b0\u7248\u672c \u00b6 \u5b89\u88c5End Point \u5e93 \u00b6 sudo yum install https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm \u5b89\u88c5git \u00b6 sudo yum install git $git --version git version 2.38.1 \u5176\u4ed6\u8bb0\u5f55 \u00b6 \u62a5\u9519 Cannot find command \u2018git\u2018 - do you have \u2018git\u2018 installed and in your PATH? https://stackoverflow.com/questions/28483253/importerror-no-module-named-git-after-reformatting-laptop 20221203","title":"\u5347\u7ea7centos7\u7684git\u7a0b\u5e8f"},{"location":"vps/updateCentos7Git/#centos7git","text":"centos 7 \u9ed8\u8ba41.x\u7248\u672c\u7684git\uff0c\u4f7f\u7528vscode remote\u65f6\uff0c\u7ecf\u5e38\u63d0\u793agit\u7248\u672c\u8fc7\u4f4e\u3002","title":"\u5347\u7ea7centos7\u73af\u5883\u4e2d\u7684git"},{"location":"vps/updateCentos7Git/#git","text":"git --version","title":"\u67e5\u770bgit\u7248\u672c"},{"location":"vps/updateCentos7Git/#git_1","text":"sudo yum remove git sudo yum remove git-*","title":"\u5220\u9664\u65e7\u7248\u672cgit"},{"location":"vps/updateCentos7Git/#yum","text":"","title":"\u901a\u8fc7yum\u5b89\u88c5\u65b0\u7248\u672c"},{"location":"vps/updateCentos7Git/#end-point","text":"sudo yum install https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm","title":"\u5b89\u88c5End Point \u5e93"},{"location":"vps/updateCentos7Git/#git_2","text":"sudo yum install git $git --version git version 2.38.1","title":"\u5b89\u88c5git"},{"location":"vps/updateCentos7Git/#_1","text":"\u62a5\u9519 Cannot find command \u2018git\u2018 - do you have \u2018git\u2018 installed and in your PATH? https://stackoverflow.com/questions/28483253/importerror-no-module-named-git-after-reformatting-laptop 20221203","title":"\u5176\u4ed6\u8bb0\u5f55"}]}